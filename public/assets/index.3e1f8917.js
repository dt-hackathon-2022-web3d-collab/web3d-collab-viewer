var pV=Object.defineProperty;var mV=(a,e,t)=>e in a?pV(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var x=(a,e,t)=>(mV(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const cv="145",au={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},cu={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},DL=0,BC=1,OL=2,gV=3,AV=0,JE=1,KE=2,mf=3,zo=0,Wr=1,ir=2,Vc=0,Tu=1,y_=2,LC=3,DC=4,FL=5,mu=100,kL=101,NL=102,OC=103,FC=104,UL=200,zL=201,GL=202,HL=203,ZE=204,$E=205,VL=206,WL=207,QL=208,jL=209,qL=210,XL=0,YL=1,JL=2,__=3,KL=4,ZL=5,$L=6,e2=7,Ig=0,t2=1,n2=2,ma=0,v_=1,eS=2,i2=3,tS=4,s2=5,lv=300,$l=301,eh=302,Qa=303,Of=304,jf=306,Qc=1e3,Os=1001,ku=1002,$i=1003,Ff=1004,yV=1004,kf=1005,_V=1005,vi=1006,Rg=1007,vV=1007,va=1008,xV=1008,Tr=1009,r2=1010,o2=1011,nS=1012,a2=1013,Hl=1014,Ms=1015,Fs=1016,c2=1017,l2=1018,Iu=1020,h2=1021,u2=1022,ds=1023,d2=1024,f2=1025,ql=1026,Nu=1027,vu=1028,p2=1029,gf=1030,m2=1031,g2=1033,Um=33776,jy=33777,qy=33778,zm=33779,x_=35840,kC=35841,w_=35842,NC=35843,iS=36196,b_=37492,C_=37496,E_=37808,UC=37809,zC=37810,GC=37811,HC=37812,VC=37813,WC=37814,QC=37815,jC=37816,qC=37817,XC=37818,YC=37819,JC=37820,KC=37821,S_=36492,hv=2200,sS=2201,A2=2202,Uu=2300,jc=2301,Xy=2302,xu=2400,wu=2401,rg=2402,uv=2500,rS=2501,wV=0,y2=1,oS=2,Ar=3e3,Gn=3001,_2=3200,v2=3201,Yc=0,x2=1,bV="",Na="srgb",Vl="srgb-linear",w2=0,Gm=7680,b2=7681,C2=7682,E2=7683,S2=34055,M2=34056,T2=5386,I2=512,R2=513,P2=514,B2=515,L2=516,D2=517,O2=518,aS=519,og=35044,CV=35048,EV=35040,SV=35045,MV=35049,TV=35041,IV=35046,RV=35050,PV=35042,BV="100",ZC="300 es",M_=1035;class Lr{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e);e.target=null}}}const hr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let AR=1234567;const Ru=Math.PI/180,ag=180/Math.PI;function ho(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(hr[a&255]+hr[a>>8&255]+hr[a>>16&255]+hr[a>>24&255]+"-"+hr[e&255]+hr[e>>8&255]+"-"+hr[e>>16&15|64]+hr[e>>24&255]+"-"+hr[t&63|128]+hr[t>>8&255]+"-"+hr[t>>16&255]+hr[t>>24&255]+hr[n&255]+hr[n>>8&255]+hr[n>>16&255]+hr[n>>24&255]).toLowerCase()}function As(a,e,t){return Math.max(e,Math.min(t,a))}function cS(a,e){return(a%e+e)%e}function LV(a,e,t,n,i){return n+(a-e)*(i-n)/(t-e)}function DV(a,e,t){return a!==e?(t-a)/(e-a):0}function Hm(a,e,t){return(1-t)*a+t*e}function OV(a,e,t,n){return Hm(a,e,1-Math.exp(-t*n))}function FV(a,e=1){return e-Math.abs(cS(a,e*2)-e)}function kV(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*(3-2*a))}function NV(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*a*(a*(a*6-15)+10))}function UV(a,e){return a+Math.floor(Math.random()*(e-a+1))}function zV(a,e){return a+Math.random()*(e-a)}function GV(a){return a*(.5-Math.random())}function HV(a){a!==void 0&&(AR=a);let e=AR+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function VV(a){return a*Ru}function WV(a){return a*ag}function $C(a){return(a&a-1)===0&&a!==0}function F2(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function T_(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function QV(a,e,t,n,i){const r=Math.cos,o=Math.sin,l=r(t/2),h=o(t/2),u=r((e+n)/2),f=o((e+n)/2),g=r((e-n)/2),m=o((e-n)/2),A=r((n-e)/2),v=o((n-e)/2);switch(i){case"XYX":a.set(l*f,h*g,h*m,l*u);break;case"YZY":a.set(h*m,l*f,h*g,l*u);break;case"ZXZ":a.set(h*g,h*m,l*f,l*u);break;case"XZX":a.set(l*f,h*v,h*A,l*u);break;case"YXY":a.set(h*A,l*f,h*v,l*u);break;case"ZYZ":a.set(h*v,h*A,l*f,l*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Nc(a,e){switch(e.constructor){case Float32Array:return a;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw new Error("Invalid component type.")}}function Gi(a,e){switch(e.constructor){case Float32Array:return a;case Uint16Array:return Math.round(a*65535);case Uint8Array:return Math.round(a*255);case Int16Array:return Math.round(a*32767);case Int8Array:return Math.round(a*127);default:throw new Error("Invalid component type.")}}var zu=Object.freeze({__proto__:null,DEG2RAD:Ru,RAD2DEG:ag,generateUUID:ho,clamp:As,euclideanModulo:cS,mapLinear:LV,inverseLerp:DV,lerp:Hm,damp:OV,pingpong:FV,smoothstep:kV,smootherstep:NV,randInt:UV,randFloat:zV,randFloatSpread:GV,seededRandom:HV,degToRad:VV,radToDeg:WV,isPowerOfTwo:$C,ceilPowerOfTwo:F2,floorPowerOfTwo:T_,setQuaternionFromProperEuler:QV,normalize:Gi,denormalize:Nc});class Xe{constructor(e=0,t=0){Xe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Vr{constructor(){Vr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,r,o,l,h,u){const f=this.elements;return f[0]=e,f[1]=i,f[2]=l,f[3]=t,f[4]=r,f[5]=h,f[6]=n,f[7]=o,f[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],l=n[3],h=n[6],u=n[1],f=n[4],g=n[7],m=n[2],A=n[5],v=n[8],b=i[0],C=i[3],S=i[6],I=i[1],M=i[4],R=i[7],T=i[2],B=i[5],F=i[8];return r[0]=o*b+l*I+h*T,r[3]=o*C+l*M+h*B,r[6]=o*S+l*R+h*F,r[1]=u*b+f*I+g*T,r[4]=u*C+f*M+g*B,r[7]=u*S+f*R+g*F,r[2]=m*b+A*I+v*T,r[5]=m*C+A*M+v*B,r[8]=m*S+A*R+v*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],l=e[5],h=e[6],u=e[7],f=e[8];return t*o*f-t*l*u-n*r*f+n*l*h+i*r*u-i*o*h}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],l=e[5],h=e[6],u=e[7],f=e[8],g=f*o-l*u,m=l*h-f*r,A=u*r-o*h,v=t*g+n*m+i*A;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/v;return e[0]=g*b,e[1]=(i*u-f*n)*b,e[2]=(l*n-i*o)*b,e[3]=m*b,e[4]=(f*t-i*h)*b,e[5]=(i*r-l*t)*b,e[6]=A*b,e[7]=(n*h-u*t)*b,e[8]=(o*t-n*r)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,l){const h=Math.cos(r),u=Math.sin(r);return this.set(n*h,n*u,-n*(h*o+u*l)+o+e,-i*u,i*h,-i*(-u*o+h*l)+l+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],l=i[6],h=i[1],u=i[4],f=i[7];return i[0]=t*r+n*h,i[3]=t*o+n*u,i[6]=t*l+n*f,i[1]=-n*r+t*h,i[4]=-n*o+t*u,i[7]=-n*l+t*f,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function k2(a){for(let e=a.length-1;e>=0;--e)if(a[e]>=65535)return!0;return!1}const jV={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Af(a,e){return new jV[a](e)}function cg(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function Pu(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function Yy(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}const nb={[Na]:{[Vl]:Pu},[Vl]:{[Na]:Yy}},Ro={legacyMode:!0,get workingColorSpace(){return Vl},set workingColorSpace(a){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(a,e,t){if(this.legacyMode||e===t||!e||!t)return a;if(nb[e]&&nb[e][t]!==void 0){const n=nb[e][t];return a.r=n(a.r),a.g=n(a.g),a.b=n(a.b),a}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(a,e){return this.convert(a,this.workingColorSpace,e)},toWorkingColorSpace:function(a,e){return this.convert(a,e,this.workingColorSpace)}},N2={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ls={r:0,g:0,b:0},$o={h:0,s:0,l:0},F0={h:0,s:0,l:0};function ib(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}function k0(a,e){return e.r=a.r,e.g=a.g,e.b=a.b,e}class ye{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Na){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ro.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Vl){return this.r=e,this.g=t,this.b=n,Ro.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Vl){if(e=cS(e,1),t=As(t,0,1),n=As(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=ib(o,r,e+1/3),this.g=ib(o,r,e),this.b=ib(o,r,e-1/3)}return Ro.toWorkingColorSpace(this,i),this}setStyle(e,t=Na){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],l=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,Ro.toWorkingColorSpace(this,t),n(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,Ro.toWorkingColorSpace(this,t),n(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){const h=parseFloat(r[1])/360,u=parseFloat(r[2])/100,f=parseFloat(r[3])/100;return n(r[4]),this.setHSL(h,u,f,t)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,Ro.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,Ro.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Na){const n=N2[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Pu(e.r),this.g=Pu(e.g),this.b=Pu(e.b),this}copyLinearToSRGB(e){return this.r=Yy(e.r),this.g=Yy(e.g),this.b=Yy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Na){return Ro.fromWorkingColorSpace(k0(this,Ls),e),As(Ls.r*255,0,255)<<16^As(Ls.g*255,0,255)<<8^As(Ls.b*255,0,255)<<0}getHexString(e=Na){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Vl){Ro.fromWorkingColorSpace(k0(this,Ls),t);const n=Ls.r,i=Ls.g,r=Ls.b,o=Math.max(n,i,r),l=Math.min(n,i,r);let h,u;const f=(l+o)/2;if(l===o)h=0,u=0;else{const g=o-l;switch(u=f<=.5?g/(o+l):g/(2-o-l),o){case n:h=(i-r)/g+(i<r?6:0);break;case i:h=(r-n)/g+2;break;case r:h=(n-i)/g+4;break}h/=6}return e.h=h,e.s=u,e.l=f,e}getRGB(e,t=Vl){return Ro.fromWorkingColorSpace(k0(this,Ls),t),e.r=Ls.r,e.g=Ls.g,e.b=Ls.b,e}getStyle(e=Na){return Ro.fromWorkingColorSpace(k0(this,Ls),e),e!==Na?`color(${e} ${Ls.r} ${Ls.g} ${Ls.b})`:`rgb(${Ls.r*255|0},${Ls.g*255|0},${Ls.b*255|0})`}offsetHSL(e,t,n){return this.getHSL($o),$o.h+=e,$o.s+=t,$o.l+=n,this.setHSL($o.h,$o.s,$o.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL($o),e.getHSL(F0);const n=Hm($o.h,F0.h,t),i=Hm($o.s,F0.s,t),r=Hm($o.l,F0.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}ye.NAMES=N2;let Fd;class lS{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Fd===void 0&&(Fd=cg("canvas")),Fd.width=e.width,Fd.height=e.height;const n=Fd.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Fd}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=cg("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let o=0;o<r.length;o++)r[o]=Pu(r[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Pu(t[n]/255)*255):t[n]=Pu(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Wl{constructor(e=null){this.isSource=!0,this.uuid=ho(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let o=0,l=i.length;o<l;o++)i[o].isDataTexture?r.push(sb(i[o].image)):r.push(sb(i[o]))}else r=sb(i);n.url=r}return t||(e.images[this.uuid]=n),n}}function sb(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?lS.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let qV=0;class Ii extends Lr{constructor(e=Ii.DEFAULT_IMAGE,t=Ii.DEFAULT_MAPPING,n=Os,i=Os,r=vi,o=va,l=ds,h=Tr,u=1,f=Ar){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qV++}),this.uuid=ho(),this.name="",this.source=new Wl(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=h,this.offset=new Xe(0,0),this.repeat=new Xe(1,1),this.center=new Xe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=f,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lv)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Qc:e.x=e.x-Math.floor(e.x);break;case Os:e.x=e.x<0?0:1;break;case ku:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Qc:e.y=e.y-Math.floor(e.y);break;case Os:e.y=e.y<0?0:1;break;case ku:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Ii.DEFAULT_IMAGE=null;Ii.DEFAULT_MAPPING=lv;class Bn{constructor(e=0,t=0,n=0,i=1){Bn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const h=e.elements,u=h[0],f=h[4],g=h[8],m=h[1],A=h[5],v=h[9],b=h[2],C=h[6],S=h[10];if(Math.abs(f-m)<.01&&Math.abs(g-b)<.01&&Math.abs(v-C)<.01){if(Math.abs(f+m)<.1&&Math.abs(g+b)<.1&&Math.abs(v+C)<.1&&Math.abs(u+A+S-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const M=(u+1)/2,R=(A+1)/2,T=(S+1)/2,B=(f+m)/4,F=(g+b)/4,D=(v+C)/4;return M>R&&M>T?M<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(M),i=B/n,r=F/n):R>T?R<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(R),n=B/i,r=D/i):T<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(T),n=F/r,i=D/r),this.set(n,i,r,t),this}let I=Math.sqrt((C-v)*(C-v)+(g-b)*(g-b)+(m-f)*(m-f));return Math.abs(I)<.001&&(I=1),this.x=(C-v)/I,this.y=(g-b)/I,this.z=(m-f)/I,this.w=Math.acos((u+A+S-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Xr extends Lr{constructor(e,t,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Bn(0,0,e,t),this.scissorTest=!1,this.viewport=new Bn(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new Ii(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:vi,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Wl(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Pg extends Ii{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=$i,this.minFilter=$i,this.wrapR=Os,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class XV extends Xr{constructor(e,t,n){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Pg(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Bg extends Ii{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=$i,this.minFilter=$i,this.wrapR=Os,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class YV extends Xr{constructor(e,t,n){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Bg(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class JV extends Xr{constructor(e,t,n,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class kt{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,l){let h=n[i+0],u=n[i+1],f=n[i+2],g=n[i+3];const m=r[o+0],A=r[o+1],v=r[o+2],b=r[o+3];if(l===0){e[t+0]=h,e[t+1]=u,e[t+2]=f,e[t+3]=g;return}if(l===1){e[t+0]=m,e[t+1]=A,e[t+2]=v,e[t+3]=b;return}if(g!==b||h!==m||u!==A||f!==v){let C=1-l;const S=h*m+u*A+f*v+g*b,I=S>=0?1:-1,M=1-S*S;if(M>Number.EPSILON){const T=Math.sqrt(M),B=Math.atan2(T,S*I);C=Math.sin(C*B)/T,l=Math.sin(l*B)/T}const R=l*I;if(h=h*C+m*R,u=u*C+A*R,f=f*C+v*R,g=g*C+b*R,C===1-l){const T=1/Math.sqrt(h*h+u*u+f*f+g*g);h*=T,u*=T,f*=T,g*=T}}e[t]=h,e[t+1]=u,e[t+2]=f,e[t+3]=g}static multiplyQuaternionsFlat(e,t,n,i,r,o){const l=n[i],h=n[i+1],u=n[i+2],f=n[i+3],g=r[o],m=r[o+1],A=r[o+2],v=r[o+3];return e[t]=l*v+f*g+h*A-u*m,e[t+1]=h*v+f*m+u*g-l*A,e[t+2]=u*v+f*A+l*m-h*g,e[t+3]=f*v-l*g-h*m-u*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,o=e._order,l=Math.cos,h=Math.sin,u=l(n/2),f=l(i/2),g=l(r/2),m=h(n/2),A=h(i/2),v=h(r/2);switch(o){case"XYZ":this._x=m*f*g+u*A*v,this._y=u*A*g-m*f*v,this._z=u*f*v+m*A*g,this._w=u*f*g-m*A*v;break;case"YXZ":this._x=m*f*g+u*A*v,this._y=u*A*g-m*f*v,this._z=u*f*v-m*A*g,this._w=u*f*g+m*A*v;break;case"ZXY":this._x=m*f*g-u*A*v,this._y=u*A*g+m*f*v,this._z=u*f*v+m*A*g,this._w=u*f*g-m*A*v;break;case"ZYX":this._x=m*f*g-u*A*v,this._y=u*A*g+m*f*v,this._z=u*f*v-m*A*g,this._w=u*f*g+m*A*v;break;case"YZX":this._x=m*f*g+u*A*v,this._y=u*A*g+m*f*v,this._z=u*f*v-m*A*g,this._w=u*f*g-m*A*v;break;case"XZY":this._x=m*f*g-u*A*v,this._y=u*A*g-m*f*v,this._z=u*f*v+m*A*g,this._w=u*f*g+m*A*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],l=t[5],h=t[9],u=t[2],f=t[6],g=t[10],m=n+l+g;if(m>0){const A=.5/Math.sqrt(m+1);this._w=.25/A,this._x=(f-h)*A,this._y=(r-u)*A,this._z=(o-i)*A}else if(n>l&&n>g){const A=2*Math.sqrt(1+n-l-g);this._w=(f-h)/A,this._x=.25*A,this._y=(i+o)/A,this._z=(r+u)/A}else if(l>g){const A=2*Math.sqrt(1+l-n-g);this._w=(r-u)/A,this._x=(i+o)/A,this._y=.25*A,this._z=(h+f)/A}else{const A=2*Math.sqrt(1+g-n-l);this._w=(o-i)/A,this._x=(r+u)/A,this._y=(h+f)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(As(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,l=t._x,h=t._y,u=t._z,f=t._w;return this._x=n*f+o*l+i*u-r*h,this._y=i*f+o*h+r*l-n*u,this._z=r*f+o*u+n*h-i*l,this._w=o*f-n*l-i*h-r*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let l=o*e._w+n*e._x+i*e._y+r*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const h=1-l*l;if(h<=Number.EPSILON){const A=1-t;return this._w=A*o+t*this._w,this._x=A*n+t*this._x,this._y=A*i+t*this._y,this._z=A*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(h),f=Math.atan2(u,l),g=Math.sin((1-t)*f)/u,m=Math.sin(t*f)/u;return this._w=o*g+this._w*m,this._x=n*g+this._x*m,this._y=i*g+this._y*m,this._z=r*g+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class q{constructor(e=0,t=0,n=0){q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,l=e.z,h=e.w,u=h*t+o*i-l*n,f=h*n+l*t-r*i,g=h*i+r*n-o*t,m=-r*t-o*n-l*i;return this.x=u*h+m*-r+f*-l-g*-o,this.y=f*h+m*-o+g*-r-u*-l,this.z=g*h+m*-l+u*-o-f*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,l=t.y,h=t.z;return this.x=i*h-r*l,this.y=r*o-n*h,this.z=n*l-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return rb.copy(this).projectOnVector(e),this.sub(rb)}reflect(e){return this.sub(rb.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(As(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const rb=new q,yR=new kt;class Rr{constructor(e=new q(1/0,1/0,1/0),t=new q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,l=-1/0;for(let h=0,u=e.length;h<u;h+=3){const f=e[h],g=e[h+1],m=e[h+2];f<t&&(t=f),g<n&&(n=g),m<i&&(i=m),f>r&&(r=f),g>o&&(o=g),m>l&&(l=m)}return this.min.set(t,n,i),this.max.set(r,o,l),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,l=-1/0;for(let h=0,u=e.count;h<u;h++){const f=e.getX(h),g=e.getY(h),m=e.getZ(h);f<t&&(t=f),g<n&&(n=g),m<i&&(i=m),f>r&&(r=f),g>o&&(o=g),m>l&&(l=m)}return this.min.set(t,n,i),this.max.set(r,o,l),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Xh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const r=n.attributes.position;for(let o=0,l=r.count;o<l;o++)Xh.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Xh)}else n.boundingBox===null&&n.computeBoundingBox(),ob.copy(n.boundingBox),ob.applyMatrix4(e.matrixWorld),this.union(ob);const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Xh),Xh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(lm),N0.subVectors(this.max,lm),kd.subVectors(e.a,lm),Nd.subVectors(e.b,lm),Ud.subVectors(e.c,lm),yl.subVectors(Nd,kd),_l.subVectors(Ud,Nd),Yh.subVectors(kd,Ud);let t=[0,-yl.z,yl.y,0,-_l.z,_l.y,0,-Yh.z,Yh.y,yl.z,0,-yl.x,_l.z,0,-_l.x,Yh.z,0,-Yh.x,-yl.y,yl.x,0,-_l.y,_l.x,0,-Yh.y,Yh.x,0];return!ab(t,kd,Nd,Ud,N0)||(t=[1,0,0,0,1,0,0,0,1],!ab(t,kd,Nd,Ud,N0))?!1:(U0.crossVectors(yl,_l),t=[U0.x,U0.y,U0.z],ab(t,kd,Nd,Ud,N0))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Xh.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Xh).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(vc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),vc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),vc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),vc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),vc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),vc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),vc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),vc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(vc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const vc=[new q,new q,new q,new q,new q,new q,new q,new q],Xh=new q,ob=new Rr,kd=new q,Nd=new q,Ud=new q,yl=new q,_l=new q,Yh=new q,lm=new q,N0=new q,U0=new q,Jh=new q;function ab(a,e,t,n,i){for(let r=0,o=a.length-3;r<=o;r+=3){Jh.fromArray(a,r);const l=i.x*Math.abs(Jh.x)+i.y*Math.abs(Jh.y)+i.z*Math.abs(Jh.z),h=e.dot(Jh),u=t.dot(Jh),f=n.dot(Jh);if(Math.max(-Math.max(h,u,f),Math.min(h,u,f))>l)return!1}return!0}const KV=new Rr,_R=new q,z0=new q,cb=new q;class ec{constructor(e=new q,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):KV.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;cb.subVectors(e,this.center);const t=cb.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.add(cb.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?z0.set(0,0,1).multiplyScalar(e.radius):z0.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(_R.copy(e.center).add(z0)),this.expandByPoint(_R.copy(e.center).sub(z0)),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const xc=new q,lb=new q,G0=new q,vl=new q,hb=new q,H0=new q,ub=new q;class Vu{constructor(e=new q,t=new q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xc)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=xc.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(xc.copy(this.direction).multiplyScalar(t).add(this.origin),xc.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){lb.copy(e).add(t).multiplyScalar(.5),G0.copy(t).sub(e).normalize(),vl.copy(this.origin).sub(lb);const r=e.distanceTo(t)*.5,o=-this.direction.dot(G0),l=vl.dot(this.direction),h=-vl.dot(G0),u=vl.lengthSq(),f=Math.abs(1-o*o);let g,m,A,v;if(f>0)if(g=o*h-l,m=o*l-h,v=r*f,g>=0)if(m>=-v)if(m<=v){const b=1/f;g*=b,m*=b,A=g*(g+o*m+2*l)+m*(o*g+m+2*h)+u}else m=r,g=Math.max(0,-(o*m+l)),A=-g*g+m*(m+2*h)+u;else m=-r,g=Math.max(0,-(o*m+l)),A=-g*g+m*(m+2*h)+u;else m<=-v?(g=Math.max(0,-(-o*r+l)),m=g>0?-r:Math.min(Math.max(-r,-h),r),A=-g*g+m*(m+2*h)+u):m<=v?(g=0,m=Math.min(Math.max(-r,-h),r),A=m*(m+2*h)+u):(g=Math.max(0,-(o*r+l)),m=g>0?r:Math.min(Math.max(-r,-h),r),A=-g*g+m*(m+2*h)+u);else m=o>0?-r:r,g=Math.max(0,-(o*m+l)),A=-g*g+m*(m+2*h)+u;return n&&n.copy(this.direction).multiplyScalar(g).add(this.origin),i&&i.copy(G0).multiplyScalar(m).add(lb),A}intersectSphere(e,t){xc.subVectors(e.center,this.origin);const n=xc.dot(this.direction),i=xc.dot(xc)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),l=n-o,h=n+o;return l<0&&h<0?null:l<0?this.at(h,t):this.at(l,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,l,h;const u=1/this.direction.x,f=1/this.direction.y,g=1/this.direction.z,m=this.origin;return u>=0?(n=(e.min.x-m.x)*u,i=(e.max.x-m.x)*u):(n=(e.max.x-m.x)*u,i=(e.min.x-m.x)*u),f>=0?(r=(e.min.y-m.y)*f,o=(e.max.y-m.y)*f):(r=(e.max.y-m.y)*f,o=(e.min.y-m.y)*f),n>o||r>i||((r>n||n!==n)&&(n=r),(o<i||i!==i)&&(i=o),g>=0?(l=(e.min.z-m.z)*g,h=(e.max.z-m.z)*g):(l=(e.max.z-m.z)*g,h=(e.min.z-m.z)*g),n>h||l>i)||((l>n||n!==n)&&(n=l),(h<i||i!==i)&&(i=h),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,xc)!==null}intersectTriangle(e,t,n,i,r){hb.subVectors(t,e),H0.subVectors(n,e),ub.crossVectors(hb,H0);let o=this.direction.dot(ub),l;if(o>0){if(i)return null;l=1}else if(o<0)l=-1,o=-o;else return null;vl.subVectors(this.origin,e);const h=l*this.direction.dot(H0.crossVectors(vl,H0));if(h<0)return null;const u=l*this.direction.dot(hb.cross(vl));if(u<0||h+u>o)return null;const f=-l*vl.dot(ub);return f<0?null:this.at(f/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class fn{constructor(){fn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,o,l,h,u,f,g,m,A,v,b,C){const S=this.elements;return S[0]=e,S[4]=t,S[8]=n,S[12]=i,S[1]=r,S[5]=o,S[9]=l,S[13]=h,S[2]=u,S[6]=f,S[10]=g,S[14]=m,S[3]=A,S[7]=v,S[11]=b,S[15]=C,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new fn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/zd.setFromMatrixColumn(e,0).length(),r=1/zd.setFromMatrixColumn(e,1).length(),o=1/zd.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),l=Math.sin(n),h=Math.cos(i),u=Math.sin(i),f=Math.cos(r),g=Math.sin(r);if(e.order==="XYZ"){const m=o*f,A=o*g,v=l*f,b=l*g;t[0]=h*f,t[4]=-h*g,t[8]=u,t[1]=A+v*u,t[5]=m-b*u,t[9]=-l*h,t[2]=b-m*u,t[6]=v+A*u,t[10]=o*h}else if(e.order==="YXZ"){const m=h*f,A=h*g,v=u*f,b=u*g;t[0]=m+b*l,t[4]=v*l-A,t[8]=o*u,t[1]=o*g,t[5]=o*f,t[9]=-l,t[2]=A*l-v,t[6]=b+m*l,t[10]=o*h}else if(e.order==="ZXY"){const m=h*f,A=h*g,v=u*f,b=u*g;t[0]=m-b*l,t[4]=-o*g,t[8]=v+A*l,t[1]=A+v*l,t[5]=o*f,t[9]=b-m*l,t[2]=-o*u,t[6]=l,t[10]=o*h}else if(e.order==="ZYX"){const m=o*f,A=o*g,v=l*f,b=l*g;t[0]=h*f,t[4]=v*u-A,t[8]=m*u+b,t[1]=h*g,t[5]=b*u+m,t[9]=A*u-v,t[2]=-u,t[6]=l*h,t[10]=o*h}else if(e.order==="YZX"){const m=o*h,A=o*u,v=l*h,b=l*u;t[0]=h*f,t[4]=b-m*g,t[8]=v*g+A,t[1]=g,t[5]=o*f,t[9]=-l*f,t[2]=-u*f,t[6]=A*g+v,t[10]=m-b*g}else if(e.order==="XZY"){const m=o*h,A=o*u,v=l*h,b=l*u;t[0]=h*f,t[4]=-g,t[8]=u*f,t[1]=m*g+b,t[5]=o*f,t[9]=A*g-v,t[2]=v*g-A,t[6]=l*f,t[10]=b*g+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ZV,e,$V)}lookAt(e,t,n){const i=this.elements;return io.subVectors(e,t),io.lengthSq()===0&&(io.z=1),io.normalize(),xl.crossVectors(n,io),xl.lengthSq()===0&&(Math.abs(n.z)===1?io.x+=1e-4:io.z+=1e-4,io.normalize(),xl.crossVectors(n,io)),xl.normalize(),V0.crossVectors(io,xl),i[0]=xl.x,i[4]=V0.x,i[8]=io.x,i[1]=xl.y,i[5]=V0.y,i[9]=io.y,i[2]=xl.z,i[6]=V0.z,i[10]=io.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],l=n[4],h=n[8],u=n[12],f=n[1],g=n[5],m=n[9],A=n[13],v=n[2],b=n[6],C=n[10],S=n[14],I=n[3],M=n[7],R=n[11],T=n[15],B=i[0],F=i[4],D=i[8],U=i[12],W=i[1],J=i[5],ee=i[9],Q=i[13],Y=i[2],se=i[6],ae=i[10],ve=i[14],xe=i[3],Ae=i[7],Ie=i[11],Le=i[15];return r[0]=o*B+l*W+h*Y+u*xe,r[4]=o*F+l*J+h*se+u*Ae,r[8]=o*D+l*ee+h*ae+u*Ie,r[12]=o*U+l*Q+h*ve+u*Le,r[1]=f*B+g*W+m*Y+A*xe,r[5]=f*F+g*J+m*se+A*Ae,r[9]=f*D+g*ee+m*ae+A*Ie,r[13]=f*U+g*Q+m*ve+A*Le,r[2]=v*B+b*W+C*Y+S*xe,r[6]=v*F+b*J+C*se+S*Ae,r[10]=v*D+b*ee+C*ae+S*Ie,r[14]=v*U+b*Q+C*ve+S*Le,r[3]=I*B+M*W+R*Y+T*xe,r[7]=I*F+M*J+R*se+T*Ae,r[11]=I*D+M*ee+R*ae+T*Ie,r[15]=I*U+M*Q+R*ve+T*Le,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],l=e[5],h=e[9],u=e[13],f=e[2],g=e[6],m=e[10],A=e[14],v=e[3],b=e[7],C=e[11],S=e[15];return v*(+r*h*g-i*u*g-r*l*m+n*u*m+i*l*A-n*h*A)+b*(+t*h*A-t*u*m+r*o*m-i*o*A+i*u*f-r*h*f)+C*(+t*u*g-t*l*A-r*o*g+n*o*A+r*l*f-n*u*f)+S*(-i*l*f-t*h*g+t*l*m+i*o*g-n*o*m+n*h*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],l=e[5],h=e[6],u=e[7],f=e[8],g=e[9],m=e[10],A=e[11],v=e[12],b=e[13],C=e[14],S=e[15],I=g*C*u-b*m*u+b*h*A-l*C*A-g*h*S+l*m*S,M=v*m*u-f*C*u-v*h*A+o*C*A+f*h*S-o*m*S,R=f*b*u-v*g*u+v*l*A-o*b*A-f*l*S+o*g*S,T=v*g*h-f*b*h-v*l*m+o*b*m+f*l*C-o*g*C,B=t*I+n*M+i*R+r*T;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/B;return e[0]=I*F,e[1]=(b*m*r-g*C*r-b*i*A+n*C*A+g*i*S-n*m*S)*F,e[2]=(l*C*r-b*h*r+b*i*u-n*C*u-l*i*S+n*h*S)*F,e[3]=(g*h*r-l*m*r-g*i*u+n*m*u+l*i*A-n*h*A)*F,e[4]=M*F,e[5]=(f*C*r-v*m*r+v*i*A-t*C*A-f*i*S+t*m*S)*F,e[6]=(v*h*r-o*C*r-v*i*u+t*C*u+o*i*S-t*h*S)*F,e[7]=(o*m*r-f*h*r+f*i*u-t*m*u-o*i*A+t*h*A)*F,e[8]=R*F,e[9]=(v*g*r-f*b*r-v*n*A+t*b*A+f*n*S-t*g*S)*F,e[10]=(o*b*r-v*l*r+v*n*u-t*b*u-o*n*S+t*l*S)*F,e[11]=(f*l*r-o*g*r-f*n*u+t*g*u+o*n*A-t*l*A)*F,e[12]=T*F,e[13]=(f*b*i-v*g*i+v*n*m-t*b*m-f*n*C+t*g*C)*F,e[14]=(v*l*i-o*b*i-v*n*h+t*b*h+o*n*C-t*l*C)*F,e[15]=(o*g*i-f*l*i+f*n*h-t*g*h-o*n*m+t*l*m)*F,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,l=e.y,h=e.z,u=r*o,f=r*l;return this.set(u*o+n,u*l-i*h,u*h+i*l,0,u*l+i*h,f*l+n,f*h-i*o,0,u*h-i*l,f*h+i*o,r*h*h+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,l=t._z,h=t._w,u=r+r,f=o+o,g=l+l,m=r*u,A=r*f,v=r*g,b=o*f,C=o*g,S=l*g,I=h*u,M=h*f,R=h*g,T=n.x,B=n.y,F=n.z;return i[0]=(1-(b+S))*T,i[1]=(A+R)*T,i[2]=(v-M)*T,i[3]=0,i[4]=(A-R)*B,i[5]=(1-(m+S))*B,i[6]=(C+I)*B,i[7]=0,i[8]=(v+M)*F,i[9]=(C-I)*F,i[10]=(1-(m+b))*F,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=zd.set(i[0],i[1],i[2]).length();const o=zd.set(i[4],i[5],i[6]).length(),l=zd.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],ea.copy(this);const u=1/r,f=1/o,g=1/l;return ea.elements[0]*=u,ea.elements[1]*=u,ea.elements[2]*=u,ea.elements[4]*=f,ea.elements[5]*=f,ea.elements[6]*=f,ea.elements[8]*=g,ea.elements[9]*=g,ea.elements[10]*=g,t.setFromRotationMatrix(ea),n.x=r,n.y=o,n.z=l,this}makePerspective(e,t,n,i,r,o){const l=this.elements,h=2*r/(t-e),u=2*r/(n-i),f=(t+e)/(t-e),g=(n+i)/(n-i),m=-(o+r)/(o-r),A=-2*o*r/(o-r);return l[0]=h,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=u,l[9]=g,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=A,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,r,o){const l=this.elements,h=1/(t-e),u=1/(n-i),f=1/(o-r),g=(t+e)*h,m=(n+i)*u,A=(o+r)*f;return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-g,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=-2*f,l[14]=-A,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const zd=new q,ea=new fn,ZV=new q(0,0,0),$V=new q(1,1,1),xl=new q,V0=new q,io=new q,vR=new fn,xR=new kt;class _s{constructor(e=0,t=0,n=0,i=_s.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],l=i[8],h=i[1],u=i[5],f=i[9],g=i[2],m=i[6],A=i[10];switch(t){case"XYZ":this._y=Math.asin(As(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,A),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(m,u),this._z=0);break;case"YXZ":this._x=Math.asin(-As(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(l,A),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-g,r),this._z=0);break;case"ZXY":this._x=Math.asin(As(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-g,A),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-As(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(m,A),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(As(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-g,r)):(this._x=0,this._y=Math.atan2(l,A));break;case"XZY":this._z=Math.asin(-As(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(m,u),this._y=Math.atan2(l,r)):(this._x=Math.atan2(-f,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return vR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(vR,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return xR.setFromEuler(this),this.setFromQuaternion(xR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}_s.DefaultOrder="XYZ";_s.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ka{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let eW=0;const wR=new q,Gd=new kt,wc=new fn,W0=new q,hm=new q,tW=new q,nW=new kt,bR=new q(1,0,0),CR=new q(0,1,0),ER=new q(0,0,1),iW={type:"added"},SR={type:"removed"};class Ft extends Lr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:eW++}),this.uuid=ho(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ft.DefaultUp.clone();const e=new q,t=new _s,n=new kt,i=new q(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new fn},normalMatrix:{value:new Vr}}),this.matrix=new fn,this.matrixWorld=new fn,this.matrixAutoUpdate=Ft.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ft.DefaultMatrixWorldAutoUpdate,this.layers=new Ka,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Gd.setFromAxisAngle(e,t),this.quaternion.multiply(Gd),this}rotateOnWorldAxis(e,t){return Gd.setFromAxisAngle(e,t),this.quaternion.premultiply(Gd),this}rotateX(e){return this.rotateOnAxis(bR,e)}rotateY(e){return this.rotateOnAxis(CR,e)}rotateZ(e){return this.rotateOnAxis(ER,e)}translateOnAxis(e,t){return wR.copy(e).applyQuaternion(this.quaternion),this.position.add(wR.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(bR,e)}translateY(e){return this.translateOnAxis(CR,e)}translateZ(e){return this.translateOnAxis(ER,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(wc.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?W0.copy(e):W0.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),hm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?wc.lookAt(hm,W0,this.up):wc.lookAt(W0,hm,this.up),this.quaternion.setFromRotationMatrix(wc),i&&(wc.extractRotation(i.matrixWorld),Gd.setFromRotationMatrix(wc),this.quaternion.premultiply(Gd.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(iW)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(SR)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(SR)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),wc.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),wc.multiply(e.parent.matrixWorld)),e.applyMatrix4(wc),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hm,e,tW),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hm,nW,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const r=t[n];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++){const l=i[r];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(l,h){return l[h.uuid]===void 0&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const h=l.shapes;if(Array.isArray(h))for(let u=0,f=h.length;u<f;u++){const g=h[u];r(e.shapes,g)}else r(e.shapes,h)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let h=0,u=this.material.length;h<u;h++)l.push(r(e.materials,this.material[h]));i.material=l}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const h=this.animations[l];i.animations.push(r(e.animations,h))}}if(t){const l=o(e.geometries),h=o(e.materials),u=o(e.textures),f=o(e.images),g=o(e.shapes),m=o(e.skeletons),A=o(e.animations),v=o(e.nodes);l.length>0&&(n.geometries=l),h.length>0&&(n.materials=h),u.length>0&&(n.textures=u),f.length>0&&(n.images=f),g.length>0&&(n.shapes=g),m.length>0&&(n.skeletons=m),A.length>0&&(n.animations=A),v.length>0&&(n.nodes=v)}return n.object=i,n;function o(l){const h=[];for(const u in l){const f=l[u];delete f.metadata,h.push(f)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Ft.DefaultUp=new q(0,1,0);Ft.DefaultMatrixAutoUpdate=!0;Ft.DefaultMatrixWorldAutoUpdate=!0;const ta=new q,bc=new q,db=new q,Cc=new q,Hd=new q,Vd=new q,MR=new q,fb=new q,pb=new q,mb=new q;class ko{constructor(e=new q,t=new q,n=new q){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ta.subVectors(e,t),i.cross(ta);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){ta.subVectors(i,t),bc.subVectors(n,t),db.subVectors(e,t);const o=ta.dot(ta),l=ta.dot(bc),h=ta.dot(db),u=bc.dot(bc),f=bc.dot(db),g=o*u-l*l;if(g===0)return r.set(-2,-1,-1);const m=1/g,A=(u*h-l*f)*m,v=(o*f-l*h)*m;return r.set(1-A-v,v,A)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Cc),Cc.x>=0&&Cc.y>=0&&Cc.x+Cc.y<=1}static getUV(e,t,n,i,r,o,l,h){return this.getBarycoord(e,t,n,i,Cc),h.set(0,0),h.addScaledVector(r,Cc.x),h.addScaledVector(o,Cc.y),h.addScaledVector(l,Cc.z),h}static isFrontFacing(e,t,n,i){return ta.subVectors(n,t),bc.subVectors(e,t),ta.cross(bc).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ta.subVectors(this.c,this.b),bc.subVectors(this.a,this.b),ta.cross(bc).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ko.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ko.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return ko.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return ko.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ko.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,l;Hd.subVectors(i,n),Vd.subVectors(r,n),fb.subVectors(e,n);const h=Hd.dot(fb),u=Vd.dot(fb);if(h<=0&&u<=0)return t.copy(n);pb.subVectors(e,i);const f=Hd.dot(pb),g=Vd.dot(pb);if(f>=0&&g<=f)return t.copy(i);const m=h*g-f*u;if(m<=0&&h>=0&&f<=0)return o=h/(h-f),t.copy(n).addScaledVector(Hd,o);mb.subVectors(e,r);const A=Hd.dot(mb),v=Vd.dot(mb);if(v>=0&&A<=v)return t.copy(r);const b=A*u-h*v;if(b<=0&&u>=0&&v<=0)return l=u/(u-v),t.copy(n).addScaledVector(Vd,l);const C=f*v-A*g;if(C<=0&&g-f>=0&&A-v>=0)return MR.subVectors(r,i),l=(g-f)/(g-f+(A-v)),t.copy(i).addScaledVector(MR,l);const S=1/(C+b+m);return o=b*S,l=m*S,t.copy(n).addScaledVector(Hd,o).addScaledVector(Vd,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let sW=0;class vs extends Lr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:sW++}),this.uuid=ho(),this.name="",this.type="Material",this.blending=Tu,this.side=zo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ZE,this.blendDst=$E,this.blendEquation=mu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=__,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=aS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gm,this.stencilZFail=Gm,this.stencilZPass=Gm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Tu&&(n.blending=this.blending),this.side!==zo&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function i(r){const o=[];for(const l in r){const h=r[l];delete h.metadata,o.push(h)}return o}if(t){const r=i(e.textures),o=i(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Hi extends vs{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ye(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ig,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const bs=new q,Q0=new Xe;class Jn{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=og,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Q0.fromBufferAttribute(this,t),Q0.applyMatrix3(e),this.setXY(t,Q0.x,Q0.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyMatrix3(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyMatrix4(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyNormalMatrix(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.transformDirection(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Nc(t,this.array)),t}setX(e,t){return this.normalized&&(t=Gi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Nc(t,this.array)),t}setY(e,t){return this.normalized&&(t=Gi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Nc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Gi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Nc(t,this.array)),t}setW(e,t){return this.normalized&&(t=Gi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Gi(t,this.array),n=Gi(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Gi(t,this.array),n=Gi(n,this.array),i=Gi(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Gi(t,this.array),n=Gi(n,this.array),i=Gi(i,this.array),r=Gi(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==og&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class rW extends Jn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class oW extends Jn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class aW extends Jn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class cW extends Jn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class hS extends Jn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class lW extends Jn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class uS extends Jn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class hW extends Jn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}}class tn extends Jn{constructor(e,t,n){super(new Float32Array(e),t,n)}}class uW extends Jn{constructor(e,t,n){super(new Float64Array(e),t,n)}}let dW=0;const Mo=new fn,gb=new Ft,Wd=new q,so=new Rr,um=new Rr,Hs=new q;class Sn extends Lr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:dW++}),this.uuid=ho(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(k2(e)?uS:hS)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Vr().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Mo.makeRotationFromQuaternion(e),this.applyMatrix4(Mo),this}rotateX(e){return Mo.makeRotationX(e),this.applyMatrix4(Mo),this}rotateY(e){return Mo.makeRotationY(e),this.applyMatrix4(Mo),this}rotateZ(e){return Mo.makeRotationZ(e),this.applyMatrix4(Mo),this}translate(e,t,n){return Mo.makeTranslation(e,t,n),this.applyMatrix4(Mo),this}scale(e,t,n){return Mo.makeScale(e,t,n),this.applyMatrix4(Mo),this}lookAt(e){return gb.lookAt(e),gb.updateMatrix(),this.applyMatrix4(gb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wd).negate(),this.translate(Wd.x,Wd.y,Wd.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new tn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Rr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const r=t[n];so.setFromBufferAttribute(r),this.morphTargetsRelative?(Hs.addVectors(this.boundingBox.min,so.min),this.boundingBox.expandByPoint(Hs),Hs.addVectors(this.boundingBox.max,so.max),this.boundingBox.expandByPoint(Hs)):(this.boundingBox.expandByPoint(so.min),this.boundingBox.expandByPoint(so.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ec);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new q,1/0);return}if(e){const n=this.boundingSphere.center;if(so.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const l=t[r];um.setFromBufferAttribute(l),this.morphTargetsRelative?(Hs.addVectors(so.min,um.min),so.expandByPoint(Hs),Hs.addVectors(so.max,um.max),so.expandByPoint(Hs)):(so.expandByPoint(um.min),so.expandByPoint(um.max))}so.getCenter(n);let i=0;for(let r=0,o=e.count;r<o;r++)Hs.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(Hs));if(t)for(let r=0,o=t.length;r<o;r++){const l=t[r],h=this.morphTargetsRelative;for(let u=0,f=l.count;u<f;u++)Hs.fromBufferAttribute(l,u),h&&(Wd.fromBufferAttribute(e,u),Hs.add(Wd)),i=Math.max(i,n.distanceToSquared(Hs))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,l=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Jn(new Float32Array(4*l),4));const h=this.getAttribute("tangent").array,u=[],f=[];for(let W=0;W<l;W++)u[W]=new q,f[W]=new q;const g=new q,m=new q,A=new q,v=new Xe,b=new Xe,C=new Xe,S=new q,I=new q;function M(W,J,ee){g.fromArray(i,W*3),m.fromArray(i,J*3),A.fromArray(i,ee*3),v.fromArray(o,W*2),b.fromArray(o,J*2),C.fromArray(o,ee*2),m.sub(g),A.sub(g),b.sub(v),C.sub(v);const Q=1/(b.x*C.y-C.x*b.y);!isFinite(Q)||(S.copy(m).multiplyScalar(C.y).addScaledVector(A,-b.y).multiplyScalar(Q),I.copy(A).multiplyScalar(b.x).addScaledVector(m,-C.x).multiplyScalar(Q),u[W].add(S),u[J].add(S),u[ee].add(S),f[W].add(I),f[J].add(I),f[ee].add(I))}let R=this.groups;R.length===0&&(R=[{start:0,count:n.length}]);for(let W=0,J=R.length;W<J;++W){const ee=R[W],Q=ee.start,Y=ee.count;for(let se=Q,ae=Q+Y;se<ae;se+=3)M(n[se+0],n[se+1],n[se+2])}const T=new q,B=new q,F=new q,D=new q;function U(W){F.fromArray(r,W*3),D.copy(F);const J=u[W];T.copy(J),T.sub(F.multiplyScalar(F.dot(J))).normalize(),B.crossVectors(D,J);const Q=B.dot(f[W])<0?-1:1;h[W*4]=T.x,h[W*4+1]=T.y,h[W*4+2]=T.z,h[W*4+3]=Q}for(let W=0,J=R.length;W<J;++W){const ee=R[W],Q=ee.start,Y=ee.count;for(let se=Q,ae=Q+Y;se<ae;se+=3)U(n[se+0]),U(n[se+1]),U(n[se+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Jn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let m=0,A=n.count;m<A;m++)n.setXYZ(m,0,0,0);const i=new q,r=new q,o=new q,l=new q,h=new q,u=new q,f=new q,g=new q;if(e)for(let m=0,A=e.count;m<A;m+=3){const v=e.getX(m+0),b=e.getX(m+1),C=e.getX(m+2);i.fromBufferAttribute(t,v),r.fromBufferAttribute(t,b),o.fromBufferAttribute(t,C),f.subVectors(o,r),g.subVectors(i,r),f.cross(g),l.fromBufferAttribute(n,v),h.fromBufferAttribute(n,b),u.fromBufferAttribute(n,C),l.add(f),h.add(f),u.add(f),n.setXYZ(v,l.x,l.y,l.z),n.setXYZ(b,h.x,h.y,h.z),n.setXYZ(C,u.x,u.y,u.z)}else for(let m=0,A=t.count;m<A;m+=3)i.fromBufferAttribute(t,m+0),r.fromBufferAttribute(t,m+1),o.fromBufferAttribute(t,m+2),f.subVectors(o,r),g.subVectors(i,r),f.cross(g),n.setXYZ(m+0,f.x,f.y,f.z),n.setXYZ(m+1,f.x,f.y,f.z),n.setXYZ(m+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Hs.fromBufferAttribute(e,t),Hs.normalize(),e.setXYZ(t,Hs.x,Hs.y,Hs.z)}toNonIndexed(){function e(l,h){const u=l.array,f=l.itemSize,g=l.normalized,m=new u.constructor(h.length*f);let A=0,v=0;for(let b=0,C=h.length;b<C;b++){l.isInterleavedBufferAttribute?A=h[b]*l.data.stride+l.offset:A=h[b]*f;for(let S=0;S<f;S++)m[v++]=u[A++]}return new Jn(m,f,g)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Sn,n=this.index.array,i=this.attributes;for(const l in i){const h=i[l],u=e(h,n);t.setAttribute(l,u)}const r=this.morphAttributes;for(const l in r){const h=[],u=r[l];for(let f=0,g=u.length;f<g;f++){const m=u[f],A=e(m,n);h.push(A)}t.morphAttributes[l]=h}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let l=0,h=o.length;l<h;l++){const u=o[l];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const u in h)h[u]!==void 0&&(e[u]=h[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const h in n){const u=n[h];e.data.attributes[h]=u.toJSON(e.data)}const i={};let r=!1;for(const h in this.morphAttributes){const u=this.morphAttributes[h],f=[];for(let g=0,m=u.length;g<m;g++){const A=u[g];f.push(A.toJSON(e.data))}f.length>0&&(i[h]=f,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const u in i){const f=i[u];this.setAttribute(u,f.clone(t))}const r=e.morphAttributes;for(const u in r){const f=[],g=r[u];for(let m=0,A=g.length;m<A;m++)f.push(g[m].clone(t));this.morphAttributes[u]=f}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,f=o.length;u<f;u++){const g=o[u];this.addGroup(g.start,g.count,g.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const TR=new fn,Qd=new Vu,Ab=new ec,wl=new q,bl=new q,Cl=new q,yb=new q,_b=new q,vb=new q,j0=new q,q0=new q,X0=new q,Y0=new Xe,J0=new Xe,K0=new Xe,xb=new q,Z0=new q;class _t extends Ft{constructor(e=new Sn,t=new Hi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),Ab.copy(n.boundingSphere),Ab.applyMatrix4(r),e.ray.intersectsSphere(Ab)===!1)||(TR.copy(r).invert(),Qd.copy(e.ray).applyMatrix4(TR),n.boundingBox!==null&&Qd.intersectsBox(n.boundingBox)===!1))return;let o;const l=n.index,h=n.attributes.position,u=n.morphAttributes.position,f=n.morphTargetsRelative,g=n.attributes.uv,m=n.attributes.uv2,A=n.groups,v=n.drawRange;if(l!==null)if(Array.isArray(i))for(let b=0,C=A.length;b<C;b++){const S=A[b],I=i[S.materialIndex],M=Math.max(S.start,v.start),R=Math.min(l.count,Math.min(S.start+S.count,v.start+v.count));for(let T=M,B=R;T<B;T+=3){const F=l.getX(T),D=l.getX(T+1),U=l.getX(T+2);o=$0(this,I,e,Qd,h,u,f,g,m,F,D,U),o&&(o.faceIndex=Math.floor(T/3),o.face.materialIndex=S.materialIndex,t.push(o))}}else{const b=Math.max(0,v.start),C=Math.min(l.count,v.start+v.count);for(let S=b,I=C;S<I;S+=3){const M=l.getX(S),R=l.getX(S+1),T=l.getX(S+2);o=$0(this,i,e,Qd,h,u,f,g,m,M,R,T),o&&(o.faceIndex=Math.floor(S/3),t.push(o))}}else if(h!==void 0)if(Array.isArray(i))for(let b=0,C=A.length;b<C;b++){const S=A[b],I=i[S.materialIndex],M=Math.max(S.start,v.start),R=Math.min(h.count,Math.min(S.start+S.count,v.start+v.count));for(let T=M,B=R;T<B;T+=3){const F=T,D=T+1,U=T+2;o=$0(this,I,e,Qd,h,u,f,g,m,F,D,U),o&&(o.faceIndex=Math.floor(T/3),o.face.materialIndex=S.materialIndex,t.push(o))}}else{const b=Math.max(0,v.start),C=Math.min(h.count,v.start+v.count);for(let S=b,I=C;S<I;S+=3){const M=S,R=S+1,T=S+2;o=$0(this,i,e,Qd,h,u,f,g,m,M,R,T),o&&(o.faceIndex=Math.floor(S/3),t.push(o))}}}}function fW(a,e,t,n,i,r,o,l){let h;if(e.side===Wr?h=n.intersectTriangle(o,r,i,!0,l):h=n.intersectTriangle(i,r,o,e.side!==ir,l),h===null)return null;Z0.copy(l),Z0.applyMatrix4(a.matrixWorld);const u=t.ray.origin.distanceTo(Z0);return u<t.near||u>t.far?null:{distance:u,point:Z0.clone(),object:a}}function $0(a,e,t,n,i,r,o,l,h,u,f,g){wl.fromBufferAttribute(i,u),bl.fromBufferAttribute(i,f),Cl.fromBufferAttribute(i,g);const m=a.morphTargetInfluences;if(r&&m){j0.set(0,0,0),q0.set(0,0,0),X0.set(0,0,0);for(let v=0,b=r.length;v<b;v++){const C=m[v],S=r[v];C!==0&&(yb.fromBufferAttribute(S,u),_b.fromBufferAttribute(S,f),vb.fromBufferAttribute(S,g),o?(j0.addScaledVector(yb,C),q0.addScaledVector(_b,C),X0.addScaledVector(vb,C)):(j0.addScaledVector(yb.sub(wl),C),q0.addScaledVector(_b.sub(bl),C),X0.addScaledVector(vb.sub(Cl),C)))}wl.add(j0),bl.add(q0),Cl.add(X0)}a.isSkinnedMesh&&(a.boneTransform(u,wl),a.boneTransform(f,bl),a.boneTransform(g,Cl));const A=fW(a,e,t,n,wl,bl,Cl,xb);if(A){l&&(Y0.fromBufferAttribute(l,u),J0.fromBufferAttribute(l,f),K0.fromBufferAttribute(l,g),A.uv=ko.getUV(xb,wl,bl,Cl,Y0,J0,K0,new Xe)),h&&(Y0.fromBufferAttribute(h,u),J0.fromBufferAttribute(h,f),K0.fromBufferAttribute(h,g),A.uv2=ko.getUV(xb,wl,bl,Cl,Y0,J0,K0,new Xe));const v={a:u,b:f,c:g,normal:new q,materialIndex:0};ko.getNormal(wl,bl,Cl,v.normal),A.face=v}return A}class zi extends Sn{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const l=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const h=[],u=[],f=[],g=[];let m=0,A=0;v("z","y","x",-1,-1,n,t,e,o,r,0),v("z","y","x",1,-1,n,t,-e,o,r,1),v("x","z","y",1,1,e,n,t,i,o,2),v("x","z","y",1,-1,e,n,-t,i,o,3),v("x","y","z",1,-1,e,t,n,i,r,4),v("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(h),this.setAttribute("position",new tn(u,3)),this.setAttribute("normal",new tn(f,3)),this.setAttribute("uv",new tn(g,2));function v(b,C,S,I,M,R,T,B,F,D,U){const W=R/F,J=T/D,ee=R/2,Q=T/2,Y=B/2,se=F+1,ae=D+1;let ve=0,xe=0;const Ae=new q;for(let Ie=0;Ie<ae;Ie++){const Le=Ie*J-Q;for(let De=0;De<se;De++){const $e=De*W-ee;Ae[b]=$e*I,Ae[C]=Le*M,Ae[S]=Y,u.push(Ae.x,Ae.y,Ae.z),Ae[b]=0,Ae[C]=0,Ae[S]=B>0?1:-1,f.push(Ae.x,Ae.y,Ae.z),g.push(De/F),g.push(1-Ie/D),ve+=1}}for(let Ie=0;Ie<D;Ie++)for(let Le=0;Le<F;Le++){const De=m+Le+se*Ie,$e=m+Le+se*(Ie+1),vt=m+(Le+1)+se*(Ie+1),zt=m+(Le+1)+se*Ie;h.push(De,$e,zt),h.push($e,vt,zt),xe+=6}l.addGroup(A,xe,U),A+=xe,m+=ve}}static fromJSON(e){return new zi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Nf(a){const e={};for(const t in a){e[t]={};for(const n in a[t]){const i=a[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function ur(a){const e={};for(let t=0;t<a.length;t++){const n=Nf(a[t]);for(const i in n)e[i]=n[i]}return e}function pW(a){const e=[];for(let t=0;t<a.length;t++)e.push(a[t].clone());return e}const dS={clone:Nf,merge:ur};var mW=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,gW=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class js extends vs{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=mW,this.fragmentShader=gW,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Nf(e.uniforms),this.uniformsGroups=pW(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class dv extends Ft{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new fn,this.projectionMatrix=new fn,this.projectionMatrixInverse=new fn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ns extends dv{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ag*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ru*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ag*2*Math.atan(Math.tan(Ru*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ru*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const h=o.fullWidth,u=o.fullHeight;r+=o.offsetX*i/h,t-=o.offsetY*n/u,i*=o.width/h,n*=o.height/u}const l=this.filmOffset;l!==0&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const jd=90,qd=1;class U2 extends Ft{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const i=new ns(jd,qd,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new q(1,0,0)),this.add(i);const r=new ns(jd,qd,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new q(-1,0,0)),this.add(r);const o=new ns(jd,qd,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new q(0,1,0)),this.add(o);const l=new ns(jd,qd,e,t);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new q(0,-1,0)),this.add(l);const h=new ns(jd,qd,e,t);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new q(0,0,1)),this.add(h);const u=new ns(jd,qd,e,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new q(0,0,-1)),this.add(u)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,o,l,h,u]=this.children,f=e.getRenderTarget(),g=e.toneMapping,m=e.xr.enabled;e.toneMapping=ma,e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,l),e.setRenderTarget(n,4),e.render(t,h),n.texture.generateMipmaps=A,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(f),e.toneMapping=g,e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}class Lg extends Ii{constructor(e,t,n,i,r,o,l,h,u,f){e=e!==void 0?e:[],t=t!==void 0?t:$l,super(e,t,n,i,r,o,l,h,u,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class fS extends Xr{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new Lg(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:vi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new zi(5,5,5),r=new js({name:"CubemapFromEquirect",uniforms:Nf(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Wr,blending:Vc});r.uniforms.tEquirect.value=t;const o=new _t(i,r),l=t.minFilter;return t.minFilter===va&&(t.minFilter=vi),new U2(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}const wb=new q,AW=new q,yW=new Vr;class Oo{constructor(e=new q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=wb.subVectors(n,t).cross(AW.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(wb),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||yW.getNormalMatrix(e),i=this.coplanarPoint(wb).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Xd=new ec,ey=new q;class fv{constructor(e=new Oo,t=new Oo,n=new Oo,i=new Oo,r=new Oo,o=new Oo){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(n),l[3].copy(i),l[4].copy(r),l[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],l=n[3],h=n[4],u=n[5],f=n[6],g=n[7],m=n[8],A=n[9],v=n[10],b=n[11],C=n[12],S=n[13],I=n[14],M=n[15];return t[0].setComponents(l-i,g-h,b-m,M-C).normalize(),t[1].setComponents(l+i,g+h,b+m,M+C).normalize(),t[2].setComponents(l+r,g+u,b+A,M+S).normalize(),t[3].setComponents(l-r,g-u,b-A,M-S).normalize(),t[4].setComponents(l-o,g-f,b-v,M-I).normalize(),t[5].setComponents(l+o,g+f,b+v,M+I).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Xd.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Xd)}intersectsSprite(e){return Xd.center.set(0,0,0),Xd.radius=.7071067811865476,Xd.applyMatrix4(e.matrixWorld),this.intersectsSphere(Xd)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(ey.x=i.normal.x>0?e.max.x:e.min.x,ey.y=i.normal.y>0?e.max.y:e.min.y,ey.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ey)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function z2(){let a=null,e=!1,t=null,n=null;function i(r,o){t(r,o),n=a.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=a.requestAnimationFrame(i),e=!0)},stop:function(){a.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){a=r}}}function _W(a,e){const t=e.isWebGL2,n=new WeakMap;function i(u,f){const g=u.array,m=u.usage,A=a.createBuffer();a.bindBuffer(f,A),a.bufferData(f,g,m),u.onUploadCallback();let v;if(g instanceof Float32Array)v=5126;else if(g instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(t)v=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=5123;else if(g instanceof Int16Array)v=5122;else if(g instanceof Uint32Array)v=5125;else if(g instanceof Int32Array)v=5124;else if(g instanceof Int8Array)v=5120;else if(g instanceof Uint8Array)v=5121;else if(g instanceof Uint8ClampedArray)v=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:A,type:v,bytesPerElement:g.BYTES_PER_ELEMENT,version:u.version}}function r(u,f,g){const m=f.array,A=f.updateRange;a.bindBuffer(g,u),A.count===-1?a.bufferSubData(g,0,m):(t?a.bufferSubData(g,A.offset*m.BYTES_PER_ELEMENT,m,A.offset,A.count):a.bufferSubData(g,A.offset*m.BYTES_PER_ELEMENT,m.subarray(A.offset,A.offset+A.count)),A.count=-1)}function o(u){return u.isInterleavedBufferAttribute&&(u=u.data),n.get(u)}function l(u){u.isInterleavedBufferAttribute&&(u=u.data);const f=n.get(u);f&&(a.deleteBuffer(f.buffer),n.delete(u))}function h(u,f){if(u.isGLBufferAttribute){const m=n.get(u);(!m||m.version<u.version)&&n.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);const g=n.get(u);g===void 0?n.set(u,i(u,f)):g.version<u.version&&(r(g.buffer,u,f),g.version=u.version)}return{get:o,remove:l,update:h}}class Yr extends Sn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,l=Math.floor(n),h=Math.floor(i),u=l+1,f=h+1,g=e/l,m=t/h,A=[],v=[],b=[],C=[];for(let S=0;S<f;S++){const I=S*m-o;for(let M=0;M<u;M++){const R=M*g-r;v.push(R,-I,0),b.push(0,0,1),C.push(M/l),C.push(1-S/h)}}for(let S=0;S<h;S++)for(let I=0;I<l;I++){const M=I+u*S,R=I+u*(S+1),T=I+1+u*(S+1),B=I+1+u*S;A.push(M,R,B),A.push(R,T,B)}this.setIndex(A),this.setAttribute("position",new tn(v,3)),this.setAttribute("normal",new tn(b,3)),this.setAttribute("uv",new tn(C,2))}static fromJSON(e){return new Yr(e.width,e.height,e.widthSegments,e.heightSegments)}}var vW=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,xW=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wW=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,bW=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,CW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,EW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,SW="vec3 transformed = vec3( position );",MW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,TW=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,IW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,RW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,PW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,BW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,LW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,DW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,OW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,FW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,kW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,NW=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,UW=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,zW=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,GW=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,HW=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,VW=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,WW=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,QW=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,jW="gl_FragColor = linearToOutputTexel( gl_FragColor );",qW=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,XW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,YW=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,JW=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,KW=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,ZW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,$W=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,eQ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,tQ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,nQ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,iQ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,sQ=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,rQ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,oQ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,aQ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,cQ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lQ=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,hQ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,uQ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,dQ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,fQ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,pQ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,mQ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,gQ=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,AQ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,yQ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,_Q=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,vQ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xQ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,wQ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,bQ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,CQ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,EQ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,SQ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,MQ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,TQ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,IQ=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,RQ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,PQ=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,BQ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,LQ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,DQ=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,OQ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,FQ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kQ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,NQ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,UQ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,zQ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,GQ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,HQ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,VQ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,WQ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,QQ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,jQ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,qQ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,XQ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YQ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,JQ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,KQ=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,ZQ=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,$Q=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,e8=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,t8=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,n8=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,i8=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,s8=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,r8=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,o8=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,a8=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,c8=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,l8=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,h8=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,u8=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,d8=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,f8=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,p8=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,m8=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,g8=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,A8=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const y8=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,_8=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,v8=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,x8=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,w8=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,b8=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,C8=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,E8=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,S8=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,M8=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,T8=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,I8=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,R8=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,P8=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,B8=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,L8=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,D8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,O8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,F8=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,k8=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,N8=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,U8=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,z8=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,G8=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,H8=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,V8=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W8=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Q8=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,j8=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,q8=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,X8=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Y8=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,qn={alphamap_fragment:vW,alphamap_pars_fragment:xW,alphatest_fragment:wW,alphatest_pars_fragment:bW,aomap_fragment:CW,aomap_pars_fragment:EW,begin_vertex:SW,beginnormal_vertex:MW,bsdfs:TW,iridescence_fragment:IW,bumpmap_pars_fragment:RW,clipping_planes_fragment:PW,clipping_planes_pars_fragment:BW,clipping_planes_pars_vertex:LW,clipping_planes_vertex:DW,color_fragment:OW,color_pars_fragment:FW,color_pars_vertex:kW,color_vertex:NW,common:UW,cube_uv_reflection_fragment:zW,defaultnormal_vertex:GW,displacementmap_pars_vertex:HW,displacementmap_vertex:VW,emissivemap_fragment:WW,emissivemap_pars_fragment:QW,encodings_fragment:jW,encodings_pars_fragment:qW,envmap_fragment:XW,envmap_common_pars_fragment:YW,envmap_pars_fragment:JW,envmap_pars_vertex:KW,envmap_physical_pars_fragment:lQ,envmap_vertex:ZW,fog_vertex:$W,fog_pars_vertex:eQ,fog_fragment:tQ,fog_pars_fragment:nQ,gradientmap_pars_fragment:iQ,lightmap_fragment:sQ,lightmap_pars_fragment:rQ,lights_lambert_fragment:oQ,lights_lambert_pars_fragment:aQ,lights_pars_begin:cQ,lights_toon_fragment:hQ,lights_toon_pars_fragment:uQ,lights_phong_fragment:dQ,lights_phong_pars_fragment:fQ,lights_physical_fragment:pQ,lights_physical_pars_fragment:mQ,lights_fragment_begin:gQ,lights_fragment_maps:AQ,lights_fragment_end:yQ,logdepthbuf_fragment:_Q,logdepthbuf_pars_fragment:vQ,logdepthbuf_pars_vertex:xQ,logdepthbuf_vertex:wQ,map_fragment:bQ,map_pars_fragment:CQ,map_particle_fragment:EQ,map_particle_pars_fragment:SQ,metalnessmap_fragment:MQ,metalnessmap_pars_fragment:TQ,morphcolor_vertex:IQ,morphnormal_vertex:RQ,morphtarget_pars_vertex:PQ,morphtarget_vertex:BQ,normal_fragment_begin:LQ,normal_fragment_maps:DQ,normal_pars_fragment:OQ,normal_pars_vertex:FQ,normal_vertex:kQ,normalmap_pars_fragment:NQ,clearcoat_normal_fragment_begin:UQ,clearcoat_normal_fragment_maps:zQ,clearcoat_pars_fragment:GQ,iridescence_pars_fragment:HQ,output_fragment:VQ,packing:WQ,premultiplied_alpha_fragment:QQ,project_vertex:jQ,dithering_fragment:qQ,dithering_pars_fragment:XQ,roughnessmap_fragment:YQ,roughnessmap_pars_fragment:JQ,shadowmap_pars_fragment:KQ,shadowmap_pars_vertex:ZQ,shadowmap_vertex:$Q,shadowmask_pars_fragment:e8,skinbase_vertex:t8,skinning_pars_vertex:n8,skinning_vertex:i8,skinnormal_vertex:s8,specularmap_fragment:r8,specularmap_pars_fragment:o8,tonemapping_fragment:a8,tonemapping_pars_fragment:c8,transmission_fragment:l8,transmission_pars_fragment:h8,uv_pars_fragment:u8,uv_pars_vertex:d8,uv_vertex:f8,uv2_pars_fragment:p8,uv2_pars_vertex:m8,uv2_vertex:g8,worldpos_vertex:A8,background_vert:y8,background_frag:_8,cube_vert:v8,cube_frag:x8,depth_vert:w8,depth_frag:b8,distanceRGBA_vert:C8,distanceRGBA_frag:E8,equirect_vert:S8,equirect_frag:M8,linedashed_vert:T8,linedashed_frag:I8,meshbasic_vert:R8,meshbasic_frag:P8,meshlambert_vert:B8,meshlambert_frag:L8,meshmatcap_vert:D8,meshmatcap_frag:O8,meshnormal_vert:F8,meshnormal_frag:k8,meshphong_vert:N8,meshphong_frag:U8,meshphysical_vert:z8,meshphysical_frag:G8,meshtoon_vert:H8,meshtoon_frag:V8,points_vert:W8,points_frag:Q8,shadow_vert:j8,shadow_frag:q8,sprite_vert:X8,sprite_frag:Y8},Vt={common:{diffuse:{value:new ye(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vr},uv2Transform:{value:new Vr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Xe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ye(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ye(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vr}},sprite:{diffuse:{value:new ye(16777215)},opacity:{value:1},center:{value:new Xe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vr}}},ca={basic:{uniforms:ur([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.fog]),vertexShader:qn.meshbasic_vert,fragmentShader:qn.meshbasic_frag},lambert:{uniforms:ur([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new ye(0)}}]),vertexShader:qn.meshlambert_vert,fragmentShader:qn.meshlambert_frag},phong:{uniforms:ur([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new ye(0)},specular:{value:new ye(1118481)},shininess:{value:30}}]),vertexShader:qn.meshphong_vert,fragmentShader:qn.meshphong_frag},standard:{uniforms:ur([Vt.common,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.roughnessmap,Vt.metalnessmap,Vt.fog,Vt.lights,{emissive:{value:new ye(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qn.meshphysical_vert,fragmentShader:qn.meshphysical_frag},toon:{uniforms:ur([Vt.common,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.gradientmap,Vt.fog,Vt.lights,{emissive:{value:new ye(0)}}]),vertexShader:qn.meshtoon_vert,fragmentShader:qn.meshtoon_frag},matcap:{uniforms:ur([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,{matcap:{value:null}}]),vertexShader:qn.meshmatcap_vert,fragmentShader:qn.meshmatcap_frag},points:{uniforms:ur([Vt.points,Vt.fog]),vertexShader:qn.points_vert,fragmentShader:qn.points_frag},dashed:{uniforms:ur([Vt.common,Vt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qn.linedashed_vert,fragmentShader:qn.linedashed_frag},depth:{uniforms:ur([Vt.common,Vt.displacementmap]),vertexShader:qn.depth_vert,fragmentShader:qn.depth_frag},normal:{uniforms:ur([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,{opacity:{value:1}}]),vertexShader:qn.meshnormal_vert,fragmentShader:qn.meshnormal_frag},sprite:{uniforms:ur([Vt.sprite,Vt.fog]),vertexShader:qn.sprite_vert,fragmentShader:qn.sprite_frag},background:{uniforms:{uvTransform:{value:new Vr},t2D:{value:null}},vertexShader:qn.background_vert,fragmentShader:qn.background_frag},cube:{uniforms:ur([Vt.envmap,{opacity:{value:1}}]),vertexShader:qn.cube_vert,fragmentShader:qn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qn.equirect_vert,fragmentShader:qn.equirect_frag},distanceRGBA:{uniforms:ur([Vt.common,Vt.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qn.distanceRGBA_vert,fragmentShader:qn.distanceRGBA_frag},shadow:{uniforms:ur([Vt.lights,Vt.fog,{color:{value:new ye(0)},opacity:{value:1}}]),vertexShader:qn.shadow_vert,fragmentShader:qn.shadow_frag}};ca.physical={uniforms:ur([ca.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Xe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new ye(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Xe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ye(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ye(1,1,1)},specularColorMap:{value:null}}]),vertexShader:qn.meshphysical_vert,fragmentShader:qn.meshphysical_frag};function J8(a,e,t,n,i,r){const o=new ye(0);let l=i===!0?0:1,h,u,f=null,g=0,m=null;function A(b,C){let S=!1,I=C.isScene===!0?C.background:null;I&&I.isTexture&&(I=e.get(I));const M=a.xr,R=M.getSession&&M.getSession();R&&R.environmentBlendMode==="additive"&&(I=null),I===null?v(o,l):I&&I.isColor&&(v(I,1),S=!0),(a.autoClear||S)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),I&&(I.isCubeTexture||I.mapping===jf)?(u===void 0&&(u=new _t(new zi(1,1,1),new js({name:"BackgroundCubeMaterial",uniforms:Nf(ca.cube.uniforms),vertexShader:ca.cube.vertexShader,fragmentShader:ca.cube.fragmentShader,side:Wr,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,B,F){this.matrixWorld.copyPosition(F.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=I,u.material.uniforms.flipEnvMap.value=I.isCubeTexture&&I.isRenderTargetTexture===!1?-1:1,(f!==I||g!==I.version||m!==a.toneMapping)&&(u.material.needsUpdate=!0,f=I,g=I.version,m=a.toneMapping),u.layers.enableAll(),b.unshift(u,u.geometry,u.material,0,0,null)):I&&I.isTexture&&(h===void 0&&(h=new _t(new Yr(2,2),new js({name:"BackgroundMaterial",uniforms:Nf(ca.background.uniforms),vertexShader:ca.background.vertexShader,fragmentShader:ca.background.fragmentShader,side:zo,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(h)),h.material.uniforms.t2D.value=I,I.matrixAutoUpdate===!0&&I.updateMatrix(),h.material.uniforms.uvTransform.value.copy(I.matrix),(f!==I||g!==I.version||m!==a.toneMapping)&&(h.material.needsUpdate=!0,f=I,g=I.version,m=a.toneMapping),h.layers.enableAll(),b.unshift(h,h.geometry,h.material,0,0,null))}function v(b,C){t.buffers.color.setClear(b.r,b.g,b.b,C,r)}return{getClearColor:function(){return o},setClearColor:function(b,C=1){o.set(b),l=C,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(b){l=b,v(o,l)},render:A}}function K8(a,e,t,n){const i=a.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||r!==null,l={},h=C(null);let u=h,f=!1;function g(Y,se,ae,ve,xe){let Ae=!1;if(o){const Ie=b(ve,ae,se);u!==Ie&&(u=Ie,A(u.object)),Ae=S(Y,ve,ae,xe),Ae&&I(Y,ve,ae,xe)}else{const Ie=se.wireframe===!0;(u.geometry!==ve.id||u.program!==ae.id||u.wireframe!==Ie)&&(u.geometry=ve.id,u.program=ae.id,u.wireframe=Ie,Ae=!0)}xe!==null&&t.update(xe,34963),(Ae||f)&&(f=!1,D(Y,se,ae,ve),xe!==null&&a.bindBuffer(34963,t.get(xe).buffer))}function m(){return n.isWebGL2?a.createVertexArray():r.createVertexArrayOES()}function A(Y){return n.isWebGL2?a.bindVertexArray(Y):r.bindVertexArrayOES(Y)}function v(Y){return n.isWebGL2?a.deleteVertexArray(Y):r.deleteVertexArrayOES(Y)}function b(Y,se,ae){const ve=ae.wireframe===!0;let xe=l[Y.id];xe===void 0&&(xe={},l[Y.id]=xe);let Ae=xe[se.id];Ae===void 0&&(Ae={},xe[se.id]=Ae);let Ie=Ae[ve];return Ie===void 0&&(Ie=C(m()),Ae[ve]=Ie),Ie}function C(Y){const se=[],ae=[],ve=[];for(let xe=0;xe<i;xe++)se[xe]=0,ae[xe]=0,ve[xe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:se,enabledAttributes:ae,attributeDivisors:ve,object:Y,attributes:{},index:null}}function S(Y,se,ae,ve){const xe=u.attributes,Ae=se.attributes;let Ie=0;const Le=ae.getAttributes();for(const De in Le)if(Le[De].location>=0){const vt=xe[De];let zt=Ae[De];if(zt===void 0&&(De==="instanceMatrix"&&Y.instanceMatrix&&(zt=Y.instanceMatrix),De==="instanceColor"&&Y.instanceColor&&(zt=Y.instanceColor)),vt===void 0||vt.attribute!==zt||zt&&vt.data!==zt.data)return!0;Ie++}return u.attributesNum!==Ie||u.index!==ve}function I(Y,se,ae,ve){const xe={},Ae=se.attributes;let Ie=0;const Le=ae.getAttributes();for(const De in Le)if(Le[De].location>=0){let vt=Ae[De];vt===void 0&&(De==="instanceMatrix"&&Y.instanceMatrix&&(vt=Y.instanceMatrix),De==="instanceColor"&&Y.instanceColor&&(vt=Y.instanceColor));const zt={};zt.attribute=vt,vt&&vt.data&&(zt.data=vt.data),xe[De]=zt,Ie++}u.attributes=xe,u.attributesNum=Ie,u.index=ve}function M(){const Y=u.newAttributes;for(let se=0,ae=Y.length;se<ae;se++)Y[se]=0}function R(Y){T(Y,0)}function T(Y,se){const ae=u.newAttributes,ve=u.enabledAttributes,xe=u.attributeDivisors;ae[Y]=1,ve[Y]===0&&(a.enableVertexAttribArray(Y),ve[Y]=1),xe[Y]!==se&&((n.isWebGL2?a:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Y,se),xe[Y]=se)}function B(){const Y=u.newAttributes,se=u.enabledAttributes;for(let ae=0,ve=se.length;ae<ve;ae++)se[ae]!==Y[ae]&&(a.disableVertexAttribArray(ae),se[ae]=0)}function F(Y,se,ae,ve,xe,Ae){n.isWebGL2===!0&&(ae===5124||ae===5125)?a.vertexAttribIPointer(Y,se,ae,xe,Ae):a.vertexAttribPointer(Y,se,ae,ve,xe,Ae)}function D(Y,se,ae,ve){if(n.isWebGL2===!1&&(Y.isInstancedMesh||ve.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;M();const xe=ve.attributes,Ae=ae.getAttributes(),Ie=se.defaultAttributeValues;for(const Le in Ae){const De=Ae[Le];if(De.location>=0){let $e=xe[Le];if($e===void 0&&(Le==="instanceMatrix"&&Y.instanceMatrix&&($e=Y.instanceMatrix),Le==="instanceColor"&&Y.instanceColor&&($e=Y.instanceColor)),$e!==void 0){const vt=$e.normalized,zt=$e.itemSize,Ve=t.get($e);if(Ve===void 0)continue;const gn=Ve.buffer,Xt=Ve.type,mn=Ve.bytesPerElement;if($e.isInterleavedBufferAttribute){const Nt=$e.data,vn=Nt.stride,it=$e.offset;if(Nt.isInstancedInterleavedBuffer){for(let tt=0;tt<De.locationSize;tt++)T(De.location+tt,Nt.meshPerAttribute);Y.isInstancedMesh!==!0&&ve._maxInstanceCount===void 0&&(ve._maxInstanceCount=Nt.meshPerAttribute*Nt.count)}else for(let tt=0;tt<De.locationSize;tt++)R(De.location+tt);a.bindBuffer(34962,gn);for(let tt=0;tt<De.locationSize;tt++)F(De.location+tt,zt/De.locationSize,Xt,vt,vn*mn,(it+zt/De.locationSize*tt)*mn)}else{if($e.isInstancedBufferAttribute){for(let Nt=0;Nt<De.locationSize;Nt++)T(De.location+Nt,$e.meshPerAttribute);Y.isInstancedMesh!==!0&&ve._maxInstanceCount===void 0&&(ve._maxInstanceCount=$e.meshPerAttribute*$e.count)}else for(let Nt=0;Nt<De.locationSize;Nt++)R(De.location+Nt);a.bindBuffer(34962,gn);for(let Nt=0;Nt<De.locationSize;Nt++)F(De.location+Nt,zt/De.locationSize,Xt,vt,zt*mn,zt/De.locationSize*Nt*mn)}}else if(Ie!==void 0){const vt=Ie[Le];if(vt!==void 0)switch(vt.length){case 2:a.vertexAttrib2fv(De.location,vt);break;case 3:a.vertexAttrib3fv(De.location,vt);break;case 4:a.vertexAttrib4fv(De.location,vt);break;default:a.vertexAttrib1fv(De.location,vt)}}}}B()}function U(){ee();for(const Y in l){const se=l[Y];for(const ae in se){const ve=se[ae];for(const xe in ve)v(ve[xe].object),delete ve[xe];delete se[ae]}delete l[Y]}}function W(Y){if(l[Y.id]===void 0)return;const se=l[Y.id];for(const ae in se){const ve=se[ae];for(const xe in ve)v(ve[xe].object),delete ve[xe];delete se[ae]}delete l[Y.id]}function J(Y){for(const se in l){const ae=l[se];if(ae[Y.id]===void 0)continue;const ve=ae[Y.id];for(const xe in ve)v(ve[xe].object),delete ve[xe];delete ae[Y.id]}}function ee(){Q(),f=!0,u!==h&&(u=h,A(u.object))}function Q(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:g,reset:ee,resetDefaultState:Q,dispose:U,releaseStatesOfGeometry:W,releaseStatesOfProgram:J,initAttributes:M,enableAttribute:R,disableUnusedAttributes:B}}function Z8(a,e,t,n){const i=n.isWebGL2;let r;function o(u){r=u}function l(u,f){a.drawArrays(r,u,f),t.update(f,r,1)}function h(u,f,g){if(g===0)return;let m,A;if(i)m=a,A="drawArraysInstanced";else if(m=e.get("ANGLE_instanced_arrays"),A="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[A](r,u,f,g),t.update(f,r,g)}this.setMode=o,this.render=l,this.renderInstances=h}function $8(a,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const F=e.get("EXT_texture_filter_anisotropic");n=a.getParameter(F.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(F){if(F==="highp"){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";F="mediump"}return F==="mediump"&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&a instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&a instanceof WebGL2ComputeRenderingContext;let l=t.precision!==void 0?t.precision:"highp";const h=r(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);const u=o||e.has("WEBGL_draw_buffers"),f=t.logarithmicDepthBuffer===!0,g=a.getParameter(34930),m=a.getParameter(35660),A=a.getParameter(3379),v=a.getParameter(34076),b=a.getParameter(34921),C=a.getParameter(36347),S=a.getParameter(36348),I=a.getParameter(36349),M=m>0,R=o||e.has("OES_texture_float"),T=M&&R,B=o?a.getParameter(36183):0;return{isWebGL2:o,drawBuffers:u,getMaxAnisotropy:i,getMaxPrecision:r,precision:l,logarithmicDepthBuffer:f,maxTextures:g,maxVertexTextures:m,maxTextureSize:A,maxCubemapSize:v,maxAttributes:b,maxVertexUniforms:C,maxVaryings:S,maxFragmentUniforms:I,vertexTextures:M,floatFragmentTextures:R,floatVertexTextures:T,maxSamples:B}}function e6(a){const e=this;let t=null,n=0,i=!1,r=!1;const o=new Oo,l=new Vr,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(g,m,A){const v=g.length!==0||m||n!==0||i;return i=m,t=f(g,A,0),n=g.length,v},this.beginShadows=function(){r=!0,f(null)},this.endShadows=function(){r=!1,u()},this.setState=function(g,m,A){const v=g.clippingPlanes,b=g.clipIntersection,C=g.clipShadows,S=a.get(g);if(!i||v===null||v.length===0||r&&!C)r?f(null):u();else{const I=r?0:n,M=I*4;let R=S.clippingState||null;h.value=R,R=f(v,m,M,A);for(let T=0;T!==M;++T)R[T]=t[T];S.clippingState=R,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=I}};function u(){h.value!==t&&(h.value=t,h.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function f(g,m,A,v){const b=g!==null?g.length:0;let C=null;if(b!==0){if(C=h.value,v!==!0||C===null){const S=A+b*4,I=m.matrixWorldInverse;l.getNormalMatrix(I),(C===null||C.length<S)&&(C=new Float32Array(S));for(let M=0,R=A;M!==b;++M,R+=4)o.copy(g[M]).applyMatrix4(I,l),o.normal.toArray(C,R),C[R+3]=o.constant}h.value=C,h.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,C}}function t6(a){let e=new WeakMap;function t(o,l){return l===Qa?o.mapping=$l:l===Of&&(o.mapping=eh),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const l=o.mapping;if(l===Qa||l===Of)if(e.has(o)){const h=e.get(o).texture;return t(h,o.mapping)}else{const h=o.image;if(h&&h.height>0){const u=new fS(h.height/2);return u.fromEquirectangularTexture(a,o),e.set(o,u),o.addEventListener("dispose",i),t(u.texture,o.mapping)}else return null}}return o}function i(o){const l=o.target;l.removeEventListener("dispose",i);const h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}class lh extends dv{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,l=i+t,h=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=u*this.view.offsetX,o=r+u*this.view.width,l-=f*this.view.offsetY,h=l-f*this.view.height}this.projectionMatrix.makeOrthographic(r,o,l,h,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const yf=4,IR=[.125,.215,.35,.446,.526,.582],gu=20,bb=new lh,RR=new ye;let Cb=null;const lu=(1+Math.sqrt(5))/2,Yd=1/lu,PR=[new q(1,1,1),new q(-1,1,1),new q(1,1,-1),new q(-1,1,-1),new q(0,lu,Yd),new q(0,lu,-Yd),new q(Yd,0,lu),new q(-Yd,0,lu),new q(lu,Yd,0),new q(-lu,Yd,0)];class eE{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Cb=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=DR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=LR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Cb),e.scissorTest=!1,ty(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===$l||e.mapping===eh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Cb=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:Fs,format:ds,encoding:Ar,depthBuffer:!1},i=BR(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=BR(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=n6(r)),this._blurMaterial=i6(r,e,t)}return i}_compileMaterial(e){const t=new _t(this._lodPlanes[0],e);this._renderer.compile(t,bb)}_sceneToCubeUV(e,t,n,i){const l=new ns(90,1,t,n),h=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],f=this._renderer,g=f.autoClear,m=f.toneMapping;f.getClearColor(RR),f.toneMapping=ma,f.autoClear=!1;const A=new Hi({name:"PMREM.Background",side:Wr,depthWrite:!1,depthTest:!1}),v=new _t(new zi,A);let b=!1;const C=e.background;C?C.isColor&&(A.color.copy(C),e.background=null,b=!0):(A.color.copy(RR),b=!0);for(let S=0;S<6;S++){const I=S%3;I===0?(l.up.set(0,h[S],0),l.lookAt(u[S],0,0)):I===1?(l.up.set(0,0,h[S]),l.lookAt(0,u[S],0)):(l.up.set(0,h[S],0),l.lookAt(0,0,u[S]));const M=this._cubeSize;ty(i,I*M,S>2?M:0,M,M),f.setRenderTarget(i),b&&f.render(v,l),f.render(e,l)}v.geometry.dispose(),v.material.dispose(),f.toneMapping=m,f.autoClear=g,e.background=C}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===$l||e.mapping===eh;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=DR()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=LR());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new _t(this._lodPlanes[0],r),l=r.uniforms;l.envMap.value=e;const h=this._cubeSize;ty(t,0,0,3*h,2*h),n.setRenderTarget(t),n.render(o,bb)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=PR[(i-1)%PR.length];this._blur(e,i-1,i,r,o)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,l){const h=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,g=new _t(this._lodPlanes[i],u),m=u.uniforms,A=this._sizeLods[n]-1,v=isFinite(r)?Math.PI/(2*A):2*Math.PI/(2*gu-1),b=r/v,C=isFinite(r)?1+Math.floor(f*b):gu;C>gu&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${C} samples when the maximum is set to ${gu}`);const S=[];let I=0;for(let F=0;F<gu;++F){const D=F/b,U=Math.exp(-D*D/2);S.push(U),F===0?I+=U:F<C&&(I+=2*U)}for(let F=0;F<S.length;F++)S[F]=S[F]/I;m.envMap.value=e.texture,m.samples.value=C,m.weights.value=S,m.latitudinal.value=o==="latitudinal",l&&(m.poleAxis.value=l);const{_lodMax:M}=this;m.dTheta.value=v,m.mipInt.value=M-n;const R=this._sizeLods[i],T=3*R*(i>M-yf?i-M+yf:0),B=4*(this._cubeSize-R);ty(t,T,B,3*R,2*R),h.setRenderTarget(t),h.render(g,bb)}}function n6(a){const e=[],t=[],n=[];let i=a;const r=a-yf+1+IR.length;for(let o=0;o<r;o++){const l=Math.pow(2,i);t.push(l);let h=1/l;o>a-yf?h=IR[o-a+yf-1]:o===0&&(h=0),n.push(h);const u=1/(l-2),f=-u,g=1+u,m=[f,f,g,f,g,g,f,f,g,g,f,g],A=6,v=6,b=3,C=2,S=1,I=new Float32Array(b*v*A),M=new Float32Array(C*v*A),R=new Float32Array(S*v*A);for(let B=0;B<A;B++){const F=B%3*2/3-1,D=B>2?0:-1,U=[F,D,0,F+2/3,D,0,F+2/3,D+1,0,F,D,0,F+2/3,D+1,0,F,D+1,0];I.set(U,b*v*B),M.set(m,C*v*B);const W=[B,B,B,B,B,B];R.set(W,S*v*B)}const T=new Sn;T.setAttribute("position",new Jn(I,b)),T.setAttribute("uv",new Jn(M,C)),T.setAttribute("faceIndex",new Jn(R,S)),e.push(T),i>yf&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function BR(a,e,t){const n=new Xr(a,e,t);return n.texture.mapping=jf,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function ty(a,e,t,n,i){a.viewport.set(e,t,n,i),a.scissor.set(e,t,n,i)}function i6(a,e,t){const n=new Float32Array(gu),i=new q(0,1,0);return new js({name:"SphericalGaussianBlur",defines:{n:gu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${a}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:pS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Vc,depthTest:!1,depthWrite:!1})}function LR(){return new js({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:pS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Vc,depthTest:!1,depthWrite:!1})}function DR(){return new js({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:pS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Vc,depthTest:!1,depthWrite:!1})}function pS(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function s6(a){let e=new WeakMap,t=null;function n(l){if(l&&l.isTexture){const h=l.mapping,u=h===Qa||h===Of,f=h===$l||h===eh;if(u||f)if(l.isRenderTargetTexture&&l.needsPMREMUpdate===!0){l.needsPMREMUpdate=!1;let g=e.get(l);return t===null&&(t=new eE(a)),g=u?t.fromEquirectangular(l,g):t.fromCubemap(l,g),e.set(l,g),g.texture}else{if(e.has(l))return e.get(l).texture;{const g=l.image;if(u&&g&&g.height>0||f&&g&&i(g)){t===null&&(t=new eE(a));const m=u?t.fromEquirectangular(l):t.fromCubemap(l);return e.set(l,m),l.addEventListener("dispose",r),m.texture}else return null}}}return l}function i(l){let h=0;const u=6;for(let f=0;f<u;f++)l[f]!==void 0&&h++;return h===u}function r(l){const h=l.target;h.removeEventListener("dispose",r);const u=e.get(h);u!==void 0&&(e.delete(h),u.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function r6(a){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=a.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function o6(a,e,t,n){const i={},r=new WeakMap;function o(g){const m=g.target;m.index!==null&&e.remove(m.index);for(const v in m.attributes)e.remove(m.attributes[v]);m.removeEventListener("dispose",o),delete i[m.id];const A=r.get(m);A&&(e.remove(A),r.delete(m)),n.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function l(g,m){return i[m.id]===!0||(m.addEventListener("dispose",o),i[m.id]=!0,t.memory.geometries++),m}function h(g){const m=g.attributes;for(const v in m)e.update(m[v],34962);const A=g.morphAttributes;for(const v in A){const b=A[v];for(let C=0,S=b.length;C<S;C++)e.update(b[C],34962)}}function u(g){const m=[],A=g.index,v=g.attributes.position;let b=0;if(A!==null){const I=A.array;b=A.version;for(let M=0,R=I.length;M<R;M+=3){const T=I[M+0],B=I[M+1],F=I[M+2];m.push(T,B,B,F,F,T)}}else{const I=v.array;b=v.version;for(let M=0,R=I.length/3-1;M<R;M+=3){const T=M+0,B=M+1,F=M+2;m.push(T,B,B,F,F,T)}}const C=new(k2(m)?uS:hS)(m,1);C.version=b;const S=r.get(g);S&&e.remove(S),r.set(g,C)}function f(g){const m=r.get(g);if(m){const A=g.index;A!==null&&m.version<A.version&&u(g)}else u(g);return r.get(g)}return{get:l,update:h,getWireframeAttribute:f}}function a6(a,e,t,n){const i=n.isWebGL2;let r;function o(m){r=m}let l,h;function u(m){l=m.type,h=m.bytesPerElement}function f(m,A){a.drawElements(r,A,l,m*h),t.update(A,r,1)}function g(m,A,v){if(v===0)return;let b,C;if(i)b=a,C="drawElementsInstanced";else if(b=e.get("ANGLE_instanced_arrays"),C="drawElementsInstancedANGLE",b===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[C](r,A,l,m*h,v),t.update(A,r,v)}this.setMode=o,this.setIndex=u,this.render=f,this.renderInstances=g}function c6(a){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,l){switch(t.calls++,o){case 4:t.triangles+=l*(r/3);break;case 1:t.lines+=l*(r/2);break;case 3:t.lines+=l*(r-1);break;case 2:t.lines+=l*r;break;case 0:t.points+=l*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function l6(a,e){return a[0]-e[0]}function h6(a,e){return Math.abs(e[1])-Math.abs(a[1])}function u6(a,e,t){const n={},i=new Float32Array(8),r=new WeakMap,o=new Bn,l=[];for(let u=0;u<8;u++)l[u]=[u,0];function h(u,f,g,m){const A=u.morphTargetInfluences;if(e.isWebGL2===!0){const b=f.morphAttributes.position||f.morphAttributes.normal||f.morphAttributes.color,C=b!==void 0?b.length:0;let S=r.get(f);if(S===void 0||S.count!==C){let ae=function(){Y.dispose(),r.delete(f),f.removeEventListener("dispose",ae)};var v=ae;S!==void 0&&S.texture.dispose();const R=f.morphAttributes.position!==void 0,T=f.morphAttributes.normal!==void 0,B=f.morphAttributes.color!==void 0,F=f.morphAttributes.position||[],D=f.morphAttributes.normal||[],U=f.morphAttributes.color||[];let W=0;R===!0&&(W=1),T===!0&&(W=2),B===!0&&(W=3);let J=f.attributes.position.count*W,ee=1;J>e.maxTextureSize&&(ee=Math.ceil(J/e.maxTextureSize),J=e.maxTextureSize);const Q=new Float32Array(J*ee*4*C),Y=new Pg(Q,J,ee,C);Y.type=Ms,Y.needsUpdate=!0;const se=W*4;for(let ve=0;ve<C;ve++){const xe=F[ve],Ae=D[ve],Ie=U[ve],Le=J*ee*4*ve;for(let De=0;De<xe.count;De++){const $e=De*se;R===!0&&(o.fromBufferAttribute(xe,De),Q[Le+$e+0]=o.x,Q[Le+$e+1]=o.y,Q[Le+$e+2]=o.z,Q[Le+$e+3]=0),T===!0&&(o.fromBufferAttribute(Ae,De),Q[Le+$e+4]=o.x,Q[Le+$e+5]=o.y,Q[Le+$e+6]=o.z,Q[Le+$e+7]=0),B===!0&&(o.fromBufferAttribute(Ie,De),Q[Le+$e+8]=o.x,Q[Le+$e+9]=o.y,Q[Le+$e+10]=o.z,Q[Le+$e+11]=Ie.itemSize===4?o.w:1)}}S={count:C,texture:Y,size:new Xe(J,ee)},r.set(f,S),f.addEventListener("dispose",ae)}let I=0;for(let R=0;R<A.length;R++)I+=A[R];const M=f.morphTargetsRelative?1:1-I;m.getUniforms().setValue(a,"morphTargetBaseInfluence",M),m.getUniforms().setValue(a,"morphTargetInfluences",A),m.getUniforms().setValue(a,"morphTargetsTexture",S.texture,t),m.getUniforms().setValue(a,"morphTargetsTextureSize",S.size)}else{const b=A===void 0?0:A.length;let C=n[f.id];if(C===void 0||C.length!==b){C=[];for(let T=0;T<b;T++)C[T]=[T,0];n[f.id]=C}for(let T=0;T<b;T++){const B=C[T];B[0]=T,B[1]=A[T]}C.sort(h6);for(let T=0;T<8;T++)T<b&&C[T][1]?(l[T][0]=C[T][0],l[T][1]=C[T][1]):(l[T][0]=Number.MAX_SAFE_INTEGER,l[T][1]=0);l.sort(l6);const S=f.morphAttributes.position,I=f.morphAttributes.normal;let M=0;for(let T=0;T<8;T++){const B=l[T],F=B[0],D=B[1];F!==Number.MAX_SAFE_INTEGER&&D?(S&&f.getAttribute("morphTarget"+T)!==S[F]&&f.setAttribute("morphTarget"+T,S[F]),I&&f.getAttribute("morphNormal"+T)!==I[F]&&f.setAttribute("morphNormal"+T,I[F]),i[T]=D,M+=D):(S&&f.hasAttribute("morphTarget"+T)===!0&&f.deleteAttribute("morphTarget"+T),I&&f.hasAttribute("morphNormal"+T)===!0&&f.deleteAttribute("morphNormal"+T),i[T]=0)}const R=f.morphTargetsRelative?1:1-M;m.getUniforms().setValue(a,"morphTargetBaseInfluence",R),m.getUniforms().setValue(a,"morphTargetInfluences",i)}}return{update:h}}function d6(a,e,t,n){let i=new WeakMap;function r(h){const u=n.render.frame,f=h.geometry,g=e.get(h,f);return i.get(g)!==u&&(e.update(g),i.set(g,u)),h.isInstancedMesh&&(h.hasEventListener("dispose",l)===!1&&h.addEventListener("dispose",l),t.update(h.instanceMatrix,34962),h.instanceColor!==null&&t.update(h.instanceColor,34962)),g}function o(){i=new WeakMap}function l(h){const u=h.target;u.removeEventListener("dispose",l),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:r,dispose:o}}const G2=new Ii,H2=new Pg,V2=new Bg,W2=new Lg,OR=[],FR=[],kR=new Float32Array(16),NR=new Float32Array(9),UR=new Float32Array(4);function qf(a,e,t){const n=a[0];if(n<=0||n>0)return a;const i=e*t;let r=OR[i];if(r===void 0&&(r=new Float32Array(i),OR[i]=r),e!==0){n.toArray(r,0);for(let o=1,l=0;o!==e;++o)l+=t,a[o].toArray(r,l)}return r}function Ns(a,e){if(a.length!==e.length)return!1;for(let t=0,n=a.length;t<n;t++)if(a[t]!==e[t])return!1;return!0}function Us(a,e){for(let t=0,n=e.length;t<n;t++)a[t]=e[t]}function pv(a,e){let t=FR[e];t===void 0&&(t=new Int32Array(e),FR[e]=t);for(let n=0;n!==e;++n)t[n]=a.allocateTextureUnit();return t}function f6(a,e){const t=this.cache;t[0]!==e&&(a.uniform1f(this.addr,e),t[0]=e)}function p6(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ns(t,e))return;a.uniform2fv(this.addr,e),Us(t,e)}}function m6(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(a.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ns(t,e))return;a.uniform3fv(this.addr,e),Us(t,e)}}function g6(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ns(t,e))return;a.uniform4fv(this.addr,e),Us(t,e)}}function A6(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ns(t,e))return;a.uniformMatrix2fv(this.addr,!1,e),Us(t,e)}else{if(Ns(t,n))return;UR.set(n),a.uniformMatrix2fv(this.addr,!1,UR),Us(t,n)}}function y6(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ns(t,e))return;a.uniformMatrix3fv(this.addr,!1,e),Us(t,e)}else{if(Ns(t,n))return;NR.set(n),a.uniformMatrix3fv(this.addr,!1,NR),Us(t,n)}}function _6(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ns(t,e))return;a.uniformMatrix4fv(this.addr,!1,e),Us(t,e)}else{if(Ns(t,n))return;kR.set(n),a.uniformMatrix4fv(this.addr,!1,kR),Us(t,n)}}function v6(a,e){const t=this.cache;t[0]!==e&&(a.uniform1i(this.addr,e),t[0]=e)}function x6(a,e){const t=this.cache;Ns(t,e)||(a.uniform2iv(this.addr,e),Us(t,e))}function w6(a,e){const t=this.cache;Ns(t,e)||(a.uniform3iv(this.addr,e),Us(t,e))}function b6(a,e){const t=this.cache;Ns(t,e)||(a.uniform4iv(this.addr,e),Us(t,e))}function C6(a,e){const t=this.cache;t[0]!==e&&(a.uniform1ui(this.addr,e),t[0]=e)}function E6(a,e){const t=this.cache;Ns(t,e)||(a.uniform2uiv(this.addr,e),Us(t,e))}function S6(a,e){const t=this.cache;Ns(t,e)||(a.uniform3uiv(this.addr,e),Us(t,e))}function M6(a,e){const t=this.cache;Ns(t,e)||(a.uniform4uiv(this.addr,e),Us(t,e))}function T6(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture2D(e||G2,i)}function I6(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||V2,i)}function R6(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||W2,i)}function P6(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||H2,i)}function B6(a){switch(a){case 5126:return f6;case 35664:return p6;case 35665:return m6;case 35666:return g6;case 35674:return A6;case 35675:return y6;case 35676:return _6;case 5124:case 35670:return v6;case 35667:case 35671:return x6;case 35668:case 35672:return w6;case 35669:case 35673:return b6;case 5125:return C6;case 36294:return E6;case 36295:return S6;case 36296:return M6;case 35678:case 36198:case 36298:case 36306:case 35682:return T6;case 35679:case 36299:case 36307:return I6;case 35680:case 36300:case 36308:case 36293:return R6;case 36289:case 36303:case 36311:case 36292:return P6}}function L6(a,e){a.uniform1fv(this.addr,e)}function D6(a,e){const t=qf(e,this.size,2);a.uniform2fv(this.addr,t)}function O6(a,e){const t=qf(e,this.size,3);a.uniform3fv(this.addr,t)}function F6(a,e){const t=qf(e,this.size,4);a.uniform4fv(this.addr,t)}function k6(a,e){const t=qf(e,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function N6(a,e){const t=qf(e,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function U6(a,e){const t=qf(e,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function z6(a,e){a.uniform1iv(this.addr,e)}function G6(a,e){a.uniform2iv(this.addr,e)}function H6(a,e){a.uniform3iv(this.addr,e)}function V6(a,e){a.uniform4iv(this.addr,e)}function W6(a,e){a.uniform1uiv(this.addr,e)}function Q6(a,e){a.uniform2uiv(this.addr,e)}function j6(a,e){a.uniform3uiv(this.addr,e)}function q6(a,e){a.uniform4uiv(this.addr,e)}function X6(a,e,t){const n=this.cache,i=e.length,r=pv(t,i);Ns(n,r)||(a.uniform1iv(this.addr,r),Us(n,r));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||G2,r[o])}function Y6(a,e,t){const n=this.cache,i=e.length,r=pv(t,i);Ns(n,r)||(a.uniform1iv(this.addr,r),Us(n,r));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||V2,r[o])}function J6(a,e,t){const n=this.cache,i=e.length,r=pv(t,i);Ns(n,r)||(a.uniform1iv(this.addr,r),Us(n,r));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||W2,r[o])}function K6(a,e,t){const n=this.cache,i=e.length,r=pv(t,i);Ns(n,r)||(a.uniform1iv(this.addr,r),Us(n,r));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||H2,r[o])}function Z6(a){switch(a){case 5126:return L6;case 35664:return D6;case 35665:return O6;case 35666:return F6;case 35674:return k6;case 35675:return N6;case 35676:return U6;case 5124:case 35670:return z6;case 35667:case 35671:return G6;case 35668:case 35672:return H6;case 35669:case 35673:return V6;case 5125:return W6;case 36294:return Q6;case 36295:return j6;case 36296:return q6;case 35678:case 36198:case 36298:case 36306:case 35682:return X6;case 35679:case 36299:case 36307:return Y6;case 35680:case 36300:case 36308:case 36293:return J6;case 36289:case 36303:case 36311:case 36292:return K6}}class $6{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=B6(t.type)}}class ej{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=Z6(t.type)}}class tj{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const l=i[r];l.setValue(e,t[l.id],n)}}}const Eb=/(\w+)(\])?(\[|\.)?/g;function zR(a,e){a.seq.push(e),a.map[e.id]=e}function nj(a,e,t){const n=a.name,i=n.length;for(Eb.lastIndex=0;;){const r=Eb.exec(n),o=Eb.lastIndex;let l=r[1];const h=r[2]==="]",u=r[3];if(h&&(l=l|0),u===void 0||u==="["&&o+2===i){zR(t,u===void 0?new $6(l,a,e):new ej(l,a,e));break}else{let g=t.map[l];g===void 0&&(g=new tj(l),zR(t,g)),t=g}}}class Jy{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const r=e.getActiveUniform(t,i),o=e.getUniformLocation(t,r.name);nj(r,o,this)}}setValue(e,t,n,i){const r=this.map[t];r!==void 0&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const l=t[r],h=n[l.id];h.needsUpdate!==!1&&l.setValue(e,h.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const o=e[i];o.id in t&&n.push(o)}return n}}function GR(a,e,t){const n=a.createShader(e);return a.shaderSource(n,t),a.compileShader(n),n}let ij=0;function sj(a,e){const t=a.split(`
`),n=[],i=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=i;o<r;o++){const l=o+1;n.push(`${l===e?">":" "} ${l}: ${t[o]}`)}return n.join(`
`)}function rj(a){switch(a){case Ar:return["Linear","( value )"];case Gn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function HR(a,e,t){const n=a.getShaderParameter(e,35713),i=a.getShaderInfoLog(e).trim();if(n&&i==="")return"";const r=/ERROR: 0:(\d+)/.exec(i);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+i+`

`+sj(a.getShaderSource(e),o)}else return i}function oj(a,e){const t=rj(e);return"vec4 "+a+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function aj(a,e){let t;switch(e){case v_:t="Linear";break;case eS:t="Reinhard";break;case i2:t="OptimizedCineon";break;case tS:t="ACESFilmic";break;case s2:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function cj(a){return[a.extensionDerivatives||!!a.envMapCubeUVHeight||a.bumpMap||a.tangentSpaceNormalMap||a.clearcoatNormalMap||a.flatShading||a.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(a.extensionFragDepth||a.logarithmicDepthBuffer)&&a.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",a.extensionDrawBuffers&&a.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(a.extensionShaderTextureLOD||a.envMap||a.transmission)&&a.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Dm).join(`
`)}function lj(a){const e=[];for(const t in a){const n=a[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function hj(a,e){const t={},n=a.getProgramParameter(e,35721);for(let i=0;i<n;i++){const r=a.getActiveAttrib(e,i),o=r.name;let l=1;r.type===35674&&(l=2),r.type===35675&&(l=3),r.type===35676&&(l=4),t[o]={type:r.type,location:a.getAttribLocation(e,o),locationSize:l}}return t}function Dm(a){return a!==""}function VR(a,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function WR(a,e){return a.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const uj=/^[ \t]*#include +<([\w\d./]+)>/gm;function tE(a){return a.replace(uj,dj)}function dj(a,e){const t=qn[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return tE(t)}const fj=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function QR(a){return a.replace(fj,pj)}function pj(a,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function jR(a){let e="precision "+a.precision+` float;
precision `+a.precision+" int;";return a.precision==="highp"?e+=`
#define HIGH_PRECISION`:a.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function mj(a){let e="SHADOWMAP_TYPE_BASIC";return a.shadowMapType===JE?e="SHADOWMAP_TYPE_PCF":a.shadowMapType===KE?e="SHADOWMAP_TYPE_PCF_SOFT":a.shadowMapType===mf&&(e="SHADOWMAP_TYPE_VSM"),e}function gj(a){let e="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case $l:case eh:e="ENVMAP_TYPE_CUBE";break;case jf:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Aj(a){let e="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case eh:e="ENVMAP_MODE_REFRACTION";break}return e}function yj(a){let e="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case Ig:e="ENVMAP_BLENDING_MULTIPLY";break;case t2:e="ENVMAP_BLENDING_MIX";break;case n2:e="ENVMAP_BLENDING_ADD";break}return e}function _j(a){const e=a.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function vj(a,e,t,n){const i=a.getContext(),r=t.defines;let o=t.vertexShader,l=t.fragmentShader;const h=mj(t),u=gj(t),f=Aj(t),g=yj(t),m=_j(t),A=t.isWebGL2?"":cj(t),v=lj(r),b=i.createProgram();let C,S,I=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(C=[v].filter(Dm).join(`
`),C.length>0&&(C+=`
`),S=[A,v].filter(Dm).join(`
`),S.length>0&&(S+=`
`)):(C=[jR(t),"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Dm).join(`
`),S=[A,jR(t),"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",t.envMap?"#define "+g:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ma?"#define TONE_MAPPING":"",t.toneMapping!==ma?qn.tonemapping_pars_fragment:"",t.toneMapping!==ma?aj("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",qn.encodings_pars_fragment,oj("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Dm).join(`
`)),o=tE(o),o=VR(o,t),o=WR(o,t),l=tE(l),l=VR(l,t),l=WR(l,t),o=QR(o),l=QR(l),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(I=`#version 300 es
`,C=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+C,S=["#define varying in",t.glslVersion===ZC?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===ZC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+S);const M=I+C+o,R=I+S+l,T=GR(i,35633,M),B=GR(i,35632,R);if(i.attachShader(b,T),i.attachShader(b,B),t.index0AttributeName!==void 0?i.bindAttribLocation(b,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(b,0,"position"),i.linkProgram(b),a.debug.checkShaderErrors){const U=i.getProgramInfoLog(b).trim(),W=i.getShaderInfoLog(T).trim(),J=i.getShaderInfoLog(B).trim();let ee=!0,Q=!0;if(i.getProgramParameter(b,35714)===!1){ee=!1;const Y=HR(i,T,"vertex"),se=HR(i,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(b,35715)+`

Program Info Log: `+U+`
`+Y+`
`+se)}else U!==""?console.warn("THREE.WebGLProgram: Program Info Log:",U):(W===""||J==="")&&(Q=!1);Q&&(this.diagnostics={runnable:ee,programLog:U,vertexShader:{log:W,prefix:C},fragmentShader:{log:J,prefix:S}})}i.deleteShader(T),i.deleteShader(B);let F;this.getUniforms=function(){return F===void 0&&(F=new Jy(i,b)),F};let D;return this.getAttributes=function(){return D===void 0&&(D=hj(i,b)),D},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(b),this.program=void 0},this.name=t.shaderName,this.id=ij++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=T,this.fragmentShader=B,this}let xj=0;class wj{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new bj(e),t.set(e,n)),n}}class bj{constructor(e){this.id=xj++,this.code=e,this.usedTimes=0}}function Cj(a,e,t,n,i,r,o){const l=new Ka,h=new wj,u=[],f=i.isWebGL2,g=i.logarithmicDepthBuffer,m=i.vertexTextures;let A=i.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(D,U,W,J,ee){const Q=J.fog,Y=ee.geometry,se=D.isMeshStandardMaterial?J.environment:null,ae=(D.isMeshStandardMaterial?t:e).get(D.envMap||se),ve=!!ae&&ae.mapping===jf?ae.image.height:null,xe=v[D.type];D.precision!==null&&(A=i.getMaxPrecision(D.precision),A!==D.precision&&console.warn("THREE.WebGLProgram.getParameters:",D.precision,"not supported, using",A,"instead."));const Ae=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,Ie=Ae!==void 0?Ae.length:0;let Le=0;Y.morphAttributes.position!==void 0&&(Le=1),Y.morphAttributes.normal!==void 0&&(Le=2),Y.morphAttributes.color!==void 0&&(Le=3);let De,$e,vt,zt;if(xe){const vn=ca[xe];De=vn.vertexShader,$e=vn.fragmentShader}else De=D.vertexShader,$e=D.fragmentShader,h.update(D),vt=h.getVertexShaderID(D),zt=h.getFragmentShaderID(D);const Ve=a.getRenderTarget(),gn=D.alphaTest>0,Xt=D.clearcoat>0,mn=D.iridescence>0;return{isWebGL2:f,shaderID:xe,shaderName:D.type,vertexShader:De,fragmentShader:$e,defines:D.defines,customVertexShaderID:vt,customFragmentShaderID:zt,isRawShaderMaterial:D.isRawShaderMaterial===!0,glslVersion:D.glslVersion,precision:A,instancing:ee.isInstancedMesh===!0,instancingColor:ee.isInstancedMesh===!0&&ee.instanceColor!==null,supportsVertexTextures:m,outputEncoding:Ve===null?a.outputEncoding:Ve.isXRRenderTarget===!0?Ve.texture.encoding:Ar,map:!!D.map,matcap:!!D.matcap,envMap:!!ae,envMapMode:ae&&ae.mapping,envMapCubeUVHeight:ve,lightMap:!!D.lightMap,aoMap:!!D.aoMap,emissiveMap:!!D.emissiveMap,bumpMap:!!D.bumpMap,normalMap:!!D.normalMap,objectSpaceNormalMap:D.normalMapType===x2,tangentSpaceNormalMap:D.normalMapType===Yc,decodeVideoTexture:!!D.map&&D.map.isVideoTexture===!0&&D.map.encoding===Gn,clearcoat:Xt,clearcoatMap:Xt&&!!D.clearcoatMap,clearcoatRoughnessMap:Xt&&!!D.clearcoatRoughnessMap,clearcoatNormalMap:Xt&&!!D.clearcoatNormalMap,iridescence:mn,iridescenceMap:mn&&!!D.iridescenceMap,iridescenceThicknessMap:mn&&!!D.iridescenceThicknessMap,displacementMap:!!D.displacementMap,roughnessMap:!!D.roughnessMap,metalnessMap:!!D.metalnessMap,specularMap:!!D.specularMap,specularIntensityMap:!!D.specularIntensityMap,specularColorMap:!!D.specularColorMap,opaque:D.transparent===!1&&D.blending===Tu,alphaMap:!!D.alphaMap,alphaTest:gn,gradientMap:!!D.gradientMap,sheen:D.sheen>0,sheenColorMap:!!D.sheenColorMap,sheenRoughnessMap:!!D.sheenRoughnessMap,transmission:D.transmission>0,transmissionMap:!!D.transmissionMap,thicknessMap:!!D.thicknessMap,combine:D.combine,vertexTangents:!!D.normalMap&&!!Y.attributes.tangent,vertexColors:D.vertexColors,vertexAlphas:D.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,vertexUvs:!!D.map||!!D.bumpMap||!!D.normalMap||!!D.specularMap||!!D.alphaMap||!!D.emissiveMap||!!D.roughnessMap||!!D.metalnessMap||!!D.clearcoatMap||!!D.clearcoatRoughnessMap||!!D.clearcoatNormalMap||!!D.iridescenceMap||!!D.iridescenceThicknessMap||!!D.displacementMap||!!D.transmissionMap||!!D.thicknessMap||!!D.specularIntensityMap||!!D.specularColorMap||!!D.sheenColorMap||!!D.sheenRoughnessMap,uvsVertexOnly:!(!!D.map||!!D.bumpMap||!!D.normalMap||!!D.specularMap||!!D.alphaMap||!!D.emissiveMap||!!D.roughnessMap||!!D.metalnessMap||!!D.clearcoatNormalMap||!!D.iridescenceMap||!!D.iridescenceThicknessMap||D.transmission>0||!!D.transmissionMap||!!D.thicknessMap||!!D.specularIntensityMap||!!D.specularColorMap||D.sheen>0||!!D.sheenColorMap||!!D.sheenRoughnessMap)&&!!D.displacementMap,fog:!!Q,useFog:D.fog===!0,fogExp2:Q&&Q.isFogExp2,flatShading:!!D.flatShading,sizeAttenuation:D.sizeAttenuation,logarithmicDepthBuffer:g,skinning:ee.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:Ie,morphTextureStride:Le,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numSpotLightMaps:U.spotLightMap.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numSpotLightShadowsWithMaps:U.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:D.dithering,shadowMapEnabled:a.shadowMap.enabled&&W.length>0,shadowMapType:a.shadowMap.type,toneMapping:D.toneMapped?a.toneMapping:ma,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:D.premultipliedAlpha,doubleSided:D.side===ir,flipSided:D.side===Wr,useDepthPacking:!!D.depthPacking,depthPacking:D.depthPacking||0,index0AttributeName:D.index0AttributeName,extensionDerivatives:D.extensions&&D.extensions.derivatives,extensionFragDepth:D.extensions&&D.extensions.fragDepth,extensionDrawBuffers:D.extensions&&D.extensions.drawBuffers,extensionShaderTextureLOD:D.extensions&&D.extensions.shaderTextureLOD,rendererExtensionFragDepth:f||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:f||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:f||n.has("EXT_shader_texture_lod"),customProgramCacheKey:D.customProgramCacheKey()}}function C(D){const U=[];if(D.shaderID?U.push(D.shaderID):(U.push(D.customVertexShaderID),U.push(D.customFragmentShaderID)),D.defines!==void 0)for(const W in D.defines)U.push(W),U.push(D.defines[W]);return D.isRawShaderMaterial===!1&&(S(U,D),I(U,D),U.push(a.outputEncoding)),U.push(D.customProgramCacheKey),U.join()}function S(D,U){D.push(U.precision),D.push(U.outputEncoding),D.push(U.envMapMode),D.push(U.envMapCubeUVHeight),D.push(U.combine),D.push(U.vertexUvs),D.push(U.fogExp2),D.push(U.sizeAttenuation),D.push(U.morphTargetsCount),D.push(U.morphAttributeCount),D.push(U.numDirLights),D.push(U.numPointLights),D.push(U.numSpotLights),D.push(U.numSpotLightMaps),D.push(U.numHemiLights),D.push(U.numRectAreaLights),D.push(U.numDirLightShadows),D.push(U.numPointLightShadows),D.push(U.numSpotLightShadows),D.push(U.numSpotLightShadowsWithMaps),D.push(U.shadowMapType),D.push(U.toneMapping),D.push(U.numClippingPlanes),D.push(U.numClipIntersection),D.push(U.depthPacking)}function I(D,U){l.disableAll(),U.isWebGL2&&l.enable(0),U.supportsVertexTextures&&l.enable(1),U.instancing&&l.enable(2),U.instancingColor&&l.enable(3),U.map&&l.enable(4),U.matcap&&l.enable(5),U.envMap&&l.enable(6),U.lightMap&&l.enable(7),U.aoMap&&l.enable(8),U.emissiveMap&&l.enable(9),U.bumpMap&&l.enable(10),U.normalMap&&l.enable(11),U.objectSpaceNormalMap&&l.enable(12),U.tangentSpaceNormalMap&&l.enable(13),U.clearcoat&&l.enable(14),U.clearcoatMap&&l.enable(15),U.clearcoatRoughnessMap&&l.enable(16),U.clearcoatNormalMap&&l.enable(17),U.iridescence&&l.enable(18),U.iridescenceMap&&l.enable(19),U.iridescenceThicknessMap&&l.enable(20),U.displacementMap&&l.enable(21),U.specularMap&&l.enable(22),U.roughnessMap&&l.enable(23),U.metalnessMap&&l.enable(24),U.gradientMap&&l.enable(25),U.alphaMap&&l.enable(26),U.alphaTest&&l.enable(27),U.vertexColors&&l.enable(28),U.vertexAlphas&&l.enable(29),U.vertexUvs&&l.enable(30),U.vertexTangents&&l.enable(31),U.uvsVertexOnly&&l.enable(32),D.push(l.mask),l.disableAll(),U.fog&&l.enable(0),U.useFog&&l.enable(1),U.flatShading&&l.enable(2),U.logarithmicDepthBuffer&&l.enable(3),U.skinning&&l.enable(4),U.morphTargets&&l.enable(5),U.morphNormals&&l.enable(6),U.morphColors&&l.enable(7),U.premultipliedAlpha&&l.enable(8),U.shadowMapEnabled&&l.enable(9),U.physicallyCorrectLights&&l.enable(10),U.doubleSided&&l.enable(11),U.flipSided&&l.enable(12),U.useDepthPacking&&l.enable(13),U.dithering&&l.enable(14),U.specularIntensityMap&&l.enable(15),U.specularColorMap&&l.enable(16),U.transmission&&l.enable(17),U.transmissionMap&&l.enable(18),U.thicknessMap&&l.enable(19),U.sheen&&l.enable(20),U.sheenColorMap&&l.enable(21),U.sheenRoughnessMap&&l.enable(22),U.decodeVideoTexture&&l.enable(23),U.opaque&&l.enable(24),D.push(l.mask)}function M(D){const U=v[D.type];let W;if(U){const J=ca[U];W=dS.clone(J.uniforms)}else W=D.uniforms;return W}function R(D,U){let W;for(let J=0,ee=u.length;J<ee;J++){const Q=u[J];if(Q.cacheKey===U){W=Q,++W.usedTimes;break}}return W===void 0&&(W=new vj(a,U,D,r),u.push(W)),W}function T(D){if(--D.usedTimes===0){const U=u.indexOf(D);u[U]=u[u.length-1],u.pop(),D.destroy()}}function B(D){h.remove(D)}function F(){h.dispose()}return{getParameters:b,getProgramCacheKey:C,getUniforms:M,acquireProgram:R,releaseProgram:T,releaseShaderCache:B,programs:u,dispose:F}}function Ej(){let a=new WeakMap;function e(r){let o=a.get(r);return o===void 0&&(o={},a.set(r,o)),o}function t(r){a.delete(r)}function n(r,o,l){a.get(r)[o]=l}function i(){a=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function Sj(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.material.id!==e.material.id?a.material.id-e.material.id:a.z!==e.z?a.z-e.z:a.id-e.id}function qR(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.z!==e.z?e.z-a.z:a.id-e.id}function XR(){const a=[];let e=0;const t=[],n=[],i=[];function r(){e=0,t.length=0,n.length=0,i.length=0}function o(g,m,A,v,b,C){let S=a[e];return S===void 0?(S={id:g.id,object:g,geometry:m,material:A,groupOrder:v,renderOrder:g.renderOrder,z:b,group:C},a[e]=S):(S.id=g.id,S.object=g,S.geometry=m,S.material=A,S.groupOrder=v,S.renderOrder=g.renderOrder,S.z=b,S.group=C),e++,S}function l(g,m,A,v,b,C){const S=o(g,m,A,v,b,C);A.transmission>0?n.push(S):A.transparent===!0?i.push(S):t.push(S)}function h(g,m,A,v,b,C){const S=o(g,m,A,v,b,C);A.transmission>0?n.unshift(S):A.transparent===!0?i.unshift(S):t.unshift(S)}function u(g,m){t.length>1&&t.sort(g||Sj),n.length>1&&n.sort(m||qR),i.length>1&&i.sort(m||qR)}function f(){for(let g=e,m=a.length;g<m;g++){const A=a[g];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:t,transmissive:n,transparent:i,init:r,push:l,unshift:h,finish:f,sort:u}}function Mj(){let a=new WeakMap;function e(n,i){const r=a.get(n);let o;return r===void 0?(o=new XR,a.set(n,[o])):i>=r.length?(o=new XR,r.push(o)):o=r[i],o}function t(){a=new WeakMap}return{get:e,dispose:t}}function Tj(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new q,color:new ye};break;case"SpotLight":t={position:new q,direction:new q,color:new ye,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new q,color:new ye,distance:0,decay:0};break;case"HemisphereLight":t={direction:new q,skyColor:new ye,groundColor:new ye};break;case"RectAreaLight":t={color:new ye,position:new q,halfWidth:new q,halfHeight:new q};break}return a[e.id]=t,t}}}function Ij(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe,shadowCameraNear:1,shadowCameraFar:1e3};break}return a[e.id]=t,t}}}let Rj=0;function Pj(a,e){return(e.castShadow?2:0)-(a.castShadow?2:0)+(e.map?1:0)-(a.map?1:0)}function Bj(a,e){const t=new Tj,n=Ij(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let f=0;f<9;f++)i.probe.push(new q);const r=new q,o=new fn,l=new fn;function h(f,g){let m=0,A=0,v=0;for(let J=0;J<9;J++)i.probe[J].set(0,0,0);let b=0,C=0,S=0,I=0,M=0,R=0,T=0,B=0,F=0,D=0;f.sort(Pj);const U=g!==!0?Math.PI:1;for(let J=0,ee=f.length;J<ee;J++){const Q=f[J],Y=Q.color,se=Q.intensity,ae=Q.distance,ve=Q.shadow&&Q.shadow.map?Q.shadow.map.texture:null;if(Q.isAmbientLight)m+=Y.r*se*U,A+=Y.g*se*U,v+=Y.b*se*U;else if(Q.isLightProbe)for(let xe=0;xe<9;xe++)i.probe[xe].addScaledVector(Q.sh.coefficients[xe],se);else if(Q.isDirectionalLight){const xe=t.get(Q);if(xe.color.copy(Q.color).multiplyScalar(Q.intensity*U),Q.castShadow){const Ae=Q.shadow,Ie=n.get(Q);Ie.shadowBias=Ae.bias,Ie.shadowNormalBias=Ae.normalBias,Ie.shadowRadius=Ae.radius,Ie.shadowMapSize=Ae.mapSize,i.directionalShadow[b]=Ie,i.directionalShadowMap[b]=ve,i.directionalShadowMatrix[b]=Q.shadow.matrix,R++}i.directional[b]=xe,b++}else if(Q.isSpotLight){const xe=t.get(Q);xe.position.setFromMatrixPosition(Q.matrixWorld),xe.color.copy(Y).multiplyScalar(se*U),xe.distance=ae,xe.coneCos=Math.cos(Q.angle),xe.penumbraCos=Math.cos(Q.angle*(1-Q.penumbra)),xe.decay=Q.decay,i.spot[S]=xe;const Ae=Q.shadow;if(Q.map&&(i.spotLightMap[F]=Q.map,F++,Ae.updateMatrices(Q),Q.castShadow&&D++),i.spotLightMatrix[S]=Ae.matrix,Q.castShadow){const Ie=n.get(Q);Ie.shadowBias=Ae.bias,Ie.shadowNormalBias=Ae.normalBias,Ie.shadowRadius=Ae.radius,Ie.shadowMapSize=Ae.mapSize,i.spotShadow[S]=Ie,i.spotShadowMap[S]=ve,B++}S++}else if(Q.isRectAreaLight){const xe=t.get(Q);xe.color.copy(Y).multiplyScalar(se),xe.halfWidth.set(Q.width*.5,0,0),xe.halfHeight.set(0,Q.height*.5,0),i.rectArea[I]=xe,I++}else if(Q.isPointLight){const xe=t.get(Q);if(xe.color.copy(Q.color).multiplyScalar(Q.intensity*U),xe.distance=Q.distance,xe.decay=Q.decay,Q.castShadow){const Ae=Q.shadow,Ie=n.get(Q);Ie.shadowBias=Ae.bias,Ie.shadowNormalBias=Ae.normalBias,Ie.shadowRadius=Ae.radius,Ie.shadowMapSize=Ae.mapSize,Ie.shadowCameraNear=Ae.camera.near,Ie.shadowCameraFar=Ae.camera.far,i.pointShadow[C]=Ie,i.pointShadowMap[C]=ve,i.pointShadowMatrix[C]=Q.shadow.matrix,T++}i.point[C]=xe,C++}else if(Q.isHemisphereLight){const xe=t.get(Q);xe.skyColor.copy(Q.color).multiplyScalar(se*U),xe.groundColor.copy(Q.groundColor).multiplyScalar(se*U),i.hemi[M]=xe,M++}}I>0&&(e.isWebGL2||a.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Vt.LTC_FLOAT_1,i.rectAreaLTC2=Vt.LTC_FLOAT_2):a.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=Vt.LTC_HALF_1,i.rectAreaLTC2=Vt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=m,i.ambient[1]=A,i.ambient[2]=v;const W=i.hash;(W.directionalLength!==b||W.pointLength!==C||W.spotLength!==S||W.rectAreaLength!==I||W.hemiLength!==M||W.numDirectionalShadows!==R||W.numPointShadows!==T||W.numSpotShadows!==B||W.numSpotMaps!==F)&&(i.directional.length=b,i.spot.length=S,i.rectArea.length=I,i.point.length=C,i.hemi.length=M,i.directionalShadow.length=R,i.directionalShadowMap.length=R,i.pointShadow.length=T,i.pointShadowMap.length=T,i.spotShadow.length=B,i.spotShadowMap.length=B,i.directionalShadowMatrix.length=R,i.pointShadowMatrix.length=T,i.spotLightMatrix.length=B+F-D,i.spotLightMap.length=F,i.numSpotLightShadowsWithMaps=D,W.directionalLength=b,W.pointLength=C,W.spotLength=S,W.rectAreaLength=I,W.hemiLength=M,W.numDirectionalShadows=R,W.numPointShadows=T,W.numSpotShadows=B,W.numSpotMaps=F,i.version=Rj++)}function u(f,g){let m=0,A=0,v=0,b=0,C=0;const S=g.matrixWorldInverse;for(let I=0,M=f.length;I<M;I++){const R=f[I];if(R.isDirectionalLight){const T=i.directional[m];T.direction.setFromMatrixPosition(R.matrixWorld),r.setFromMatrixPosition(R.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(S),m++}else if(R.isSpotLight){const T=i.spot[v];T.position.setFromMatrixPosition(R.matrixWorld),T.position.applyMatrix4(S),T.direction.setFromMatrixPosition(R.matrixWorld),r.setFromMatrixPosition(R.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(S),v++}else if(R.isRectAreaLight){const T=i.rectArea[b];T.position.setFromMatrixPosition(R.matrixWorld),T.position.applyMatrix4(S),l.identity(),o.copy(R.matrixWorld),o.premultiply(S),l.extractRotation(o),T.halfWidth.set(R.width*.5,0,0),T.halfHeight.set(0,R.height*.5,0),T.halfWidth.applyMatrix4(l),T.halfHeight.applyMatrix4(l),b++}else if(R.isPointLight){const T=i.point[A];T.position.setFromMatrixPosition(R.matrixWorld),T.position.applyMatrix4(S),A++}else if(R.isHemisphereLight){const T=i.hemi[C];T.direction.setFromMatrixPosition(R.matrixWorld),T.direction.transformDirection(S),C++}}}return{setup:h,setupView:u,state:i}}function YR(a,e){const t=new Bj(a,e),n=[],i=[];function r(){n.length=0,i.length=0}function o(g){n.push(g)}function l(g){i.push(g)}function h(g){t.setup(n,g)}function u(g){t.setupView(n,g)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:h,setupLightsView:u,pushLight:o,pushShadow:l}}function Lj(a,e){let t=new WeakMap;function n(r,o){const l=t.get(r);let h;return l===void 0?(h=new YR(a,e),t.set(r,[h])):o>=l.length?(h=new YR(a,e),l.push(h)):h=l[o],h}function i(){t=new WeakMap}return{get:n,dispose:i}}class mS extends vs{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=_2,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class gS extends vs{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new q,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Dj=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Oj=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Fj(a,e,t){let n=new fv;const i=new Xe,r=new Xe,o=new Bn,l=new mS({depthPacking:v2}),h=new gS,u={},f=t.maxTextureSize,g={0:Wr,1:zo,2:ir},m=new js({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xe},radius:{value:4}},vertexShader:Dj,fragmentShader:Oj}),A=m.clone();A.defines.HORIZONTAL_PASS=1;const v=new Sn;v.setAttribute("position",new Jn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new _t(v,m),C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=JE,this.render=function(R,T,B){if(C.enabled===!1||C.autoUpdate===!1&&C.needsUpdate===!1||R.length===0)return;const F=a.getRenderTarget(),D=a.getActiveCubeFace(),U=a.getActiveMipmapLevel(),W=a.state;W.setBlending(Vc),W.buffers.color.setClear(1,1,1,1),W.buffers.depth.setTest(!0),W.setScissorTest(!1);for(let J=0,ee=R.length;J<ee;J++){const Q=R[J],Y=Q.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",Q,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;i.copy(Y.mapSize);const se=Y.getFrameExtents();if(i.multiply(se),r.copy(Y.mapSize),(i.x>f||i.y>f)&&(i.x>f&&(r.x=Math.floor(f/se.x),i.x=r.x*se.x,Y.mapSize.x=r.x),i.y>f&&(r.y=Math.floor(f/se.y),i.y=r.y*se.y,Y.mapSize.y=r.y)),Y.map===null){const ve=this.type!==mf?{minFilter:$i,magFilter:$i}:{};Y.map=new Xr(i.x,i.y,ve),Y.map.texture.name=Q.name+".shadowMap",Y.camera.updateProjectionMatrix()}a.setRenderTarget(Y.map),a.clear();const ae=Y.getViewportCount();for(let ve=0;ve<ae;ve++){const xe=Y.getViewport(ve);o.set(r.x*xe.x,r.y*xe.y,r.x*xe.z,r.y*xe.w),W.viewport(o),Y.updateMatrices(Q,ve),n=Y.getFrustum(),M(T,B,Y.camera,Q,this.type)}Y.isPointLightShadow!==!0&&this.type===mf&&S(Y,B),Y.needsUpdate=!1}C.needsUpdate=!1,a.setRenderTarget(F,D,U)};function S(R,T){const B=e.update(b);m.defines.VSM_SAMPLES!==R.blurSamples&&(m.defines.VSM_SAMPLES=R.blurSamples,A.defines.VSM_SAMPLES=R.blurSamples,m.needsUpdate=!0,A.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new Xr(i.x,i.y)),m.uniforms.shadow_pass.value=R.map.texture,m.uniforms.resolution.value=R.mapSize,m.uniforms.radius.value=R.radius,a.setRenderTarget(R.mapPass),a.clear(),a.renderBufferDirect(T,null,B,m,b,null),A.uniforms.shadow_pass.value=R.mapPass.texture,A.uniforms.resolution.value=R.mapSize,A.uniforms.radius.value=R.radius,a.setRenderTarget(R.map),a.clear(),a.renderBufferDirect(T,null,B,A,b,null)}function I(R,T,B,F,D,U){let W=null;const J=B.isPointLight===!0?R.customDistanceMaterial:R.customDepthMaterial;if(J!==void 0?W=J:W=B.isPointLight===!0?h:l,a.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0){const ee=W.uuid,Q=T.uuid;let Y=u[ee];Y===void 0&&(Y={},u[ee]=Y);let se=Y[Q];se===void 0&&(se=W.clone(),Y[Q]=se),W=se}return W.visible=T.visible,W.wireframe=T.wireframe,U===mf?W.side=T.shadowSide!==null?T.shadowSide:T.side:W.side=T.shadowSide!==null?T.shadowSide:g[T.side],W.alphaMap=T.alphaMap,W.alphaTest=T.alphaTest,W.clipShadows=T.clipShadows,W.clippingPlanes=T.clippingPlanes,W.clipIntersection=T.clipIntersection,W.displacementMap=T.displacementMap,W.displacementScale=T.displacementScale,W.displacementBias=T.displacementBias,W.wireframeLinewidth=T.wireframeLinewidth,W.linewidth=T.linewidth,B.isPointLight===!0&&W.isMeshDistanceMaterial===!0&&(W.referencePosition.setFromMatrixPosition(B.matrixWorld),W.nearDistance=F,W.farDistance=D),W}function M(R,T,B,F,D){if(R.visible===!1)return;if(R.layers.test(T.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&D===mf)&&(!R.frustumCulled||n.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,R.matrixWorld);const J=e.update(R),ee=R.material;if(Array.isArray(ee)){const Q=J.groups;for(let Y=0,se=Q.length;Y<se;Y++){const ae=Q[Y],ve=ee[ae.materialIndex];if(ve&&ve.visible){const xe=I(R,ve,F,B.near,B.far,D);a.renderBufferDirect(B,null,J,xe,R,ae)}}}else if(ee.visible){const Q=I(R,ee,F,B.near,B.far,D);a.renderBufferDirect(B,null,J,Q,R,null)}}const W=R.children;for(let J=0,ee=W.length;J<ee;J++)M(W[J],T,B,F,D)}}function kj(a,e,t){const n=t.isWebGL2;function i(){let Me=!1;const Bt=new Bn;let Ut=null;const Re=new Bn(0,0,0,0);return{setMask:function(Mt){Ut!==Mt&&!Me&&(a.colorMask(Mt,Mt,Mt,Mt),Ut=Mt)},setLocked:function(Mt){Me=Mt},setClear:function(Mt,wn,fi,Vi,Kr){Kr===!0&&(Mt*=Vi,wn*=Vi,fi*=Vi),Bt.set(Mt,wn,fi,Vi),Re.equals(Bt)===!1&&(a.clearColor(Mt,wn,fi,Vi),Re.copy(Bt))},reset:function(){Me=!1,Ut=null,Re.set(-1,0,0,0)}}}function r(){let Me=!1,Bt=null,Ut=null,Re=null;return{setTest:function(Mt){Mt?gn(2929):Xt(2929)},setMask:function(Mt){Bt!==Mt&&!Me&&(a.depthMask(Mt),Bt=Mt)},setFunc:function(Mt){if(Ut!==Mt){switch(Mt){case XL:a.depthFunc(512);break;case YL:a.depthFunc(519);break;case JL:a.depthFunc(513);break;case __:a.depthFunc(515);break;case KL:a.depthFunc(514);break;case ZL:a.depthFunc(518);break;case $L:a.depthFunc(516);break;case e2:a.depthFunc(517);break;default:a.depthFunc(515)}Ut=Mt}},setLocked:function(Mt){Me=Mt},setClear:function(Mt){Re!==Mt&&(a.clearDepth(Mt),Re=Mt)},reset:function(){Me=!1,Bt=null,Ut=null,Re=null}}}function o(){let Me=!1,Bt=null,Ut=null,Re=null,Mt=null,wn=null,fi=null,Vi=null,Kr=null;return{setTest:function(xi){Me||(xi?gn(2960):Xt(2960))},setMask:function(xi){Bt!==xi&&!Me&&(a.stencilMask(xi),Bt=xi)},setFunc:function(xi,Or,Ys){(Ut!==xi||Re!==Or||Mt!==Ys)&&(a.stencilFunc(xi,Or,Ys),Ut=xi,Re=Or,Mt=Ys)},setOp:function(xi,Or,Ys){(wn!==xi||fi!==Or||Vi!==Ys)&&(a.stencilOp(xi,Or,Ys),wn=xi,fi=Or,Vi=Ys)},setLocked:function(xi){Me=xi},setClear:function(xi){Kr!==xi&&(a.clearStencil(xi),Kr=xi)},reset:function(){Me=!1,Bt=null,Ut=null,Re=null,Mt=null,wn=null,fi=null,Vi=null,Kr=null}}}const l=new i,h=new r,u=new o,f=new WeakMap,g=new WeakMap;let m={},A={},v=new WeakMap,b=[],C=null,S=!1,I=null,M=null,R=null,T=null,B=null,F=null,D=null,U=!1,W=null,J=null,ee=null,Q=null,Y=null;const se=a.getParameter(35661);let ae=!1,ve=0;const xe=a.getParameter(7938);xe.indexOf("WebGL")!==-1?(ve=parseFloat(/^WebGL (\d)/.exec(xe)[1]),ae=ve>=1):xe.indexOf("OpenGL ES")!==-1&&(ve=parseFloat(/^OpenGL ES (\d)/.exec(xe)[1]),ae=ve>=2);let Ae=null,Ie={};const Le=a.getParameter(3088),De=a.getParameter(2978),$e=new Bn().fromArray(Le),vt=new Bn().fromArray(De);function zt(Me,Bt,Ut){const Re=new Uint8Array(4),Mt=a.createTexture();a.bindTexture(Me,Mt),a.texParameteri(Me,10241,9728),a.texParameteri(Me,10240,9728);for(let wn=0;wn<Ut;wn++)a.texImage2D(Bt+wn,0,6408,1,1,0,6408,5121,Re);return Mt}const Ve={};Ve[3553]=zt(3553,3553,1),Ve[34067]=zt(34067,34069,6),l.setClear(0,0,0,1),h.setClear(1),u.setClear(0),gn(2929),h.setFunc(__),Dt(!1),Cn(BC),gn(2884),xt(Vc);function gn(Me){m[Me]!==!0&&(a.enable(Me),m[Me]=!0)}function Xt(Me){m[Me]!==!1&&(a.disable(Me),m[Me]=!1)}function mn(Me,Bt){return A[Me]!==Bt?(a.bindFramebuffer(Me,Bt),A[Me]=Bt,n&&(Me===36009&&(A[36160]=Bt),Me===36160&&(A[36009]=Bt)),!0):!1}function Nt(Me,Bt){let Ut=b,Re=!1;if(Me)if(Ut=v.get(Bt),Ut===void 0&&(Ut=[],v.set(Bt,Ut)),Me.isWebGLMultipleRenderTargets){const Mt=Me.texture;if(Ut.length!==Mt.length||Ut[0]!==36064){for(let wn=0,fi=Mt.length;wn<fi;wn++)Ut[wn]=36064+wn;Ut.length=Mt.length,Re=!0}}else Ut[0]!==36064&&(Ut[0]=36064,Re=!0);else Ut[0]!==1029&&(Ut[0]=1029,Re=!0);Re&&(t.isWebGL2?a.drawBuffers(Ut):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ut))}function vn(Me){return C!==Me?(a.useProgram(Me),C=Me,!0):!1}const it={[mu]:32774,[kL]:32778,[NL]:32779};if(n)it[OC]=32775,it[FC]=32776;else{const Me=e.get("EXT_blend_minmax");Me!==null&&(it[OC]=Me.MIN_EXT,it[FC]=Me.MAX_EXT)}const tt={[UL]:0,[zL]:1,[GL]:768,[ZE]:770,[qL]:776,[QL]:774,[VL]:772,[HL]:769,[$E]:771,[jL]:775,[WL]:773};function xt(Me,Bt,Ut,Re,Mt,wn,fi,Vi){if(Me===Vc){S===!0&&(Xt(3042),S=!1);return}if(S===!1&&(gn(3042),S=!0),Me!==FL){if(Me!==I||Vi!==U){if((M!==mu||B!==mu)&&(a.blendEquation(32774),M=mu,B=mu),Vi)switch(Me){case Tu:a.blendFuncSeparate(1,771,1,771);break;case y_:a.blendFunc(1,1);break;case LC:a.blendFuncSeparate(0,769,0,1);break;case DC:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}else switch(Me){case Tu:a.blendFuncSeparate(770,771,1,771);break;case y_:a.blendFunc(770,1);break;case LC:a.blendFuncSeparate(0,769,0,1);break;case DC:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}R=null,T=null,F=null,D=null,I=Me,U=Vi}return}Mt=Mt||Bt,wn=wn||Ut,fi=fi||Re,(Bt!==M||Mt!==B)&&(a.blendEquationSeparate(it[Bt],it[Mt]),M=Bt,B=Mt),(Ut!==R||Re!==T||wn!==F||fi!==D)&&(a.blendFuncSeparate(tt[Ut],tt[Re],tt[wn],tt[fi]),R=Ut,T=Re,F=wn,D=fi),I=Me,U=null}function Jt(Me,Bt){Me.side===ir?Xt(2884):gn(2884);let Ut=Me.side===Wr;Bt&&(Ut=!Ut),Dt(Ut),Me.blending===Tu&&Me.transparent===!1?xt(Vc):xt(Me.blending,Me.blendEquation,Me.blendSrc,Me.blendDst,Me.blendEquationAlpha,Me.blendSrcAlpha,Me.blendDstAlpha,Me.premultipliedAlpha),h.setFunc(Me.depthFunc),h.setTest(Me.depthTest),h.setMask(Me.depthWrite),l.setMask(Me.colorWrite);const Re=Me.stencilWrite;u.setTest(Re),Re&&(u.setMask(Me.stencilWriteMask),u.setFunc(Me.stencilFunc,Me.stencilRef,Me.stencilFuncMask),u.setOp(Me.stencilFail,Me.stencilZFail,Me.stencilZPass)),ln(Me.polygonOffset,Me.polygonOffsetFactor,Me.polygonOffsetUnits),Me.alphaToCoverage===!0?gn(32926):Xt(32926)}function Dt(Me){W!==Me&&(Me?a.frontFace(2304):a.frontFace(2305),W=Me)}function Cn(Me){Me!==DL?(gn(2884),Me!==J&&(Me===BC?a.cullFace(1029):Me===OL?a.cullFace(1028):a.cullFace(1032))):Xt(2884),J=Me}function Kt(Me){Me!==ee&&(ae&&a.lineWidth(Me),ee=Me)}function ln(Me,Bt,Ut){Me?(gn(32823),(Q!==Bt||Y!==Ut)&&(a.polygonOffset(Bt,Ut),Q=Bt,Y=Ut)):Xt(32823)}function ii(Me){Me?gn(3089):Xt(3089)}function Kn(Me){Me===void 0&&(Me=33984+se-1),Ae!==Me&&(a.activeTexture(Me),Ae=Me)}function me(Me,Bt,Ut){Ut===void 0&&(Ae===null?Ut=33984+se-1:Ut=Ae);let Re=Ie[Ut];Re===void 0&&(Re={type:void 0,texture:void 0},Ie[Ut]=Re),(Re.type!==Me||Re.texture!==Bt)&&(Ae!==Ut&&(a.activeTexture(Ut),Ae=Ut),a.bindTexture(Me,Bt||Ve[Me]),Re.type=Me,Re.texture=Bt)}function ce(){const Me=Ie[Ae];Me!==void 0&&Me.type!==void 0&&(a.bindTexture(Me.type,null),Me.type=void 0,Me.texture=void 0)}function je(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function yt(){try{a.texSubImage2D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function mt(){try{a.texSubImage3D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Ht(){try{a.compressedTexSubImage2D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Mn(){try{a.texStorage2D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function be(){try{a.texStorage3D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ke(){try{a.texImage2D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Et(){try{a.texImage3D.apply(a,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function hn(Me){$e.equals(Me)===!1&&(a.scissor(Me.x,Me.y,Me.z,Me.w),$e.copy(Me))}function nn(Me){vt.equals(Me)===!1&&(a.viewport(Me.x,Me.y,Me.z,Me.w),vt.copy(Me))}function Wt(Me,Bt){let Ut=g.get(Bt);Ut===void 0&&(Ut=new WeakMap,g.set(Bt,Ut));let Re=Ut.get(Me);Re===void 0&&(Re=a.getUniformBlockIndex(Bt,Me.name),Ut.set(Me,Re))}function Ln(Me,Bt){const Re=g.get(Bt).get(Me);f.get(Me)!==Re&&(a.uniformBlockBinding(Bt,Re,Me.__bindingPointIndex),f.set(Me,Re))}function Dn(){a.disable(3042),a.disable(2884),a.disable(2929),a.disable(32823),a.disable(3089),a.disable(2960),a.disable(32926),a.blendEquation(32774),a.blendFunc(1,0),a.blendFuncSeparate(1,0,1,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(513),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(519,0,4294967295),a.stencilOp(7680,7680,7680),a.clearStencil(0),a.cullFace(1029),a.frontFace(2305),a.polygonOffset(0,0),a.activeTexture(33984),a.bindFramebuffer(36160,null),n===!0&&(a.bindFramebuffer(36009,null),a.bindFramebuffer(36008,null)),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),m={},Ae=null,Ie={},A={},v=new WeakMap,b=[],C=null,S=!1,I=null,M=null,R=null,T=null,B=null,F=null,D=null,U=!1,W=null,J=null,ee=null,Q=null,Y=null,$e.set(0,0,a.canvas.width,a.canvas.height),vt.set(0,0,a.canvas.width,a.canvas.height),l.reset(),h.reset(),u.reset()}return{buffers:{color:l,depth:h,stencil:u},enable:gn,disable:Xt,bindFramebuffer:mn,drawBuffers:Nt,useProgram:vn,setBlending:xt,setMaterial:Jt,setFlipSided:Dt,setCullFace:Cn,setLineWidth:Kt,setPolygonOffset:ln,setScissorTest:ii,activeTexture:Kn,bindTexture:me,unbindTexture:ce,compressedTexImage2D:je,texImage2D:ke,texImage3D:Et,updateUBOMapping:Wt,uniformBlockBinding:Ln,texStorage2D:Mn,texStorage3D:be,texSubImage2D:yt,texSubImage3D:mt,compressedTexSubImage2D:Ht,scissor:hn,viewport:nn,reset:Dn}}function Nj(a,e,t,n,i,r,o){const l=i.isWebGL2,h=i.maxTextures,u=i.maxCubemapSize,f=i.maxTextureSize,g=i.maxSamples,m=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,A=/OculusBrowser/g.test(navigator.userAgent),v=new WeakMap;let b;const C=new WeakMap;let S=!1;try{S=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function I(me,ce){return S?new OffscreenCanvas(me,ce):cg("canvas")}function M(me,ce,je,yt){let mt=1;if((me.width>yt||me.height>yt)&&(mt=yt/Math.max(me.width,me.height)),mt<1||ce===!0)if(typeof HTMLImageElement<"u"&&me instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&me instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&me instanceof ImageBitmap){const Ht=ce?T_:Math.floor,Mn=Ht(mt*me.width),be=Ht(mt*me.height);b===void 0&&(b=I(Mn,be));const ke=je?I(Mn,be):b;return ke.width=Mn,ke.height=be,ke.getContext("2d").drawImage(me,0,0,Mn,be),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+me.width+"x"+me.height+") to ("+Mn+"x"+be+")."),ke}else return"data"in me&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+me.width+"x"+me.height+")."),me;return me}function R(me){return $C(me.width)&&$C(me.height)}function T(me){return l?!1:me.wrapS!==Os||me.wrapT!==Os||me.minFilter!==$i&&me.minFilter!==vi}function B(me,ce){return me.generateMipmaps&&ce&&me.minFilter!==$i&&me.minFilter!==vi}function F(me){a.generateMipmap(me)}function D(me,ce,je,yt,mt=!1){if(l===!1)return ce;if(me!==null){if(a[me]!==void 0)return a[me];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+me+"'")}let Ht=ce;return ce===6403&&(je===5126&&(Ht=33326),je===5131&&(Ht=33325),je===5121&&(Ht=33321)),ce===33319&&(je===5126&&(Ht=33328),je===5131&&(Ht=33327),je===5121&&(Ht=33323)),ce===6408&&(je===5126&&(Ht=34836),je===5131&&(Ht=34842),je===5121&&(Ht=yt===Gn&&mt===!1?35907:32856),je===32819&&(Ht=32854),je===32820&&(Ht=32855)),(Ht===33325||Ht===33326||Ht===33327||Ht===33328||Ht===34842||Ht===34836)&&e.get("EXT_color_buffer_float"),Ht}function U(me,ce,je){return B(me,je)===!0||me.isFramebufferTexture&&me.minFilter!==$i&&me.minFilter!==vi?Math.log2(Math.max(ce.width,ce.height))+1:me.mipmaps!==void 0&&me.mipmaps.length>0?me.mipmaps.length:me.isCompressedTexture&&Array.isArray(me.image)?ce.mipmaps.length:1}function W(me){return me===$i||me===Ff||me===kf?9728:9729}function J(me){const ce=me.target;ce.removeEventListener("dispose",J),Q(ce),ce.isVideoTexture&&v.delete(ce)}function ee(me){const ce=me.target;ce.removeEventListener("dispose",ee),se(ce)}function Q(me){const ce=n.get(me);if(ce.__webglInit===void 0)return;const je=me.source,yt=C.get(je);if(yt){const mt=yt[ce.__cacheKey];mt.usedTimes--,mt.usedTimes===0&&Y(me),Object.keys(yt).length===0&&C.delete(je)}n.remove(me)}function Y(me){const ce=n.get(me);a.deleteTexture(ce.__webglTexture);const je=me.source,yt=C.get(je);delete yt[ce.__cacheKey],o.memory.textures--}function se(me){const ce=me.texture,je=n.get(me),yt=n.get(ce);if(yt.__webglTexture!==void 0&&(a.deleteTexture(yt.__webglTexture),o.memory.textures--),me.depthTexture&&me.depthTexture.dispose(),me.isWebGLCubeRenderTarget)for(let mt=0;mt<6;mt++)a.deleteFramebuffer(je.__webglFramebuffer[mt]),je.__webglDepthbuffer&&a.deleteRenderbuffer(je.__webglDepthbuffer[mt]);else{if(a.deleteFramebuffer(je.__webglFramebuffer),je.__webglDepthbuffer&&a.deleteRenderbuffer(je.__webglDepthbuffer),je.__webglMultisampledFramebuffer&&a.deleteFramebuffer(je.__webglMultisampledFramebuffer),je.__webglColorRenderbuffer)for(let mt=0;mt<je.__webglColorRenderbuffer.length;mt++)je.__webglColorRenderbuffer[mt]&&a.deleteRenderbuffer(je.__webglColorRenderbuffer[mt]);je.__webglDepthRenderbuffer&&a.deleteRenderbuffer(je.__webglDepthRenderbuffer)}if(me.isWebGLMultipleRenderTargets)for(let mt=0,Ht=ce.length;mt<Ht;mt++){const Mn=n.get(ce[mt]);Mn.__webglTexture&&(a.deleteTexture(Mn.__webglTexture),o.memory.textures--),n.remove(ce[mt])}n.remove(ce),n.remove(me)}let ae=0;function ve(){ae=0}function xe(){const me=ae;return me>=h&&console.warn("THREE.WebGLTextures: Trying to use "+me+" texture units while this GPU supports only "+h),ae+=1,me}function Ae(me){const ce=[];return ce.push(me.wrapS),ce.push(me.wrapT),ce.push(me.magFilter),ce.push(me.minFilter),ce.push(me.anisotropy),ce.push(me.internalFormat),ce.push(me.format),ce.push(me.type),ce.push(me.generateMipmaps),ce.push(me.premultiplyAlpha),ce.push(me.flipY),ce.push(me.unpackAlignment),ce.push(me.encoding),ce.join()}function Ie(me,ce){const je=n.get(me);if(me.isVideoTexture&&ii(me),me.isRenderTargetTexture===!1&&me.version>0&&je.__version!==me.version){const yt=me.image;if(yt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(yt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Xt(je,me,ce);return}}t.bindTexture(3553,je.__webglTexture,33984+ce)}function Le(me,ce){const je=n.get(me);if(me.version>0&&je.__version!==me.version){Xt(je,me,ce);return}t.bindTexture(35866,je.__webglTexture,33984+ce)}function De(me,ce){const je=n.get(me);if(me.version>0&&je.__version!==me.version){Xt(je,me,ce);return}t.bindTexture(32879,je.__webglTexture,33984+ce)}function $e(me,ce){const je=n.get(me);if(me.version>0&&je.__version!==me.version){mn(je,me,ce);return}t.bindTexture(34067,je.__webglTexture,33984+ce)}const vt={[Qc]:10497,[Os]:33071,[ku]:33648},zt={[$i]:9728,[Ff]:9984,[kf]:9986,[vi]:9729,[Rg]:9985,[va]:9987};function Ve(me,ce,je){if(je?(a.texParameteri(me,10242,vt[ce.wrapS]),a.texParameteri(me,10243,vt[ce.wrapT]),(me===32879||me===35866)&&a.texParameteri(me,32882,vt[ce.wrapR]),a.texParameteri(me,10240,zt[ce.magFilter]),a.texParameteri(me,10241,zt[ce.minFilter])):(a.texParameteri(me,10242,33071),a.texParameteri(me,10243,33071),(me===32879||me===35866)&&a.texParameteri(me,32882,33071),(ce.wrapS!==Os||ce.wrapT!==Os)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(me,10240,W(ce.magFilter)),a.texParameteri(me,10241,W(ce.minFilter)),ce.minFilter!==$i&&ce.minFilter!==vi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const yt=e.get("EXT_texture_filter_anisotropic");if(ce.type===Ms&&e.has("OES_texture_float_linear")===!1||l===!1&&ce.type===Fs&&e.has("OES_texture_half_float_linear")===!1)return;(ce.anisotropy>1||n.get(ce).__currentAnisotropy)&&(a.texParameterf(me,yt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ce.anisotropy,i.getMaxAnisotropy())),n.get(ce).__currentAnisotropy=ce.anisotropy)}}function gn(me,ce){let je=!1;me.__webglInit===void 0&&(me.__webglInit=!0,ce.addEventListener("dispose",J));const yt=ce.source;let mt=C.get(yt);mt===void 0&&(mt={},C.set(yt,mt));const Ht=Ae(ce);if(Ht!==me.__cacheKey){mt[Ht]===void 0&&(mt[Ht]={texture:a.createTexture(),usedTimes:0},o.memory.textures++,je=!0),mt[Ht].usedTimes++;const Mn=mt[me.__cacheKey];Mn!==void 0&&(mt[me.__cacheKey].usedTimes--,Mn.usedTimes===0&&Y(ce)),me.__cacheKey=Ht,me.__webglTexture=mt[Ht].texture}return je}function Xt(me,ce,je){let yt=3553;ce.isDataArrayTexture&&(yt=35866),ce.isData3DTexture&&(yt=32879);const mt=gn(me,ce),Ht=ce.source;t.bindTexture(yt,me.__webglTexture,33984+je);const Mn=n.get(Ht);if(Ht.version!==Mn.__version||mt===!0){t.activeTexture(33984+je),a.pixelStorei(37440,ce.flipY),a.pixelStorei(37441,ce.premultiplyAlpha),a.pixelStorei(3317,ce.unpackAlignment),a.pixelStorei(37443,0);const be=T(ce)&&R(ce.image)===!1;let ke=M(ce.image,be,!1,f);ke=Kn(ce,ke);const Et=R(ke)||l,hn=r.convert(ce.format,ce.encoding);let nn=r.convert(ce.type),Wt=D(ce.internalFormat,hn,nn,ce.encoding,ce.isVideoTexture);Ve(yt,ce,Et);let Ln;const Dn=ce.mipmaps,Me=l&&ce.isVideoTexture!==!0,Bt=Mn.__version===void 0||mt===!0,Ut=U(ce,ke,Et);if(ce.isDepthTexture)Wt=6402,l?ce.type===Ms?Wt=36012:ce.type===Hl?Wt=33190:ce.type===Iu?Wt=35056:Wt=33189:ce.type===Ms&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ce.format===ql&&Wt===6402&&ce.type!==nS&&ce.type!==Hl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ce.type=Hl,nn=r.convert(ce.type)),ce.format===Nu&&Wt===6402&&(Wt=34041,ce.type!==Iu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ce.type=Iu,nn=r.convert(ce.type))),Bt&&(Me?t.texStorage2D(3553,1,Wt,ke.width,ke.height):t.texImage2D(3553,0,Wt,ke.width,ke.height,0,hn,nn,null));else if(ce.isDataTexture)if(Dn.length>0&&Et){Me&&Bt&&t.texStorage2D(3553,Ut,Wt,Dn[0].width,Dn[0].height);for(let Re=0,Mt=Dn.length;Re<Mt;Re++)Ln=Dn[Re],Me?t.texSubImage2D(3553,Re,0,0,Ln.width,Ln.height,hn,nn,Ln.data):t.texImage2D(3553,Re,Wt,Ln.width,Ln.height,0,hn,nn,Ln.data);ce.generateMipmaps=!1}else Me?(Bt&&t.texStorage2D(3553,Ut,Wt,ke.width,ke.height),t.texSubImage2D(3553,0,0,0,ke.width,ke.height,hn,nn,ke.data)):t.texImage2D(3553,0,Wt,ke.width,ke.height,0,hn,nn,ke.data);else if(ce.isCompressedTexture){Me&&Bt&&t.texStorage2D(3553,Ut,Wt,Dn[0].width,Dn[0].height);for(let Re=0,Mt=Dn.length;Re<Mt;Re++)Ln=Dn[Re],ce.format!==ds?hn!==null?Me?t.compressedTexSubImage2D(3553,Re,0,0,Ln.width,Ln.height,hn,Ln.data):t.compressedTexImage2D(3553,Re,Wt,Ln.width,Ln.height,0,Ln.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Me?t.texSubImage2D(3553,Re,0,0,Ln.width,Ln.height,hn,nn,Ln.data):t.texImage2D(3553,Re,Wt,Ln.width,Ln.height,0,hn,nn,Ln.data)}else if(ce.isDataArrayTexture)Me?(Bt&&t.texStorage3D(35866,Ut,Wt,ke.width,ke.height,ke.depth),t.texSubImage3D(35866,0,0,0,0,ke.width,ke.height,ke.depth,hn,nn,ke.data)):t.texImage3D(35866,0,Wt,ke.width,ke.height,ke.depth,0,hn,nn,ke.data);else if(ce.isData3DTexture)Me?(Bt&&t.texStorage3D(32879,Ut,Wt,ke.width,ke.height,ke.depth),t.texSubImage3D(32879,0,0,0,0,ke.width,ke.height,ke.depth,hn,nn,ke.data)):t.texImage3D(32879,0,Wt,ke.width,ke.height,ke.depth,0,hn,nn,ke.data);else if(ce.isFramebufferTexture){if(Bt)if(Me)t.texStorage2D(3553,Ut,Wt,ke.width,ke.height);else{let Re=ke.width,Mt=ke.height;for(let wn=0;wn<Ut;wn++)t.texImage2D(3553,wn,Wt,Re,Mt,0,hn,nn,null),Re>>=1,Mt>>=1}}else if(Dn.length>0&&Et){Me&&Bt&&t.texStorage2D(3553,Ut,Wt,Dn[0].width,Dn[0].height);for(let Re=0,Mt=Dn.length;Re<Mt;Re++)Ln=Dn[Re],Me?t.texSubImage2D(3553,Re,0,0,hn,nn,Ln):t.texImage2D(3553,Re,Wt,hn,nn,Ln);ce.generateMipmaps=!1}else Me?(Bt&&t.texStorage2D(3553,Ut,Wt,ke.width,ke.height),t.texSubImage2D(3553,0,0,0,hn,nn,ke)):t.texImage2D(3553,0,Wt,hn,nn,ke);B(ce,Et)&&F(yt),Mn.__version=Ht.version,ce.onUpdate&&ce.onUpdate(ce)}me.__version=ce.version}function mn(me,ce,je){if(ce.image.length!==6)return;const yt=gn(me,ce),mt=ce.source;t.bindTexture(34067,me.__webglTexture,33984+je);const Ht=n.get(mt);if(mt.version!==Ht.__version||yt===!0){t.activeTexture(33984+je),a.pixelStorei(37440,ce.flipY),a.pixelStorei(37441,ce.premultiplyAlpha),a.pixelStorei(3317,ce.unpackAlignment),a.pixelStorei(37443,0);const Mn=ce.isCompressedTexture||ce.image[0].isCompressedTexture,be=ce.image[0]&&ce.image[0].isDataTexture,ke=[];for(let Re=0;Re<6;Re++)!Mn&&!be?ke[Re]=M(ce.image[Re],!1,!0,u):ke[Re]=be?ce.image[Re].image:ce.image[Re],ke[Re]=Kn(ce,ke[Re]);const Et=ke[0],hn=R(Et)||l,nn=r.convert(ce.format,ce.encoding),Wt=r.convert(ce.type),Ln=D(ce.internalFormat,nn,Wt,ce.encoding),Dn=l&&ce.isVideoTexture!==!0,Me=Ht.__version===void 0||yt===!0;let Bt=U(ce,Et,hn);Ve(34067,ce,hn);let Ut;if(Mn){Dn&&Me&&t.texStorage2D(34067,Bt,Ln,Et.width,Et.height);for(let Re=0;Re<6;Re++){Ut=ke[Re].mipmaps;for(let Mt=0;Mt<Ut.length;Mt++){const wn=Ut[Mt];ce.format!==ds?nn!==null?Dn?t.compressedTexSubImage2D(34069+Re,Mt,0,0,wn.width,wn.height,nn,wn.data):t.compressedTexImage2D(34069+Re,Mt,Ln,wn.width,wn.height,0,wn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Dn?t.texSubImage2D(34069+Re,Mt,0,0,wn.width,wn.height,nn,Wt,wn.data):t.texImage2D(34069+Re,Mt,Ln,wn.width,wn.height,0,nn,Wt,wn.data)}}}else{Ut=ce.mipmaps,Dn&&Me&&(Ut.length>0&&Bt++,t.texStorage2D(34067,Bt,Ln,ke[0].width,ke[0].height));for(let Re=0;Re<6;Re++)if(be){Dn?t.texSubImage2D(34069+Re,0,0,0,ke[Re].width,ke[Re].height,nn,Wt,ke[Re].data):t.texImage2D(34069+Re,0,Ln,ke[Re].width,ke[Re].height,0,nn,Wt,ke[Re].data);for(let Mt=0;Mt<Ut.length;Mt++){const fi=Ut[Mt].image[Re].image;Dn?t.texSubImage2D(34069+Re,Mt+1,0,0,fi.width,fi.height,nn,Wt,fi.data):t.texImage2D(34069+Re,Mt+1,Ln,fi.width,fi.height,0,nn,Wt,fi.data)}}else{Dn?t.texSubImage2D(34069+Re,0,0,0,nn,Wt,ke[Re]):t.texImage2D(34069+Re,0,Ln,nn,Wt,ke[Re]);for(let Mt=0;Mt<Ut.length;Mt++){const wn=Ut[Mt];Dn?t.texSubImage2D(34069+Re,Mt+1,0,0,nn,Wt,wn.image[Re]):t.texImage2D(34069+Re,Mt+1,Ln,nn,Wt,wn.image[Re])}}}B(ce,hn)&&F(34067),Ht.__version=mt.version,ce.onUpdate&&ce.onUpdate(ce)}me.__version=ce.version}function Nt(me,ce,je,yt,mt){const Ht=r.convert(je.format,je.encoding),Mn=r.convert(je.type),be=D(je.internalFormat,Ht,Mn,je.encoding);n.get(ce).__hasExternalTextures||(mt===32879||mt===35866?t.texImage3D(mt,0,be,ce.width,ce.height,ce.depth,0,Ht,Mn,null):t.texImage2D(mt,0,be,ce.width,ce.height,0,Ht,Mn,null)),t.bindFramebuffer(36160,me),ln(ce)?m.framebufferTexture2DMultisampleEXT(36160,yt,mt,n.get(je).__webglTexture,0,Kt(ce)):a.framebufferTexture2D(36160,yt,mt,n.get(je).__webglTexture,0),t.bindFramebuffer(36160,null)}function vn(me,ce,je){if(a.bindRenderbuffer(36161,me),ce.depthBuffer&&!ce.stencilBuffer){let yt=33189;if(je||ln(ce)){const mt=ce.depthTexture;mt&&mt.isDepthTexture&&(mt.type===Ms?yt=36012:mt.type===Hl&&(yt=33190));const Ht=Kt(ce);ln(ce)?m.renderbufferStorageMultisampleEXT(36161,Ht,yt,ce.width,ce.height):a.renderbufferStorageMultisample(36161,Ht,yt,ce.width,ce.height)}else a.renderbufferStorage(36161,yt,ce.width,ce.height);a.framebufferRenderbuffer(36160,36096,36161,me)}else if(ce.depthBuffer&&ce.stencilBuffer){const yt=Kt(ce);je&&ln(ce)===!1?a.renderbufferStorageMultisample(36161,yt,35056,ce.width,ce.height):ln(ce)?m.renderbufferStorageMultisampleEXT(36161,yt,35056,ce.width,ce.height):a.renderbufferStorage(36161,34041,ce.width,ce.height),a.framebufferRenderbuffer(36160,33306,36161,me)}else{const yt=ce.isWebGLMultipleRenderTargets===!0?ce.texture:[ce.texture];for(let mt=0;mt<yt.length;mt++){const Ht=yt[mt],Mn=r.convert(Ht.format,Ht.encoding),be=r.convert(Ht.type),ke=D(Ht.internalFormat,Mn,be,Ht.encoding),Et=Kt(ce);je&&ln(ce)===!1?a.renderbufferStorageMultisample(36161,Et,ke,ce.width,ce.height):ln(ce)?m.renderbufferStorageMultisampleEXT(36161,Et,ke,ce.width,ce.height):a.renderbufferStorage(36161,ke,ce.width,ce.height)}}a.bindRenderbuffer(36161,null)}function it(me,ce){if(ce&&ce.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,me),!(ce.depthTexture&&ce.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(ce.depthTexture).__webglTexture||ce.depthTexture.image.width!==ce.width||ce.depthTexture.image.height!==ce.height)&&(ce.depthTexture.image.width=ce.width,ce.depthTexture.image.height=ce.height,ce.depthTexture.needsUpdate=!0),Ie(ce.depthTexture,0);const yt=n.get(ce.depthTexture).__webglTexture,mt=Kt(ce);if(ce.depthTexture.format===ql)ln(ce)?m.framebufferTexture2DMultisampleEXT(36160,36096,3553,yt,0,mt):a.framebufferTexture2D(36160,36096,3553,yt,0);else if(ce.depthTexture.format===Nu)ln(ce)?m.framebufferTexture2DMultisampleEXT(36160,33306,3553,yt,0,mt):a.framebufferTexture2D(36160,33306,3553,yt,0);else throw new Error("Unknown depthTexture format")}function tt(me){const ce=n.get(me),je=me.isWebGLCubeRenderTarget===!0;if(me.depthTexture&&!ce.__autoAllocateDepthBuffer){if(je)throw new Error("target.depthTexture not supported in Cube render targets");it(ce.__webglFramebuffer,me)}else if(je){ce.__webglDepthbuffer=[];for(let yt=0;yt<6;yt++)t.bindFramebuffer(36160,ce.__webglFramebuffer[yt]),ce.__webglDepthbuffer[yt]=a.createRenderbuffer(),vn(ce.__webglDepthbuffer[yt],me,!1)}else t.bindFramebuffer(36160,ce.__webglFramebuffer),ce.__webglDepthbuffer=a.createRenderbuffer(),vn(ce.__webglDepthbuffer,me,!1);t.bindFramebuffer(36160,null)}function xt(me,ce,je){const yt=n.get(me);ce!==void 0&&Nt(yt.__webglFramebuffer,me,me.texture,36064,3553),je!==void 0&&tt(me)}function Jt(me){const ce=me.texture,je=n.get(me),yt=n.get(ce);me.addEventListener("dispose",ee),me.isWebGLMultipleRenderTargets!==!0&&(yt.__webglTexture===void 0&&(yt.__webglTexture=a.createTexture()),yt.__version=ce.version,o.memory.textures++);const mt=me.isWebGLCubeRenderTarget===!0,Ht=me.isWebGLMultipleRenderTargets===!0,Mn=R(me)||l;if(mt){je.__webglFramebuffer=[];for(let be=0;be<6;be++)je.__webglFramebuffer[be]=a.createFramebuffer()}else{if(je.__webglFramebuffer=a.createFramebuffer(),Ht)if(i.drawBuffers){const be=me.texture;for(let ke=0,Et=be.length;ke<Et;ke++){const hn=n.get(be[ke]);hn.__webglTexture===void 0&&(hn.__webglTexture=a.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&me.samples>0&&ln(me)===!1){const be=Ht?ce:[ce];je.__webglMultisampledFramebuffer=a.createFramebuffer(),je.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,je.__webglMultisampledFramebuffer);for(let ke=0;ke<be.length;ke++){const Et=be[ke];je.__webglColorRenderbuffer[ke]=a.createRenderbuffer(),a.bindRenderbuffer(36161,je.__webglColorRenderbuffer[ke]);const hn=r.convert(Et.format,Et.encoding),nn=r.convert(Et.type),Wt=D(Et.internalFormat,hn,nn,Et.encoding,me.isXRRenderTarget===!0),Ln=Kt(me);a.renderbufferStorageMultisample(36161,Ln,Wt,me.width,me.height),a.framebufferRenderbuffer(36160,36064+ke,36161,je.__webglColorRenderbuffer[ke])}a.bindRenderbuffer(36161,null),me.depthBuffer&&(je.__webglDepthRenderbuffer=a.createRenderbuffer(),vn(je.__webglDepthRenderbuffer,me,!0)),t.bindFramebuffer(36160,null)}}if(mt){t.bindTexture(34067,yt.__webglTexture),Ve(34067,ce,Mn);for(let be=0;be<6;be++)Nt(je.__webglFramebuffer[be],me,ce,36064,34069+be);B(ce,Mn)&&F(34067),t.unbindTexture()}else if(Ht){const be=me.texture;for(let ke=0,Et=be.length;ke<Et;ke++){const hn=be[ke],nn=n.get(hn);t.bindTexture(3553,nn.__webglTexture),Ve(3553,hn,Mn),Nt(je.__webglFramebuffer,me,hn,36064+ke,3553),B(hn,Mn)&&F(3553)}t.unbindTexture()}else{let be=3553;(me.isWebGL3DRenderTarget||me.isWebGLArrayRenderTarget)&&(l?be=me.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(be,yt.__webglTexture),Ve(be,ce,Mn),Nt(je.__webglFramebuffer,me,ce,36064,be),B(ce,Mn)&&F(be),t.unbindTexture()}me.depthBuffer&&tt(me)}function Dt(me){const ce=R(me)||l,je=me.isWebGLMultipleRenderTargets===!0?me.texture:[me.texture];for(let yt=0,mt=je.length;yt<mt;yt++){const Ht=je[yt];if(B(Ht,ce)){const Mn=me.isWebGLCubeRenderTarget?34067:3553,be=n.get(Ht).__webglTexture;t.bindTexture(Mn,be),F(Mn),t.unbindTexture()}}}function Cn(me){if(l&&me.samples>0&&ln(me)===!1){const ce=me.isWebGLMultipleRenderTargets?me.texture:[me.texture],je=me.width,yt=me.height;let mt=16384;const Ht=[],Mn=me.stencilBuffer?33306:36096,be=n.get(me),ke=me.isWebGLMultipleRenderTargets===!0;if(ke)for(let Et=0;Et<ce.length;Et++)t.bindFramebuffer(36160,be.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064+Et,36161,null),t.bindFramebuffer(36160,be.__webglFramebuffer),a.framebufferTexture2D(36009,36064+Et,3553,null,0);t.bindFramebuffer(36008,be.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,be.__webglFramebuffer);for(let Et=0;Et<ce.length;Et++){Ht.push(36064+Et),me.depthBuffer&&Ht.push(Mn);const hn=be.__ignoreDepthValues!==void 0?be.__ignoreDepthValues:!1;if(hn===!1&&(me.depthBuffer&&(mt|=256),me.stencilBuffer&&(mt|=1024)),ke&&a.framebufferRenderbuffer(36008,36064,36161,be.__webglColorRenderbuffer[Et]),hn===!0&&(a.invalidateFramebuffer(36008,[Mn]),a.invalidateFramebuffer(36009,[Mn])),ke){const nn=n.get(ce[Et]).__webglTexture;a.framebufferTexture2D(36009,36064,3553,nn,0)}a.blitFramebuffer(0,0,je,yt,0,0,je,yt,mt,9728),A&&a.invalidateFramebuffer(36008,Ht)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),ke)for(let Et=0;Et<ce.length;Et++){t.bindFramebuffer(36160,be.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064+Et,36161,be.__webglColorRenderbuffer[Et]);const hn=n.get(ce[Et]).__webglTexture;t.bindFramebuffer(36160,be.__webglFramebuffer),a.framebufferTexture2D(36009,36064+Et,3553,hn,0)}t.bindFramebuffer(36009,be.__webglMultisampledFramebuffer)}}function Kt(me){return Math.min(g,me.samples)}function ln(me){const ce=n.get(me);return l&&me.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ce.__useRenderToTexture!==!1}function ii(me){const ce=o.render.frame;v.get(me)!==ce&&(v.set(me,ce),me.update())}function Kn(me,ce){const je=me.encoding,yt=me.format,mt=me.type;return me.isCompressedTexture===!0||me.isVideoTexture===!0||me.format===M_||je!==Ar&&(je===Gn?l===!1?e.has("EXT_sRGB")===!0&&yt===ds?(me.format=M_,me.minFilter=vi,me.generateMipmaps=!1):ce=lS.sRGBToLinear(ce):(yt!==ds||mt!==Tr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",je)),ce}this.allocateTextureUnit=xe,this.resetTextureUnits=ve,this.setTexture2D=Ie,this.setTexture2DArray=Le,this.setTexture3D=De,this.setTextureCube=$e,this.rebindTextures=xt,this.setupRenderTarget=Jt,this.updateRenderTargetMipmap=Dt,this.updateMultisampleRenderTarget=Cn,this.setupDepthRenderbuffer=tt,this.setupFrameBufferTexture=Nt,this.useMultisampledRTT=ln}function Q2(a,e,t){const n=t.isWebGL2;function i(r,o=null){let l;if(r===Tr)return 5121;if(r===c2)return 32819;if(r===l2)return 32820;if(r===r2)return 5120;if(r===o2)return 5122;if(r===nS)return 5123;if(r===a2)return 5124;if(r===Hl)return 5125;if(r===Ms)return 5126;if(r===Fs)return n?5131:(l=e.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(r===h2)return 6406;if(r===ds)return 6408;if(r===d2)return 6409;if(r===f2)return 6410;if(r===ql)return 6402;if(r===Nu)return 34041;if(r===vu)return 6403;if(r===u2)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===M_)return l=e.get("EXT_sRGB"),l!==null?l.SRGB_ALPHA_EXT:null;if(r===p2)return 36244;if(r===gf)return 33319;if(r===m2)return 33320;if(r===g2)return 36249;if(r===Um||r===jy||r===qy||r===zm)if(o===Gn)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(r===Um)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===jy)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===qy)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===zm)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(r===Um)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===jy)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===qy)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===zm)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===x_||r===kC||r===w_||r===NC)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(r===x_)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===kC)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===w_)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===NC)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===iS)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===b_||r===C_)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(r===b_)return o===Gn?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(r===C_)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===E_||r===UC||r===zC||r===GC||r===HC||r===VC||r===WC||r===QC||r===jC||r===qC||r===XC||r===YC||r===JC||r===KC)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(r===E_)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===UC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===zC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===GC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===HC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===VC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===WC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===QC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===jC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===qC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===XC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===YC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===JC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===KC)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===S_)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(r===S_)return o===Gn?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===Iu?n?34042:(l=e.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null):a[r]!==void 0?a[r]:null}return{convert:i}}class j2 extends ns{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ua extends Ft{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Uj={type:"move"};class Sb{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ua,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ua,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ua,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const l=this._targetRay,h=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const b of e.hand.values()){const C=t.getJointPose(b,n);if(u.joints[b.jointName]===void 0){const I=new ua;I.matrixAutoUpdate=!1,I.visible=!1,u.joints[b.jointName]=I,u.add(I)}const S=u.joints[b.jointName];C!==null&&(S.matrix.fromArray(C.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.jointRadius=C.radius),S.visible=C!==null}const f=u.joints["index-finger-tip"],g=u.joints["thumb-tip"],m=f.position.distanceTo(g.position),A=.02,v=.005;u.inputState.pinching&&m>A+v?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&m<=A-v&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(h.matrix.fromArray(r.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),r.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(r.linearVelocity)):h.hasLinearVelocity=!1,r.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(r.angularVelocity)):h.hasAngularVelocity=!1));l!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&r!==null&&(i=r),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(Uj)))}return l!==null&&(l.visible=i!==null),h!==null&&(h.visible=r!==null),u!==null&&(u.visible=o!==null),this}}class AS extends Ii{constructor(e,t,n,i,r,o,l,h,u,f){if(f=f!==void 0?f:ql,f!==ql&&f!==Nu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&f===ql&&(n=Hl),n===void 0&&f===Nu&&(n=Iu),super(null,i,r,o,l,h,f,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=l!==void 0?l:$i,this.minFilter=h!==void 0?h:$i,this.flipY=!1,this.generateMipmaps=!1}}class zj extends Lr{constructor(e,t){super();const n=this;let i=null,r=1,o=null,l="local-floor",h=null,u=null,f=null,g=null,m=null,A=null;const v=t.getContextAttributes();let b=null,C=null;const S=[],I=[],M=new ns;M.layers.enable(1),M.viewport=new Bn;const R=new ns;R.layers.enable(2),R.viewport=new Bn;const T=[M,R],B=new j2;B.layers.enable(1),B.layers.enable(2);let F=null,D=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ae){let Ie=S[Ae];return Ie===void 0&&(Ie=new Sb,S[Ae]=Ie),Ie.getTargetRaySpace()},this.getControllerGrip=function(Ae){let Ie=S[Ae];return Ie===void 0&&(Ie=new Sb,S[Ae]=Ie),Ie.getGripSpace()},this.getHand=function(Ae){let Ie=S[Ae];return Ie===void 0&&(Ie=new Sb,S[Ae]=Ie),Ie.getHandSpace()};function U(Ae){const Ie=I.indexOf(Ae.inputSource);if(Ie===-1)return;const Le=S[Ie];Le!==void 0&&Le.dispatchEvent({type:Ae.type,data:Ae.inputSource})}function W(){i.removeEventListener("select",U),i.removeEventListener("selectstart",U),i.removeEventListener("selectend",U),i.removeEventListener("squeeze",U),i.removeEventListener("squeezestart",U),i.removeEventListener("squeezeend",U),i.removeEventListener("end",W),i.removeEventListener("inputsourceschange",J);for(let Ae=0;Ae<S.length;Ae++){const Ie=I[Ae];Ie!==null&&(I[Ae]=null,S[Ae].disconnect(Ie))}F=null,D=null,e.setRenderTarget(b),m=null,g=null,f=null,i=null,C=null,xe.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ae){r=Ae,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ae){l=Ae,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||o},this.setReferenceSpace=function(Ae){h=Ae},this.getBaseLayer=function(){return g!==null?g:m},this.getBinding=function(){return f},this.getFrame=function(){return A},this.getSession=function(){return i},this.setSession=async function(Ae){if(i=Ae,i!==null){if(b=e.getRenderTarget(),i.addEventListener("select",U),i.addEventListener("selectstart",U),i.addEventListener("selectend",U),i.addEventListener("squeeze",U),i.addEventListener("squeezestart",U),i.addEventListener("squeezeend",U),i.addEventListener("end",W),i.addEventListener("inputsourceschange",J),v.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Ie={antialias:i.renderState.layers===void 0?v.antialias:!0,alpha:v.alpha,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:r};m=new XRWebGLLayer(i,t,Ie),i.updateRenderState({baseLayer:m}),C=new Xr(m.framebufferWidth,m.framebufferHeight,{format:ds,type:Tr,encoding:e.outputEncoding,stencilBuffer:v.stencil})}else{let Ie=null,Le=null,De=null;v.depth&&(De=v.stencil?35056:33190,Ie=v.stencil?Nu:ql,Le=v.stencil?Iu:Hl);const $e={colorFormat:32856,depthFormat:De,scaleFactor:r};f=new XRWebGLBinding(i,t),g=f.createProjectionLayer($e),i.updateRenderState({layers:[g]}),C=new Xr(g.textureWidth,g.textureHeight,{format:ds,type:Tr,depthTexture:new AS(g.textureWidth,g.textureHeight,Le,void 0,void 0,void 0,void 0,void 0,void 0,Ie),stencilBuffer:v.stencil,encoding:e.outputEncoding,samples:v.antialias?4:0});const vt=e.properties.get(C);vt.__ignoreDepthValues=g.ignoreDepthValues}C.isXRRenderTarget=!0,this.setFoveation(1),h=null,o=await i.requestReferenceSpace(l),xe.setContext(i),xe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function J(Ae){for(let Ie=0;Ie<Ae.removed.length;Ie++){const Le=Ae.removed[Ie],De=I.indexOf(Le);De>=0&&(I[De]=null,S[De].dispatchEvent({type:"disconnected",data:Le}))}for(let Ie=0;Ie<Ae.added.length;Ie++){const Le=Ae.added[Ie];let De=I.indexOf(Le);if(De===-1){for(let vt=0;vt<S.length;vt++)if(vt>=I.length){I.push(Le),De=vt;break}else if(I[vt]===null){I[vt]=Le,De=vt;break}if(De===-1)break}const $e=S[De];$e&&$e.dispatchEvent({type:"connected",data:Le})}}const ee=new q,Q=new q;function Y(Ae,Ie,Le){ee.setFromMatrixPosition(Ie.matrixWorld),Q.setFromMatrixPosition(Le.matrixWorld);const De=ee.distanceTo(Q),$e=Ie.projectionMatrix.elements,vt=Le.projectionMatrix.elements,zt=$e[14]/($e[10]-1),Ve=$e[14]/($e[10]+1),gn=($e[9]+1)/$e[5],Xt=($e[9]-1)/$e[5],mn=($e[8]-1)/$e[0],Nt=(vt[8]+1)/vt[0],vn=zt*mn,it=zt*Nt,tt=De/(-mn+Nt),xt=tt*-mn;Ie.matrixWorld.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.translateX(xt),Ae.translateZ(tt),Ae.matrixWorld.compose(Ae.position,Ae.quaternion,Ae.scale),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert();const Jt=zt+tt,Dt=Ve+tt,Cn=vn-xt,Kt=it+(De-xt),ln=gn*Ve/Dt*Jt,ii=Xt*Ve/Dt*Jt;Ae.projectionMatrix.makePerspective(Cn,Kt,ln,ii,Jt,Dt)}function se(Ae,Ie){Ie===null?Ae.matrixWorld.copy(Ae.matrix):Ae.matrixWorld.multiplyMatrices(Ie.matrixWorld,Ae.matrix),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert()}this.updateCamera=function(Ae){if(i===null)return;B.near=R.near=M.near=Ae.near,B.far=R.far=M.far=Ae.far,(F!==B.near||D!==B.far)&&(i.updateRenderState({depthNear:B.near,depthFar:B.far}),F=B.near,D=B.far);const Ie=Ae.parent,Le=B.cameras;se(B,Ie);for(let $e=0;$e<Le.length;$e++)se(Le[$e],Ie);B.matrixWorld.decompose(B.position,B.quaternion,B.scale),Ae.matrix.copy(B.matrix),Ae.matrix.decompose(Ae.position,Ae.quaternion,Ae.scale);const De=Ae.children;for(let $e=0,vt=De.length;$e<vt;$e++)De[$e].updateMatrixWorld(!0);Le.length===2?Y(B,M,R):B.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return B},this.getFoveation=function(){if(g!==null)return g.fixedFoveation;if(m!==null)return m.fixedFoveation},this.setFoveation=function(Ae){g!==null&&(g.fixedFoveation=Ae),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=Ae)};let ae=null;function ve(Ae,Ie){if(u=Ie.getViewerPose(h||o),A=Ie,u!==null){const Le=u.views;m!==null&&(e.setRenderTargetFramebuffer(C,m.framebuffer),e.setRenderTarget(C));let De=!1;Le.length!==B.cameras.length&&(B.cameras.length=0,De=!0);for(let $e=0;$e<Le.length;$e++){const vt=Le[$e];let zt=null;if(m!==null)zt=m.getViewport(vt);else{const gn=f.getViewSubImage(g,vt);zt=gn.viewport,$e===0&&(e.setRenderTargetTextures(C,gn.colorTexture,g.ignoreDepthValues?void 0:gn.depthStencilTexture),e.setRenderTarget(C))}let Ve=T[$e];Ve===void 0&&(Ve=new ns,Ve.layers.enable($e),Ve.viewport=new Bn,T[$e]=Ve),Ve.matrix.fromArray(vt.transform.matrix),Ve.projectionMatrix.fromArray(vt.projectionMatrix),Ve.viewport.set(zt.x,zt.y,zt.width,zt.height),$e===0&&B.matrix.copy(Ve.matrix),De===!0&&B.cameras.push(Ve)}}for(let Le=0;Le<S.length;Le++){const De=I[Le],$e=S[Le];De!==null&&$e!==void 0&&$e.update(De,Ie,h||o)}ae&&ae(Ae,Ie),A=null}const xe=new z2;xe.setAnimationLoop(ve),this.setAnimationLoop=function(Ae){ae=Ae},this.dispose=function(){}}}function Gj(a,e){function t(b,C){b.fogColor.value.copy(C.color),C.isFog?(b.fogNear.value=C.near,b.fogFar.value=C.far):C.isFogExp2&&(b.fogDensity.value=C.density)}function n(b,C,S,I,M){C.isMeshBasicMaterial||C.isMeshLambertMaterial?i(b,C):C.isMeshToonMaterial?(i(b,C),f(b,C)):C.isMeshPhongMaterial?(i(b,C),u(b,C)):C.isMeshStandardMaterial?(i(b,C),g(b,C),C.isMeshPhysicalMaterial&&m(b,C,M)):C.isMeshMatcapMaterial?(i(b,C),A(b,C)):C.isMeshDepthMaterial?i(b,C):C.isMeshDistanceMaterial?(i(b,C),v(b,C)):C.isMeshNormalMaterial?i(b,C):C.isLineBasicMaterial?(r(b,C),C.isLineDashedMaterial&&o(b,C)):C.isPointsMaterial?l(b,C,S,I):C.isSpriteMaterial?h(b,C):C.isShadowMaterial?(b.color.value.copy(C.color),b.opacity.value=C.opacity):C.isShaderMaterial&&(C.uniformsNeedUpdate=!1)}function i(b,C){b.opacity.value=C.opacity,C.color&&b.diffuse.value.copy(C.color),C.emissive&&b.emissive.value.copy(C.emissive).multiplyScalar(C.emissiveIntensity),C.map&&(b.map.value=C.map),C.alphaMap&&(b.alphaMap.value=C.alphaMap),C.bumpMap&&(b.bumpMap.value=C.bumpMap,b.bumpScale.value=C.bumpScale,C.side===Wr&&(b.bumpScale.value*=-1)),C.displacementMap&&(b.displacementMap.value=C.displacementMap,b.displacementScale.value=C.displacementScale,b.displacementBias.value=C.displacementBias),C.emissiveMap&&(b.emissiveMap.value=C.emissiveMap),C.normalMap&&(b.normalMap.value=C.normalMap,b.normalScale.value.copy(C.normalScale),C.side===Wr&&b.normalScale.value.negate()),C.specularMap&&(b.specularMap.value=C.specularMap),C.alphaTest>0&&(b.alphaTest.value=C.alphaTest);const S=e.get(C).envMap;if(S&&(b.envMap.value=S,b.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=C.reflectivity,b.ior.value=C.ior,b.refractionRatio.value=C.refractionRatio),C.lightMap){b.lightMap.value=C.lightMap;const R=a.physicallyCorrectLights!==!0?Math.PI:1;b.lightMapIntensity.value=C.lightMapIntensity*R}C.aoMap&&(b.aoMap.value=C.aoMap,b.aoMapIntensity.value=C.aoMapIntensity);let I;C.map?I=C.map:C.specularMap?I=C.specularMap:C.displacementMap?I=C.displacementMap:C.normalMap?I=C.normalMap:C.bumpMap?I=C.bumpMap:C.roughnessMap?I=C.roughnessMap:C.metalnessMap?I=C.metalnessMap:C.alphaMap?I=C.alphaMap:C.emissiveMap?I=C.emissiveMap:C.clearcoatMap?I=C.clearcoatMap:C.clearcoatNormalMap?I=C.clearcoatNormalMap:C.clearcoatRoughnessMap?I=C.clearcoatRoughnessMap:C.iridescenceMap?I=C.iridescenceMap:C.iridescenceThicknessMap?I=C.iridescenceThicknessMap:C.specularIntensityMap?I=C.specularIntensityMap:C.specularColorMap?I=C.specularColorMap:C.transmissionMap?I=C.transmissionMap:C.thicknessMap?I=C.thicknessMap:C.sheenColorMap?I=C.sheenColorMap:C.sheenRoughnessMap&&(I=C.sheenRoughnessMap),I!==void 0&&(I.isWebGLRenderTarget&&(I=I.texture),I.matrixAutoUpdate===!0&&I.updateMatrix(),b.uvTransform.value.copy(I.matrix));let M;C.aoMap?M=C.aoMap:C.lightMap&&(M=C.lightMap),M!==void 0&&(M.isWebGLRenderTarget&&(M=M.texture),M.matrixAutoUpdate===!0&&M.updateMatrix(),b.uv2Transform.value.copy(M.matrix))}function r(b,C){b.diffuse.value.copy(C.color),b.opacity.value=C.opacity}function o(b,C){b.dashSize.value=C.dashSize,b.totalSize.value=C.dashSize+C.gapSize,b.scale.value=C.scale}function l(b,C,S,I){b.diffuse.value.copy(C.color),b.opacity.value=C.opacity,b.size.value=C.size*S,b.scale.value=I*.5,C.map&&(b.map.value=C.map),C.alphaMap&&(b.alphaMap.value=C.alphaMap),C.alphaTest>0&&(b.alphaTest.value=C.alphaTest);let M;C.map?M=C.map:C.alphaMap&&(M=C.alphaMap),M!==void 0&&(M.matrixAutoUpdate===!0&&M.updateMatrix(),b.uvTransform.value.copy(M.matrix))}function h(b,C){b.diffuse.value.copy(C.color),b.opacity.value=C.opacity,b.rotation.value=C.rotation,C.map&&(b.map.value=C.map),C.alphaMap&&(b.alphaMap.value=C.alphaMap),C.alphaTest>0&&(b.alphaTest.value=C.alphaTest);let S;C.map?S=C.map:C.alphaMap&&(S=C.alphaMap),S!==void 0&&(S.matrixAutoUpdate===!0&&S.updateMatrix(),b.uvTransform.value.copy(S.matrix))}function u(b,C){b.specular.value.copy(C.specular),b.shininess.value=Math.max(C.shininess,1e-4)}function f(b,C){C.gradientMap&&(b.gradientMap.value=C.gradientMap)}function g(b,C){b.roughness.value=C.roughness,b.metalness.value=C.metalness,C.roughnessMap&&(b.roughnessMap.value=C.roughnessMap),C.metalnessMap&&(b.metalnessMap.value=C.metalnessMap),e.get(C).envMap&&(b.envMapIntensity.value=C.envMapIntensity)}function m(b,C,S){b.ior.value=C.ior,C.sheen>0&&(b.sheenColor.value.copy(C.sheenColor).multiplyScalar(C.sheen),b.sheenRoughness.value=C.sheenRoughness,C.sheenColorMap&&(b.sheenColorMap.value=C.sheenColorMap),C.sheenRoughnessMap&&(b.sheenRoughnessMap.value=C.sheenRoughnessMap)),C.clearcoat>0&&(b.clearcoat.value=C.clearcoat,b.clearcoatRoughness.value=C.clearcoatRoughness,C.clearcoatMap&&(b.clearcoatMap.value=C.clearcoatMap),C.clearcoatRoughnessMap&&(b.clearcoatRoughnessMap.value=C.clearcoatRoughnessMap),C.clearcoatNormalMap&&(b.clearcoatNormalScale.value.copy(C.clearcoatNormalScale),b.clearcoatNormalMap.value=C.clearcoatNormalMap,C.side===Wr&&b.clearcoatNormalScale.value.negate())),C.iridescence>0&&(b.iridescence.value=C.iridescence,b.iridescenceIOR.value=C.iridescenceIOR,b.iridescenceThicknessMinimum.value=C.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum.value=C.iridescenceThicknessRange[1],C.iridescenceMap&&(b.iridescenceMap.value=C.iridescenceMap),C.iridescenceThicknessMap&&(b.iridescenceThicknessMap.value=C.iridescenceThicknessMap)),C.transmission>0&&(b.transmission.value=C.transmission,b.transmissionSamplerMap.value=S.texture,b.transmissionSamplerSize.value.set(S.width,S.height),C.transmissionMap&&(b.transmissionMap.value=C.transmissionMap),b.thickness.value=C.thickness,C.thicknessMap&&(b.thicknessMap.value=C.thicknessMap),b.attenuationDistance.value=C.attenuationDistance,b.attenuationColor.value.copy(C.attenuationColor)),b.specularIntensity.value=C.specularIntensity,b.specularColor.value.copy(C.specularColor),C.specularIntensityMap&&(b.specularIntensityMap.value=C.specularIntensityMap),C.specularColorMap&&(b.specularColorMap.value=C.specularColorMap)}function A(b,C){C.matcap&&(b.matcap.value=C.matcap)}function v(b,C){b.referencePosition.value.copy(C.referencePosition),b.nearDistance.value=C.nearDistance,b.farDistance.value=C.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function Hj(a,e,t,n){let i={},r={},o=[];const l=t.isWebGL2?a.getParameter(35375):0;function h(I,M){const R=M.program;n.uniformBlockBinding(I,R)}function u(I,M){let R=i[I.id];R===void 0&&(v(I),R=f(I),i[I.id]=R,I.addEventListener("dispose",C));const T=M.program;n.updateUBOMapping(I,T);const B=e.render.frame;r[I.id]!==B&&(m(I),r[I.id]=B)}function f(I){const M=g();I.__bindingPointIndex=M;const R=a.createBuffer(),T=I.__size,B=I.usage;return a.bindBuffer(35345,R),a.bufferData(35345,T,B),a.bindBuffer(35345,null),a.bindBufferBase(35345,M,R),R}function g(){for(let I=0;I<l;I++)if(o.indexOf(I)===-1)return o.push(I),I;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(I){const M=i[I.id],R=I.uniforms,T=I.__cache;a.bindBuffer(35345,M);for(let B=0,F=R.length;B<F;B++){const D=R[B];if(A(D,B,T)===!0){const U=D.value,W=D.__offset;typeof U=="number"?(D.__data[0]=U,a.bufferSubData(35345,W,D.__data)):(D.value.isMatrix3?(D.__data[0]=D.value.elements[0],D.__data[1]=D.value.elements[1],D.__data[2]=D.value.elements[2],D.__data[3]=D.value.elements[0],D.__data[4]=D.value.elements[3],D.__data[5]=D.value.elements[4],D.__data[6]=D.value.elements[5],D.__data[7]=D.value.elements[0],D.__data[8]=D.value.elements[6],D.__data[9]=D.value.elements[7],D.__data[10]=D.value.elements[8],D.__data[11]=D.value.elements[0]):U.toArray(D.__data),a.bufferSubData(35345,W,D.__data))}}a.bindBuffer(35345,null)}function A(I,M,R){const T=I.value;if(R[M]===void 0)return typeof T=="number"?R[M]=T:R[M]=T.clone(),!0;if(typeof T=="number"){if(R[M]!==T)return R[M]=T,!0}else{const B=R[M];if(B.equals(T)===!1)return B.copy(T),!0}return!1}function v(I){const M=I.uniforms;let R=0;const T=16;let B=0;for(let F=0,D=M.length;F<D;F++){const U=M[F],W=b(U);if(U.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),U.__offset=R,F>0){B=R%T;const J=T-B;B!==0&&J-W.boundary<0&&(R+=T-B,U.__offset=R)}R+=W.storage}return B=R%T,B>0&&(R+=T-B),I.__size=R,I.__cache={},this}function b(I){const M=I.value,R={boundary:0,storage:0};return typeof M=="number"?(R.boundary=4,R.storage=4):M.isVector2?(R.boundary=8,R.storage=8):M.isVector3||M.isColor?(R.boundary=16,R.storage=12):M.isVector4?(R.boundary=16,R.storage=16):M.isMatrix3?(R.boundary=48,R.storage=48):M.isMatrix4?(R.boundary=64,R.storage=64):M.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",M),R}function C(I){const M=I.target;M.removeEventListener("dispose",C);const R=o.indexOf(M.__bindingPointIndex);o.splice(R,1),a.deleteBuffer(i[M.id]),delete i[M.id],delete r[M.id]}function S(){for(const I in i)a.deleteBuffer(i[I]);o=[],i={},r={}}return{bind:h,update:u,dispose:S}}function Vj(){const a=cg("canvas");return a.style.display="block",a}function Dg(a={}){this.isWebGLRenderer=!0;const e=a.canvas!==void 0?a.canvas:Vj(),t=a.context!==void 0?a.context:null,n=a.depth!==void 0?a.depth:!0,i=a.stencil!==void 0?a.stencil:!0,r=a.antialias!==void 0?a.antialias:!1,o=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0,l=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1,h=a.powerPreference!==void 0?a.powerPreference:"default",u=a.failIfMajorPerformanceCaveat!==void 0?a.failIfMajorPerformanceCaveat:!1;let f;t!==null?f=t.getContextAttributes().alpha:f=a.alpha!==void 0?a.alpha:!1;let g=null,m=null;const A=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ar,this.physicallyCorrectLights=!1,this.toneMapping=ma,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const b=this;let C=!1,S=0,I=0,M=null,R=-1,T=null;const B=new Bn,F=new Bn;let D=null,U=e.width,W=e.height,J=1,ee=null,Q=null;const Y=new Bn(0,0,U,W),se=new Bn(0,0,U,W);let ae=!1;const ve=new fv;let xe=!1,Ae=!1,Ie=null;const Le=new fn,De=new Xe,$e=new q,vt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function zt(){return M===null?J:1}let Ve=t;function gn(he,Ge){for(let ze=0;ze<he.length;ze++){const Ne=he[ze],nt=e.getContext(Ne,Ge);if(nt!==null)return nt}return null}try{const he={alpha:!0,depth:n,stencil:i,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${cv}`),e.addEventListener("webglcontextlost",Wt,!1),e.addEventListener("webglcontextrestored",Ln,!1),e.addEventListener("webglcontextcreationerror",Dn,!1),Ve===null){const Ge=["webgl2","webgl","experimental-webgl"];if(b.isWebGL1Renderer===!0&&Ge.shift(),Ve=gn(Ge,he),Ve===null)throw gn(Ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ve.getShaderPrecisionFormat===void 0&&(Ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(he){throw console.error("THREE.WebGLRenderer: "+he.message),he}let Xt,mn,Nt,vn,it,tt,xt,Jt,Dt,Cn,Kt,ln,ii,Kn,me,ce,je,yt,mt,Ht,Mn,be,ke,Et;function hn(){Xt=new r6(Ve),mn=new $8(Ve,Xt,a),Xt.init(mn),be=new Q2(Ve,Xt,mn),Nt=new kj(Ve,Xt,mn),vn=new c6,it=new Ej,tt=new Nj(Ve,Xt,Nt,it,mn,be,vn),xt=new t6(b),Jt=new s6(b),Dt=new _W(Ve,mn),ke=new K8(Ve,Xt,Dt,mn),Cn=new o6(Ve,Dt,vn,ke),Kt=new d6(Ve,Cn,Dt,vn),mt=new u6(Ve,mn,tt),ce=new e6(it),ln=new Cj(b,xt,Jt,Xt,mn,ke,ce),ii=new Gj(b,it),Kn=new Mj,me=new Lj(Xt,mn),yt=new J8(b,xt,Nt,Kt,f,o),je=new Fj(b,Kt,mn),Et=new Hj(Ve,vn,mn,Nt),Ht=new Z8(Ve,Xt,vn,mn),Mn=new a6(Ve,Xt,vn,mn),vn.programs=ln.programs,b.capabilities=mn,b.extensions=Xt,b.properties=it,b.renderLists=Kn,b.shadowMap=je,b.state=Nt,b.info=vn}hn();const nn=new zj(b,Ve);this.xr=nn,this.getContext=function(){return Ve},this.getContextAttributes=function(){return Ve.getContextAttributes()},this.forceContextLoss=function(){const he=Xt.get("WEBGL_lose_context");he&&he.loseContext()},this.forceContextRestore=function(){const he=Xt.get("WEBGL_lose_context");he&&he.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(he){he!==void 0&&(J=he,this.setSize(U,W,!1))},this.getSize=function(he){return he.set(U,W)},this.setSize=function(he,Ge,ze){if(nn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}U=he,W=Ge,e.width=Math.floor(he*J),e.height=Math.floor(Ge*J),ze!==!1&&(e.style.width=he+"px",e.style.height=Ge+"px"),this.setViewport(0,0,he,Ge)},this.getDrawingBufferSize=function(he){return he.set(U*J,W*J).floor()},this.setDrawingBufferSize=function(he,Ge,ze){U=he,W=Ge,J=ze,e.width=Math.floor(he*ze),e.height=Math.floor(Ge*ze),this.setViewport(0,0,he,Ge)},this.getCurrentViewport=function(he){return he.copy(B)},this.getViewport=function(he){return he.copy(Y)},this.setViewport=function(he,Ge,ze,Ne){he.isVector4?Y.set(he.x,he.y,he.z,he.w):Y.set(he,Ge,ze,Ne),Nt.viewport(B.copy(Y).multiplyScalar(J).floor())},this.getScissor=function(he){return he.copy(se)},this.setScissor=function(he,Ge,ze,Ne){he.isVector4?se.set(he.x,he.y,he.z,he.w):se.set(he,Ge,ze,Ne),Nt.scissor(F.copy(se).multiplyScalar(J).floor())},this.getScissorTest=function(){return ae},this.setScissorTest=function(he){Nt.setScissorTest(ae=he)},this.setOpaqueSort=function(he){ee=he},this.setTransparentSort=function(he){Q=he},this.getClearColor=function(he){return he.copy(yt.getClearColor())},this.setClearColor=function(){yt.setClearColor.apply(yt,arguments)},this.getClearAlpha=function(){return yt.getClearAlpha()},this.setClearAlpha=function(){yt.setClearAlpha.apply(yt,arguments)},this.clear=function(he=!0,Ge=!0,ze=!0){let Ne=0;he&&(Ne|=16384),Ge&&(Ne|=256),ze&&(Ne|=1024),Ve.clear(Ne)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Wt,!1),e.removeEventListener("webglcontextrestored",Ln,!1),e.removeEventListener("webglcontextcreationerror",Dn,!1),Kn.dispose(),me.dispose(),it.dispose(),xt.dispose(),Jt.dispose(),Kt.dispose(),ke.dispose(),Et.dispose(),ln.dispose(),nn.dispose(),nn.removeEventListener("sessionstart",wn),nn.removeEventListener("sessionend",fi),Ie&&(Ie.dispose(),Ie=null),Vi.stop()};function Wt(he){he.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Ln(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const he=vn.autoReset,Ge=je.enabled,ze=je.autoUpdate,Ne=je.needsUpdate,nt=je.type;hn(),vn.autoReset=he,je.enabled=Ge,je.autoUpdate=ze,je.needsUpdate=Ne,je.type=nt}function Dn(he){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",he.statusMessage)}function Me(he){const Ge=he.target;Ge.removeEventListener("dispose",Me),Bt(Ge)}function Bt(he){Ut(he),it.remove(he)}function Ut(he){const Ge=it.get(he).programs;Ge!==void 0&&(Ge.forEach(function(ze){ln.releaseProgram(ze)}),he.isShaderMaterial&&ln.releaseShaderCache(he))}this.renderBufferDirect=function(he,Ge,ze,Ne,nt,j){Ge===null&&(Ge=vt);const ie=nt.isMesh&&nt.matrixWorld.determinant()<0,pe=yo(he,Ge,ze,Ne,nt);Nt.setMaterial(Ne,ie);let Se=ze.index;const We=ze.attributes.position;if(Se===null){if(We===void 0||We.count===0)return}else if(Se.count===0)return;let Oe=1;Ne.wireframe===!0&&(Se=Cn.getWireframeAttribute(ze),Oe=2),ke.setup(nt,Ne,pe,ze,Se);let Ke,lt=Ht;Se!==null&&(Ke=Dt.get(Se),lt=Mn,lt.setIndex(Ke));const Tt=Se!==null?Se.count:We.count,ut=ze.drawRange.start*Oe,wt=ze.drawRange.count*Oe,Zt=j!==null?j.start*Oe:0,bt=j!==null?j.count*Oe:1/0,xn=Math.max(ut,Zt),pn=Math.min(Tt,ut+wt,Zt+bt)-1,$t=Math.max(0,pn-xn+1);if($t!==0){if(nt.isMesh)Ne.wireframe===!0?(Nt.setLineWidth(Ne.wireframeLinewidth*zt()),lt.setMode(1)):lt.setMode(4);else if(nt.isLine){let un=Ne.linewidth;un===void 0&&(un=1),Nt.setLineWidth(un*zt()),nt.isLineSegments?lt.setMode(1):nt.isLineLoop?lt.setMode(2):lt.setMode(3)}else nt.isPoints?lt.setMode(0):nt.isSprite&&lt.setMode(4);if(nt.isInstancedMesh)lt.renderInstances(xn,$t,nt.count);else if(ze.isInstancedBufferGeometry){const un=Math.min(ze.instanceCount,ze._maxInstanceCount);lt.renderInstances(xn,$t,un)}else lt.render(xn,$t)}},this.compile=function(he,Ge){function ze(Ne,nt,j){Ne.transparent===!0&&Ne.side===ir?(Ne.side=Wr,Ne.needsUpdate=!0,ac(Ne,nt,j),Ne.side=zo,Ne.needsUpdate=!0,ac(Ne,nt,j),Ne.side=ir):ac(Ne,nt,j)}m=me.get(he),m.init(),v.push(m),he.traverseVisible(function(Ne){Ne.isLight&&Ne.layers.test(Ge.layers)&&(m.pushLight(Ne),Ne.castShadow&&m.pushShadow(Ne))}),m.setupLights(b.physicallyCorrectLights),he.traverse(function(Ne){const nt=Ne.material;if(nt)if(Array.isArray(nt))for(let j=0;j<nt.length;j++){const ie=nt[j];ze(ie,he,Ne)}else ze(nt,he,Ne)}),v.pop(),m=null};let Re=null;function Mt(he){Re&&Re(he)}function wn(){Vi.stop()}function fi(){Vi.start()}const Vi=new z2;Vi.setAnimationLoop(Mt),typeof self<"u"&&Vi.setContext(self),this.setAnimationLoop=function(he){Re=he,nn.setAnimationLoop(he),he===null?Vi.stop():Vi.start()},nn.addEventListener("sessionstart",wn),nn.addEventListener("sessionend",fi),this.render=function(he,Ge){if(Ge!==void 0&&Ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(C===!0)return;he.matrixWorldAutoUpdate===!0&&he.updateMatrixWorld(),Ge.parent===null&&Ge.matrixWorldAutoUpdate===!0&&Ge.updateMatrixWorld(),nn.enabled===!0&&nn.isPresenting===!0&&(nn.cameraAutoUpdate===!0&&nn.updateCamera(Ge),Ge=nn.getCamera()),he.isScene===!0&&he.onBeforeRender(b,he,Ge,M),m=me.get(he,v.length),m.init(),v.push(m),Le.multiplyMatrices(Ge.projectionMatrix,Ge.matrixWorldInverse),ve.setFromProjectionMatrix(Le),Ae=this.localClippingEnabled,xe=ce.init(this.clippingPlanes,Ae,Ge),g=Kn.get(he,A.length),g.init(),A.push(g),Kr(he,Ge,0,b.sortObjects),g.finish(),b.sortObjects===!0&&g.sort(ee,Q),xe===!0&&ce.beginShadows();const ze=m.state.shadowsArray;if(je.render(ze,he,Ge),xe===!0&&ce.endShadows(),this.info.autoReset===!0&&this.info.reset(),yt.render(g,he),m.setupLights(b.physicallyCorrectLights),Ge.isArrayCamera){const Ne=Ge.cameras;for(let nt=0,j=Ne.length;nt<j;nt++){const ie=Ne[nt];xi(g,he,ie,ie.viewport)}}else xi(g,he,Ge);M!==null&&(tt.updateMultisampleRenderTarget(M),tt.updateRenderTargetMipmap(M)),he.isScene===!0&&he.onAfterRender(b,he,Ge),ke.resetDefaultState(),R=-1,T=null,v.pop(),v.length>0?m=v[v.length-1]:m=null,A.pop(),A.length>0?g=A[A.length-1]:g=null};function Kr(he,Ge,ze,Ne){if(he.visible===!1)return;if(he.layers.test(Ge.layers)){if(he.isGroup)ze=he.renderOrder;else if(he.isLOD)he.autoUpdate===!0&&he.update(Ge);else if(he.isLight)m.pushLight(he),he.castShadow&&m.pushShadow(he);else if(he.isSprite){if(!he.frustumCulled||ve.intersectsSprite(he)){Ne&&$e.setFromMatrixPosition(he.matrixWorld).applyMatrix4(Le);const ie=Kt.update(he),pe=he.material;pe.visible&&g.push(he,ie,pe,ze,$e.z,null)}}else if((he.isMesh||he.isLine||he.isPoints)&&(he.isSkinnedMesh&&he.skeleton.frame!==vn.render.frame&&(he.skeleton.update(),he.skeleton.frame=vn.render.frame),!he.frustumCulled||ve.intersectsObject(he))){Ne&&$e.setFromMatrixPosition(he.matrixWorld).applyMatrix4(Le);const ie=Kt.update(he),pe=he.material;if(Array.isArray(pe)){const Se=ie.groups;for(let We=0,Oe=Se.length;We<Oe;We++){const Ke=Se[We],lt=pe[Ke.materialIndex];lt&&lt.visible&&g.push(he,ie,lt,ze,$e.z,Ke)}}else pe.visible&&g.push(he,ie,pe,ze,$e.z,null)}}const j=he.children;for(let ie=0,pe=j.length;ie<pe;ie++)Kr(j[ie],Ge,ze,Ne)}function xi(he,Ge,ze,Ne){const nt=he.opaque,j=he.transmissive,ie=he.transparent;m.setupLightsView(ze),j.length>0&&Or(nt,Ge,ze),Ne&&Nt.viewport(B.copy(Ne)),nt.length>0&&Ys(nt,Ge,ze),j.length>0&&Ys(j,Ge,ze),ie.length>0&&Ys(ie,Ge,ze),Nt.buffers.depth.setTest(!0),Nt.buffers.depth.setMask(!0),Nt.buffers.color.setMask(!0),Nt.setPolygonOffset(!1)}function Or(he,Ge,ze){const Ne=mn.isWebGL2;Ie===null&&(Ie=new Xr(1,1,{generateMipmaps:!0,type:Xt.has("EXT_color_buffer_half_float")?Fs:Tr,minFilter:va,samples:Ne&&r===!0?4:0})),b.getDrawingBufferSize(De),Ne?Ie.setSize(De.x,De.y):Ie.setSize(T_(De.x),T_(De.y));const nt=b.getRenderTarget();b.setRenderTarget(Ie),b.clear();const j=b.toneMapping;b.toneMapping=ma,Ys(he,Ge,ze),b.toneMapping=j,tt.updateMultisampleRenderTarget(Ie),tt.updateRenderTargetMipmap(Ie),b.setRenderTarget(nt)}function Ys(he,Ge,ze){const Ne=Ge.isScene===!0?Ge.overrideMaterial:null;for(let nt=0,j=he.length;nt<j;nt++){const ie=he[nt],pe=ie.object,Se=ie.geometry,We=Ne===null?ie.material:Ne,Oe=ie.group;pe.layers.test(ze.layers)&&or(pe,Ge,ze,Se,We,Oe)}}function or(he,Ge,ze,Ne,nt,j){he.onBeforeRender(b,Ge,ze,Ne,nt,j),he.modelViewMatrix.multiplyMatrices(ze.matrixWorldInverse,he.matrixWorld),he.normalMatrix.getNormalMatrix(he.modelViewMatrix),nt.onBeforeRender(b,Ge,ze,Ne,he,j),nt.transparent===!0&&nt.side===ir?(nt.side=Wr,nt.needsUpdate=!0,b.renderBufferDirect(ze,Ge,Ne,nt,he,j),nt.side=zo,nt.needsUpdate=!0,b.renderBufferDirect(ze,Ge,Ne,nt,he,j),nt.side=ir):b.renderBufferDirect(ze,Ge,Ne,nt,he,j),he.onAfterRender(b,Ge,ze,Ne,nt,j)}function ac(he,Ge,ze){Ge.isScene!==!0&&(Ge=vt);const Ne=it.get(he),nt=m.state.lights,j=m.state.shadowsArray,ie=nt.state.version,pe=ln.getParameters(he,nt.state,j,Ge,ze),Se=ln.getProgramCacheKey(pe);let We=Ne.programs;Ne.environment=he.isMeshStandardMaterial?Ge.environment:null,Ne.fog=Ge.fog,Ne.envMap=(he.isMeshStandardMaterial?Jt:xt).get(he.envMap||Ne.environment),We===void 0&&(he.addEventListener("dispose",Me),We=new Map,Ne.programs=We);let Oe=We.get(Se);if(Oe!==void 0){if(Ne.currentProgram===Oe&&Ne.lightsStateVersion===ie)return wh(he,pe),Oe}else pe.uniforms=ln.getUniforms(he),he.onBuild(ze,pe,b),he.onBeforeCompile(pe,b),Oe=ln.acquireProgram(pe,Se),We.set(Se,Oe),Ne.uniforms=pe.uniforms;const Ke=Ne.uniforms;(!he.isShaderMaterial&&!he.isRawShaderMaterial||he.clipping===!0)&&(Ke.clippingPlanes=ce.uniform),wh(he,pe),Ne.needsLights=ed(he),Ne.lightsStateVersion=ie,Ne.needsLights&&(Ke.ambientLightColor.value=nt.state.ambient,Ke.lightProbe.value=nt.state.probe,Ke.directionalLights.value=nt.state.directional,Ke.directionalLightShadows.value=nt.state.directionalShadow,Ke.spotLights.value=nt.state.spot,Ke.spotLightShadows.value=nt.state.spotShadow,Ke.rectAreaLights.value=nt.state.rectArea,Ke.ltc_1.value=nt.state.rectAreaLTC1,Ke.ltc_2.value=nt.state.rectAreaLTC2,Ke.pointLights.value=nt.state.point,Ke.pointLightShadows.value=nt.state.pointShadow,Ke.hemisphereLights.value=nt.state.hemi,Ke.directionalShadowMap.value=nt.state.directionalShadowMap,Ke.directionalShadowMatrix.value=nt.state.directionalShadowMatrix,Ke.spotShadowMap.value=nt.state.spotShadowMap,Ke.spotLightMatrix.value=nt.state.spotLightMatrix,Ke.spotLightMap.value=nt.state.spotLightMap,Ke.pointShadowMap.value=nt.state.pointShadowMap,Ke.pointShadowMatrix.value=nt.state.pointShadowMatrix);const lt=Oe.getUniforms(),Tt=Jy.seqWithValue(lt.seq,Ke);return Ne.currentProgram=Oe,Ne.uniformsList=Tt,Oe}function wh(he,Ge){const ze=it.get(he);ze.outputEncoding=Ge.outputEncoding,ze.instancing=Ge.instancing,ze.skinning=Ge.skinning,ze.morphTargets=Ge.morphTargets,ze.morphNormals=Ge.morphNormals,ze.morphColors=Ge.morphColors,ze.morphTargetsCount=Ge.morphTargetsCount,ze.numClippingPlanes=Ge.numClippingPlanes,ze.numIntersection=Ge.numClipIntersection,ze.vertexAlphas=Ge.vertexAlphas,ze.vertexTangents=Ge.vertexTangents,ze.toneMapping=Ge.toneMapping}function yo(he,Ge,ze,Ne,nt){Ge.isScene!==!0&&(Ge=vt),tt.resetTextureUnits();const j=Ge.fog,ie=Ne.isMeshStandardMaterial?Ge.environment:null,pe=M===null?b.outputEncoding:M.isXRRenderTarget===!0?M.texture.encoding:Ar,Se=(Ne.isMeshStandardMaterial?Jt:xt).get(Ne.envMap||ie),We=Ne.vertexColors===!0&&!!ze.attributes.color&&ze.attributes.color.itemSize===4,Oe=!!Ne.normalMap&&!!ze.attributes.tangent,Ke=!!ze.morphAttributes.position,lt=!!ze.morphAttributes.normal,Tt=!!ze.morphAttributes.color,ut=Ne.toneMapped?b.toneMapping:ma,wt=ze.morphAttributes.position||ze.morphAttributes.normal||ze.morphAttributes.color,Zt=wt!==void 0?wt.length:0,bt=it.get(Ne),xn=m.state.lights;if(xe===!0&&(Ae===!0||he!==T)){const In=he===T&&Ne.id===R;ce.setState(Ne,he,In)}let pn=!1;Ne.version===bt.__version?(bt.needsLights&&bt.lightsStateVersion!==xn.state.version||bt.outputEncoding!==pe||nt.isInstancedMesh&&bt.instancing===!1||!nt.isInstancedMesh&&bt.instancing===!0||nt.isSkinnedMesh&&bt.skinning===!1||!nt.isSkinnedMesh&&bt.skinning===!0||bt.envMap!==Se||Ne.fog===!0&&bt.fog!==j||bt.numClippingPlanes!==void 0&&(bt.numClippingPlanes!==ce.numPlanes||bt.numIntersection!==ce.numIntersection)||bt.vertexAlphas!==We||bt.vertexTangents!==Oe||bt.morphTargets!==Ke||bt.morphNormals!==lt||bt.morphColors!==Tt||bt.toneMapping!==ut||mn.isWebGL2===!0&&bt.morphTargetsCount!==Zt)&&(pn=!0):(pn=!0,bt.__version=Ne.version);let $t=bt.currentProgram;pn===!0&&($t=ac(Ne,Ge,nt));let un=!1,Fn=!1,Si=!1;const Zn=$t.getUniforms(),Wi=bt.uniforms;if(Nt.useProgram($t.program)&&(un=!0,Fn=!0,Si=!0),Ne.id!==R&&(R=Ne.id,Fn=!0),un||T!==he){if(Zn.setValue(Ve,"projectionMatrix",he.projectionMatrix),mn.logarithmicDepthBuffer&&Zn.setValue(Ve,"logDepthBufFC",2/(Math.log(he.far+1)/Math.LN2)),T!==he&&(T=he,Fn=!0,Si=!0),Ne.isShaderMaterial||Ne.isMeshPhongMaterial||Ne.isMeshToonMaterial||Ne.isMeshStandardMaterial||Ne.envMap){const In=Zn.map.cameraPosition;In!==void 0&&In.setValue(Ve,$e.setFromMatrixPosition(he.matrixWorld))}(Ne.isMeshPhongMaterial||Ne.isMeshToonMaterial||Ne.isMeshLambertMaterial||Ne.isMeshBasicMaterial||Ne.isMeshStandardMaterial||Ne.isShaderMaterial)&&Zn.setValue(Ve,"isOrthographic",he.isOrthographicCamera===!0),(Ne.isMeshPhongMaterial||Ne.isMeshToonMaterial||Ne.isMeshLambertMaterial||Ne.isMeshBasicMaterial||Ne.isMeshStandardMaterial||Ne.isShaderMaterial||Ne.isShadowMaterial||nt.isSkinnedMesh)&&Zn.setValue(Ve,"viewMatrix",he.matrixWorldInverse)}if(nt.isSkinnedMesh){Zn.setOptional(Ve,nt,"bindMatrix"),Zn.setOptional(Ve,nt,"bindMatrixInverse");const In=nt.skeleton;In&&(mn.floatVertexTextures?(In.boneTexture===null&&In.computeBoneTexture(),Zn.setValue(Ve,"boneTexture",In.boneTexture,tt),Zn.setValue(Ve,"boneTextureSize",In.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const pi=ze.morphAttributes;if((pi.position!==void 0||pi.normal!==void 0||pi.color!==void 0&&mn.isWebGL2===!0)&&mt.update(nt,ze,Ne,$t),(Fn||bt.receiveShadow!==nt.receiveShadow)&&(bt.receiveShadow=nt.receiveShadow,Zn.setValue(Ve,"receiveShadow",nt.receiveShadow)),Ne.isMeshGouraudMaterial&&Ne.envMap!==null&&(Wi.envMap.value=Se,Wi.flipEnvMap.value=Se.isCubeTexture&&Se.isRenderTargetTexture===!1?-1:1),Fn&&(Zn.setValue(Ve,"toneMappingExposure",b.toneMappingExposure),bt.needsLights&&Fr(Wi,Si),j&&Ne.fog===!0&&ii.refreshFogUniforms(Wi,j),ii.refreshMaterialUniforms(Wi,Ne,J,W,Ie),Jy.upload(Ve,bt.uniformsList,Wi,tt)),Ne.isShaderMaterial&&Ne.uniformsNeedUpdate===!0&&(Jy.upload(Ve,bt.uniformsList,Wi,tt),Ne.uniformsNeedUpdate=!1),Ne.isSpriteMaterial&&Zn.setValue(Ve,"center",nt.center),Zn.setValue(Ve,"modelViewMatrix",nt.modelViewMatrix),Zn.setValue(Ve,"normalMatrix",nt.normalMatrix),Zn.setValue(Ve,"modelMatrix",nt.matrixWorld),Ne.isShaderMaterial||Ne.isRawShaderMaterial){const In=Ne.uniformsGroups;for(let Di=0,zs=In.length;Di<zs;Di++)if(mn.isWebGL2){const Yi=In[Di];Et.update(Yi,$t),Et.bind(Yi,$t)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $t}function Fr(he,Ge){he.ambientLightColor.needsUpdate=Ge,he.lightProbe.needsUpdate=Ge,he.directionalLights.needsUpdate=Ge,he.directionalLightShadows.needsUpdate=Ge,he.pointLights.needsUpdate=Ge,he.pointLightShadows.needsUpdate=Ge,he.spotLights.needsUpdate=Ge,he.spotLightShadows.needsUpdate=Ge,he.rectAreaLights.needsUpdate=Ge,he.hemisphereLights.needsUpdate=Ge}function ed(he){return he.isMeshLambertMaterial||he.isMeshToonMaterial||he.isMeshPhongMaterial||he.isMeshStandardMaterial||he.isShadowMaterial||he.isShaderMaterial&&he.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(he,Ge,ze){it.get(he.texture).__webglTexture=Ge,it.get(he.depthTexture).__webglTexture=ze;const Ne=it.get(he);Ne.__hasExternalTextures=!0,Ne.__hasExternalTextures&&(Ne.__autoAllocateDepthBuffer=ze===void 0,Ne.__autoAllocateDepthBuffer||Xt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ne.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(he,Ge){const ze=it.get(he);ze.__webglFramebuffer=Ge,ze.__useDefaultFramebuffer=Ge===void 0},this.setRenderTarget=function(he,Ge=0,ze=0){M=he,S=Ge,I=ze;let Ne=!0;if(he){const Se=it.get(he);Se.__useDefaultFramebuffer!==void 0?(Nt.bindFramebuffer(36160,null),Ne=!1):Se.__webglFramebuffer===void 0?tt.setupRenderTarget(he):Se.__hasExternalTextures&&tt.rebindTextures(he,it.get(he.texture).__webglTexture,it.get(he.depthTexture).__webglTexture)}let nt=null,j=!1,ie=!1;if(he){const Se=he.texture;(Se.isData3DTexture||Se.isDataArrayTexture)&&(ie=!0);const We=it.get(he).__webglFramebuffer;he.isWebGLCubeRenderTarget?(nt=We[Ge],j=!0):mn.isWebGL2&&he.samples>0&&tt.useMultisampledRTT(he)===!1?nt=it.get(he).__webglMultisampledFramebuffer:nt=We,B.copy(he.viewport),F.copy(he.scissor),D=he.scissorTest}else B.copy(Y).multiplyScalar(J).floor(),F.copy(se).multiplyScalar(J).floor(),D=ae;if(Nt.bindFramebuffer(36160,nt)&&mn.drawBuffers&&Ne&&Nt.drawBuffers(he,nt),Nt.viewport(B),Nt.scissor(F),Nt.setScissorTest(D),j){const Se=it.get(he.texture);Ve.framebufferTexture2D(36160,36064,34069+Ge,Se.__webglTexture,ze)}else if(ie){const Se=it.get(he.texture),We=Ge||0;Ve.framebufferTextureLayer(36160,36064,Se.__webglTexture,ze||0,We)}R=-1},this.readRenderTargetPixels=function(he,Ge,ze,Ne,nt,j,ie){if(!(he&&he.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let pe=it.get(he).__webglFramebuffer;if(he.isWebGLCubeRenderTarget&&ie!==void 0&&(pe=pe[ie]),pe){Nt.bindFramebuffer(36160,pe);try{const Se=he.texture,We=Se.format,Oe=Se.type;if(We!==ds&&be.convert(We)!==Ve.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Ke=Oe===Fs&&(Xt.has("EXT_color_buffer_half_float")||mn.isWebGL2&&Xt.has("EXT_color_buffer_float"));if(Oe!==Tr&&be.convert(Oe)!==Ve.getParameter(35738)&&!(Oe===Ms&&(mn.isWebGL2||Xt.has("OES_texture_float")||Xt.has("WEBGL_color_buffer_float")))&&!Ke){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ge>=0&&Ge<=he.width-Ne&&ze>=0&&ze<=he.height-nt&&Ve.readPixels(Ge,ze,Ne,nt,be.convert(We),be.convert(Oe),j)}finally{const Se=M!==null?it.get(M).__webglFramebuffer:null;Nt.bindFramebuffer(36160,Se)}}},this.copyFramebufferToTexture=function(he,Ge,ze=0){const Ne=Math.pow(2,-ze),nt=Math.floor(Ge.image.width*Ne),j=Math.floor(Ge.image.height*Ne);tt.setTexture2D(Ge,0),Ve.copyTexSubImage2D(3553,ze,0,0,he.x,he.y,nt,j),Nt.unbindTexture()},this.copyTextureToTexture=function(he,Ge,ze,Ne=0){const nt=Ge.image.width,j=Ge.image.height,ie=be.convert(ze.format),pe=be.convert(ze.type);tt.setTexture2D(ze,0),Ve.pixelStorei(37440,ze.flipY),Ve.pixelStorei(37441,ze.premultiplyAlpha),Ve.pixelStorei(3317,ze.unpackAlignment),Ge.isDataTexture?Ve.texSubImage2D(3553,Ne,he.x,he.y,nt,j,ie,pe,Ge.image.data):Ge.isCompressedTexture?Ve.compressedTexSubImage2D(3553,Ne,he.x,he.y,Ge.mipmaps[0].width,Ge.mipmaps[0].height,ie,Ge.mipmaps[0].data):Ve.texSubImage2D(3553,Ne,he.x,he.y,ie,pe,Ge.image),Ne===0&&ze.generateMipmaps&&Ve.generateMipmap(3553),Nt.unbindTexture()},this.copyTextureToTexture3D=function(he,Ge,ze,Ne,nt=0){if(b.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const j=he.max.x-he.min.x+1,ie=he.max.y-he.min.y+1,pe=he.max.z-he.min.z+1,Se=be.convert(Ne.format),We=be.convert(Ne.type);let Oe;if(Ne.isData3DTexture)tt.setTexture3D(Ne,0),Oe=32879;else if(Ne.isDataArrayTexture)tt.setTexture2DArray(Ne,0),Oe=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ve.pixelStorei(37440,Ne.flipY),Ve.pixelStorei(37441,Ne.premultiplyAlpha),Ve.pixelStorei(3317,Ne.unpackAlignment);const Ke=Ve.getParameter(3314),lt=Ve.getParameter(32878),Tt=Ve.getParameter(3316),ut=Ve.getParameter(3315),wt=Ve.getParameter(32877),Zt=ze.isCompressedTexture?ze.mipmaps[0]:ze.image;Ve.pixelStorei(3314,Zt.width),Ve.pixelStorei(32878,Zt.height),Ve.pixelStorei(3316,he.min.x),Ve.pixelStorei(3315,he.min.y),Ve.pixelStorei(32877,he.min.z),ze.isDataTexture||ze.isData3DTexture?Ve.texSubImage3D(Oe,nt,Ge.x,Ge.y,Ge.z,j,ie,pe,Se,We,Zt.data):ze.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ve.compressedTexSubImage3D(Oe,nt,Ge.x,Ge.y,Ge.z,j,ie,pe,Se,Zt.data)):Ve.texSubImage3D(Oe,nt,Ge.x,Ge.y,Ge.z,j,ie,pe,Se,We,Zt),Ve.pixelStorei(3314,Ke),Ve.pixelStorei(32878,lt),Ve.pixelStorei(3316,Tt),Ve.pixelStorei(3315,ut),Ve.pixelStorei(32877,wt),nt===0&&Ne.generateMipmaps&&Ve.generateMipmap(Oe),Nt.unbindTexture()},this.initTexture=function(he){he.isCubeTexture?tt.setTextureCube(he,0):he.isData3DTexture?tt.setTexture3D(he,0):he.isDataArrayTexture?tt.setTexture2DArray(he,0):tt.setTexture2D(he,0),Nt.unbindTexture()},this.resetState=function(){S=0,I=0,M=null,Nt.reset(),ke.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class q2 extends Dg{}q2.prototype.isWebGL1Renderer=!0;class mv{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ye(e),this.density=t}clone(){return new mv(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class gv{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new ye(e),this.near=t,this.far=n}clone(){return new gv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Bu extends Ft{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class Og{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=og,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ho()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ho()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ho()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Er=new q;class th{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Er.fromBufferAttribute(this,t),Er.applyMatrix4(e),this.setXYZ(t,Er.x,Er.y,Er.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Er.fromBufferAttribute(this,t),Er.applyNormalMatrix(e),this.setXYZ(t,Er.x,Er.y,Er.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Er.fromBufferAttribute(this,t),Er.transformDirection(e),this.setXYZ(t,Er.x,Er.y,Er.z);return this}setX(e,t){return this.normalized&&(t=Gi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Gi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Gi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Gi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Nc(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Nc(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Nc(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Nc(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Gi(t,this.array),n=Gi(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Gi(t,this.array),n=Gi(n,this.array),i=Gi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Gi(t,this.array),n=Gi(n,this.array),i=Gi(i,this.array),r=Gi(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new Jn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new th(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class yS extends vs{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ye(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Jd;const dm=new q,Kd=new q,Zd=new q,$d=new Xe,fm=new Xe,X2=new fn,ny=new q,pm=new q,iy=new q,JR=new Xe,Mb=new Xe,KR=new Xe;class Y2 extends Ft{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",Jd===void 0){Jd=new Sn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Og(t,5);Jd.setIndex([0,1,2,0,2,3]),Jd.setAttribute("position",new th(n,3,0,!1)),Jd.setAttribute("uv",new th(n,2,3,!1))}this.geometry=Jd,this.material=e!==void 0?e:new yS,this.center=new Xe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Kd.setFromMatrixScale(this.matrixWorld),X2.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Zd.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Kd.multiplyScalar(-Zd.z);const n=this.material.rotation;let i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;sy(ny.set(-.5,-.5,0),Zd,o,Kd,i,r),sy(pm.set(.5,-.5,0),Zd,o,Kd,i,r),sy(iy.set(.5,.5,0),Zd,o,Kd,i,r),JR.set(0,0),Mb.set(1,0),KR.set(1,1);let l=e.ray.intersectTriangle(ny,pm,iy,!1,dm);if(l===null&&(sy(pm.set(-.5,.5,0),Zd,o,Kd,i,r),Mb.set(0,1),l=e.ray.intersectTriangle(ny,iy,pm,!1,dm),l===null))return;const h=e.ray.origin.distanceTo(dm);h<e.near||h>e.far||t.push({distance:h,point:dm.clone(),uv:ko.getUV(dm,ny,pm,iy,JR,Mb,KR,new Xe),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function sy(a,e,t,n,i,r){$d.subVectors(a,t).addScalar(.5).multiply(n),i!==void 0?(fm.x=r*$d.x-i*$d.y,fm.y=i*$d.x+r*$d.y):fm.copy($d),a.copy(e),a.x+=fm.x,a.y+=fm.y,a.applyMatrix4(X2)}const ry=new q,ZR=new q;class _S extends Ft{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){ry.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(ry);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){ry.setFromMatrixPosition(e.matrixWorld),ZR.setFromMatrixPosition(this.matrixWorld);const n=ry.distanceTo(ZR)/e.zoom;t[0].object.visible=!0;let i,r;for(i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}const $R=new q,eP=new Bn,tP=new Bn,Wj=new q,nP=new fn;class vS extends _t{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new fn,this.bindMatrixInverse=new fn}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Bn,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;eP.fromBufferAttribute(i.attributes.skinIndex,e),tP.fromBufferAttribute(i.attributes.skinWeight,e),$R.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=tP.getComponent(r);if(o!==0){const l=eP.getComponent(r);nP.multiplyMatrices(n.bones[l].matrixWorld,n.boneInverses[l]),t.addScaledVector(Wj.copy($R).applyMatrix4(nP),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Av extends Ft{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ja extends Ii{constructor(e=null,t=1,n=1,i,r,o,l,h,u=$i,f=$i,g,m){super(null,o,l,h,u,f,i,r,g,m),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const iP=new fn,Qj=new fn;class Fg{constructor(e=[],t=[]){this.uuid=ho(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new fn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new fn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const l=e[r]?e[r].matrixWorld:Qj;iP.multiplyMatrices(l,t[r]),iP.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new Fg(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=F2(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ja(t,e,e,ds,Ms);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const r=e.bones[n];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Av),this.bones.push(o),this.boneInverses.push(new fn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const o=t[i];e.bones.push(o.uuid);const l=n[i];e.boneInverses.push(l.toArray())}return e}}class Uf extends Jn{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const sP=new fn,rP=new fn,oy=[],mm=new _t;class xS extends _t{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Uf(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(mm.geometry=this.geometry,mm.material=this.material,mm.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,sP),rP.multiplyMatrices(n,sP),mm.matrixWorld=rP,mm.raycast(e,oy);for(let o=0,l=oy.length;o<l;o++){const h=oy[o];h.instanceId=r,h.object=this,t.push(h)}oy.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Uf(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ts extends vs{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ye(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const oP=new q,aP=new q,cP=new fn,Tb=new Vu,ay=new ec;class Ss extends Ft{constructor(e=new Sn,t=new Ts){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)oP.fromBufferAttribute(t,i-1),aP.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=oP.distanceTo(aP);e.setAttribute("lineDistance",new tn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),ay.copy(n.boundingSphere),ay.applyMatrix4(i),ay.radius+=r,e.ray.intersectsSphere(ay)===!1)return;cP.copy(i).invert(),Tb.copy(e.ray).applyMatrix4(cP);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,u=new q,f=new q,g=new q,m=new q,A=this.isLineSegments?2:1,v=n.index,C=n.attributes.position;if(v!==null){const S=Math.max(0,o.start),I=Math.min(v.count,o.start+o.count);for(let M=S,R=I-1;M<R;M+=A){const T=v.getX(M),B=v.getX(M+1);if(u.fromBufferAttribute(C,T),f.fromBufferAttribute(C,B),Tb.distanceSqToSegment(u,f,m,g)>h)continue;m.applyMatrix4(this.matrixWorld);const D=e.ray.origin.distanceTo(m);D<e.near||D>e.far||t.push({distance:D,point:g.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}else{const S=Math.max(0,o.start),I=Math.min(C.count,o.start+o.count);for(let M=S,R=I-1;M<R;M+=A){if(u.fromBufferAttribute(C,M),f.fromBufferAttribute(C,M+1),Tb.distanceSqToSegment(u,f,m,g)>h)continue;m.applyMatrix4(this.matrixWorld);const B=e.ray.origin.distanceTo(m);B<e.near||B>e.far||t.push({distance:B,point:g.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}}const lP=new q,hP=new q;class Wo extends Ss{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)lP.fromBufferAttribute(t,i),hP.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+lP.distanceTo(hP);e.setAttribute("lineDistance",new tn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class wS extends Ss{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class kg extends vs{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ye(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const uP=new fn,nE=new Vu,cy=new ec,ly=new q;class yv extends Ft{constructor(e=new Sn,t=new kg){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),cy.copy(n.boundingSphere),cy.applyMatrix4(i),cy.radius+=r,e.ray.intersectsSphere(cy)===!1)return;uP.copy(i).invert(),nE.copy(e.ray).applyMatrix4(uP);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,u=n.index,g=n.attributes.position;if(u!==null){const m=Math.max(0,o.start),A=Math.min(u.count,o.start+o.count);for(let v=m,b=A;v<b;v++){const C=u.getX(v);ly.fromBufferAttribute(g,C),dP(ly,C,h,i,e,t,this)}}else{const m=Math.max(0,o.start),A=Math.min(g.count,o.start+o.count);for(let v=m,b=A;v<b;v++)ly.fromBufferAttribute(g,v),dP(ly,v,h,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}}function dP(a,e,t,n,i,r,o){const l=nE.distanceSqToPoint(a);if(l<t){const h=new q;nE.closestPointToPoint(a,h),h.applyMatrix4(n);const u=i.ray.origin.distanceTo(h);if(u<i.near||u>i.far)return;r.push({distance:u,distanceToRay:Math.sqrt(l),point:h,index:e,face:null,object:o})}}class J2 extends Ii{constructor(e,t,n,i,r,o,l,h,u){super(e,t,n,i,r,o,l,h,u),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:vi,this.magFilter=r!==void 0?r:vi,this.generateMipmaps=!1;const f=this;function g(){f.needsUpdate=!0,e.requestVideoFrameCallback(g)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(g)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class jj extends Ii{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=$i,this.minFilter=$i,this.generateMipmaps=!1,this.needsUpdate=!0}}class Nl extends Ii{constructor(e,t,n,i,r,o,l,h,u,f,g,m){super(null,o,l,h,u,f,i,r,g,m),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class bS extends Ii{constructor(e,t,n,i,r,o,l,h,u){super(e,t,n,i,r,o,l,h,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class xa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;t?o=t:o=e*n[r-1];let l=0,h=r-1,u;for(;l<=h;)if(i=Math.floor(l+(h-l)/2),u=n[i]-o,u<0)l=i+1;else if(u>0)h=i-1;else{h=i;break}if(i=h,n[i]===o)return i/(r-1);const f=n[i],m=n[i+1]-f,A=(o-f)/m;return(i+A)/(r-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),l=this.getPoint(r),h=t||(o.isVector2?new Xe:new q);return h.copy(l).sub(o).normalize(),h}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new q,i=[],r=[],o=[],l=new q,h=new fn;for(let A=0;A<=e;A++){const v=A/e;i[A]=this.getTangentAt(v,new q)}r[0]=new q,o[0]=new q;let u=Number.MAX_VALUE;const f=Math.abs(i[0].x),g=Math.abs(i[0].y),m=Math.abs(i[0].z);f<=u&&(u=f,n.set(1,0,0)),g<=u&&(u=g,n.set(0,1,0)),m<=u&&n.set(0,0,1),l.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],l),o[0].crossVectors(i[0],r[0]);for(let A=1;A<=e;A++){if(r[A]=r[A-1].clone(),o[A]=o[A-1].clone(),l.crossVectors(i[A-1],i[A]),l.length()>Number.EPSILON){l.normalize();const v=Math.acos(As(i[A-1].dot(i[A]),-1,1));r[A].applyMatrix4(h.makeRotationAxis(l,v))}o[A].crossVectors(i[A],r[A])}if(t===!0){let A=Math.acos(As(r[0].dot(r[e]),-1,1));A/=e,i[0].dot(l.crossVectors(r[0],r[e]))>0&&(A=-A);for(let v=1;v<=e;v++)r[v].applyMatrix4(h.makeRotationAxis(i[v],A*v)),o[v].crossVectors(i[v],r[v])}return{tangents:i,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class _v extends xa{constructor(e=0,t=0,n=1,i=1,r=0,o=Math.PI*2,l=!1,h=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=l,this.aRotation=h}getPoint(e,t){const n=t||new Xe,i=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(o?r=0:r=i),this.aClockwise===!0&&!o&&(r===i?r=-i:r=r-i);const l=this.aStartAngle+e*r;let h=this.aX+this.xRadius*Math.cos(l),u=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const f=Math.cos(this.aRotation),g=Math.sin(this.aRotation),m=h-this.aX,A=u-this.aY;h=m*f-A*g+this.aX,u=m*g+A*f+this.aY}return n.set(h,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class K2 extends _v{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function CS(){let a=0,e=0,t=0,n=0;function i(r,o,l,h){a=r,e=l,t=-3*r+3*o-2*l-h,n=2*r-2*o+l+h}return{initCatmullRom:function(r,o,l,h,u){i(o,l,u*(l-r),u*(h-o))},initNonuniformCatmullRom:function(r,o,l,h,u,f,g){let m=(o-r)/u-(l-r)/(u+f)+(l-o)/f,A=(l-o)/f-(h-o)/(f+g)+(h-l)/g;m*=f,A*=f,i(o,l,m,A)},calc:function(r){const o=r*r,l=o*r;return a+e*r+t*o+n*l}}}const hy=new q,Ib=new CS,Rb=new CS,Pb=new CS;class Z2 extends xa{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new q){const n=t,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let l=Math.floor(o),h=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:h===0&&l===r-1&&(l=r-2,h=1);let u,f;this.closed||l>0?u=i[(l-1)%r]:(hy.subVectors(i[0],i[1]).add(i[0]),u=hy);const g=i[l%r],m=i[(l+1)%r];if(this.closed||l+2<r?f=i[(l+2)%r]:(hy.subVectors(i[r-1],i[r-2]).add(i[r-1]),f=hy),this.curveType==="centripetal"||this.curveType==="chordal"){const A=this.curveType==="chordal"?.5:.25;let v=Math.pow(u.distanceToSquared(g),A),b=Math.pow(g.distanceToSquared(m),A),C=Math.pow(m.distanceToSquared(f),A);b<1e-4&&(b=1),v<1e-4&&(v=b),C<1e-4&&(C=b),Ib.initNonuniformCatmullRom(u.x,g.x,m.x,f.x,v,b,C),Rb.initNonuniformCatmullRom(u.y,g.y,m.y,f.y,v,b,C),Pb.initNonuniformCatmullRom(u.z,g.z,m.z,f.z,v,b,C)}else this.curveType==="catmullrom"&&(Ib.initCatmullRom(u.x,g.x,m.x,f.x,this.tension),Rb.initCatmullRom(u.y,g.y,m.y,f.y,this.tension),Pb.initCatmullRom(u.z,g.z,m.z,f.z,this.tension));return n.set(Ib.calc(h),Rb.calc(h),Pb.calc(h)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new q().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function fP(a,e,t,n,i){const r=(n-e)*.5,o=(i-t)*.5,l=a*a,h=a*l;return(2*t-2*n+r+o)*h+(-3*t+3*n-2*r-o)*l+r*a+t}function qj(a,e){const t=1-a;return t*t*e}function Xj(a,e){return 2*(1-a)*a*e}function Yj(a,e){return a*a*e}function Vm(a,e,t,n){return qj(a,e)+Xj(a,t)+Yj(a,n)}function Jj(a,e){const t=1-a;return t*t*t*e}function Kj(a,e){const t=1-a;return 3*t*t*a*e}function Zj(a,e){return 3*(1-a)*a*a*e}function $j(a,e){return a*a*a*e}function Wm(a,e,t,n,i){return Jj(a,e)+Kj(a,t)+Zj(a,n)+$j(a,i)}class ES extends xa{constructor(e=new Xe,t=new Xe,n=new Xe,i=new Xe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Xe){const n=t,i=this.v0,r=this.v1,o=this.v2,l=this.v3;return n.set(Wm(e,i.x,r.x,o.x,l.x),Wm(e,i.y,r.y,o.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class $2 extends xa{constructor(e=new q,t=new q,n=new q,i=new q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new q){const n=t,i=this.v0,r=this.v1,o=this.v2,l=this.v3;return n.set(Wm(e,i.x,r.x,o.x,l.x),Wm(e,i.y,r.y,o.y,l.y),Wm(e,i.z,r.z,o.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class vv extends xa{constructor(e=new Xe,t=new Xe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Xe){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Xe;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class eD extends xa{constructor(e=new q,t=new q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new q){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class SS extends xa{constructor(e=new Xe,t=new Xe,n=new Xe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Xe){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(Vm(e,i.x,r.x,o.x),Vm(e,i.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class MS extends xa{constructor(e=new q,t=new q,n=new q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new q){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(Vm(e,i.x,r.x,o.x),Vm(e,i.y,r.y,o.y),Vm(e,i.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class TS extends xa{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Xe){const n=t,i=this.points,r=(i.length-1)*e,o=Math.floor(r),l=r-o,h=i[o===0?o:o-1],u=i[o],f=i[o>i.length-2?i.length-1:o+1],g=i[o>i.length-3?i.length-1:o+2];return n.set(fP(l,h.x,u.x,f.x,g.x),fP(l,h.y,u.y,f.y,g.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new Xe().fromArray(i))}return this}}var IS=Object.freeze({__proto__:null,ArcCurve:K2,CatmullRomCurve3:Z2,CubicBezierCurve:ES,CubicBezierCurve3:$2,EllipseCurve:_v,LineCurve:vv,LineCurve3:eD,QuadraticBezierCurve:SS,QuadraticBezierCurve3:MS,SplineCurve:TS});class tD extends xa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new vv(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const o=i[r]-n,l=this.curves[r],h=l.getLength(),u=h===0?0:1-o/h;return l.getPointAt(u,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],l=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,h=o.getPoints(l);for(let u=0;u<h.length;u++){const f=h[u];n&&n.equals(f)||(t.push(f),n=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new IS[i.type]().fromJSON(i))}return this}}class lg extends tD{constructor(e){super(),this.type="Path",this.currentPoint=new Xe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new vv(this.currentPoint.clone(),new Xe(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new SS(this.currentPoint.clone(),new Xe(e,t),new Xe(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const l=new ES(this.currentPoint.clone(),new Xe(e,t),new Xe(n,i),new Xe(r,o));return this.curves.push(l),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new TS(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(e+l,t+h,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,l,h){const u=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+u,t+f,n,i,r,o,l,h),this}absellipse(e,t,n,i,r,o,l,h){const u=new _v(e,t,n,i,r,o,l,h);if(this.curves.length>0){const g=u.getPoint(0);g.equals(this.currentPoint)||this.lineTo(g.x,g.y)}this.curves.push(u);const f=u.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Xf extends Sn{constructor(e=[new Xe(0,-.5),new Xe(.5,0),new Xe(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=As(i,0,Math.PI*2);const r=[],o=[],l=[],h=[],u=[],f=1/t,g=new q,m=new Xe,A=new q,v=new q,b=new q;let C=0,S=0;for(let I=0;I<=e.length-1;I++)switch(I){case 0:C=e[I+1].x-e[I].x,S=e[I+1].y-e[I].y,A.x=S*1,A.y=-C,A.z=S*0,b.copy(A),A.normalize(),h.push(A.x,A.y,A.z);break;case e.length-1:h.push(b.x,b.y,b.z);break;default:C=e[I+1].x-e[I].x,S=e[I+1].y-e[I].y,A.x=S*1,A.y=-C,A.z=S*0,v.copy(A),A.x+=b.x,A.y+=b.y,A.z+=b.z,A.normalize(),h.push(A.x,A.y,A.z),b.copy(v)}for(let I=0;I<=t;I++){const M=n+I*f*i,R=Math.sin(M),T=Math.cos(M);for(let B=0;B<=e.length-1;B++){g.x=e[B].x*R,g.y=e[B].y,g.z=e[B].x*T,o.push(g.x,g.y,g.z),m.x=I/t,m.y=B/(e.length-1),l.push(m.x,m.y);const F=h[3*B+0]*R,D=h[3*B+1],U=h[3*B+0]*T;u.push(F,D,U)}}for(let I=0;I<t;I++)for(let M=0;M<e.length-1;M++){const R=M+I*e.length,T=R,B=R+e.length,F=R+e.length+1,D=R+1;r.push(T,B,D),r.push(F,D,B)}this.setIndex(r),this.setAttribute("position",new tn(o,3)),this.setAttribute("uv",new tn(l,2)),this.setAttribute("normal",new tn(u,3))}static fromJSON(e){return new Xf(e.points,e.segments,e.phiStart,e.phiLength)}}class Ng extends Xf{constructor(e=1,t=1,n=4,i=8){const r=new lg;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new Ng(e.radius,e.length,e.capSegments,e.radialSegments)}}class Ug extends Sn{constructor(e=1,t=8,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],o=[],l=[],h=[],u=new q,f=new Xe;o.push(0,0,0),l.push(0,0,1),h.push(.5,.5);for(let g=0,m=3;g<=t;g++,m+=3){const A=n+g/t*i;u.x=e*Math.cos(A),u.y=e*Math.sin(A),o.push(u.x,u.y,u.z),l.push(0,0,1),f.x=(o[m]/e+1)/2,f.y=(o[m+1]/e+1)/2,h.push(f.x,f.y)}for(let g=1;g<=t;g++)r.push(g,g+1,0);this.setIndex(r),this.setAttribute("position",new tn(o,3)),this.setAttribute("normal",new tn(l,3)),this.setAttribute("uv",new tn(h,2))}static fromJSON(e){return new Ug(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ls extends Sn{constructor(e=1,t=1,n=1,i=8,r=1,o=!1,l=0,h=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:l,thetaLength:h};const u=this;i=Math.floor(i),r=Math.floor(r);const f=[],g=[],m=[],A=[];let v=0;const b=[],C=n/2;let S=0;I(),o===!1&&(e>0&&M(!0),t>0&&M(!1)),this.setIndex(f),this.setAttribute("position",new tn(g,3)),this.setAttribute("normal",new tn(m,3)),this.setAttribute("uv",new tn(A,2));function I(){const R=new q,T=new q;let B=0;const F=(t-e)/n;for(let D=0;D<=r;D++){const U=[],W=D/r,J=W*(t-e)+e;for(let ee=0;ee<=i;ee++){const Q=ee/i,Y=Q*h+l,se=Math.sin(Y),ae=Math.cos(Y);T.x=J*se,T.y=-W*n+C,T.z=J*ae,g.push(T.x,T.y,T.z),R.set(se,F,ae).normalize(),m.push(R.x,R.y,R.z),A.push(Q,1-W),U.push(v++)}b.push(U)}for(let D=0;D<i;D++)for(let U=0;U<r;U++){const W=b[U][D],J=b[U+1][D],ee=b[U+1][D+1],Q=b[U][D+1];f.push(W,J,Q),f.push(J,ee,Q),B+=6}u.addGroup(S,B,0),S+=B}function M(R){const T=v,B=new Xe,F=new q;let D=0;const U=R===!0?e:t,W=R===!0?1:-1;for(let ee=1;ee<=i;ee++)g.push(0,C*W,0),m.push(0,W,0),A.push(.5,.5),v++;const J=v;for(let ee=0;ee<=i;ee++){const Y=ee/i*h+l,se=Math.cos(Y),ae=Math.sin(Y);F.x=U*ae,F.y=C*W,F.z=U*se,g.push(F.x,F.y,F.z),m.push(0,W,0),B.x=se*.5+.5,B.y=ae*.5*W+.5,A.push(B.x,B.y),v++}for(let ee=0;ee<i;ee++){const Q=T+ee,Y=J+ee;R===!0?f.push(Y,Y+1,Q):f.push(Y+1,Y,Q),D+=3}u.addGroup(S,D,R===!0?1:2),S+=D}}static fromJSON(e){return new ls(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class zg extends ls{constructor(e=1,t=1,n=8,i=1,r=!1,o=0,l=Math.PI*2){super(0,e,t,n,i,r,o,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:l}}static fromJSON(e){return new zg(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Jc extends Sn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];l(i),u(n),f(),this.setAttribute("position",new tn(r,3)),this.setAttribute("normal",new tn(r.slice(),3)),this.setAttribute("uv",new tn(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function l(I){const M=new q,R=new q,T=new q;for(let B=0;B<t.length;B+=3)A(t[B+0],M),A(t[B+1],R),A(t[B+2],T),h(M,R,T,I)}function h(I,M,R,T){const B=T+1,F=[];for(let D=0;D<=B;D++){F[D]=[];const U=I.clone().lerp(R,D/B),W=M.clone().lerp(R,D/B),J=B-D;for(let ee=0;ee<=J;ee++)ee===0&&D===B?F[D][ee]=U:F[D][ee]=U.clone().lerp(W,ee/J)}for(let D=0;D<B;D++)for(let U=0;U<2*(B-D)-1;U++){const W=Math.floor(U/2);U%2===0?(m(F[D][W+1]),m(F[D+1][W]),m(F[D][W])):(m(F[D][W+1]),m(F[D+1][W+1]),m(F[D+1][W]))}}function u(I){const M=new q;for(let R=0;R<r.length;R+=3)M.x=r[R+0],M.y=r[R+1],M.z=r[R+2],M.normalize().multiplyScalar(I),r[R+0]=M.x,r[R+1]=M.y,r[R+2]=M.z}function f(){const I=new q;for(let M=0;M<r.length;M+=3){I.x=r[M+0],I.y=r[M+1],I.z=r[M+2];const R=C(I)/2/Math.PI+.5,T=S(I)/Math.PI+.5;o.push(R,1-T)}v(),g()}function g(){for(let I=0;I<o.length;I+=6){const M=o[I+0],R=o[I+2],T=o[I+4],B=Math.max(M,R,T),F=Math.min(M,R,T);B>.9&&F<.1&&(M<.2&&(o[I+0]+=1),R<.2&&(o[I+2]+=1),T<.2&&(o[I+4]+=1))}}function m(I){r.push(I.x,I.y,I.z)}function A(I,M){const R=I*3;M.x=e[R+0],M.y=e[R+1],M.z=e[R+2]}function v(){const I=new q,M=new q,R=new q,T=new q,B=new Xe,F=new Xe,D=new Xe;for(let U=0,W=0;U<r.length;U+=9,W+=6){I.set(r[U+0],r[U+1],r[U+2]),M.set(r[U+3],r[U+4],r[U+5]),R.set(r[U+6],r[U+7],r[U+8]),B.set(o[W+0],o[W+1]),F.set(o[W+2],o[W+3]),D.set(o[W+4],o[W+5]),T.copy(I).add(M).add(R).divideScalar(3);const J=C(T);b(B,W+0,I,J),b(F,W+2,M,J),b(D,W+4,R,J)}}function b(I,M,R,T){T<0&&I.x===1&&(o[M]=I.x-1),R.x===0&&R.z===0&&(o[M]=T/2/Math.PI+.5)}function C(I){return Math.atan2(I.z,-I.x)}function S(I){return Math.atan2(-I.y,Math.sqrt(I.x*I.x+I.z*I.z))}}static fromJSON(e){return new Jc(e.vertices,e.indices,e.radius,e.details)}}class Gg extends Jc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Gg(e.radius,e.detail)}}const uy=new q,dy=new q,Bb=new q,fy=new ko;class RS extends Sn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),r=Math.cos(Ru*t),o=e.getIndex(),l=e.getAttribute("position"),h=o?o.count:l.count,u=[0,0,0],f=["a","b","c"],g=new Array(3),m={},A=[];for(let v=0;v<h;v+=3){o?(u[0]=o.getX(v),u[1]=o.getX(v+1),u[2]=o.getX(v+2)):(u[0]=v,u[1]=v+1,u[2]=v+2);const{a:b,b:C,c:S}=fy;if(b.fromBufferAttribute(l,u[0]),C.fromBufferAttribute(l,u[1]),S.fromBufferAttribute(l,u[2]),fy.getNormal(Bb),g[0]=`${Math.round(b.x*i)},${Math.round(b.y*i)},${Math.round(b.z*i)}`,g[1]=`${Math.round(C.x*i)},${Math.round(C.y*i)},${Math.round(C.z*i)}`,g[2]=`${Math.round(S.x*i)},${Math.round(S.y*i)},${Math.round(S.z*i)}`,!(g[0]===g[1]||g[1]===g[2]||g[2]===g[0]))for(let I=0;I<3;I++){const M=(I+1)%3,R=g[I],T=g[M],B=fy[f[I]],F=fy[f[M]],D=`${R}_${T}`,U=`${T}_${R}`;U in m&&m[U]?(Bb.dot(m[U].normal)<=r&&(A.push(B.x,B.y,B.z),A.push(F.x,F.y,F.z)),m[U]=null):D in m||(m[D]={index0:u[I],index1:u[M],normal:Bb.clone()})}}for(const v in m)if(m[v]){const{index0:b,index1:C}=m[v];uy.fromBufferAttribute(l,b),dy.fromBufferAttribute(l,C),A.push(uy.x,uy.y,uy.z),A.push(dy.x,dy.y,dy.z)}this.setAttribute("position",new tn(A,3))}}}class Lu extends lg{constructor(e){super(e),this.uuid=ho(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new lg().fromJSON(i))}return this}}const eq={triangulate:function(a,e,t=2){const n=e&&e.length,i=n?e[0]*t:a.length;let r=nD(a,0,i,t,!0);const o=[];if(!r||r.next===r.prev)return o;let l,h,u,f,g,m,A;if(n&&(r=rq(a,e,r,t)),a.length>80*t){l=u=a[0],h=f=a[1];for(let v=t;v<i;v+=t)g=a[v],m=a[v+1],g<l&&(l=g),m<h&&(h=m),g>u&&(u=g),m>f&&(f=m);A=Math.max(u-l,f-h),A=A!==0?1/A:0}return hg(r,o,t,l,h,A),o}};function nD(a,e,t,n,i){let r,o;if(i===gq(a,e,t,n)>0)for(r=e;r<t;r+=n)o=pP(r,a[r],a[r+1],o);else for(r=t-n;r>=e;r-=n)o=pP(r,a[r],a[r+1],o);return o&&xv(o,o.next)&&(dg(o),o=o.next),o}function nh(a,e){if(!a)return a;e||(e=a);let t=a,n;do if(n=!1,!t.steiner&&(xv(t,t.next)||is(t.prev,t,t.next)===0)){if(dg(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function hg(a,e,t,n,i,r,o){if(!a)return;!o&&r&&hq(a,n,i,r);let l=a,h,u;for(;a.prev!==a.next;){if(h=a.prev,u=a.next,r?nq(a,n,i,r):tq(a)){e.push(h.i/t),e.push(a.i/t),e.push(u.i/t),dg(a),a=u.next,l=u.next;continue}if(a=u,a===l){o?o===1?(a=iq(nh(a),e,t),hg(a,e,t,n,i,r,2)):o===2&&sq(a,e,t,n,i,r):hg(nh(a),e,t,n,i,r,1);break}}}function tq(a){const e=a.prev,t=a,n=a.next;if(is(e,t,n)>=0)return!1;let i=a.next.next;for(;i!==a.prev;){if(_f(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&is(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function nq(a,e,t,n){const i=a.prev,r=a,o=a.next;if(is(i,r,o)>=0)return!1;const l=i.x<r.x?i.x<o.x?i.x:o.x:r.x<o.x?r.x:o.x,h=i.y<r.y?i.y<o.y?i.y:o.y:r.y<o.y?r.y:o.y,u=i.x>r.x?i.x>o.x?i.x:o.x:r.x>o.x?r.x:o.x,f=i.y>r.y?i.y>o.y?i.y:o.y:r.y>o.y?r.y:o.y,g=iE(l,h,e,t,n),m=iE(u,f,e,t,n);let A=a.prevZ,v=a.nextZ;for(;A&&A.z>=g&&v&&v.z<=m;){if(A!==a.prev&&A!==a.next&&_f(i.x,i.y,r.x,r.y,o.x,o.y,A.x,A.y)&&is(A.prev,A,A.next)>=0||(A=A.prevZ,v!==a.prev&&v!==a.next&&_f(i.x,i.y,r.x,r.y,o.x,o.y,v.x,v.y)&&is(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;A&&A.z>=g;){if(A!==a.prev&&A!==a.next&&_f(i.x,i.y,r.x,r.y,o.x,o.y,A.x,A.y)&&is(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;v&&v.z<=m;){if(v!==a.prev&&v!==a.next&&_f(i.x,i.y,r.x,r.y,o.x,o.y,v.x,v.y)&&is(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function iq(a,e,t){let n=a;do{const i=n.prev,r=n.next.next;!xv(i,r)&&iD(i,n,n.next,r)&&ug(i,r)&&ug(r,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(r.i/t),dg(n),dg(n.next),n=a=r),n=n.next}while(n!==a);return nh(n)}function sq(a,e,t,n,i,r){let o=a;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&fq(o,l)){let h=sD(o,l);o=nh(o,o.next),h=nh(h,h.next),hg(o,e,t,n,i,r),hg(h,e,t,n,i,r);return}l=l.next}o=o.next}while(o!==a)}function rq(a,e,t,n){const i=[];let r,o,l,h,u;for(r=0,o=e.length;r<o;r++)l=e[r]*n,h=r<o-1?e[r+1]*n:a.length,u=nD(a,l,h,n,!1),u===u.next&&(u.steiner=!0),i.push(dq(u));for(i.sort(oq),r=0;r<i.length;r++)aq(i[r],t),t=nh(t,t.next);return t}function oq(a,e){return a.x-e.x}function aq(a,e){if(e=cq(a,e),e){const t=sD(e,a);nh(e,e.next),nh(t,t.next)}}function cq(a,e){let t=e;const n=a.x,i=a.y;let r=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const m=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(m<=n&&m>r){if(r=m,m===n){if(i===t.y)return t;if(i===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===r)return o;const l=o,h=o.x,u=o.y;let f=1/0,g;t=o;do n>=t.x&&t.x>=h&&n!==t.x&&_f(i<u?n:r,i,h,u,i<u?r:n,i,t.x,t.y)&&(g=Math.abs(i-t.y)/(n-t.x),ug(t,a)&&(g<f||g===f&&(t.x>o.x||t.x===o.x&&lq(o,t)))&&(o=t,f=g)),t=t.next;while(t!==l);return o}function lq(a,e){return is(a.prev,a,e.prev)<0&&is(e.next,a,a.next)<0}function hq(a,e,t,n){let i=a;do i.z===null&&(i.z=iE(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==a);i.prevZ.nextZ=null,i.prevZ=null,uq(i)}function uq(a){let e,t,n,i,r,o,l,h,u=1;do{for(t=a,a=null,r=null,o=0;t;){for(o++,n=t,l=0,e=0;e<u&&(l++,n=n.nextZ,!!n);e++);for(h=u;l>0||h>0&&n;)l!==0&&(h===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,l--):(i=n,n=n.nextZ,h--),r?r.nextZ=i:a=i,i.prevZ=r,r=i;t=n}r.nextZ=null,u*=2}while(o>1);return a}function iE(a,e,t,n,i){return a=32767*(a-t)*i,e=32767*(e-n)*i,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,a|e<<1}function dq(a){let e=a,t=a;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==a);return t}function _f(a,e,t,n,i,r,o,l){return(i-o)*(e-l)-(a-o)*(r-l)>=0&&(a-o)*(n-l)-(t-o)*(e-l)>=0&&(t-o)*(r-l)-(i-o)*(n-l)>=0}function fq(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!pq(a,e)&&(ug(a,e)&&ug(e,a)&&mq(a,e)&&(is(a.prev,a,e.prev)||is(a,e.prev,e))||xv(a,e)&&is(a.prev,a,a.next)>0&&is(e.prev,e,e.next)>0)}function is(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function xv(a,e){return a.x===e.x&&a.y===e.y}function iD(a,e,t,n){const i=my(is(a,e,t)),r=my(is(a,e,n)),o=my(is(t,n,a)),l=my(is(t,n,e));return!!(i!==r&&o!==l||i===0&&py(a,t,e)||r===0&&py(a,n,e)||o===0&&py(t,a,n)||l===0&&py(t,e,n))}function py(a,e,t){return e.x<=Math.max(a.x,t.x)&&e.x>=Math.min(a.x,t.x)&&e.y<=Math.max(a.y,t.y)&&e.y>=Math.min(a.y,t.y)}function my(a){return a>0?1:a<0?-1:0}function pq(a,e){let t=a;do{if(t.i!==a.i&&t.next.i!==a.i&&t.i!==e.i&&t.next.i!==e.i&&iD(t,t.next,a,e))return!0;t=t.next}while(t!==a);return!1}function ug(a,e){return is(a.prev,a,a.next)<0?is(a,e,a.next)>=0&&is(a,a.prev,e)>=0:is(a,e,a.prev)<0||is(a,a.next,e)<0}function mq(a,e){let t=a,n=!1;const i=(a.x+e.x)/2,r=(a.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==a);return n}function sD(a,e){const t=new sE(a.i,a.x,a.y),n=new sE(e.i,e.x,e.y),i=a.next,r=e.prev;return a.next=e,e.prev=a,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function pP(a,e,t,n){const i=new sE(a,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function dg(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function sE(a,e,t){this.i=a,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gq(a,e,t,n){let i=0;for(let r=e,o=t-n;r<t;r+=n)i+=(a[o]-a[r])*(a[r+1]+a[o+1]),o=r;return i}class qa{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return qa.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];mP(e),gP(n,e);let o=e.length;t.forEach(mP);for(let h=0;h<t.length;h++)i.push(o),o+=t[h].length,gP(n,t[h]);const l=eq.triangulate(n,i);for(let h=0;h<l.length;h+=3)r.push(l.slice(h,h+3));return r}}function mP(a){const e=a.length;e>2&&a[e-1].equals(a[0])&&a.pop()}function gP(a,e){for(let t=0;t<e.length;t++)a.push(e[t].x),a.push(e[t].y)}class Hg extends Sn{constructor(e=new Lu([new Xe(.5,.5),new Xe(-.5,.5),new Xe(-.5,-.5),new Xe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];o(u)}this.setAttribute("position",new tn(i,3)),this.setAttribute("uv",new tn(r,2)),this.computeVertexNormals();function o(l){const h=[],u=t.curveSegments!==void 0?t.curveSegments:12,f=t.steps!==void 0?t.steps:1,g=t.depth!==void 0?t.depth:1;let m=t.bevelEnabled!==void 0?t.bevelEnabled:!0,A=t.bevelThickness!==void 0?t.bevelThickness:.2,v=t.bevelSize!==void 0?t.bevelSize:A-.1,b=t.bevelOffset!==void 0?t.bevelOffset:0,C=t.bevelSegments!==void 0?t.bevelSegments:3;const S=t.extrudePath,I=t.UVGenerator!==void 0?t.UVGenerator:Aq;let M,R=!1,T,B,F,D;S&&(M=S.getSpacedPoints(f),R=!0,m=!1,T=S.computeFrenetFrames(f,!1),B=new q,F=new q,D=new q),m||(C=0,A=0,v=0,b=0);const U=l.extractPoints(u);let W=U.shape;const J=U.holes;if(!qa.isClockWise(W)){W=W.reverse();for(let it=0,tt=J.length;it<tt;it++){const xt=J[it];qa.isClockWise(xt)&&(J[it]=xt.reverse())}}const Q=qa.triangulateShape(W,J),Y=W;for(let it=0,tt=J.length;it<tt;it++){const xt=J[it];W=W.concat(xt)}function se(it,tt,xt){return tt||console.error("THREE.ExtrudeGeometry: vec does not exist"),tt.clone().multiplyScalar(xt).add(it)}const ae=W.length,ve=Q.length;function xe(it,tt,xt){let Jt,Dt,Cn;const Kt=it.x-tt.x,ln=it.y-tt.y,ii=xt.x-it.x,Kn=xt.y-it.y,me=Kt*Kt+ln*ln,ce=Kt*Kn-ln*ii;if(Math.abs(ce)>Number.EPSILON){const je=Math.sqrt(me),yt=Math.sqrt(ii*ii+Kn*Kn),mt=tt.x-ln/je,Ht=tt.y+Kt/je,Mn=xt.x-Kn/yt,be=xt.y+ii/yt,ke=((Mn-mt)*Kn-(be-Ht)*ii)/(Kt*Kn-ln*ii);Jt=mt+Kt*ke-it.x,Dt=Ht+ln*ke-it.y;const Et=Jt*Jt+Dt*Dt;if(Et<=2)return new Xe(Jt,Dt);Cn=Math.sqrt(Et/2)}else{let je=!1;Kt>Number.EPSILON?ii>Number.EPSILON&&(je=!0):Kt<-Number.EPSILON?ii<-Number.EPSILON&&(je=!0):Math.sign(ln)===Math.sign(Kn)&&(je=!0),je?(Jt=-ln,Dt=Kt,Cn=Math.sqrt(me)):(Jt=Kt,Dt=ln,Cn=Math.sqrt(me/2))}return new Xe(Jt/Cn,Dt/Cn)}const Ae=[];for(let it=0,tt=Y.length,xt=tt-1,Jt=it+1;it<tt;it++,xt++,Jt++)xt===tt&&(xt=0),Jt===tt&&(Jt=0),Ae[it]=xe(Y[it],Y[xt],Y[Jt]);const Ie=[];let Le,De=Ae.concat();for(let it=0,tt=J.length;it<tt;it++){const xt=J[it];Le=[];for(let Jt=0,Dt=xt.length,Cn=Dt-1,Kt=Jt+1;Jt<Dt;Jt++,Cn++,Kt++)Cn===Dt&&(Cn=0),Kt===Dt&&(Kt=0),Le[Jt]=xe(xt[Jt],xt[Cn],xt[Kt]);Ie.push(Le),De=De.concat(Le)}for(let it=0;it<C;it++){const tt=it/C,xt=A*Math.cos(tt*Math.PI/2),Jt=v*Math.sin(tt*Math.PI/2)+b;for(let Dt=0,Cn=Y.length;Dt<Cn;Dt++){const Kt=se(Y[Dt],Ae[Dt],Jt);gn(Kt.x,Kt.y,-xt)}for(let Dt=0,Cn=J.length;Dt<Cn;Dt++){const Kt=J[Dt];Le=Ie[Dt];for(let ln=0,ii=Kt.length;ln<ii;ln++){const Kn=se(Kt[ln],Le[ln],Jt);gn(Kn.x,Kn.y,-xt)}}}const $e=v+b;for(let it=0;it<ae;it++){const tt=m?se(W[it],De[it],$e):W[it];R?(F.copy(T.normals[0]).multiplyScalar(tt.x),B.copy(T.binormals[0]).multiplyScalar(tt.y),D.copy(M[0]).add(F).add(B),gn(D.x,D.y,D.z)):gn(tt.x,tt.y,0)}for(let it=1;it<=f;it++)for(let tt=0;tt<ae;tt++){const xt=m?se(W[tt],De[tt],$e):W[tt];R?(F.copy(T.normals[it]).multiplyScalar(xt.x),B.copy(T.binormals[it]).multiplyScalar(xt.y),D.copy(M[it]).add(F).add(B),gn(D.x,D.y,D.z)):gn(xt.x,xt.y,g/f*it)}for(let it=C-1;it>=0;it--){const tt=it/C,xt=A*Math.cos(tt*Math.PI/2),Jt=v*Math.sin(tt*Math.PI/2)+b;for(let Dt=0,Cn=Y.length;Dt<Cn;Dt++){const Kt=se(Y[Dt],Ae[Dt],Jt);gn(Kt.x,Kt.y,g+xt)}for(let Dt=0,Cn=J.length;Dt<Cn;Dt++){const Kt=J[Dt];Le=Ie[Dt];for(let ln=0,ii=Kt.length;ln<ii;ln++){const Kn=se(Kt[ln],Le[ln],Jt);R?gn(Kn.x,Kn.y+M[f-1].y,M[f-1].x+xt):gn(Kn.x,Kn.y,g+xt)}}}vt(),zt();function vt(){const it=i.length/3;if(m){let tt=0,xt=ae*tt;for(let Jt=0;Jt<ve;Jt++){const Dt=Q[Jt];Xt(Dt[2]+xt,Dt[1]+xt,Dt[0]+xt)}tt=f+C*2,xt=ae*tt;for(let Jt=0;Jt<ve;Jt++){const Dt=Q[Jt];Xt(Dt[0]+xt,Dt[1]+xt,Dt[2]+xt)}}else{for(let tt=0;tt<ve;tt++){const xt=Q[tt];Xt(xt[2],xt[1],xt[0])}for(let tt=0;tt<ve;tt++){const xt=Q[tt];Xt(xt[0]+ae*f,xt[1]+ae*f,xt[2]+ae*f)}}n.addGroup(it,i.length/3-it,0)}function zt(){const it=i.length/3;let tt=0;Ve(Y,tt),tt+=Y.length;for(let xt=0,Jt=J.length;xt<Jt;xt++){const Dt=J[xt];Ve(Dt,tt),tt+=Dt.length}n.addGroup(it,i.length/3-it,1)}function Ve(it,tt){let xt=it.length;for(;--xt>=0;){const Jt=xt;let Dt=xt-1;Dt<0&&(Dt=it.length-1);for(let Cn=0,Kt=f+C*2;Cn<Kt;Cn++){const ln=ae*Cn,ii=ae*(Cn+1),Kn=tt+Jt+ln,me=tt+Dt+ln,ce=tt+Dt+ii,je=tt+Jt+ii;mn(Kn,me,ce,je)}}}function gn(it,tt,xt){h.push(it),h.push(tt),h.push(xt)}function Xt(it,tt,xt){Nt(it),Nt(tt),Nt(xt);const Jt=i.length/3,Dt=I.generateTopUV(n,i,Jt-3,Jt-2,Jt-1);vn(Dt[0]),vn(Dt[1]),vn(Dt[2])}function mn(it,tt,xt,Jt){Nt(it),Nt(tt),Nt(Jt),Nt(tt),Nt(xt),Nt(Jt);const Dt=i.length/3,Cn=I.generateSideWallUV(n,i,Dt-6,Dt-3,Dt-2,Dt-1);vn(Cn[0]),vn(Cn[1]),vn(Cn[3]),vn(Cn[1]),vn(Cn[2]),vn(Cn[3])}function Nt(it){i.push(h[it*3+0]),i.push(h[it*3+1]),i.push(h[it*3+2])}function vn(it){r.push(it.x),r.push(it.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return yq(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const l=t[e.shapes[r]];n.push(l)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new IS[i.type]().fromJSON(i)),new Hg(n,e.options)}}const Aq={generateTopUV:function(a,e,t,n,i){const r=e[t*3],o=e[t*3+1],l=e[n*3],h=e[n*3+1],u=e[i*3],f=e[i*3+1];return[new Xe(r,o),new Xe(l,h),new Xe(u,f)]},generateSideWallUV:function(a,e,t,n,i,r){const o=e[t*3],l=e[t*3+1],h=e[t*3+2],u=e[n*3],f=e[n*3+1],g=e[n*3+2],m=e[i*3],A=e[i*3+1],v=e[i*3+2],b=e[r*3],C=e[r*3+1],S=e[r*3+2];return Math.abs(l-f)<Math.abs(o-u)?[new Xe(o,1-h),new Xe(u,1-g),new Xe(m,1-v),new Xe(b,1-S)]:[new Xe(l,1-h),new Xe(f,1-g),new Xe(A,1-v),new Xe(C,1-S)]}};function yq(a,e,t){if(t.shapes=[],Array.isArray(a))for(let n=0,i=a.length;n<i;n++){const r=a[n];t.shapes.push(r.uuid)}else t.shapes.push(a.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Yf extends Jc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Yf(e.radius,e.detail)}}class Va extends Jc{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Va(e.radius,e.detail)}}class Jf extends Sn{constructor(e=.5,t=1,n=8,i=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const l=[],h=[],u=[],f=[];let g=e;const m=(t-e)/i,A=new q,v=new Xe;for(let b=0;b<=i;b++){for(let C=0;C<=n;C++){const S=r+C/n*o;A.x=g*Math.cos(S),A.y=g*Math.sin(S),h.push(A.x,A.y,A.z),u.push(0,0,1),v.x=(A.x/t+1)/2,v.y=(A.y/t+1)/2,f.push(v.x,v.y)}g+=m}for(let b=0;b<i;b++){const C=b*(n+1);for(let S=0;S<n;S++){const I=S+C,M=I,R=I+n+1,T=I+n+2,B=I+1;l.push(M,R,B),l.push(R,T,B)}}this.setIndex(l),this.setAttribute("position",new tn(h,3)),this.setAttribute("normal",new tn(u,3)),this.setAttribute("uv",new tn(f,2))}static fromJSON(e){return new Jf(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Vg extends Sn{constructor(e=new Lu([new Xe(0,.5),new Xe(-.5,-.5),new Xe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let l=0,h=0;if(Array.isArray(e)===!1)u(e);else for(let f=0;f<e.length;f++)u(e[f]),this.addGroup(l,h,f),l+=h,h=0;this.setIndex(n),this.setAttribute("position",new tn(i,3)),this.setAttribute("normal",new tn(r,3)),this.setAttribute("uv",new tn(o,2));function u(f){const g=i.length/3,m=f.extractPoints(t);let A=m.shape;const v=m.holes;qa.isClockWise(A)===!1&&(A=A.reverse());for(let C=0,S=v.length;C<S;C++){const I=v[C];qa.isClockWise(I)===!0&&(v[C]=I.reverse())}const b=qa.triangulateShape(A,v);for(let C=0,S=v.length;C<S;C++){const I=v[C];A=A.concat(I)}for(let C=0,S=A.length;C<S;C++){const I=A[C];i.push(I.x,I.y,0),r.push(0,0,1),o.push(I.x,I.y)}for(let C=0,S=b.length;C<S;C++){const I=b[C],M=I[0]+g,R=I[1]+g,T=I[2]+g;n.push(M,R,T),h+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return _q(t,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const o=t[e.shapes[i]];n.push(o)}return new Vg(n,e.curveSegments)}}function _q(a,e){if(e.shapes=[],Array.isArray(a))for(let t=0,n=a.length;t<n;t++){const i=a[t];e.shapes.push(i.uuid)}else e.shapes.push(a.uuid);return e}class mo extends Sn{constructor(e=1,t=32,n=16,i=0,r=Math.PI*2,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:l},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const h=Math.min(o+l,Math.PI);let u=0;const f=[],g=new q,m=new q,A=[],v=[],b=[],C=[];for(let S=0;S<=n;S++){const I=[],M=S/n;let R=0;S==0&&o==0?R=.5/t:S==n&&h==Math.PI&&(R=-.5/t);for(let T=0;T<=t;T++){const B=T/t;g.x=-e*Math.cos(i+B*r)*Math.sin(o+M*l),g.y=e*Math.cos(o+M*l),g.z=e*Math.sin(i+B*r)*Math.sin(o+M*l),v.push(g.x,g.y,g.z),m.copy(g).normalize(),b.push(m.x,m.y,m.z),C.push(B+R,1-M),I.push(u++)}f.push(I)}for(let S=0;S<n;S++)for(let I=0;I<t;I++){const M=f[S][I+1],R=f[S][I],T=f[S+1][I],B=f[S+1][I+1];(S!==0||o>0)&&A.push(M,R,B),(S!==n-1||h<Math.PI)&&A.push(R,T,B)}this.setIndex(A),this.setAttribute("position",new tn(v,3)),this.setAttribute("normal",new tn(b,3)),this.setAttribute("uv",new tn(C,2))}static fromJSON(e){return new mo(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Wg extends Jc{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Wg(e.radius,e.detail)}}class za extends Sn{constructor(e=1,t=.4,n=8,i=6,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],l=[],h=[],u=[],f=new q,g=new q,m=new q;for(let A=0;A<=n;A++)for(let v=0;v<=i;v++){const b=v/i*r,C=A/n*Math.PI*2;g.x=(e+t*Math.cos(C))*Math.cos(b),g.y=(e+t*Math.cos(C))*Math.sin(b),g.z=t*Math.sin(C),l.push(g.x,g.y,g.z),f.x=e*Math.cos(b),f.y=e*Math.sin(b),m.subVectors(g,f).normalize(),h.push(m.x,m.y,m.z),u.push(v/i),u.push(A/n)}for(let A=1;A<=n;A++)for(let v=1;v<=i;v++){const b=(i+1)*A+v-1,C=(i+1)*(A-1)+v-1,S=(i+1)*(A-1)+v,I=(i+1)*A+v;o.push(b,C,I),o.push(C,S,I)}this.setIndex(o),this.setAttribute("position",new tn(l,3)),this.setAttribute("normal",new tn(h,3)),this.setAttribute("uv",new tn(u,2))}static fromJSON(e){return new za(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Qg extends Sn{constructor(e=1,t=.4,n=64,i=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const l=[],h=[],u=[],f=[],g=new q,m=new q,A=new q,v=new q,b=new q,C=new q,S=new q;for(let M=0;M<=n;++M){const R=M/n*r*Math.PI*2;I(R,r,o,e,A),I(R+.01,r,o,e,v),C.subVectors(v,A),S.addVectors(v,A),b.crossVectors(C,S),S.crossVectors(b,C),b.normalize(),S.normalize();for(let T=0;T<=i;++T){const B=T/i*Math.PI*2,F=-t*Math.cos(B),D=t*Math.sin(B);g.x=A.x+(F*S.x+D*b.x),g.y=A.y+(F*S.y+D*b.y),g.z=A.z+(F*S.z+D*b.z),h.push(g.x,g.y,g.z),m.subVectors(g,A).normalize(),u.push(m.x,m.y,m.z),f.push(M/n),f.push(T/i)}}for(let M=1;M<=n;M++)for(let R=1;R<=i;R++){const T=(i+1)*(M-1)+(R-1),B=(i+1)*M+(R-1),F=(i+1)*M+R,D=(i+1)*(M-1)+R;l.push(T,B,D),l.push(B,F,D)}this.setIndex(l),this.setAttribute("position",new tn(h,3)),this.setAttribute("normal",new tn(u,3)),this.setAttribute("uv",new tn(f,2));function I(M,R,T,B,F){const D=Math.cos(M),U=Math.sin(M),W=T/R*M,J=Math.cos(W);F.x=B*(2+J)*.5*D,F.y=B*(2+J)*U*.5,F.z=B*Math.sin(W)*.5}}static fromJSON(e){return new Qg(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class jg extends Sn{constructor(e=new MS(new q(-1,-1,0),new q(-1,1,0),new q(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const l=new q,h=new q,u=new Xe;let f=new q;const g=[],m=[],A=[],v=[];b(),this.setIndex(v),this.setAttribute("position",new tn(g,3)),this.setAttribute("normal",new tn(m,3)),this.setAttribute("uv",new tn(A,2));function b(){for(let M=0;M<t;M++)C(M);C(r===!1?t:0),I(),S()}function C(M){f=e.getPointAt(M/t,f);const R=o.normals[M],T=o.binormals[M];for(let B=0;B<=i;B++){const F=B/i*Math.PI*2,D=Math.sin(F),U=-Math.cos(F);h.x=U*R.x+D*T.x,h.y=U*R.y+D*T.y,h.z=U*R.z+D*T.z,h.normalize(),m.push(h.x,h.y,h.z),l.x=f.x+n*h.x,l.y=f.y+n*h.y,l.z=f.z+n*h.z,g.push(l.x,l.y,l.z)}}function S(){for(let M=1;M<=t;M++)for(let R=1;R<=i;R++){const T=(i+1)*(M-1)+(R-1),B=(i+1)*M+(R-1),F=(i+1)*M+R,D=(i+1)*(M-1)+R;v.push(T,B,D),v.push(B,F,D)}}function I(){for(let M=0;M<=t;M++)for(let R=0;R<=i;R++)u.x=M/t,u.y=R/i,A.push(u.x,u.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new jg(new IS[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class rD extends Sn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new q,r=new q;if(e.index!==null){const o=e.attributes.position,l=e.index;let h=e.groups;h.length===0&&(h=[{start:0,count:l.count,materialIndex:0}]);for(let u=0,f=h.length;u<f;++u){const g=h[u],m=g.start,A=g.count;for(let v=m,b=m+A;v<b;v+=3)for(let C=0;C<3;C++){const S=l.getX(v+C),I=l.getX(v+(C+1)%3);i.fromBufferAttribute(o,S),r.fromBufferAttribute(o,I),AP(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let l=0,h=o.count/3;l<h;l++)for(let u=0;u<3;u++){const f=3*l+u,g=3*l+(u+1)%3;i.fromBufferAttribute(o,f),r.fromBufferAttribute(o,g),AP(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new tn(t,3))}}}function AP(a,e,t){const n=`${a.x},${a.y},${a.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${a.x},${a.y},${a.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var yP=Object.freeze({__proto__:null,BoxGeometry:zi,CapsuleGeometry:Ng,CircleGeometry:Ug,ConeGeometry:zg,CylinderGeometry:ls,DodecahedronGeometry:Gg,EdgesGeometry:RS,ExtrudeGeometry:Hg,IcosahedronGeometry:Yf,LatheGeometry:Xf,OctahedronGeometry:Va,PlaneGeometry:Yr,PolyhedronGeometry:Jc,RingGeometry:Jf,ShapeGeometry:Vg,SphereGeometry:mo,TetrahedronGeometry:Wg,TorusGeometry:za,TorusKnotGeometry:Qg,TubeGeometry:jg,WireframeGeometry:rD});class PS extends vs{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ye(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class BS extends js{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Kf extends vs{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ye(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Kc extends Kf{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return As(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ye(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ye(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ye(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class oD extends vs{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ye(16777215),this.specular=new ye(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ig,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class aD extends vs{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ye(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class cD extends vs{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class lD extends vs{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ye(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ig,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class hD extends vs{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ye(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uD extends Ts{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Lo(a,e,t){return LS(a)?new a.constructor(a.subarray(e,t!==void 0?t:a.length)):a.slice(e,t)}function bu(a,e,t){return!a||!t&&a.constructor===e?a:typeof e.BYTES_PER_ELEMENT=="number"?new e(a):Array.prototype.slice.call(a)}function LS(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function dD(a){function e(i,r){return a[i]-a[r]}const t=a.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function rE(a,e,t){const n=a.length,i=new a.constructor(n);for(let r=0,o=0;o!==n;++r){const l=t[r]*e;for(let h=0;h!==e;++h)i[o++]=a[l+h]}return i}function DS(a,e,t,n){let i=1,r=a[0];for(;r!==void 0&&r[n]===void 0;)r=a[i++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=a[i++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=a[i++];while(r!==void 0);else do o=r[n],o!==void 0&&(e.push(r.time),t.push(o)),r=a[i++];while(r!==void 0)}function vq(a,e,t,n,i=30){const r=a.clone();r.name=e;const o=[];for(let h=0;h<r.tracks.length;++h){const u=r.tracks[h],f=u.getValueSize(),g=[],m=[];for(let A=0;A<u.times.length;++A){const v=u.times[A]*i;if(!(v<t||v>=n)){g.push(u.times[A]);for(let b=0;b<f;++b)m.push(u.values[A*f+b])}}g.length!==0&&(u.times=bu(g,u.times.constructor),u.values=bu(m,u.values.constructor),o.push(u))}r.tracks=o;let l=1/0;for(let h=0;h<r.tracks.length;++h)l>r.tracks[h].times[0]&&(l=r.tracks[h].times[0]);for(let h=0;h<r.tracks.length;++h)r.tracks[h].shift(-1*l);return r.resetDuration(),r}function xq(a,e=0,t=a,n=30){n<=0&&(n=30);const i=t.tracks.length,r=e/n;for(let o=0;o<i;++o){const l=t.tracks[o],h=l.ValueTypeName;if(h==="bool"||h==="string")continue;const u=a.tracks.find(function(S){return S.name===l.name&&S.ValueTypeName===h});if(u===void 0)continue;let f=0;const g=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=g/3);let m=0;const A=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=A/3);const v=l.times.length-1;let b;if(r<=l.times[0]){const S=f,I=g-f;b=Lo(l.values,S,I)}else if(r>=l.times[v]){const S=v*g+f,I=S+g-f;b=Lo(l.values,S,I)}else{const S=l.createInterpolant(),I=f,M=g-f;S.evaluate(r),b=Lo(S.resultBuffer,I,M)}h==="quaternion"&&new kt().fromArray(b).normalize().conjugate().toArray(b);const C=u.times.length;for(let S=0;S<C;++S){const I=S*A+m;if(h==="quaternion")kt.multiplyQuaternionsFlat(u.values,I,b,0,u.values,I);else{const M=A-m*2;for(let R=0;R<M;++R)u.values[I+R]-=b[R]}}}return a.blendMode=rS,a}var wq=Object.freeze({__proto__:null,arraySlice:Lo,convertArray:bu,isTypedArray:LS,getKeyframeOrder:dD,sortedArray:rE,flattenJSON:DS,subclip:vq,makeClipAdditive:xq});class Zf{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let l=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===l)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=r)){const l=t[1];e<l&&(n=2,r=l);for(let h=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===h)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const l=n+o>>>1;e<t[l]?o=l:n=l+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class fD extends Zf{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:xu,endingEnd:xu}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,l=i[r],h=i[o];if(l===void 0)switch(this.getSettings_().endingStart){case wu:r=e,l=2*t-n;break;case rg:r=i.length-2,l=t+i[r]-i[r+1];break;default:r=e,l=n}if(h===void 0)switch(this.getSettings_().endingEnd){case wu:o=e,h=2*n-t;break;case rg:o=1,h=n+i[1]-i[0];break;default:o=e-1,h=t}const u=(n-t)*.5,f=this.valueSize;this._weightPrev=u/(t-l),this._weightNext=u/(h-n),this._offsetPrev=r*f,this._offsetNext=o*f}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=e*l,u=h-l,f=this._offsetPrev,g=this._offsetNext,m=this._weightPrev,A=this._weightNext,v=(n-t)/(i-t),b=v*v,C=b*v,S=-m*C+2*m*b-m*v,I=(1+m)*C+(-1.5-2*m)*b+(-.5+m)*v+1,M=(-1-A)*C+(1.5+A)*b+.5*v,R=A*C-A*b;for(let T=0;T!==l;++T)r[T]=S*o[f+T]+I*o[u+T]+M*o[h+T]+R*o[g+T];return r}}class OS extends Zf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=e*l,u=h-l,f=(n-t)/(i-t),g=1-f;for(let m=0;m!==l;++m)r[m]=o[u+m]*g+o[h+m]*f;return r}}class pD extends Zf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class wa{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=bu(t,this.TimeBufferType),this.values=bu(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:bu(e.times,Array),values:bu(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new pD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new OS(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new fD(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Uu:t=this.InterpolantFactoryMethodDiscrete;break;case jc:t=this.InterpolantFactoryMethodLinear;break;case Xy:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Uu;case this.InterpolantFactoryMethodLinear:return jc;case this.InterpolantFactoryMethodSmooth:return Xy}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;o!==-1&&n[o]>t;)--o;if(++o,r!==0||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const l=this.getValueSize();this.times=Lo(n,r,o),this.values=Lo(this.values,r*l,o*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let l=0;l!==r;l++){const h=n[l];if(typeof h=="number"&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,h),e=!1;break}if(o!==null&&o>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,h,o),e=!1;break}o=h}if(i!==void 0&&LS(i))for(let l=0,h=i.length;l!==h;++l){const u=i[l];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,u),e=!1;break}}return e}optimize(){const e=Lo(this.times),t=Lo(this.values),n=this.getValueSize(),i=this.getInterpolation()===Xy,r=e.length-1;let o=1;for(let l=1;l<r;++l){let h=!1;const u=e[l],f=e[l+1];if(u!==f&&(l!==1||u!==e[0]))if(i)h=!0;else{const g=l*n,m=g-n,A=g+n;for(let v=0;v!==n;++v){const b=t[g+v];if(b!==t[m+v]||b!==t[A+v]){h=!0;break}}}if(h){if(l!==o){e[o]=e[l];const g=l*n,m=o*n;for(let A=0;A!==n;++A)t[m+A]=t[g+A]}++o}}if(r>0){e[o]=e[r];for(let l=r*n,h=o*n,u=0;u!==n;++u)t[h+u]=t[l+u];++o}return o!==e.length?(this.times=Lo(e,0,o),this.values=Lo(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=Lo(this.times,0),t=Lo(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}wa.prototype.TimeBufferType=Float32Array;wa.prototype.ValueBufferType=Float32Array;wa.prototype.DefaultInterpolation=jc;class Wu extends wa{}Wu.prototype.ValueTypeName="bool";Wu.prototype.ValueBufferType=Array;Wu.prototype.DefaultInterpolation=Uu;Wu.prototype.InterpolantFactoryMethodLinear=void 0;Wu.prototype.InterpolantFactoryMethodSmooth=void 0;class qg extends wa{}qg.prototype.ValueTypeName="color";class ih extends wa{}ih.prototype.ValueTypeName="number";class mD extends Zf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=(n-t)/(i-t);let u=e*l;for(let f=u+l;u!==f;u+=4)kt.slerpFlat(r,0,o,u-l,o,u,h);return r}}class tc extends wa{InterpolantFactoryMethodLinear(e){return new mD(this.times,this.values,this.getValueSize(),e)}}tc.prototype.ValueTypeName="quaternion";tc.prototype.DefaultInterpolation=jc;tc.prototype.InterpolantFactoryMethodSmooth=void 0;class Qu extends wa{}Qu.prototype.ValueTypeName="string";Qu.prototype.ValueBufferType=Array;Qu.prototype.DefaultInterpolation=Uu;Qu.prototype.InterpolantFactoryMethodLinear=void 0;Qu.prototype.InterpolantFactoryMethodSmooth=void 0;class sh extends wa{}sh.prototype.ValueTypeName="vector";class rh{constructor(e,t=-1,n,i=uv){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=ho(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,l=n.length;o!==l;++o)t.push(Cq(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(wa.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let l=0;l<r;l++){let h=[],u=[];h.push((l+r-1)%r,l,(l+1)%r),u.push(0,1,0);const f=dD(h);h=rE(h,1,f),u=rE(u,1,f),!i&&h[0]===0&&(h.push(r),u.push(u[0])),o.push(new ih(".morphTargetInfluences["+t[l].name+"]",h,u).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let l=0,h=e.length;l<h;l++){const u=e[l],f=u.name.match(r);if(f&&f.length>1){const g=f[1];let m=i[g];m||(i[g]=m=[]),m.push(u)}}const o=[];for(const l in i)o.push(this.CreateFromMorphTargetSequence(l,i[l],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(g,m,A,v,b){if(A.length!==0){const C=[],S=[];DS(A,C,S,v),C.length!==0&&b.push(new g(m,C,S))}},i=[],r=e.name||"default",o=e.fps||30,l=e.blendMode;let h=e.length||-1;const u=e.hierarchy||[];for(let g=0;g<u.length;g++){const m=u[g].keys;if(!(!m||m.length===0))if(m[0].morphTargets){const A={};let v;for(v=0;v<m.length;v++)if(m[v].morphTargets)for(let b=0;b<m[v].morphTargets.length;b++)A[m[v].morphTargets[b]]=-1;for(const b in A){const C=[],S=[];for(let I=0;I!==m[v].morphTargets.length;++I){const M=m[v];C.push(M.time),S.push(M.morphTarget===b?1:0)}i.push(new ih(".morphTargetInfluence["+b+"]",C,S))}h=A.length*o}else{const A=".bones["+t[g].name+"]";n(sh,A+".position",m,"pos",i),n(tc,A+".quaternion",m,"rot",i),n(sh,A+".scale",m,"scl",i)}}return i.length===0?null:new this(r,h,i,l)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function bq(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ih;case"vector":case"vector2":case"vector3":case"vector4":return sh;case"color":return qg;case"quaternion":return tc;case"bool":case"boolean":return Wu;case"string":return Qu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function Cq(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=bq(a.type);if(a.times===void 0){const t=[],n=[];DS(a.keys,t,n,"value"),a.times=t,a.values=n}return e.parse!==void 0?e.parse(a):new e(a.name,a.times,a.values,a.interpolation)}const Gu={enabled:!1,files:{},add:function(a,e){this.enabled!==!1&&(this.files[a]=e)},get:function(a){if(this.enabled!==!1)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};class FS{constructor(e,t,n){const i=this;let r=!1,o=0,l=0,h;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(f){l++,r===!1&&i.onStart!==void 0&&i.onStart(f,o,l),r=!0},this.itemEnd=function(f){o++,i.onProgress!==void 0&&i.onProgress(f,o,l),o===l&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(f){i.onError!==void 0&&i.onError(f)},this.resolveURL=function(f){return h?h(f):f},this.setURLModifier=function(f){return h=f,this},this.addHandler=function(f,g){return u.push(f,g),this},this.removeHandler=function(f){const g=u.indexOf(f);return g!==-1&&u.splice(g,2),this},this.getHandler=function(f){for(let g=0,m=u.length;g<m;g+=2){const A=u[g],v=u[g+1];if(A.global&&(A.lastIndex=0),A.test(f))return v}return null}}}const gD=new FS;class _r{constructor(e){this.manager=e!==void 0?e:gD,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ec={};class Eq extends Error{constructor(e,t){super(e),this.response=t}}class ks extends _r{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Gu.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Ec[e]!==void 0){Ec[e].push({onLoad:t,onProgress:n,onError:i});return}Ec[e]=[],Ec[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,h=this.responseType;fetch(o).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const f=Ec[e],g=u.body.getReader(),m=u.headers.get("Content-Length"),A=m?parseInt(m):0,v=A!==0;let b=0;const C=new ReadableStream({start(S){I();function I(){g.read().then(({done:M,value:R})=>{if(M)S.close();else{b+=R.byteLength;const T=new ProgressEvent("progress",{lengthComputable:v,loaded:b,total:A});for(let B=0,F=f.length;B<F;B++){const D=f[B];D.onProgress&&D.onProgress(T)}S.enqueue(R),I()}})}}});return new Response(C)}else throw new Eq(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(h){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(f=>new DOMParser().parseFromString(f,l));case"json":return u.json();default:if(l===void 0)return u.text();{const g=/charset="?([^;"\s]*)"?/i.exec(l),m=g&&g[1]?g[1].toLowerCase():void 0,A=new TextDecoder(m);return u.arrayBuffer().then(v=>A.decode(v))}}}).then(u=>{Gu.add(e,u);const f=Ec[e];delete Ec[e];for(let g=0,m=f.length;g<m;g++){const A=f[g];A.onLoad&&A.onLoad(u)}}).catch(u=>{const f=Ec[e];if(f===void 0)throw this.manager.itemError(e),u;delete Ec[e];for(let g=0,m=f.length;g<m;g++){const A=f[g];A.onError&&A.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Sq extends _r{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new ks(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(r.parse(JSON.parse(l)))}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=rh.parse(e[n]);t.push(i)}return t}}class Mq extends _r{constructor(e){super(e)}load(e,t,n,i){const r=this,o=[],l=new Nl,h=new ks(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(r.withCredentials);let u=0;function f(g){h.load(e[g],function(m){const A=r.parse(m,!0);o[g]={width:A.width,height:A.height,format:A.format,mipmaps:A.mipmaps},u+=1,u===6&&(A.mipmapCount===1&&(l.minFilter=vi),l.image=o,l.format=A.format,l.needsUpdate=!0,t&&t(l))},n,i)}if(Array.isArray(e))for(let g=0,m=e.length;g<m;++g)f(g);else h.load(e,function(g){const m=r.parse(g,!0);if(m.isCubemap){const A=m.mipmaps.length/m.mipmapCount;for(let v=0;v<A;v++){o[v]={mipmaps:[]};for(let b=0;b<m.mipmapCount;b++)o[v].mipmaps.push(m.mipmaps[v*m.mipmapCount+b]),o[v].format=m.format,o[v].width=m.width,o[v].height=m.height}l.image=o}else l.image.width=m.width,l.image.height=m.height,l.mipmaps=m.mipmaps;m.mipmapCount===1&&(l.minFilter=vi),l.format=m.format,l.needsUpdate=!0,t&&t(l)},n,i);return l}}class fg extends _r{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Gu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const l=cg("img");function h(){f(),Gu.add(e,this),t&&t(this),r.manager.itemEnd(e)}function u(g){f(),i&&i(g),r.manager.itemError(e),r.manager.itemEnd(e)}function f(){l.removeEventListener("load",h,!1),l.removeEventListener("error",u,!1)}return l.addEventListener("load",h,!1),l.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),r.manager.itemStart(e),l.src=e,l}}class Tq extends _r{constructor(e){super(e)}load(e,t,n,i){const r=new Lg,o=new fg(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let l=0;function h(u){o.load(e[u],function(f){r.images[u]=f,l++,l===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let u=0;u<e.length;++u)h(u);return r}}class kS extends _r{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new ja,l=new ks(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(r.withCredentials),l.load(e,function(h){const u=r.parse(h);!u||(u.image!==void 0?o.image=u.image:u.data!==void 0&&(o.image.width=u.width,o.image.height=u.height,o.image.data=u.data),o.wrapS=u.wrapS!==void 0?u.wrapS:Os,o.wrapT=u.wrapT!==void 0?u.wrapT:Os,o.magFilter=u.magFilter!==void 0?u.magFilter:vi,o.minFilter=u.minFilter!==void 0?u.minFilter:vi,o.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.encoding!==void 0&&(o.encoding=u.encoding),u.flipY!==void 0&&(o.flipY=u.flipY),u.format!==void 0&&(o.format=u.format),u.type!==void 0&&(o.type=u.type),u.mipmaps!==void 0&&(o.mipmaps=u.mipmaps,o.minFilter=va),u.mipmapCount===1&&(o.minFilter=vi),u.generateMipmaps!==void 0&&(o.generateMipmaps=u.generateMipmaps),o.needsUpdate=!0,t&&t(o,u))},n,i),o}}class Xg extends _r{constructor(e){super(e)}load(e,t,n,i){const r=new Ii,o=new fg(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(l){r.image=l,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}}class hh extends Ft{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ye(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class NS extends hh{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ft.DefaultUp),this.updateMatrix(),this.groundColor=new ye(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Lb=new fn,_P=new q,vP=new q;class US{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xe(512,512),this.map=null,this.mapPass=null,this.matrix=new fn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fv,this._frameExtents=new Xe(1,1),this._viewportCount=1,this._viewports=[new Bn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;_P.setFromMatrixPosition(e.matrixWorld),t.position.copy(_P),vP.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(vP),t.updateMatrixWorld(),Lb.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Lb),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Lb)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Iq extends US{constructor(){super(new ns(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=ag*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class wv extends hh{constructor(e,t,n=0,i=Math.PI/3,r=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ft.DefaultUp),this.updateMatrix(),this.target=new Ft,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Iq}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const xP=new fn,gm=new q,Db=new q;class Rq extends US{constructor(){super(new ns(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xe(4,2),this._viewportCount=6,this._viewports=[new Bn(2,1,1,1),new Bn(0,1,1,1),new Bn(3,1,1,1),new Bn(1,1,1,1),new Bn(3,0,1,1),new Bn(1,0,1,1)],this._cubeDirections=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],this._cubeUps=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),gm.setFromMatrixPosition(e.matrixWorld),n.position.copy(gm),Db.copy(n.position),Db.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Db),n.updateMatrixWorld(),i.makeTranslation(-gm.x,-gm.y,-gm.z),xP.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xP)}}class bv extends hh{constructor(e,t,n=0,i=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Rq}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Pq extends US{constructor(){super(new lh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Cv extends hh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ft.DefaultUp),this.updateMatrix(),this.target=new Ft,this.shadow=new Pq}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class zS extends hh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class AD extends hh{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class vf{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new q)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*i)),t.addScaledVector(o[5],1.092548*(i*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(n*r)),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*i),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*i),t.addScaledVector(o[5],2*.429043*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class zf extends hh{constructor(e=new vf,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Ev extends _r{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,o=new ks(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(l){try{t(r.parse(JSON.parse(l)))}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const i=Ev.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new ye().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=new ye().setHex(o.value);break;case"v2":i.uniforms[r].value=new Xe().fromArray(o.value);break;case"v3":i.uniforms[r].value=new q().fromArray(o.value);break;case"v4":i.uniforms[r].value=new Bn().fromArray(o.value);break;case"m3":i.uniforms[r].value=new Vr().fromArray(o.value);break;case"m4":i.uniforms[r].value=new fn().fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new Xe().fromArray(r)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Xe().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:PS,SpriteMaterial:yS,RawShaderMaterial:BS,ShaderMaterial:js,PointsMaterial:kg,MeshPhysicalMaterial:Kc,MeshStandardMaterial:Kf,MeshPhongMaterial:oD,MeshToonMaterial:aD,MeshNormalMaterial:cD,MeshLambertMaterial:lD,MeshDepthMaterial:mS,MeshDistanceMaterial:gS,MeshBasicMaterial:Hi,MeshMatcapMaterial:hD,LineDashedMaterial:uD,LineBasicMaterial:Ts,Material:vs};return new t[e]}}class Xa{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class yD extends Sn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class _D extends _r{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new ks(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(l){try{t(r.parse(JSON.parse(l)))}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(A,v){if(t[v]!==void 0)return t[v];const C=A.interleavedBuffers[v],S=r(A,C.buffer),I=Af(C.type,S),M=new Og(I,C.stride);return M.uuid=C.uuid,t[v]=M,M}function r(A,v){if(n[v]!==void 0)return n[v];const C=A.arrayBuffers[v],S=new Uint32Array(C).buffer;return n[v]=S,S}const o=e.isInstancedBufferGeometry?new yD:new Sn,l=e.data.index;if(l!==void 0){const A=Af(l.type,l.array);o.setIndex(new Jn(A,1))}const h=e.data.attributes;for(const A in h){const v=h[A];let b;if(v.isInterleavedBufferAttribute){const C=i(e.data,v.data);b=new th(C,v.itemSize,v.offset,v.normalized)}else{const C=Af(v.type,v.array),S=v.isInstancedBufferAttribute?Uf:Jn;b=new S(C,v.itemSize,v.normalized)}v.name!==void 0&&(b.name=v.name),v.usage!==void 0&&b.setUsage(v.usage),v.updateRange!==void 0&&(b.updateRange.offset=v.updateRange.offset,b.updateRange.count=v.updateRange.count),o.setAttribute(A,b)}const u=e.data.morphAttributes;if(u)for(const A in u){const v=u[A],b=[];for(let C=0,S=v.length;C<S;C++){const I=v[C];let M;if(I.isInterleavedBufferAttribute){const R=i(e.data,I.data);M=new th(R,I.itemSize,I.offset,I.normalized)}else{const R=Af(I.type,I.array);M=new Jn(R,I.itemSize,I.normalized)}I.name!==void 0&&(M.name=I.name),b.push(M)}o.morphAttributes[A]=b}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const g=e.data.groups||e.data.drawcalls||e.data.offsets;if(g!==void 0)for(let A=0,v=g.length;A!==v;++A){const b=g[A];o.addGroup(b.start,b.count,b.materialIndex)}const m=e.data.boundingSphere;if(m!==void 0){const A=new q;m.center!==void 0&&A.fromArray(m.center),o.boundingSphere=new ec(A,m.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class Bq extends _r{constructor(e){super(e)}load(e,t,n,i){const r=this,o=this.path===""?Xa.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const l=new ks(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(h){let u=null;try{u=JSON.parse(h)}catch(g){i!==void 0&&i(g),console.error("THREE:ObjectLoader: Can't parse "+e+".",g.message);return}const f=u.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(u,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?Xa.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const r=new ks(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),l=JSON.parse(o),h=l.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(l)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,function(){t!==void 0&&t(u)}),l=this.parseTextures(e.textures,o),h=this.parseMaterials(e.materials,l),u=this.parseObject(e.object,r,h,l,n),f=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,f),t!==void 0){let g=!1;for(const m in o)if(o[m].data instanceof HTMLImageElement){g=!0;break}g===!1&&t(u)}return u}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),l=this.parseMaterials(e.materials,o),h=this.parseObject(e.object,i,l,o,t),u=this.parseSkeletons(e.skeletons,h);return this.bindSkeletons(h,u),h}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const r=new Lu().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(r){r.isBone&&(i[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const l=new Fg().fromJSON(e[r],i);n[l.uuid]=l}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new _D;for(let r=0,o=e.length;r<o;r++){let l;const h=e[r];switch(h.type){case"BufferGeometry":case"InstancedBufferGeometry":l=i.parse(h);break;default:h.type in yP?l=yP[h.type].fromJSON(h,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${h.type}"`)}l.uuid=h.uuid,h.name!==void 0&&(l.name=h.name),l.isBufferGeometry===!0&&h.userData!==void 0&&(l.userData=h.userData),n[h.uuid]=l}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const r=new Ev;r.setTextures(t);for(let o=0,l=e.length;o<l;o++){const h=e[o];n[h.uuid]===void 0&&(n[h.uuid]=r.parse(h)),i[h.uuid]=n[h.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],r=rh.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function o(h){return n.manager.itemStart(h),r.load(h,function(){n.manager.itemEnd(h)},void 0,function(){n.manager.itemError(h),n.manager.itemEnd(h)})}function l(h){if(typeof h=="string"){const u=h,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return o(f)}else return h.data?{data:Af(h.type,h.data),width:h.width,height:h.height}:null}if(e!==void 0&&e.length>0){const h=new FS(t);r=new fg(h),r.setCrossOrigin(this.crossOrigin);for(let u=0,f=e.length;u<f;u++){const g=e[u],m=g.url;if(Array.isArray(m)){const A=[];for(let v=0,b=m.length;v<b;v++){const C=m[v],S=l(C);S!==null&&(S instanceof HTMLImageElement?A.push(S):A.push(new ja(S.data,S.width,S.height)))}i[g.uuid]=new Wl(A)}else{const A=l(g.url);i[g.uuid]=new Wl(A)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(o){if(typeof o=="string"){const l=o,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:t.resourcePath+l;return await i.loadAsync(h)}else return o.data?{data:Af(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){i=new fg(this.manager),i.setCrossOrigin(this.crossOrigin);for(let o=0,l=e.length;o<l;o++){const h=e[o],u=h.url;if(Array.isArray(u)){const f=[];for(let g=0,m=u.length;g<m;g++){const A=u[g],v=await r(A);v!==null&&(v instanceof HTMLImageElement?f.push(v):f.push(new ja(v.data,v.width,v.height)))}n[h.uuid]=new Wl(f)}else{const f=await r(h.url);n[h.uuid]=new Wl(f)}}}return n}parseTextures(e,t){function n(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const i={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const l=e[r];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),t[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const h=t[l.image],u=h.data;let f;Array.isArray(u)?(f=new Lg,u.length===6&&(f.needsUpdate=!0)):(u&&u.data?f=new ja:f=new Ii,u&&(f.needsUpdate=!0)),f.source=h,f.uuid=l.uuid,l.name!==void 0&&(f.name=l.name),l.mapping!==void 0&&(f.mapping=n(l.mapping,Lq)),l.offset!==void 0&&f.offset.fromArray(l.offset),l.repeat!==void 0&&f.repeat.fromArray(l.repeat),l.center!==void 0&&f.center.fromArray(l.center),l.rotation!==void 0&&(f.rotation=l.rotation),l.wrap!==void 0&&(f.wrapS=n(l.wrap[0],wP),f.wrapT=n(l.wrap[1],wP)),l.format!==void 0&&(f.format=l.format),l.type!==void 0&&(f.type=l.type),l.encoding!==void 0&&(f.encoding=l.encoding),l.minFilter!==void 0&&(f.minFilter=n(l.minFilter,bP)),l.magFilter!==void 0&&(f.magFilter=n(l.magFilter,bP)),l.anisotropy!==void 0&&(f.anisotropy=l.anisotropy),l.flipY!==void 0&&(f.flipY=l.flipY),l.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(f.unpackAlignment=l.unpackAlignment),l.userData!==void 0&&(f.userData=l.userData),i[l.uuid]=f}return i}parseObject(e,t,n,i,r){let o;function l(m){return t[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",m),t[m]}function h(m){if(m!==void 0){if(Array.isArray(m)){const A=[];for(let v=0,b=m.length;v<b;v++){const C=m[v];n[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",C),A.push(n[C])}return A}return n[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),n[m]}}function u(m){return i[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",m),i[m]}let f,g;switch(e.type){case"Scene":o=new Bu,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ye(e.background):o.background=u(e.background)),e.environment!==void 0&&(o.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new gv(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new mv(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new ns(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new lh(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new zS(e.color,e.intensity);break;case"DirectionalLight":o=new Cv(e.color,e.intensity);break;case"PointLight":o=new bv(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new AD(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new wv(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new NS(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new zf().fromJSON(e);break;case"SkinnedMesh":f=l(e.geometry),g=h(e.material),o=new vS(f,g),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":f=l(e.geometry),g=h(e.material),o=new _t(f,g);break;case"InstancedMesh":f=l(e.geometry),g=h(e.material);const m=e.count,A=e.instanceMatrix,v=e.instanceColor;o=new xS(f,g,m),o.instanceMatrix=new Uf(new Float32Array(A.array),16),v!==void 0&&(o.instanceColor=new Uf(new Float32Array(v.array),v.itemSize));break;case"LOD":o=new _S;break;case"Line":o=new Ss(l(e.geometry),h(e.material));break;case"LineLoop":o=new wS(l(e.geometry),h(e.material));break;case"LineSegments":o=new Wo(l(e.geometry),h(e.material));break;case"PointCloud":case"Points":o=new yv(l(e.geometry),h(e.material));break;case"Sprite":o=new Y2(h(e.material));break;case"Group":o=new ua;break;case"Bone":o=new Av;break;default:o=new Ft}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const m=e.children;for(let A=0;A<m.length;A++)o.add(this.parseObject(m[A],t,n,i,r))}if(e.animations!==void 0){const m=e.animations;for(let A=0;A<m.length;A++){const v=m[A];o.animations.push(r[v])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const m=e.levels;for(let A=0;A<m.length;A++){const v=m[A],b=o.getObjectByProperty("uuid",v.object);b!==void 0&&o.addLevel(b,v.distance)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}}const Lq={UVMapping:lv,CubeReflectionMapping:$l,CubeRefractionMapping:eh,EquirectangularReflectionMapping:Qa,EquirectangularRefractionMapping:Of,CubeUVReflectionMapping:jf},wP={RepeatWrapping:Qc,ClampToEdgeWrapping:Os,MirroredRepeatWrapping:ku},bP={NearestFilter:$i,NearestMipmapNearestFilter:Ff,NearestMipmapLinearFilter:kf,LinearFilter:vi,LinearMipmapNearestFilter:Rg,LinearMipmapLinearFilter:va};class vD extends _r{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Gu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader,fetch(e,l).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(h){Gu.add(e,h),t&&t(h),r.manager.itemEnd(e)}).catch(function(h){i&&i(h),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}let gy;const GS={getContext:function(){return gy===void 0&&(gy=new(window.AudioContext||window.webkitAudioContext)),gy},setContext:function(a){gy=a}};class I_ extends _r{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new ks(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const h=l.slice(0);GS.getContext().decodeAudioData(h,function(f){t(f)})}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}}class Dq extends zf{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const i=new ye().set(e),r=new ye().set(t),o=new q(i.r,i.g,i.b),l=new q(r.r,r.g,r.b),h=Math.sqrt(Math.PI),u=h*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(l).multiplyScalar(h),this.sh.coefficients[1].copy(o).sub(l).multiplyScalar(u)}}class Oq extends zf{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=new ye().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const CP=new fn,EP=new fn,Kh=new fn;class Fq{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ns,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ns,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Kh.copy(e.projectionMatrix);const i=t.eyeSep/2,r=i*t.near/t.focus,o=t.near*Math.tan(Ru*t.fov*.5)/t.zoom;let l,h;EP.elements[12]=-i,CP.elements[12]=i,l=-o*t.aspect+r,h=o*t.aspect+r,Kh.elements[0]=2*t.near/(h-l),Kh.elements[8]=(h+l)/(h-l),this.cameraL.projectionMatrix.copy(Kh),l=-o*t.aspect-r,h=o*t.aspect-r,Kh.elements[0]=2*t.near/(h-l),Kh.elements[8]=(h+l)/(h-l),this.cameraR.projectionMatrix.copy(Kh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(EP),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(CP)}}class Sv{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=SP(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=SP();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function SP(){return(typeof performance>"u"?Date:performance).now()}const Zh=new q,MP=new kt,kq=new q,$h=new q;class HS extends Ft{constructor(){super(),this.type="AudioListener",this.context=GS.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Sv}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Zh,MP,kq),$h.set(0,0,-1).applyQuaternion(MP),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Zh.x,i),t.positionY.linearRampToValueAtTime(Zh.y,i),t.positionZ.linearRampToValueAtTime(Zh.z,i),t.forwardX.linearRampToValueAtTime($h.x,i),t.forwardY.linearRampToValueAtTime($h.y,i),t.forwardZ.linearRampToValueAtTime($h.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(Zh.x,Zh.y,Zh.z),t.setOrientation($h.x,$h.y,$h.z,n.x,n.y,n.z)}}class Mv extends Ft{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const eu=new q,TP=new kt,Nq=new q,tu=new q;class xD extends Mv{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(eu,TP,Nq),tu.set(0,0,1).applyQuaternion(TP);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(eu.x,n),t.positionY.linearRampToValueAtTime(eu.y,n),t.positionZ.linearRampToValueAtTime(eu.z,n),t.orientationX.linearRampToValueAtTime(tu.x,n),t.orientationY.linearRampToValueAtTime(tu.y,n),t.orientationZ.linearRampToValueAtTime(tu.z,n)}else t.setPosition(eu.x,eu.y,eu.z),t.setOrientation(tu.x,tu.y,tu.z)}}class wD{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class bD{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,o;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(o===0){for(let l=0;l!==i;++l)n[r+l]=n[l];o=t}else{o+=t;const l=t/o;this._mixBufferRegion(n,r,0,l,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const h=t*this._origIndex;this._mixBufferRegion(n,i,h,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let h=t,u=t+t;h!==u;++h)if(n[h]!==n[h+t]){l.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){kt.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;kt.multiplyQuaternionsFlat(e,o,e,t,e,n),kt.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let l=0;l!==r;++l){const h=t+l;e[h]=e[h]*o+e[n+l]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const l=t+o;e[l]=e[l]+e[n+o]*i}}}const VS="\\[\\]\\.:\\/",Uq=new RegExp("["+VS+"]","g"),WS="[^"+VS+"]",zq="[^"+VS.replace("\\.","")+"]",Gq=/((?:WC+[\/:])*)/.source.replace("WC",WS),Hq=/(WCOD+)?/.source.replace("WCOD",zq),Vq=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",WS),Wq=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",WS),Qq=new RegExp("^"+Gq+Hq+Vq+Wq+"$"),jq=["material","materials","bones","map"];class qq{constructor(e,t,n){const i=n||ti.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class ti{constructor(e,t,n){this.path=t,this.parsedPath=n||ti.parseTrackName(t),this.node=ti.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new ti.Composite(e,t,n):new ti(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Uq,"")}static parseTrackName(e){const t=Qq.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=n.nodeName.substring(i+1);jq.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let o=0;o<r.length;o++){const l=r[o];if(l.name===t||l.uuid===t)return l;const h=n(l.children);if(h)return h}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=ti.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===u){u=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const o=e[i];if(o===void 0){const u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}h=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(h=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(h=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ti.Composite=qq;ti.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ti.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ti.prototype.GetterByBindingType=[ti.prototype._getValue_direct,ti.prototype._getValue_array,ti.prototype._getValue_arrayElement,ti.prototype._getValue_toArray];ti.prototype.SetterByBindingTypeAndVersioning=[[ti.prototype._setValue_direct,ti.prototype._setValue_direct_setNeedsUpdate,ti.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ti.prototype._setValue_array,ti.prototype._setValue_array_setNeedsUpdate,ti.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ti.prototype._setValue_arrayElement,ti.prototype._setValue_arrayElement_setNeedsUpdate,ti.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ti.prototype._setValue_fromArray,ti.prototype._setValue_fromArray_setNeedsUpdate,ti.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Xq{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ho(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let l,h=e.length,u=this.nCachedObjects_;for(let f=0,g=arguments.length;f!==g;++f){const m=arguments[f],A=m.uuid;let v=t[A];if(v===void 0){v=h++,t[A]=v,e.push(m);for(let b=0,C=o;b!==C;++b)r[b].push(new ti(m,n[b],i[b]))}else if(v<u){l=e[v];const b=--u,C=e[b];t[C.uuid]=v,e[v]=C,t[A]=b,e[b]=m;for(let S=0,I=o;S!==I;++S){const M=r[S],R=M[b];let T=M[v];M[v]=R,T===void 0&&(T=new ti(m,n[S],i[S])),M[b]=T}}else e[v]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,l=arguments.length;o!==l;++o){const h=arguments[o],u=h.uuid,f=t[u];if(f!==void 0&&f>=r){const g=r++,m=e[g];t[m.uuid]=f,e[f]=m,t[u]=g,e[g]=h;for(let A=0,v=i;A!==v;++A){const b=n[A],C=b[g],S=b[f];b[f]=C,b[g]=S}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let l=0,h=arguments.length;l!==h;++l){const u=arguments[l],f=u.uuid,g=t[f];if(g!==void 0)if(delete t[f],g<r){const m=--r,A=e[m],v=--o,b=e[v];t[A.uuid]=g,e[g]=A,t[b.uuid]=m,e[m]=b,e.pop();for(let C=0,S=i;C!==S;++C){const I=n[C],M=I[m],R=I[v];I[g]=M,I[m]=R,I.pop()}}else{const m=--o,A=e[m];m>0&&(t[A.uuid]=g),e[g]=A,e.pop();for(let v=0,b=i;v!==b;++v){const C=n[v];C[g]=C[m],C.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(i!==void 0)return r[i];const o=this._paths,l=this._parsedPaths,h=this._objects,u=h.length,f=this.nCachedObjects_,g=new Array(u);i=r.length,n[e]=i,o.push(e),l.push(t),r.push(g);for(let m=f,A=h.length;m!==A;++m){const v=h[m];g[m]=new ti(v,e,t)}return g}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,r=this._parsedPaths,o=this._bindings,l=o.length-1,h=o[l],u=e[l];t[u]=n,o[n]=h,o.pop(),r[n]=r[l],r.pop(),i[n]=i[l],i.pop()}}}class Yq{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,l=new Array(o),h={endingStart:xu,endingEnd:xu};for(let u=0;u!==o;++u){const f=r[u].createInterpolant(null);l[u]=f,f.settings=h}this._interpolantSettings=h,this._interpolants=l,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=sS,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const i=this._clip.duration,r=e._clip.duration,o=r/i,l=i/r;e.warp(1,o,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=i._lendControlInterpolant(),this._timeScaleInterpolant=l);const h=l.parameterPositions,u=l.sampleValues;return h[0]=r,h[1]=r+n,u[0]=e/o,u[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const h=(e-r)*n;h<0||n===0?t=0:(this._startTime=null,t=n*h)}t*=this._updateTimeScale(e);const o=this._updateTime(t),l=this._updateWeight(e);if(l>0){const h=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case rS:for(let f=0,g=h.length;f!==g;++f)h[f].evaluate(o),u[f].accumulateAdditive(l);break;case uv:default:for(let f=0,g=h.length;f!==g;++f)h[f].evaluate(o),u[f].accumulate(i,l)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===A2;if(e===0)return r===-1?i:o&&(r&1)===1?t-i:i;if(n===hv){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=t||i<0){const l=Math.floor(i/t);i-=t*l,r+=Math.abs(l);const h=this.repetitions-r;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(h===1){const u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=i;if(o&&(r&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=wu,i.endingEnd=wu):(e?i.endingStart=this.zeroSlopeAtStart?wu:xu:i.endingStart=rg,t?i.endingEnd=this.zeroSlopeAtEnd?wu:xu:i.endingEnd=rg)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const l=o.parameterPositions,h=o.sampleValues;return l[0]=r,h[0]=t,l[1]=r+e,h[1]=n,this}}const Jq=new Float32Array(1);class Tv extends Lr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,l=e._interpolants,h=n.uuid,u=this._bindingsByRootAndName;let f=u[h];f===void 0&&(f={},u[h]=f);for(let g=0;g!==r;++g){const m=i[g],A=m.name;let v=f[A];if(v!==void 0)++v.referenceCount,o[g]=v;else{if(v=o[g],v!==void 0){v._cacheIndex===null&&(++v.referenceCount,this._addInactiveBinding(v,h,A));continue}const b=t&&t._propertyBindings[g].binding.parsedPath;v=new bD(ti.create(n,A,b),m.ValueTypeName,m.getValueSize()),++v.referenceCount,this._addInactiveBinding(v,h,A),o[g]=v}l[g].resultBuffer=v.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const l=o.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,l=o[r],h=l.knownActions,u=h[h.length-1],f=e._byClipCacheIndex;u._byClipCacheIndex=f,h[f]=u,h.pop(),e._byClipCacheIndex=null;const g=l.actionByRoot,m=(e._localRoot||this._root).uuid;delete g[m],h.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];o===void 0&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,l=o[i],h=t[t.length-1],u=e._cacheIndex;h._cacheIndex=u,t[u]=h,t.pop(),delete l[r],Object.keys(l).length===0&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new OS(new Float32Array(2),new Float32Array(2),1,Jq),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o=typeof e=="string"?rh.findByName(i,e):e;const l=o!==null?o.uuid:e,h=this._actionsByClip[l];let u=null;if(n===void 0&&(o!==null?n=o.blendMode:n=uv),h!==void 0){const g=h.actionByRoot[r];if(g!==void 0&&g.blendMode===n)return g;u=h.knownActions[0],o===null&&(o=u._clip)}if(o===null)return null;const f=new Yq(this,o,t,n);return this._bindAction(f,u),this._addInactiveAction(f,l,r),f}existingAction(e,t){const n=t||this._root,i=n.uuid,r=typeof e=="string"?rh.findByName(n,e):e,o=r?r.uuid:e,l=this._actionsByClip[o];return l!==void 0&&l.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(i,e,r,o);const l=this._bindings,h=this._nActiveBindings;for(let u=0;u!==h;++u)l[u].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){const o=r.knownActions;for(let l=0,h=o.length;l!==h;++l){const u=o[l];this._deactivateAction(u);const f=u._cacheIndex,g=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,g._cacheIndex=f,t[f]=g,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const l=n[o].actionByRoot,h=l[t];h!==void 0&&(this._deactivateAction(h),this._removeInactiveAction(h))}const i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(const o in r){const l=r[o];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Yg{constructor(e){this.value=e}clone(){return new Yg(this.value.clone===void 0?this.value:this.value.clone())}}let Kq=0;class Zq extends Lr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Kq++}),this.name="",this.usage=og,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++)this.uniforms.push(t[n].clone());return this}clone(){return new this.constructor().copy(this)}}class $q extends Og{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class eX{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class ju{constructor(e,t,n=0,i=1/0){this.ray=new Vu(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Ka,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return oE(e,this,n,t),n.sort(IP),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)oE(e[i],this,n,t);return n.sort(IP),n}}function IP(a,e){return a.distance-e.distance}function oE(a,e,t,n){if(a.layers.test(e.layers)&&a.raycast(e,t),n===!0){const i=a.children;for(let r=0,o=i.length;r<o;r++)oE(i[r],e,t,!0)}}class aE{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(As(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class tX{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const RP=new Xe;class nX{constructor(e=new Xe(1/0,1/0),t=new Xe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=RP.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return RP.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const PP=new q,Ay=new q;class iX{constructor(e=new q,t=new q){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){PP.subVectors(e,this.start),Ay.subVectors(this.end,this.start);const n=Ay.dot(Ay);let r=Ay.dot(PP)/n;return t&&(r=As(r,0,1)),r}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const BP=new q;class sX extends Ft{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new Sn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,l=1,h=32;o<h;o++,l++){const u=o/h*Math.PI*2,f=l/h*Math.PI*2;i.push(Math.cos(u),Math.sin(u),1,Math.cos(f),Math.sin(f),1)}n.setAttribute("position",new tn(i,3));const r=new Ts({fog:!1,toneMapped:!1});this.cone=new Wo(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),BP.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(BP),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const El=new q,yy=new fn,Ob=new fn;class rX extends Wo{constructor(e){const t=CD(e),n=new Sn,i=[],r=[],o=new ye(0,0,1),l=new ye(0,1,0);for(let u=0;u<t.length;u++){const f=t[u];f.parent&&f.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(l.r,l.g,l.b))}n.setAttribute("position",new tn(i,3)),n.setAttribute("color",new tn(r,3));const h=new Ts({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,h),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Ob.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const l=t[r];l.parent&&l.parent.isBone&&(yy.multiplyMatrices(Ob,l.matrixWorld),El.setFromMatrixPosition(yy),i.setXYZ(o,El.x,El.y,El.z),yy.multiplyMatrices(Ob,l.parent.matrixWorld),El.setFromMatrixPosition(yy),i.setXYZ(o+1,El.x,El.y,El.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function CD(a){const e=[];a.isBone===!0&&e.push(a);for(let t=0;t<a.children.length;t++)e.push.apply(e,CD(a.children[t]));return e}class oX extends _t{constructor(e,t,n){const i=new mo(t,4,2),r=new Hi({wireframe:!0,fog:!1,toneMapped:!1});super(i,r),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const aX=new q,LP=new ye,DP=new ye;class cX extends Ft{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Va(t);i.rotateY(Math.PI*.5),this.material=new Hi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(r.count*3);i.setAttribute("color",new Jn(o,3)),this.add(new _t(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");LP.copy(this.light.color),DP.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const r=n<i/2?LP:DP;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(aX.setFromMatrixPosition(this.light.matrixWorld).negate())}}class ED extends Wo{constructor(e=10,t=10,n=4473924,i=8947848){n=new ye(n),i=new ye(i);const r=t/2,o=e/t,l=e/2,h=[],u=[];for(let m=0,A=0,v=-l;m<=t;m++,v+=o){h.push(-l,0,v,l,0,v),h.push(v,0,-l,v,0,l);const b=m===r?n:i;b.toArray(u,A),A+=3,b.toArray(u,A),A+=3,b.toArray(u,A),A+=3,b.toArray(u,A),A+=3}const f=new Sn;f.setAttribute("position",new tn(h,3)),f.setAttribute("color",new tn(u,3));const g=new Ts({vertexColors:!0,toneMapped:!1});super(f,g),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class lX extends Wo{constructor(e=10,t=16,n=8,i=64,r=4473924,o=8947848){r=new ye(r),o=new ye(o);const l=[],h=[];if(t>1)for(let g=0;g<t;g++){const m=g/t*(Math.PI*2),A=Math.sin(m)*e,v=Math.cos(m)*e;l.push(0,0,0),l.push(A,0,v);const b=g&1?r:o;h.push(b.r,b.g,b.b),h.push(b.r,b.g,b.b)}for(let g=0;g<n;g++){const m=g&1?r:o,A=e-e/n*g;for(let v=0;v<i;v++){let b=v/i*(Math.PI*2),C=Math.sin(b)*A,S=Math.cos(b)*A;l.push(C,0,S),h.push(m.r,m.g,m.b),b=(v+1)/i*(Math.PI*2),C=Math.sin(b)*A,S=Math.cos(b)*A,l.push(C,0,S),h.push(m.r,m.g,m.b)}}const u=new Sn;u.setAttribute("position",new tn(l,3)),u.setAttribute("color",new tn(h,3));const f=new Ts({vertexColors:!0,toneMapped:!1});super(u,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const OP=new q,_y=new q,FP=new q;class SD extends Ft{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let i=new Sn;i.setAttribute("position",new tn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Ts({fog:!1,toneMapped:!1});this.lightPlane=new Ss(i,r),this.add(this.lightPlane),i=new Sn,i.setAttribute("position",new tn([0,0,0,0,0,1],3)),this.targetLine=new Ss(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){OP.setFromMatrixPosition(this.light.matrixWorld),_y.setFromMatrixPosition(this.light.target.matrixWorld),FP.subVectors(_y,OP),this.lightPlane.lookAt(_y),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_y),this.targetLine.scale.z=FP.length()}}const vy=new q,as=new dv;class MD extends Wo{constructor(e){const t=new Sn,n=new Ts({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(v,b){h(v),h(b)}function h(v){i.push(0,0,0),r.push(0,0,0),o[v]===void 0&&(o[v]=[]),o[v].push(i.length/3-1)}t.setAttribute("position",new tn(i,3)),t.setAttribute("color",new tn(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new ye(16755200),f=new ye(16711680),g=new ye(43775),m=new ye(16777215),A=new ye(3355443);this.setColors(u,f,g,m,A)}setColors(e,t,n,i,r){const l=this.geometry.getAttribute("color");l.setXYZ(0,e.r,e.g,e.b),l.setXYZ(1,e.r,e.g,e.b),l.setXYZ(2,e.r,e.g,e.b),l.setXYZ(3,e.r,e.g,e.b),l.setXYZ(4,e.r,e.g,e.b),l.setXYZ(5,e.r,e.g,e.b),l.setXYZ(6,e.r,e.g,e.b),l.setXYZ(7,e.r,e.g,e.b),l.setXYZ(8,e.r,e.g,e.b),l.setXYZ(9,e.r,e.g,e.b),l.setXYZ(10,e.r,e.g,e.b),l.setXYZ(11,e.r,e.g,e.b),l.setXYZ(12,e.r,e.g,e.b),l.setXYZ(13,e.r,e.g,e.b),l.setXYZ(14,e.r,e.g,e.b),l.setXYZ(15,e.r,e.g,e.b),l.setXYZ(16,e.r,e.g,e.b),l.setXYZ(17,e.r,e.g,e.b),l.setXYZ(18,e.r,e.g,e.b),l.setXYZ(19,e.r,e.g,e.b),l.setXYZ(20,e.r,e.g,e.b),l.setXYZ(21,e.r,e.g,e.b),l.setXYZ(22,e.r,e.g,e.b),l.setXYZ(23,e.r,e.g,e.b),l.setXYZ(24,t.r,t.g,t.b),l.setXYZ(25,t.r,t.g,t.b),l.setXYZ(26,t.r,t.g,t.b),l.setXYZ(27,t.r,t.g,t.b),l.setXYZ(28,t.r,t.g,t.b),l.setXYZ(29,t.r,t.g,t.b),l.setXYZ(30,t.r,t.g,t.b),l.setXYZ(31,t.r,t.g,t.b),l.setXYZ(32,n.r,n.g,n.b),l.setXYZ(33,n.r,n.g,n.b),l.setXYZ(34,n.r,n.g,n.b),l.setXYZ(35,n.r,n.g,n.b),l.setXYZ(36,n.r,n.g,n.b),l.setXYZ(37,n.r,n.g,n.b),l.setXYZ(38,i.r,i.g,i.b),l.setXYZ(39,i.r,i.g,i.b),l.setXYZ(40,r.r,r.g,r.b),l.setXYZ(41,r.r,r.g,r.b),l.setXYZ(42,r.r,r.g,r.b),l.setXYZ(43,r.r,r.g,r.b),l.setXYZ(44,r.r,r.g,r.b),l.setXYZ(45,r.r,r.g,r.b),l.setXYZ(46,r.r,r.g,r.b),l.setXYZ(47,r.r,r.g,r.b),l.setXYZ(48,r.r,r.g,r.b),l.setXYZ(49,r.r,r.g,r.b),l.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;as.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),gs("c",t,e,as,0,0,-1),gs("t",t,e,as,0,0,1),gs("n1",t,e,as,-n,-i,-1),gs("n2",t,e,as,n,-i,-1),gs("n3",t,e,as,-n,i,-1),gs("n4",t,e,as,n,i,-1),gs("f1",t,e,as,-n,-i,1),gs("f2",t,e,as,n,-i,1),gs("f3",t,e,as,-n,i,1),gs("f4",t,e,as,n,i,1),gs("u1",t,e,as,n*.7,i*1.1,-1),gs("u2",t,e,as,-n*.7,i*1.1,-1),gs("u3",t,e,as,0,i*2,-1),gs("cf1",t,e,as,-n,0,1),gs("cf2",t,e,as,n,0,1),gs("cf3",t,e,as,0,-i,1),gs("cf4",t,e,as,0,i,1),gs("cn1",t,e,as,-n,0,-1),gs("cn2",t,e,as,n,0,-1),gs("cn3",t,e,as,0,-i,-1),gs("cn4",t,e,as,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function gs(a,e,t,n,i,r,o){vy.set(i,r,o).unproject(n);const l=e[a];if(l!==void 0){const h=t.getAttribute("position");for(let u=0,f=l.length;u<f;u++)h.setXYZ(l[u],vy.x,vy.y,vy.z)}}const xy=new Rr;class QS extends Wo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),r=new Sn;r.setIndex(new Jn(n,1)),r.setAttribute("position",new Jn(i,3)),super(r,new Ts({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&xy.setFromObject(this.object),xy.isEmpty())return;const t=xy.min,n=xy.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hX extends Wo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new Sn;r.setIndex(new Jn(n,1)),r.setAttribute("position",new tn(i,3)),super(r,new Ts({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class uX extends Ss{constructor(e,t=1,n=16776960){const i=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Sn;o.setAttribute("position",new tn(r,3)),o.computeBoundingSphere(),super(o,new Ts({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],h=new Sn;h.setAttribute("position",new tn(l,3)),h.computeBoundingSphere(),this.add(new _t(h,new Hi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const kP=new q;let wy,Fb;class dX extends Ft{constructor(e=new q(0,0,1),t=new q(0,0,0),n=1,i=16776960,r=n*.2,o=r*.2){super(),this.type="ArrowHelper",wy===void 0&&(wy=new Sn,wy.setAttribute("position",new tn([0,0,0,0,1,0],3)),Fb=new ls(0,.5,1,5,1),Fb.translate(0,-.5,0)),this.position.copy(t),this.line=new Ss(wy,new Ts({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new _t(Fb,new Hi({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{kP.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(kP,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Iv extends Wo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Sn;i.setAttribute("position",new tn(t,3)),i.setAttribute("color",new tn(n,3));const r=new Ts({vertexColors:!0,toneMapped:!1});super(i,r),this.type="AxesHelper"}setColors(e,t,n){const i=new ye,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class fX{constructor(){this.type="ShapePath",this.color=new ye,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new lg,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(S){const I=[];for(let M=0,R=S.length;M<R;M++){const T=S[M],B=new Lu;B.curves=T.curves,I.push(B)}return I}function n(S,I){const M=I.length;let R=!1;for(let T=M-1,B=0;B<M;T=B++){let F=I[T],D=I[B],U=D.x-F.x,W=D.y-F.y;if(Math.abs(W)>Number.EPSILON){if(W<0&&(F=I[B],U=-U,D=I[T],W=-W),S.y<F.y||S.y>D.y)continue;if(S.y===F.y){if(S.x===F.x)return!0}else{const J=W*(S.x-F.x)-U*(S.y-F.y);if(J===0)return!0;if(J<0)continue;R=!R}}else{if(S.y!==F.y)continue;if(D.x<=S.x&&S.x<=F.x||F.x<=S.x&&S.x<=D.x)return!0}}return R}const i=qa.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,l,h;const u=[];if(r.length===1)return l=r[0],h=new Lu,h.curves=l.curves,u.push(h),u;let f=!i(r[0].getPoints());f=e?!f:f;const g=[],m=[];let A=[],v=0,b;m[v]=void 0,A[v]=[];for(let S=0,I=r.length;S<I;S++)l=r[S],b=l.getPoints(),o=i(b),o=e?!o:o,o?(!f&&m[v]&&v++,m[v]={s:new Lu,p:b},m[v].s.curves=l.curves,f&&v++,A[v]=[]):A[v].push({h:l,p:b[0]});if(!m[0])return t(r);if(m.length>1){let S=!1,I=0;for(let M=0,R=m.length;M<R;M++)g[M]=[];for(let M=0,R=m.length;M<R;M++){const T=A[M];for(let B=0;B<T.length;B++){const F=T[B];let D=!0;for(let U=0;U<m.length;U++)n(F.p,m[U].p)&&(M!==U&&I++,D?(D=!1,g[U].push(F)):S=!0);D&&g[M].push(F)}}I>0&&S===!1&&(A=g)}let C;for(let S=0,I=m.length;S<I;S++){h=m[S].s,u.push(h),C=A[S];for(let M=0,R=C.length;M<R;M++)h.holes.push(C[M].h)}return u}}const Oc=pX();function pX(){const a=new ArrayBuffer(4),e=new Float32Array(a),t=new Uint32Array(a),n=new Uint32Array(512),i=new Uint32Array(512);for(let h=0;h<256;++h){const u=h-127;u<-27?(n[h]=0,n[h|256]=32768,i[h]=24,i[h|256]=24):u<-14?(n[h]=1024>>-u-14,n[h|256]=1024>>-u-14|32768,i[h]=-u-1,i[h|256]=-u-1):u<=15?(n[h]=u+15<<10,n[h|256]=u+15<<10|32768,i[h]=13,i[h|256]=13):u<128?(n[h]=31744,n[h|256]=64512,i[h]=24,i[h|256]=24):(n[h]=31744,n[h|256]=64512,i[h]=13,i[h|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),l=new Uint32Array(64);for(let h=1;h<1024;++h){let u=h<<13,f=0;for(;(u&8388608)===0;)u<<=1,f-=8388608;u&=-8388609,f+=947912704,r[h]=u|f}for(let h=1024;h<2048;++h)r[h]=939524096+(h-1024<<13);for(let h=1;h<31;++h)o[h]=h<<23;o[31]=1199570944,o[32]=2147483648;for(let h=33;h<63;++h)o[h]=2147483648+(h-32<<23);o[63]=3347054592;for(let h=1;h<64;++h)h!==32&&(l[h]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:r,exponentTable:o,offsetTable:l}}function mX(a){Math.abs(a)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),a=As(a,-65504,65504),Oc.floatView[0]=a;const e=Oc.uint32View[0],t=e>>23&511;return Oc.baseTable[t]+((e&8388607)>>Oc.shiftTable[t])}function gX(a){const e=a>>10;return Oc.uint32View[0]=Oc.mantissaTable[Oc.offsetTable[e]+(a&1023)]+Oc.exponentTable[e],Oc.floatView[0]}var Cu=Object.freeze({__proto__:null,toHalfFloat:mX,fromHalfFloat:gX});function AX(){console.error("THREE.ImmediateRenderObject has been removed.")}class yX extends Xr{constructor(e,t,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,n),this.samples=4}}class _X extends Pg{constructor(e,t,n,i){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,n,i)}}class vX extends Bg{constructor(e,t,n,i){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,n,i)}}class xX extends zi{constructor(e,t,n,i,r,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,i,r,o)}}class wX extends Ng{constructor(e,t,n,i){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,i)}}class bX extends Ug{constructor(e,t,n,i){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,i)}}class CX extends zg{constructor(e,t,n,i,r,o,l){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,i,r,o,l)}}class EX extends ls{constructor(e,t,n,i,r,o,l,h){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,i,r,o,l,h)}}class SX extends Gg{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class MX extends Hg{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class TX extends Yf{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class IX extends Xf{constructor(e,t,n,i){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,i)}}class RX extends Va{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class TD extends Yr{constructor(e,t,n,i){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,i)}}class PX extends Jc{constructor(e,t,n,i){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,i)}}class BX extends Jf{constructor(e,t,n,i,r,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,i,r,o)}}class LX extends Vg{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class DX extends mo{constructor(e,t,n,i,r,o,l){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,i,r,o,l)}}class OX extends Wg{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class FX extends za{constructor(e,t,n,i,r){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,i,r)}}class kX extends Qg{constructor(e,t,n,i,r,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,i,r,o)}}class NX extends jg{constructor(e,t,n,i,r){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,i,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:cv}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=cv);const UX=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:tS,AddEquation:mu,AddOperation:n2,AdditiveAnimationBlendMode:rS,AdditiveBlending:y_,AlphaFormat:h2,AlwaysDepth:YL,AlwaysStencilFunc:aS,AmbientLight:zS,AmbientLightProbe:Oq,AnimationClip:rh,AnimationLoader:Sq,AnimationMixer:Tv,AnimationObjectGroup:Xq,AnimationUtils:wq,ArcCurve:K2,ArrayCamera:j2,ArrowHelper:dX,Audio:Mv,AudioAnalyser:wD,AudioContext:GS,AudioListener:HS,AudioLoader:I_,AxesHelper:Iv,BackSide:Wr,BasicDepthPacking:_2,BasicShadowMap:AV,Bone:Av,BooleanKeyframeTrack:Wu,Box2:nX,Box3:Rr,Box3Helper:hX,BoxBufferGeometry:xX,BoxGeometry:zi,BoxHelper:QS,BufferAttribute:Jn,BufferGeometry:Sn,BufferGeometryLoader:_D,ByteType:r2,Cache:Gu,Camera:dv,CameraHelper:MD,CanvasTexture:bS,CapsuleBufferGeometry:wX,CapsuleGeometry:Ng,CatmullRomCurve3:Z2,CineonToneMapping:i2,CircleBufferGeometry:bX,CircleGeometry:Ug,ClampToEdgeWrapping:Os,Clock:Sv,Color:ye,ColorKeyframeTrack:qg,ColorManagement:Ro,CompressedTexture:Nl,CompressedTextureLoader:Mq,ConeBufferGeometry:CX,ConeGeometry:zg,CubeCamera:U2,CubeReflectionMapping:$l,CubeRefractionMapping:eh,CubeTexture:Lg,CubeTextureLoader:Tq,CubeUVReflectionMapping:jf,CubicBezierCurve:ES,CubicBezierCurve3:$2,CubicInterpolant:fD,CullFaceBack:BC,CullFaceFront:OL,CullFaceFrontBack:gV,CullFaceNone:DL,Curve:xa,CurvePath:tD,CustomBlending:FL,CustomToneMapping:s2,CylinderBufferGeometry:EX,CylinderGeometry:ls,Cylindrical:tX,Data3DTexture:Bg,DataArrayTexture:Pg,DataTexture:ja,DataTexture2DArray:_X,DataTexture3D:vX,DataTextureLoader:kS,DataUtils:Cu,DecrementStencilOp:E2,DecrementWrapStencilOp:M2,DefaultLoadingManager:gD,DepthFormat:ql,DepthStencilFormat:Nu,DepthTexture:AS,DirectionalLight:Cv,DirectionalLightHelper:SD,DiscreteInterpolant:pD,DodecahedronBufferGeometry:SX,DodecahedronGeometry:Gg,DoubleSide:ir,DstAlphaFactor:VL,DstColorFactor:QL,DynamicCopyUsage:RV,DynamicDrawUsage:CV,DynamicReadUsage:MV,EdgesGeometry:RS,EllipseCurve:_v,EqualDepth:KL,EqualStencilFunc:P2,EquirectangularReflectionMapping:Qa,EquirectangularRefractionMapping:Of,Euler:_s,EventDispatcher:Lr,ExtrudeBufferGeometry:MX,ExtrudeGeometry:Hg,FileLoader:ks,Float16BufferAttribute:hW,Float32BufferAttribute:tn,Float64BufferAttribute:uW,FloatType:Ms,Fog:gv,FogExp2:mv,FramebufferTexture:jj,FrontSide:zo,Frustum:fv,GLBufferAttribute:eX,GLSL1:BV,GLSL3:ZC,GreaterDepth:$L,GreaterEqualDepth:ZL,GreaterEqualStencilFunc:O2,GreaterStencilFunc:L2,GridHelper:ED,Group:ua,HalfFloatType:Fs,HemisphereLight:NS,HemisphereLightHelper:cX,HemisphereLightProbe:Dq,IcosahedronBufferGeometry:TX,IcosahedronGeometry:Yf,ImageBitmapLoader:vD,ImageLoader:fg,ImageUtils:lS,ImmediateRenderObject:AX,IncrementStencilOp:C2,IncrementWrapStencilOp:S2,InstancedBufferAttribute:Uf,InstancedBufferGeometry:yD,InstancedInterleavedBuffer:$q,InstancedMesh:xS,Int16BufferAttribute:cW,Int32BufferAttribute:lW,Int8BufferAttribute:rW,IntType:a2,InterleavedBuffer:Og,InterleavedBufferAttribute:th,Interpolant:Zf,InterpolateDiscrete:Uu,InterpolateLinear:jc,InterpolateSmooth:Xy,InvertStencilOp:T2,KeepStencilOp:Gm,KeyframeTrack:wa,LOD:_S,LatheBufferGeometry:IX,LatheGeometry:Xf,Layers:Ka,LessDepth:JL,LessEqualDepth:__,LessEqualStencilFunc:B2,LessStencilFunc:R2,Light:hh,LightProbe:zf,Line:Ss,Line3:iX,LineBasicMaterial:Ts,LineCurve:vv,LineCurve3:eD,LineDashedMaterial:uD,LineLoop:wS,LineSegments:Wo,LinearEncoding:Ar,LinearFilter:vi,LinearInterpolant:OS,LinearMipMapLinearFilter:xV,LinearMipMapNearestFilter:vV,LinearMipmapLinearFilter:va,LinearMipmapNearestFilter:Rg,LinearSRGBColorSpace:Vl,LinearToneMapping:v_,Loader:_r,LoaderUtils:Xa,LoadingManager:FS,LoopOnce:hv,LoopPingPong:A2,LoopRepeat:sS,LuminanceAlphaFormat:f2,LuminanceFormat:d2,MOUSE:au,Material:vs,MaterialLoader:Ev,MathUtils:zu,Matrix3:Vr,Matrix4:fn,MaxEquation:FC,Mesh:_t,MeshBasicMaterial:Hi,MeshDepthMaterial:mS,MeshDistanceMaterial:gS,MeshLambertMaterial:lD,MeshMatcapMaterial:hD,MeshNormalMaterial:cD,MeshPhongMaterial:oD,MeshPhysicalMaterial:Kc,MeshStandardMaterial:Kf,MeshToonMaterial:aD,MinEquation:OC,MirroredRepeatWrapping:ku,MixOperation:t2,MultiplyBlending:DC,MultiplyOperation:Ig,NearestFilter:$i,NearestMipMapLinearFilter:_V,NearestMipMapNearestFilter:yV,NearestMipmapLinearFilter:kf,NearestMipmapNearestFilter:Ff,NeverDepth:XL,NeverStencilFunc:I2,NoBlending:Vc,NoColorSpace:bV,NoToneMapping:ma,NormalAnimationBlendMode:uv,NormalBlending:Tu,NotEqualDepth:e2,NotEqualStencilFunc:D2,NumberKeyframeTrack:ih,Object3D:Ft,ObjectLoader:Bq,ObjectSpaceNormalMap:x2,OctahedronBufferGeometry:RX,OctahedronGeometry:Va,OneFactor:zL,OneMinusDstAlphaFactor:WL,OneMinusDstColorFactor:jL,OneMinusSrcAlphaFactor:$E,OneMinusSrcColorFactor:HL,OrthographicCamera:lh,PCFShadowMap:JE,PCFSoftShadowMap:KE,PMREMGenerator:eE,Path:lg,PerspectiveCamera:ns,Plane:Oo,PlaneBufferGeometry:TD,PlaneGeometry:Yr,PlaneHelper:uX,PointLight:bv,PointLightHelper:oX,Points:yv,PointsMaterial:kg,PolarGridHelper:lX,PolyhedronBufferGeometry:PX,PolyhedronGeometry:Jc,PositionalAudio:xD,PropertyBinding:ti,PropertyMixer:bD,QuadraticBezierCurve:SS,QuadraticBezierCurve3:MS,Quaternion:kt,QuaternionKeyframeTrack:tc,QuaternionLinearInterpolant:mD,REVISION:cv,RGBADepthPacking:v2,RGBAFormat:ds,RGBAIntegerFormat:g2,RGBA_ASTC_10x10_Format:YC,RGBA_ASTC_10x5_Format:jC,RGBA_ASTC_10x6_Format:qC,RGBA_ASTC_10x8_Format:XC,RGBA_ASTC_12x10_Format:JC,RGBA_ASTC_12x12_Format:KC,RGBA_ASTC_4x4_Format:E_,RGBA_ASTC_5x4_Format:UC,RGBA_ASTC_5x5_Format:zC,RGBA_ASTC_6x5_Format:GC,RGBA_ASTC_6x6_Format:HC,RGBA_ASTC_8x5_Format:VC,RGBA_ASTC_8x6_Format:WC,RGBA_ASTC_8x8_Format:QC,RGBA_BPTC_Format:S_,RGBA_ETC2_EAC_Format:C_,RGBA_PVRTC_2BPPV1_Format:NC,RGBA_PVRTC_4BPPV1_Format:w_,RGBA_S3TC_DXT1_Format:jy,RGBA_S3TC_DXT3_Format:qy,RGBA_S3TC_DXT5_Format:zm,RGBFormat:u2,RGB_ETC1_Format:iS,RGB_ETC2_Format:b_,RGB_PVRTC_2BPPV1_Format:kC,RGB_PVRTC_4BPPV1_Format:x_,RGB_S3TC_DXT1_Format:Um,RGFormat:gf,RGIntegerFormat:m2,RawShaderMaterial:BS,Ray:Vu,Raycaster:ju,RectAreaLight:AD,RedFormat:vu,RedIntegerFormat:p2,ReinhardToneMapping:eS,RepeatWrapping:Qc,ReplaceStencilOp:b2,ReverseSubtractEquation:NL,RingBufferGeometry:BX,RingGeometry:Jf,SRGBColorSpace:Na,Scene:Bu,ShaderChunk:qn,ShaderLib:ca,ShaderMaterial:js,ShadowMaterial:PS,Shape:Lu,ShapeBufferGeometry:LX,ShapeGeometry:Vg,ShapePath:fX,ShapeUtils:qa,ShortType:o2,Skeleton:Fg,SkeletonHelper:rX,SkinnedMesh:vS,Source:Wl,Sphere:ec,SphereBufferGeometry:DX,SphereGeometry:mo,Spherical:aE,SphericalHarmonics3:vf,SplineCurve:TS,SpotLight:wv,SpotLightHelper:sX,Sprite:Y2,SpriteMaterial:yS,SrcAlphaFactor:ZE,SrcAlphaSaturateFactor:qL,SrcColorFactor:GL,StaticCopyUsage:IV,StaticDrawUsage:og,StaticReadUsage:SV,StereoCamera:Fq,StreamCopyUsage:PV,StreamDrawUsage:EV,StreamReadUsage:TV,StringKeyframeTrack:Qu,SubtractEquation:kL,SubtractiveBlending:LC,TOUCH:cu,TangentSpaceNormalMap:Yc,TetrahedronBufferGeometry:OX,TetrahedronGeometry:Wg,Texture:Ii,TextureLoader:Xg,TorusBufferGeometry:FX,TorusGeometry:za,TorusKnotBufferGeometry:kX,TorusKnotGeometry:Qg,Triangle:ko,TriangleFanDrawMode:oS,TriangleStripDrawMode:y2,TrianglesDrawMode:wV,TubeBufferGeometry:NX,TubeGeometry:jg,UVMapping:lv,Uint16BufferAttribute:hS,Uint32BufferAttribute:uS,Uint8BufferAttribute:oW,Uint8ClampedBufferAttribute:aW,Uniform:Yg,UniformsGroup:Zq,UniformsLib:Vt,UniformsUtils:dS,UnsignedByteType:Tr,UnsignedInt248Type:Iu,UnsignedIntType:Hl,UnsignedShort4444Type:c2,UnsignedShort5551Type:l2,UnsignedShortType:nS,VSMShadowMap:mf,Vector2:Xe,Vector3:q,Vector4:Bn,VectorKeyframeTrack:sh,VideoTexture:J2,WebGL1Renderer:q2,WebGL3DRenderTarget:YV,WebGLArrayRenderTarget:XV,WebGLCubeRenderTarget:fS,WebGLMultipleRenderTargets:JV,WebGLMultisampleRenderTarget:yX,WebGLRenderTarget:Xr,WebGLRenderer:Dg,WebGLUtils:Q2,WireframeGeometry:rD,WrapAroundEnding:rg,ZeroCurvatureEnding:xu,ZeroFactor:UL,ZeroSlopeEnding:wu,ZeroStencilOp:w2,_SRGBAFormat:M_,sRGBEncoding:Gn},Symbol.toStringTag,{value:"Module"})),Jg="__isActiveInHierarchy",cf="builtin_components";function Sf(a,e){try{e?a(e):a()}catch(t){return console.error(t),!1}return!0}const NP=()=>a=>a;let jS=!1;const cE=[];setTimeout(()=>{jS&&console.log(cE)},100);function ID(){return new URLSearchParams(window.location.search)}function Ct(a){jS&&!cE.includes(a)&&cE.push(a);const e=ID();if(e.has(a)){const t=e.get(a);return t||!0}return!1}jS=Ct("help")===!0;function R_(a,e,t){a.has(e)?a.set(e,t.toString()):a.append(e,t.toString())}function zX(a,e){window.history.replaceState(null,a,"?"+e.toString())}function GX(a,e){return Math.floor(Math.random()*(e-a+1))+a}const UP=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],zP=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function HX(){const a=UP[Math.floor(Math.random()*UP.length)],e=zP[Math.floor(Math.random()*zP.length)];return a+"_"+e}function VX(a){return a=a.replace(/[^a-z0-9 \.,_-]/gim,""),a.trim()}function Gf(a,e,t=!0,n=!1){var i;if(e==null)return null;if(e.userData&&e.userData.guid===a)return e;if(e.guid==a)return e;if(n&&(i=e.userData)!=null&&i.components){for(const r of e.userData.components)if(r.guid===a)return r}if(t){if(e.scenes)for(const r in e.scenes){const o=e.scenes[r],l=Gf(a,o,t,n);if(l)return l}if(e.children)for(const r in e.children){const o=e.children[r],l=Gf(a,o,t,n);if(l)return l}}}function qS(a,e){if(a!=null&&typeof a=="object"){let t;Array.isArray(a)?t=[]:(t=Object.create(a),Object.assign(t,a));for(const n of Object.keys(a)){const i=a[n];e&&!e(a,n,i)?t[n]=i:(i==null?void 0:i.clone)!==void 0&&typeof i.clone=="function"?t[n]=i.clone():t[n]=qS(i,e)}return t}return a}function WX(a){return new Promise((e,t)=>{setTimeout(e,a)})}const kb=Ct("debugsourcepath");function Kg(a,e){if(a===void 0)return kb&&console.warn("getPath: source is undefined, returning uri",e),e;if(e.startsWith("http"))return kb&&console.warn("getPath: uri is absolute, returning uri",e),e;const t=a.lastIndexOf("/");if(t>=0){let n=a.substring(0,t+1);const i=e.lastIndexOf("/");return i>=0?n+=e.substring(i+1):n+=e,kb&&console.log("getPath:",a,` - changed uri from
`,e,`
\u2192 `,n),n}return e}class QX{constructor(e,t){x(this,"writeCallbacks",[]);x(this,"_applied",!1);x(this,"_object");x(this,"_prop");x(this,"_wrapperProp");this._object=e,this._prop=t,this._wrapperProp="__$_NEEDLE_"+t,this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}apply(){if(this._applied||!this._object)return;const e=this._object,t=this._prop;if(e[t]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const n=e[t];e[this._wrapperProp]=n,Object.defineProperty(e,t,{get:()=>e[this._wrapperProp],set:o=>{e[this._wrapperProp]=o;for(const l of this.writeCallbacks)l(o)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,t=this._prop;Reflect.deleteProperty(e,t);const n=e[this._wrapperProp];e[t]=n,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class Rv{constructor(e,t){x(this,"_watches",[]);if(Array.isArray(t))for(const n of t)this._watches.push(new Rv(e,n));else this._watches.push(new QX(e,t))}subscribeWrite(e){for(const t of this._watches)t.subscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const jX=Ct("debugnewscripts"),cs=[];function pg(a){if(!(a.new_scripts.length<=0)){if(jX&&console.log("Register new components",a.new_scripts.length,a.alias?"element: "+a.alias:""),a.new_scripts_pre_setup_callbacks.length>0){for(const e of a.new_scripts_pre_setup_callbacks)!e||e();a.new_scripts_pre_setup_callbacks.length=0}cs.length=0,a.new_scripts.length>0&&cs.push(...a.new_scripts),a.new_scripts.length=0;for(let e=0;e<cs.length;e++)try{const t=cs[e];if(t.destroyed)continue;if(!t.gameObject){console.error("MISSING GAMEOBJECT - will ignore",t),cs.splice(e,1),e--;continue}t.context=a,Mf(t.gameObject),PD(t,a)}catch(t){console.error(t),Ul(cs[e],a),cs.splice(e,1),e--}for(let e=0;e<cs.length;e++)try{const t=cs[e];if(t.destroyed){Ul(cs[e],a),cs.splice(e,1),e--;continue}t.__internalAwake!==void 0&&(t.gameObject||console.error("MISSING GAMEOBJECT",t,t.gameObject),Mf(t.gameObject),t.activeAndEnabled&&Sf(t.__internalAwake.bind(t)))}catch(t){console.error(t),Ul(cs[e],a),cs.splice(e,1),e--}for(let e=0;e<cs.length;e++)try{const t=cs[e];if(t.destroyed||t.enabled===!1||(Mf(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,Sf(t.__internalEnable.bind(t)))}catch(t){console.error(t),Ul(cs[e],a),cs.splice(e,1),e--}for(let e=0;e<cs.length;e++)try{const t=cs[e];if(t.destroyed||!t.gameObject)continue;a.new_script_start.push(t)}catch(t){console.error(t),Ul(cs[e],a),cs.splice(e,1),e--}cs.length=0;for(const e of a.new_scripts_post_setup_callbacks)e&&e();a.new_scripts_post_setup_callbacks.length=0}}function qX(a){!a||(a.__internalDisable(),Ul(a,a.context))}function RD(a,e){for(let t=0;t<a.new_script_start.length;t++)try{const n=a.new_script_start[t];if(e!==void 0&&n.gameObject!==e||n.destroyed||n.activeAndEnabled===!1)continue;Sf(n.__internalAwake.bind(n)),Sf(n.__internalEnable.bind(n)),Sf(n.__internalStart.bind(n)),a.new_script_start.splice(t,1),t--}catch(n){console.error(n),Ul(a.new_script_start[t],a),a.new_script_start.splice(t,1),t--}}function PD(a,e){e.scripts.indexOf(a)===-1&&(e.scripts.push(a),a.earlyUpdate&&e.scripts_earlyUpdate.push(a),a.update&&e.scripts_update.push(a),a.lateUpdate&&e.scripts_lateUpdate.push(a),a.onBeforeRender&&e.scripts_onBeforeRender.push(a),a.onAfterRender&&e.scripts_onAfterRender.push(a))}function Ul(a,e){Sl(a,e.new_scripts),Sl(a,e.new_script_start),Sl(a,e.scripts),Sl(a,e.scripts_earlyUpdate),Sl(a,e.scripts_update),Sl(a,e.scripts_lateUpdate),Sl(a,e.scripts_onBeforeRender),Sl(a,e.scripts_onAfterRender),e.stopAllCoroutinesFrom(a)}function Sl(a,e){const t=e.indexOf(a);t>=0&&e.splice(t,1)}const XX={},GP={};function YX(){if(!ui.Current){console.trace("Invalid call - no current context.");return}BD(ui.Current.scene,ui.Current.scene.visible,!0)}function BD(a,e,t){const n=Ee.isActiveSelf(a);XX[a.uuid]=n,e&&(e=Ee.isActiveSelf(a)),a[Jg]=e;{const i=GP[a.uuid];i!==void 0&&i!==e&&t&&JX(a,r=>{e?(Sf(r.__internalAwake.bind(r)),r.onEnable()):r.onDisable()})}if(GP[a.uuid]=e,a.children)for(const i of a.children)BD(i,e,t)}function Mf(a){let e=!0,t=a,n=!1;for(;t&&t;){if(t.type==="Scene"&&(n=!0),!Ee.isActiveSelf(t)){e=!1;break}t=t.parent}if(!a){console.error("GO is null");return}a[Jg]=e&&n}function JX(a,e){var t;if((t=a.userData)!=null&&t.components)for(const n of a.userData.components)e(n)}const Nb=Ct("debuggetcomponent");function KX(a){return a==null||a.isObject3D?a:a.object&&a.object.isObject3D?a.object:a}function LD(a,e){var n;if(!a)return;const t=(n=e==null?void 0:e.new_scripts)!=null?n:ui.Current.new_scripts;t.includes(a)||t.push(a)}const ZX=function(a,e){if(!a||!a.userData.components)return;const t=a.userData.components.indexOf(e);t<0||(e.gameObject=null,a.userData.components.splice(t,1))},DD=function(a,e,t=!0){e.userData||(e.userData={}),e.userData.components||(e.userData.components=[]),e.userData.components.push(a),a.gameObject=e,LD(a);try{a.__internalAwake&&t&&(Mf(e),a.__internalAwake())}catch(n){console.error(n)}},$X=function(a,e){if(a.gameObject!==e){if(a.gameObject&&a.gameObject.userData.components){const t=a.gameObject.userData.components.indexOf(a);a.gameObject.userData.components.splice(t,1)}if(!e.userData.components)e.userData.components=[];else if(e.userData.components.includes(a))return;e.userData.components.push(a),a.gameObject=e}},e9=function(a){var e;if(a.gameObject&&a.gameObject.userData.components){const t=a.gameObject.userData.components.indexOf(a);a.gameObject.userData.components.splice(t,1)}a.__internalDisable&&a.__internalDisable(),a.onDestroy&&a.onDestroy(),Ul(a,(e=a.context)!=null?e:ui.Current),a.__destroyed=!0,a.gameObject=null},OD=function(a,e,t){var n;if(!((n=e==null?void 0:e.userData)!=null&&n.components))return null;Nb&&console.log("FIND",a);for(let i=0;i<e.userData.components.length;i++){const r=e.userData.components[i];if(a===null||r.constructor.name===a.name||r.constructor.name===a)if(Nb&&console.log("MATCH BY NAME",r),t)t.push(r);else return r}for(let i=0;i<e.userData.components.length;i++){const r=e.userData.components[i];let o=Object.getPrototypeOf(r.constructor);do{if(o===a)if(Nb&&console.log("MATCH BY PROTOYPE",o),t)t.push(r);else return r;o=Object.getPrototypeOf(o)}while(o)}return t},XS=function(a,e){return OD(a,e,null)},YS=function(a,e,t){return t||(t=[]),OD(a,e,t)},JS=function(a,e,t){var i;const n=XS(a,e);if(t===!1&&n.enabled===!1)return null;if(n)return n;for(let r=0;r<((i=e==null?void 0:e.children)==null?void 0:i.length);r++){const o=JS(a,e.children[r]);if(o)return o}return null},KS=function(a,e,t){var n;t||(t=[]),YS(a,e,t);for(let i=0;i<((n=e==null?void 0:e.children)==null?void 0:n.length);i++)KS(a,e.children[i],t);return t},lE=function(a,e){if(!e)return null;if(Array.isArray(e)){for(let n=0;n<e.length;n++){const i=KX(e[n]),r=lE(a,i);if(r)return r}return null}const t=XS(a,e);return t||lE(a,e.parent)},FD=function(a,e,t){return t||(t=[]),e?(YS(a,e,t),FD(a,e.parent,t)):t},t9=function(a,e,t){if(!a)return null;if(!e&&(e=ui.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;const n=e.isScene===!0||e.isObject3D===!0?e:e==null?void 0:e.scene;for(const i in n.children){const r=n.children[i];if(t===!1&&r[Jg]===!1)continue;if(r.constructor==a)return r;const o=JS(a,r);if(o)return o}return null},n9=function(a,e,t){if(!a)return e;if(!t&&(t=ui.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),e;const n=t.isScene===!0||t.isObject3D===!0?t:t==null?void 0:t.scene;if(!n)return e;for(const i in n.children){const r=n.children[i];if(r.constructor==a)return r;KS(a,r,e)}return e};class i9{random(){return Math.random()}clamp(e,t,n){return e<t?t:e>n?n:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,t,n){return n=n<0?0:n,n=n>1?1:n,e+(t-e)*n}moveTowards(e,t,n){return e+=n,(n<0&&e<t||n>0&&e>t)&&(e=t),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}}const Ci=new i9;class s9{constructor(e,t){x(this,"_factory");x(this,"_cache",[]);x(this,"_maxSize");x(this,"_index",0);this._factory=e,this._maxSize=t}get(){let e=this._index++;return e>=this._cache.length&&(e>=this._maxSize?e=this._index=0:this._cache.push(this._factory())),this._cache[e]}}new kt().setFromAxisAngle(new q(0,1,0),Math.PI);const ZS=new s9(()=>new q,100);q.prototype.slerp=function(a,e){const t=this.length(),n=a.length(),i=Ci.lerp(t,n,e);return this.lerp(a,e).normalize().multiplyScalar(i)};function ni(a,e=null,t=!0){const n=e!=null?e:ZS.get();return a?a.parent?(t&&a.updateWorldMatrix(!0,!1),a.matrixWorldNeedsUpdate&&a.updateMatrixWorld(),n.setFromMatrixPosition(a.matrixWorld),n):n.copy(a.position):n.set(0,0,0)}function sr(a,e){var i;if(!a)return;const t=ZS.get();e!==t&&t.copy(e),((i=a==null?void 0:a.parent)!=null?i:a).worldToLocal(t),a.position.set(t.x,t.y,t.z)}function $S(a,e,t,n){const i=ZS.get();i.set(e,t,n),sr(a,i)}const Du=new kt,mg=new kt,Ub=new kt;function ga(a,e=null){if(!a)return mg.set(0,0,0,1);const t=e!=null?e:mg;return a.parent?(a.getWorldQuaternion(t),t):t.copy(a.quaternion)}function Za(a,e){if(!a)return;e!==Du&&Du.copy(e);const t=Du,n=a==null?void 0:a.parent;n==null||n.getWorldQuaternion(Ub),Ub.invert();const i=Ub.multiply(t);a.quaternion.set(i.x,i.y,i.z,i.w)}function r9(a,e,t,n,i){Du.set(e,t,n,i),Za(a,Du)}const by=new q;new q;function kD(a,e=null){return a?a.parent?(a.getWorldScale(e!=null?e:by),e!=null?e:by):by.copy(a.position):by.set(0,0,0)}new q;new kt;const HP=new _s,VP=new _s,o9=new q;function a9(a){return a.getWorldQuaternion(mg),VP.setFromQuaternion(mg),VP}function c9(a,e){Za(a,mg.setFromEuler(e))}function ND(a){const e=a9(a),t=o9;return t.set(e.x,e.y,e.z),t.x=Ci.toDegrees(t.x),t.y=Ci.toDegrees(t.y),t.z=Ci.toDegrees(t.z),t}function UD(a,e,t,n,i=!0){i&&(e=Ci.toRadians(e),t=Ci.toRadians(t),n=Ci.toRadians(n)),HP.set(e,t,n),Du.setFromEuler(HP),Za(a,Du)}function hE(a,e=!0){!a||(e?function t(n){console.groupCollapsed((n.name?n.name:"(no name : "+n.type+")")+" %o",n),n.children.forEach(t),console.groupEnd()}(a):a.traverse(function(t){for(var n="|___",i=t;i.parent!==null;)n="	"+n,i=i.parent;console.log(n+t.name+" <"+t.type+">")}))}const l9=new Yr(2,2,1,1),Cy=new Dg({antialias:!1}),h9=new ns,zb=new Bu,WP=new js({uniforms:{blitTexture:new Yg(null)},vertexShader:`
        varying vec2 vUv;
        void main(){
            vUv = uv;
            gl_Position = vec4(position.xy * 1.0,0.,.999999);
        }`,fragmentShader:`
        uniform sampler2D blitTexture; 
        varying vec2 vUv;
        void main(){ 
            vec2 uv = vUv;
            uv.y = 1.0 - uv.y;
            gl_FragColor = vec4(uv.xy, 0, 1);
            gl_FragColor = texture2D( blitTexture, uv);
        }`});function u9(a){WP.uniforms.blitTexture.value=a;const e=new _t(l9,WP);return e.frustumCulled=!1,zb.children.length=0,zb.add(e),Cy.setSize(a.image.width,a.image.height),Cy.clear(),Cy.render(zb,h9),new Ii(Cy.domElement)}function d9(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&a instanceof ImageBitmap}function f9(a,e=!1){if(!a)return null;(e===!0||a.isCompressedTexture===!0)&&(a=u9(a));const t=a.image;if(d9(t)){const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");return i?(i.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),n):(console.error("Failed getting canvas 2d context"),null)}return null}const p9=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function m9(a){return typeof a=="string"&&p9.test(a)}const Zs=[];for(let a=0;a<256;++a)Zs.push((a+256).toString(16).slice(1));function g9(a,e=0){return(Zs[a[e+0]]+Zs[a[e+1]]+Zs[a[e+2]]+Zs[a[e+3]]+"-"+Zs[a[e+4]]+Zs[a[e+5]]+"-"+Zs[a[e+6]]+Zs[a[e+7]]+"-"+Zs[a[e+8]]+Zs[a[e+9]]+"-"+Zs[a[e+10]]+Zs[a[e+11]]+Zs[a[e+12]]+Zs[a[e+13]]+Zs[a[e+14]]+Zs[a[e+15]]).toLowerCase()}function A9(a){if(!m9(a))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(a.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(a.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(a.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(a.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(a.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function y9(a){a=unescape(encodeURIComponent(a));const e=[];for(let t=0;t<a.length;++t)e.push(a.charCodeAt(t));return e}const _9="6ba7b810-9dad-11d1-80b4-00c04fd430c8",v9="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function x9(a,e,t){function n(i,r,o,l){var h;if(typeof i=="string"&&(i=y9(i)),typeof r=="string"&&(r=A9(r)),((h=r)===null||h===void 0?void 0:h.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+i.length);if(u.set(r),u.set(i,r.length),u=t(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,o){l=l||0;for(let f=0;f<16;++f)o[l+f]=u[f];return o}return g9(u)}try{n.name=a}catch{}return n.DNS=_9,n.URL=v9,n}function w9(a,e,t,n){switch(a){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function Gb(a,e){return a<<e|a>>>32-e}function b9(a){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof a=="string"){const o=unescape(encodeURIComponent(a));a=[];for(let l=0;l<o.length;++l)a.push(o.charCodeAt(l))}else Array.isArray(a)||(a=Array.prototype.slice.call(a));a.push(128);const n=a.length/4+2,i=Math.ceil(n/16),r=new Array(i);for(let o=0;o<i;++o){const l=new Uint32Array(16);for(let h=0;h<16;++h)l[h]=a[o*64+h*4]<<24|a[o*64+h*4+1]<<16|a[o*64+h*4+2]<<8|a[o*64+h*4+3];r[o]=l}r[i-1][14]=(a.length-1)*8/Math.pow(2,32),r[i-1][14]=Math.floor(r[i-1][14]),r[i-1][15]=(a.length-1)*8&4294967295;for(let o=0;o<i;++o){const l=new Uint32Array(80);for(let A=0;A<16;++A)l[A]=r[o][A];for(let A=16;A<80;++A)l[A]=Gb(l[A-3]^l[A-8]^l[A-14]^l[A-16],1);let h=t[0],u=t[1],f=t[2],g=t[3],m=t[4];for(let A=0;A<80;++A){const v=Math.floor(A/20),b=Gb(h,5)+w9(v,u,f,g)+m+e[v]+l[A]>>>0;m=g,g=f,f=Gb(u,30)>>>0,u=h,h=b}t[0]=t[0]+h>>>0,t[1]=t[1]+u>>>0,t[2]=t[2]+f>>>0,t[3]=t[3]+g>>>0,t[4]=t[4]+m>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const C9=x9("v5",80,b9),E9=C9,P_=Ct("debugcomponents"),S9="eff8ba80-635d-11ec-90d6-0242ac120003";class Aa{constructor(e){x(this,"_originalSeed");x(this,"_seed");this._originalSeed=e,this._seed=e}get seed(){return this._seed}generateUUID(){const e=this._seed;return this._seed-=1,E9(e.toString(),S9)}static createFromString(e){return new Aa(this.hash(e))}static hash(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}}class zD{constructor(e){x(this,"guid");this.guid=e}}function eM(a,e,t=!0){if(!a)return;const n=a;if(Ee.destroy(a,t),!e){console.warn("Can not send destroy: No networking connection provided",a.guid);return}if(!e.isConnected){console.warn("Can not send destroy: not connected",a.guid);return}let i=a.guid;if(!i&&n.uuid&&(i=n.uuid),!i){console.warn("Can not send destroy: failed to find guid",a);return}const r=new zD(i);e.send("instance-destroyed",r)}function M9(a,e){const t=new zD(a);e.send("instance-destroyed",t)}function T9(a){a.connection.beginListen("instance-destroyed",e=>{P_&&console.log("[Remote] Destroyed",a.scene,e);const t=Ee.findByGuid(e.guid,a.scene);t&&Ee.destroy(t)})}class I9{constructor(e,t){x(this,"guid");x(this,"originalGuid");x(this,"seed");x(this,"visible");x(this,"hostData");x(this,"dontSave");x(this,"parent");x(this,"position");x(this,"rotation");x(this,"scale");this.originalGuid=e,this.guid=t}}function GD(a,e,t,n){var h;const i=a;if(!i.guid)return console.warn("Can not instantiate: No guid",i),null;if(e.context||(e.context=ui.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=e?{...e}:null,{instance:o,seed:l}=P9(i,e);if(o){const u=o;if(u.guid){P_&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const f=new I9(i.guid,u.guid);f.seed=l,r&&(r.position&&(f.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(f.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(f.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),f.position||(f.position={x:u.position.x,y:u.position.y,z:u.position.z}),f.rotation||(f.rotation={x:u.quaternion.x,y:u.quaternion.y,z:u.quaternion.z,w:u.quaternion.w}),f.scale||(f.scale={x:u.scale.x,y:u.scale.y,z:u.scale.z}),f.visible=i.visible,r!=null&&r.parent&&(typeof r.parent=="string"?f.parent=r.parent:f.parent=r.parent.guid),f.hostData=t,n===!1&&(f.dontSave=!0),(h=e==null?void 0:e.context)==null||h.connection.send("new-instance-created",f)}else console.warn("Missing guid, can not send new instance event",u)}return o}function tM(){return Math.random()*9999999}function R9(a){a.connection.beginListen("new-instance-created",async e=>{const t=await L9(e.originalGuid,a.scene);if(!t){console.warn("could not find object that was instantiated: "+e.guid);return}const n=new Go;e.position&&(n.position=new q(e.position.x,e.position.y,e.position.z)),e.rotation&&(n.rotation=new kt(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(n.scale=new q(e.scale.x,e.scale.y,e.scale.z)),n.parent=e.parent,e.seed&&(n.idProvider=new Aa(e.seed)),n.visible=e.visible,n.context=a,P_&&a.alias&&console.log("[Remote] instantiate in: "+a.alias);const i=Ee.instantiate(t,n);i&&(e.parent==="scene"&&a.scene.add(i),P_&&console.log("[Remote] new instance","gameobject:",i==null?void 0:i.guid,t))})}function P9(a,e){const t=tM(),n=e!=null?e:new Go;n.idProvider=new Aa(t);const i=Ee.instantiate(a,n);return{seed:t,instance:i}}const HD={};function B9(a,e){HD[a]=e}async function L9(a,e){const t=HD[a];if(t!=null){const n=await t(a);if(n)return n}return VD(a,e)}function VD(a,e){if(e===null||!a)return null;if(e.guid===a)return e;if(e.children)for(const t of e.children){const n=VD(a,t);if(n)return n}return null}const QP=Symbol("GameObject.decorated");Object.defineProperty(Ft.prototype,"activeSelf",{get:function(){return this.visible},set:function(a){const e=typeof a=="number"?a>.5:a;this.visible=e}});Ft.prototype.SetActive=function(a){this.visible=a};Ft.prototype.addNewComponent=function(a){return Ee.addNewComponent(this,a)};Ft.prototype.removeComponent=function(a){return Ee.removeComponent(a)};Ft.prototype.getOrAddComponent=function(a){return Ee.getOrAddComponent(this,a)};Ft.prototype.getComponent=function(a){return Ee.getComponent(this,a)};Ft.prototype.getComponents=function(a,e){return Ee.getComponents(this,a,e)};Ft.prototype.getComponentInChildren=function(a){return Ee.getComponentInChildren(this,a)};Ft.prototype.getComponentsInChildren=function(a,e){return Ee.getComponentsInChildren(this,a,e)};Ft.prototype.getComponentInParent=function(a){return Ee.getComponentInParent(this,a)};Ft.prototype.getComponentsInParent=function(a,e){return Ee.getComponentsInParent(this,a,e)};const B_=Object.keys(Ft.prototype),WD=new Array;for(let a=0;a<B_.length;a++){const e=B_[a],t=Object.getOwnPropertyDescriptor(Ft.prototype,e);t&&WD.push(t)}function QD(a){if(!a[QP]){a[QP]=!0;for(let e=0;e<B_.length;e++){const t=B_[e],n=WD[e];n&&Object.defineProperty(a,t,n)}}}const uE=Symbol("NEEDLE_NEED_UPDATE_INSTANCE");class Pr{static isUsingInstancing(e){return e.__isUsingInstancing===!0}static markDirty(e,t=!0){if(!!e&&(this.isUsingInstancing(e)&&(e[uE]=!0,e.matrixWorldNeedsUpdate=!0),t))for(const n of e.children)Pr.markDirty(n,!0)}}const Ml=Ct("debugcomponents");var jD=(a=>(a[a.None=0]="None",a[a.HideInHierarchy=1]="HideInHierarchy",a[a.HideInInspector=2]="HideInInspector",a[a.DontSaveInEditor=4]="DontSaveInEditor",a[a.NotEditable=8]="NotEditable",a[a.DontSaveInBuild=16]="DontSaveInBuild",a[a.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",a[a.DontSave=52]="DontSave",a[a.HideAndDontSave=61]="HideAndDontSave",a))(jD||{});class Go{constructor(){x(this,"idProvider");x(this,"parent");x(this,"keepWorldPosition");x(this,"position");x(this,"rotation");x(this,"scale");x(this,"visible");x(this,"context")}}class Ee extends Ft{constructor(){super(...arguments);x(this,"guid")}static setActive(t,n,i=!0){!t||(t.visible=n,Mf(t),n&&i&&RD(ui.Current,t))}static isActiveSelf(t){return t.visible||Ee.isUsingInstancing(t)}static isActiveInHierarchy(t){return t[Jg]||Ee.isUsingInstancing(t)}static markAsInstancedRendered(t,n){t.__isUsingInstancing=n}static isUsingInstancing(t){return Pr.isUsingInstancing(t)}static foreachComponent(t,n,i=!0){if(!!t){if(t.userData.components)for(let r=0;r<t.userData.components.length;r++){const o=t.userData.components[r];if(o instanceof pt){const l=n(o);if(l!==void 0)return l}}if(i&&t.children)for(let r=0;r<t.children.length;r++){const o=t.children[r];if(!o)continue;const l=Ee.foreachComponent(o,n,i);if(l!==void 0)return l}}}static instantiateSynced(t,n){return t?GD(t,n):null}static instantiate(t,n=null){if(t===null)return null;let i=null;n!==null&&(n.x!==void 0?(i=new Go,i.position=n):i=n);let r=ui.Current;i!=null&&i.context&&(r=i.context),Ml&&r.alias&&console.log("context",r.alias),i&&!i.idProvider&&(i.idProvider=new Aa(Date.now()));const o=[],l={},h={},u=this.internalInstantiate(r,t,i,o,l,h);u&&(this.resolveReferences(l),this.resolveAndBindSkinnedMeshBones(h,l)),Ml&&(hE(t,!0),hE(u,!0));const f={};for(const g in o){const m=o[g],A=m.guid;i&&i.idProvider&&(m.guid=i.idProvider.generateUUID(),f[A]=m.guid,Ml&&console.log(m.name,m.guid)),LD(m,r),m.__internalNewInstanceCreated&&m.__internalNewInstanceCreated()}for(const g in o){const m=o[g];m.resolveGuids&&m.resolveGuids(f),m.enabled!==!1&&(m.enabled=!0)}return pg(r),u}static internalInstantiate(t,n,i,r,o,l){var m;if(!n)return null;const h=n.userData;n.userData={};const u=n.children;n.children=[];let f;if(f=n.clone(!1),QD(f),n.userData=h,n.children=u,o[n.uuid]={original:n,clone:f},n.type==="SkinnedMesh"&&(l[n.uuid]={original:n,clone:f}),(i==null?void 0:i.visible)!==void 0&&(f.visible=i.visible),i!=null&&i.idProvider){f.uuid=i.idProvider.generateUUID();const A=f;A&&(A.guid=f.uuid)}n.animations&&n.animations.length>0&&(f.animations=[...n.animations]);const g=n.parent;if(g&&g.add(f),i!=null&&i.position?sr(f,i.position):f.position.copy(n.position),i!=null&&i.rotation?Za(f,i.rotation):f.quaternion.copy(n.quaternion),i!=null&&i.scale?f.scale.copy(i.scale):f.scale.copy(n.scale),(i==null?void 0:i.parent)&&i.parent!=="scene"){let A=null;if(typeof i.parent=="string"?A=Gf(i.parent,t.scene,!0):A=i.parent,A){const v=i.keepWorldPosition===!0?A.attach:A.add;v?v.call(A,f):console.error("Invalid parent object",A,"received when instantiating:",n)}else console.warn("could not find parent:",i.parent)}for(const[A,v]of Object.entries(n.userData))A!=="components"&&(f.userData[A]=v);if((m=n.userData)!=null&&m.components){const A=n.userData.components,v=[];f.userData.components=v;for(let b=0;b<A.length;b++){const C=A[b],S=Object.create(C);Object.assign(S,C),v.push(S),S.gameObject=f,r.push(S)}}i&&(i.position=void 0,i.rotation=void 0,i.scale=void 0,i.parent=void 0);for(const A in n.children){const v=n.children[A],b=Ee.internalInstantiate(t,v,i,r,o,l);b&&f.add(b)}return f}static resolveAndBindSkinnedMeshBones(t,n){for(const i in t){const r=t[i],o=r.original,l=o.skeleton,h=r.clone;if(!l){console.warn("Skinned mesh has no skeleton?",r);continue}const u=l.bones,f=h.skeleton.clone();h.skeleton=f,h.bindMatrix.clone().copy(o.bindMatrix),h.bindMatrixInverse.copy(o.bindMatrixInverse);const g=[];f.bones=g;for(let m=0;m<u.length;m++){const A=u[m],b=n[A.uuid].clone;g.push(b)}}for(const i in t){const r=t[i].clone;r.skeleton.update(),r.bind(r.skeleton,r.bindMatrix),r.updateMatrixWorld(!0)}}static resolveReferences(t){var n;for(const i in t){const o=t[i].clone;if((n=o.userData)!=null&&n.components)for(let l=0;l<o.userData.components.length;l++){const h=o.userData.components[l],u=Object.entries(h);for(const[f,g]of u)if(Array.isArray(g)){const m=[];h[f]=m;for(let A=0;A<g.length;A++){const v=g[A];if(typeof v!="object"){m.push(v);continue}const b=this.postProcessNewInstance(h,f,v,t);b!==void 0?m.push(b):m.push(v)}}else if(typeof g=="object"){const m=this.postProcessNewInstance(h,f,g,t);m!==void 0&&(h[f]=m)}}}}static postProcessNewInstance(t,n,i,r){var o,l;if(i instanceof Do||i instanceof pt){const h=i.gameObject;if(h){const u=h.uuid,f=(o=r[u])==null?void 0:o.clone;if(!f){Ml&&console.log("reference did not change",n,t,i);return}const g=h.userData.components.indexOf(i);if(g>=0)return Ml&&console.log(n,u),f.userData.components[g];console.warn("could not find component",n,i)}}else if(i instanceof Ft){if(n==="gameObject")return;const h=i;if(h){const u=h.uuid,f=(l=r[u])==null?void 0:l.clone;if(f)return Ml&&console.log(n,"old",i,"new",f),f}}}static destroySynced(t,n,i=!0){if(!t)return;const r=t;n=n!=null?n:ui.Current,eM(r,n.connection,i)}static destroy(t,n=!0,i=!0){const r=t;if(r.isComponent){r.destroy();return}const o=t;if(Ml&&console.log(o),n&&o.children)for(const h of o.children)Ee.destroy(h,n,!1);const l=o.userData.components;if(l){let h=l.length;for(let u=0;u<l.length;u++){const f=l[u];f.destroy&&(Ml&&console.log("destroying",f),f.destroy()),l.length<h&&(h=l.length,u--)}}i&&o.removeFromParent()}static add(t,n,i){if(!(!t||!n)){if(t===n){console.warn("Can not add object to self",t);return}i||(i=ui.Current),n.add(t),Mf(t),i?Ee.foreachComponent(t,r=>{PD(r,i),i.new_script_start.includes(r)===!1&&i.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(t){var n;!t||((n=t.parent)==null||n.remove(t),Ee.foreachComponent(t,i=>{qX(i)},!0))}static invokeOnChildren(t,n,...i){this.invoke(t,n,!0,i)}static invoke(t,n,i=!1,...r){!t||this.foreachComponent(t,o=>{const l=o[n];l&&typeof l=="function"&&l.bind(o)(...r)},i)}static addNewComponent(t,n,i=!0){const r=new n;return DD(r,t,i),r}static addComponent(t,n){if(n.gameObject==null)throw new Error("Did you mean to create a new component? Use addNewComponent");$X(n,t)}static removeComponent(t){return ZX(t.gameObject,t),t}static getOrAddComponent(t,n){const i=this.getComponent(t,n);return i||this.addNewComponent(t,n)}static getComponent(t,n){return t===null?null:XS(n,t)}static getComponents(t,n,i=null){return t===null?i!=null?i:[]:YS(n,t,i)}static findByGuid(t,n){return Gf(t,n,!0,!0)}static findObjectOfType(t,n,i=!0){return t9(t,n,i)}static findObjectsOfType(t,n){const i=[];return n9(t,i,n),i}static getComponentInChildren(t,n){return JS(n,t)}static getComponentsInChildren(t,n,i=null){return KS(n,t,i)}static getComponentInParent(t,n){return lE(n,t)}static getComponentsInParent(t,n,i=null){return FD(n,t,i)}static getAllComponents(t){var r;return[...(r=t.userData)==null?void 0:r.components]}static*iterateComponents(t){var i;const n=(i=t==null?void 0:t.userData)==null?void 0:i.components;if(n&&Array.isArray(n))for(let r=0;r<n.length;r++)yield n[r]}}const ra=class{constructor(){x(this,"__context");x(this,"__name");x(this,"gameObject");x(this,"guid","invalid");x(this,"sourceId");x(this,"__didAwake",!1);x(this,"__didStart",!1);x(this,"__didEnable",!1);x(this,"__isEnabled");x(this,"__destroyed",!1);x(this,"_collisionExitRoutine");x(this,"_collisions",null);x(this,"_triggerExitRoutine");x(this,"_triggerCollisions",null);x(this,"_worldPosition");x(this,"_worldQuaternion");x(this,"_worldEuler");x(this,"_worldRotation");x(this,"_eventListeners",new Map);this.__internalNewInstanceCreated()}get isComponent(){return!0}get context(){var e;return(e=this.__context)!=null?e:ui.Current}set context(e){this.__context=e}get scene(){return this.context.scene}get layer(){var e,t;return(t=(e=this.gameObject)==null?void 0:e.userData)==null?void 0:t.layer}get name(){var e;return(e=this.gameObject)==null?void 0:e.userData.name}set name(e){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=e,this.__name=e):this.__name=e}get tag(){var e;return(e=this.gameObject)==null?void 0:e.userData.tag}set tag(e){this.gameObject&&(this.gameObject.userData.tag=e)}get static(){var e;return(e=this.gameObject)==null?void 0:e.userData.static}get hideFlags(){var e;return(e=this.gameObject)==null?void 0:e.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const e=this.gameObject[Jg];return e===void 0?!0:e}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(e,t=qr.Update){return this.context.registerCoroutineUpdate(this,e,t)}stopCoroutine(e,t=qr.Update){this.context.unregisterCoroutineUpdate(e,t)}get destroyed(){return this.__destroyed}destroy(){this.destroyed||e9(this)}__internalNewInstanceCreated(){this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this.__internalResetsCachedPhysicsData()}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(){this.__didEnable||(this.__didEnable=!0,this.onEnable())}__internalDisable(){var e;!this.__didEnable||(this.__didEnable=!1,this._collisionExitRoutine=void 0,this.onDisable(),(e=this._collisions)==null||e.clear())}get collisionsCount(){var e,t;return(t=(e=this._collisions)==null?void 0:e.size)!=null?t:0}__internalResetsCachedPhysicsData(){this._collisionExitRoutine=null,this._collisions=null,this._triggerExitRoutine=null,this._triggerCollisions=null}__internalHandleCollision(e,t){var r,o,l,h;if(t){if(!this.onTriggerEnter&&!this.onTriggerStay&&!this.onTriggerExit)return}else if(!this.onCollisionEnter&&!this.onCollisionStay&&!this.onCollisionExit)return;const n=e.gameObject;t&&!this._triggerCollisions?this._triggerCollisions=new Map:this._collisions||(this._collisions=new Map);const i=t?this._triggerCollisions:this._collisions;if(i.has(n)){const u=i.get(n);u.frame=this.context.time.frameCount,u.col=e,t?(r=this.onTriggerStay)==null||r.call(this,e):(o=this.onCollisionStay)==null||o.call(this,e)}else{const u={col:e,frame:this.context.time.frameCount};i.set(n,u),t?(l=this.onTriggerEnter)==null||l.call(this,e):(h=this.onCollisionEnter)==null||h.call(this,e)}}__internalHandleExitCollisionEvent(e,t){var r;if(t){if(!this._triggerCollisions)return}else if(!this._collisions)return;const i=(t?this._triggerCollisions:this._collisions).get(e);!i||(i.exitFrame=this.context.time.frameCount,this.__waitForCollisionExit(t),t||(r=this.onCollisionExitRaw)==null||r.call(this,i.col))}__waitForCollisionExit(e){if(e?this._triggerExitRoutine:this._collisionExitRoutine)return;const n=e?this._triggerCollisions:this._collisions,i=this,r=10;function*o(){var h,u;for(;n&&n.size>0;){for(let f of n.keys()){const g=n.get(f);g.frame!==void 0&&i.context.time.frameCount-g.frame>=r&&(n.delete(f),e?(h=i.onTriggerExit)==null||h.call(i,g.col):(u=i.onCollisionExit)==null||u.call(i,g.col))}for(let f=0;f<r;f++)yield}e?i._triggerExitRoutine=void 0:i._collisionExitRoutine=null}const l=this.startCoroutine(o(),qr.OnAfterRender);e?this._triggerExitRoutine=l:this._collisionExitRoutine=l}get worldPosition(){return this._worldPosition||(this._worldPosition=new q),ni(this.gameObject,this._worldPosition),this._worldPosition}set worldPosition(e){sr(this.gameObject,e)}setWorldPosition(e,t,n){ra._worldPositionBuffer.set(e,t,n),this.worldPosition=ra._worldPositionBuffer}get worldQuaternion(){return this._worldQuaternion||(this._worldQuaternion=new kt),ga(this.gameObject,this._worldQuaternion)}set worldQuaternion(e){Za(this.gameObject,e)}setWorldQuaternion(e,t,n,i){ra._worldQuaternionBuffer.set(e,t,n,i),this.worldQuaternion=ra._worldQuaternionBuffer}get worldEuler(){return this._worldEuler||(this._worldEuler=new _s),this._worldEuler.setFromQuaternion(this.worldQuaternion),this._worldEuler}set worldEuler(e){var t;this._worldQuaternion||(this._worldQuaternion=new kt),(t=this._worldQuaternion)==null||t.setFromEuler(e),this.worldQuaternion=this._worldQuaternion}get worldRotation(){const e=this.worldEuler;this._worldRotation||(this._worldRotation=new q);const t=this._worldRotation;return t.set(e.x,e.y,e.z),t.x=Ci.toDegrees(t.x),t.y=Ci.toDegrees(t.y),t.z=Ci.toDegrees(t.z),t}set worldRotation(e){this.setWorldRotation(e.x,e.y,e.z,!0)}setWorldRotation(e,t,n,i=!0){i&&(e=Ci.toRadians(e),t=Ci.toRadians(t),n=Ci.toRadians(n)),ra._worldEulerBuffer.set(e,t,n),ra._worldQuaternionBuffer.setFromEuler(ra._worldEulerBuffer),this.worldQuaternion=ra._worldQuaternionBuffer}get forward(){return ra._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}addEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const n=this._eventListeners[e].indexOf(t);n>=0&&this._eventListeners[e].splice(n,1)}dispatchEvent(e){if(!this._eventListeners[e.type])return!1;const t=this._eventListeners[e.type];for(let n=0;n<t.length;n++)t[n](e);return!1}};let Do=ra;x(Do,"_worldPositionBuffer",new q),x(Do,"_worldQuaternionBuffer",new kt),x(Do,"_worldEulerBuffer",new _s),x(Do,"_tempQuaternionBuffer2",new kt),x(Do,"_forward",new q(0,0,1));class pt extends Do{get enabled(){var e;return(e=this.__isEnabled)!=null?e:!0}set enabled(e){typeof e=="number"&&(e>=.5?e=!0:e=!1),e!==this.__isEnabled&&(this.__isEnabled=e,this.__didAwake&&(e?this.__internalEnable():this.__internalDisable()))}}const D9=Object.freeze(Object.defineProperty({__proto__:null,HideFlags:jD,InstantiateOptions:Go,Behaviour:pt,Component:Do,GameObject:Ee},Symbol.toStringTag,{value:"Module"})),Zg=Ct("gizmos"),uo=Ct("debugextension"),L_=Ct("debugresolvedependencies"),O9=["/extensions/","extensions/"],F9=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function nM(a,e){L_&&console.log(a,e);const t=[];dE(F9,a,e,t);const n=await Promise.all(t);return typeof e=="string"&&n.length===1?n[0]:n}function dE(a,e,t,n){if(typeof t=="object"&&t!==void 0&&t!==null)for(const i of Object.keys(t)){const r=t[i];if(typeof r=="string"){const o=jP(e,r);if(o!==null)typeof o.then=="function"?n.push(o.then(l=>t[i]=l)):t[i]=o;else for(const l of a){const h=fE(l.prefix,r);if(h>=0){L_&&console.log(l,h,l.dependencyName),n.push(e==null?void 0:e.getDependency(l.dependencyName,h).then(u=>(t[i]=u,u)));break}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const l=r[o],h=jP(e,l);if(h!==null){typeof h.then=="function"?n.push(h.then(u=>r[o]=u)):r[o]=h;continue}for(const u of a){const f=fE(u.prefix,l);if(f>=0){L_&&console.log(u,f,u.dependencyName),n.push(e==null?void 0:e.getDependency(u.dependencyName,f).then(g=>r[o]=g));break}}typeof l=="object"&&dE(a,e,l,n)}else typeof r=="object"&&dE(a,e,r,n)}else typeof t=="string"&&k9(a,e,t,n)}function jP(a,e){if(a&&a.plugins&&typeof e=="string"){for(const t of O9)if(e.startsWith(t)){let n=e.substring(t.length);const i=n.indexOf("/");i>=0&&(n=n.substring(0,i));const r=a.plugins[n];if(uo&&console.log(n,r),typeof(r==null?void 0:r.resolve)=="function"){const o=e.substring(t.length+n.length+1);return r.resolve(a,o)}break}}return null}function k9(a,e,t,n){for(const i of a){const r=fE(i.prefix,t);if(r>=0)return L_&&console.log(i,r,i.dependencyName),n.push(e==null?void 0:e.getDependency(i.dependencyName,r).then(o=>o)),!0}return!1}function fE(a,e){if(typeof e=="string"&&e.startsWith(a)){const t=e.substring(a.length),n=Number.parseInt(t);if(n>=0)return n}return-1}class N9{constructor(){x(this,"_types",{})}add(e,t){const n=this._types[e];n===void 0?this._types[e]=t:n!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e)}get(e){return this._types[e]}}const Be=new N9,Hb="NEEDLE_persistent_assets";function U9(a){return(a==null?void 0:a.___persistentAsset)===!0}class z9{constructor(e){x(this,"parser");this.parser=e}get name(){return Hb}async afterRoot(e){var i,r;if(!((r=(i=this.parser)==null?void 0:i.json)!=null&&r.extensions))return;const t=this.parser.json.extensions[Hb];if(!t)return;uo&&console.log(t);const n=new Array;for(const o of t==null?void 0:t.assets){const l=nM(this.parser,o);l&&n.push(l)}await Promise.all(n)}resolve(e,t){const n=Number.parseInt(t);if(n>=0){uo&&console.log(t);const i=e.json.extensions[Hb];if(i){const r=i==null?void 0:i.assets[n];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&Be.get(o)}return r}}return null}}const hu=Ct("debugserializer");class G9{constructor(){x(this,"typeMap",{})}register(e,t){if(this.typeMap[e]!==void 0){if(this.typeMap[e]===t)return;console.warn("Type "+e+" is already registered",t,this.typeMap[e])}hu&&console.log("Register type serializer for "+e,t),this.typeMap[e]=t}getSerializer(e){if(!!e)return this.typeMap[e]}getSerializerForConstructor(e,t=0){var h,u,f,g;if(t>20)return;if(!e||!e.constructor){hu&&console.log("invalid type");return}const n=(u=e.name)!=null?u:(h=e.constructor)==null?void 0:h.name;if(!n){hu&&console.log("invalid name",n);return}const i=this.getSerializer(n);if(i!==void 0)return hu&&console.log("FOUND "+n,e.name,e.constructor.name,i,this.typeMap),i;let r=Object.getPrototypeOf(e);if(!(r.prototype||r.constructor)){hu&&console.warn("No prototype for "+n,e,e.name,e.prototype,e.constructor.name);return}const l=(f=r.prototype)!=null?f:r.constructor;if(l!==e){const m=this.getSerializerForConstructor(l,++t);if(m){hu&&console.log("FOUND "+l.constructor.name,l.name,l,m);const A=(g=l.name)!=null?g:l.constructor.name;A==="Function"?console.error("Registering Function is not allowed, something went wrong",e,l,m):this.register(A,m)}return m}}}const D_=new G9;class $g{constructor(e){if(Array.isArray(e))for(const t of e)D_.register(t.name,this);else D_.register(e.name,this)}}class qD{constructor(e){x(this,"root");x(this,"gltf");x(this,"gltfId");x(this,"object");x(this,"target");x(this,"nodeId");x(this,"nodeToObject");x(this,"objectToNode");x(this,"context");x(this,"path");this.root=e}}function H9(a,e){const t=a.$serializedTypes;if(t===void 0)return null;const n={};for(const i in t){let r=a[i];if(r!=null&&typeof r=="object"){const o=D_.getSerializerForConstructor(r);if(o){n[i]=o.onSerialize(r,e);continue}}n[i]=r}return n.name=a.constructor.name,typeof a.guid=="string"&&(n.guid=a.guid),n}const Ky=[];function XD(a,e){if(!a)return e;typeof a.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,a.$serializedTypes));const t=Object.getPrototypeOf(a);return XD(t,e)}function pE(a,e,t){if(!a)return!1;if(t.target=a,a.onBeforeDeserialize!==void 0){const i=a.onBeforeDeserialize(e,t);if(typeof i=="boolean")return i}const n=XD(a);if(e){if(typeof e.guid=="string"&&(a.guid=e.guid),n)for(const i in n){const r=n[i],o=e[i];if(!(a[i]!==void 0&&o===void 0))if(t.path=i,r===null)a[i]=o;else{let l=function(h){const f=h.type;return f?mE(o,f,t,void 0,a[i]):mE(o,h,t,void 0,a[i])};if(a.onBeforeDeserializeMember!==void 0&&a.onBeforeDeserializeMember(i,o,t)===!0)continue;if(Array.isArray(r))for(let h=0;h<r.length;h++){const u=r[h],f=l(u);if(f!==void 0||h===r.length-1){a[i]=f;break}}else a[i]=l(r);Ky.length=0,a.onAfterDeserializeMember!==void 0&&a.onAfterDeserializeMember(i,o,t)}}V9(a,e)}return a.onAfterDeserialize!==void 0&&a.onAfterDeserialize(e,t),t.path=void 0,!0}function V9(a,e){for(const n of Object.keys(e)){const i=e[n];if(typeof i=="object"&&i!==null&&i!==void 0){const r=a[n];if(!r){hu&&console.log(n,"is undefined on",a);continue}for(const o of Object.keys(i))r[o]===void 0&&t(i[o])&&!t(r)&&(r[o]=i[o])}}function t(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}}function mE(a,e,t,n,i){let r=typeof e=="function"&&e.prototype===void 0,o=e;if(r)try{if(o=e==null?void 0:e.call(e,i),r=!1,o==null)return}catch(f){console.error("Error in callback",f,a)}if(!r&&i instanceof o)return i;if(i&&typeof i=="object"&&U9(i)){if(i.__concreteInstance)return i.__concreteInstance;const f=i;if(!f.$serializedTypes&&o.prototype.$serializedTypes&&(f.$serializedTypes=o.prototype.$serializedTypes),f.$serializedTypes&&pE(f,a,t),i&&o!==void 0)try{const g=new o;uo&&console.log("Create concrete instance for persistent asset",i,"instance:",g),Pv(g,i),i.__concreteInstance=g,i=g}catch(g){console.error("Error creating instance or creating values on instance",g,i,o)}return i}if(n||(n={serializer:D_.getSerializerForConstructor(o)}),Array.isArray(a)){const f=[];for(let g=0;g<a.length;g++){const m=a[g],A=mE(m,e,t,n,m);f.push(A)}return f}const l=n.serializer;if(l)return l.onDeserialize(a,t);let h;a&&(a.isMaterial||a.isTexture||a.isObject3D)?h=a:h=new o(...W9(a));const u=h;return u.$serializedTypes&&pE(u,a,t),h}function W9(a){if(Ky.length=0,typeof a=="object"&&a!==null&&a!==void 0)for(const e of Object.keys(a))Ky.push(a[e]);return Ky}function Pv(a,e){if(e!=null&&a!=null)for(const t of Object.keys(e)){const n=Q9(a,t);(!n||n.writable===!0||(n==null?void 0:n.set)!==void 0)&&(a[t]=e[t])}}function Q9(a,e){let t;do t=Object.getOwnPropertyDescriptor(a,e);while(!t&&(a=Object.getPrototypeOf(a)));return t}class Vb{constructor(e){x(this,"key");x(this,"keyType");x(this,"source");this.key=e.key,this.keyType=e.type,this.source=e}}var O_=(a=>(a.PointerDown="pointerdown",a.PointerUp="pointerup",a.PointerMove="pointermove",a.KeyDown="keydown",a.KeyUp="keyup",a.KeyPressed="keypress",a))(O_||{});class j9 extends EventTarget{constructor(t){super();x(this,"_doubleClickTimeThreshold",.2);x(this,"_longPressTimeThreshold",1);x(this,"_specialCursorTrigger",0);x(this,"context");x(this,"_pointerDown",[!1]);x(this,"_pointerUp",[!1]);x(this,"_pointerClick",[!1]);x(this,"_pointerDoubleClick",[!1]);x(this,"_pointerPressed",[!1]);x(this,"_pointerPositions",[new Xe]);x(this,"_pointerPositionsLastFrame",[new Xe]);x(this,"_pointerPositionsDelta",[new Xe]);x(this,"_pointerPositionsRC",[new Xe]);x(this,"_pointerPositionDown",[new Xe]);x(this,"_pointerDownTime",[]);x(this,"_pointerUpTime",[]);x(this,"_pointerIds",[]);x(this,"_pointerTypes",[""]);x(this,"_mouseWheelChanged",[!1]);x(this,"_pointerEvent",[]);x(this,"keysPressed",{});this.context=t,this.context.post_render_callbacks.push(this.onEndOfFrame.bind(this));const n=this.context.renderer.domElement;n.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0}),n.addEventListener("touchend",this.onTouchUp.bind(this),!1),n.addEventListener("pointerdown",this.onPointerDown.bind(this),!1),n.addEventListener("pointermove",this.onPointerMove.bind(this),!1),n.addEventListener("pointerup",this.onPointerUp.bind(this),!1),n.addEventListener("wheel",this.onMouseWheel.bind(this),{passive:!0}),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keypress",this.onKeyPressed.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1),window.addEventListener("blur",this.onLostFocus.bind(this))}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getPointerPressedCount(){let t=0;for(let n=0;n<this._pointerPressed.length;n++)this._pointerPressed[n]&&t++;return t}getPointerPosition(t){return t>=this._pointerPositions.length?null:this._pointerPositions[t]}getPointerPositionLastFrame(t){return t>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[t]}getPointerPositionDelta(t){return t>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[t]}getPointerPositionRC(t){return t>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[t]}getPointerDown(t){return t>=this._pointerDown.length?!1:this._pointerDown[t]}getPointerUp(t){return t>=this._pointerUp.length?!1:this._pointerUp[t]}getPointerPressed(t){return t>=this._pointerPressed.length?!1:this._pointerPressed[t]}getPointerClicked(t){return t>=this._pointerClick.length?!1:this._pointerClick[t]}getPointerDoubleClicked(t){return t>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[t]}getPointerDownTime(t){return t>=this._pointerDownTime.length?-1:this._pointerDownTime[t]}getPointerUpTime(t){return t>=this._pointerUpTime.length?-1:this._pointerUpTime[t]}getPointerLongPress(t){return t>=this._pointerDownTime.length?!1:this.getPointerPressed(t)&&this.context.time.time-this._pointerDownTime[t]>this._longPressTimeThreshold}getIsMouse(t){return t>=this._pointerTypes.length?!1:this._pointerTypes[t]==="mouse"}getIsTouch(t){return t>=this._pointerTypes.length?!1:this._pointerTypes[t]==="touch"}getTouchesPressedCount(){let t=0;for(let n=0;n<this._pointerPressed.length;n++)this._pointerPressed[n]&&this.getIsTouch(n)&&t++;return t}getMouseWheelChanged(t=0){return t>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[t]}getPointerEvent(t){var n;if(!(t>=this._pointerEvent.length))return(n=this._pointerEvent[t])!=null?n:void 0}getKeyDown(){for(const t in this.keysPressed){const n=this.keysPressed[t];if(n.startFrame===this.context.time.frameCount)return n.key}return null}getKeyPressed(){for(const t in this.keysPressed){const n=this.keysPressed[t];if(n.pressed)return n.key}return null}isKeyDown(t){var n;return typeof t=="number"&&(console.warn("Use of keycode as number is not recommended, please use KeyCode or string instead"),t=String.fromCharCode(t)),this.context.application.isVisible&&this.context.application.hasFocus&&((n=this.keysPressed[t])==null?void 0:n.startFrame)===this.context.time.frameCount&&this.keysPressed[t].pressed}isKeyUp(t){var n;return typeof t=="number"&&(console.warn("Use of keycode as number is not recommended, please use KeyCode or string instead"),t=String.fromCharCode(t)),this.context.application.isVisible&&this.context.application.hasFocus&&((n=this.keysPressed[t])==null?void 0:n.frame)===this.context.time.frameCount&&!this.keysPressed[t].pressed}isKeyPressed(t){var n;return typeof t=="number"&&(t=String.fromCharCode(t)),this.context.application.isVisible&&this.context.application.hasFocus&&((n=this.keysPressed[t])==null?void 0:n.pressed)}createPointerDown(t){this.onDown(t)}createPointerMove(t){this.onMove(t)}createPointerUp(t){this.onUp(t)}onLostFocus(){for(const t in this.keysPressed)this.keysPressed[t].pressed=!1}onEndOfFrame(){for(let t=0;t<this._pointerUp.length;t++)this._pointerUp[t]=!1;for(let t=0;t<this._pointerDown.length;t++)this._pointerDown[t]=!1;for(let t=0;t<this._pointerClick.length;t++)this._pointerClick[t]=!1;for(let t=0;t<this._pointerDoubleClick.length;t++)this._pointerDoubleClick[t]=!1;for(const t of this._pointerPositionsDelta)t.set(0,0);for(let t=0;t<this._mouseWheelChanged.length;t++)this._mouseWheelChanged[t]=!1}onKeyDown(t){if(!this.context.application.hasFocus)return;const n=this.keysPressed[t.key];n&&n.pressed||(this.keysPressed[t.key]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:t.key},this.onDispatchEvent("keydown",new Vb(t)))}onKeyPressed(t){if(!this.context.application.hasFocus)return;const n=this.keysPressed[t.key];!n||(n.pressed=!0,n.frame=this.context.time.frameCount+1,this.onDispatchEvent("keypress",new Vb(t)))}onKeyUp(t){if(!this.context.application.hasFocus)return;const n=this.keysPressed[t.key];!n||(n.pressed=!1,n.frame=this.context.time.frameCount+1,this.onDispatchEvent("keyup",new Vb(t)))}onMouseWheel(t){this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0}onTouchMove(t){}onTouchUp(t){}onPointerDown(t){if(t.defaultPrevented||t.pointerType===void 0&&t.pointerId===void 0)return;let n=t.pointerType==="mouse"?t.button:this.getPointerIndex(t.pointerId);t.pointerId===void 0&&t.button!==void 0&&(n=t.button),this.onDown({button:n,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,source:t})}onPointerMove(t){if(t.defaultPrevented||t.pointerType===void 0&&t.pointerId===void 0)return;let n=t.pointerType==="mouse"?t.button:this.getPointerIndex(t.pointerId);t.pointerId===void 0&&t.button!==void 0&&(n=t.button),n<0&&(n=0);const i={button:n,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,source:t};this.onMove(i),this.onDispatchEvent("pointermove",t)}onPointerUp(t){if(t.defaultPrevented||t.pointerType===void 0&&t.pointerId===void 0)return;let n=t.pointerType==="mouse"?t.button:this.getPointerIndex(t.pointerId);t.pointerId===void 0&&t.button!==void 0&&(n=t.button),this._pointerIds[n]=-1,this.onUp({button:n,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,source:t}),this.onDispatchEvent("pointerup",t)}isInRect(t){return!0}onDown(t){if(!!this.isInRect(t)){for(this.setPointerState(t.button,this._pointerPressed,!0),this.setPointerState(t.button,this._pointerDown,!0),this.setPointerStateT(t.button,this._pointerEvent,t.source);t.button>=this._pointerTypes.length;)this._pointerTypes.push(t.pointerType);for(this._pointerTypes[t.button]=t.pointerType===void 0?"mouse":t.pointerType;t.button>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new Xe);this._pointerPositionDown[t.button].set(t.clientX,t.clientY),t.button>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t.button]=this.context.time.time,this.updatePointerPosition(t),this.onDispatchEvent("pointerdown",t)}}onMove(t){!this.isInRect(t)||(this.updatePointerPosition(t),this.setPointerStateT(t.button,this._pointerEvent,t.source))}onUp(t){if(this.setPointerState(t.button,this._pointerPressed,!1),this.setPointerStateT(t.button,this._pointerEvent,t.source),!this.isInRect(t))return;if(this.setPointerState(t.button,this._pointerUp,!0),this.updatePointerPosition(t),!this._pointerPositionDown[t.button]){console.warn("Received pointer up event without matching down event for button: "+t.button);return}const n=t.clientX-this._pointerPositionDown[t.button].x,i=t.clientY-this._pointerPositionDown[t.button].y;if(t.button>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),Math.abs(n)<5&&Math.abs(i)<5){this.setPointerState(t.button,this._pointerClick,!0);const r=this._pointerUpTime[t.button],o=this.context.time.time-r;o<this._doubleClickTimeThreshold&&o>0&&this.setPointerState(t.button,this._pointerDoubleClick,!0)}this._pointerUpTime[t.button]=this.context.time.time}updatePointerPosition(t){for(;t.button>=this._pointerPositions.length;)this._pointerPositions.push(new Xe);for(;t.button>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new Xe);for(;t.button>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new Xe);const n=this._pointerPositionsLastFrame[t.button];n.copy(this._pointerPositions[t.button]),this._pointerPositionsDelta[t.button].set(t.clientX-n.x,t.clientY-n.y),this._pointerPositions[t.button].x=t.clientX,this._pointerPositions[t.button].y=t.clientY;const i=t.clientX+window.scrollX,r=t.clientY+window.scrollY;for(;t.button>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new Xe);this._pointerPositionsRC[t.button].x=(i-this.context.domX)/this.context.domWidth*2-1,this._pointerPositionsRC[t.button].y=-((r-this.context.domY)/this.context.domHeight)*2+1}getPointerIndex(t){for(let n=0;n<this._pointerIds.length;n++)if(this._pointerIds[n]===t)return n;for(let n=0;n<this._pointerIds.length;n++)if(this._pointerIds[n]===-1&&(this._pointerIds[n]=t),this._pointerIds[n]===t)return n;return this._pointerIds.push(t),this._pointerIds.length-1}setPointerState(t,n,i){for(;n.length<=t;)n.push(!1);n[t]=i}setPointerStateT(t,n,i){for(;n.length<=t;)n.push(null);n[t]=i}onDispatchEvent(t,n){const i=ui.Current;try{ui.Current=this.context;const r=new Event(t);Pv(r,n),this.dispatchEvent(r)}finally{ui.Current=i}}}var Xl=(a=>(a.BACKSPACE="Backspace",a.TAB="Tab",a.ENTER="Enter",a.SHIFT="Shift",a.CTRL="Control",a.ALT="Alt",a.PAUSE="Pause",a.CAPS_LOCK="CapsLock",a.ESCAPE="Escape",a.SPACE=" ",a.PAGE_UP="PageUp",a.PAGE_DOWN="PageDown",a.END="End",a.HOME="Home",a.LEFT_ARROW="ArrowLeft",a.UP_ARROW="ArrowUp",a.RIGHT_ARROW="ArrowRight",a.DOWN_ARROW="ArrowDown",a.INSERT="Insert",a.DELETE="Delete",a.KEY_0="0",a.KEY_1="1",a.KEY_2="2",a.KEY_3="3",a.KEY_4="4",a.KEY_5="5",a.KEY_6="6",a.KEY_7="7",a.KEY_8="8",a.KEY_9="9",a.KEY_A="a",a.KEY_B="b",a.KEY_C="c",a.KEY_D="d",a.KEY_E="e",a.KEY_F="f",a.KEY_G="g",a.KEY_H="h",a.KEY_I="i",a.KEY_K="k",a.KEY_J="j",a.KEY_L="l",a.KEY_M="m",a.KEY_N="n",a.KEY_O="o",a.KEY_P="p",a.KEY_Q="q",a.KEY_R="r",a.KEY_S="s",a.KEY_T="t",a.KEY_U="u",a.KEY_V="v",a.KEY_W="w",a.KEY_X="x",a.KEY_Z="z",a.KEY_Y="y",a.SELECT="Select",a.NUMPAD_0="Numpad0",a.NUMPAD_1="Numpad1",a.NUMPAD_2="Numpad2",a.NUMPAD_3="Numpad3",a.NUMPAD_4="Numpad4",a.NUMPAD_5="Numpad5",a.NUMPAD_6="Numpad6",a.NUMPAD_7="Numpad7",a.NUMPAD_8="Numpad8",a.NUMPAD_9="Numpad9",a.MULTIPLY="Multiply",a.ADD="Add",a.SUBTRACT="Subtract",a.DECIMAL="Decimal",a.DIVIDE="Divide",a.F1="F1",a.F2="F2",a.F3="F3",a.F4="F4",a.F5="F5",a.F6="F6",a.F7="F7",a.F8="F8",a.F9="F9",a.F10="F10",a.F11="F11",a.F12="F12",a))(Xl||{});class Wa{constructor(e=[0,0,0,0,0,0,0,0,0]){this.elements=void 0,this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e=new re){const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t=new re){const n=this.elements,i=e.x,r=e.y,o=e.z;return t.x=n[0]*i+n[1]*r+n[2]*o,t.y=n[3]*i+n[4]*r+n[5]*o,t.z=n[6]*i+n[7]*r+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t=new Wa){const n=this.elements,i=e.elements,r=t.elements,o=n[0],l=n[1],h=n[2],u=n[3],f=n[4],g=n[5],m=n[6],A=n[7],v=n[8],b=i[0],C=i[1],S=i[2],I=i[3],M=i[4],R=i[5],T=i[6],B=i[7],F=i[8];return r[0]=o*b+l*I+h*T,r[1]=o*C+l*M+h*B,r[2]=o*S+l*R+h*F,r[3]=u*b+f*I+g*T,r[4]=u*C+f*M+g*B,r[5]=u*S+f*R+g*F,r[6]=m*b+A*I+v*T,r[7]=m*C+A*M+v*B,r[8]=m*S+A*R+v*F,t}scale(e,t=new Wa){const n=this.elements,i=t.elements;for(let r=0;r!==3;r++)i[3*r+0]=e.x*n[3*r+0],i[3*r+1]=e.y*n[3*r+1],i[3*r+2]=e.z*n[3*r+2];return t}solve(e,t=new re){const r=[];let o,l;for(o=0;o<3*4;o++)r.push(0);for(o=0;o<3;o++)for(l=0;l<3;l++)r[o+4*l]=this.elements[o+3*l];r[3+4*0]=e.x,r[3+4*1]=e.y,r[3+4*2]=e.z;let h=3;const u=h;let f;const g=4;let m;do{if(o=u-h,r[o+4*o]===0){for(l=o+1;l<u;l++)if(r[o+4*l]!==0){f=g;do m=g-f,r[m+4*o]+=r[m+4*l];while(--f);break}}if(r[o+4*o]!==0)for(l=o+1;l<u;l++){const A=r[o+4*l]/r[o+4*o];f=g;do m=g-f,r[m+4*l]=m<=o?0:r[m+4*l]-r[m+4*o]*A;while(--f)}}while(--h);if(t.z=r[2*4+3]/r[2*4+2],t.y=(r[1*4+3]-r[1*4+2]*t.z)/r[1*4+1],t.x=(r[0*4+3]-r[0*4+2]*t.z-r[0*4+1]*t.y)/r[0*4+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e=new Wa){const i=q9;let r,o;for(r=0;r<3;r++)for(o=0;o<3;o++)i[r+6*o]=this.elements[r+3*o];i[3+6*0]=1,i[3+6*1]=0,i[3+6*2]=0,i[4+6*0]=0,i[4+6*1]=1,i[4+6*2]=0,i[5+6*0]=0,i[5+6*1]=0,i[5+6*2]=1;let l=3;const h=l;let u;const f=6;let g;do{if(r=h-l,i[r+6*r]===0){for(o=r+1;o<h;o++)if(i[r+6*o]!==0){u=f;do g=f-u,i[g+6*r]+=i[g+6*o];while(--u);break}}if(i[r+6*r]!==0)for(o=r+1;o<h;o++){const m=i[r+6*o]/i[r+6*r];u=f;do g=f-u,i[g+6*o]=g<=r?0:i[g+6*o]-i[g+6*r]*m;while(--u)}}while(--l);r=2;do{o=r-1;do{const m=i[r+6*o]/i[r+6*r];u=6;do g=6-u,i[g+6*o]=i[g+6*o]-i[g+6*r]*m;while(--u)}while(o--)}while(--r);r=2;do{const m=1/i[r+6*r];u=6;do g=6-u,i[g+6*r]=i[g+6*r]*m;while(--u)}while(r--);r=2;do{o=2;do{if(g=i[3+o+6*r],isNaN(g)||g===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(r,o,g)}while(o--)}while(r--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,l=n+n,h=i+i,u=t*o,f=t*l,g=t*h,m=n*l,A=n*h,v=i*h,b=r*o,C=r*l,S=r*h,I=this.elements;return I[3*0+0]=1-(m+v),I[3*0+1]=f-S,I[3*0+2]=g+C,I[3*1+0]=f+S,I[3*1+1]=1-(u+v),I[3*1+2]=A-b,I[3*2+0]=g-C,I[3*2+1]=A+b,I[3*2+2]=1-(u+m),this}transpose(e=new Wa){const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const q9=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class re{constructor(e=0,t=0,n=0){this.x=void 0,this.y=void 0,this.z=void 0,this.x=e,this.y=t,this.z=n}cross(e,t=new re){const n=e.x,i=e.y,r=e.z,o=this.x,l=this.y,h=this.z;return t.x=l*r-h*i,t.y=h*n-o*r,t.z=o*i-l*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new re(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new re(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Wa([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i}unit(e=new re){const t=this.x,n=this.y,i=this.z;let r=Math.sqrt(t*t+n*n+i*i);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,l=e.z;return Math.sqrt((r-t)*(r-t)+(o-n)*(o-n)+(l-i)*(l-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,l=e.z;return(r-t)*(r-t)+(o-n)*(o-n)+(l-i)*(l-i)}scale(e,t=new re){const n=this.x,i=this.y,r=this.z;return t.x=e*n,t.y=e*i,t.z=e*r,t}vmul(e,t=new re){return t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n=new re){return n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e=new re){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=X9,r=1/n;i.set(this.x*r,this.y*r,this.z*r);const o=Y9;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,e)):(o.set(0,1,0),i.cross(o,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,r=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=o+(e.z-o)*t}almostEquals(e,t=1e-6){return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e=1e-6){return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(qP),qP.almostEquals(e,t)}clone(){return new re(this.x,this.y,this.z)}}re.ZERO=void 0;re.UNIT_X=void 0;re.UNIT_Y=void 0;re.UNIT_Z=void 0;re.ZERO=new re(0,0,0);re.UNIT_X=new re(1,0,0);re.UNIT_Y=new re(0,1,0);re.UNIT_Z=new re(0,0,1);const X9=new re,Y9=new re,qP=new re;class go{constructor(e={}){this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new re,this.upperBound=new re,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const r=this.lowerBound,o=this.upperBound,l=n;r.copy(e[0]),l&&l.vmult(r,r),o.copy(r);for(let h=1;h<e.length;h++){let u=e[h];l&&(l.vmult(u,XP),u=XP),u.x>o.x&&(o.x=u.x),u.x<r.x&&(r.x=u.x),u.y>o.y&&(o.y=u.y),u.y<r.y&&(r.y=u.y),u.z>o.z&&(o.z=u.z),u.z<r.z&&(r.z=u.z)}return t&&(t.vadd(r,r),t.vadd(o,o)),i&&(r.x-=i,r.y-=i,r.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new go().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound,o=i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,l=i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,h=i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return o&&l&&h}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z}getCorners(e,t,n,i,r,o,l,h){const u=this.lowerBound,f=this.upperBound;e.copy(u),t.set(f.x,u.y,u.z),n.set(f.x,f.y,u.z),i.set(u.x,f.y,f.z),r.set(f.x,u.y,f.z),o.set(u.x,f.y,u.z),l.set(u.x,u.y,f.z),h.copy(f)}toLocalFrame(e,t){const n=YP,i=n[0],r=n[1],o=n[2],l=n[3],h=n[4],u=n[5],f=n[6],g=n[7];this.getCorners(i,r,o,l,h,u,f,g);for(let m=0;m!==8;m++){const A=n[m];e.pointToLocal(A,A)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=YP,i=n[0],r=n[1],o=n[2],l=n[3],h=n[4],u=n[5],f=n[6],g=n[7];this.getCorners(i,r,o,l,h,u,f,g);for(let m=0;m!==8;m++){const A=n[m];e.pointToWorld(A,A)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,r=1/t.y,o=1/t.z,l=(this.lowerBound.x-n.x)*i,h=(this.upperBound.x-n.x)*i,u=(this.lowerBound.y-n.y)*r,f=(this.upperBound.y-n.y)*r,g=(this.lowerBound.z-n.z)*o,m=(this.upperBound.z-n.z)*o,A=Math.max(Math.max(Math.min(l,h),Math.min(u,f)),Math.min(g,m)),v=Math.min(Math.min(Math.max(l,h),Math.max(u,f)),Math.max(g,m));return!(v<0||A>v)}}const XP=new re,YP=[new re,new re,new re,new re,new re,new re,new re,new re];class JP{constructor(){this.matrix=void 0,this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const r=i;i=n,n=r}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:r}=t;if(r>i){const o=r;r=i,i=o}this.matrix[(i*(i+1)>>1)+r-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class YD{constructor(){this._listeners=void 0}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!!(n[e]!==void 0&&n[e].includes(t))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const i=n[e].indexOf(t);return i!==-1&&n[e].splice(i,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){e.target=this;for(let i=0,r=n.length;i<r;i++)n[i].call(this,e)}return this}}class us{constructor(e=0,t=0,n=0,i=1){this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e=new re){this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=J9,i=K9;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t=new us){const n=this.x,i=this.y,r=this.z,o=this.w,l=e.x,h=e.y,u=e.z,f=e.w;return t.x=n*f+o*l+i*u-r*h,t.y=i*f+o*h+r*l-n*u,t.z=r*f+o*u+n*h-i*l,t.w=o*f-n*l-i*h-r*u,t}inverse(e=new us){const t=this.x,n=this.y,i=this.z,r=this.w;this.conjugate(e);const o=1/(t*t+n*n+i*i+r*r);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e=new us){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t=new re){const n=e.x,i=e.y,r=e.z,o=this.x,l=this.y,h=this.z,u=this.w,f=u*n+l*r-h*i,g=u*i+h*n-o*r,m=u*r+o*i-l*n,A=-o*n-l*i-h*r;return t.x=f*u+A*-o+g*-h-m*-l,t.y=g*u+A*-l+m*-o-f*-h,t.z=m*u+A*-h+f*-l-g*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t="YZX"){let n,i,r;const o=this.x,l=this.y,h=this.z,u=this.w;switch(t){case"YZX":const f=o*l+h*u;if(f>.499&&(n=2*Math.atan2(o,u),i=Math.PI/2,r=0),f<-.499&&(n=-2*Math.atan2(o,u),i=-Math.PI/2,r=0),n===void 0){const g=o*o,m=l*l,A=h*h;n=Math.atan2(2*l*u-2*o*h,1-2*m-2*A),i=Math.asin(2*f),r=Math.atan2(2*o*u-2*l*h,1-2*g-2*A)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=n,e.z=i,e.x=r}setFromEuler(e,t,n,i="XYZ"){const r=Math.cos(e/2),o=Math.cos(t/2),l=Math.cos(n/2),h=Math.sin(e/2),u=Math.sin(t/2),f=Math.sin(n/2);return i==="XYZ"?(this.x=h*o*l+r*u*f,this.y=r*u*l-h*o*f,this.z=r*o*f+h*u*l,this.w=r*o*l-h*u*f):i==="YXZ"?(this.x=h*o*l+r*u*f,this.y=r*u*l-h*o*f,this.z=r*o*f-h*u*l,this.w=r*o*l+h*u*f):i==="ZXY"?(this.x=h*o*l-r*u*f,this.y=r*u*l+h*o*f,this.z=r*o*f+h*u*l,this.w=r*o*l-h*u*f):i==="ZYX"?(this.x=h*o*l-r*u*f,this.y=r*u*l+h*o*f,this.z=r*o*f-h*u*l,this.w=r*o*l+h*u*f):i==="YZX"?(this.x=h*o*l+r*u*f,this.y=r*u*l+h*o*f,this.z=r*o*f-h*u*l,this.w=r*o*l-h*u*f):i==="XZY"&&(this.x=h*o*l-r*u*f,this.y=r*u*l-h*o*f,this.z=r*o*f+h*u*l,this.w=r*o*l+h*u*f),this}clone(){return new us(this.x,this.y,this.z,this.w)}slerp(e,t,n=new us){const i=this.x,r=this.y,o=this.z,l=this.w;let h=e.x,u=e.y,f=e.z,g=e.w,m,A,v,b,C;return A=i*h+r*u+o*f+l*g,A<0&&(A=-A,h=-h,u=-u,f=-f,g=-g),1-A>1e-6?(m=Math.acos(A),v=Math.sin(m),b=Math.sin((1-t)*m)/v,C=Math.sin(t*m)/v):(b=1-t,C=t),n.x=b*i+C*h,n.y=b*r+C*u,n.z=b*o+C*f,n.w=b*l+C*g,n}integrate(e,t,n,i=new us){const r=e.x*n.x,o=e.y*n.y,l=e.z*n.z,h=this.x,u=this.y,f=this.z,g=this.w,m=t*.5;return i.x+=m*(r*g+o*f-l*u),i.y+=m*(o*g+l*h-r*f),i.z+=m*(l*g+r*u-o*h),i.w+=m*(-r*h-o*u-l*f),i}}const J9=new re,K9=new re,Z9={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class rn{constructor(e={}){this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=rn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,n,i){throw"calculateWorldAABB() not implemented for shape type "+this.type}}rn.idCounter=0;rn.types=Z9;class Ei{constructor(e={}){this.position=void 0,this.quaternion=void 0,this.position=new re,this.quaternion=new us,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Ei.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Ei.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t=new re){return this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i=new re){return n.vsub(e,i),t.conjugate(KP),KP.vmult(i,i),i}static pointToWorldFrame(e,t,n,i=new re){return t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n=new re){return e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i=new re){return t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const KP=new us;class Qm extends rn{constructor(e={}){const{vertices:t=[],faces:n=[],normals:i=[],axes:r,boundingSphereRadius:o}=e;super({type:rn.types.CONVEXPOLYHEDRON}),this.vertices=void 0,this.faces=void 0,this.faceNormals=void 0,this.worldVertices=void 0,this.worldVerticesNeedsUpdate=void 0,this.worldFaceNormals=void 0,this.worldFaceNormalsNeedsUpdate=void 0,this.uniqueAxes=void 0,this.uniqueEdges=void 0,this.vertices=t,this.faces=n,this.faceNormals=i,this.faceNormals.length===0&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new re;for(let r=0;r!==e.length;r++){const o=e[r],l=o.length;for(let h=0;h!==l;h++){const u=(h+1)%l;t[o[h]].vsub(t[o[u]],i),i.normalize();let f=!1;for(let g=0;g!==n.length;g++)if(n[g].almostEquals(i)||n[g].almostEquals(i)){f=!0;break}f||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error("Vertex "+this.faces[e][i]+" not found!");const t=this.faceNormals[e]||new re;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+t.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let i=0;i<this.faces[e].length;i++)console.warn(".vertices["+this.faces[e][i]+"] = Vec3("+this.vertices[this.faces[e][i]].toString()+")")}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],r=this.vertices[n[1]],o=this.vertices[n[2]];Qm.computeNormal(i,r,o,t)}static computeNormal(e,t,n,i){const r=new re,o=new re;t.vsub(e,o),n.vsub(t,r),r.cross(o,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,r,o,l,h,u){const f=new re;let g=-1,m=-Number.MAX_VALUE;for(let v=0;v<n.faces.length;v++){f.copy(n.faceNormals[v]),r.vmult(f,f);const b=f.dot(o);b>m&&(m=b,g=v)}const A=[];for(let v=0;v<n.faces[g].length;v++){const b=n.vertices[n.faces[g][v]],C=new re;C.copy(b),r.vmult(C,C),i.vadd(C,C),A.push(C)}g>=0&&this.clipFaceAgainstHull(o,e,t,A,l,h,u)}findSeparatingAxis(e,t,n,i,r,o,l,h){const u=new re,f=new re,g=new re,m=new re,A=new re,v=new re;let b=Number.MAX_VALUE;const C=this;if(C.uniqueAxes)for(let S=0;S!==C.uniqueAxes.length;S++){n.vmult(C.uniqueAxes[S],u);const I=C.testSepAxis(u,e,t,n,i,r);if(I===!1)return!1;I<b&&(b=I,o.copy(u))}else{const S=l?l.length:C.faces.length;for(let I=0;I<S;I++){const M=l?l[I]:I;u.copy(C.faceNormals[M]),n.vmult(u,u);const R=C.testSepAxis(u,e,t,n,i,r);if(R===!1)return!1;R<b&&(b=R,o.copy(u))}}if(e.uniqueAxes)for(let S=0;S!==e.uniqueAxes.length;S++){r.vmult(e.uniqueAxes[S],f);const I=C.testSepAxis(f,e,t,n,i,r);if(I===!1)return!1;I<b&&(b=I,o.copy(f))}else{const S=h?h.length:e.faces.length;for(let I=0;I<S;I++){const M=h?h[I]:I;f.copy(e.faceNormals[M]),r.vmult(f,f);const R=C.testSepAxis(f,e,t,n,i,r);if(R===!1)return!1;R<b&&(b=R,o.copy(f))}}for(let S=0;S!==C.uniqueEdges.length;S++){n.vmult(C.uniqueEdges[S],m);for(let I=0;I!==e.uniqueEdges.length;I++)if(r.vmult(e.uniqueEdges[I],A),m.cross(A,v),!v.almostZero()){v.normalize();const M=C.testSepAxis(v,e,t,n,i,r);if(M===!1)return!1;M<b&&(b=M,o.copy(v))}}return i.vsub(t,g),g.dot(o)>0&&o.negate(o),!0}testSepAxis(e,t,n,i,r,o){const l=this;Qm.project(l,e,n,i,Wb),Qm.project(t,e,r,o,Qb);const h=Wb[0],u=Wb[1],f=Qb[0],g=Qb[1];if(h<g||f<u)return!1;const m=h-g,A=f-u;return m<A?m:A}calculateLocalInertia(e,t){const n=new re,i=new re;this.computeLocalAABB(i,n);const r=n.x-i.x,o=n.y-i.y,l=n.z-i.z;t.x=1/12*e*(2*o*2*o+2*l*2*l),t.y=1/12*e*(2*r*2*r+2*l*2*l),t.z=1/12*e*(2*o*2*o+2*r*2*r)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,r,o,l){const h=new re,u=new re,f=new re,g=new re,m=new re,A=new re,v=new re,b=new re,C=this,S=[],I=i,M=S;let R=-1,T=Number.MAX_VALUE;for(let W=0;W<C.faces.length;W++){h.copy(C.faceNormals[W]),n.vmult(h,h);const J=h.dot(e);J<T&&(T=J,R=W)}if(R<0)return;const B=C.faces[R];B.connectedFaces=[];for(let W=0;W<C.faces.length;W++)for(let J=0;J<C.faces[W].length;J++)B.indexOf(C.faces[W][J])!==-1&&W!==R&&B.connectedFaces.indexOf(W)===-1&&B.connectedFaces.push(W);const F=B.length;for(let W=0;W<F;W++){const J=C.vertices[B[W]],ee=C.vertices[B[(W+1)%F]];J.vsub(ee,u),f.copy(u),n.vmult(f,f),t.vadd(f,f),g.copy(this.faceNormals[R]),n.vmult(g,g),t.vadd(g,g),f.cross(g,m),m.negate(m),A.copy(J),n.vmult(A,A),t.vadd(A,A);const Q=B.connectedFaces[W];v.copy(this.faceNormals[Q]);const Y=this.getPlaneConstantOfFace(Q);b.copy(v),n.vmult(b,b);const se=Y-b.dot(t);for(this.clipFaceAgainstPlane(I,M,b,se);I.length;)I.shift();for(;M.length;)I.push(M.shift())}v.copy(this.faceNormals[R]);const D=this.getPlaneConstantOfFace(R);b.copy(v),n.vmult(b,b);const U=D-b.dot(t);for(let W=0;W<I.length;W++){let J=b.dot(I[W])+U;if(J<=r&&(console.log("clamped: depth="+J+" to minDist="+r),J=r),J<=o){const ee=I[W];if(J<=1e-6){const Q={point:ee,normal:b,depth:J};l.push(Q)}}}}clipFaceAgainstPlane(e,t,n,i){let r,o;const l=e.length;if(l<2)return t;let h=e[e.length-1],u=e[0];r=n.dot(h)+i;for(let f=0;f<l;f++){if(u=e[f],o=n.dot(u)+i,r<0)if(o<0){const g=new re;g.copy(u),t.push(g)}else{const g=new re;h.lerp(u,r/(r-o),g),t.push(g)}else if(o<0){const g=new re;h.lerp(u,r/(r-o),g),t.push(g),t.push(u)}h=u,r=o}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new re);const n=this.vertices,i=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)t.vmult(n[r],i[r]),e.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const r=n[i];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new re);const n=this.faceNormals,i=this.worldFaceNormals;for(let r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const r=this.vertices;let o,l,h,u,f,g,m=new re;for(let A=0;A<r.length;A++){m.copy(r[A]),t.vmult(m,m),e.vadd(m,m);const v=m;(o===void 0||v.x<o)&&(o=v.x),(u===void 0||v.x>u)&&(u=v.x),(l===void 0||v.y<l)&&(l=v.y),(f===void 0||v.y>f)&&(f=v.y),(h===void 0||v.z<h)&&(h=v.z),(g===void 0||v.z>g)&&(g=v.z)}n.set(o,l,h),i.set(u,f,g)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e=new re){const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let r=0;r<n;r++){const o=i[r];t.vmult(o,o)}for(let r=0;r<this.faceNormals.length;r++){const o=this.faceNormals[r];t.vmult(o,o)}}if(e)for(let r=0;r<n;r++){const o=i[r];o.vadd(e,o)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,r=new re;this.getAveragePointLocal(r);for(let o=0;o<this.faces.length;o++){let l=i[o];const h=t[n[o][0]],u=new re;e.vsub(h,u);const f=l.dot(u),g=new re;r.vsub(h,g);const m=l.dot(g);if(f<0&&m>0||f>0&&m<0)return!1}return-1}static project(e,t,n,i,r){const o=e.vertices.length,l=$9;let h=0,u=0;const f=e7,g=e.vertices;f.setZero(),Ei.vectorToLocalFrame(n,i,t,l),Ei.pointToLocalFrame(n,i,f,f);const m=f.dot(l);u=h=g[0].dot(l);for(let A=1;A<o;A++){const v=g[A].dot(l);v>h&&(h=v),v<u&&(u=v)}if(u-=m,h-=m,u>h){const A=u;u=h,h=A}r[0]=h,r[1]=u}}const Wb=[],Qb=[],$9=new re,e7=new re;class Bv extends rn{constructor(e){super({type:rn.types.BOX}),this.halfExtents=void 0,this.convexPolyhedronRepresentation=void 0,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=re,r=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],o=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],l=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],h=new Qm({vertices:r,faces:o,axes:l});this.convexPolyhedronRepresentation=h,h.material=this.material}calculateLocalInertia(e,t=new re){return Bv.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),t!==void 0)for(let r=0;r!==n.length;r++)t.vmult(n[r],n[r]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let o=0;o<r.length;o++)Tl.set(r[o][0],r[o][1],r[o][2]),t.vmult(Tl,Tl),e.vadd(Tl,Tl),n(Tl.x,Tl.y,Tl.z)}calculateWorldAABB(e,t,n,i){const r=this.halfExtents;Ia[0].set(r.x,r.y,r.z),Ia[1].set(-r.x,r.y,r.z),Ia[2].set(-r.x,-r.y,r.z),Ia[3].set(-r.x,-r.y,-r.z),Ia[4].set(r.x,-r.y,-r.z),Ia[5].set(r.x,r.y,-r.z),Ia[6].set(-r.x,r.y,-r.z),Ia[7].set(r.x,-r.y,r.z);const o=Ia[0];t.vmult(o,o),e.vadd(o,o),i.copy(o),n.copy(o);for(let l=1;l<8;l++){const h=Ia[l];t.vmult(h,h),e.vadd(h,h);const u=h.x,f=h.y,g=h.z;u>i.x&&(i.x=u),f>i.y&&(i.y=f),g>i.z&&(i.z=g),u<n.x&&(n.x=u),f<n.y&&(n.y=f),g<n.z&&(n.z=g)}}}const Tl=new re,Ia=[new re,new re,new re,new re,new re,new re,new re,new re],iM={DYNAMIC:1,STATIC:2,KINEMATIC:4},sM={AWAKE:0,SLEEPY:1,SLEEPING:2};class en extends YD{constructor(e={}){super(),this.id=void 0,this.index=void 0,this.world=void 0,this.preStep=void 0,this.postStep=void 0,this.vlambda=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.collisionResponse=void 0,this.position=void 0,this.previousPosition=void 0,this.interpolatedPosition=void 0,this.initPosition=void 0,this.velocity=void 0,this.initVelocity=void 0,this.force=void 0,this.mass=void 0,this.invMass=void 0,this.material=void 0,this.linearDamping=void 0,this.type=void 0,this.allowSleep=void 0,this.sleepState=void 0,this.sleepSpeedLimit=void 0,this.sleepTimeLimit=void 0,this.timeLastSleepy=void 0,this.wakeUpAfterNarrowphase=void 0,this.torque=void 0,this.quaternion=void 0,this.initQuaternion=void 0,this.previousQuaternion=void 0,this.interpolatedQuaternion=void 0,this.angularVelocity=void 0,this.initAngularVelocity=void 0,this.shapes=void 0,this.shapeOffsets=void 0,this.shapeOrientations=void 0,this.inertia=void 0,this.invInertia=void 0,this.invInertiaWorld=void 0,this.invMassSolve=void 0,this.invInertiaSolve=void 0,this.invInertiaWorldSolve=void 0,this.fixedRotation=void 0,this.angularDamping=void 0,this.linearFactor=void 0,this.angularFactor=void 0,this.aabb=void 0,this.aabbNeedsUpdate=void 0,this.boundingRadius=void 0,this.wlambda=void 0,this.isTrigger=void 0,this.id=en.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new re,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new re,this.previousPosition=new re,this.interpolatedPosition=new re,this.initPosition=new re,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new re,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new re,this.force=new re;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?en.STATIC:en.DYNAMIC,typeof e.type==typeof en.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep<"u"?e.allowSleep:!0,this.sleepState=en.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit<"u"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit<"u"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new re,this.quaternion=new us,this.initQuaternion=new us,this.previousQuaternion=new us,this.interpolatedQuaternion=new us,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new re,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new re,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new re,this.invInertia=new re,this.invInertiaWorld=new Wa,this.invMassSolve=0,this.invInertiaSolve=new re,this.invInertiaWorldSolve=new Wa,this.fixedRotation=typeof e.fixedRotation<"u"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping<"u"?e.angularDamping:.01,this.linearFactor=new re(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new re(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new go,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new re,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=en.AWAKE,this.wakeUpAfterNarrowphase=!1,e===en.SLEEPING&&this.dispatchEvent(en.wakeupEvent)}sleep(){this.sleepState=en.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===en.AWAKE&&n<i?(this.sleepState=en.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(en.sleepyEvent)):t===en.SLEEPY&&n>i?this.wakeUp():t===en.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(en.sleepEvent))}}updateSolveMassProperties(){this.sleepState===en.SLEEPING||this.type===en.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t=new re){return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t=new re){return this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t=new re){return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t=new re){return this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new re,r=new us;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let r=0;r!==n;r++){const o=e[r];o.updateBoundingSphereRadius();const l=t[r].length(),h=o.boundingSphereRadius;l+h>i&&(i=l+h)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=t7,o=n7,l=this.quaternion,h=this.aabb,u=i7;for(let f=0;f!==i;f++){const g=e[f];l.vmult(t[f],r),r.vadd(this.position,r),l.mult(n[f],o),g.calculateWorldAABB(r,o,u.lowerBound,u.upperBound),f===0?h.copy(u):h.extend(u)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!e)){const n=s7,i=r7;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}}applyForce(e,t=new re){if(this.type!==en.DYNAMIC)return;this.sleepState===en.SLEEPING&&this.wakeUp();const n=o7;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t=new re){if(this.type!==en.DYNAMIC)return;const n=a7,i=c7;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===en.DYNAMIC&&(this.sleepState===en.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t=new re){if(this.type!==en.DYNAMIC)return;this.sleepState===en.SLEEPING&&this.wakeUp();const n=t,i=l7;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const r=h7;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(e,t=new re){if(this.type!==en.DYNAMIC)return;const n=u7,i=d7;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=f7;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Bv.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new re;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===en.DYNAMIC||this.type===en.KINEMATIC)||this.sleepState===en.SLEEPING)return;const i=this.velocity,r=this.angularVelocity,o=this.position,l=this.force,h=this.torque,u=this.quaternion,f=this.invMass,g=this.invInertiaWorld,m=this.linearFactor,A=f*e;i.x+=l.x*A*m.x,i.y+=l.y*A*m.y,i.z+=l.z*A*m.z;const v=g.elements,b=this.angularFactor,C=h.x*b.x,S=h.y*b.y,I=h.z*b.z;r.x+=e*(v[0]*C+v[1]*S+v[2]*I),r.y+=e*(v[3]*C+v[4]*S+v[5]*I),r.z+=e*(v[6]*C+v[7]*S+v[8]*I),o.x+=i.x*e,o.y+=i.y*e,o.z+=i.z*e,u.integrate(this.angularVelocity,e,this.angularFactor,u),t&&(n?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}en.idCounter=0;en.COLLIDE_EVENT_NAME="collide";en.DYNAMIC=iM.DYNAMIC;en.STATIC=iM.STATIC;en.KINEMATIC=iM.KINEMATIC;en.AWAKE=sM.AWAKE;en.SLEEPY=sM.SLEEPY;en.SLEEPING=sM.SLEEPING;en.wakeupEvent={type:"wakeup"};en.sleepyEvent={type:"sleepy"};en.sleepEvent={type:"sleep"};const t7=new re,n7=new us,i7=new go,s7=new Wa,r7=new Wa,o7=new re,a7=new re,c7=new re,l7=new re,h7=new re,u7=new re,d7=new re,f7=new re;class p7{constructor(){this.world=void 0,this.useBoundingBoxes=void 0,this.dirty=void 0,this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return!((e.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&e.collisionFilterMask)===0||((e.type&en.STATIC)!==0||e.sleepState===en.SLEEPING)&&((t.type&en.STATIC)!==0||t.sleepState===en.SLEEPING))}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const r=m7;t.position.vsub(e.position,r);const o=(e.boundingRadius+t.boundingRadius)**2;r.lengthSquared()<o&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=g7,i=A7,r=y7,o=e.length;for(let l=0;l!==o;l++)i[l]=e[l],r[l]=t[l];e.length=0,t.length=0;for(let l=0;l!==o;l++){const h=i[l].id,u=r[l].id,f=h<u?h+","+u:u+","+h;n[f]=l,n.keys.push(f)}for(let l=0;l!==n.keys.length;l++){const h=n.keys.pop(),u=n[h];e.push(i[u]),t.push(r[u]),delete n[h]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new re;e.position.vsub(t.position,n);const i=e.shapes[0],r=t.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const m7=new re,g7={keys:[]},A7=[],y7=[];new re;class _7 extends p7{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,r=i.length;let o,l;for(let h=0;h!==r;h++)for(let u=0;u!==h;u++)o=i[h],l=i[u],this.needBroadphaseCollision(o,l)&&this.intersectionTest(o,l,t,n)}aabbQuery(e,t,n=[]){for(let i=0;i<e.bodies.length;i++){const r=e.bodies[i];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}}class gE{constructor(){this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new re,this.rayToWorld=new re,this.hitNormalWorld=new re,this.hitPointWorld=new re,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,r,o,l){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=o,this.distance=l}}let JD,KD,ZD,$D,eO,tO,nO;const rM={CLOSEST:1,ANY:2,ALL:4};JD=rn.types.SPHERE;KD=rn.types.PLANE;ZD=rn.types.BOX;$D=rn.types.CYLINDER;eO=rn.types.CONVEXPOLYHEDRON;tO=rn.types.HEIGHTFIELD;nO=rn.types.TRIMESH;class Es{get[JD](){return this._intersectSphere}get[KD](){return this._intersectPlane}get[ZD](){return this._intersectBox}get[$D](){return this._intersectConvex}get[eO](){return this._intersectConvex}get[tO](){return this._intersectHeightfield}get[nO](){return this._intersectTrimesh}constructor(e=new re,t=new re){this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new re,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Es.ANY,this.result=new gE,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Es.ANY,this.result=t.result||new gE,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ZP),jb.length=0,e.broadphase.aabbQuery(e,ZP,jb),this.intersectBodies(jb),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=v7,r=x7;for(let o=0,l=e.shapes.length;o<l;o++){const h=e.shapes[o];if(!(n&&!h.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],r),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(h,r,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const r=this.from;if(O7(r,this.direction,n)>e.boundingSphereRadius)return;const l=this[e.type];l&&l.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}_intersectPlane(e,t,n,i,r){const o=this.from,l=this.to,h=this.direction,u=new re(0,0,1);t.vmult(u,u);const f=new re;o.vsub(n,f);const g=f.dot(u);l.vsub(n,f);const m=f.dot(u);if(g*m>0||o.distanceTo(l)<g)return;const A=u.dot(h);if(Math.abs(A)<this.precision)return;const v=new re,b=new re,C=new re;o.vsub(n,v);const S=-u.dot(v)/A;h.scale(S,b),o.vadd(b,C),this.reportIntersection(u,C,r,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,r=this.from;t.x=Math.min(i.x,r.x),t.y=Math.min(i.y,r.y),t.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}_intersectHeightfield(e,t,n,i,r){e.data,e.elementSize;const o=w7;o.from.copy(this.from),o.to.copy(this.to),Ei.pointToLocalFrame(n,t,o.from,o.from),Ei.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const l=b7;let h,u,f,g;h=u=0,f=g=e.data.length-1;const m=new go;o.getAABB(m),e.getIndexOfPosition(m.lowerBound.x,m.lowerBound.y,l,!0),h=Math.max(h,l[0]),u=Math.max(u,l[1]),e.getIndexOfPosition(m.upperBound.x,m.upperBound.y,l,!0),f=Math.min(f,l[0]+1),g=Math.min(g,l[1]+1);for(let A=h;A<f;A++)for(let v=u;v<g;v++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(A,v,m),!!m.overlapsRay(o)){if(e.getConvexTrianglePillar(A,v,!1),Ei.pointToWorldFrame(n,t,e.pillarOffset,Ey),this._intersectConvex(e.pillarConvex,t,Ey,i,r,$P),this.result.shouldStop)return;e.getConvexTrianglePillar(A,v,!0),Ei.pointToWorldFrame(n,t,e.pillarOffset,Ey),this._intersectConvex(e.pillarConvex,t,Ey,i,r,$P)}}}_intersectSphere(e,t,n,i,r){const o=this.from,l=this.to,h=e.radius,u=(l.x-o.x)**2+(l.y-o.y)**2+(l.z-o.z)**2,f=2*((l.x-o.x)*(o.x-n.x)+(l.y-o.y)*(o.y-n.y)+(l.z-o.z)*(o.z-n.z)),g=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-h**2,m=f**2-4*u*g,A=C7,v=E7;if(!(m<0))if(m===0)o.lerp(l,m,A),A.vsub(n,v),v.normalize(),this.reportIntersection(v,A,r,i,-1);else{const b=(-f-Math.sqrt(m))/(2*u),C=(-f+Math.sqrt(m))/(2*u);if(b>=0&&b<=1&&(o.lerp(l,b,A),A.vsub(n,v),v.normalize(),this.reportIntersection(v,A,r,i,-1)),this.result.shouldStop)return;C>=0&&C<=1&&(o.lerp(l,C,A),A.vsub(n,v),v.normalize(),this.reportIntersection(v,A,r,i,-1))}}_intersectConvex(e,t,n,i,r,o){const l=S7,h=eB,u=o&&o.faceList||null,f=e.faces,g=e.vertices,m=e.faceNormals,A=this.direction,v=this.from,b=this.to,C=v.distanceTo(b),S=u?u.length:f.length,I=this.result;for(let M=0;!I.shouldStop&&M<S;M++){const R=u?u[M]:M,T=f[R],B=m[R],F=t,D=n;h.copy(g[T[0]]),F.vmult(h,h),h.vadd(D,h),h.vsub(v,h),F.vmult(B,l);const U=A.dot(l);if(Math.abs(U)<this.precision)continue;const W=l.dot(h)/U;if(!(W<0)){A.scale(W,Ur),Ur.vadd(v,Ur),na.copy(g[T[0]]),F.vmult(na,na),D.vadd(na,na);for(let J=1;!I.shouldStop&&J<T.length-1;J++){Ra.copy(g[T[J]]),Pa.copy(g[T[J+1]]),F.vmult(Ra,Ra),F.vmult(Pa,Pa),D.vadd(Ra,Ra),D.vadd(Pa,Pa);const ee=Ur.distanceTo(v);!(Es.pointInTriangle(Ur,na,Ra,Pa)||Es.pointInTriangle(Ur,Ra,na,Pa))||ee>C||this.reportIntersection(l,Ur,r,i,R)}}}}_intersectTrimesh(e,t,n,i,r,o){const l=M7,h=L7,u=D7,f=eB,g=T7,m=I7,A=R7,v=B7,b=P7,C=e.indices;e.vertices;const S=this.from,I=this.to,M=this.direction;u.position.copy(n),u.quaternion.copy(t),Ei.vectorToLocalFrame(n,t,M,g),Ei.pointToLocalFrame(n,t,S,m),Ei.pointToLocalFrame(n,t,I,A),A.x*=e.scale.x,A.y*=e.scale.y,A.z*=e.scale.z,m.x*=e.scale.x,m.y*=e.scale.y,m.z*=e.scale.z,A.vsub(m,g),g.normalize();const R=m.distanceSquared(A);e.tree.rayQuery(this,u,h);for(let T=0,B=h.length;!this.result.shouldStop&&T!==B;T++){const F=h[T];e.getNormal(F,l),e.getVertex(C[F*3],na),na.vsub(m,f);const D=g.dot(l),U=l.dot(f)/D;if(U<0)continue;g.scale(U,Ur),Ur.vadd(m,Ur),e.getVertex(C[F*3+1],Ra),e.getVertex(C[F*3+2],Pa);const W=Ur.distanceSquared(m);!(Es.pointInTriangle(Ur,Ra,na,Pa)||Es.pointInTriangle(Ur,na,Ra,Pa))||W>R||(Ei.vectorToWorldFrame(t,l,b),Ei.pointToWorldFrame(n,t,Ur,v),this.reportIntersection(b,v,r,i,F))}h.length=0}reportIntersection(e,t,n,i,r){const o=this.from,l=this.to,h=o.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case Es.ALL:this.hasHit=!0,u.set(o,l,e,t,n,i,h),u.hasHit=!0,this.callback(u);break;case Es.CLOSEST:(h<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,h));break;case Es.ANY:this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,h),u.shouldStop=!0;break}}static pointInTriangle(e,t,n,i){i.vsub(t,Au),n.vsub(t,Am),e.vsub(t,qb);const r=Au.dot(Au),o=Au.dot(Am),l=Au.dot(qb),h=Am.dot(Am),u=Am.dot(qb);let f,g;return(f=h*l-o*u)>=0&&(g=r*u-o*l)>=0&&f+g<r*h-o*o}}Es.CLOSEST=rM.CLOSEST;Es.ANY=rM.ANY;Es.ALL=rM.ALL;const ZP=new go,jb=[],Am=new re,qb=new re,v7=new re,x7=new us,Ur=new re,na=new re,Ra=new re,Pa=new re,$P={faceList:[0]},Ey=new re,w7=new Es,b7=[],C7=new re,E7=new re,S7=new re,eB=new re,M7=new re,T7=new re,I7=new re,R7=new re,P7=new re,B7=new re;new go;const L7=[],D7=new Ei,Au=new re,Sy=new re;function O7(a,e,t){t.vsub(a,Au);const n=Au.dot(e);return e.scale(n,Sy),Sy.vadd(a,Sy),t.distanceTo(Sy)}class F7{static defaults(e={},t){for(let n in t)n in e||(e[n]=t[n]);return e}}class tB{constructor(){this.spatial=void 0,this.rotational=void 0,this.spatial=new re,this.rotational=new re}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class eA{constructor(e,t,n=-1e6,i=1e6){this.id=void 0,this.minForce=void 0,this.maxForce=void 0,this.bi=void 0,this.bj=void 0,this.si=void 0,this.sj=void 0,this.a=void 0,this.b=void 0,this.eps=void 0,this.jacobianElementA=void 0,this.jacobianElementB=void 0,this.enabled=void 0,this.multiplier=void 0,this.id=eA.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new tB,this.jacobianElementB=new tB,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,r=e,o=n;this.a=4/(o*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(o*o*r*(1+4*i))}computeB(e,t,n){const i=this.computeGW(),r=this.computeGq(),o=this.computeGiMf();return-r*e-i*t-o*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,o=i.position;return e.spatial.dot(r)+t.spatial.dot(o)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,o=i.velocity,l=n.angularVelocity,h=i.angularVelocity;return e.multiplyVectors(r,l)+t.multiplyVectors(o,h)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,o=i.vlambda,l=n.wlambda,h=i.wlambda;return e.multiplyVectors(r,l)+t.multiplyVectors(o,h)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,o=n.torque,l=i.force,h=i.torque,u=n.invMassSolve,f=i.invMassSolve;return r.scale(u,nB),l.scale(f,iB),n.invInertiaWorldSolve.vmult(o,sB),i.invInertiaWorldSolve.vmult(h,rB),e.multiplyVectors(nB,sB)+t.multiplyVectors(iB,rB)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,o=i.invMassSolve,l=n.invInertiaWorldSolve,h=i.invInertiaWorldSolve;let u=r+o;return l.vmult(e.rotational,My),u+=My.dot(e.rotational),h.vmult(t.rotational,My),u+=My.dot(t.rotational),u}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,o=k7;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,o),i.wlambda.addScaledVector(e,o,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,o),r.wlambda.addScaledVector(e,o,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}eA.idCounter=0;const nB=new re,iB=new re,sB=new re,rB=new re,My=new re,k7=new re;class N7 extends eA{constructor(e,t,n=1e6){super(e,t,0,n),this.restitution=void 0,this.ri=void 0,this.rj=void 0,this.ni=void 0,this.restitution=0,this.ri=new re,this.rj=new re,this.ni=new re}computeB(e){const t=this.a,n=this.b,i=this.bi,r=this.bj,o=this.ri,l=this.rj,h=U7,u=z7,f=i.velocity,g=i.angularVelocity;i.force,i.torque;const m=r.velocity,A=r.angularVelocity;r.force,r.torque;const v=G7,b=this.jacobianElementA,C=this.jacobianElementB,S=this.ni;o.cross(S,h),l.cross(S,u),S.negate(b.spatial),h.negate(b.rotational),C.spatial.copy(S),C.rotational.copy(u),v.copy(r.position),v.vadd(l,v),v.vsub(i.position,v),v.vsub(o,v);const I=S.dot(v),M=this.restitution+1,R=M*m.dot(S)-M*f.dot(S)+A.dot(u)-g.dot(h),T=this.computeGiMf();return-I*t-R*n-e*T}getImpactVelocityAlongNormal(){const e=H7,t=V7,n=W7,i=Q7,r=j7;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,r),this.ni.dot(r)}}const U7=new re,z7=new re,G7=new re,H7=new re,V7=new re,W7=new re,Q7=new re,j7=new re;new re;new re;new re;new re;new re;new re;class oB extends eA{constructor(e,t,n){super(e,t,-n,n),this.ri=void 0,this.rj=void 0,this.t=void 0,this.ri=new re,this.rj=new re,this.t=new re}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,r=q7,o=X7,l=this.t;n.cross(l,r),i.cross(l,o);const h=this.jacobianElementA,u=this.jacobianElementB;l.negate(h.spatial),r.negate(h.rotational),u.spatial.copy(l),u.rotational.copy(o);const f=this.computeGW(),g=this.computeGiMf();return-f*t-e*g}}const q7=new re,X7=new re;class Lv{constructor(e,t,n){this.id=void 0,this.materials=void 0,this.friction=void 0,this.restitution=void 0,this.contactEquationStiffness=void 0,this.contactEquationRelaxation=void 0,this.frictionEquationStiffness=void 0,this.frictionEquationRelaxation=void 0,n=F7.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Lv.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}Lv.idCounter=0;class Dv{constructor(e={}){this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=Dv.idCounter++,this.friction=typeof e.friction<"u"?e.friction:-1,this.restitution=typeof e.restitution<"u"?e.restitution:-1}}Dv.idCounter=0;class Y7{constructor(e,t,n={}){this.restLength=void 0,this.stiffness=void 0,this.damping=void 0,this.bodyA=void 0,this.bodyB=void 0,this.localAnchorA=void 0,this.localAnchorB=void 0,this.restLength=typeof n.restLength=="number"?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new re,this.localAnchorB=new re,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}setWorldAnchorA(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)}setWorldAnchorB(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)}getWorldAnchorA(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)}getWorldAnchorB(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)}applyForce(){const e=this.stiffness,t=this.damping,n=this.restLength,i=this.bodyA,r=this.bodyB,o=J7,l=K7,h=Z7,u=$7,f=oY,g=eY,m=tY,A=nY,v=iY,b=sY,C=rY;this.getWorldAnchorA(g),this.getWorldAnchorB(m),g.vsub(i.position,A),m.vsub(r.position,v),m.vsub(g,o);const S=o.length();l.copy(o),l.normalize(),r.velocity.vsub(i.velocity,h),r.angularVelocity.cross(v,f),h.vadd(f,h),i.angularVelocity.cross(A,f),h.vsub(f,h),l.scale(-e*(S-n)-t*h.dot(l),u),i.force.vsub(u,i.force),r.force.vadd(u,r.force),A.cross(u,b),v.cross(u,C),i.torque.vsub(b,i.torque),r.torque.vadd(C,r.torque)}}const J7=new re,K7=new re,Z7=new re,$7=new re,eY=new re,tY=new re,nY=new re,iY=new re,sY=new re,rY=new re,oY=new re;new re;new re;new re;new re;new re;new Es;new re;new re;new re(1,0,0),new re(0,1,0),new re(0,0,1);new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;class aY extends rn{constructor(e){if(super({type:rn.types.SPHERE}),this.radius=void 0,this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t=new re){const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const r=this.radius,o=["x","y","z"];for(let l=0;l<o.length;l++){const h=o[l];n[h]=e[h]-r,i[h]=e[h]+r}}}new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new go;new re;new go;new re;new re;new re;new re;new re;new re;new re;new go;new re;new Ei;new go;class cY{constructor(){this.equations=void 0,this.equations=[]}solve(e,t){return 0}addEquation(e){e.enabled&&!e.bi.isTrigger&&!e.bj.isTrigger&&this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class lY extends cY{constructor(){super(),this.iterations=void 0,this.tolerance=void 0,this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,r=this.tolerance*this.tolerance,o=this.equations,l=o.length,h=t.bodies,u=h.length,f=e;let g,m,A,v,b,C;if(l!==0)for(let R=0;R!==u;R++)h[R].updateSolveMassProperties();const S=uY,I=dY,M=hY;S.length=l,I.length=l,M.length=l;for(let R=0;R!==l;R++){const T=o[R];M[R]=0,I[R]=T.computeB(f),S[R]=1/T.computeC()}if(l!==0){for(let B=0;B!==u;B++){const F=h[B],D=F.vlambda,U=F.wlambda;D.set(0,0,0),U.set(0,0,0)}for(n=0;n!==i;n++){v=0;for(let B=0;B!==l;B++){const F=o[B];g=I[B],m=S[B],C=M[B],b=F.computeGWlambda(),A=m*(g-b-F.eps*C),C+A<F.minForce?A=F.minForce-C:C+A>F.maxForce&&(A=F.maxForce-C),M[B]+=A,v+=A>0?A:-A,F.addToWlambda(A)}if(v*v<r)break}for(let B=0;B!==u;B++){const F=h[B],D=F.velocity,U=F.angularVelocity;F.vlambda.vmul(F.linearFactor,F.vlambda),D.vadd(F.vlambda,D),F.wlambda.vmul(F.angularFactor,F.wlambda),U.vadd(F.wlambda,U)}let R=o.length;const T=1/f;for(;R--;)o[R].multiplier=M[R]*T}return n}}const hY=[],uY=[],dY=[];en.STATIC;class fY{constructor(){this.objects=[],this.type=Object}release(...e){const t=e.length;for(let n=0;n!==t;n++)this.objects.push(e[n]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class pY extends fY{constructor(...e){super(...e),this.type=re}constructObject(){return new re}}let iO,sO,rO,oO,aO,cO,lO,hO,uO,dO,fO,pO,mO,gO,AO,yO,_O,vO,xO,wO,bO,CO,EO,SO,MO;const Xi={sphereSphere:rn.types.SPHERE,spherePlane:rn.types.SPHERE|rn.types.PLANE,boxBox:rn.types.BOX|rn.types.BOX,sphereBox:rn.types.SPHERE|rn.types.BOX,planeBox:rn.types.PLANE|rn.types.BOX,convexConvex:rn.types.CONVEXPOLYHEDRON,sphereConvex:rn.types.SPHERE|rn.types.CONVEXPOLYHEDRON,planeConvex:rn.types.PLANE|rn.types.CONVEXPOLYHEDRON,boxConvex:rn.types.BOX|rn.types.CONVEXPOLYHEDRON,sphereHeightfield:rn.types.SPHERE|rn.types.HEIGHTFIELD,boxHeightfield:rn.types.BOX|rn.types.HEIGHTFIELD,convexHeightfield:rn.types.CONVEXPOLYHEDRON|rn.types.HEIGHTFIELD,sphereParticle:rn.types.PARTICLE|rn.types.SPHERE,planeParticle:rn.types.PLANE|rn.types.PARTICLE,boxParticle:rn.types.BOX|rn.types.PARTICLE,convexParticle:rn.types.PARTICLE|rn.types.CONVEXPOLYHEDRON,cylinderCylinder:rn.types.CYLINDER,sphereCylinder:rn.types.SPHERE|rn.types.CYLINDER,planeCylinder:rn.types.PLANE|rn.types.CYLINDER,boxCylinder:rn.types.BOX|rn.types.CYLINDER,convexCylinder:rn.types.CONVEXPOLYHEDRON|rn.types.CYLINDER,heightfieldCylinder:rn.types.HEIGHTFIELD|rn.types.CYLINDER,particleCylinder:rn.types.PARTICLE|rn.types.CYLINDER,sphereTrimesh:rn.types.SPHERE|rn.types.TRIMESH,planeTrimesh:rn.types.PLANE|rn.types.TRIMESH};iO=Xi.sphereSphere;sO=Xi.spherePlane;rO=Xi.boxBox;oO=Xi.sphereBox;aO=Xi.planeBox;cO=Xi.convexConvex;lO=Xi.sphereConvex;hO=Xi.planeConvex;uO=Xi.boxConvex;dO=Xi.sphereHeightfield;fO=Xi.boxHeightfield;pO=Xi.convexHeightfield;mO=Xi.sphereParticle;gO=Xi.planeParticle;AO=Xi.boxParticle;yO=Xi.convexParticle;_O=Xi.cylinderCylinder;vO=Xi.sphereCylinder;xO=Xi.planeCylinder;wO=Xi.boxCylinder;bO=Xi.convexCylinder;CO=Xi.heightfieldCylinder;EO=Xi.particleCylinder;SO=Xi.sphereTrimesh;MO=Xi.planeTrimesh;class mY{get[iO](){return this.sphereSphere}get[sO](){return this.spherePlane}get[rO](){return this.boxBox}get[oO](){return this.sphereBox}get[aO](){return this.planeBox}get[cO](){return this.convexConvex}get[lO](){return this.sphereConvex}get[hO](){return this.planeConvex}get[uO](){return this.boxConvex}get[dO](){return this.sphereHeightfield}get[fO](){return this.boxHeightfield}get[pO](){return this.convexHeightfield}get[mO](){return this.sphereParticle}get[gO](){return this.planeParticle}get[AO](){return this.boxParticle}get[yO](){return this.convexParticle}get[_O](){return this.convexConvex}get[vO](){return this.sphereConvex}get[xO](){return this.planeConvex}get[wO](){return this.boxConvex}get[bO](){return this.convexConvex}get[CO](){return this.heightfieldCylinder}get[EO](){return this.particleCylinder}get[SO](){return this.sphereTrimesh}get[MO](){return this.planeTrimesh}constructor(e){this.contactPointPool=void 0,this.frictionEquationPool=void 0,this.result=void 0,this.frictionResult=void 0,this.v3pool=void 0,this.world=void 0,this.currentContactMaterial=void 0,this.enableFrictionReduction=void 0,this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new pY,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,r,o){let l;this.contactPointPool.length?(l=this.contactPointPool.pop(),l.bi=e,l.bj=t):l=new N7(e,t),l.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const h=this.currentContactMaterial;l.restitution=h.restitution,l.setSpookParams(h.contactEquationStiffness,h.contactEquationRelaxation,this.world.dt);const u=n.material||e.material,f=i.material||t.material;return u&&f&&u.restitution>=0&&f.restitution>=0&&(l.restitution=u.restitution*f.restitution),l.si=r||n,l.sj=o||i,l}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,r=e.si,o=e.sj,l=this.world,h=this.currentContactMaterial;let u=h.friction;const f=r.material||n.material,g=o.material||i.material;if(f&&g&&f.friction>=0&&g.friction>=0&&(u=f.friction*g.friction),u>0){const m=u*l.gravity.length();let A=n.invMass+i.invMass;A>0&&(A=1/A);const v=this.frictionEquationPool,b=v.length?v.pop():new oB(n,i,m*A),C=v.length?v.pop():new oB(n,i,m*A);return b.bi=C.bi=n,b.bj=C.bj=i,b.minForce=C.minForce=-m*A,b.maxForce=C.maxForce=m*A,b.ri.copy(e.ri),b.rj.copy(e.rj),C.ri.copy(e.ri),C.rj.copy(e.rj),e.ni.tangents(b.t,C.t),b.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,l.dt),C.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,l.dt),b.enabled=C.enabled=e.enabled,t.push(b,C),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];nu.setZero(),ef.setZero(),tf.setZero();const r=t.bi;t.bj;for(let l=0;l!==e;l++)t=this.result[this.result.length-1-l],t.bi!==r?(nu.vadd(t.ni,nu),ef.vadd(t.ri,ef),tf.vadd(t.rj,tf)):(nu.vsub(t.ni,nu),ef.vadd(t.rj,ef),tf.vadd(t.ri,tf));const o=1/e;ef.scale(o,n.ri),tf.scale(o,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),nu.normalize(),nu.tangents(n.t,i.t)}getContacts(e,t,n,i,r,o,l){this.contactPointPool=r,this.frictionEquationPool=l,this.result=i,this.frictionResult=o;const h=yY,u=_Y,f=gY,g=AY;for(let m=0,A=e.length;m!==A;m++){const v=e[m],b=t[m];let C=null;v.material&&b.material&&(C=n.getContactMaterial(v.material,b.material)||null);const S=v.type&en.KINEMATIC&&b.type&en.STATIC||v.type&en.STATIC&&b.type&en.KINEMATIC||v.type&en.KINEMATIC&&b.type&en.KINEMATIC;for(let I=0;I<v.shapes.length;I++){v.quaternion.mult(v.shapeOrientations[I],h),v.quaternion.vmult(v.shapeOffsets[I],f),f.vadd(v.position,f);const M=v.shapes[I];for(let R=0;R<b.shapes.length;R++){b.quaternion.mult(b.shapeOrientations[R],u),b.quaternion.vmult(b.shapeOffsets[R],g),g.vadd(b.position,g);const T=b.shapes[R];if(!(M.collisionFilterMask&T.collisionFilterGroup&&T.collisionFilterMask&M.collisionFilterGroup)||f.distanceTo(g)>M.boundingSphereRadius+T.boundingSphereRadius)continue;let B=null;M.material&&T.material&&(B=n.getContactMaterial(M.material,T.material)||null),this.currentContactMaterial=B||C||n.defaultContactMaterial;const F=M.type|T.type,D=this[F];if(D){let U=!1;M.type<T.type?U=D.call(this,M,T,f,g,h,u,v,b,M,T,S):U=D.call(this,T,M,g,f,u,h,b,v,M,T,S),U&&S&&(n.shapeOverlapKeeper.set(M.id,T.id),n.bodyOverlapKeeper.set(v.id,b.id))}}}}}sphereSphere(e,t,n,i,r,o,l,h,u,f,g){if(g)return n.distanceSquared(i)<(e.radius+t.radius)**2;const m=this.createContactEquation(l,h,e,t,u,f);i.vsub(n,m.ni),m.ni.normalize(),m.ri.copy(m.ni),m.rj.copy(m.ni),m.ri.scale(e.radius,m.ri),m.rj.scale(-t.radius,m.rj),m.ri.vadd(n,m.ri),m.ri.vsub(l.position,m.ri),m.rj.vadd(i,m.rj),m.rj.vsub(h.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}spherePlane(e,t,n,i,r,o,l,h,u,f,g){const m=this.createContactEquation(l,h,e,t,u,f);if(m.ni.set(0,0,1),o.vmult(m.ni,m.ni),m.ni.negate(m.ni),m.ni.normalize(),m.ni.scale(e.radius,m.ri),n.vsub(i,Ty),m.ni.scale(m.ni.dot(Ty),aB),Ty.vsub(aB,m.rj),-Ty.dot(m.ni)<=e.radius){if(g)return!0;const A=m.ri,v=m.rj;A.vadd(n,A),A.vsub(l.position,A),v.vadd(i,v),v.vsub(h.position,v),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}boxBox(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,r,o,l,h,e,t,g)}sphereBox(e,t,n,i,r,o,l,h,u,f,g){const m=this.v3pool,A=QY;n.vsub(i,Iy),t.getSideNormals(A,o);const v=e.radius;let b=!1;const C=qY,S=XY,I=YY;let M=null,R=0,T=0,B=0,F=null;for(let ae=0,ve=A.length;ae!==ve&&b===!1;ae++){const xe=HY;xe.copy(A[ae]);const Ae=xe.length();xe.normalize();const Ie=Iy.dot(xe);if(Ie<Ae+v&&Ie>0){const Le=VY,De=WY;Le.copy(A[(ae+1)%3]),De.copy(A[(ae+2)%3]);const $e=Le.length(),vt=De.length();Le.normalize(),De.normalize();const zt=Iy.dot(Le),Ve=Iy.dot(De);if(zt<$e&&zt>-$e&&Ve<vt&&Ve>-vt){const gn=Math.abs(Ie-Ae-v);if((F===null||gn<F)&&(F=gn,T=zt,B=Ve,M=Ae,C.copy(xe),S.copy(Le),I.copy(De),R++,g))return!0}}}if(R){b=!0;const ae=this.createContactEquation(l,h,e,t,u,f);C.scale(-v,ae.ri),ae.ni.copy(C),ae.ni.negate(ae.ni),C.scale(M,C),S.scale(T,S),C.vadd(S,C),I.scale(B,I),C.vadd(I,ae.rj),ae.ri.vadd(n,ae.ri),ae.ri.vsub(l.position,ae.ri),ae.rj.vadd(i,ae.rj),ae.rj.vsub(h.position,ae.rj),this.result.push(ae),this.createFrictionEquationsFromContact(ae,this.frictionResult)}let D=m.get();const U=jY;for(let ae=0;ae!==2&&!b;ae++)for(let ve=0;ve!==2&&!b;ve++)for(let xe=0;xe!==2&&!b;xe++)if(D.set(0,0,0),ae?D.vadd(A[0],D):D.vsub(A[0],D),ve?D.vadd(A[1],D):D.vsub(A[1],D),xe?D.vadd(A[2],D):D.vsub(A[2],D),i.vadd(D,U),U.vsub(n,U),U.lengthSquared()<v*v){if(g)return!0;b=!0;const Ae=this.createContactEquation(l,h,e,t,u,f);Ae.ri.copy(U),Ae.ri.normalize(),Ae.ni.copy(Ae.ri),Ae.ri.scale(v,Ae.ri),Ae.rj.copy(D),Ae.ri.vadd(n,Ae.ri),Ae.ri.vsub(l.position,Ae.ri),Ae.rj.vadd(i,Ae.rj),Ae.rj.vsub(h.position,Ae.rj),this.result.push(Ae),this.createFrictionEquationsFromContact(Ae,this.frictionResult)}m.release(D),D=null;const W=m.get(),J=m.get(),ee=m.get(),Q=m.get(),Y=m.get(),se=A.length;for(let ae=0;ae!==se&&!b;ae++)for(let ve=0;ve!==se&&!b;ve++)if(ae%3!==ve%3){A[ve].cross(A[ae],W),W.normalize(),A[ae].vadd(A[ve],J),ee.copy(n),ee.vsub(J,ee),ee.vsub(i,ee);const xe=ee.dot(W);W.scale(xe,Q);let Ae=0;for(;Ae===ae%3||Ae===ve%3;)Ae++;Y.copy(n),Y.vsub(Q,Y),Y.vsub(J,Y),Y.vsub(i,Y);const Ie=Math.abs(xe),Le=Y.length();if(Ie<A[Ae].length()&&Le<v){if(g)return!0;b=!0;const De=this.createContactEquation(l,h,e,t,u,f);J.vadd(Q,De.rj),De.rj.copy(De.rj),Y.negate(De.ni),De.ni.normalize(),De.ri.copy(De.rj),De.ri.vadd(i,De.ri),De.ri.vsub(n,De.ri),De.ri.normalize(),De.ri.scale(v,De.ri),De.ri.vadd(n,De.ri),De.ri.vsub(l.position,De.ri),De.rj.vadd(i,De.rj),De.rj.vsub(h.position,De.rj),this.result.push(De),this.createFrictionEquationsFromContact(De,this.frictionResult)}}m.release(W,J,ee,Q,Y)}planeBox(e,t,n,i,r,o,l,h,u,f,g){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,r,o,l,h,e,t,g)}convexConvex(e,t,n,i,r,o,l,h,u,f,g,m,A){const v=hJ;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,i,o,v,m,A)){const b=[],C=uJ;e.clipAgainstHull(n,r,t,i,o,v,-100,100,b);let S=0;for(let I=0;I!==b.length;I++){if(g)return!0;const M=this.createContactEquation(l,h,e,t,u,f),R=M.ri,T=M.rj;v.negate(M.ni),b[I].normal.negate(C),C.scale(b[I].depth,C),b[I].point.vadd(C,R),T.copy(b[I].point),R.vsub(n,R),T.vsub(i,T),R.vadd(n,R),R.vsub(l.position,R),T.vadd(i,T),T.vsub(h.position,T),this.result.push(M),S++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(M,this.frictionResult)}this.enableFrictionReduction&&S&&this.createFrictionFromAverage(S)}}sphereConvex(e,t,n,i,r,o,l,h,u,f,g){const m=this.v3pool;n.vsub(i,JY);const A=t.faceNormals,v=t.faces,b=t.vertices,C=e.radius;let S=!1;for(let I=0;I!==b.length;I++){const M=b[I],R=eJ;o.vmult(M,R),i.vadd(R,R);const T=$Y;if(R.vsub(n,T),T.lengthSquared()<C*C){if(g)return!0;S=!0;const B=this.createContactEquation(l,h,e,t,u,f);B.ri.copy(T),B.ri.normalize(),B.ni.copy(B.ri),B.ri.scale(C,B.ri),R.vsub(i,B.rj),B.ri.vadd(n,B.ri),B.ri.vsub(l.position,B.ri),B.rj.vadd(i,B.rj),B.rj.vsub(h.position,B.rj),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult);return}}for(let I=0,M=v.length;I!==M&&S===!1;I++){const R=A[I],T=v[I],B=tJ;o.vmult(R,B);const F=nJ;o.vmult(b[T[0]],F),F.vadd(i,F);const D=iJ;B.scale(-C,D),n.vadd(D,D);const U=sJ;D.vsub(F,U);const W=U.dot(B),J=rJ;if(n.vsub(F,J),W<0&&J.dot(B)>0){const ee=[];for(let Q=0,Y=T.length;Q!==Y;Q++){const se=m.get();o.vmult(b[T[Q]],se),i.vadd(se,se),ee.push(se)}if(GY(ee,B,n)){if(g)return!0;S=!0;const Q=this.createContactEquation(l,h,e,t,u,f);B.scale(-C,Q.ri),B.negate(Q.ni);const Y=m.get();B.scale(-W,Y);const se=m.get();B.scale(-C,se),n.vsub(i,Q.rj),Q.rj.vadd(se,Q.rj),Q.rj.vadd(Y,Q.rj),Q.rj.vadd(i,Q.rj),Q.rj.vsub(h.position,Q.rj),Q.ri.vadd(n,Q.ri),Q.ri.vsub(l.position,Q.ri),m.release(Y),m.release(se),this.result.push(Q),this.createFrictionEquationsFromContact(Q,this.frictionResult);for(let ae=0,ve=ee.length;ae!==ve;ae++)m.release(ee[ae]);return}else for(let Q=0;Q!==T.length;Q++){const Y=m.get(),se=m.get();o.vmult(b[T[(Q+1)%T.length]],Y),o.vmult(b[T[(Q+2)%T.length]],se),i.vadd(Y,Y),i.vadd(se,se);const ae=KY;se.vsub(Y,ae);const ve=ZY;ae.unit(ve);const xe=m.get(),Ae=m.get();n.vsub(Y,Ae);const Ie=Ae.dot(ve);ve.scale(Ie,xe),xe.vadd(Y,xe);const Le=m.get();if(xe.vsub(n,Le),Ie>0&&Ie*Ie<ae.lengthSquared()&&Le.lengthSquared()<C*C){if(g)return!0;const De=this.createContactEquation(l,h,e,t,u,f);xe.vsub(i,De.rj),xe.vsub(n,De.ni),De.ni.normalize(),De.ni.scale(C,De.ri),De.rj.vadd(i,De.rj),De.rj.vsub(h.position,De.rj),De.ri.vadd(n,De.ri),De.ri.vsub(l.position,De.ri),this.result.push(De),this.createFrictionEquationsFromContact(De,this.frictionResult);for(let $e=0,vt=ee.length;$e!==vt;$e++)m.release(ee[$e]);m.release(Y),m.release(se),m.release(xe),m.release(Le),m.release(Ae);return}m.release(Y),m.release(se),m.release(xe),m.release(Le),m.release(Ae)}for(let Q=0,Y=ee.length;Q!==Y;Q++)m.release(ee[Q])}}}planeConvex(e,t,n,i,r,o,l,h,u,f,g){const m=oJ,A=aJ;A.set(0,0,1),r.vmult(A,A);let v=0;const b=cJ;for(let C=0;C!==t.vertices.length;C++)if(m.copy(t.vertices[C]),o.vmult(m,m),i.vadd(m,m),m.vsub(n,b),A.dot(b)<=0){if(g)return!0;const I=this.createContactEquation(l,h,e,t,u,f),M=lJ;A.scale(A.dot(b),M),m.vsub(M,M),M.vsub(n,I.ri),I.ni.copy(A),m.vsub(i,I.rj),I.ri.vadd(n,I.ri),I.ri.vsub(l.position,I.ri),I.rj.vadd(i,I.rj),I.rj.vsub(h.position,I.rj),this.result.push(I),v++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(I,this.frictionResult)}this.enableFrictionReduction&&v&&this.createFrictionFromAverage(v)}boxConvex(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,r,o,l,h,e,t,g)}sphereHeightfield(e,t,n,i,r,o,l,h,u,f,g){const m=t.data,A=e.radius,v=t.elementSize,b=bJ,C=wJ;Ei.pointToLocalFrame(i,o,n,C);let S=Math.floor((C.x-A)/v)-1,I=Math.ceil((C.x+A)/v)+1,M=Math.floor((C.y-A)/v)-1,R=Math.ceil((C.y+A)/v)+1;if(I<0||R<0||S>m.length||M>m[0].length)return;S<0&&(S=0),I<0&&(I=0),M<0&&(M=0),R<0&&(R=0),S>=m.length&&(S=m.length-1),I>=m.length&&(I=m.length-1),R>=m[0].length&&(R=m[0].length-1),M>=m[0].length&&(M=m[0].length-1);const T=[];t.getRectMinMax(S,M,I,R,T);const B=T[0],F=T[1];if(C.z-A>F||C.z+A<B)return;const D=this.result;for(let U=S;U<I;U++)for(let W=M;W<R;W++){const J=D.length;let ee=!1;if(t.getConvexTrianglePillar(U,W,!1),Ei.pointToWorldFrame(i,o,t.pillarOffset,b),n.distanceTo(b)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ee=this.sphereConvex(e,t.pillarConvex,n,b,r,o,l,h,e,t,g)),g&&ee||(t.getConvexTrianglePillar(U,W,!0),Ei.pointToWorldFrame(i,o,t.pillarOffset,b),n.distanceTo(b)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ee=this.sphereConvex(e,t.pillarConvex,n,b,r,o,l,h,e,t,g)),g&&ee))return!0;if(D.length-J>2)return}}boxHeightfield(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,r,o,l,h,e,t,g)}convexHeightfield(e,t,n,i,r,o,l,h,u,f,g){const m=t.data,A=t.elementSize,v=e.boundingSphereRadius,b=vJ,C=xJ,S=_J;Ei.pointToLocalFrame(i,o,n,S);let I=Math.floor((S.x-v)/A)-1,M=Math.ceil((S.x+v)/A)+1,R=Math.floor((S.y-v)/A)-1,T=Math.ceil((S.y+v)/A)+1;if(M<0||T<0||I>m.length||R>m[0].length)return;I<0&&(I=0),M<0&&(M=0),R<0&&(R=0),T<0&&(T=0),I>=m.length&&(I=m.length-1),M>=m.length&&(M=m.length-1),T>=m[0].length&&(T=m[0].length-1),R>=m[0].length&&(R=m[0].length-1);const B=[];t.getRectMinMax(I,R,M,T,B);const F=B[0],D=B[1];if(!(S.z-v>D||S.z+v<F))for(let U=I;U<M;U++)for(let W=R;W<T;W++){let J=!1;if(t.getConvexTrianglePillar(U,W,!1),Ei.pointToWorldFrame(i,o,t.pillarOffset,b),n.distanceTo(b)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(J=this.convexConvex(e,t.pillarConvex,n,b,r,o,l,h,null,null,g,C,null)),g&&J||(t.getConvexTrianglePillar(U,W,!0),Ei.pointToWorldFrame(i,o,t.pillarOffset,b),n.distanceTo(b)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(J=this.convexConvex(e,t.pillarConvex,n,b,r,o,l,h,null,null,g,C,null)),g&&J))return!0}}sphereParticle(e,t,n,i,r,o,l,h,u,f,g){const m=mJ;if(m.set(0,0,1),i.vsub(n,m),m.lengthSquared()<=e.radius*e.radius){if(g)return!0;const v=this.createContactEquation(h,l,t,e,u,f);m.normalize(),v.rj.copy(m),v.rj.scale(e.radius,v.rj),v.ni.copy(m),v.ni.negate(v.ni),v.ri.set(0,0,0),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}planeParticle(e,t,n,i,r,o,l,h,u,f,g){const m=dJ;m.set(0,0,1),l.quaternion.vmult(m,m);const A=fJ;if(i.vsub(l.position,A),m.dot(A)<=0){if(g)return!0;const b=this.createContactEquation(h,l,t,e,u,f);b.ni.copy(m),b.ni.negate(b.ni),b.ri.set(0,0,0);const C=pJ;m.scale(m.dot(i),C),i.vsub(C,C),b.rj.copy(C),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult)}}boxParticle(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,r,o,l,h,e,t,g)}convexParticle(e,t,n,i,r,o,l,h,u,f,g){let m=-1;const A=AJ,v=yJ;let b=null;const C=gJ;if(C.copy(i),C.vsub(n,C),r.conjugate(cB),cB.vmult(C,C),e.pointIsInside(C)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let S=0,I=e.faces.length;S!==I;S++){const M=[e.worldVertices[e.faces[S][0]]],R=e.worldFaceNormals[S];i.vsub(M[0],lB);const T=-R.dot(lB);if(b===null||Math.abs(T)<Math.abs(b)){if(g)return!0;b=T,m=S,A.copy(R)}}if(m!==-1){const S=this.createContactEquation(h,l,t,e,u,f);A.scale(b,v),v.vadd(i,v),v.vsub(n,v),S.rj.copy(v),A.negate(S.ni),S.ri.set(0,0,0);const I=S.ri,M=S.rj;I.vadd(i,I),I.vsub(h.position,I),M.vadd(n,M),M.vsub(l.position,M),this.result.push(S),this.createFrictionEquationsFromContact(S,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,r,o,l,h,u,f,g){return this.convexHeightfield(t,e,i,n,o,r,h,l,u,f,g)}particleCylinder(e,t,n,i,r,o,l,h,u,f,g){return this.convexParticle(t,e,i,n,o,r,h,l,u,f,g)}sphereTrimesh(e,t,n,i,r,o,l,h,u,f,g){const m=MY,A=TY,v=IY,b=RY,C=PY,S=BY,I=FY,M=SY,R=CY,T=kY;Ei.pointToLocalFrame(i,o,n,C);const B=e.radius;I.lowerBound.set(C.x-B,C.y-B,C.z-B),I.upperBound.set(C.x+B,C.y+B,C.z+B),t.getTrianglesInAABB(I,T);const F=EY,D=e.radius*e.radius;for(let Q=0;Q<T.length;Q++)for(let Y=0;Y<3;Y++)if(t.getVertex(t.indices[T[Q]*3+Y],F),F.vsub(C,R),R.lengthSquared()<=D){if(M.copy(F),Ei.pointToWorldFrame(i,o,M,F),F.vsub(n,R),g)return!0;let se=this.createContactEquation(l,h,e,t,u,f);se.ni.copy(R),se.ni.normalize(),se.ri.copy(se.ni),se.ri.scale(e.radius,se.ri),se.ri.vadd(n,se.ri),se.ri.vsub(l.position,se.ri),se.rj.copy(F),se.rj.vsub(h.position,se.rj),this.result.push(se),this.createFrictionEquationsFromContact(se,this.frictionResult)}for(let Q=0;Q<T.length;Q++)for(let Y=0;Y<3;Y++){t.getVertex(t.indices[T[Q]*3+Y],m),t.getVertex(t.indices[T[Q]*3+(Y+1)%3],A),A.vsub(m,v),C.vsub(A,S);const se=S.dot(v);C.vsub(m,S);let ae=S.dot(v);if(ae>0&&se<0&&(C.vsub(m,S),b.copy(v),b.normalize(),ae=S.dot(b),b.scale(ae,S),S.vadd(m,S),S.distanceTo(C)<e.radius)){if(g)return!0;const xe=this.createContactEquation(l,h,e,t,u,f);S.vsub(C,xe.ni),xe.ni.normalize(),xe.ni.scale(e.radius,xe.ri),xe.ri.vadd(n,xe.ri),xe.ri.vsub(l.position,xe.ri),Ei.pointToWorldFrame(i,o,S,S),S.vsub(h.position,xe.rj),Ei.vectorToWorldFrame(o,xe.ni,xe.ni),Ei.vectorToWorldFrame(o,xe.ri,xe.ri),this.result.push(xe),this.createFrictionEquationsFromContact(xe,this.frictionResult)}}const U=LY,W=DY,J=OY,ee=bY;for(let Q=0,Y=T.length;Q!==Y;Q++){t.getTriangleVertices(T[Q],U,W,J),t.getNormal(T[Q],ee),C.vsub(U,S);let se=S.dot(ee);if(ee.scale(se,S),C.vsub(S,S),se=S.distanceTo(C),Es.pointInTriangle(S,U,W,J)&&se<e.radius){if(g)return!0;let ae=this.createContactEquation(l,h,e,t,u,f);S.vsub(C,ae.ni),ae.ni.normalize(),ae.ni.scale(e.radius,ae.ri),ae.ri.vadd(n,ae.ri),ae.ri.vsub(l.position,ae.ri),Ei.pointToWorldFrame(i,o,S,S),S.vsub(h.position,ae.rj),Ei.vectorToWorldFrame(o,ae.ni,ae.ni),Ei.vectorToWorldFrame(o,ae.ri,ae.ri),this.result.push(ae),this.createFrictionEquationsFromContact(ae,this.frictionResult)}}T.length=0}planeTrimesh(e,t,n,i,r,o,l,h,u,f,g){const m=new re,A=vY;A.set(0,0,1),r.vmult(A,A);for(let v=0;v<t.vertices.length/3;v++){t.getVertex(v,m);const b=new re;b.copy(m),Ei.pointToWorldFrame(i,o,b,m);const C=xY;if(m.vsub(n,C),A.dot(C)<=0){if(g)return!0;const I=this.createContactEquation(l,h,e,t,u,f);I.ni.copy(A);const M=wY;A.scale(C.dot(A),M),m.vsub(M,M),I.ri.copy(M),I.ri.vsub(l.position,I.ri),I.rj.copy(m),I.rj.vsub(h.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}}}}const nu=new re,ef=new re,tf=new re,gY=new re,AY=new re,yY=new us,_Y=new us,vY=new re,xY=new re,wY=new re,bY=new re,CY=new re,EY=new re,SY=new re,MY=new re,TY=new re,IY=new re,RY=new re,PY=new re,BY=new re,LY=new re,DY=new re,OY=new re,FY=new go,kY=[],Ty=new re,aB=new re,NY=new re,UY=new re,zY=new re;function GY(a,e,t){let n=null;const i=a.length;for(let r=0;r!==i;r++){const o=a[r],l=NY;a[(r+1)%i].vsub(o,l);const h=UY;l.cross(e,h);const u=zY;t.vsub(o,u);const f=h.dot(u);if(n===null||f>0&&n===!0||f<=0&&n===!1){n===null&&(n=f>0);continue}else return!1}return!0}const Iy=new re,HY=new re,VY=new re,WY=new re,QY=[new re,new re,new re,new re,new re,new re],jY=new re,qY=new re,XY=new re,YY=new re,JY=new re,KY=new re,ZY=new re,$Y=new re,eJ=new re,tJ=new re,nJ=new re,iJ=new re,sJ=new re,rJ=new re,oJ=new re,aJ=new re,cJ=new re,lJ=new re,hJ=new re,uJ=new re,dJ=new re,fJ=new re,pJ=new re,mJ=new re,cB=new us,gJ=new re,AJ=new re,lB=new re,yJ=new re,_J=new re,vJ=new re,xJ=[0],wJ=new re,bJ=new re;class hB{constructor(){this.current=void 0,this.previous=void 0,this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let r=0;for(;n>i[r];)r++;if(n!==i[r]){for(let o=i.length-1;o>=r;o--)i[o+1]=i[o];i[r]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,r=n.length,o=i.length;let l=0;for(let h=0;h<r;h++){let u=!1;const f=n[h];for(;f>i[l];)l++;u=f===i[l],u||uB(e,f)}l=0;for(let h=0;h<o;h++){let u=!1;const f=i[h];for(;f>n[l];)l++;u=n[l]===f,u||uB(t,f)}}}function uB(a,e){a.push((e&4294901760)>>16,e&65535)}class CJ{constructor(){this.data={keys:[]}}get(e,t){if(e>t){const n=t;t=e,e=n}return this.data[e+"-"+t]}set(e,t,n){if(e>t){const r=t;t=e,e=r}const i=e+"-"+t;this.get(e,t)||this.data.keys.push(i),this.data[i]=n}reset(){const e=this.data,t=e.keys;for(;t.length>0;){const n=t.pop();delete e[n]}}}class EJ extends YD{constructor(e={}){super(),this.dt=void 0,this.allowSleep=void 0,this.contacts=void 0,this.frictionEquations=void 0,this.quatNormalizeSkip=void 0,this.quatNormalizeFast=void 0,this.time=void 0,this.stepnumber=void 0,this.default_dt=void 0,this.nextId=void 0,this.gravity=void 0,this.broadphase=void 0,this.bodies=void 0,this.hasActiveBodies=void 0,this.solver=void 0,this.constraints=void 0,this.narrowphase=void 0,this.collisionMatrix=void 0,this.collisionMatrixPrevious=void 0,this.bodyOverlapKeeper=void 0,this.shapeOverlapKeeper=void 0,this.materials=void 0,this.contactmaterials=void 0,this.contactMaterialTable=void 0,this.defaultMaterial=void 0,this.defaultContactMaterial=void 0,this.doProfiling=void 0,this.profile=void 0,this.accumulator=void 0,this.subsystems=void 0,this.addBodyEvent=void 0,this.removeBodyEvent=void 0,this.idToBodyMap=void 0,this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new re,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new _7,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new lY,this.constraints=[],this.narrowphase=new mY(this),this.collisionMatrix=new JP,this.collisionMatrixPrevious=new JP,this.bodyOverlapKeeper=new hB,this.shapeOverlapKeeper=new hB,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new CJ,this.defaultMaterial=new Dv("default"),this.defaultContactMaterial=new Lv(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}numObjects(){return this.bodies.length}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof gE?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n={},i){return n.mode=Es.ALL,n.from=e,n.to=t,n.callback=i,Xb.intersectWorld(this,n)}raycastAny(e,t,n={},i){return n.mode=Es.ANY,n.from=e,n.to=t,n.result=i,Xb.intersectWorld(this,n)}raycastClosest(e,t,n={},i){return n.mode=Es.CLOSEST,n.from=e,n.to=t,n.result=i,Xb.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof en&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(i!==-1){n.splice(i,1);for(let r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let r=0;r<i.length;r++){const o=i[r];if(o.id===e)return o}}return null}addMaterial(e){this.materials.push(e)}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}step(e,t,n=10){if(t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=Ws.now();let r=0;for(;this.accumulator>=e&&r<n&&(this.internalStep(e),this.accumulator-=e,r++,!(Ws.now()-i>e*1e3)););this.accumulator=this.accumulator%e;const o=this.accumulator/e;for(let l=0;l!==this.bodies.length;l++){const h=this.bodies[l];h.previousPosition.lerp(h.position,o,h.interpolatedPosition),h.previousQuaternion.slerp(h.quaternion,o,h.interpolatedQuaternion),h.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=RJ,i=PJ,r=this.numObjects(),o=this.bodies,l=this.solver,h=this.gravity,u=this.doProfiling,f=this.profile,g=en.DYNAMIC;let m=-1/0;const A=this.constraints,v=IJ;h.length();const b=h.x,C=h.y,S=h.z;let I=0;for(u&&(m=Ws.now()),I=0;I!==r;I++){const Q=o[I];if(Q.type===g){const Y=Q.force,se=Q.mass;Y.x+=se*b,Y.y+=se*C,Y.z+=se*S}}for(let Q=0,Y=this.subsystems.length;Q!==Y;Q++)this.subsystems[Q].update();u&&(m=Ws.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),u&&(f.broadphase=Ws.now()-m);let M=A.length;for(I=0;I!==M;I++){const Q=A[I];if(!Q.collideConnected)for(let Y=n.length-1;Y>=0;Y-=1)(Q.bodyA===n[Y]&&Q.bodyB===i[Y]||Q.bodyB===n[Y]&&Q.bodyA===i[Y])&&(n.splice(Y,1),i.splice(Y,1))}this.collisionMatrixTick(),u&&(m=Ws.now());const R=TJ,T=t.length;for(I=0;I!==T;I++)R.push(t[I]);t.length=0;const B=this.frictionEquations.length;for(I=0;I!==B;I++)v.push(this.frictionEquations[I]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,R,this.frictionEquations,v),u&&(f.narrowphase=Ws.now()-m),u&&(m=Ws.now()),I=0;I<this.frictionEquations.length;I++)l.addEquation(this.frictionEquations[I]);const F=t.length;for(let Q=0;Q!==F;Q++){const Y=t[Q],se=Y.bi,ae=Y.bj,ve=Y.si,xe=Y.sj;let Ae;if(se.material&&ae.material?Ae=this.getContactMaterial(se.material,ae.material)||this.defaultContactMaterial:Ae=this.defaultContactMaterial,Ae.friction,se.material&&ae.material&&(se.material.friction>=0&&ae.material.friction>=0&&se.material.friction*ae.material.friction,se.material.restitution>=0&&ae.material.restitution>=0&&(Y.restitution=se.material.restitution*ae.material.restitution)),l.addEquation(Y),se.allowSleep&&se.type===en.DYNAMIC&&se.sleepState===en.SLEEPING&&ae.sleepState===en.AWAKE&&ae.type!==en.STATIC){const Ie=ae.velocity.lengthSquared()+ae.angularVelocity.lengthSquared(),Le=ae.sleepSpeedLimit**2;Ie>=Le*2&&(se.wakeUpAfterNarrowphase=!0)}if(ae.allowSleep&&ae.type===en.DYNAMIC&&ae.sleepState===en.SLEEPING&&se.sleepState===en.AWAKE&&se.type!==en.STATIC){const Ie=se.velocity.lengthSquared()+se.angularVelocity.lengthSquared(),Le=se.sleepSpeedLimit**2;Ie>=Le*2&&(ae.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(se,ae,!0),this.collisionMatrixPrevious.get(se,ae)||(ym.body=ae,ym.contact=Y,se.dispatchEvent(ym),ym.body=se,ae.dispatchEvent(ym)),this.bodyOverlapKeeper.set(se.id,ae.id),this.shapeOverlapKeeper.set(ve.id,xe.id)}for(this.emitContactEvents(),u&&(f.makeContactConstraints=Ws.now()-m,m=Ws.now()),I=0;I!==r;I++){const Q=o[I];Q.wakeUpAfterNarrowphase&&(Q.wakeUp(),Q.wakeUpAfterNarrowphase=!1)}for(M=A.length,I=0;I!==M;I++){const Q=A[I];Q.update();for(let Y=0,se=Q.equations.length;Y!==se;Y++){const ae=Q.equations[Y];l.addEquation(ae)}}l.solve(e,this),u&&(f.solve=Ws.now()-m),l.removeAllEquations();const D=Math.pow;for(I=0;I!==r;I++){const Q=o[I];if(Q.type&g){const Y=D(1-Q.linearDamping,e),se=Q.velocity;se.scale(Y,se);const ae=Q.angularVelocity;if(ae){const ve=D(1-Q.angularDamping,e);ae.scale(ve,ae)}}}for(this.dispatchEvent(MJ),I=0;I!==r;I++){const Q=o[I];Q.preStep&&Q.preStep.call(Q)}u&&(m=Ws.now());const W=this.stepnumber%(this.quatNormalizeSkip+1)===0,J=this.quatNormalizeFast;for(I=0;I!==r;I++)o[I].integrate(e,W,J);for(this.clearForces(),this.broadphase.dirty=!0,u&&(f.integrate=Ws.now()-m),this.stepnumber+=1,this.dispatchEvent(SJ),I=0;I!==r;I++){const Q=o[I],Y=Q.postStep;Y&&Y.call(Q)}let ee=!0;if(this.allowSleep)for(ee=!1,I=0;I!==r;I++){const Q=o[I];Q.sleepTick(this.time),Q.sleepState!==en.SLEEPING&&(ee=!0)}this.hasActiveBodies=ee}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Sc,Mc),e){for(let r=0,o=Sc.length;r<o;r+=2)_m.bodyA=this.getBodyById(Sc[r]),_m.bodyB=this.getBodyById(Sc[r+1]),this.dispatchEvent(_m);_m.bodyA=_m.bodyB=null}if(t){for(let r=0,o=Mc.length;r<o;r+=2)vm.bodyA=this.getBodyById(Mc[r]),vm.bodyB=this.getBodyById(Mc[r+1]),this.dispatchEvent(vm);vm.bodyA=vm.bodyB=null}Sc.length=Mc.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(Sc,Mc),n){for(let r=0,o=Sc.length;r<o;r+=2){const l=this.getShapeById(Sc[r]),h=this.getShapeById(Sc[r+1]);Tc.shapeA=l,Tc.shapeB=h,l&&(Tc.bodyA=l.body),h&&(Tc.bodyB=h.body),this.dispatchEvent(Tc)}Tc.bodyA=Tc.bodyB=Tc.shapeA=Tc.shapeB=null}if(i){for(let r=0,o=Mc.length;r<o;r+=2){const l=this.getShapeById(Mc[r]),h=this.getShapeById(Mc[r+1]);Ic.shapeA=l,Ic.shapeB=h,l&&(Ic.bodyA=l.body),h&&(Ic.bodyB=h.body),this.dispatchEvent(Ic)}Ic.bodyA=Ic.bodyB=Ic.shapeA=Ic.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const i=e[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new go;const Xb=new Es,Ws=globalThis.performance||{};if(!Ws.now){let a=Date.now();Ws.timing&&Ws.timing.navigationStart&&(a=Ws.timing.navigationStart),Ws.now=()=>Date.now()-a}const SJ={type:"postStep"},MJ={type:"preStep"},ym={type:en.COLLIDE_EVENT_NAME,body:null,contact:null},TJ=[],IJ=[],RJ=[],PJ=[],Sc=[],Mc=[],_m={type:"beginContact",bodyA:null,bodyB:null},vm={type:"endContact",bodyA:null,bodyB:null},Tc={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Ic={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};function BJ(a,e,{color:t=65280,scale:n=1,onInit:i,onUpdate:r,autoUpdate:o}={}){const l=[],h=new Hi({color:t!=null?t:65280,wireframe:!0}),u=new re,f=new re,g=new re,m=new us,A=new mo(1),v=new zi(1,1,1),b=new Yr(10,10,10,10);function C(D){const U=new Sn,W=[];for(let ee=0;ee<D.vertices.length;ee++){const Q=D.vertices[ee];W.push(Q.x,Q.y,Q.z)}U.setAttribute("position",new tn(W,3));const J=[];for(let ee=0;ee<D.faces.length;ee++){const Q=D.faces[ee],Y=Q[0];for(let se=1;se<Q.length-1;se++){const ae=Q[se],ve=Q[se+1];J.push(Y,ae,ve)}}return U.setIndex(J),U.computeBoundingSphere(),U.computeVertexNormals(),U}function S(D){const U=new Sn,W=[],J=u,ee=f,Q=g;for(let Y=0;Y<D.indices.length/3;Y++)D.getTriangleVertices(Y,J,ee,Q),W.push(J.x,J.y,J.z),W.push(ee.x,ee.y,ee.z),W.push(Q.x,Q.y,Q.z);return U.setAttribute("position",new tn(W,3)),U.computeBoundingSphere(),U.computeVertexNormals(),U}function I(D){const U=new Sn,W=D.elementSize||1,J=D.data.flatMap((Q,Y)=>Q.flatMap((se,ae)=>[Y*W,ae*W,se])),ee=[];for(let Q=0;Q<D.data.length-1;Q++)for(let Y=0;Y<D.data[Q].length-1;Y++){const se=D.data[Q].length,ae=Q*se+Y;ee.push(ae+1,ae+se,ae+se+1),ee.push(ae+se,ae+1,ae)}return U.setIndex(ee),U.setAttribute("position",new tn(J,3)),U.computeBoundingSphere(),U.computeVertexNormals(),U}function M(D){let U=new _t;const{SPHERE:W,BOX:J,PLANE:ee,CYLINDER:Q,CONVEXPOLYHEDRON:Y,TRIMESH:se,HEIGHTFIELD:ae}=rn.types;switch(D.type){case W:{U=new _t(A,h);break}case J:{U=new _t(v,h);break}case ee:{U=new _t(b,h);break}case Q:{const ve=new ls(D.radiusTop,D.radiusBottom,D.height,D.numSegments);U=new _t(ve,h),D.geometryId=ve.id;break}case Y:{const ve=C(D);U=new _t(ve,h),D.geometryId=ve.id;break}case se:{const ve=S(D);U=new _t(ve,h),D.geometryId=ve.id;break}case ae:{const ve=I(D);U=new _t(ve,h),D.geometryId=ve.id;break}}return a.add(U),U}function R(D,U){const{SPHERE:W,BOX:J,PLANE:ee,CYLINDER:Q,CONVEXPOLYHEDRON:Y,TRIMESH:se,HEIGHTFIELD:ae}=rn.types;switch(U.type){case W:{const{radius:ve}=U;D.scale.set(ve*n,ve*n,ve*n);break}case J:{D.scale.copy(U.halfExtents),D.scale.multiplyScalar(2*n);break}case ee:break;case Q:{D.scale.set(1*n,1*n,1*n);break}case Y:{D.scale.set(1*n,1*n,1*n);break}case se:{D.scale.copy(U.scale).multiplyScalar(n);break}case ae:{D.scale.set(1*n,1*n,1*n);break}}}function T(D,U){if(!D)return!1;const{geometry:W}=D;return W instanceof mo&&U.type===rn.types.SPHERE||W instanceof zi&&U.type===rn.types.BOX||W instanceof Yr&&U.type===rn.types.PLANE||W.id===U.geometryId&&U.type===rn.types.CYLINDER||W.id===U.geometryId&&U.type===rn.types.CONVEXPOLYHEDRON||W.id===U.geometryId&&U.type===rn.types.TRIMESH||W.id===U.geometryId&&U.type===rn.types.HEIGHTFIELD}function B(D,U){let W=l[D],J=!1;return T(W,U)||(W&&a.remove(W),l[D]=W=M(U),J=!0),R(W,U),J}function F(){const D=l,U=u,W=m;let J=0;for(const ee of e)for(let Q=0;Q!==ee.shapes.length;Q++){const Y=ee.shapes[Q],se=B(J,Y),ae=D[J];ae&&(ee.quaternion.vmult(ee.shapeOffsets[Q],U),ee.position.vadd(U,U),ee.quaternion.mult(ee.shapeOrientations[Q],W),ae.position.copy(U),ae.quaternion.copy(W),se&&i instanceof Function&&i(ee,ae,Y),!se&&r instanceof Function&&r(ee,ae,Y)),J++}for(let ee=J;ee<D.length;ee++){const Q=D[ee];Q&&a.remove(Q)}D.length=J,o!==!1&&requestAnimationFrame(F)}return o!==!1&&requestAnimationFrame(F),{update:F}}const we=function(a){if(a===void 0&&(a=null),!Array.isArray(a))a=dB(a);else for(let e=0;e<a.length;e++){const t=a[e];a[e]=dB(t)}return function(e,t){Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const n=e.$serializedTypes=e.$serializedTypes||{};n[t]=a}};function dB(a){var e,t;switch((t=(e=a==null?void 0:a.prototype)==null?void 0:e.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return a}var LJ=Object.defineProperty,DJ=Object.getOwnPropertyDescriptor,$f=(a,e,t,n)=>{for(var i=n>1?void 0:n?DJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&LJ(e,t,i),i},Hy;const uu=(Hy=class extends pt{constructor(){super();x(this,"mass",1);x(this,"_isKinematic",!1);x(this,"drag",0);x(this,"angularDrag",1);x(this,"detectCollisions",!0);x(this,"sleepThreshold",.01);x(this,"_body",null);x(this,"currentVelocity");x(this,"_smoothedVelocity");x(this,"lastWorldPosition");x(this,"_ignoreChange",!1);x(this,"_dirty",!1);x(this,"_positionWatch");x(this,"_matrixWatch");x(this,"_setMatrix");this._setMatrix=new fn}set isKinematic(e){this._isKinematic=e,this._body&&(this._body.type=e?en.KINEMATIC:en.DYNAMIC)}get isKinematic(){return this._isKinematic}get body(){return this._body===null&&this.initialize(),this._body}awake(){this._body=null,this.currentVelocity=new q,this._smoothedVelocity=new q,this.lastWorldPosition=ni(this.gameObject).clone(),this._matrixWatch=void 0,this._positionWatch=void 0}onEnable(){this._body?this.context.physics.addBody(this.gameObject,this._body):this.initialize(),this.body&&(this.body.wakeUp(),this.gameObject.updateWorldMatrix(!0,!1),this.setBodyFromGameObject()),this._positionWatch||(this._positionWatch=new Rv(this.gameObject.position,["x","y","z"])),this._positionWatch.subscribeWrite(e=>{!this.context.physics.isUpdating&&!this._ignoreChange&&(this._dirty=!0,this._setMatrix.copy(this.gameObject.matrix),this._setMatrix.setPosition(this.gameObject.position))})}onDisable(){this._body&&this.context.physics.removeBody(this.gameObject,this._body,!1)}onDestroy(){this._body&&this.context.physics.removeBody(this.gameObject,this._body)}onBeforeRender(){this._ignoreChange=!0,this.updateVelocity(),this._dirty&&(this._dirty=!1,this._setMatrix.decompose(this.gameObject.position,this.gameObject.quaternion,this.gameObject.scale),this.setBodyFromGameObject()),this._ignoreChange=!1}initialize(){if(this._body)return;const e=new NJ;e.drag=this.drag,e.angularDrag=this.angularDrag,e.mass=this.mass,e.kinematic=this.isKinematic,e.physicsEvents=this.detectCollisions,e.sleepThreshold=this.sleepThreshold,this._body=this.context.physics.createBody(this.gameObject,e)}wakeUp(){var e;(e=this.body)==null||e.wakeUp()}applyForce(e,t){var i;const n=new re(e.x,e.y,e.z);n.scale(1/this.context.time.deltaTime,n),(i=this.body)==null||i.applyForce(n,t?new re(t.x,t.y,t.z):void 0)}setForce(e,t,n){var i;(i=this.body)==null||i.force.set(e,t,n)}getVelocity(){var e,t,n;return this.body?uu.tempPosition.set((e=this.body)==null?void 0:e.velocity.x,(t=this.body)==null?void 0:t.velocity.y,(n=this.body)==null?void 0:n.velocity.z):uu.tempPosition.set(0,0,0)}setVelocity(e,t,n){if(!!this.body){if(e instanceof q){const i=e;e=i.x,t=i.y,n=i.z}this.body.velocity.x=e/this.context.time.deltaTime,this.body.velocity.y=t/this.context.time.deltaTime,this.body.velocity.z=n/this.context.time.deltaTime}}getTorque(){var e,t,n;return this.body?uu.tempPosition.set((e=this.body)==null?void 0:e.torque.x,(t=this.body)==null?void 0:t.torque.y,(n=this.body)==null?void 0:n.torque.z):uu.tempPosition.set(0,0,0)}setTorque(e,t,n){if(!!this.body){if(e instanceof q){const i=e;e=i.x,t=i.y,n=i.z}this.body.torque.x=e/this.context.time.deltaTime,this.body.torque.y=t/this.context.time.deltaTime,this.body.torque.z=n/this.context.time.deltaTime}}get smoothedVelocity(){return this._smoothedVelocity}setAngularVelocity(e,t,n){!this.body||(this.body.angularVelocity.x=e/this.context.time.deltaTime,this.body.angularVelocity.y=t/this.context.time.deltaTime,this.body.angularVelocity.z=n/this.context.time.deltaTime)}setBodyFromGameObject(e=null){if(this.body&&this.gameObject&&!this.destroyed){this._ignoreChange=!0;const t=this.worldPosition;this.body.position.set(t.x,t.y,t.z);const n=this.worldQuaternion;if(this.body.quaternion.set(n.x,n.y,n.z,n.w),e){uu.copyVector3.set(e.x,e.y,e.z),this._smoothedVelocity.lerp(uu.copyVector3,this.context.time.deltaTime/.1);const i=this._smoothedVelocity;this.body.velocity.x=i.x,this.body.velocity.y=i.y,this.body.velocity.z=i.z}this._ignoreChange=!1}}updateVelocity(){if(!!this.currentVelocity&&this.body&&this.gameObject){const e=ni(this.gameObject);this.currentVelocity.subVectors(e,this.lastWorldPosition),this.lastWorldPosition.copy(e),this._smoothedVelocity.lerp(this.currentVelocity,this.context.time.deltaTime/.1)}}},x(Hy,"tempPosition",new q),x(Hy,"copyVector3",new q),Hy);let yr=uu;$f([we()],yr.prototype,"mass",2);$f([we()],yr.prototype,"isKinematic",1);$f([we()],yr.prototype,"drag",2);$f([we()],yr.prototype,"angularDrag",2);$f([we()],yr.prototype,"detectCollisions",2);$f([we()],yr.prototype,"sleepThreshold",2);var OJ=Object.defineProperty,FJ=Object.getOwnPropertyDescriptor,ep=(a,e,t,n)=>{for(var i=n>1?void 0:n?FJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&OJ(e,t,i),i};class uh extends pt{constructor(){super(...arguments);x(this,"attachedRigidbody",null);x(this,"isTrigger",!1);x(this,"_shape",null)}awake(){super.awake(),this._shape=null}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(yr))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(yr))}onDisable(){this._shape}}ep([we(yr)],uh.prototype,"attachedRigidbody",2);ep([we()],uh.prototype,"isTrigger",2);class Ov extends uh{constructor(){super(...arguments);x(this,"radius",.5);x(this,"center",new q(0,0,0))}onEnable(){super.onEnable(),this._shape||(this._shape=this.context.physics.addSphereCollider(this.gameObject,this.center,this.radius,this.attachedRigidbody))}}ep([we()],Ov.prototype,"radius",2);ep([we(q)],Ov.prototype,"center",2);class Fv extends uh{constructor(){super(...arguments);x(this,"size",new q(1,1,1));x(this,"center",new q(0,0,0))}onEnable(){super.onEnable(),this._shape||(this._shape=this.context.physics.addBoxCollider(this.gameObject,this.isTrigger,this.center,this.size,this.attachedRigidbody))}}ep([we(q)],Fv.prototype,"size",2);ep([we(q)],Fv.prototype,"center",2);const xm=Ct("debugphysics"),kJ=Ct("debugcollisions");class NJ{constructor(){x(this,"mass",1);x(this,"kinematic",!1);x(this,"physicsEvents",!1);x(this,"drag",0);x(this,"angularDrag",.05);x(this,"sleepThreshold",.01)}}const F_=Symbol("object");class Yb{constructor(e,t){x(this,"obj");x(this,"parent");x(this,"body");x(this,"shapes",[]);x(this,"collisonCallback",null);x(this,"_hasRigidbody",!1);x(this,"_didSleepLastStep",!1);this.obj=e,this.parent=e.parent,this.body=t,this.body&&(this.body[F_]=e)}}class nc{constructor(){x(this,"ray");x(this,"cam");x(this,"screenPoint");x(this,"raycaster");x(this,"results");x(this,"targets");x(this,"recursive",!0);x(this,"minDistance");x(this,"maxDistance");x(this,"lineThreshold");x(this,"layerMask");x(this,"ignore")}screenPointFromOffset(e,t){this.screenPoint===void 0&&(this.screenPoint=new Xe),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setMask(e){this.layerMask||(this.layerMask=new Ka);const t=this.layerMask;t?t.mask=e:this.layerMask=e}}x(nc,"AllLayers",4294967295);class UJ{constructor(e,t,n){x(this,"distance");x(this,"point");x(this,"object");this.object=e,this.distance=t,this.point=n}}class zJ{constructor(e){x(this,"raycaster",new ju);x(this,"defaultRaycastOptions",new nc);x(this,"targetBuffer",new Array(1));x(this,"defaultThresholds",{Mesh:{},Line:{threshold:0},LOD:{},Points:{threshold:0},Sprite:{}});x(this,"sphereResults",new Array);x(this,"sphereMask",new Ka);x(this,"tempBoundingBox",new Rr);x(this,"_isUpdatingPhysicsWorld",!1);x(this,"context");x(this,"world",new EJ);x(this,"objects",[]);x(this,"tempPosition",new q);x(this,"tempQuaternion",new kt);x(this,"tempMat1",new fn);x(this,"tempMat2",new fn);x(this,"temp",new q);x(this,"tempQuat",new kt);if(this.context=e,this.world.gravity.set(0,-9.82,0),xm){const t={};t.onInit=(n,i,r)=>{i.layers.set(-1)},BJ(e.scene,this.world.bodies,t)}this.world.addEventListener("beginContact",this.onBeginContact.bind(this)),this.world.addEventListener("endContact",this.onEndContact.bind(this))}sphereOverlap(e,t){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const n=new ec(e,t),i=this.sphereMask;i.enableAll(),i.disable(2);for(const r of this.context.scene.children){const o=this.onSphereOverlap(r,n,i);o&&this.sphereResults.push(o)}return this.sphereResults.sort((r,o)=>r.distance-o.distance)}onSphereOverlap(e,t,n){if(e.type==="Mesh"){if(!e.layers.test(n))return null;const i=e,r=i.geometry;if(r.boundingBox||r.computeBoundingBox(),!r.boundingBox)return null;i.matrixWorldNeedsUpdate&&i.updateMatrixWorld();const o=this.tempBoundingBox.copy(r.boundingBox).applyMatrix4(i.matrixWorld);if(t.intersectsBox(o)){const h=ni(e).distanceTo(t.center);return new UJ(e,h,t.center.clone())}}else if(e.children)for(const i of e.children){const r=this.onSphereOverlap(i,t,n);if(r)return r}return null}raycastFromRay(e,t=null){const n=t!=null?t:this.defaultRaycastOptions;return n.ray=e,this.raycast(n)}raycast(e=null){var l,h,u,f,g,m;e||(e=this.defaultRaycastOptions);const t=(l=e.screenPoint)!=null?l:this.context.input.mousePositionRC,n=(h=e.raycaster)!=null?h:this.raycaster;if(n.near=(u=e.minDistance)!=null?u:0,n.far=(f=e.maxDistance)!=null?f:1/0,n.params=this.defaultThresholds,e.lineThreshold?n.params.Line={threshold:e.lineThreshold}:n.params.Line={threshold:0},e.ray)n.ray.copy(e.ray);else{const A=(g=e.cam)!=null?g:this.context.mainCamera;if(!A)return console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),(m=this.defaultRaycastOptions.results)!=null?m:[];n.setFromCamera(t,A)}let i=e.targets;i||(i=this.targetBuffer,i[0]=this.context.scene);let r=e.results;r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),e.layerMask!==void 0?e.layerMask instanceof Ka?n.layers.mask=e.layerMask.mask:n.layers.mask=e.layerMask:(n.layers.enableAll(),n.layers.disable(2)),r.length=0,n.intersectObjects(i,e.recursive,r);const o=e.ignore;return o!==void 0&&o.length>0&&(r=r.filter(A=>!o.includes(A.object))),r}get isUpdating(){return this._isUpdatingPhysicsWorld}addPreStepListener(e){this.world.addEventListener("preStep",e)}addPostStepListener(e){this.world.addEventListener("postStep",e)}addConstraint(e){this.world.addConstraint(e)}setGravity(e){this.world.gravity.set(e.x,e.y,e.z)}multiplyGravity(e){this.world.gravity.x*=e.x,this.world.gravity.y*=e.y,this.world.gravity.z*=e.z}addBody(e,t){for(let n=0;n<this.objects.length;n++){const i=this.objects[n];if(i.obj===e){i._hasRigidbody=!0;break}}t.shapes.length>0&&this.world.addBody(t)}removeBody(e,t,n=!0){this.world.removeBody(t);for(let i=0;i<this.objects.length;i++){const r=this.objects[i];if(r.obj===e){r._hasRigidbody=!1,n&&this.objects.splice(i,1);break}}}removeShape(e,t){for(const n of this.objects)if(n.obj===e){n.body&&(n.body.removeShape(t),n.body.updateMassProperties());return}}createBody(e,t){const n=this.internalCreateBody(e,null);t.mass&&(n.mass=t.mass),t.kinematic?n.type=en.KINEMATIC:n.type=en.DYNAMIC,t.drag&&(n.linearDamping=t.drag),t.angularDrag&&(n.angularDamping=t.angularDrag),t.sleepThreshold&&(n.sleepSpeedLimit=t.sleepThreshold),n.shapes.length>0&&this.world.addBody(n);const i=new Yb(e,n);return i._hasRigidbody=!0,this.objects.push(i),xm&&console.log("created new body",e.name,n,n.sleepState,this.world.gravity),t.physicsEvents&&this.registerCollisionEvents(i),n}addBoxCollider(e,t,n,i,r){const o=this.tempPosition;e.getWorldScale(o);const l=new re(.5*o.x*i.x,.5*o.y*i.y,.5*o.z*i.z),h=new Bv(l);h.collisionResponse=!t,n=n.clone(),n.multiply(o);const u=this.addShape(e,h,n,r);if(u!==null){if(this.world.addBody(u),this.isAlreadyRegistered(u))return h;const f=new Yb(e,u);this.objects.push(f)}return h}addSphereCollider(e,t,n,i){const r=this.tempPosition;e.getWorldScale(r);const o=Math.max(r.x,r.y,r.z),l=new aY(n*o);t=t.clone(),t.multiply(r);const h=this.addShape(e,l,t,i);if(h!==null){if(this.world.addBody(h),this.isAlreadyRegistered(h))return l;const u=new Yb(e,h);this.objects.push(u)}return l}addMeshCollider(e){xm&&console.warn("TODO mesh collider not yet supported")}isAlreadyRegistered(e){for(const t of this.objects)if(t.body===e)return!0;return!1}addShape(e,t,n,i){let r=null;if(i?(i.initialize(),console.assert(!!i.body,"rigidbody didn't initialize / produce a physics body",i),r=i.body):(r=this.internalCreateBody(e,null),r.type=en.KINEMATIC),r){n.x*=-1;let o=e.position,l=e.quaternion;if(i&&i.gameObject!==e)this.tempMat1.copy(e.matrixWorld),this.tempMat2.copy(i.gameObject.matrixWorld).invert(),this.tempMat1.premultiply(this.tempMat2),this.tempMat1.decompose(o,l,this.tempPosition);else{o=ni(e);const f=r.position;o.x-=f.x,o.y-=f.y,o.z-=f.z,l=ga(e);const g=new kt(r.quaternion.x,r.quaternion.y,r.quaternion.z,r.quaternion.w);l.multiply(g.invert())}o.add(n);const h=new re(o.x,o.y,o.z),u=new us(l.x,l.y,l.z,l.w);r.addShape(t,h,u),r.updateMassProperties(),this.world.addBody(r)}return r}step(e){this._isUpdatingPhysicsWorld=!0,e=Math.min(e,1/30),this.world.step(e),this._isUpdatingPhysicsWorld=!1,xm&&this.context.time.frameCount%60}postStep(){this._isUpdatingPhysicsWorld=!0;for(let e=0;e<this.objects.length;e++){const t=this.objects[e],n=t.body;if(!n||!n.world)continue;n.sleepTick(this.context.time.time),xm&&(!t._didSleepLastStep&&n.sleepState===en.SLEEPING?console.log("BODY SLEEPING",n):t._didSleepLastStep&&n.sleepState!==en.SLEEPING&&console.log("BODY WOKE UP",n)),t._didSleepLastStep=n.sleepState===en.SLEEPING;const i=t.obj;if(n.type===en.KINEMATIC){const r=ni(i,this.temp);n.position.set(r.x,r.y,r.z);const o=ga(i,this.tempQuat);n.quaternion.set(o.x,o.y,o.z,o.w);continue}if(t.parent&&i.parent===t.parent){r9(i,n.quaternion.x,n.quaternion.y,n.quaternion.z,n.quaternion.w);const r=n.position;$S(i,r.x,r.y,r.z),n.velocity.length()>n.sleepSpeedLimit&&Pr.markDirty(i)}}this._isUpdatingPhysicsWorld=!1}internalCreateBody(e,t){const n=new en;n._owner=e,n._name=e.name,e.getWorldPosition(this.tempPosition);const i=this.tempPosition;n.position=new re(i.x,i.y,i.z);const r=this.tempQuaternion;return e.getWorldQuaternion(r),n.quaternion=new us(r.x,r.y,r.z,r.w),n.type=en.KINEMATIC,t&&(n.addShape(t),n.updateMassProperties()),n}registerCollisionEvents(e){if(e.collisonCallback&&this.unregisterCollisionEvents(e),!e.body)return;const t=n=>this.raiseCollisionEvents(e.obj,n);e.collisonCallback=t.bind(this),e.body.addEventListener("collide",e.collisonCallback)}unregisterCollisionEvents(e){!e.collisonCallback||!e.body||e.body.removeEventListener("collide",e.collisonCallback)}onBeginContact(e){}raiseCollisionEvents(e,t){const n=new fB(e,t);if(kJ&&console.log("collision between",t.contact.bi,t.contact.bj,e,t),Ee.foreachComponent(e,i=>{i.__internalHandleCollision(n,!1)}),n.collider&&!n.collider.attachedRigidbody&&n.collider.isTrigger){const i=new fB(n.gameObject,t,!0);Ee.foreachComponent(n.gameObject,r=>{r.__internalHandleCollision(i,!0)})}}onEndContact(e){const t=e.bodyA[F_],n=e.bodyB[F_];Ee.foreachComponent(n,r=>{r.__internalHandleExitCollisionEvent(t,!1)});const i=Ee.getComponent(t,uh);i&&!i.attachedRigidbody&&i.isTrigger&&Ee.foreachComponent(i.gameObject,r=>{r.__internalHandleExitCollisionEvent(n,!0)})}}class fB{constructor(e,t,n=!1){x(this,"invert");x(this,"collision");x(this,"targetBody");x(this,"me");x(this,"_normal");x(this,"_collider");this.invert=n,this.me=e,this.collision=t,this.targetBody=this.invert?t.target:t.body}get __internalCollision(){return this.collision}get __internalInvertedSourceReceiver(){return this.invert}get normal(){if(!this._normal){const e=this.collision.contact.ni;this._normal=new q(e.x,e.y,e.z)}return this._normal}get collider(){return this._collider===void 0&&(this._collider=Ee.getComponentInChildren(this.gameObject,uh)),this._collider}get gameObject(){return this.targetBody[F_]}}class GJ{constructor(){x(this,"deltaTime",0);x(this,"time",0);x(this,"frame",0);x(this,"clock",new Sv);x(this,"_smoothedFps",0);x(this,"_fpsSamples",[]);x(this,"_fpsSampleIndex",0)}get realtimeSinceStartup(){return this.clock.elapsedTime}get frameCount(){return this.frame}get smoothedFps(){return this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<30?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%30]=this.deltaTime;let e=0;for(let t=0;t<this._fpsSamples.length;t++)e+=this._fpsSamples[t];this._smoothedFps=1/(e/this._fpsSamples.length)}}var Om=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function HJ(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var TO={},IO={};Object.defineProperty(IO,"__esModule",{value:!0});var kv={};Object.defineProperty(kv,"__esModule",{value:!0});kv.ConstantBackoff=void 0;var VJ=function(){function a(e){this.reset=function(){},this.backoff=e}return a.prototype.next=function(){return this.backoff},a}();kv.ConstantBackoff=VJ;var Nv={};Object.defineProperty(Nv,"__esModule",{value:!0});Nv.ExponentialBackoff=void 0;var WJ=function(){function a(e,t){this.initial=e,this.expMax=t,this.expCurrent=1,this.current=this.initial}return a.prototype.next=function(){var e=this.current;return this.expMax>this.expCurrent++&&(this.current=this.current*2),e},a.prototype.reset=function(){this.expCurrent=1,this.current=this.initial},a}();Nv.ExponentialBackoff=WJ;var Uv={};Object.defineProperty(Uv,"__esModule",{value:!0});Uv.LinearBackoff=void 0;var QJ=function(){function a(e,t,n){this.initial=e,this.increment=t,this.maximum=n,this.current=this.initial}return a.prototype.next=function(){var e=this.current,t=this.current+this.increment;return this.maximum===void 0?this.current=t:t<=this.maximum&&(this.current=t),e},a.prototype.reset=function(){this.current=this.initial},a}();Uv.LinearBackoff=QJ;var RO={};Object.defineProperty(RO,"__esModule",{value:!0});var zv={};Object.defineProperty(zv,"__esModule",{value:!0});zv.LRUBuffer=void 0;var jJ=function(){function a(e){this.writePtr=0,this.wrapped=!1,this.buffer=Array(e)}return a.prototype.len=function(){return this.wrapped?this.buffer.length:this.writePtr},a.prototype.cap=function(){return this.buffer.length},a.prototype.read=function(e){if(e==null||e.length===0||this.buffer.length===0||this.writePtr===0&&!this.wrapped)return 0;for(var t=this.wrapped?this.writePtr:0,n=t-1<0?this.buffer.length-1:t-1,i=0;i<e.length;i++){var r=(t+i)%this.buffer.length;if(e[i]=this.buffer[r],r===n)return i+1}return e.length},a.prototype.write=function(e){if(e==null||e.length===0||this.buffer.length===0)return 0;for(var t=e.length>this.buffer.length?e.length-this.buffer.length:0,n=0;n<e.length-t;n++)this.buffer[this.writePtr]=e[t+n],this.writePtr=(this.writePtr+1)%this.buffer.length,this.writePtr===0&&(this.wrapped=!0);return e.length},a.prototype.forEach=function(e){if(this.writePtr===0&&!this.wrapped)return 0;for(var t=this.wrapped?this.writePtr:0,n=this.wrapped?t-1<0?this.buffer.length-1:t-1:this.writePtr-1,i=this.len();e(this.buffer[t]),t!==n;)t=(t+1)%this.buffer.length;return i},a.prototype.clear=function(){this.writePtr=0,this.wrapped=!1},a}();zv.LRUBuffer=jJ;var Gv={};Object.defineProperty(Gv,"__esModule",{value:!0});Gv.TimeBuffer=void 0;var qJ=function(){function a(e){this.maxAge=e}return a.prototype.cap=function(){return Number.POSITIVE_INFINITY},a.prototype.len=function(){this.forwardTail();for(var e=this.tail,t=0;e!==void 0;)t++,e=e.n;return t},a.prototype.read=function(e){if(this.forwardTail(),e.length===0)return 0;for(var t=this.tail,n=0;t!==void 0&&(e[n++]=t.e,n!==e.length);)t=t.n;return n},a.prototype.write=function(e){for(var t=0;t<e.length;t++)this.putElement(e[t]);return e.length},a.prototype.forEach=function(e){this.forwardTail();for(var t=this.tail,n=0;t!==void 0;)e(t.e),n++,t=t.n;return n},a.prototype.putElement=function(e){var t={e,t:Date.now(),n:void 0};this.tail===void 0&&(this.tail=t),this.head===void 0?this.head=t:(this.head.n=t,this.head=t)},a.prototype.forwardTail=function(){if(this.tail!==void 0)for(var e=Date.now();e-this.tail.t>this.maxAge&&(this.tail===this.head?(this.tail=void 0,this.head=void 0):this.tail=this.tail.n,this.tail!==void 0););},a.prototype.clear=function(){},a}();Gv.TimeBuffer=qJ;var oM={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Websocket=a.WebsocketEvents=void 0;var e;(function(n){n.open="open",n.close="close",n.error="error",n.message="message",n.retry="retry"})(e=a.WebsocketEvents||(a.WebsocketEvents={}));var t=function(){function n(i,r,o,l){var h=this;this.eventListeners={open:[],close:[],error:[],message:[],retry:[]},this.closedByUser=!1,this.retries=0,this.handleOpenEvent=function(u){return h.handleEvent(e.open,u)},this.handleCloseEvent=function(u){return h.handleEvent(e.close,u)},this.handleErrorEvent=function(u){return h.handleEvent(e.error,u)},this.handleMessageEvent=function(u){return h.handleEvent(e.message,u)},this.url=i,this.protocols=r,this.buffer=o,this.backoff=l,this.tryConnect()}return Object.defineProperty(n.prototype,"underlyingWebsocket",{get:function(){return this.websocket},enumerable:!1,configurable:!0}),n.prototype.send=function(i){var r;this.closedByUser||(this.websocket===void 0||this.websocket.readyState!==this.websocket.OPEN?(r=this.buffer)===null||r===void 0||r.write([i]):this.websocket.send(i))},n.prototype.close=function(i,r){var o;this.closedByUser=!0,(o=this.websocket)===null||o===void 0||o.close(i,r)},n.prototype.addEventListener=function(i,r,o){var l={listener:r,options:o},h=this.eventListeners[i];h.push(l)},n.prototype.removeEventListener=function(i,r,o){this.eventListeners[i]=this.eventListeners[i].filter(function(l){return l.listener!==r&&(l.options===void 0||l.options!==o)})},n.prototype.dispatchEvent=function(i,r){var o=this,l=this.eventListeners[i],h=[];l.forEach(function(u){u.listener(o,r),u.options!==void 0&&u.options.once&&h.push(u)}),h.forEach(function(u){return o.removeEventListener(i,u.listener,u.options)})},n.prototype.tryConnect=function(){this.websocket!==void 0&&(this.websocket.removeEventListener(e.open,this.handleOpenEvent),this.websocket.removeEventListener(e.close,this.handleCloseEvent),this.websocket.removeEventListener(e.error,this.handleErrorEvent),this.websocket.removeEventListener(e.message,this.handleMessageEvent),this.websocket.close()),this.websocket=new WebSocket(this.url,this.protocols),this.websocket.addEventListener(e.open,this.handleOpenEvent),this.websocket.addEventListener(e.close,this.handleCloseEvent),this.websocket.addEventListener(e.error,this.handleErrorEvent),this.websocket.addEventListener(e.message,this.handleMessageEvent)},n.prototype.handleEvent=function(i,r){var o,l,h;switch(i){case e.close:this.closedByUser||this.reconnect();break;case e.open:this.retries=0,(o=this.backoff)===null||o===void 0||o.reset(),(l=this.buffer)===null||l===void 0||l.forEach(this.send.bind(this)),(h=this.buffer)===null||h===void 0||h.clear();break}this.dispatchEvent(i,r)},n.prototype.reconnect=function(){var i=this;if(this.backoff!==void 0){var r=this.backoff.next();setTimeout(function(){i.dispatchEvent(e.retry,new CustomEvent(e.retry,{detail:{retries:++i.retries,backoff:r}})),i.tryConnect()},r)}},n}();a.Websocket=t})(oM);var Hv={};Object.defineProperty(Hv,"__esModule",{value:!0});Hv.WebsocketBuilder=void 0;var nf=oM,XJ=function(){function a(e){this.ws=null,this.onOpenListeners=[],this.onCloseListeners=[],this.onErrorListeners=[],this.onMessageListeners=[],this.onRetryListeners=[],this.url=e}return a.prototype.withProtocols=function(e){return this.protocols=e,this},a.prototype.withBackoff=function(e){return this.backoff=e,this},a.prototype.withBuffer=function(e){return this.buffer=e,this},a.prototype.onOpen=function(e,t){return this.onOpenListeners.push({listener:e,options:t}),this},a.prototype.onClose=function(e,t){return this.onCloseListeners.push({listener:e,options:t}),this},a.prototype.onError=function(e,t){return this.onErrorListeners.push({listener:e,options:t}),this},a.prototype.onMessage=function(e,t){return this.onMessageListeners.push({listener:e,options:t}),this},a.prototype.onRetry=function(e,t){return this.onRetryListeners.push({listener:e,options:t}),this},a.prototype.build=function(){var e=this;return this.ws!==null?this.ws:(this.ws=new nf.Websocket(this.url,this.protocols,this.buffer,this.backoff),this.onOpenListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(nf.WebsocketEvents.open,t.listener,t.options)}),this.onCloseListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(nf.WebsocketEvents.close,t.listener,t.options)}),this.onErrorListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(nf.WebsocketEvents.error,t.listener,t.options)}),this.onMessageListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(nf.WebsocketEvents.message,t.listener,t.options)}),this.onRetryListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(nf.WebsocketEvents.retry,t.listener,t.options)}),this.ws)},a}();Hv.WebsocketBuilder=XJ;(function(a){var e=Om&&Om.__createBinding||(Object.create?function(n,i,r,o){o===void 0&&(o=r),Object.defineProperty(n,o,{enumerable:!0,get:function(){return i[r]}})}:function(n,i,r,o){o===void 0&&(o=r),n[o]=i[r]}),t=Om&&Om.__exportStar||function(n,i){for(var r in n)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&e(i,n,r)};Object.defineProperty(a,"__esModule",{value:!0}),t(IO,a),t(kv,a),t(Nv,a),t(Uv,a),t(RO,a),t(zv,a),t(Gv,a),t(oM,a),t(Hv,a)})(TO);function PO(a=window.location.hostname){return new RegExp("[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}|localhost","gm").test(a)===!0}class Hu extends pt{constructor(){super(...arguments);x(this,"url",null);x(this,"urlParameterName",null);x(this,"localhost",null)}getWebsocketUrl(){let t=this.url?Hu.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const o=Ct(this.urlParameterName);o&&typeof o=="string"&&(t=o)}if(!t)return null;const i=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(t);return i!=null&&i.groups?(i==null?void 0:i.groups.socket_prefix)?t:"wss://"+(i==null?void 0:i.groups.url):null}static GetUrl(t,n){let i=t;const r=Hu.IsLocalNetwork()&&n;return r&&(i=n),t!=null&&t.startsWith("/")&&(i=(r?i:window.location.origin)+t),i}static IsLocalNetwork(t=window.location.hostname){return PO(t)}}const Jb=2,Ga=4,Fc=4,Vv=4,kl=new Int32Array(2),pB=new Float32Array(kl.buffer),mB=new Float64Array(kl.buffer),Ry=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class Ya{constructor(e,t){this.low=e|0,this.high=t|0}static create(e,t){return e==0&&t==0?Ya.ZERO:new Ya(e,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}Ya.ZERO=new Ya(0,0);var AE;(function(a){a[a.UTF8_BYTES=1]="UTF8_BYTES",a[a.UTF16_STRING=2]="UTF16_STRING"})(AE||(AE={}));class gg{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new gg(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new Ya(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new Ya(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return kl[0]=this.readInt32(e),pB[0]}readFloat64(e){return kl[Ry?0:1]=this.readInt32(e),kl[Ry?1:0]=this.readInt32(e+4),mB[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)}writeUint64(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)}writeFloat32(e,t){pB[0]=t,this.writeInt32(e,kl[0])}writeFloat64(e,t){mB[0]=t,this.writeInt32(e,kl[Ry?0:1]),this.writeInt32(e+4,kl[Ry?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Ga+Fc)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Fc;t++)e+=String.fromCharCode(this.readInt8(this.position_+Ga+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);let i="",r=0;if(e+=Ga,t===AE.UTF8_BYTES)return this.bytes_.subarray(e,e+n);for(;r<n;){let o;const l=this.readUint8(e+r++);if(l<192)o=l;else{const h=this.readUint8(e+r++);if(l<224)o=(l&31)<<6|h&63;else{const u=this.readUint8(e+r++);if(l<240)o=(l&15)<<12|(h&63)<<6|u&63;else{const f=this.readUint8(e+r++);o=(l&7)<<18|(h&63)<<12|(u&63)<<6|f&63}}}o<65536?i+=String.fromCharCode(o):(o-=65536,i+=String.fromCharCode((o>>10)+55296,(o&(1<<10)-1)+56320))}return i}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Ga}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Fc)throw new Error("FlatBuffers: file identifier must be length "+Fc);for(let t=0;t<Fc;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Ga+t))return!1;return!0}createLong(e,t){return Ya.create(e,t)}createScalarList(e,t){const n=[];for(let i=0;i<t;++i)e(i)!==null&&n.push(e(i));return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const r=e(i);r!==null&&n.push(r.unpack())}return n}}class tp{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;e?t=e:t=1024,this.bb=gg.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const n=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<n+e+t;){const i=this.bb.capacity();this.bb=tp.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(n)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,n){(this.force_defaults||t!=n)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,n){(this.force_defaults||t!=n)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,n){(this.force_defaults||t!=n)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,n){(this.force_defaults||!t.equals(n))&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,n){(this.force_defaults||t!=n)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,n){t!=n&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=t<<1,i=gg.allocate(n);return i.setPosition(n-t),i.bytes().set(e.bytes(),n-t),i}addOffset(e){this.prep(Ga,0),this.writeInt32(this.offset()-e+Ga)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const n=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const i=2;this.addInt16(e-this.object_start);const r=(n+i)*Jb;this.addInt16(r);let o=0;const l=this.space;e:for(t=0;t<this.vtables.length;t++){const h=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(h)){for(let u=Jb;u<r;u+=Jb)if(this.bb.readInt16(l+u)!=this.bb.readInt16(h+u))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,n){const i=n?Vv:0;if(t){const r=t;if(this.prep(this.minalign,Ga+Fc+i),r.length!=Fc)throw new Error("FlatBuffers: file identifier must be length "+Fc);for(let o=Fc-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,Ga+i),this.addOffset(e),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const n=this.bb.capacity()-e,i=n-this.bb.readInt32(n);if(!(this.bb.readInt16(i+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,n){this.notNested(),this.vector_num_elems=t,this.prep(Ga,e*t),this.prep(n,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(!e)return 0;let t;if(e instanceof Uint8Array)t=e;else{t=[];let n=0;for(;n<e.length;){let i;const r=e.charCodeAt(n++);if(r<55296||r>=56320)i=r;else{const o=e.charCodeAt(n++);i=(r<<10)+o+(65536-(55296<<10)-56320)}i<128?t.push(i):(i<2048?t.push(i>>6&31|192):(i<65536?t.push(i>>12&15|224):t.push(i>>18&7|240,i>>12&63|128),t.push(i>>6&63|128)),t.push(i&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let n=0,i=this.space,r=this.bb.bytes();n<t.length;n++)r[i++]=t[n];return this.endVector()}createLong(e,t){return Ya.create(e,t)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let n=0;n<e.length;++n){const i=e[n];if(i!==null)t.push(this.createObjectOffset(i));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const BO={};function aM(a,e){BO[a]=e}function YJ(a){const e=a.getBufferIdentifier(),t=BO[e];return t(a)}function JJ(a){return typeof a.guid=="function"?a.guid():null}function yE(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var LO={exports:{}};(function(a,e){parcelRequire=function(t,n,i,r){var o,l=typeof parcelRequire=="function"&&parcelRequire,h=typeof yE=="function"&&yE;function u(m,A){if(!n[m]){if(!t[m]){var v=typeof parcelRequire=="function"&&parcelRequire;if(!A&&v)return v(m,!0);if(l)return l(m,!0);if(h&&typeof m=="string")return h(m);var b=new Error("Cannot find module '"+m+"'");throw b.code="MODULE_NOT_FOUND",b}S.resolve=function(I){return t[m][1][I]||I},S.cache={};var C=n[m]=new u.Module(m);t[m][0].call(C.exports,S,C,C.exports,this)}return n[m].exports;function S(I){return u(S.resolve(I))}}u.isParcelRequire=!0,u.Module=function(m){this.id=m,this.bundle=u,this.exports={}},u.modules=t,u.cache=n,u.parent=l,u.register=function(m,A){t[m]=[function(v,b){b.exports=A},{}]};for(var f=0;f<i.length;f++)try{u(i[f])}catch(m){o||(o=m)}if(i.length){var g=u(i[i.length-1]);a.exports=g}if(parcelRequire=u,o)throw o;return u}({EgBh:[function(t,n,i){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=r;var o=n.exports.BlobBuilder;function l(){this._pieces=[],this._parts=[]}typeof window<"u"&&(o=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),l.prototype.append=function(h){typeof h=="number"?this._pieces.push(h):(this.flush(),this._parts.push(h))},l.prototype.flush=function(){if(this._pieces.length>0){var h=new Uint8Array(this._pieces);r.useArrayBufferView||(h=h.buffer),this._parts.push(h),this._pieces=[]}},l.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var h=new o,u=0,f=this._parts.length;u<f;u++)h.append(this._parts[u]);return h.getBlob()}return new Blob(this._parts)},n.exports.BufferBuilder=l},{}],kdPp:[function(t,n,i){var r=t("./bufferbuilder").BufferBuilder,o=t("./bufferbuilder").binaryFeatures,l={unpack:function(m){return new h(m).unpack()},pack:function(m){var A=new u;return A.pack(m),A.getBuffer()}};function h(m){this.index=0,this.dataBuffer=m,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function u(){this.bufferBuilder=new r}function f(m){var A=m.charCodeAt(0);return A<=2047?"00":A<=65535?"000":A<=2097151?"0000":A<=67108863?"00000":"000000"}function g(m){return m.length>600?new Blob([m]).size:m.replace(/[^\u0000-\u007F]/g,f).length}n.exports=l,h.prototype.unpack=function(){var m,A=this.unpack_uint8();if(A<128)return A;if((224^A)<32)return(224^A)-32;if((m=160^A)<=15)return this.unpack_raw(m);if((m=176^A)<=15)return this.unpack_string(m);if((m=144^A)<=15)return this.unpack_array(m);if((m=128^A)<=15)return this.unpack_map(m);switch(A){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return m=this.unpack_uint16(),this.unpack_string(m);case 217:return m=this.unpack_uint32(),this.unpack_string(m);case 218:return m=this.unpack_uint16(),this.unpack_raw(m);case 219:return m=this.unpack_uint32(),this.unpack_raw(m);case 220:return m=this.unpack_uint16(),this.unpack_array(m);case 221:return m=this.unpack_uint32(),this.unpack_array(m);case 222:return m=this.unpack_uint16(),this.unpack_map(m);case 223:return m=this.unpack_uint32(),this.unpack_map(m)}},h.prototype.unpack_uint8=function(){var m=255&this.dataView[this.index];return this.index++,m},h.prototype.unpack_uint16=function(){var m=this.read(2),A=256*(255&m[0])+(255&m[1]);return this.index+=2,A},h.prototype.unpack_uint32=function(){var m=this.read(4),A=256*(256*(256*m[0]+m[1])+m[2])+m[3];return this.index+=4,A},h.prototype.unpack_uint64=function(){var m=this.read(8),A=256*(256*(256*(256*(256*(256*(256*m[0]+m[1])+m[2])+m[3])+m[4])+m[5])+m[6])+m[7];return this.index+=8,A},h.prototype.unpack_int8=function(){var m=this.unpack_uint8();return m<128?m:m-256},h.prototype.unpack_int16=function(){var m=this.unpack_uint16();return m<32768?m:m-65536},h.prototype.unpack_int32=function(){var m=this.unpack_uint32();return m<Math.pow(2,31)?m:m-Math.pow(2,32)},h.prototype.unpack_int64=function(){var m=this.unpack_uint64();return m<Math.pow(2,63)?m:m-Math.pow(2,64)},h.prototype.unpack_raw=function(m){if(this.length<this.index+m)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+m+" "+this.length);var A=this.dataBuffer.slice(this.index,this.index+m);return this.index+=m,A},h.prototype.unpack_string=function(m){for(var A,v,b=this.read(m),C=0,S="";C<m;)(A=b[C])<128?(S+=String.fromCharCode(A),C++):(192^A)<32?(v=(192^A)<<6|63&b[C+1],S+=String.fromCharCode(v),C+=2):(v=(15&A)<<12|(63&b[C+1])<<6|63&b[C+2],S+=String.fromCharCode(v),C+=3);return this.index+=m,S},h.prototype.unpack_array=function(m){for(var A=new Array(m),v=0;v<m;v++)A[v]=this.unpack();return A},h.prototype.unpack_map=function(m){for(var A={},v=0;v<m;v++){var b=this.unpack(),C=this.unpack();A[b]=C}return A},h.prototype.unpack_float=function(){var m=this.unpack_uint32(),A=(m>>23&255)-127;return(m>>31===0?1:-1)*(8388607&m|8388608)*Math.pow(2,A-23)},h.prototype.unpack_double=function(){var m=this.unpack_uint32(),A=this.unpack_uint32(),v=(m>>20&2047)-1023;return(m>>31===0?1:-1)*((1048575&m|1048576)*Math.pow(2,v-20)+A*Math.pow(2,v-52))},h.prototype.read=function(m){var A=this.index;if(A+m<=this.length)return this.dataView.subarray(A,A+m);throw new Error("BinaryPackFailure: read index out of range")},u.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},u.prototype.pack=function(m){var A=typeof m;if(A==="string")this.pack_string(m);else if(A==="number")Math.floor(m)===m?this.pack_integer(m):this.pack_double(m);else if(A==="boolean")m===!0?this.bufferBuilder.append(195):m===!1&&this.bufferBuilder.append(194);else if(A==="undefined")this.bufferBuilder.append(192);else{if(A!=="object")throw new Error('Type "'+A+'" not yet supported');if(m===null)this.bufferBuilder.append(192);else{var v=m.constructor;if(v==Array)this.pack_array(m);else if(v==Blob||v==File||m instanceof Blob||m instanceof File)this.pack_bin(m);else if(v==ArrayBuffer)o.useArrayBufferView?this.pack_bin(new Uint8Array(m)):this.pack_bin(m);else if("BYTES_PER_ELEMENT"in m)o.useArrayBufferView?this.pack_bin(new Uint8Array(m.buffer)):this.pack_bin(m.buffer);else if(v==Object||v.toString().startsWith("class"))this.pack_object(m);else if(v==Date)this.pack_string(m.toString());else{if(typeof m.toBinaryPack!="function")throw new Error('Type "'+v.toString()+'" not yet supported');this.bufferBuilder.append(m.toBinaryPack())}}}this.bufferBuilder.flush()},u.prototype.pack_bin=function(m){var A=m.length||m.byteLength||m.size;if(A<=15)this.pack_uint8(160+A);else if(A<=65535)this.bufferBuilder.append(218),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(A)}this.bufferBuilder.append(m)},u.prototype.pack_string=function(m){var A=g(m);if(A<=15)this.pack_uint8(176+A);else if(A<=65535)this.bufferBuilder.append(216),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(A)}this.bufferBuilder.append(m)},u.prototype.pack_array=function(m){var A=m.length;if(A<=15)this.pack_uint8(144+A);else if(A<=65535)this.bufferBuilder.append(220),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(A)}for(var v=0;v<A;v++)this.pack(m[v])},u.prototype.pack_integer=function(m){if(m>=-32&&m<=127)this.bufferBuilder.append(255&m);else if(m>=0&&m<=255)this.bufferBuilder.append(204),this.pack_uint8(m);else if(m>=-128&&m<=127)this.bufferBuilder.append(208),this.pack_int8(m);else if(m>=0&&m<=65535)this.bufferBuilder.append(205),this.pack_uint16(m);else if(m>=-32768&&m<=32767)this.bufferBuilder.append(209),this.pack_int16(m);else if(m>=0&&m<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(m);else if(m>=-2147483648&&m<=2147483647)this.bufferBuilder.append(210),this.pack_int32(m);else if(m>=-9223372036854776e3&&m<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(m);else{if(!(m>=0&&m<=18446744073709552e3))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(m)}},u.prototype.pack_double=function(m){var A=0;m<0&&(A=1,m=-m);var v=Math.floor(Math.log(m)/Math.LN2),b=m/Math.pow(2,v)-1,C=Math.floor(b*Math.pow(2,52)),S=Math.pow(2,32),I=A<<31|v+1023<<20|C/S&1048575,M=C%S;this.bufferBuilder.append(203),this.pack_int32(I),this.pack_int32(M)},u.prototype.pack_object=function(m){var A=Object.keys(m).length;if(A<=15)this.pack_uint8(128+A);else if(A<=65535)this.bufferBuilder.append(222),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(A)}for(var v in m)m.hasOwnProperty(v)&&(this.pack(v),this.pack(m[v]))},u.prototype.pack_uint8=function(m){this.bufferBuilder.append(m)},u.prototype.pack_uint16=function(m){this.bufferBuilder.append(m>>8),this.bufferBuilder.append(255&m)},u.prototype.pack_uint32=function(m){var A=4294967295&m;this.bufferBuilder.append((4278190080&A)>>>24),this.bufferBuilder.append((16711680&A)>>>16),this.bufferBuilder.append((65280&A)>>>8),this.bufferBuilder.append(255&A)},u.prototype.pack_uint64=function(m){var A=m/Math.pow(2,32),v=m%Math.pow(2,32);this.bufferBuilder.append((4278190080&A)>>>24),this.bufferBuilder.append((16711680&A)>>>16),this.bufferBuilder.append((65280&A)>>>8),this.bufferBuilder.append(255&A),this.bufferBuilder.append((4278190080&v)>>>24),this.bufferBuilder.append((16711680&v)>>>16),this.bufferBuilder.append((65280&v)>>>8),this.bufferBuilder.append(255&v)},u.prototype.pack_int8=function(m){this.bufferBuilder.append(255&m)},u.prototype.pack_int16=function(m){this.bufferBuilder.append((65280&m)>>8),this.bufferBuilder.append(255&m)},u.prototype.pack_int32=function(m){this.bufferBuilder.append(m>>>24&255),this.bufferBuilder.append((16711680&m)>>>16),this.bufferBuilder.append((65280&m)>>>8),this.bufferBuilder.append(255&m)},u.prototype.pack_int64=function(m){var A=Math.floor(m/Math.pow(2,32)),v=m%Math.pow(2,32);this.bufferBuilder.append((4278190080&A)>>>24),this.bufferBuilder.append((16711680&A)>>>16),this.bufferBuilder.append((65280&A)>>>8),this.bufferBuilder.append(255&A),this.bufferBuilder.append((4278190080&v)>>>24),this.bufferBuilder.append((16711680&v)>>>16),this.bufferBuilder.append((65280&v)>>>8),this.bufferBuilder.append(255&v)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(t,n,i){function r(R,T,B){return T in R?Object.defineProperty(R,T,{value:B,enumerable:!0,configurable:!0,writable:!0}):R[T]=B,R}function o(R){return(o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T})(R)}Object.defineProperty(i,"__esModule",{value:!0}),i.extractVersion=u,i.wrapPeerConnectionEvent=f,i.disableLog=g,i.disableWarnings=m,i.log=A,i.deprecated=v,i.detectBrowser=b,i.compactObject=S,i.walkStats=I,i.filterStats=M;var l=!0,h=!0;function u(R,T,B){var F=R.match(T);return F&&F.length>=B&&parseInt(F[B],10)}function f(R,T,B){if(R.RTCPeerConnection){var F=R.RTCPeerConnection.prototype,D=F.addEventListener;F.addEventListener=function(W,J){if(W!==T)return D.apply(this,arguments);var ee=function(Q){var Y=B(Q);Y&&(J.handleEvent?J.handleEvent(Y):J(Y))};return this._eventMap=this._eventMap||{},this._eventMap[T]||(this._eventMap[T]=new Map),this._eventMap[T].set(J,ee),D.apply(this,[W,ee])};var U=F.removeEventListener;F.removeEventListener=function(W,J){if(W!==T||!this._eventMap||!this._eventMap[T])return U.apply(this,arguments);if(!this._eventMap[T].has(J))return U.apply(this,arguments);var ee=this._eventMap[T].get(J);return this._eventMap[T].delete(J),this._eventMap[T].size===0&&delete this._eventMap[T],Object.keys(this._eventMap).length===0&&delete this._eventMap,U.apply(this,[W,ee])},Object.defineProperty(F,"on"+T,{get:function(){return this["_on"+T]},set:function(W){this["_on"+T]&&(this.removeEventListener(T,this["_on"+T]),delete this["_on"+T]),W&&this.addEventListener(T,this["_on"+T]=W)},enumerable:!0,configurable:!0})}}function g(R){return typeof R!="boolean"?new Error("Argument type: "+o(R)+". Please use a boolean."):(l=R,R?"adapter.js logging disabled":"adapter.js logging enabled")}function m(R){return typeof R!="boolean"?new Error("Argument type: "+o(R)+". Please use a boolean."):(h=!R,"adapter.js deprecation warnings "+(R?"disabled":"enabled"))}function A(){if((typeof window>"u"?"undefined":o(window))==="object"){if(l)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function v(R,T){h&&console.warn(R+" is deprecated, please use "+T+" instead.")}function b(R){var T={browser:null,version:null};if(R===void 0||!R.navigator)return T.browser="Not a browser.",T;var{navigator:B}=R;if(B.mozGetUserMedia)T.browser="firefox",T.version=u(B.userAgent,/Firefox\/(\d+)\./,1);else if(B.webkitGetUserMedia||R.isSecureContext===!1&&R.webkitRTCPeerConnection&&!R.RTCIceGatherer)T.browser="chrome",T.version=u(B.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(B.mediaDevices&&B.userAgent.match(/Edge\/(\d+).(\d+)$/))T.browser="edge",T.version=u(B.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!R.RTCPeerConnection||!B.userAgent.match(/AppleWebKit\/(\d+)\./))return T.browser="Not a supported browser.",T;T.browser="safari",T.version=u(B.userAgent,/AppleWebKit\/(\d+)\./,1),T.supportsUnifiedPlan=R.RTCRtpTransceiver&&"currentDirection"in R.RTCRtpTransceiver.prototype}return T}function C(R){return Object.prototype.toString.call(R)==="[object Object]"}function S(R){return C(R)?Object.keys(R).reduce(function(T,B){var F=C(R[B]),D=F?S(R[B]):R[B],U=F&&!Object.keys(D).length;return D===void 0||U?T:Object.assign(T,r({},B,D))},{}):R}function I(R,T,B){T&&!B.has(T.id)&&(B.set(T.id,T),Object.keys(T).forEach(function(F){F.endsWith("Id")?I(R,R.get(T[F]),B):F.endsWith("Ids")&&T[F].forEach(function(D){I(R,R.get(D),B)})}))}function M(R,T,B){var F=B?"outbound-rtp":"inbound-rtp",D=new Map;if(T===null)return D;var U=[];return R.forEach(function(W){W.type==="track"&&W.trackIdentifier===T.id&&U.push(W)}),U.forEach(function(W){R.forEach(function(J){J.type===F&&J.trackId===W.id&&I(R,J,D)})}),D}},{}],s6SN:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=f;var r=l(t("../utils.js"));function o(){if(typeof WeakMap!="function")return null;var g=new WeakMap;return o=function(){return g},g}function l(g){if(g&&g.__esModule)return g;if(g===null||typeof g!="object"&&typeof g!="function")return{default:g};var m=o();if(m&&m.has(g))return m.get(g);var A={},v=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in g)if(Object.prototype.hasOwnProperty.call(g,b)){var C=v?Object.getOwnPropertyDescriptor(g,b):null;C&&(C.get||C.set)?Object.defineProperty(A,b,C):A[b]=g[b]}return A.default=g,m&&m.set(g,A),A}function h(g){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(g)}var u=r.log;function f(g,m){var A=g&&g.navigator;if(A.mediaDevices){var v=function(I){if(h(I)!=="object"||I.mandatory||I.optional)return I;var M={};return Object.keys(I).forEach(function(R){if(R!=="require"&&R!=="advanced"&&R!=="mediaSource"){var T=h(I[R])==="object"?I[R]:{ideal:I[R]};T.exact!==void 0&&typeof T.exact=="number"&&(T.min=T.max=T.exact);var B=function(D,U){return D?D+U.charAt(0).toUpperCase()+U.slice(1):U==="deviceId"?"sourceId":U};if(T.ideal!==void 0){M.optional=M.optional||[];var F={};typeof T.ideal=="number"?(F[B("min",R)]=T.ideal,M.optional.push(F),(F={})[B("max",R)]=T.ideal,M.optional.push(F)):(F[B("",R)]=T.ideal,M.optional.push(F))}T.exact!==void 0&&typeof T.exact!="number"?(M.mandatory=M.mandatory||{},M.mandatory[B("",R)]=T.exact):["min","max"].forEach(function(D){T[D]!==void 0&&(M.mandatory=M.mandatory||{},M.mandatory[B(D,R)]=T[D])})}}),I.advanced&&(M.optional=(M.optional||[]).concat(I.advanced)),M},b=function(I,M){if(m.version>=61)return M(I);if((I=JSON.parse(JSON.stringify(I)))&&h(I.audio)==="object"){var R=function(D,U,W){U in D&&!(W in D)&&(D[W]=D[U],delete D[U])};R((I=JSON.parse(JSON.stringify(I))).audio,"autoGainControl","googAutoGainControl"),R(I.audio,"noiseSuppression","googNoiseSuppression"),I.audio=v(I.audio)}if(I&&h(I.video)==="object"){var T=I.video.facingMode;T=T&&(h(T)==="object"?T:{ideal:T});var B,F=m.version<66;if(T&&(T.exact==="user"||T.exact==="environment"||T.ideal==="user"||T.ideal==="environment")&&(!A.mediaDevices.getSupportedConstraints||!A.mediaDevices.getSupportedConstraints().facingMode||F)&&(delete I.video.facingMode,T.exact==="environment"||T.ideal==="environment"?B=["back","rear"]:T.exact!=="user"&&T.ideal!=="user"||(B=["front"]),B))return A.mediaDevices.enumerateDevices().then(function(D){var U=(D=D.filter(function(W){return W.kind==="videoinput"})).find(function(W){return B.some(function(J){return W.label.toLowerCase().includes(J)})});return!U&&D.length&&B.includes("back")&&(U=D[D.length-1]),U&&(I.video.deviceId=T.exact?{exact:U.deviceId}:{ideal:U.deviceId}),I.video=v(I.video),u("chrome: "+JSON.stringify(I)),M(I)});I.video=v(I.video)}return u("chrome: "+JSON.stringify(I)),M(I)},C=function(I){return m.version>=64?I:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[I.name]||I.name,message:I.message,constraint:I.constraint||I.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(A.getUserMedia=function(I,M,R){b(I,function(T){A.webkitGetUserMedia(T,M,function(B){R&&R(C(B))})})}.bind(A),A.mediaDevices.getUserMedia){var S=A.mediaDevices.getUserMedia.bind(A.mediaDevices);A.mediaDevices.getUserMedia=function(I){return b(I,function(M){return S(M).then(function(R){if(M.audio&&!R.getAudioTracks().length||M.video&&!R.getVideoTracks().length)throw R.getTracks().forEach(function(T){T.stop()}),new DOMException("","NotFoundError");return R},function(R){return Promise.reject(C(R))})})}}}}},{"../utils.js":"iSxC"}],VHa8:[function(t,n,i){function r(o,l){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(typeof l=="function"?o.navigator.mediaDevices.getDisplayMedia=function(h){return l(h).then(function(u){var f=h.video&&h.video.width,g=h.video&&h.video.height,m=h.video&&h.video.frameRate;return h.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u,maxFrameRate:m||3}},f&&(h.video.mandatory.maxWidth=f),g&&(h.video.mandatory.maxHeight=g),o.navigator.mediaDevices.getUserMedia(h)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],uI5X:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimMediaStream=m,i.shimOnTrack=A,i.shimGetSendersWithDtmf=v,i.shimGetStats=b,i.shimSenderReceiverGetStats=C,i.shimAddTrackRemoveTrackWithNative=S,i.shimAddTrackRemoveTrack=I,i.shimPeerConnection=M,i.fixNegotiationNeeded=R,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return l.shimGetDisplayMedia}});var r=u(t("../utils.js")),o=t("./getusermedia"),l=t("./getdisplaymedia");function h(){if(typeof WeakMap!="function")return null;var T=new WeakMap;return h=function(){return T},T}function u(T){if(T&&T.__esModule)return T;if(T===null||typeof T!="object"&&typeof T!="function")return{default:T};var B=h();if(B&&B.has(T))return B.get(T);var F={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(Object.prototype.hasOwnProperty.call(T,U)){var W=D?Object.getOwnPropertyDescriptor(T,U):null;W&&(W.get||W.set)?Object.defineProperty(F,U,W):F[U]=T[U]}return F.default=T,B&&B.set(T,F),F}function f(T,B,F){return B in T?Object.defineProperty(T,B,{value:F,enumerable:!0,configurable:!0,writable:!0}):T[B]=F,T}function g(T){return(g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B})(T)}function m(T){T.MediaStream=T.MediaStream||T.webkitMediaStream}function A(T){if(g(T)!=="object"||!T.RTCPeerConnection||"ontrack"in T.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(T,"track",function(F){return F.transceiver||Object.defineProperty(F,"transceiver",{value:{receiver:F.receiver}}),F});else{Object.defineProperty(T.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(F){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=F)},enumerable:!0,configurable:!0});var B=T.RTCPeerConnection.prototype.setRemoteDescription;T.RTCPeerConnection.prototype.setRemoteDescription=function(){var F=this;return this._ontrackpoly||(this._ontrackpoly=function(D){D.stream.addEventListener("addtrack",function(U){var W;W=T.RTCPeerConnection.prototype.getReceivers?F.getReceivers().find(function(ee){return ee.track&&ee.track.id===U.track.id}):{track:U.track};var J=new Event("track");J.track=U.track,J.receiver=W,J.transceiver={receiver:W},J.streams=[D.stream],F.dispatchEvent(J)}),D.stream.getTracks().forEach(function(U){var W;W=T.RTCPeerConnection.prototype.getReceivers?F.getReceivers().find(function(ee){return ee.track&&ee.track.id===U.id}):{track:U};var J=new Event("track");J.track=U,J.receiver=W,J.transceiver={receiver:W},J.streams=[D.stream],F.dispatchEvent(J)})},this.addEventListener("addstream",this._ontrackpoly)),B.apply(this,arguments)}}}function v(T){if(g(T)==="object"&&T.RTCPeerConnection&&!("getSenders"in T.RTCPeerConnection.prototype)&&"createDTMFSender"in T.RTCPeerConnection.prototype){var B=function(ee,Q){return{track:Q,get dtmf(){return this._dtmf===void 0&&(Q.kind==="audio"?this._dtmf=ee.createDTMFSender(Q):this._dtmf=null),this._dtmf},_pc:ee}};if(!T.RTCPeerConnection.prototype.getSenders){T.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var F=T.RTCPeerConnection.prototype.addTrack;T.RTCPeerConnection.prototype.addTrack=function(ee,Q){var Y=F.apply(this,arguments);return Y||(Y=B(this,ee),this._senders.push(Y)),Y};var D=T.RTCPeerConnection.prototype.removeTrack;T.RTCPeerConnection.prototype.removeTrack=function(ee){D.apply(this,arguments);var Q=this._senders.indexOf(ee);Q!==-1&&this._senders.splice(Q,1)}}var U=T.RTCPeerConnection.prototype.addStream;T.RTCPeerConnection.prototype.addStream=function(ee){var Q=this;this._senders=this._senders||[],U.apply(this,[ee]),ee.getTracks().forEach(function(Y){Q._senders.push(B(Q,Y))})};var W=T.RTCPeerConnection.prototype.removeStream;T.RTCPeerConnection.prototype.removeStream=function(ee){var Q=this;this._senders=this._senders||[],W.apply(this,[ee]),ee.getTracks().forEach(function(Y){var se=Q._senders.find(function(ae){return ae.track===Y});se&&Q._senders.splice(Q._senders.indexOf(se),1)})}}else if(g(T)==="object"&&T.RTCPeerConnection&&"getSenders"in T.RTCPeerConnection.prototype&&"createDTMFSender"in T.RTCPeerConnection.prototype&&T.RTCRtpSender&&!("dtmf"in T.RTCRtpSender.prototype)){var J=T.RTCPeerConnection.prototype.getSenders;T.RTCPeerConnection.prototype.getSenders=function(){var ee=this,Q=J.apply(this,[]);return Q.forEach(function(Y){return Y._pc=ee}),Q},Object.defineProperty(T.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function b(T){if(T.RTCPeerConnection){var B=T.RTCPeerConnection.prototype.getStats;T.RTCPeerConnection.prototype.getStats=function(){var F=this,[D,U,W]=arguments;if(arguments.length>0&&typeof D=="function")return B.apply(this,arguments);if(B.length===0&&(arguments.length===0||typeof D!="function"))return B.apply(this,[]);var J=function(Q){var Y={};return Q.result().forEach(function(se){var ae={id:se.id,timestamp:se.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[se.type]||se.type};se.names().forEach(function(ve){ae[ve]=se.stat(ve)}),Y[ae.id]=ae}),Y},ee=function(Q){return new Map(Object.keys(Q).map(function(Y){return[Y,Q[Y]]}))};return arguments.length>=2?B.apply(this,[function(Q){U(ee(J(Q)))},D]):new Promise(function(Q,Y){B.apply(F,[function(se){Q(ee(J(se)))},Y])}).then(U,W)}}}function C(T){if(g(T)==="object"&&T.RTCPeerConnection&&T.RTCRtpSender&&T.RTCRtpReceiver){if(!("getStats"in T.RTCRtpSender.prototype)){var B=T.RTCPeerConnection.prototype.getSenders;B&&(T.RTCPeerConnection.prototype.getSenders=function(){var W=this,J=B.apply(this,[]);return J.forEach(function(ee){return ee._pc=W}),J});var F=T.RTCPeerConnection.prototype.addTrack;F&&(T.RTCPeerConnection.prototype.addTrack=function(){var W=F.apply(this,arguments);return W._pc=this,W}),T.RTCRtpSender.prototype.getStats=function(){var W=this;return this._pc.getStats().then(function(J){return r.filterStats(J,W.track,!0)})}}if(!("getStats"in T.RTCRtpReceiver.prototype)){var D=T.RTCPeerConnection.prototype.getReceivers;D&&(T.RTCPeerConnection.prototype.getReceivers=function(){var W=this,J=D.apply(this,[]);return J.forEach(function(ee){return ee._pc=W}),J}),r.wrapPeerConnectionEvent(T,"track",function(W){return W.receiver._pc=W.srcElement,W}),T.RTCRtpReceiver.prototype.getStats=function(){var W=this;return this._pc.getStats().then(function(J){return r.filterStats(J,W.track,!1)})}}if("getStats"in T.RTCRtpSender.prototype&&"getStats"in T.RTCRtpReceiver.prototype){var U=T.RTCPeerConnection.prototype.getStats;T.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof T.MediaStreamTrack){var W,J,ee,Q=arguments[0];return this.getSenders().forEach(function(Y){Y.track===Q&&(W?ee=!0:W=Y)}),this.getReceivers().forEach(function(Y){return Y.track===Q&&(J?ee=!0:J=Y),Y.track===Q}),ee||W&&J?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):W?W.getStats():J?J.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return U.apply(this,arguments)}}}}function S(T){T.RTCPeerConnection.prototype.getLocalStreams=function(){var W=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(J){return W._shimmedLocalStreams[J][0]})};var B=T.RTCPeerConnection.prototype.addTrack;T.RTCPeerConnection.prototype.addTrack=function(W,J){if(!J)return B.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var ee=B.apply(this,arguments);return this._shimmedLocalStreams[J.id]?this._shimmedLocalStreams[J.id].indexOf(ee)===-1&&this._shimmedLocalStreams[J.id].push(ee):this._shimmedLocalStreams[J.id]=[J,ee],ee};var F=T.RTCPeerConnection.prototype.addStream;T.RTCPeerConnection.prototype.addStream=function(W){var J=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},W.getTracks().forEach(function(Y){if(J.getSenders().find(function(se){return se.track===Y}))throw new DOMException("Track already exists.","InvalidAccessError")});var ee=this.getSenders();F.apply(this,arguments);var Q=this.getSenders().filter(function(Y){return ee.indexOf(Y)===-1});this._shimmedLocalStreams[W.id]=[W].concat(Q)};var D=T.RTCPeerConnection.prototype.removeStream;T.RTCPeerConnection.prototype.removeStream=function(W){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[W.id],D.apply(this,arguments)};var U=T.RTCPeerConnection.prototype.removeTrack;T.RTCPeerConnection.prototype.removeTrack=function(W){var J=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},W&&Object.keys(this._shimmedLocalStreams).forEach(function(ee){var Q=J._shimmedLocalStreams[ee].indexOf(W);Q!==-1&&J._shimmedLocalStreams[ee].splice(Q,1),J._shimmedLocalStreams[ee].length===1&&delete J._shimmedLocalStreams[ee]}),U.apply(this,arguments)}}function I(T,B){if(T.RTCPeerConnection){if(T.RTCPeerConnection.prototype.addTrack&&B.version>=65)return S(T);var F=T.RTCPeerConnection.prototype.getLocalStreams;T.RTCPeerConnection.prototype.getLocalStreams=function(){var Q=this,Y=F.apply(this);return this._reverseStreams=this._reverseStreams||{},Y.map(function(se){return Q._reverseStreams[se.id]})};var D=T.RTCPeerConnection.prototype.addStream;T.RTCPeerConnection.prototype.addStream=function(Q){var Y=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},Q.getTracks().forEach(function(ae){if(Y.getSenders().find(function(ve){return ve.track===ae}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[Q.id]){var se=new T.MediaStream(Q.getTracks());this._streams[Q.id]=se,this._reverseStreams[se.id]=Q,Q=se}D.apply(this,[Q])};var U=T.RTCPeerConnection.prototype.removeStream;T.RTCPeerConnection.prototype.removeStream=function(Q){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},U.apply(this,[this._streams[Q.id]||Q]),delete this._reverseStreams[this._streams[Q.id]?this._streams[Q.id].id:Q.id],delete this._streams[Q.id]},T.RTCPeerConnection.prototype.addTrack=function(Q,Y){var se=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var ae=[].slice.call(arguments,1);if(ae.length!==1||!ae[0].getTracks().find(function(Ae){return Ae===Q}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(Ae){return Ae.track===Q}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var ve=this._streams[Y.id];if(ve)ve.addTrack(Q),Promise.resolve().then(function(){se.dispatchEvent(new Event("negotiationneeded"))});else{var xe=new T.MediaStream([Q]);this._streams[Y.id]=xe,this._reverseStreams[xe.id]=Y,this.addStream(xe)}return this.getSenders().find(function(Ae){return Ae.track===Q})},["createOffer","createAnswer"].forEach(function(Q){var Y=T.RTCPeerConnection.prototype[Q],se=f({},Q,function(){var ae=this,ve=arguments;return arguments.length&&typeof arguments[0]=="function"?Y.apply(this,[function(xe){var Ae=ee(ae,xe);ve[0].apply(null,[Ae])},function(xe){ve[1]&&ve[1].apply(null,xe)},arguments[2]]):Y.apply(this,arguments).then(function(xe){return ee(ae,xe)})});T.RTCPeerConnection.prototype[Q]=se[Q]});var W=T.RTCPeerConnection.prototype.setLocalDescription;T.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(Q=this,Y=arguments[0],se=Y.sdp,Object.keys(Q._reverseStreams||[]).forEach(function(ae){var ve=Q._reverseStreams[ae],xe=Q._streams[ve.id];se=se.replace(new RegExp(ve.id,"g"),xe.id)}),new RTCSessionDescription({type:Y.type,sdp:se})),W.apply(this,arguments)):W.apply(this,arguments);var Q,Y,se};var J=Object.getOwnPropertyDescriptor(T.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(T.RTCPeerConnection.prototype,"localDescription",{get:function(){var Q=J.get.apply(this);return Q.type===""?Q:ee(this,Q)}}),T.RTCPeerConnection.prototype.removeTrack=function(Q){var Y,se=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!Q._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(Q._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(ae){se._streams[ae].getTracks().find(function(ve){return Q.track===ve})&&(Y=se._streams[ae])}),Y&&(Y.getTracks().length===1?this.removeStream(this._reverseStreams[Y.id]):Y.removeTrack(Q.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ee(Q,Y){var se=Y.sdp;return Object.keys(Q._reverseStreams||[]).forEach(function(ae){var ve=Q._reverseStreams[ae],xe=Q._streams[ve.id];se=se.replace(new RegExp(xe.id,"g"),ve.id)}),new RTCSessionDescription({type:Y.type,sdp:se})}}function M(T,B){!T.RTCPeerConnection&&T.webkitRTCPeerConnection&&(T.RTCPeerConnection=T.webkitRTCPeerConnection),T.RTCPeerConnection&&B.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(F){var D=T.RTCPeerConnection.prototype[F],U=f({},F,function(){return arguments[0]=new(F==="addIceCandidate"?T.RTCIceCandidate:T.RTCSessionDescription)(arguments[0]),D.apply(this,arguments)});T.RTCPeerConnection.prototype[F]=U[F]})}function R(T,B){r.wrapPeerConnectionEvent(T,"negotiationneeded",function(F){var D=F.target;if(!(B.version<72||D.getConfiguration&&D.getConfiguration().sdpSemantics==="plan-b")||D.signalingState==="stable")return F})}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.filterIceServers=h;var r=l(t("../utils"));function o(){if(typeof WeakMap!="function")return null;var u=new WeakMap;return o=function(){return u},u}function l(u){if(u&&u.__esModule)return u;if(u===null||typeof u!="object"&&typeof u!="function")return{default:u};var f=o();if(f&&f.has(u))return f.get(u);var g={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var A in u)if(Object.prototype.hasOwnProperty.call(u,A)){var v=m?Object.getOwnPropertyDescriptor(u,A):null;v&&(v.get||v.set)?Object.defineProperty(g,A,v):g[A]=u[A]}return g.default=u,f&&f.set(u,g),g}function h(u,f){var g=!1;return(u=JSON.parse(JSON.stringify(u))).filter(function(m){if(m&&(m.urls||m.url)){var A=m.urls||m.url;m.url&&!m.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var v=typeof A=="string";return v&&(A=[A]),A=A.filter(function(b){if(b.indexOf("stun:")===0)return!1;var C=b.startsWith("turn")&&!b.startsWith("turn:[")&&b.includes("transport=udp");return C&&!g?(g=!0,!0):C&&!g}),delete m.url,m.urls=v?A[0]:A,!!A.length}})}},{"../utils":"iSxC"}],YHvh:[function(t,n,i){var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(o){return o.trim().split(`
`).map(function(l){return l.trim()})},r.splitSections=function(o){return o.split(`
m=`).map(function(l,h){return(h>0?"m="+l:l).trim()+`\r
`})},r.getDescription=function(o){var l=r.splitSections(o);return l&&l[0]},r.getMediaSections=function(o){var l=r.splitSections(o);return l.shift(),l},r.matchPrefix=function(o,l){return r.splitLines(o).filter(function(h){return h.indexOf(l)===0})},r.parseCandidate=function(o){for(var l,h={foundation:(l=o.indexOf("a=candidate:")===0?o.substring(12).split(" "):o.substring(10).split(" "))[0],component:parseInt(l[1],10),protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]},u=8;u<l.length;u+=2)switch(l[u]){case"raddr":h.relatedAddress=l[u+1];break;case"rport":h.relatedPort=parseInt(l[u+1],10);break;case"tcptype":h.tcpType=l[u+1];break;case"ufrag":h.ufrag=l[u+1],h.usernameFragment=l[u+1];break;default:h[l[u]]=l[u+1]}return h},r.writeCandidate=function(o){var l=[];l.push(o.foundation),l.push(o.component),l.push(o.protocol.toUpperCase()),l.push(o.priority),l.push(o.address||o.ip),l.push(o.port);var h=o.type;return l.push("typ"),l.push(h),h!=="host"&&o.relatedAddress&&o.relatedPort&&(l.push("raddr"),l.push(o.relatedAddress),l.push("rport"),l.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(l.push("ufrag"),l.push(o.usernameFragment||o.ufrag)),"candidate:"+l.join(" ")},r.parseIceOptions=function(o){return o.substr(14).split(" ")},r.parseRtpMap=function(o){var l=o.substr(9).split(" "),h={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),h.name=l[0],h.clockRate=parseInt(l[1],10),h.channels=l.length===3?parseInt(l[2],10):1,h.numChannels=h.channels,h},r.writeRtpMap=function(o){var l=o.payloadType;o.preferredPayloadType!==void 0&&(l=o.preferredPayloadType);var h=o.channels||o.numChannels||1;return"a=rtpmap:"+l+" "+o.name+"/"+o.clockRate+(h!==1?"/"+h:"")+`\r
`},r.parseExtmap=function(o){var l=o.substr(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1]}},r.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+`\r
`},r.parseFmtp=function(o){for(var l,h={},u=o.substr(o.indexOf(" ")+1).split(";"),f=0;f<u.length;f++)h[(l=u[f].trim().split("="))[0].trim()]=l[1];return h},r.writeFmtp=function(o){var l="",h=o.payloadType;if(o.preferredPayloadType!==void 0&&(h=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){var u=[];Object.keys(o.parameters).forEach(function(f){o.parameters[f]?u.push(f+"="+o.parameters[f]):u.push(f)}),l+="a=fmtp:"+h+" "+u.join(";")+`\r
`}return l},r.parseRtcpFb=function(o){var l=o.substr(o.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},r.writeRtcpFb=function(o){var l="",h=o.payloadType;return o.preferredPayloadType!==void 0&&(h=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(function(u){l+="a=rtcp-fb:"+h+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),l},r.parseSsrcMedia=function(o){var l=o.indexOf(" "),h={ssrc:parseInt(o.substr(7,l-7),10)},u=o.indexOf(":",l);return u>-1?(h.attribute=o.substr(l+1,u-l-1),h.value=o.substr(u+1)):h.attribute=o.substr(l+1),h},r.parseSsrcGroup=function(o){var l=o.substr(13).split(" ");return{semantics:l.shift(),ssrcs:l.map(function(h){return parseInt(h,10)})}},r.getMid=function(o){var l=r.matchPrefix(o,"a=mid:")[0];if(l)return l.substr(6)},r.parseFingerprint=function(o){var l=o.substr(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1]}},r.getDtlsParameters=function(o,l){return{role:"auto",fingerprints:r.matchPrefix(o+l,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(o,l){var h="a=setup:"+l+`\r
`;return o.fingerprints.forEach(function(u){h+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),h},r.parseCryptoLine=function(o){var l=o.substr(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},r.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?r.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;var l=o.substr(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},r.getCryptoParameters=function(o,l){return r.matchPrefix(o+l,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(o,l){var h=r.matchPrefix(o+l,"a=ice-ufrag:")[0],u=r.matchPrefix(o+l,"a=ice-pwd:")[0];return h&&u?{usernameFragment:h.substr(12),password:u.substr(10)}:null},r.writeIceParameters=function(o){return"a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`},r.parseRtpParameters=function(o){for(var l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=r.splitLines(o)[0].split(" "),u=3;u<h.length;u++){var f=h[u],g=r.matchPrefix(o,"a=rtpmap:"+f+" ")[0];if(g){var m=r.parseRtpMap(g),A=r.matchPrefix(o,"a=fmtp:"+f+" ");switch(m.parameters=A.length?r.parseFmtp(A[0]):{},m.rtcpFeedback=r.matchPrefix(o,"a=rtcp-fb:"+f+" ").map(r.parseRtcpFb),l.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(m.name.toUpperCase())}}}return r.matchPrefix(o,"a=extmap:").forEach(function(v){l.headerExtensions.push(r.parseExtmap(v))}),l},r.writeRtpDescription=function(o,l){var h="";h+="m="+o+" ",h+=l.codecs.length>0?"9":"0",h+=" UDP/TLS/RTP/SAVPF ",h+=l.codecs.map(function(f){return f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType}).join(" ")+`\r
`,h+=`c=IN IP4 0.0.0.0\r
`,h+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach(function(f){h+=r.writeRtpMap(f),h+=r.writeFmtp(f),h+=r.writeRtcpFb(f)});var u=0;return l.codecs.forEach(function(f){f.maxptime>u&&(u=f.maxptime)}),u>0&&(h+="a=maxptime:"+u+`\r
`),h+=`a=rtcp-mux\r
`,l.headerExtensions&&l.headerExtensions.forEach(function(f){h+=r.writeExtmap(f)}),h},r.parseRtpEncodingParameters=function(o){var l,h=[],u=r.parseRtpParameters(o),f=u.fecMechanisms.indexOf("RED")!==-1,g=u.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(o,"a=ssrc:").map(function(C){return r.parseSsrcMedia(C)}).filter(function(C){return C.attribute==="cname"}),A=m.length>0&&m[0].ssrc,v=r.matchPrefix(o,"a=ssrc-group:FID").map(function(C){return C.substr(17).split(" ").map(function(S){return parseInt(S,10)})});v.length>0&&v[0].length>1&&v[0][0]===A&&(l=v[0][1]),u.codecs.forEach(function(C){if(C.name.toUpperCase()==="RTX"&&C.parameters.apt){var S={ssrc:A,codecPayloadType:parseInt(C.parameters.apt,10)};A&&l&&(S.rtx={ssrc:l}),h.push(S),f&&((S=JSON.parse(JSON.stringify(S))).fec={ssrc:A,mechanism:g?"red+ulpfec":"red"},h.push(S))}}),h.length===0&&A&&h.push({ssrc:A});var b=r.matchPrefix(o,"b=");return b.length&&(b=b[0].indexOf("b=TIAS:")===0?parseInt(b[0].substr(7),10):b[0].indexOf("b=AS:")===0?1e3*parseInt(b[0].substr(5),10)*.95-16e3:void 0,h.forEach(function(C){C.maxBitrate=b})),h},r.parseRtcpParameters=function(o){var l={},h=r.matchPrefix(o,"a=ssrc:").map(function(g){return r.parseSsrcMedia(g)}).filter(function(g){return g.attribute==="cname"})[0];h&&(l.cname=h.value,l.ssrc=h.ssrc);var u=r.matchPrefix(o,"a=rtcp-rsize");l.reducedSize=u.length>0,l.compound=u.length===0;var f=r.matchPrefix(o,"a=rtcp-mux");return l.mux=f.length>0,l},r.parseMsid=function(o){var l,h=r.matchPrefix(o,"a=msid:");if(h.length===1)return{stream:(l=h[0].substr(7).split(" "))[0],track:l[1]};var u=r.matchPrefix(o,"a=ssrc:").map(function(f){return r.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="msid"});return u.length>0?{stream:(l=u[0].value.split(" "))[0],track:l[1]}:void 0},r.parseSctpDescription=function(o){var l,h=r.parseMLine(o),u=r.matchPrefix(o,"a=max-message-size:");u.length>0&&(l=parseInt(u[0].substr(19),10)),isNaN(l)&&(l=65536);var f=r.matchPrefix(o,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substr(12),10),protocol:h.fmt,maxMessageSize:l};if(r.matchPrefix(o,"a=sctpmap:").length>0){var g=r.matchPrefix(o,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:l}}},r.writeSctpDescription=function(o,l){var h=[];return h=o.protocol!=="DTLS/SCTP"?["m="+o.kind+" 9 "+o.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+o.kind+" 9 "+o.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&h.push("a=max-message-size:"+l.maxMessageSize+`\r
`),h.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(o,l,h){var u=l!==void 0?l:2;return`v=0\r
o=`+(h||"thisisadapterortc")+" "+(o||r.generateSessionId())+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.writeMediaSection=function(o,l,h,u){var f=r.writeRtpDescription(o.kind,l);if(f+=r.writeIceParameters(o.iceGatherer.getLocalParameters()),f+=r.writeDtlsParameters(o.dtlsTransport.getLocalParameters(),h==="offer"?"actpass":"active"),f+="a=mid:"+o.mid+`\r
`,o.direction?f+="a="+o.direction+`\r
`:o.rtpSender&&o.rtpReceiver?f+=`a=sendrecv\r
`:o.rtpSender?f+=`a=sendonly\r
`:o.rtpReceiver?f+=`a=recvonly\r
`:f+=`a=inactive\r
`,o.rtpSender){var g="msid:"+u.id+" "+o.rtpSender.track.id+`\r
`;f+="a="+g,f+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" "+g,o.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+o.sendEncodingParameters[0].ssrc+" "+o.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return f+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,o.rtpSender&&o.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),f},r.getDirection=function(o,l){for(var h=r.splitLines(o),u=0;u<h.length;u++)switch(h[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return h[u].substr(2)}return l?r.getDirection(l):"sendrecv"},r.getKind=function(o){return r.splitLines(o)[0].split(" ")[0].substr(2)},r.isRejected=function(o){return o.split(" ",2)[1]==="0"},r.parseMLine=function(o){var l=r.splitLines(o)[0].substr(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},r.parseOLine=function(o){var l=r.matchPrefix(o,"o=")[0].substr(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},r.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;for(var l=r.splitLines(o),h=0;h<l.length;h++)if(l[h].length<2||l[h].charAt(1)!=="=")return!1;return!0},typeof n=="object"&&(n.exports=r)},{}],NJ2u:[function(t,n,i){var r=t("sdp");function o(A){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[A.type]||A.type}function l(A,v,b,C,S){var I=r.writeRtpDescription(A.kind,v);if(I+=r.writeIceParameters(A.iceGatherer.getLocalParameters()),I+=r.writeDtlsParameters(A.dtlsTransport.getLocalParameters(),b==="offer"?"actpass":S||"active"),I+="a=mid:"+A.mid+`\r
`,A.rtpSender&&A.rtpReceiver?I+=`a=sendrecv\r
`:A.rtpSender?I+=`a=sendonly\r
`:A.rtpReceiver?I+=`a=recvonly\r
`:I+=`a=inactive\r
`,A.rtpSender){var M=A.rtpSender._initialTrackId||A.rtpSender.track.id;A.rtpSender._initialTrackId=M;var R="msid:"+(C?C.id:"-")+" "+M+`\r
`;I+="a="+R,I+="a=ssrc:"+A.sendEncodingParameters[0].ssrc+" "+R,A.sendEncodingParameters[0].rtx&&(I+="a=ssrc:"+A.sendEncodingParameters[0].rtx.ssrc+" "+R,I+="a=ssrc-group:FID "+A.sendEncodingParameters[0].ssrc+" "+A.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return I+="a=ssrc:"+A.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,A.rtpSender&&A.sendEncodingParameters[0].rtx&&(I+="a=ssrc:"+A.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),I}function h(A,v){var b=!1;return(A=JSON.parse(JSON.stringify(A))).filter(function(C){if(C&&(C.urls||C.url)){var S=C.urls||C.url;C.url&&!C.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var I=typeof S=="string";return I&&(S=[S]),S=S.filter(function(M){return M.indexOf("turn:")===0&&M.indexOf("transport=udp")!==-1&&M.indexOf("turn:[")===-1&&!b?(b=!0,!0):M.indexOf("stun:")===0&&v>=14393&&M.indexOf("?transport=udp")===-1}),delete C.url,C.urls=I?S[0]:S,!!S.length}})}function u(A,v){var b={codecs:[],headerExtensions:[],fecMechanisms:[]},C=function(I,M){I=parseInt(I,10);for(var R=0;R<M.length;R++)if(M[R].payloadType===I||M[R].preferredPayloadType===I)return M[R]},S=function(I,M,R,T){var B=C(I.parameters.apt,R),F=C(M.parameters.apt,T);return B&&F&&B.name.toLowerCase()===F.name.toLowerCase()};return A.codecs.forEach(function(I){for(var M=0;M<v.codecs.length;M++){var R=v.codecs[M];if(I.name.toLowerCase()===R.name.toLowerCase()&&I.clockRate===R.clockRate){if(I.name.toLowerCase()==="rtx"&&I.parameters&&R.parameters.apt&&!S(I,R,A.codecs,v.codecs))continue;(R=JSON.parse(JSON.stringify(R))).numChannels=Math.min(I.numChannels,R.numChannels),b.codecs.push(R),R.rtcpFeedback=R.rtcpFeedback.filter(function(T){for(var B=0;B<I.rtcpFeedback.length;B++)if(I.rtcpFeedback[B].type===T.type&&I.rtcpFeedback[B].parameter===T.parameter)return!0;return!1});break}}}),A.headerExtensions.forEach(function(I){for(var M=0;M<v.headerExtensions.length;M++){var R=v.headerExtensions[M];if(I.uri===R.uri){b.headerExtensions.push(R);break}}}),b}function f(A,v,b){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[v][A].indexOf(b)!==-1}function g(A,v){var b=A.getRemoteCandidates().find(function(C){return v.foundation===C.foundation&&v.ip===C.ip&&v.port===C.port&&v.priority===C.priority&&v.protocol===C.protocol&&v.type===C.type});return b||A.addRemoteCandidate(v),!b}function m(A,v){var b=new Error(v);return b.name=A,b.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[A],b}n.exports=function(A,v){function b(M,R){R.addTrack(M),R.dispatchEvent(new A.MediaStreamTrackEvent("addtrack",{track:M}))}function C(M,R,T,B){var F=new Event("track");F.track=R,F.receiver=T,F.transceiver={receiver:T},F.streams=B,A.setTimeout(function(){M._dispatchEvent("track",F)})}var S=function(M){var R=this,T=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(F){R[F]=T[F].bind(T)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",M=JSON.parse(JSON.stringify(M||{})),this.usingBundle=M.bundlePolicy==="max-bundle",M.rtcpMuxPolicy==="negotiate")throw m("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(M.rtcpMuxPolicy||(M.rtcpMuxPolicy="require"),M.iceTransportPolicy){case"all":case"relay":break;default:M.iceTransportPolicy="all"}switch(M.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:M.bundlePolicy="balanced"}if(M.iceServers=h(M.iceServers||[],v),this._iceGatherers=[],M.iceCandidatePoolSize)for(var B=M.iceCandidatePoolSize;B>0;B--)this._iceGatherers.push(new A.RTCIceGatherer({iceServers:M.iceServers,gatherPolicy:M.iceTransportPolicy}));else M.iceCandidatePoolSize=0;this._config=M,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(S.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(S.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),S.prototype.onicecandidate=null,S.prototype.onaddstream=null,S.prototype.ontrack=null,S.prototype.onremovestream=null,S.prototype.onsignalingstatechange=null,S.prototype.oniceconnectionstatechange=null,S.prototype.onconnectionstatechange=null,S.prototype.onicegatheringstatechange=null,S.prototype.onnegotiationneeded=null,S.prototype.ondatachannel=null,S.prototype._dispatchEvent=function(M,R){this._isClosed||(this.dispatchEvent(R),typeof this["on"+M]=="function"&&this["on"+M](R))},S.prototype._emitGatheringStateChange=function(){var M=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",M)},S.prototype.getConfiguration=function(){return this._config},S.prototype.getLocalStreams=function(){return this.localStreams},S.prototype.getRemoteStreams=function(){return this.remoteStreams},S.prototype._createTransceiver=function(M,R){var T=this.transceivers.length>0,B={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:M,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&T)B.iceTransport=this.transceivers[0].iceTransport,B.dtlsTransport=this.transceivers[0].dtlsTransport;else{var F=this._createIceAndDtlsTransports();B.iceTransport=F.iceTransport,B.dtlsTransport=F.dtlsTransport}return R||this.transceivers.push(B),B},S.prototype.addTrack=function(M,R){if(this._isClosed)throw m("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var T;if(this.transceivers.find(function(F){return F.track===M}))throw m("InvalidAccessError","Track already exists.");for(var B=0;B<this.transceivers.length;B++)this.transceivers[B].track||this.transceivers[B].kind!==M.kind||(T=this.transceivers[B]);return T||(T=this._createTransceiver(M.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(R)===-1&&this.localStreams.push(R),T.track=M,T.stream=R,T.rtpSender=new A.RTCRtpSender(M,T.dtlsTransport),T.rtpSender},S.prototype.addStream=function(M){var R=this;if(v>=15025)M.getTracks().forEach(function(B){R.addTrack(B,M)});else{var T=M.clone();M.getTracks().forEach(function(B,F){var D=T.getTracks()[F];B.addEventListener("enabled",function(U){D.enabled=U.enabled})}),T.getTracks().forEach(function(B){R.addTrack(B,T)})}},S.prototype.removeTrack=function(M){if(this._isClosed)throw m("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(M instanceof A.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var R=this.transceivers.find(function(B){return B.rtpSender===M});if(!R)throw m("InvalidAccessError","Sender was not created by this connection.");var T=R.stream;R.rtpSender.stop(),R.rtpSender=null,R.track=null,R.stream=null,this.transceivers.map(function(B){return B.stream}).indexOf(T)===-1&&this.localStreams.indexOf(T)>-1&&this.localStreams.splice(this.localStreams.indexOf(T),1),this._maybeFireNegotiationNeeded()},S.prototype.removeStream=function(M){var R=this;M.getTracks().forEach(function(T){var B=R.getSenders().find(function(F){return F.track===T});B&&R.removeTrack(B)})},S.prototype.getSenders=function(){return this.transceivers.filter(function(M){return!!M.rtpSender}).map(function(M){return M.rtpSender})},S.prototype.getReceivers=function(){return this.transceivers.filter(function(M){return!!M.rtpReceiver}).map(function(M){return M.rtpReceiver})},S.prototype._createIceGatherer=function(M,R){var T=this;if(R&&M>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var B=new A.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(B,"state",{value:"new",writable:!0}),this.transceivers[M].bufferedCandidateEvents=[],this.transceivers[M].bufferCandidates=function(F){var D=!F.candidate||Object.keys(F.candidate).length===0;B.state=D?"completed":"gathering",T.transceivers[M].bufferedCandidateEvents!==null&&T.transceivers[M].bufferedCandidateEvents.push(F)},B.addEventListener("localcandidate",this.transceivers[M].bufferCandidates),B},S.prototype._gather=function(M,R){var T=this,B=this.transceivers[R].iceGatherer;if(!B.onlocalcandidate){var F=this.transceivers[R].bufferedCandidateEvents;this.transceivers[R].bufferedCandidateEvents=null,B.removeEventListener("localcandidate",this.transceivers[R].bufferCandidates),B.onlocalcandidate=function(D){if(!(T.usingBundle&&R>0)){var U=new Event("icecandidate");U.candidate={sdpMid:M,sdpMLineIndex:R};var W=D.candidate,J=!W||Object.keys(W).length===0;if(J)B.state!=="new"&&B.state!=="gathering"||(B.state="completed");else{B.state==="new"&&(B.state="gathering"),W.component=1,W.ufrag=B.getLocalParameters().usernameFragment;var ee=r.writeCandidate(W);U.candidate=Object.assign(U.candidate,r.parseCandidate(ee)),U.candidate.candidate=ee,U.candidate.toJSON=function(){return{candidate:U.candidate.candidate,sdpMid:U.candidate.sdpMid,sdpMLineIndex:U.candidate.sdpMLineIndex,usernameFragment:U.candidate.usernameFragment}}}var Q=r.getMediaSections(T._localDescription.sdp);Q[U.candidate.sdpMLineIndex]+=J?`a=end-of-candidates\r
`:"a="+U.candidate.candidate+`\r
`,T._localDescription.sdp=r.getDescription(T._localDescription.sdp)+Q.join("");var Y=T.transceivers.every(function(se){return se.iceGatherer&&se.iceGatherer.state==="completed"});T.iceGatheringState!=="gathering"&&(T.iceGatheringState="gathering",T._emitGatheringStateChange()),J||T._dispatchEvent("icecandidate",U),Y&&(T._dispatchEvent("icecandidate",new Event("icecandidate")),T.iceGatheringState="complete",T._emitGatheringStateChange())}},A.setTimeout(function(){F.forEach(function(D){B.onlocalcandidate(D)})},0)}},S.prototype._createIceAndDtlsTransports=function(){var M=this,R=new A.RTCIceTransport(null);R.onicestatechange=function(){M._updateIceConnectionState(),M._updateConnectionState()};var T=new A.RTCDtlsTransport(R);return T.ondtlsstatechange=function(){M._updateConnectionState()},T.onerror=function(){Object.defineProperty(T,"state",{value:"failed",writable:!0}),M._updateConnectionState()},{iceTransport:R,dtlsTransport:T}},S.prototype._disposeIceAndDtlsTransports=function(M){var R=this.transceivers[M].iceGatherer;R&&(delete R.onlocalcandidate,delete this.transceivers[M].iceGatherer);var T=this.transceivers[M].iceTransport;T&&(delete T.onicestatechange,delete this.transceivers[M].iceTransport);var B=this.transceivers[M].dtlsTransport;B&&(delete B.ondtlsstatechange,delete B.onerror,delete this.transceivers[M].dtlsTransport)},S.prototype._transceive=function(M,R,T){var B=u(M.localCapabilities,M.remoteCapabilities);R&&M.rtpSender&&(B.encodings=M.sendEncodingParameters,B.rtcp={cname:r.localCName,compound:M.rtcpParameters.compound},M.recvEncodingParameters.length&&(B.rtcp.ssrc=M.recvEncodingParameters[0].ssrc),M.rtpSender.send(B)),T&&M.rtpReceiver&&B.codecs.length>0&&(M.kind==="video"&&M.recvEncodingParameters&&v<15019&&M.recvEncodingParameters.forEach(function(F){delete F.rtx}),M.recvEncodingParameters.length?B.encodings=M.recvEncodingParameters:B.encodings=[{}],B.rtcp={compound:M.rtcpParameters.compound},M.rtcpParameters.cname&&(B.rtcp.cname=M.rtcpParameters.cname),M.sendEncodingParameters.length&&(B.rtcp.ssrc=M.sendEncodingParameters[0].ssrc),M.rtpReceiver.receive(B))},S.prototype.setLocalDescription=function(M){var R,T,B=this;if(["offer","answer"].indexOf(M.type)===-1)return Promise.reject(m("TypeError",'Unsupported type "'+M.type+'"'));if(!f("setLocalDescription",M.type,B.signalingState)||B._isClosed)return Promise.reject(m("InvalidStateError","Can not set local "+M.type+" in state "+B.signalingState));if(M.type==="offer")R=r.splitSections(M.sdp),T=R.shift(),R.forEach(function(D,U){var W=r.parseRtpParameters(D);B.transceivers[U].localCapabilities=W}),B.transceivers.forEach(function(D,U){B._gather(D.mid,U)});else if(M.type==="answer"){R=r.splitSections(B._remoteDescription.sdp),T=R.shift();var F=r.matchPrefix(T,"a=ice-lite").length>0;R.forEach(function(D,U){var W=B.transceivers[U],J=W.iceGatherer,ee=W.iceTransport,Q=W.dtlsTransport,Y=W.localCapabilities,se=W.remoteCapabilities;if(!(r.isRejected(D)&&r.matchPrefix(D,"a=bundle-only").length===0)&&!W.rejected){var ae=r.getIceParameters(D,T),ve=r.getDtlsParameters(D,T);F&&(ve.role="server"),B.usingBundle&&U!==0||(B._gather(W.mid,U),ee.state==="new"&&ee.start(J,ae,F?"controlling":"controlled"),Q.state==="new"&&Q.start(ve));var xe=u(Y,se);B._transceive(W,xe.codecs.length>0,!1)}})}return B._localDescription={type:M.type,sdp:M.sdp},M.type==="offer"?B._updateSignalingState("have-local-offer"):B._updateSignalingState("stable"),Promise.resolve()},S.prototype.setRemoteDescription=function(M){var R=this;if(["offer","answer"].indexOf(M.type)===-1)return Promise.reject(m("TypeError",'Unsupported type "'+M.type+'"'));if(!f("setRemoteDescription",M.type,R.signalingState)||R._isClosed)return Promise.reject(m("InvalidStateError","Can not set remote "+M.type+" in state "+R.signalingState));var T={};R.remoteStreams.forEach(function(ee){T[ee.id]=ee});var B=[],F=r.splitSections(M.sdp),D=F.shift(),U=r.matchPrefix(D,"a=ice-lite").length>0,W=r.matchPrefix(D,"a=group:BUNDLE ").length>0;R.usingBundle=W;var J=r.matchPrefix(D,"a=ice-options:")[0];return R.canTrickleIceCandidates=!!J&&J.substr(14).split(" ").indexOf("trickle")>=0,F.forEach(function(ee,Q){var Y=r.splitLines(ee),se=r.getKind(ee),ae=r.isRejected(ee)&&r.matchPrefix(ee,"a=bundle-only").length===0,ve=Y[0].substr(2).split(" ")[2],xe=r.getDirection(ee,D),Ae=r.parseMsid(ee),Ie=r.getMid(ee)||r.generateIdentifier();if(ae||se==="application"&&(ve==="DTLS/SCTP"||ve==="UDP/DTLS/SCTP"))R.transceivers[Q]={mid:Ie,kind:se,protocol:ve,rejected:!0};else{var Le,De,$e,vt,zt,Ve,gn,Xt,mn;!ae&&R.transceivers[Q]&&R.transceivers[Q].rejected&&(R.transceivers[Q]=R._createTransceiver(se,!0));var Nt,vn,it=r.parseRtpParameters(ee);ae||(Nt=r.getIceParameters(ee,D),(vn=r.getDtlsParameters(ee,D)).role="client"),gn=r.parseRtpEncodingParameters(ee);var tt=r.parseRtcpParameters(ee),xt=r.matchPrefix(ee,"a=end-of-candidates",D).length>0,Jt=r.matchPrefix(ee,"a=candidate:").map(function(Kt){return r.parseCandidate(Kt)}).filter(function(Kt){return Kt.component===1});if((M.type==="offer"||M.type==="answer")&&!ae&&W&&Q>0&&R.transceivers[Q]&&(R._disposeIceAndDtlsTransports(Q),R.transceivers[Q].iceGatherer=R.transceivers[0].iceGatherer,R.transceivers[Q].iceTransport=R.transceivers[0].iceTransport,R.transceivers[Q].dtlsTransport=R.transceivers[0].dtlsTransport,R.transceivers[Q].rtpSender&&R.transceivers[Q].rtpSender.setTransport(R.transceivers[0].dtlsTransport),R.transceivers[Q].rtpReceiver&&R.transceivers[Q].rtpReceiver.setTransport(R.transceivers[0].dtlsTransport)),M.type!=="offer"||ae)M.type==="answer"&&!ae&&(De=(Le=R.transceivers[Q]).iceGatherer,$e=Le.iceTransport,vt=Le.dtlsTransport,zt=Le.rtpReceiver,Ve=Le.sendEncodingParameters,Xt=Le.localCapabilities,R.transceivers[Q].recvEncodingParameters=gn,R.transceivers[Q].remoteCapabilities=it,R.transceivers[Q].rtcpParameters=tt,Jt.length&&$e.state==="new"&&(!U&&!xt||W&&Q!==0?Jt.forEach(function(Kt){g(Le.iceTransport,Kt)}):$e.setRemoteCandidates(Jt)),W&&Q!==0||($e.state==="new"&&$e.start(De,Nt,"controlling"),vt.state==="new"&&vt.start(vn)),!u(Le.localCapabilities,Le.remoteCapabilities).codecs.filter(function(Kt){return Kt.name.toLowerCase()==="rtx"}).length&&Le.sendEncodingParameters[0].rtx&&delete Le.sendEncodingParameters[0].rtx,R._transceive(Le,xe==="sendrecv"||xe==="recvonly",xe==="sendrecv"||xe==="sendonly"),!zt||xe!=="sendrecv"&&xe!=="sendonly"?delete Le.rtpReceiver:(mn=zt.track,Ae?(T[Ae.stream]||(T[Ae.stream]=new A.MediaStream),b(mn,T[Ae.stream]),B.push([mn,zt,T[Ae.stream]])):(T.default||(T.default=new A.MediaStream),b(mn,T.default),B.push([mn,zt,T.default]))));else{(Le=R.transceivers[Q]||R._createTransceiver(se)).mid=Ie,Le.iceGatherer||(Le.iceGatherer=R._createIceGatherer(Q,W)),Jt.length&&Le.iceTransport.state==="new"&&(!xt||W&&Q!==0?Jt.forEach(function(Kt){g(Le.iceTransport,Kt)}):Le.iceTransport.setRemoteCandidates(Jt)),Xt=A.RTCRtpReceiver.getCapabilities(se),v<15019&&(Xt.codecs=Xt.codecs.filter(function(Kt){return Kt.name!=="rtx"})),Ve=Le.sendEncodingParameters||[{ssrc:1001*(2*Q+2)}];var Dt,Cn=!1;xe==="sendrecv"||xe==="sendonly"?(Cn=!Le.rtpReceiver,zt=Le.rtpReceiver||new A.RTCRtpReceiver(Le.dtlsTransport,se),Cn&&(mn=zt.track,Ae&&Ae.stream==="-"||(Ae?(T[Ae.stream]||(T[Ae.stream]=new A.MediaStream,Object.defineProperty(T[Ae.stream],"id",{get:function(){return Ae.stream}})),Object.defineProperty(mn,"id",{get:function(){return Ae.track}}),Dt=T[Ae.stream]):(T.default||(T.default=new A.MediaStream),Dt=T.default)),Dt&&(b(mn,Dt),Le.associatedRemoteMediaStreams.push(Dt)),B.push([mn,zt,Dt]))):Le.rtpReceiver&&Le.rtpReceiver.track&&(Le.associatedRemoteMediaStreams.forEach(function(Kt){var ln,ii,Kn=Kt.getTracks().find(function(me){return me.id===Le.rtpReceiver.track.id});Kn&&(ln=Kn,(ii=Kt).removeTrack(ln),ii.dispatchEvent(new A.MediaStreamTrackEvent("removetrack",{track:ln})))}),Le.associatedRemoteMediaStreams=[]),Le.localCapabilities=Xt,Le.remoteCapabilities=it,Le.rtpReceiver=zt,Le.rtcpParameters=tt,Le.sendEncodingParameters=Ve,Le.recvEncodingParameters=gn,R._transceive(R.transceivers[Q],!1,Cn)}}}),R._dtlsRole===void 0&&(R._dtlsRole=M.type==="offer"?"active":"passive"),R._remoteDescription={type:M.type,sdp:M.sdp},M.type==="offer"?R._updateSignalingState("have-remote-offer"):R._updateSignalingState("stable"),Object.keys(T).forEach(function(ee){var Q=T[ee];if(Q.getTracks().length){if(R.remoteStreams.indexOf(Q)===-1){R.remoteStreams.push(Q);var Y=new Event("addstream");Y.stream=Q,A.setTimeout(function(){R._dispatchEvent("addstream",Y)})}B.forEach(function(se){var ae=se[0],ve=se[1];Q.id===se[2].id&&C(R,ae,ve,[Q])})}}),B.forEach(function(ee){ee[2]||C(R,ee[0],ee[1],[])}),A.setTimeout(function(){R&&R.transceivers&&R.transceivers.forEach(function(ee){ee.iceTransport&&ee.iceTransport.state==="new"&&ee.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),ee.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},S.prototype.close=function(){this.transceivers.forEach(function(M){M.iceTransport&&M.iceTransport.stop(),M.dtlsTransport&&M.dtlsTransport.stop(),M.rtpSender&&M.rtpSender.stop(),M.rtpReceiver&&M.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},S.prototype._updateSignalingState=function(M){this.signalingState=M;var R=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",R)},S.prototype._maybeFireNegotiationNeeded=function(){var M=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,A.setTimeout(function(){if(M.needNegotiation){M.needNegotiation=!1;var R=new Event("negotiationneeded");M._dispatchEvent("negotiationneeded",R)}},0))},S.prototype._updateIceConnectionState=function(){var M,R={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(B){B.iceTransport&&!B.rejected&&R[B.iceTransport.state]++}),M="new",R.failed>0?M="failed":R.checking>0?M="checking":R.disconnected>0?M="disconnected":R.new>0?M="new":R.connected>0?M="connected":R.completed>0&&(M="completed"),M!==this.iceConnectionState){this.iceConnectionState=M;var T=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",T)}},S.prototype._updateConnectionState=function(){var M,R={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(B){B.iceTransport&&B.dtlsTransport&&!B.rejected&&(R[B.iceTransport.state]++,R[B.dtlsTransport.state]++)}),R.connected+=R.completed,M="new",R.failed>0?M="failed":R.connecting>0?M="connecting":R.disconnected>0?M="disconnected":R.new>0?M="new":R.connected>0&&(M="connected"),M!==this.connectionState){this.connectionState=M;var T=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",T)}},S.prototype.createOffer=function(){var M=this;if(M._isClosed)return Promise.reject(m("InvalidStateError","Can not call createOffer after close"));var R=M.transceivers.filter(function(U){return U.kind==="audio"}).length,T=M.transceivers.filter(function(U){return U.kind==="video"}).length,B=arguments[0];if(B){if(B.mandatory||B.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");B.offerToReceiveAudio!==void 0&&(R=B.offerToReceiveAudio===!0?1:B.offerToReceiveAudio===!1?0:B.offerToReceiveAudio),B.offerToReceiveVideo!==void 0&&(T=B.offerToReceiveVideo===!0?1:B.offerToReceiveVideo===!1?0:B.offerToReceiveVideo)}for(M.transceivers.forEach(function(U){U.kind==="audio"?--R<0&&(U.wantReceive=!1):U.kind==="video"&&--T<0&&(U.wantReceive=!1)});R>0||T>0;)R>0&&(M._createTransceiver("audio"),R--),T>0&&(M._createTransceiver("video"),T--);var F=r.writeSessionBoilerplate(M._sdpSessionId,M._sdpSessionVersion++);M.transceivers.forEach(function(U,W){var J=U.track,ee=U.kind,Q=U.mid||r.generateIdentifier();U.mid=Q,U.iceGatherer||(U.iceGatherer=M._createIceGatherer(W,M.usingBundle));var Y=A.RTCRtpSender.getCapabilities(ee);v<15019&&(Y.codecs=Y.codecs.filter(function(ae){return ae.name!=="rtx"})),Y.codecs.forEach(function(ae){ae.name==="H264"&&ae.parameters["level-asymmetry-allowed"]===void 0&&(ae.parameters["level-asymmetry-allowed"]="1"),U.remoteCapabilities&&U.remoteCapabilities.codecs&&U.remoteCapabilities.codecs.forEach(function(ve){ae.name.toLowerCase()===ve.name.toLowerCase()&&ae.clockRate===ve.clockRate&&(ae.preferredPayloadType=ve.payloadType)})}),Y.headerExtensions.forEach(function(ae){(U.remoteCapabilities&&U.remoteCapabilities.headerExtensions||[]).forEach(function(ve){ae.uri===ve.uri&&(ae.id=ve.id)})});var se=U.sendEncodingParameters||[{ssrc:1001*(2*W+1)}];J&&v>=15019&&ee==="video"&&!se[0].rtx&&(se[0].rtx={ssrc:se[0].ssrc+1}),U.wantReceive&&(U.rtpReceiver=new A.RTCRtpReceiver(U.dtlsTransport,ee)),U.localCapabilities=Y,U.sendEncodingParameters=se}),M._config.bundlePolicy!=="max-compat"&&(F+="a=group:BUNDLE "+M.transceivers.map(function(U){return U.mid}).join(" ")+`\r
`),F+=`a=ice-options:trickle\r
`,M.transceivers.forEach(function(U,W){F+=l(U,U.localCapabilities,"offer",U.stream,M._dtlsRole),F+=`a=rtcp-rsize\r
`,!U.iceGatherer||M.iceGatheringState==="new"||W!==0&&M.usingBundle||(U.iceGatherer.getLocalCandidates().forEach(function(J){J.component=1,F+="a="+r.writeCandidate(J)+`\r
`}),U.iceGatherer.state==="completed"&&(F+=`a=end-of-candidates\r
`))});var D=new A.RTCSessionDescription({type:"offer",sdp:F});return Promise.resolve(D)},S.prototype.createAnswer=function(){var M=this;if(M._isClosed)return Promise.reject(m("InvalidStateError","Can not call createAnswer after close"));if(M.signalingState!=="have-remote-offer"&&M.signalingState!=="have-local-pranswer")return Promise.reject(m("InvalidStateError","Can not call createAnswer in signalingState "+M.signalingState));var R=r.writeSessionBoilerplate(M._sdpSessionId,M._sdpSessionVersion++);M.usingBundle&&(R+="a=group:BUNDLE "+M.transceivers.map(function(F){return F.mid}).join(" ")+`\r
`),R+=`a=ice-options:trickle\r
`;var T=r.getMediaSections(M._remoteDescription.sdp).length;M.transceivers.forEach(function(F,D){if(!(D+1>T)){if(F.rejected)return F.kind==="application"?F.protocol==="DTLS/SCTP"?R+=`m=application 0 DTLS/SCTP 5000\r
`:R+="m=application 0 "+F.protocol+` webrtc-datachannel\r
`:F.kind==="audio"?R+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:F.kind==="video"&&(R+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(R+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+F.mid+`\r
`);var U;F.stream&&(F.kind==="audio"?U=F.stream.getAudioTracks()[0]:F.kind==="video"&&(U=F.stream.getVideoTracks()[0]),U&&v>=15019&&F.kind==="video"&&!F.sendEncodingParameters[0].rtx&&(F.sendEncodingParameters[0].rtx={ssrc:F.sendEncodingParameters[0].ssrc+1}));var W=u(F.localCapabilities,F.remoteCapabilities);!W.codecs.filter(function(J){return J.name.toLowerCase()==="rtx"}).length&&F.sendEncodingParameters[0].rtx&&delete F.sendEncodingParameters[0].rtx,R+=l(F,W,"answer",F.stream,M._dtlsRole),F.rtcpParameters&&F.rtcpParameters.reducedSize&&(R+=`a=rtcp-rsize\r
`)}});var B=new A.RTCSessionDescription({type:"answer",sdp:R});return Promise.resolve(B)},S.prototype.addIceCandidate=function(M){var R,T=this;return M&&M.sdpMLineIndex===void 0&&!M.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(B,F){if(!T._remoteDescription)return F(m("InvalidStateError","Can not add ICE candidate without a remote description"));if(M&&M.candidate!==""){var D=M.sdpMLineIndex;if(M.sdpMid){for(var U=0;U<T.transceivers.length;U++)if(T.transceivers[U].mid===M.sdpMid){D=U;break}}var W=T.transceivers[D];if(!W)return F(m("OperationError","Can not add ICE candidate"));if(W.rejected)return B();var J=Object.keys(M.candidate).length>0?r.parseCandidate(M.candidate):{};if(J.protocol==="tcp"&&(J.port===0||J.port===9)||J.component&&J.component!==1)return B();if((D===0||D>0&&W.iceTransport!==T.transceivers[0].iceTransport)&&!g(W.iceTransport,J))return F(m("OperationError","Can not add ICE candidate"));var ee=M.candidate.trim();ee.indexOf("a=")===0&&(ee=ee.substr(2)),(R=r.getMediaSections(T._remoteDescription.sdp))[D]+="a="+(J.type?ee:"end-of-candidates")+`\r
`,T._remoteDescription.sdp=r.getDescription(T._remoteDescription.sdp)+R.join("")}else for(var Q=0;Q<T.transceivers.length&&(T.transceivers[Q].rejected||(T.transceivers[Q].iceTransport.addRemoteCandidate({}),(R=r.getMediaSections(T._remoteDescription.sdp))[Q]+=`a=end-of-candidates\r
`,T._remoteDescription.sdp=r.getDescription(T._remoteDescription.sdp)+R.join(""),!T.usingBundle));Q++);B()})},S.prototype.getStats=function(M){if(M&&M instanceof A.MediaStreamTrack){var R=null;if(this.transceivers.forEach(function(B){B.rtpSender&&B.rtpSender.track===M?R=B.rtpSender:B.rtpReceiver&&B.rtpReceiver.track===M&&(R=B.rtpReceiver)}),!R)throw m("InvalidAccessError","Invalid selector.");return R.getStats()}var T=[];return this.transceivers.forEach(function(B){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(F){B[F]&&T.push(B[F].getStats())})}),Promise.all(T).then(function(B){var F=new Map;return B.forEach(function(D){D.forEach(function(U){F.set(U.id,U)})}),F})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(M){var R=A[M];if(R&&R.prototype&&R.prototype.getStats){var T=R.prototype.getStats;R.prototype.getStats=function(){return T.apply(this).then(function(B){var F=new Map;return Object.keys(B).forEach(function(D){B[D].type=o(B[D]),F.set(D,B[D])}),F})}}});var I=["createOffer","createAnswer"];return I.forEach(function(M){var R=S.prototype[M];S.prototype[M]=function(){var T=arguments;return typeof T[0]=="function"||typeof T[1]=="function"?R.apply(this,[arguments[2]]).then(function(B){typeof T[0]=="function"&&T[0].apply(null,[B])},function(B){typeof T[1]=="function"&&T[1].apply(null,[B])}):R.apply(this,arguments)}}),(I=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(M){var R=S.prototype[M];S.prototype[M]=function(){var T=arguments;return typeof T[1]=="function"||typeof T[2]=="function"?R.apply(this,arguments).then(function(){typeof T[1]=="function"&&T[1].apply(null)},function(B){typeof T[2]=="function"&&T[2].apply(null,[B])}):R.apply(this,arguments)}}),["getStats"].forEach(function(M){var R=S.prototype[M];S.prototype[M]=function(){var T=arguments;return typeof T[1]=="function"?R.apply(this,arguments).then(function(){typeof T[1]=="function"&&T[1].apply(null)}):R.apply(this,arguments)}}),S}},{sdp:"YHvh"}],YdKx:[function(t,n,i){function r(o){var l=o&&o.navigator,h=l.mediaDevices.getUserMedia.bind(l.mediaDevices);l.mediaDevices.getUserMedia=function(u){return h(u).catch(function(f){return Promise.reject(function(g){return{name:{PermissionDeniedError:"NotAllowedError"}[g.name]||g.name,message:g.message,constraint:g.constraint,toString:function(){return this.name}}}(f))})}}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=r},{}],P3bV:[function(t,n,i){function r(o){"getDisplayMedia"in o.navigator&&o.navigator.mediaDevices&&(o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||(o.navigator.mediaDevices.getDisplayMedia=o.navigator.getDisplayMedia.bind(o.navigator)))}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],XRic:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimPeerConnection=A,i.shimReplaceTrack=v,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return h.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return u.shimGetDisplayMedia}});var r=m(t("../utils")),o=t("./filtericeservers"),l=f(t("rtcpeerconnection-shim")),h=t("./getusermedia"),u=t("./getdisplaymedia");function f(b){return b&&b.__esModule?b:{default:b}}function g(){if(typeof WeakMap!="function")return null;var b=new WeakMap;return g=function(){return b},b}function m(b){if(b&&b.__esModule)return b;if(b===null||typeof b!="object"&&typeof b!="function")return{default:b};var C=g();if(C&&C.has(b))return C.get(b);var S={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var M in b)if(Object.prototype.hasOwnProperty.call(b,M)){var R=I?Object.getOwnPropertyDescriptor(b,M):null;R&&(R.get||R.set)?Object.defineProperty(S,M,R):S[M]=b[M]}return S.default=b,C&&C.set(b,S),S}function A(b,C){if(b.RTCIceGatherer&&(b.RTCIceCandidate||(b.RTCIceCandidate=function(M){return M}),b.RTCSessionDescription||(b.RTCSessionDescription=function(M){return M}),C.version<15025)){var S=Object.getOwnPropertyDescriptor(b.MediaStreamTrack.prototype,"enabled");Object.defineProperty(b.MediaStreamTrack.prototype,"enabled",{set:function(M){S.set.call(this,M);var R=new Event("enabled");R.enabled=M,this.dispatchEvent(R)}})}!b.RTCRtpSender||"dtmf"in b.RTCRtpSender.prototype||Object.defineProperty(b.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new b.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),b.RTCDtmfSender&&!b.RTCDTMFSender&&(b.RTCDTMFSender=b.RTCDtmfSender);var I=(0,l.default)(b,C.version);b.RTCPeerConnection=function(M){return M&&M.iceServers&&(M.iceServers=(0,o.filterIceServers)(M.iceServers,C.version),r.log("ICE servers after filtering:",M.iceServers)),new I(M)},b.RTCPeerConnection.prototype=I.prototype}function v(b){!b.RTCRtpSender||"replaceTrack"in b.RTCRtpSender.prototype||(b.RTCRtpSender.prototype.replaceTrack=b.RTCRtpSender.prototype.setTrack)}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=u;var r=l(t("../utils"));function o(){if(typeof WeakMap!="function")return null;var f=new WeakMap;return o=function(){return f},f}function l(f){if(f&&f.__esModule)return f;if(f===null||typeof f!="object"&&typeof f!="function")return{default:f};var g=o();if(g&&g.has(f))return g.get(f);var m={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in f)if(Object.prototype.hasOwnProperty.call(f,v)){var b=A?Object.getOwnPropertyDescriptor(f,v):null;b&&(b.get||b.set)?Object.defineProperty(m,v,b):m[v]=f[v]}return m.default=f,g&&g.set(f,m),m}function h(f){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g})(f)}function u(f,g){var m=f&&f.navigator,A=f&&f.MediaStreamTrack;if(m.getUserMedia=function(I,M,R){r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),m.mediaDevices.getUserMedia(I).then(M,R)},!(g.version>55&&"autoGainControl"in m.mediaDevices.getSupportedConstraints())){var v=function(I,M,R){M in I&&!(R in I)&&(I[R]=I[M],delete I[M])},b=m.mediaDevices.getUserMedia.bind(m.mediaDevices);if(m.mediaDevices.getUserMedia=function(I){return h(I)==="object"&&h(I.audio)==="object"&&(I=JSON.parse(JSON.stringify(I)),v(I.audio,"autoGainControl","mozAutoGainControl"),v(I.audio,"noiseSuppression","mozNoiseSuppression")),b(I)},A&&A.prototype.getSettings){var C=A.prototype.getSettings;A.prototype.getSettings=function(){var I=C.apply(this,arguments);return v(I,"mozAutoGainControl","autoGainControl"),v(I,"mozNoiseSuppression","noiseSuppression"),I}}if(A&&A.prototype.applyConstraints){var S=A.prototype.applyConstraints;A.prototype.applyConstraints=function(I){return this.kind==="audio"&&h(I)==="object"&&(I=JSON.parse(JSON.stringify(I)),v(I,"autoGainControl","mozAutoGainControl"),v(I,"noiseSuppression","mozNoiseSuppression")),S.apply(this,[I])}}}}},{"../utils":"iSxC"}],UuGU:[function(t,n,i){function r(o,l){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(h){if(!h||!h.video){var u=new DOMException("getDisplayMedia without video constraints is undefined");return u.name="NotFoundError",u.code=8,Promise.reject(u)}return h.video===!0?h.video={mediaSource:l}:h.video.mediaSource=l,o.navigator.mediaDevices.getUserMedia(h)})}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],Fzdr:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimOnTrack=m,i.shimPeerConnection=A,i.shimSenderGetStats=v,i.shimReceiverGetStats=b,i.shimRemoveStream=C,i.shimRTCDataChannel=S,i.shimAddTransceiver=I,i.shimGetParameters=M,i.shimCreateOffer=R,i.shimCreateAnswer=T,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return l.shimGetDisplayMedia}});var r=u(t("../utils")),o=t("./getusermedia"),l=t("./getdisplaymedia");function h(){if(typeof WeakMap!="function")return null;var B=new WeakMap;return h=function(){return B},B}function u(B){if(B&&B.__esModule)return B;if(B===null||typeof B!="object"&&typeof B!="function")return{default:B};var F=h();if(F&&F.has(B))return F.get(B);var D={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in B)if(Object.prototype.hasOwnProperty.call(B,W)){var J=U?Object.getOwnPropertyDescriptor(B,W):null;J&&(J.get||J.set)?Object.defineProperty(D,W,J):D[W]=B[W]}return D.default=B,F&&F.set(B,D),D}function f(B,F,D){return F in B?Object.defineProperty(B,F,{value:D,enumerable:!0,configurable:!0,writable:!0}):B[F]=D,B}function g(B){return(g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F})(B)}function m(B){g(B)==="object"&&B.RTCTrackEvent&&"receiver"in B.RTCTrackEvent.prototype&&!("transceiver"in B.RTCTrackEvent.prototype)&&Object.defineProperty(B.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function A(B,F){if(g(B)==="object"&&(B.RTCPeerConnection||B.mozRTCPeerConnection)){!B.RTCPeerConnection&&B.mozRTCPeerConnection&&(B.RTCPeerConnection=B.mozRTCPeerConnection),F.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(W){var J=B.RTCPeerConnection.prototype[W],ee=f({},W,function(){return arguments[0]=new(W==="addIceCandidate"?B.RTCIceCandidate:B.RTCSessionDescription)(arguments[0]),J.apply(this,arguments)});B.RTCPeerConnection.prototype[W]=ee[W]});var D={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},U=B.RTCPeerConnection.prototype.getStats;B.RTCPeerConnection.prototype.getStats=function(){var[W,J,ee]=arguments;return U.apply(this,[W||null]).then(function(Q){if(F.version<53&&!J)try{Q.forEach(function(Y){Y.type=D[Y.type]||Y.type})}catch(Y){if(Y.name!=="TypeError")throw Y;Q.forEach(function(se,ae){Q.set(ae,Object.assign({},se,{type:D[se.type]||se.type}))})}return Q}).then(J,ee)}}}function v(B){if(g(B)==="object"&&B.RTCPeerConnection&&B.RTCRtpSender&&!(B.RTCRtpSender&&"getStats"in B.RTCRtpSender.prototype)){var F=B.RTCPeerConnection.prototype.getSenders;F&&(B.RTCPeerConnection.prototype.getSenders=function(){var U=this,W=F.apply(this,[]);return W.forEach(function(J){return J._pc=U}),W});var D=B.RTCPeerConnection.prototype.addTrack;D&&(B.RTCPeerConnection.prototype.addTrack=function(){var U=D.apply(this,arguments);return U._pc=this,U}),B.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function b(B){if(g(B)==="object"&&B.RTCPeerConnection&&B.RTCRtpSender&&!(B.RTCRtpSender&&"getStats"in B.RTCRtpReceiver.prototype)){var F=B.RTCPeerConnection.prototype.getReceivers;F&&(B.RTCPeerConnection.prototype.getReceivers=function(){var D=this,U=F.apply(this,[]);return U.forEach(function(W){return W._pc=D}),U}),r.wrapPeerConnectionEvent(B,"track",function(D){return D.receiver._pc=D.srcElement,D}),B.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function C(B){!B.RTCPeerConnection||"removeStream"in B.RTCPeerConnection.prototype||(B.RTCPeerConnection.prototype.removeStream=function(F){var D=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(U){U.track&&F.getTracks().includes(U.track)&&D.removeTrack(U)})})}function S(B){B.DataChannel&&!B.RTCDataChannel&&(B.RTCDataChannel=B.DataChannel)}function I(B){if(g(B)==="object"&&B.RTCPeerConnection){var F=B.RTCPeerConnection.prototype.addTransceiver;F&&(B.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var D=arguments[1],U=D&&"sendEncodings"in D;U&&D.sendEncodings.forEach(function(Q){if("rid"in Q&&!/^[a-z0-9]{0,16}$/i.test(Q.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in Q&&!(parseFloat(Q.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in Q&&!(parseFloat(Q.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var W=F.apply(this,arguments);if(U){var{sender:J}=W,ee=J.getParameters();"encodings"in ee&&(ee.encodings.length!==1||Object.keys(ee.encodings[0]).length!==0)||(ee.encodings=D.sendEncodings,J.sendEncodings=D.sendEncodings,this.setParametersPromises.push(J.setParameters(ee).then(function(){delete J.sendEncodings}).catch(function(){delete J.sendEncodings})))}return W})}}function M(B){if(g(B)==="object"&&B.RTCRtpSender){var F=B.RTCRtpSender.prototype.getParameters;F&&(B.RTCRtpSender.prototype.getParameters=function(){var D=F.apply(this,arguments);return"encodings"in D||(D.encodings=[].concat(this.sendEncodings||[{}])),D})}}function R(B){if(g(B)==="object"&&B.RTCPeerConnection){var F=B.RTCPeerConnection.prototype.createOffer;B.RTCPeerConnection.prototype.createOffer=function(){var D=arguments,U=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return F.apply(U,D)}).finally(function(){U.setParametersPromises=[]}):F.apply(this,arguments)}}}function T(B){if(g(B)==="object"&&B.RTCPeerConnection){var F=B.RTCPeerConnection.prototype.createAnswer;B.RTCPeerConnection.prototype.createAnswer=function(){var D=arguments,U=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return F.apply(U,D)}).finally(function(){U.setParametersPromises=[]}):F.apply(this,arguments)}}}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimLocalStreamsAPI=u,i.shimRemoteStreamsAPI=f,i.shimCallbacksAPI=g,i.shimGetUserMedia=m,i.shimConstraints=A,i.shimRTCIceServerUrls=v,i.shimTrackEventTransceiver=b,i.shimCreateOfferLegacy=C,i.shimAudioContext=S;var r=l(t("../utils"));function o(){if(typeof WeakMap!="function")return null;var I=new WeakMap;return o=function(){return I},I}function l(I){if(I&&I.__esModule)return I;if(I===null||typeof I!="object"&&typeof I!="function")return{default:I};var M=o();if(M&&M.has(I))return M.get(I);var R={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in I)if(Object.prototype.hasOwnProperty.call(I,B)){var F=T?Object.getOwnPropertyDescriptor(I,B):null;F&&(F.get||F.set)?Object.defineProperty(R,B,F):R[B]=I[B]}return R.default=I,M&&M.set(I,R),R}function h(I){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(I)}function u(I){if(h(I)==="object"&&I.RTCPeerConnection){if("getLocalStreams"in I.RTCPeerConnection.prototype||(I.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in I.RTCPeerConnection.prototype)){var M=I.RTCPeerConnection.prototype.addTrack;I.RTCPeerConnection.prototype.addStream=function(R){var T=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(R)||this._localStreams.push(R),R.getAudioTracks().forEach(function(B){return M.call(T,B,R)}),R.getVideoTracks().forEach(function(B){return M.call(T,B,R)})},I.RTCPeerConnection.prototype.addTrack=function(R){for(var T=this,B=arguments.length,F=new Array(B>1?B-1:0),D=1;D<B;D++)F[D-1]=arguments[D];return F&&F.forEach(function(U){T._localStreams?T._localStreams.includes(U)||T._localStreams.push(U):T._localStreams=[U]}),M.apply(this,arguments)}}"removeStream"in I.RTCPeerConnection.prototype||(I.RTCPeerConnection.prototype.removeStream=function(R){var T=this;this._localStreams||(this._localStreams=[]);var B=this._localStreams.indexOf(R);if(B!==-1){this._localStreams.splice(B,1);var F=R.getTracks();this.getSenders().forEach(function(D){F.includes(D.track)&&T.removeTrack(D)})}})}}function f(I){if(h(I)==="object"&&I.RTCPeerConnection&&("getRemoteStreams"in I.RTCPeerConnection.prototype||(I.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in I.RTCPeerConnection.prototype))){Object.defineProperty(I.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(R){var T=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=R),this.addEventListener("track",this._onaddstreampoly=function(B){B.streams.forEach(function(F){if(T._remoteStreams||(T._remoteStreams=[]),!T._remoteStreams.includes(F)){T._remoteStreams.push(F);var D=new Event("addstream");D.stream=F,T.dispatchEvent(D)}})})}});var M=I.RTCPeerConnection.prototype.setRemoteDescription;I.RTCPeerConnection.prototype.setRemoteDescription=function(){var R=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(T){T.streams.forEach(function(B){if(R._remoteStreams||(R._remoteStreams=[]),!(R._remoteStreams.indexOf(B)>=0)){R._remoteStreams.push(B);var F=new Event("addstream");F.stream=B,R.dispatchEvent(F)}})}),M.apply(R,arguments)}}}function g(I){if(h(I)==="object"&&I.RTCPeerConnection){var M=I.RTCPeerConnection.prototype,R=M.createOffer,T=M.createAnswer,B=M.setLocalDescription,F=M.setRemoteDescription,D=M.addIceCandidate;M.createOffer=function(W,J){var ee=arguments.length>=2?arguments[2]:arguments[0],Q=R.apply(this,[ee]);return J?(Q.then(W,J),Promise.resolve()):Q},M.createAnswer=function(W,J){var ee=arguments.length>=2?arguments[2]:arguments[0],Q=T.apply(this,[ee]);return J?(Q.then(W,J),Promise.resolve()):Q};var U=function(W,J,ee){var Q=B.apply(this,[W]);return ee?(Q.then(J,ee),Promise.resolve()):Q};M.setLocalDescription=U,U=function(W,J,ee){var Q=F.apply(this,[W]);return ee?(Q.then(J,ee),Promise.resolve()):Q},M.setRemoteDescription=U,U=function(W,J,ee){var Q=D.apply(this,[W]);return ee?(Q.then(J,ee),Promise.resolve()):Q},M.addIceCandidate=U}}function m(I){var M=I&&I.navigator;if(M.mediaDevices&&M.mediaDevices.getUserMedia){var R=M.mediaDevices,T=R.getUserMedia.bind(R);M.mediaDevices.getUserMedia=function(B){return T(A(B))}}!M.getUserMedia&&M.mediaDevices&&M.mediaDevices.getUserMedia&&(M.getUserMedia=function(B,F,D){M.mediaDevices.getUserMedia(B).then(F,D)}.bind(M))}function A(I){return I&&I.video!==void 0?Object.assign({},I,{video:r.compactObject(I.video)}):I}function v(I){if(I.RTCPeerConnection){var M=I.RTCPeerConnection;I.RTCPeerConnection=function(R,T){if(R&&R.iceServers){for(var B=[],F=0;F<R.iceServers.length;F++){var D=R.iceServers[F];!D.hasOwnProperty("urls")&&D.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(D=JSON.parse(JSON.stringify(D))).urls=D.url,delete D.url,B.push(D)):B.push(R.iceServers[F])}R.iceServers=B}return new M(R,T)},I.RTCPeerConnection.prototype=M.prototype,"generateCertificate"in M&&Object.defineProperty(I.RTCPeerConnection,"generateCertificate",{get:function(){return M.generateCertificate}})}}function b(I){h(I)==="object"&&I.RTCTrackEvent&&"receiver"in I.RTCTrackEvent.prototype&&!("transceiver"in I.RTCTrackEvent.prototype)&&Object.defineProperty(I.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function C(I){var M=I.RTCPeerConnection.prototype.createOffer;I.RTCPeerConnection.prototype.createOffer=function(R){if(R){R.offerToReceiveAudio!==void 0&&(R.offerToReceiveAudio=!!R.offerToReceiveAudio);var T=this.getTransceivers().find(function(F){return F.receiver.track.kind==="audio"});R.offerToReceiveAudio===!1&&T?T.direction==="sendrecv"?T.setDirection?T.setDirection("sendonly"):T.direction="sendonly":T.direction==="recvonly"&&(T.setDirection?T.setDirection("inactive"):T.direction="inactive"):R.offerToReceiveAudio!==!0||T||this.addTransceiver("audio"),R.offerToReceiveVideo!==void 0&&(R.offerToReceiveVideo=!!R.offerToReceiveVideo);var B=this.getTransceivers().find(function(F){return F.receiver.track.kind==="video"});R.offerToReceiveVideo===!1&&B?B.direction==="sendrecv"?B.setDirection?B.setDirection("sendonly"):B.direction="sendonly":B.direction==="recvonly"&&(B.setDirection?B.setDirection("inactive"):B.direction="inactive"):R.offerToReceiveVideo!==!0||B||this.addTransceiver("video")}return M.apply(this,arguments)}}function S(I){h(I)!=="object"||I.AudioContext||(I.AudioContext=I.webkitAudioContext)}},{"../utils":"iSxC"}],GOQK:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimRTCIceCandidate=g,i.shimMaxMessageSize=m,i.shimSendThrowTypeError=A,i.shimConnectionState=v,i.removeExtmapAllowMixed=b,i.shimAddIceCandidateNullOrEmpty=C;var r=u(t("sdp")),o=h(t("./utils"));function l(){if(typeof WeakMap!="function")return null;var S=new WeakMap;return l=function(){return S},S}function h(S){if(S&&S.__esModule)return S;if(S===null||typeof S!="object"&&typeof S!="function")return{default:S};var I=l();if(I&&I.has(S))return I.get(S);var M={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var T in S)if(Object.prototype.hasOwnProperty.call(S,T)){var B=R?Object.getOwnPropertyDescriptor(S,T):null;B&&(B.get||B.set)?Object.defineProperty(M,T,B):M[T]=S[T]}return M.default=S,I&&I.set(S,M),M}function u(S){return S&&S.__esModule?S:{default:S}}function f(S){return(f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I})(S)}function g(S){if(S.RTCIceCandidate&&!(S.RTCIceCandidate&&"foundation"in S.RTCIceCandidate.prototype)){var I=S.RTCIceCandidate;S.RTCIceCandidate=function(M){if(f(M)==="object"&&M.candidate&&M.candidate.indexOf("a=")===0&&((M=JSON.parse(JSON.stringify(M))).candidate=M.candidate.substr(2)),M.candidate&&M.candidate.length){var R=new I(M),T=r.default.parseCandidate(M.candidate),B=Object.assign(R,T);return B.toJSON=function(){return{candidate:B.candidate,sdpMid:B.sdpMid,sdpMLineIndex:B.sdpMLineIndex,usernameFragment:B.usernameFragment}},B}return new I(M)},S.RTCIceCandidate.prototype=I.prototype,o.wrapPeerConnectionEvent(S,"icecandidate",function(M){return M.candidate&&Object.defineProperty(M,"candidate",{value:new S.RTCIceCandidate(M.candidate),writable:"false"}),M})}}function m(S,I){if(S.RTCPeerConnection){"sctp"in S.RTCPeerConnection.prototype||Object.defineProperty(S.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var M=S.RTCPeerConnection.prototype.setRemoteDescription;S.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,I.browser==="chrome"&&I.version>=76){var{sdpSemantics:R}=this.getConfiguration();R==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(ee){if(!ee||!ee.sdp)return!1;var Q=r.default.splitSections(ee.sdp);return Q.shift(),Q.some(function(Y){var se=r.default.parseMLine(Y);return se&&se.kind==="application"&&se.protocol.indexOf("SCTP")!==-1})}(arguments[0])){var T,B=function(ee){var Q=ee.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(Q===null||Q.length<2)return-1;var Y=parseInt(Q[1],10);return Y!=Y?-1:Y}(arguments[0]),F=(W=B,J=65536,I.browser==="firefox"&&(J=I.version<57?W===-1?16384:2147483637:I.version<60?I.version===57?65535:65536:2147483637),J),D=function(ee,Q){var Y=65536;I.browser==="firefox"&&I.version===57&&(Y=65535);var se=r.default.matchPrefix(ee.sdp,"a=max-message-size:");return se.length>0?Y=parseInt(se[0].substr(19),10):I.browser==="firefox"&&Q!==-1&&(Y=2147483637),Y}(arguments[0],B);T=F===0&&D===0?Number.POSITIVE_INFINITY:F===0||D===0?Math.max(F,D):Math.min(F,D);var U={};Object.defineProperty(U,"maxMessageSize",{get:function(){return T}}),this._sctp=U}var W,J;return M.apply(this,arguments)}}}function A(S){if(S.RTCPeerConnection&&"createDataChannel"in S.RTCPeerConnection.prototype){var I=S.RTCPeerConnection.prototype.createDataChannel;S.RTCPeerConnection.prototype.createDataChannel=function(){var R=I.apply(this,arguments);return M(R,this),R},o.wrapPeerConnectionEvent(S,"datachannel",function(R){return M(R.channel,R.target),R})}function M(R,T){var B=R.send;R.send=function(){var F=arguments[0],D=F.length||F.size||F.byteLength;if(R.readyState==="open"&&T.sctp&&D>T.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+T.sctp.maxMessageSize+" bytes)");return B.apply(R,arguments)}}}function v(S){if(S.RTCPeerConnection&&!("connectionState"in S.RTCPeerConnection.prototype)){var I=S.RTCPeerConnection.prototype;Object.defineProperty(I,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(I,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(M){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),M&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=M)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(M){var R=I[M];I[M]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(T){var B=T.target;if(B._lastConnectionState!==B.connectionState){B._lastConnectionState=B.connectionState;var F=new Event("connectionstatechange",T);B.dispatchEvent(F)}return T},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),R.apply(this,arguments)}})}}function b(S,I){if(S.RTCPeerConnection&&!(I.browser==="chrome"&&I.version>=71||I.browser==="safari"&&I.version>=605)){var M=S.RTCPeerConnection.prototype.setRemoteDescription;S.RTCPeerConnection.prototype.setRemoteDescription=function(R){if(R&&R.sdp&&R.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){var T=R.sdp.split(`
`).filter(function(B){return B.trim()!=="a=extmap-allow-mixed"}).join(`
`);S.RTCSessionDescription&&R instanceof S.RTCSessionDescription?arguments[0]=new S.RTCSessionDescription({type:R.type,sdp:T}):R.sdp=T}return M.apply(this,arguments)}}}function C(S,I){if(S.RTCPeerConnection&&S.RTCPeerConnection.prototype){var M=S.RTCPeerConnection.prototype.addIceCandidate;M&&M.length!==0&&(S.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(I.browser==="chrome"&&I.version<78||I.browser==="firefox"&&I.version<68||I.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():M.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.adapterFactory=A;var r=m(t("./utils")),o=m(t("./chrome/chrome_shim")),l=m(t("./edge/edge_shim")),h=m(t("./firefox/firefox_shim")),u=m(t("./safari/safari_shim")),f=m(t("./common_shim"));function g(){if(typeof WeakMap!="function")return null;var v=new WeakMap;return g=function(){return v},v}function m(v){if(v&&v.__esModule)return v;if(v===null||typeof v!="object"&&typeof v!="function")return{default:v};var b=g();if(b&&b.has(v))return b.get(v);var C={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in v)if(Object.prototype.hasOwnProperty.call(v,I)){var M=S?Object.getOwnPropertyDescriptor(v,I):null;M&&(M.get||M.set)?Object.defineProperty(C,I,M):C[I]=v[I]}return C.default=v,b&&b.set(v,C),C}function A(){var{window:v}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},C=r.log,S=r.detectBrowser(v),I={browserDetails:S,commonShim:f,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(S.browser){case"chrome":if(!o||!o.shimPeerConnection||!b.shimChrome)return C("Chrome shim is not included in this adapter release."),I;if(S.version===null)return C("Chrome shim can not determine version, not shimming."),I;C("adapter.js shimming chrome."),I.browserShim=o,f.shimAddIceCandidateNullOrEmpty(v,S),o.shimGetUserMedia(v,S),o.shimMediaStream(v,S),o.shimPeerConnection(v,S),o.shimOnTrack(v,S),o.shimAddTrackRemoveTrack(v,S),o.shimGetSendersWithDtmf(v,S),o.shimGetStats(v,S),o.shimSenderReceiverGetStats(v,S),o.fixNegotiationNeeded(v,S),f.shimRTCIceCandidate(v,S),f.shimConnectionState(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S),f.removeExtmapAllowMixed(v,S);break;case"firefox":if(!h||!h.shimPeerConnection||!b.shimFirefox)return C("Firefox shim is not included in this adapter release."),I;C("adapter.js shimming firefox."),I.browserShim=h,f.shimAddIceCandidateNullOrEmpty(v,S),h.shimGetUserMedia(v,S),h.shimPeerConnection(v,S),h.shimOnTrack(v,S),h.shimRemoveStream(v,S),h.shimSenderGetStats(v,S),h.shimReceiverGetStats(v,S),h.shimRTCDataChannel(v,S),h.shimAddTransceiver(v,S),h.shimGetParameters(v,S),h.shimCreateOffer(v,S),h.shimCreateAnswer(v,S),f.shimRTCIceCandidate(v,S),f.shimConnectionState(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S);break;case"edge":if(!l||!l.shimPeerConnection||!b.shimEdge)return C("MS edge shim is not included in this adapter release."),I;C("adapter.js shimming edge."),I.browserShim=l,l.shimGetUserMedia(v,S),l.shimGetDisplayMedia(v,S),l.shimPeerConnection(v,S),l.shimReplaceTrack(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S);break;case"safari":if(!u||!b.shimSafari)return C("Safari shim is not included in this adapter release."),I;C("adapter.js shimming safari."),I.browserShim=u,f.shimAddIceCandidateNullOrEmpty(v,S),u.shimRTCIceServerUrls(v,S),u.shimCreateOfferLegacy(v,S),u.shimCallbacksAPI(v,S),u.shimLocalStreamsAPI(v,S),u.shimRemoteStreamsAPI(v,S),u.shimTrackEventTransceiver(v,S),u.shimGetUserMedia(v,S),u.shimAudioContext(v,S),f.shimRTCIceCandidate(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S),f.removeExtmapAllowMixed(v,S);break;default:C("Unsupported browser!")}return I}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./adapter_factory.js"),o=(0,r.adapterFactory)({window:typeof window>"u"?void 0:window}),l=o;i.default=l},{"./adapter_factory.js":"KtlG"}],sXtV:[function(t,n,i){var r=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(i,"__esModule",{value:!0}),i.webRTCAdapter=void 0;var o=r(t("webrtc-adapter"));i.webRTCAdapter=o.default},{"webrtc-adapter":"tI1X"}],I31f:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Supports=void 0;var r=t("./adapter");i.Supports=new(function(){function o(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return o.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},o.prototype.isBrowserSupported=function(){var l=this.getBrowser(),h=this.getVersion();return!!this.supportedBrowsers.includes(l)&&(l==="chrome"?h>=this.minChromeVersion:l==="firefox"?h>=this.minFirefoxVersion:l==="safari"&&!this.isIOS&&h>=this.minSafariVersion)},o.prototype.getBrowser=function(){return r.webRTCAdapter.browserDetails.browser},o.prototype.getVersion=function(){return r.webRTCAdapter.browserDetails.version||0},o.prototype.isUnifiedPlanSupported=function(){var l,h=this.getBrowser(),u=r.webRTCAdapter.browserDetails.version||0;if(h==="chrome"&&u<72)return!1;if(h==="firefox"&&u>=59)return!0;if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;var f=!1;try{(l=new RTCPeerConnection).addTransceiver("audio"),f=!0}catch{}finally{l&&l.close()}return f},o.prototype.toString=function(){return`Supports: 
    browser:`+this.getBrowser()+` 
    version:`+this.getVersion()+` 
    isIOS:`+this.isIOS+` 
    isWebRTCSupported:`+this.isWebRTCSupported()+` 
    isBrowserSupported:`+this.isBrowserSupported()+` 
    isUnifiedPlanSupported:`+this.isUnifiedPlanSupported()},o}())},{"./adapter":"sXtV"}],BHXf:[function(t,n,i){var r=this&&this.__createBinding||(Object.create?function(g,m,A,v){v===void 0&&(v=A),Object.defineProperty(g,v,{enumerable:!0,get:function(){return m[A]}})}:function(g,m,A,v){v===void 0&&(v=A),g[v]=m[A]}),o=this&&this.__setModuleDefault||(Object.create?function(g,m){Object.defineProperty(g,"default",{enumerable:!0,value:m})}:function(g,m){g.default=m}),l=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var m={};if(g!=null)for(var A in g)A!=="default"&&Object.prototype.hasOwnProperty.call(g,A)&&r(m,g,A);return o(m,g),m};Object.defineProperty(i,"__esModule",{value:!0}),i.util=void 0;var h=l(t("peerjs-js-binarypack")),u=t("./supports"),f={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};i.util=new(function(){function g(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=f,this.browser=u.Supports.getBrowser(),this.browserVersion=u.Supports.getVersion(),this.supports=function(){var m,A={browser:u.Supports.isBrowserSupported(),webRTC:u.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!A.webRTC)return A;try{m=new RTCPeerConnection(f),A.audioVideo=!0;var v=void 0;try{v=m.createDataChannel("_PEERJSTEST",{ordered:!0}),A.data=!0,A.reliable=!!v.ordered;try{v.binaryType="blob",A.binaryBlob=!u.Supports.isIOS}catch{}}catch{}finally{v&&v.close()}}catch{}finally{m&&m.close()}return A}(),this.pack=h.pack,this.unpack=h.unpack,this._dataCount=1}return g.prototype.noop=function(){},g.prototype.validateId=function(m){return!m||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(m)},g.prototype.chunk=function(m){for(var A=[],v=m.size,b=Math.ceil(v/i.util.chunkedMTU),C=0,S=0;S<v;){var I=Math.min(v,S+i.util.chunkedMTU),M=m.slice(S,I),R={__peerData:this._dataCount,n:C,data:M,total:b};A.push(R),S=I,C++}return this._dataCount++,A},g.prototype.blobToArrayBuffer=function(m,A){var v=new FileReader;return v.onload=function(b){b.target&&A(b.target.result)},v.readAsArrayBuffer(m),v},g.prototype.binaryStringToArrayBuffer=function(m){for(var A=new Uint8Array(m.length),v=0;v<m.length;v++)A[v]=255&m.charCodeAt(v);return A.buffer},g.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},g.prototype.isSecure=function(){return location.protocol==="https:"},g}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(t,n,i){var r=Object.prototype.hasOwnProperty,o="~";function l(){}function h(m,A,v){this.fn=m,this.context=A,this.once=v||!1}function u(m,A,v,b,C){if(typeof v!="function")throw new TypeError("The listener must be a function");var S=new h(v,b||m,C),I=o?o+A:A;return m._events[I]?m._events[I].fn?m._events[I]=[m._events[I],S]:m._events[I].push(S):(m._events[I]=S,m._eventsCount++),m}function f(m,A){--m._eventsCount==0?m._events=new l:delete m._events[A]}function g(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(o=!1)),g.prototype.eventNames=function(){var m,A,v=[];if(this._eventsCount===0)return v;for(A in m=this._events)r.call(m,A)&&v.push(o?A.slice(1):A);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(m)):v},g.prototype.listeners=function(m){var A=o?o+m:m,v=this._events[A];if(!v)return[];if(v.fn)return[v.fn];for(var b=0,C=v.length,S=new Array(C);b<C;b++)S[b]=v[b].fn;return S},g.prototype.listenerCount=function(m){var A=o?o+m:m,v=this._events[A];return v?v.fn?1:v.length:0},g.prototype.emit=function(m,A,v,b,C,S){var I=o?o+m:m;if(!this._events[I])return!1;var M,R,T=this._events[I],B=arguments.length;if(T.fn){switch(T.once&&this.removeListener(m,T.fn,void 0,!0),B){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,A),!0;case 3:return T.fn.call(T.context,A,v),!0;case 4:return T.fn.call(T.context,A,v,b),!0;case 5:return T.fn.call(T.context,A,v,b,C),!0;case 6:return T.fn.call(T.context,A,v,b,C,S),!0}for(R=1,M=new Array(B-1);R<B;R++)M[R-1]=arguments[R];T.fn.apply(T.context,M)}else{var F,D=T.length;for(R=0;R<D;R++)switch(T[R].once&&this.removeListener(m,T[R].fn,void 0,!0),B){case 1:T[R].fn.call(T[R].context);break;case 2:T[R].fn.call(T[R].context,A);break;case 3:T[R].fn.call(T[R].context,A,v);break;case 4:T[R].fn.call(T[R].context,A,v,b);break;default:if(!M)for(F=1,M=new Array(B-1);F<B;F++)M[F-1]=arguments[F];T[R].fn.apply(T[R].context,M)}}return!0},g.prototype.on=function(m,A,v){return u(this,m,A,v,!1)},g.prototype.once=function(m,A,v){return u(this,m,A,v,!0)},g.prototype.removeListener=function(m,A,v,b){var C=o?o+m:m;if(!this._events[C])return this;if(!A)return f(this,C),this;var S=this._events[C];if(S.fn)S.fn!==A||b&&!S.once||v&&S.context!==v||f(this,C);else{for(var I=0,M=[],R=S.length;I<R;I++)(S[I].fn!==A||b&&!S[I].once||v&&S[I].context!==v)&&M.push(S[I]);M.length?this._events[C]=M.length===1?M[0]:M:f(this,C)}return this},g.prototype.removeAllListeners=function(m){var A;return m?(A=o?o+m:m,this._events[A]&&f(this,A)):(this._events=new l,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=o,g.EventEmitter=g,typeof n<"u"&&(n.exports=g)},{}],WOs9:[function(t,n,i){var r=this&&this.__read||function(f,g){var m=typeof Symbol=="function"&&f[Symbol.iterator];if(!m)return f;var A,v,b=m.call(f),C=[];try{for(;(g===void 0||g-- >0)&&!(A=b.next()).done;)C.push(A.value)}catch(S){v={error:S}}finally{try{A&&!A.done&&(m=b.return)&&m.call(b)}finally{if(v)throw v.error}}return C},o=this&&this.__spreadArray||function(f,g){for(var m=0,A=g.length,v=f.length;m<A;m++,v++)f[v]=g[m];return f};Object.defineProperty(i,"__esModule",{value:!0}),i.LogLevel=void 0;var l,h="PeerJS: ";(function(f){f[f.Disabled=0]="Disabled",f[f.Errors=1]="Errors",f[f.Warnings=2]="Warnings",f[f.All=3]="All"})(l=i.LogLevel||(i.LogLevel={}));var u=function(){function f(){this._logLevel=l.Disabled}return Object.defineProperty(f.prototype,"logLevel",{get:function(){return this._logLevel},set:function(g){this._logLevel=g},enumerable:!1,configurable:!0}),f.prototype.log=function(){for(var g=[],m=0;m<arguments.length;m++)g[m]=arguments[m];this._logLevel>=l.All&&this._print.apply(this,o([l.All],r(g)))},f.prototype.warn=function(){for(var g=[],m=0;m<arguments.length;m++)g[m]=arguments[m];this._logLevel>=l.Warnings&&this._print.apply(this,o([l.Warnings],r(g)))},f.prototype.error=function(){for(var g=[],m=0;m<arguments.length;m++)g[m]=arguments[m];this._logLevel>=l.Errors&&this._print.apply(this,o([l.Errors],r(g)))},f.prototype.setLogFunction=function(g){this._print=g},f.prototype._print=function(g){for(var m=[],A=1;A<arguments.length;A++)m[A-1]=arguments[A];var v=o([h],r(m));for(var b in v)v[b]instanceof Error&&(v[b]="("+v[b].name+") "+v[b].message);g>=l.All?console.log.apply(console,o([],r(v))):g>=l.Warnings?console.warn.apply(console,o(["WARNING"],r(v))):g>=l.Errors&&console.error.apply(console,o(["ERROR"],r(v)))},f}();i.default=new u},{}],ZRYf:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ServerMessageType=i.SocketEventType=i.SerializationType=i.PeerErrorType=i.PeerEventType=i.ConnectionType=i.ConnectionEventType=void 0,function(r){r.Open="open",r.Stream="stream",r.Data="data",r.Close="close",r.Error="error",r.IceStateChanged="iceStateChanged"}(i.ConnectionEventType||(i.ConnectionEventType={})),function(r){r.Data="data",r.Media="media"}(i.ConnectionType||(i.ConnectionType={})),function(r){r.Open="open",r.Close="close",r.Connection="connection",r.Call="call",r.Disconnected="disconnected",r.Error="error"}(i.PeerEventType||(i.PeerEventType={})),function(r){r.BrowserIncompatible="browser-incompatible",r.Disconnected="disconnected",r.InvalidID="invalid-id",r.InvalidKey="invalid-key",r.Network="network",r.PeerUnavailable="peer-unavailable",r.SslUnavailable="ssl-unavailable",r.ServerError="server-error",r.SocketError="socket-error",r.SocketClosed="socket-closed",r.UnavailableID="unavailable-id",r.WebRTC="webrtc"}(i.PeerErrorType||(i.PeerErrorType={})),function(r){r.Binary="binary",r.BinaryUTF8="binary-utf8",r.JSON="json"}(i.SerializationType||(i.SerializationType={})),function(r){r.Message="message",r.Disconnected="disconnected",r.Error="error",r.Close="close"}(i.SocketEventType||(i.SocketEventType={})),function(r){r.Heartbeat="HEARTBEAT",r.Candidate="CANDIDATE",r.Offer="OFFER",r.Answer="ANSWER",r.Open="OPEN",r.Error="ERROR",r.IdTaken="ID-TAKEN",r.InvalidKey="INVALID-KEY",r.Leave="LEAVE",r.Expire="EXPIRE"}(i.ServerMessageType||(i.ServerMessageType={}))},{}],wJlv:[function(t,n,i){var r=this&&this.__extends||function(){var v=function(b,C){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,I){S.__proto__=I}||function(S,I){for(var M in I)Object.prototype.hasOwnProperty.call(I,M)&&(S[M]=I[M])})(b,C)};return function(b,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function S(){this.constructor=b}v(b,C),b.prototype=C===null?Object.create(C):(S.prototype=C.prototype,new S)}}(),o=this&&this.__read||function(v,b){var C=typeof Symbol=="function"&&v[Symbol.iterator];if(!C)return v;var S,I,M=C.call(v),R=[];try{for(;(b===void 0||b-- >0)&&!(S=M.next()).done;)R.push(S.value)}catch(T){I={error:T}}finally{try{S&&!S.done&&(C=M.return)&&C.call(M)}finally{if(I)throw I.error}}return R},l=this&&this.__spreadArray||function(v,b){for(var C=0,S=b.length,I=v.length;C<S;C++,I++)v[I]=b[C];return v},h=this&&this.__values||function(v){var b=typeof Symbol=="function"&&Symbol.iterator,C=b&&v[b],S=0;if(C)return C.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&S>=v.length&&(v=void 0),{value:v&&v[S++],done:!v}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(i,"__esModule",{value:!0}),i.Socket=void 0;var f=t("eventemitter3"),g=u(t("./logger")),m=t("./enums"),A=function(v){function b(C,S,I,M,R,T){T===void 0&&(T=5e3);var B=v.call(this)||this;B.pingInterval=T,B._disconnected=!0,B._messagesQueue=[];var F=C?"wss://":"ws://";return B._baseUrl=F+S+":"+I+M+"peerjs?key="+R,B}return r(b,v),b.prototype.start=function(C,S){var I=this;this._id=C;var M=this._baseUrl+"&id="+C+"&token="+S;!this._socket&&this._disconnected&&(this._socket=new WebSocket(M),this._disconnected=!1,this._socket.onmessage=function(R){var T;try{T=JSON.parse(R.data),g.default.log("Server message received:",T)}catch{return void g.default.log("Invalid server message",R.data)}I.emit(m.SocketEventType.Message,T)},this._socket.onclose=function(R){I._disconnected||(g.default.log("Socket closed.",R),I._cleanup(),I._disconnected=!0,I.emit(m.SocketEventType.Disconnected))},this._socket.onopen=function(){I._disconnected||(I._sendQueuedMessages(),g.default.log("Socket open"),I._scheduleHeartbeat())})},b.prototype._scheduleHeartbeat=function(){var C=this;this._wsPingTimer=setTimeout(function(){C._sendHeartbeat()},this.pingInterval)},b.prototype._sendHeartbeat=function(){if(this._wsOpen()){var C=JSON.stringify({type:m.ServerMessageType.Heartbeat});this._socket.send(C),this._scheduleHeartbeat()}else g.default.log("Cannot send heartbeat, because socket closed")},b.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},b.prototype._sendQueuedMessages=function(){var C,S,I=l([],o(this._messagesQueue));this._messagesQueue=[];try{for(var M=h(I),R=M.next();!R.done;R=M.next()){var T=R.value;this.send(T)}}catch(B){C={error:B}}finally{try{R&&!R.done&&(S=M.return)&&S.call(M)}finally{if(C)throw C.error}}},b.prototype.send=function(C){if(!this._disconnected)if(this._id)if(C.type){if(this._wsOpen()){var S=JSON.stringify(C);this._socket.send(S)}}else this.emit(m.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(C)},b.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},b.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},b}(f.EventEmitter);i.Socket=A},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(t,n,i){var r=this&&this.__assign||function(){return(r=Object.assign||function(A){for(var v,b=1,C=arguments.length;b<C;b++)for(var S in v=arguments[b])Object.prototype.hasOwnProperty.call(v,S)&&(A[S]=v[S]);return A}).apply(this,arguments)},o=this&&this.__awaiter||function(A,v,b,C){return new(b||(b=Promise))(function(S,I){function M(B){try{T(C.next(B))}catch(F){I(F)}}function R(B){try{T(C.throw(B))}catch(F){I(F)}}function T(B){var F;B.done?S(B.value):(F=B.value,F instanceof b?F:new b(function(D){D(F)})).then(M,R)}T((C=C.apply(A,v||[])).next())})},l=this&&this.__generator||function(A,v){var b,C,S,I,M={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return I={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function R(T){return function(B){return function(F){if(b)throw new TypeError("Generator is already executing.");for(;M;)try{if(b=1,C&&(S=2&F[0]?C.return:F[0]?C.throw||((S=C.return)&&S.call(C),0):C.next)&&!(S=S.call(C,F[1])).done)return S;switch(C=0,S&&(F=[2&F[0],S.value]),F[0]){case 0:case 1:S=F;break;case 4:return M.label++,{value:F[1],done:!1};case 5:M.label++,C=F[1],F=[0];continue;case 7:F=M.ops.pop(),M.trys.pop();continue;default:if(!(S=(S=M.trys).length>0&&S[S.length-1])&&(F[0]===6||F[0]===2)){M=0;continue}if(F[0]===3&&(!S||F[1]>S[0]&&F[1]<S[3])){M.label=F[1];break}if(F[0]===6&&M.label<S[1]){M.label=S[1],S=F;break}if(S&&M.label<S[2]){M.label=S[2],M.ops.push(F);break}S[2]&&M.ops.pop(),M.trys.pop();continue}F=v.call(A,M)}catch(D){F=[6,D],C=0}finally{b=S=0}if(5&F[0])throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}([T,B])}}},h=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(i,"__esModule",{value:!0}),i.Negotiator=void 0;var u=t("./util"),f=h(t("./logger")),g=t("./enums"),m=function(){function A(v){this.connection=v}return A.prototype.startConnection=function(v){var b=this._startPeerConnection();if(this.connection.peerConnection=b,this.connection.type===g.ConnectionType.Media&&v._stream&&this._addTracksToConnection(v._stream,b),v.originator){if(this.connection.type===g.ConnectionType.Data){var C=this.connection,S={ordered:!!v.reliable},I=b.createDataChannel(C.label,S);C.initialize(I)}this._makeOffer()}else this.handleSDP("OFFER",v.sdp)},A.prototype._startPeerConnection=function(){f.default.log("Creating RTCPeerConnection.");var v=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(v),v},A.prototype._setupListeners=function(v){var b=this,C=this.connection.peer,S=this.connection.connectionId,I=this.connection.type,M=this.connection.provider;f.default.log("Listening for ICE candidates."),v.onicecandidate=function(R){R.candidate&&R.candidate.candidate&&(f.default.log("Received ICE candidates for "+C+":",R.candidate),M.socket.send({type:g.ServerMessageType.Candidate,payload:{candidate:R.candidate,type:I,connectionId:S},dst:C}))},v.oniceconnectionstatechange=function(){switch(v.iceConnectionState){case"failed":f.default.log("iceConnectionState is failed, closing connections to "+C),b.connection.emit(g.ConnectionEventType.Error,new Error("Negotiation of connection to "+C+" failed.")),b.connection.close();break;case"closed":f.default.log("iceConnectionState is closed, closing connections to "+C),b.connection.emit(g.ConnectionEventType.Error,new Error("Connection to "+C+" closed.")),b.connection.close();break;case"disconnected":f.default.log("iceConnectionState changed to disconnected on the connection with "+C);break;case"completed":v.onicecandidate=u.util.noop}b.connection.emit(g.ConnectionEventType.IceStateChanged,v.iceConnectionState)},f.default.log("Listening for data channel"),v.ondatachannel=function(R){f.default.log("Received data channel");var T=R.channel;M.getConnection(C,S).initialize(T)},f.default.log("Listening for remote stream"),v.ontrack=function(R){f.default.log("Received remote stream");var T=R.streams[0],B=M.getConnection(C,S);if(B.type===g.ConnectionType.Media){var F=B;b._addStreamToMediaConnection(T,F)}}},A.prototype.cleanup=function(){f.default.log("Cleaning up PeerConnection to "+this.connection.peer);var v=this.connection.peerConnection;if(v){this.connection.peerConnection=null,v.onicecandidate=v.oniceconnectionstatechange=v.ondatachannel=v.ontrack=function(){};var b=v.signalingState!=="closed",C=!1;if(this.connection.type===g.ConnectionType.Data){var S=this.connection.dataChannel;S&&(C=!!S.readyState&&S.readyState!=="closed")}(b||C)&&v.close()}},A.prototype._makeOffer=function(){return o(this,void 0,Promise,function(){var v,b,C,S,I,M,R;return l(this,function(T){switch(T.label){case 0:v=this.connection.peerConnection,b=this.connection.provider,T.label=1;case 1:return T.trys.push([1,7,,8]),[4,v.createOffer(this.connection.options.constraints)];case 2:C=T.sent(),f.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(C.sdp=this.connection.options.sdpTransform(C.sdp)||C.sdp),T.label=3;case 3:return T.trys.push([3,5,,6]),[4,v.setLocalDescription(C)];case 4:return T.sent(),f.default.log("Set localDescription:",C,"for:"+this.connection.peer),S={sdp:C,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:u.util.browser},this.connection.type===g.ConnectionType.Data&&(I=this.connection,S=r(r({},S),{label:I.label,reliable:I.reliable,serialization:I.serialization})),b.socket.send({type:g.ServerMessageType.Offer,payload:S,dst:this.connection.peer}),[3,6];case 5:return(M=T.sent())!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(b.emitError(g.PeerErrorType.WebRTC,M),f.default.log("Failed to setLocalDescription, ",M)),[3,6];case 6:return[3,8];case 7:return R=T.sent(),b.emitError(g.PeerErrorType.WebRTC,R),f.default.log("Failed to createOffer, ",R),[3,8];case 8:return[2]}})})},A.prototype._makeAnswer=function(){return o(this,void 0,Promise,function(){var v,b,C,S,I;return l(this,function(M){switch(M.label){case 0:v=this.connection.peerConnection,b=this.connection.provider,M.label=1;case 1:return M.trys.push([1,7,,8]),[4,v.createAnswer()];case 2:C=M.sent(),f.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(C.sdp=this.connection.options.sdpTransform(C.sdp)||C.sdp),M.label=3;case 3:return M.trys.push([3,5,,6]),[4,v.setLocalDescription(C)];case 4:return M.sent(),f.default.log("Set localDescription:",C,"for:"+this.connection.peer),b.socket.send({type:g.ServerMessageType.Answer,payload:{sdp:C,type:this.connection.type,connectionId:this.connection.connectionId,browser:u.util.browser},dst:this.connection.peer}),[3,6];case 5:return S=M.sent(),b.emitError(g.PeerErrorType.WebRTC,S),f.default.log("Failed to setLocalDescription, ",S),[3,6];case 6:return[3,8];case 7:return I=M.sent(),b.emitError(g.PeerErrorType.WebRTC,I),f.default.log("Failed to create answer, ",I),[3,8];case 8:return[2]}})})},A.prototype.handleSDP=function(v,b){return o(this,void 0,Promise,function(){var C,S,I,M;return l(this,function(R){switch(R.label){case 0:b=new RTCSessionDescription(b),C=this.connection.peerConnection,S=this.connection.provider,f.default.log("Setting remote description",b),I=this,R.label=1;case 1:return R.trys.push([1,5,,6]),[4,C.setRemoteDescription(b)];case 2:return R.sent(),f.default.log("Set remoteDescription:"+v+" for:"+this.connection.peer),v!=="OFFER"?[3,4]:[4,I._makeAnswer()];case 3:R.sent(),R.label=4;case 4:return[3,6];case 5:return M=R.sent(),S.emitError(g.PeerErrorType.WebRTC,M),f.default.log("Failed to setRemoteDescription, ",M),[3,6];case 6:return[2]}})})},A.prototype.handleCandidate=function(v){return o(this,void 0,Promise,function(){var b,C,S,I,M,R;return l(this,function(T){switch(T.label){case 0:f.default.log("handleCandidate:",v),b=v.candidate,C=v.sdpMLineIndex,S=v.sdpMid,I=this.connection.peerConnection,M=this.connection.provider,T.label=1;case 1:return T.trys.push([1,3,,4]),[4,I.addIceCandidate(new RTCIceCandidate({sdpMid:S,sdpMLineIndex:C,candidate:b}))];case 2:return T.sent(),f.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return R=T.sent(),M.emitError(g.PeerErrorType.WebRTC,R),f.default.log("Failed to handleCandidate, ",R),[3,4];case 4:return[2]}})})},A.prototype._addTracksToConnection=function(v,b){if(f.default.log("add tracks from stream "+v.id+" to peer connection"),!b.addTrack)return f.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");v.getTracks().forEach(function(C){b.addTrack(C,v)})},A.prototype._addStreamToMediaConnection=function(v,b){f.default.log("add stream "+v.id+" to media connection "+b.connectionId),b.addStream(v)},A}();i.Negotiator=m},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(t,n,i){var r=this&&this.__extends||function(){var h=function(u,f){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,m){g.__proto__=m}||function(g,m){for(var A in m)Object.prototype.hasOwnProperty.call(m,A)&&(g[A]=m[A])})(u,f)};return function(u,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function g(){this.constructor=u}h(u,f),u.prototype=f===null?Object.create(f):(g.prototype=f.prototype,new g)}}();Object.defineProperty(i,"__esModule",{value:!0}),i.BaseConnection=void 0;var o=t("eventemitter3"),l=function(h){function u(f,g,m){var A=h.call(this)||this;return A.peer=f,A.provider=g,A.options=m,A._open=!1,A.metadata=m.metadata,A}return r(u,h),Object.defineProperty(u.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),u}(o.EventEmitter);i.BaseConnection=l},{eventemitter3:"JJlS"}],dbHP:[function(t,n,i){var r=this&&this.__extends||function(){var b=function(C,S){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,M){I.__proto__=M}||function(I,M){for(var R in M)Object.prototype.hasOwnProperty.call(M,R)&&(I[R]=M[R])})(C,S)};return function(C,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function I(){this.constructor=C}b(C,S),C.prototype=S===null?Object.create(S):(I.prototype=S.prototype,new I)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(b){for(var C,S=1,I=arguments.length;S<I;S++)for(var M in C=arguments[S])Object.prototype.hasOwnProperty.call(C,M)&&(b[M]=C[M]);return b}).apply(this,arguments)},l=this&&this.__values||function(b){var C=typeof Symbol=="function"&&Symbol.iterator,S=C&&b[C],I=0;if(S)return S.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&I>=b.length&&(b=void 0),{value:b&&b[I++],done:!b}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")},h=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(i,"__esModule",{value:!0}),i.MediaConnection=void 0;var u=t("./util"),f=h(t("./logger")),g=t("./negotiator"),m=t("./enums"),A=t("./baseconnection"),v=function(b){function C(S,I,M){var R=b.call(this,S,I,M)||this;return R._localStream=R.options._stream,R.connectionId=R.options.connectionId||C.ID_PREFIX+u.util.randomToken(),R._negotiator=new g.Negotiator(R),R._localStream&&R._negotiator.startConnection({_stream:R._localStream,originator:!0}),R}return r(C,b),Object.defineProperty(C.prototype,"type",{get:function(){return m.ConnectionType.Media},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),C.prototype.addStream=function(S){f.default.log("Receiving stream",S),this._remoteStream=S,b.prototype.emit.call(this,m.ConnectionEventType.Stream,S)},C.prototype.handleMessage=function(S){var I=S.type,M=S.payload;switch(S.type){case m.ServerMessageType.Answer:this._negotiator.handleSDP(I,M.sdp),this._open=!0;break;case m.ServerMessageType.Candidate:this._negotiator.handleCandidate(M.candidate);break;default:f.default.warn("Unrecognized message type:"+I+" from peer:"+this.peer)}},C.prototype.answer=function(S,I){var M,R;if(I===void 0&&(I={}),this._localStream)f.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=S,I&&I.sdpTransform&&(this.options.sdpTransform=I.sdpTransform),this._negotiator.startConnection(o(o({},this.options._payload),{_stream:S}));var T=this.provider._getMessages(this.connectionId);try{for(var B=l(T),F=B.next();!F.done;F=B.next()){var D=F.value;this.handleMessage(D)}}catch(U){M={error:U}}finally{try{F&&!F.done&&(R=B.return)&&R.call(B)}finally{if(M)throw M.error}}this._open=!0}},C.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,b.prototype.emit.call(this,m.ConnectionEventType.Close))},C.ID_PREFIX="mc_",C}(A.BaseConnection);i.MediaConnection=v},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(t,n,i){var r=this&&this.__extends||function(){var f=function(g,m){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,v){A.__proto__=v}||function(A,v){for(var b in v)Object.prototype.hasOwnProperty.call(v,b)&&(A[b]=v[b])})(g,m)};return function(g,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function A(){this.constructor=g}f(g,m),g.prototype=m===null?Object.create(m):(A.prototype=m.prototype,new A)}}(),o=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(i,"__esModule",{value:!0}),i.EncodingQueue=void 0;var l=t("eventemitter3"),h=o(t("./logger")),u=function(f){function g(){var m=f.call(this)||this;return m.fileReader=new FileReader,m._queue=[],m._processing=!1,m.fileReader.onload=function(A){m._processing=!1,A.target&&m.emit("done",A.target.result),m.doNextTask()},m.fileReader.onerror=function(A){h.default.error("EncodingQueue error:",A),m._processing=!1,m.destroy(),m.emit("error",A)},m}return r(g,f),Object.defineProperty(g.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),g.prototype.enque=function(m){this.queue.push(m),this.processing||this.doNextTask()},g.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},g.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},g}(l.EventEmitter);i.EncodingQueue=u},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(t,n,i){var r=this&&this.__extends||function(){var b=function(C,S){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,M){I.__proto__=M}||function(I,M){for(var R in M)Object.prototype.hasOwnProperty.call(M,R)&&(I[R]=M[R])})(C,S)};return function(C,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function I(){this.constructor=C}b(C,S),C.prototype=S===null?Object.create(S):(I.prototype=S.prototype,new I)}}(),o=this&&this.__values||function(b){var C=typeof Symbol=="function"&&Symbol.iterator,S=C&&b[C],I=0;if(S)return S.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&I>=b.length&&(b=void 0),{value:b&&b[I++],done:!b}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(i,"__esModule",{value:!0}),i.DataConnection=void 0;var h=t("./util"),u=l(t("./logger")),f=t("./negotiator"),g=t("./enums"),m=t("./baseconnection"),A=t("./encodingQueue"),v=function(b){function C(S,I,M){var R=b.call(this,S,I,M)||this;return R.stringify=JSON.stringify,R.parse=JSON.parse,R._buffer=[],R._bufferSize=0,R._buffering=!1,R._chunkedData={},R._encodingQueue=new A.EncodingQueue,R.connectionId=R.options.connectionId||C.ID_PREFIX+h.util.randomToken(),R.label=R.options.label||R.connectionId,R.serialization=R.options.serialization||g.SerializationType.Binary,R.reliable=!!R.options.reliable,R._encodingQueue.on("done",function(T){R._bufferedSend(T)}),R._encodingQueue.on("error",function(){u.default.error("DC#"+R.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),R.close()}),R._negotiator=new f.Negotiator(R),R._negotiator.startConnection(R.options._payload||{originator:!0}),R}return r(C,b),Object.defineProperty(C.prototype,"type",{get:function(){return g.ConnectionType.Data},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),C.prototype.initialize=function(S){this._dc=S,this._configureDataChannel()},C.prototype._configureDataChannel=function(){var S=this;h.util.supports.binaryBlob&&!h.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){u.default.log("DC#"+S.connectionId+" dc connection success"),S._open=!0,S.emit(g.ConnectionEventType.Open)},this.dataChannel.onmessage=function(I){u.default.log("DC#"+S.connectionId+" dc onmessage:",I.data),S._handleDataMessage(I)},this.dataChannel.onclose=function(){u.default.log("DC#"+S.connectionId+" dc closed for:",S.peer),S.close()}},C.prototype._handleDataMessage=function(S){var I=this,M=S.data,R=M.constructor,T=M;if(this.serialization===g.SerializationType.Binary||this.serialization===g.SerializationType.BinaryUTF8){if(R===Blob)return void h.util.blobToArrayBuffer(M,function(F){var D=h.util.unpack(F);I.emit(g.ConnectionEventType.Data,D)});if(R===ArrayBuffer)T=h.util.unpack(M);else if(R===String){var B=h.util.binaryStringToArrayBuffer(M);T=h.util.unpack(B)}}else this.serialization===g.SerializationType.JSON&&(T=this.parse(M));T.__peerData?this._handleChunk(T):b.prototype.emit.call(this,g.ConnectionEventType.Data,T)},C.prototype._handleChunk=function(S){var I=S.__peerData,M=this._chunkedData[I]||{data:[],count:0,total:S.total};if(M.data[S.n]=S.data,M.count++,this._chunkedData[I]=M,M.total===M.count){delete this._chunkedData[I];var R=new Blob(M.data);this._handleDataMessage({data:R})}},C.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,b.prototype.emit.call(this,g.ConnectionEventType.Close))},C.prototype.send=function(S,I){if(this.open)if(this.serialization===g.SerializationType.JSON)this._bufferedSend(this.stringify(S));else if(this.serialization===g.SerializationType.Binary||this.serialization===g.SerializationType.BinaryUTF8){var M=h.util.pack(S);if(!I&&M.size>h.util.chunkedMTU)return void this._sendChunks(M);h.util.supports.binaryBlob?this._bufferedSend(M):this._encodingQueue.enque(M)}else this._bufferedSend(S);else b.prototype.emit.call(this,g.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},C.prototype._bufferedSend=function(S){!this._buffering&&this._trySend(S)||(this._buffer.push(S),this._bufferSize=this._buffer.length)},C.prototype._trySend=function(S){var I=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>C.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){I._buffering=!1,I._tryBuffer()},50),!1;try{this.dataChannel.send(S)}catch(M){return u.default.error("DC#:"+this.connectionId+" Error when sending:",M),this._buffering=!0,this.close(),!1}return!0},C.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var S=this._buffer[0];this._trySend(S)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},C.prototype._sendChunks=function(S){var I,M,R=h.util.chunk(S);u.default.log("DC#"+this.connectionId+" Try to send "+R.length+" chunks...");try{for(var T=o(R),B=T.next();!B.done;B=T.next()){var F=B.value;this.send(F,!0)}}catch(D){I={error:D}}finally{try{B&&!B.done&&(M=T.return)&&M.call(T)}finally{if(I)throw I.error}}},C.prototype.handleMessage=function(S){var I=S.payload;switch(S.type){case g.ServerMessageType.Answer:this._negotiator.handleSDP(S.type,I.sdp);break;case g.ServerMessageType.Candidate:this._negotiator.handleCandidate(I.candidate);break;default:u.default.warn("Unrecognized message type:",S.type,"from peer:",this.peer)}},C.ID_PREFIX="dc_",C.MAX_BUFFERED_AMOUNT=8388608,C}(m.BaseConnection);i.DataConnection=v},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(t,n,i){var r=this&&this.__awaiter||function(g,m,A,v){return new(A||(A=Promise))(function(b,C){function S(R){try{M(v.next(R))}catch(T){C(T)}}function I(R){try{M(v.throw(R))}catch(T){C(T)}}function M(R){var T;R.done?b(R.value):(T=R.value,T instanceof A?T:new A(function(B){B(T)})).then(S,I)}M((v=v.apply(g,m||[])).next())})},o=this&&this.__generator||function(g,m){var A,v,b,C,S={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return C={next:I(0),throw:I(1),return:I(2)},typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function I(M){return function(R){return function(T){if(A)throw new TypeError("Generator is already executing.");for(;S;)try{if(A=1,v&&(b=2&T[0]?v.return:T[0]?v.throw||((b=v.return)&&b.call(v),0):v.next)&&!(b=b.call(v,T[1])).done)return b;switch(v=0,b&&(T=[2&T[0],b.value]),T[0]){case 0:case 1:b=T;break;case 4:return S.label++,{value:T[1],done:!1};case 5:S.label++,v=T[1],T=[0];continue;case 7:T=S.ops.pop(),S.trys.pop();continue;default:if(!(b=(b=S.trys).length>0&&b[b.length-1])&&(T[0]===6||T[0]===2)){S=0;continue}if(T[0]===3&&(!b||T[1]>b[0]&&T[1]<b[3])){S.label=T[1];break}if(T[0]===6&&S.label<b[1]){S.label=b[1],b=T;break}if(b&&S.label<b[2]){S.label=b[2],S.ops.push(T);break}b[2]&&S.ops.pop(),S.trys.pop();continue}T=m.call(g,S)}catch(B){T=[6,B],v=0}finally{A=b=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([M,R])}}},l=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(i,"__esModule",{value:!0}),i.API=void 0;var h=t("./util"),u=l(t("./logger")),f=function(){function g(m){this._options=m}return g.prototype._buildUrl=function(m){var A=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+m;return A+="?ts="+new Date().getTime()+Math.random()},g.prototype.retrieveId=function(){return r(this,void 0,Promise,function(){var m,A,v,b;return o(this,function(C){switch(C.label){case 0:m=this._buildUrl("id"),C.label=1;case 1:return C.trys.push([1,3,,4]),[4,fetch(m)];case 2:if((A=C.sent()).status!==200)throw new Error("Error. Status:"+A.status);return[2,A.text()];case 3:throw v=C.sent(),u.default.error("Error retrieving ID",v),b="",this._options.path==="/"&&this._options.host!==h.util.CLOUD_HOST&&(b=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+b);case 4:return[2]}})})},g.prototype.listAllPeers=function(){return r(this,void 0,Promise,function(){var m,A,v,b;return o(this,function(C){switch(C.label){case 0:m=this._buildUrl("peers"),C.label=1;case 1:return C.trys.push([1,3,,4]),[4,fetch(m)];case 2:if((A=C.sent()).status!==200)throw A.status===401?(v="",v=this._options.host===h.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+v)):new Error("Error. Status:"+A.status);return[2,A.json()];case 3:throw b=C.sent(),u.default.error("Error retrieving list peers",b),new Error("Could not get list peers from the server."+b);case 4:return[2]}})})},g}();i.API=f},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(t,n,i){var r=this&&this.__extends||function(){var M=function(R,T){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,F){B.__proto__=F}||function(B,F){for(var D in F)Object.prototype.hasOwnProperty.call(F,D)&&(B[D]=F[D])})(R,T)};return function(R,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function B(){this.constructor=R}M(R,T),R.prototype=T===null?Object.create(T):(B.prototype=T.prototype,new B)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(M){for(var R,T=1,B=arguments.length;T<B;T++)for(var F in R=arguments[T])Object.prototype.hasOwnProperty.call(R,F)&&(M[F]=R[F]);return M}).apply(this,arguments)},l=this&&this.__values||function(M){var R=typeof Symbol=="function"&&Symbol.iterator,T=R&&M[R],B=0;if(T)return T.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&B>=M.length&&(M=void 0),{value:M&&M[B++],done:!M}}};throw new TypeError(R?"Object is not iterable.":"Symbol.iterator is not defined.")},h=this&&this.__read||function(M,R){var T=typeof Symbol=="function"&&M[Symbol.iterator];if(!T)return M;var B,F,D=T.call(M),U=[];try{for(;(R===void 0||R-- >0)&&!(B=D.next()).done;)U.push(B.value)}catch(W){F={error:W}}finally{try{B&&!B.done&&(T=D.return)&&T.call(D)}finally{if(F)throw F.error}}return U},u=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(i,"__esModule",{value:!0}),i.Peer=void 0;var f=t("eventemitter3"),g=t("./util"),m=u(t("./logger")),A=t("./socket"),v=t("./mediaconnection"),b=t("./dataconnection"),C=t("./enums"),S=t("./api"),I=function(M){function R(T,B){var F,D=M.call(this)||this;return D._id=null,D._lastServerId=null,D._destroyed=!1,D._disconnected=!1,D._open=!1,D._connections=new Map,D._lostMessages=new Map,T&&T.constructor==Object?B=T:T&&(F=T.toString()),B=o({debug:0,host:g.util.CLOUD_HOST,port:g.util.CLOUD_PORT,path:"/",key:R.DEFAULT_KEY,token:g.util.randomToken(),config:g.util.defaultConfig},B),D._options=B,D._options.host==="/"&&(D._options.host=window.location.hostname),D._options.path&&(D._options.path[0]!=="/"&&(D._options.path="/"+D._options.path),D._options.path[D._options.path.length-1]!=="/"&&(D._options.path+="/")),D._options.secure===void 0&&D._options.host!==g.util.CLOUD_HOST?D._options.secure=g.util.isSecure():D._options.host==g.util.CLOUD_HOST&&(D._options.secure=!0),D._options.logFunction&&m.default.setLogFunction(D._options.logFunction),m.default.logLevel=D._options.debug||0,D._api=new S.API(B),D._socket=D._createServerConnection(),g.util.supports.audioVideo||g.util.supports.data?F&&!g.util.validateId(F)?(D._delayedAbort(C.PeerErrorType.InvalidID,'ID "'+F+'" is invalid'),D):(F?D._initialize(F):D._api.retrieveId().then(function(U){return D._initialize(U)}).catch(function(U){return D._abort(C.PeerErrorType.ServerError,U)}),D):(D._delayedAbort(C.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),D)}return r(R,M),Object.defineProperty(R.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"connections",{get:function(){var T,B,F=Object.create(null);try{for(var D=l(this._connections),U=D.next();!U.done;U=D.next()){var W=h(U.value,2),J=W[0],ee=W[1];F[J]=ee}}catch(Q){T={error:Q}}finally{try{U&&!U.done&&(B=D.return)&&B.call(D)}finally{if(T)throw T.error}}return F},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),R.prototype._createServerConnection=function(){var T=this,B=new A.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return B.on(C.SocketEventType.Message,function(F){T._handleMessage(F)}),B.on(C.SocketEventType.Error,function(F){T._abort(C.PeerErrorType.SocketError,F)}),B.on(C.SocketEventType.Disconnected,function(){T.disconnected||(T.emitError(C.PeerErrorType.Network,"Lost connection to server."),T.disconnect())}),B.on(C.SocketEventType.Close,function(){T.disconnected||T._abort(C.PeerErrorType.SocketClosed,"Underlying socket is already closed.")}),B},R.prototype._initialize=function(T){this._id=T,this.socket.start(T,this._options.token)},R.prototype._handleMessage=function(T){var B,F,D=T.type,U=T.payload,W=T.src;switch(D){case C.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(C.PeerEventType.Open,this.id);break;case C.ServerMessageType.Error:this._abort(C.PeerErrorType.ServerError,U.msg);break;case C.ServerMessageType.IdTaken:this._abort(C.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case C.ServerMessageType.InvalidKey:this._abort(C.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case C.ServerMessageType.Leave:m.default.log("Received leave message from "+W),this._cleanupPeer(W),this._connections.delete(W);break;case C.ServerMessageType.Expire:this.emitError(C.PeerErrorType.PeerUnavailable,"Could not connect to peer "+W);break;case C.ServerMessageType.Offer:var J=U.connectionId;if((ae=this.getConnection(W,J))&&(ae.close(),m.default.warn("Offer received for existing Connection ID:"+J)),U.type===C.ConnectionType.Media)ae=new v.MediaConnection(W,this,{connectionId:J,_payload:U,metadata:U.metadata}),this._addConnection(W,ae),this.emit(C.PeerEventType.Call,ae);else{if(U.type!==C.ConnectionType.Data)return void m.default.warn("Received malformed connection type:"+U.type);ae=new b.DataConnection(W,this,{connectionId:J,_payload:U,metadata:U.metadata,label:U.label,serialization:U.serialization,reliable:U.reliable}),this._addConnection(W,ae),this.emit(C.PeerEventType.Connection,ae)}var ee=this._getMessages(J);try{for(var Q=l(ee),Y=Q.next();!Y.done;Y=Q.next()){var se=Y.value;ae.handleMessage(se)}}catch(ve){B={error:ve}}finally{try{Y&&!Y.done&&(F=Q.return)&&F.call(Q)}finally{if(B)throw B.error}}break;default:if(!U)return void m.default.warn("You received a malformed message from "+W+" of type "+D);var ae;J=U.connectionId,(ae=this.getConnection(W,J))&&ae.peerConnection?ae.handleMessage(T):J?this._storeMessage(J,T):m.default.warn("You received an unrecognized message:",T)}},R.prototype._storeMessage=function(T,B){this._lostMessages.has(T)||this._lostMessages.set(T,[]),this._lostMessages.get(T).push(B)},R.prototype._getMessages=function(T){var B=this._lostMessages.get(T);return B?(this._lostMessages.delete(T),B):[]},R.prototype.connect=function(T,B){if(B===void 0&&(B={}),this.disconnected)return m.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(C.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var F=new b.DataConnection(T,this,B);return this._addConnection(T,F),F},R.prototype.call=function(T,B,F){if(F===void 0&&(F={}),this.disconnected)return m.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(C.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(B){F._stream=B;var D=new v.MediaConnection(T,this,F);return this._addConnection(T,D),D}m.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},R.prototype._addConnection=function(T,B){m.default.log("add connection "+B.type+":"+B.connectionId+" to peerId:"+T),this._connections.has(T)||this._connections.set(T,[]),this._connections.get(T).push(B)},R.prototype._removeConnection=function(T){var B=this._connections.get(T.peer);if(B){var F=B.indexOf(T);F!==-1&&B.splice(F,1)}this._lostMessages.delete(T.connectionId)},R.prototype.getConnection=function(T,B){var F,D,U=this._connections.get(T);if(!U)return null;try{for(var W=l(U),J=W.next();!J.done;J=W.next()){var ee=J.value;if(ee.connectionId===B)return ee}}catch(Q){F={error:Q}}finally{try{J&&!J.done&&(D=W.return)&&D.call(W)}finally{if(F)throw F.error}}return null},R.prototype._delayedAbort=function(T,B){var F=this;setTimeout(function(){F._abort(T,B)},0)},R.prototype._abort=function(T,B){m.default.error("Aborting!"),this.emitError(T,B),this._lastServerId?this.disconnect():this.destroy()},R.prototype.emitError=function(T,B){var F;m.default.error("Error:",B),(F=typeof B=="string"?new Error(B):B).type=T,this.emit(C.PeerEventType.Error,F)},R.prototype.destroy=function(){this.destroyed||(m.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(C.PeerEventType.Close))},R.prototype._cleanup=function(){var T,B;try{for(var F=l(this._connections.keys()),D=F.next();!D.done;D=F.next()){var U=D.value;this._cleanupPeer(U),this._connections.delete(U)}}catch(W){T={error:W}}finally{try{D&&!D.done&&(B=F.return)&&B.call(F)}finally{if(T)throw T.error}}this.socket.removeAllListeners()},R.prototype._cleanupPeer=function(T){var B,F,D=this._connections.get(T);if(D)try{for(var U=l(D),W=U.next();!W.done;W=U.next())W.value.close()}catch(J){B={error:J}}finally{try{W&&!W.done&&(F=U.return)&&F.call(U)}finally{if(B)throw B.error}}},R.prototype.disconnect=function(){if(!this.disconnected){var T=this.id;m.default.log("Disconnect peer with ID:"+T),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=T,this._id=null,this.emit(C.PeerEventType.Disconnected,T)}},R.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)m.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");m.default.error("In a hurry? We're still trying to make the initial connection!")}},R.prototype.listAllPeers=function(T){var B=this;T===void 0&&(T=function(F){}),this._api.listAllPeers().then(function(F){return T(F)}).catch(function(F){return B._abort(C.PeerErrorType.ServerError,F)})},R.DEFAULT_KEY="peerjs",R}(f.EventEmitter);i.Peer=I},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.peerjs=void 0;var r=t("./util"),o=t("./peer");i.peerjs={Peer:o.Peer,util:r.util},i.default=o.Peer,window.peerjs=i.peerjs,window.Peer=o.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"])})(LO);const k_=HJ(LO.exports);class KJ{constructor(){x(this,"_host");x(this,"_client");x(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}trySetupHost(e){let t=new k_(e);t.on("error",n=>{console.error(n),this._host=void 0,this.trySetupClient(e)}),t.on("open",n=>{this._host=new $J(t)})}trySetupClient(e){this._client=new k_,this._client.on("error",t=>{console.error("Client error",t)}),this._client.on("open",t=>{console.log("client connected",t),this._clientData=this._client.connect(e,{metadata:{id:t}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",n=>{console.log("<<",n)})})}}class ZJ{constructor(e){x(this,"_peer");this._peer=e}}class $J extends ZJ{constructor(t){var n;super(t);x(this,"_connections",[]);console.log("I AM THE HOST"),(n=this._peer)==null||n.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const n=this._connections.map(i=>{var r;return(r=i.metadata)==null?void 0:r.id}).filter(i=>i!==void 0);this.broadcast({type:"connection-list",connections:n})}broadcast(t){if(t!=null){console.log(">>",t);for(const n in this._peer.connections){const i=this._peer.connections[n];if(!!i)if(Array.isArray(i))for(const r of i)!r||r.send(t);else console.warn(i)}}}}let Kb="wss://needle-tiny-starter.glitch.me/socket";const oo=!!Ct("debugnet"),Py=!!(oo||Ct("debugowner"));var Ds=(a=>(a.Join="join-room",a.Leave="leave-room",a.JoinedRoom="joined-room",a.LeftRoom="left-room",a.UserJoinedRoom="user-joined-room",a.UserLeftRoom="user-left-room",a))(Ds||{});class cM{constructor(e,t){x(this,"guid");x(this,"connection");x(this,"_hasOwnership",!1);x(this,"_isOwned");x(this,"_gainSubscription");x(this,"_lostSubscription");x(this,"_hasOwnerResponse");x(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=e,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen("lost-ownership",this._lostSubscription),e.beginListen("gained-ownership-broadcast",this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen("response-has-owner",this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send("request-has-owner",{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this.connection.send("request-has-owner",{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListening("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(Py&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,t)=>{this.requestOwnership();let n=0;const i=()=>{if(n++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?e(this):i()},100)};i()})}requestOwnership(){return Py&&console.log("Request ownership",this.guid),this.connection.send("request-ownership",{guid:this.guid}),this}freeOwnership(){return this.connection.send("remove-ownership",{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListening("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListening("gained-ownership",this._gainSubscription),this.connection.stopListening("lost-ownership",this._lostSubscription),this.connection.stopListening("response-has-owner",this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListening("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(Py&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(Py&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}var N_=(a=>(a[a.OnConnection=0]="OnConnection",a[a.OnRoomJoin=1]="OnRoomJoin",a[a.Queued=2]="Queued",a[a.Immediate=3]="Immediate",a))(N_||{});class eK{constructor(e){x(this,"context");x(this,"_peer",null);x(this,"_usersInRoomCopy",[]);x(this,"_defaultMessagesBuffer",[]);x(this,"_defaultMessagesBufferArray",[]);x(this,"_listeners",{});x(this,"_listenersBinary",{});x(this,"connected",!1);x(this,"channelId");x(this,"_connectionId",null);x(this,"_isConnectingToWebsocket",!1);x(this,"_ws");x(this,"_waitingForSocket",{});x(this,"_isInRoom",!1);x(this,"_currentRoomName",null);x(this,"_currentRoomViewId",null);x(this,"_currentRoomAllowEditing",!0);x(this,"_currentInRoom",[]);x(this,"_state",{});x(this,"_currentDelay",-1);this.context=e}get peer(){return this._peer||(this._peer=new KJ),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return oo}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const t of this._currentInRoom)e.push(t);return e}joinRoom(e,t=!1){this.connect(),oo&&console.log("join: "+e),this.send("join-room",{room:e,viewOnly:t},0)}leaveRoom(e=null){if(e||(e=this.currentRoomName),!e){console.error("Can not leave unknown room");return}this.send("leave-room",{room:e})}send(e,t=null,n=2){if(t===null&&(t={}),n===2){this._defaultMessagesBuffer.push({key:e,value:t});return}return this.sendWithWebsocket(e,t,n)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendBinary(e){var t;oo&&console.log("<< bin",e.length),(t=this._ws)==null||t.send(e)}sendBufferedMessagesNow(){var n;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const e=Object.keys(this._defaultMessagesBuffer).length;for(const i in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[i];if(e<=1){this.sendWithWebsocket(r.key,r.value,3);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&oo&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(n=this._ws)==null||n.send(t)}beginListen(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t}stopListening(e,t){if(!t||!this._listeners[e])return;const n=this._listeners[e].indexOf(t);n>=0&&this._listeners[e].splice(n,1)}beginListenBinrary(e,t){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(t),t}stopListenBinary(e,t){if(!this._listenersBinary[e])return;const n=this._listenersBinary[e].indexOf(t);n>=0&&this._listenersBinary[e].splice(n,1)}connect(){if(this.connected)return;oo&&console.log("connecting");const e=Ee.findObjectOfType(Hu,this.context,!1),t=e==null?void 0:e.getWebsocketUrl();t&&(Kb=t),this.connectWebsocket()}connectWebsocket(){if(this._isConnectingToWebsocket)return;this._isConnectingToWebsocket=!0,console.log("Connecting to "+Kb);const e=new TO.WebsocketBuilder(Kb).onOpen(()=>{this._ws=e,this._isConnectingToWebsocket=!1,this.connected=!0,console.log("Connected to websocket"),this.onSendQueued(0)}).onClose(t=>{this.connected=!1,this._isInRoom=!1}).onError((t,n)=>{console.error(t,n)}).onMessage(this.onMessage.bind(this)).onRetry(()=>{console.log("websocket connection retry")}).build()}onMessage(e,t){const n=t.data;try{if(typeof n!="string"){n.size&&this.handleIncomingBinaryMessage(n);return}const i=JSON.parse(n);if(Array.isArray(i))for(const r of i)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(i);return}catch{oo&&n==="pong"&&console.log("<<",n)}}async handleIncomingBinaryMessage(e){const t=await e.arrayBuffer();var n=new Uint8Array(t);const i=new gg(n),r=i.getBufferIdentifier(),o=this._listenersBinary[r],l=YJ(i),h=JJ(l);if(h&&typeof h=="string"&&(this._state[h]=l),!o)return;const u=l!=null?l:i;for(const f of o)f(u)}handleIncomingStringMessage(e){var i,r,o,l,h,u,f;if(oo&&console.log("<<",(i=e.key)!=null?i:e),e.key)switch(e.key){case"connection-start-info":if(e.data){const A=e.data;A&&(console.assert(A.id!==void 0&&A.id!==null&&A.id.length>0,"server did not send connection id",A.id),console.log("Your id is: "+A.id,(r=this.context.alias)!=null?r:""),this._connectionId=A.id)}else console.warn("Expected connection id in "+e.key);break;case"joined-room":if(oo&&console.log(e),e){this._isInRoom=!0;const A=e;this._currentRoomName=A.room,this._currentRoomViewId=A.viewId,this._currentRoomAllowEditing=(o=A.allowEditing)!=null?o:!0,console.log("Room view id",this._currentRoomViewId),this._currentInRoom.length=0,this._currentInRoom.push(...A.inRoom),oo&&console.log("joined room with",this._currentInRoom,(l=this.context.alias)!=null?l:"")}this.onSendQueued(1);break;case"left-room":e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case"user-joined-room":if(e.data){const A=e.data;this._currentInRoom.push(A.userId),oo&&console.log(A.userId+" joined","now in room:",this._currentInRoom)}break;case"user-left-room":if(e.data){const A=e.data,v=this._currentInRoom.indexOf(A.userId);v>=0&&(console.log(A.userId+" left",(h=this.context.alias)!=null?h:""),this._currentInRoom.splice(v,1)),A.userId===this.connectionId&&console.log("you left the room")}break;case"ping":case"pong":const m=(u=e.data)==null?void 0:u.time;m&&(this._currentDelay=this.context.time.time-m),oo&&console.log("Current latency: "+this._currentDelay.toFixed(1)+" sec","Clients in room: "+((f=this._currentInRoom)==null?void 0:f.length));break}const t=this._listeners[e.key];if(t)for(const g of t)g(e.data);const n=e.data;n&&(this._state[n.guid]=n)}toMessage(e,t){return{key:e,data:t}}sendWithWebsocket(e,t,n=1){if(!this._ws){const r=this._waitingForSocket[n]||[];r.push(()=>this.sendWithWebsocket(e,t,n)),this._waitingForSocket[n]=r;return}const i=JSON.stringify(this.toMessage(e,t));oo&&console.log(">>",e),this._ws.send(i)}onSendQueued(e){const t=this._waitingForSocket[e];if(t){for(const n of t)n();t.length=0}}}const gB={type:"change"},Zb={type:"start"},AB={type:"end"};class DO extends Lr{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new q,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:au.ROTATE,MIDDLE:au.DOLLY,RIGHT:au.PAN},this.touches={ONE:cu.ROTATE,TWO:cu.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(be){be.addEventListener("keydown",Kn),this._domElementKeyEvents=be},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(gB),n.update(),r=i.NONE},this.update=function(){const be=new q,ke=new kt().setFromUnitVectors(e.up,new q(0,1,0)),Et=ke.clone().invert(),hn=new q,nn=new kt,Wt=2*Math.PI;return function(){const Dn=n.object.getWorldPosition(e.position);be.copy(Dn).sub(n.target),be.applyQuaternion(ke),l.setFromVector3(be),n.autoRotate&&r===i.NONE&&U(F()),n.enableDamping?(l.theta+=h.theta*n.dampingFactor,l.phi+=h.phi*n.dampingFactor):(l.theta+=h.theta,l.phi+=h.phi);let Me=n.minAzimuthAngle,Bt=n.maxAzimuthAngle;return isFinite(Me)&&isFinite(Bt)&&(Me<-Math.PI?Me+=Wt:Me>Math.PI&&(Me-=Wt),Bt<-Math.PI?Bt+=Wt:Bt>Math.PI&&(Bt-=Wt),Me<=Bt?l.theta=Math.max(Me,Math.min(Bt,l.theta)):l.theta=l.theta>(Me+Bt)/2?Math.max(Me,l.theta):Math.min(Bt,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=u,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),n.enableDamping===!0?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),be.setFromSpherical(l),be.applyQuaternion(Et),Dn.copy(n.target).add(be),n.object.parent?n.object.parent.worldToLocal(Dn):n.object.position.copy(Dn),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),f.set(0,0,0)),u=1,g||hn.distanceToSquared(n.object.position)>o||8*(1-nn.dot(n.object.quaternion))>o?(n.dispatchEvent(gB),hn.copy(n.object.position),nn.copy(n.object.quaternion),g=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",je),n.domElement.removeEventListener("pointerdown",xt),n.domElement.removeEventListener("pointercancel",Cn),n.domElement.removeEventListener("wheel",ii),n.domElement.removeEventListener("pointermove",Jt),n.domElement.removeEventListener("pointerup",Dt),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Kn)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const o=1e-6,l=new aE,h=new aE;let u=1;const f=new q;let g=!1;const m=new Xe,A=new Xe,v=new Xe,b=new Xe,C=new Xe,S=new Xe,I=new Xe,M=new Xe,R=new Xe,T=[],B={};function F(){return 2*Math.PI/60/60*n.autoRotateSpeed}function D(){return Math.pow(.95,n.zoomSpeed)}function U(be){h.theta-=be}function W(be){h.phi-=be}const J=function(){const be=new q;return function(Et,hn){be.setFromMatrixColumn(hn,0),be.multiplyScalar(-Et),f.add(be)}}(),ee=function(){const be=new q;return function(Et,hn){n.screenSpacePanning===!0?be.setFromMatrixColumn(hn,1):(be.setFromMatrixColumn(hn,0),be.crossVectors(n.object.up,be)),be.multiplyScalar(Et),f.add(be)}}(),Q=function(){const be=new q,ke=new q;return function(hn,nn){const Wt=n.domElement;if(n.object.isPerspectiveCamera){n.object.getWorldPosition(ke),be.copy(ke).sub(n.target);let Ln=be.length();Ln*=Math.tan(n.object.fov/2*Math.PI/180),J(2*hn*Ln/Wt.clientHeight,n.object.matrixWorld),ee(2*nn*Ln/Wt.clientHeight,n.object.matrixWorld)}else n.object.isOrthographicCamera?(J(hn*(n.object.right-n.object.left)/n.object.zoom/Wt.clientWidth,n.object.matrixWorld),ee(nn*(n.object.top-n.object.bottom)/n.object.zoom/Wt.clientHeight,n.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function Y(be){n.object.isPerspectiveCamera?u/=be:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*be)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function se(be){n.object.isPerspectiveCamera?u*=be:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/be)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ae(be){m.set(be.clientX,be.clientY)}function ve(be){I.set(be.clientX,be.clientY)}function xe(be){b.set(be.clientX,be.clientY)}function Ae(be){A.set(be.clientX,be.clientY),v.subVectors(A,m).multiplyScalar(n.rotateSpeed);const ke=n.domElement;U(2*Math.PI*v.x/ke.clientHeight),W(2*Math.PI*v.y/ke.clientHeight),m.copy(A),n.update()}function Ie(be){M.set(be.clientX,be.clientY),R.subVectors(M,I),R.y>0?Y(D()):R.y<0&&se(D()),I.copy(M),n.update()}function Le(be){C.set(be.clientX,be.clientY),S.subVectors(C,b).multiplyScalar(n.panSpeed),Q(S.x,S.y),b.copy(C),n.update()}function De(be){be.deltaY<0?se(D()):be.deltaY>0&&Y(D()),n.update()}function $e(be){let ke=!1;switch(be.code){case n.keys.UP:Q(0,n.keyPanSpeed),ke=!0;break;case n.keys.BOTTOM:Q(0,-n.keyPanSpeed),ke=!0;break;case n.keys.LEFT:Q(n.keyPanSpeed,0),ke=!0;break;case n.keys.RIGHT:Q(-n.keyPanSpeed,0),ke=!0;break}ke&&(be.preventDefault(),n.update())}function vt(){if(T.length===1)m.set(T[0].pageX,T[0].pageY);else{const be=.5*(T[0].pageX+T[1].pageX),ke=.5*(T[0].pageY+T[1].pageY);m.set(be,ke)}}function zt(){if(T.length===1)b.set(T[0].pageX,T[0].pageY);else{const be=.5*(T[0].pageX+T[1].pageX),ke=.5*(T[0].pageY+T[1].pageY);b.set(be,ke)}}function Ve(){const be=T[0].pageX-T[1].pageX,ke=T[0].pageY-T[1].pageY,Et=Math.sqrt(be*be+ke*ke);I.set(0,Et)}function gn(){n.enableZoom&&Ve(),n.enablePan&&zt()}function Xt(){n.enableZoom&&Ve(),n.enableRotate&&vt()}function mn(be){if(T.length==1)A.set(be.pageX,be.pageY);else{const Et=Mn(be),hn=.5*(be.pageX+Et.x),nn=.5*(be.pageY+Et.y);A.set(hn,nn)}v.subVectors(A,m).multiplyScalar(n.rotateSpeed);const ke=n.domElement;U(2*Math.PI*v.x/ke.clientHeight),W(2*Math.PI*v.y/ke.clientHeight),m.copy(A)}function Nt(be){if(T.length===1)C.set(be.pageX,be.pageY);else{const ke=Mn(be),Et=.5*(be.pageX+ke.x),hn=.5*(be.pageY+ke.y);C.set(Et,hn)}S.subVectors(C,b).multiplyScalar(n.panSpeed),Q(S.x,S.y),b.copy(C)}function vn(be){const ke=Mn(be),Et=be.pageX-ke.x,hn=be.pageY-ke.y,nn=Math.sqrt(Et*Et+hn*hn);M.set(0,nn),R.set(0,Math.pow(M.y/I.y,n.zoomSpeed)),Y(R.y),I.copy(M)}function it(be){n.enableZoom&&vn(be),n.enablePan&&Nt(be)}function tt(be){n.enableZoom&&vn(be),n.enableRotate&&mn(be)}function xt(be){n.enabled!==!1&&(T.length===0&&(n.domElement.setPointerCapture(be.pointerId),n.domElement.addEventListener("pointermove",Jt),n.domElement.addEventListener("pointerup",Dt)),yt(be),be.pointerType==="touch"?me(be):Kt(be))}function Jt(be){n.enabled!==!1&&(be.pointerType==="touch"?ce(be):ln(be))}function Dt(be){mt(be),T.length===0&&(n.domElement.releasePointerCapture(be.pointerId),n.domElement.removeEventListener("pointermove",Jt),n.domElement.removeEventListener("pointerup",Dt)),n.dispatchEvent(AB),r=i.NONE}function Cn(be){mt(be)}function Kt(be){let ke;switch(be.button){case 0:ke=n.mouseButtons.LEFT;break;case 1:ke=n.mouseButtons.MIDDLE;break;case 2:ke=n.mouseButtons.RIGHT;break;default:ke=-1}switch(ke){case au.DOLLY:if(n.enableZoom===!1)return;ve(be),r=i.DOLLY;break;case au.ROTATE:if(be.ctrlKey||be.metaKey||be.shiftKey){if(n.enablePan===!1)return;xe(be),r=i.PAN}else{if(n.enableRotate===!1)return;ae(be),r=i.ROTATE}break;case au.PAN:if(be.ctrlKey||be.metaKey||be.shiftKey){if(n.enableRotate===!1)return;ae(be),r=i.ROTATE}else{if(n.enablePan===!1)return;xe(be),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(Zb)}function ln(be){switch(r){case i.ROTATE:if(n.enableRotate===!1)return;Ae(be);break;case i.DOLLY:if(n.enableZoom===!1)return;Ie(be);break;case i.PAN:if(n.enablePan===!1)return;Le(be);break}}function ii(be){n.enabled===!1||n.enableZoom===!1||r!==i.NONE||(be.preventDefault(),n.dispatchEvent(Zb),De(be),n.dispatchEvent(AB))}function Kn(be){n.enabled===!1||n.enablePan===!1||$e(be)}function me(be){switch(Ht(be),T.length){case 1:switch(n.touches.ONE){case cu.ROTATE:if(n.enableRotate===!1)return;vt(),r=i.TOUCH_ROTATE;break;case cu.PAN:if(n.enablePan===!1)return;zt(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case cu.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;gn(),r=i.TOUCH_DOLLY_PAN;break;case cu.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Xt(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(Zb)}function ce(be){switch(Ht(be),r){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;mn(be),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;Nt(be),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;it(be),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;tt(be),n.update();break;default:r=i.NONE}}function je(be){n.enabled!==!1&&be.preventDefault()}function yt(be){T.push(be)}function mt(be){delete B[be.pointerId];for(let ke=0;ke<T.length;ke++)if(T[ke].pointerId==be.pointerId){T.splice(ke,1);return}}function Ht(be){let ke=B[be.pointerId];ke===void 0&&(ke=new Xe,B[be.pointerId]=ke),ke.set(be.pageX,be.pageY)}function Mn(be){const ke=be.pointerId===T[0].pointerId?T[1]:T[0];return B[ke.pointerId]}n.domElement.addEventListener("contextmenu",je),n.domElement.addEventListener("pointerdown",xt),n.domElement.addEventListener("pointercancel",Cn),n.domElement.addEventListener("wheel",ii,{passive:!1}),this.update()}}var tK=Object.defineProperty,nK=Object.getOwnPropertyDescriptor,iK=(a,e,t,n)=>{for(var i=n>1?void 0:n?nK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&tK(e,t,i),i};class dh extends pt{constructor(){super(...arguments);x(this,"autoRotate",!1);x(this,"autoRotateSpeed",1);x(this,"enableKeys",!0);x(this,"enableDamping",!0);x(this,"dampingFactor",.1);x(this,"enableZoom",!0);x(this,"minZoom",0);x(this,"maxZoom",1/0);x(this,"enablePan",!0);x(this,"lookAtConstraint",null);x(this,"lookAtConstraint01",1);x(this,"middleClickToFocus",!0);x(this,"doubleClickToFocus",!0);x(this,"useSlerp",!1);x(this,"debugLog",!1);x(this,"targetLerpSpeed",5);x(this,"_lookTargetPosition");x(this,"_controls",null);x(this,"_cameraObject",null);x(this,"_lerpToTargetPosition",!1);x(this,"_lerpCameraToTarget",!1);x(this,"_cameraTargetPosition",null);x(this,"_inputs",0);x(this,"_enableTime",0);x(this,"_startedListeningToKeyEvents",!1)}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var n;(n=this.controls)==null||n.addEventListener("start",t)}awake(){this._lookTargetPosition=new q,this._startedListeningToKeyEvents=!1}onEnable(){this._enableTime=this.context.time.time;const t=Ee.getComponent(this.gameObject,qs),n=t==null?void 0:t.cam;this._controls||(console.assert(n!=null,"Missing camera",this),n&&(this._cameraObject=n),this._controls=new DO(n,this.context.renderer.domElement)),this._controls&&(this._controls.enableDamping=this.enableDamping,this._controls.enableKeys=this.enableKeys,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,(n==null?void 0:n.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom):(this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom),this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body)))}onDisable(){this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1)}onDestroy(){var t;(t=this._controls)==null||t.dispose()}start(){if(this._controls){const t=Ee.getComponent(this.gameObject,qs);if(t&&!this.setFromTargetPosition()){this.debugLog&&console.log("NO TARGET");const n=new q(0,0,-1).applyMatrix4(t.cam.matrixWorld);this.setTarget(n,!0)}}this.startCoroutine(this.startRaycastDelayed())}*startRaycastDelayed(){if(yield,!this.setFromTargetPosition()){const t=new nc;t.screenPoint=new Xe(0,0),t.lineThreshold=.1;const n=this.context.physics.raycast(t);n.length>0&&this.setTarget(n[0].point,!0)}}onBeforeRender(){var n,i,r,o;if(!this._controls)return;(this.context.input.getPointerDown(0)||this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2))&&(this._inputs+=1),this._inputs>0&&(this._controls.autoRotate=!1,this._lerpCameraToTarget=!1,this._lerpToTargetPosition=!1),this._inputs=0;let t=this.middleClickToFocus&&this.context.input.getPointerClicked(1);if(t||(t=this.doubleClickToFocus&&this.context.input.getPointerDoubleClicked(0)&&this.context.time.time-this._enableTime>.3),t?this.setTargetFromRaycast():(this.context.input.getPointerDown(0)||this.context.input.mouseWheelChanged)&&(this._lerpToTargetPosition=!1,this._lerpCameraToTarget=!1),this._lerpToTargetPosition||this._lerpCameraToTarget){const l=this.context.time.deltaTime*this.targetLerpSpeed;this._lerpCameraToTarget&&this._cameraTargetPosition&&this._cameraObject&&(this.useSlerp&&typeof((n=this._cameraObject)==null?void 0:n.position.slerp)=="function"?((i=this._cameraObject)==null?void 0:i.position).slerp(this._cameraTargetPosition,l):(r=this._cameraObject)==null||r.position.lerp(this._cameraTargetPosition,l),this._cameraObject.position.distanceTo(this._cameraTargetPosition)<.01&&(this._lerpCameraToTarget=!1)),this._lerpToTargetPosition&&(this.lerpTarget(this._lookTargetPosition,l),this._lookTargetPosition.distanceTo(this._controls.target)<.005&&(this._lerpToTargetPosition=!1))}(o=this.lookAtConstraint)!=null&&o.locked&&this.setFromTargetPosition(0,this.lookAtConstraint01),this._controls&&(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!0,this._controls.update())}setCameraTarget(t,n=!1){var i;t?(this._lerpCameraToTarget=!0,this._cameraTargetPosition=t.clone(),n&&this._cameraTargetPosition&&((i=this.controllerObject)==null||i.position.copy(this._cameraTargetPosition))):this._lerpCameraToTarget=!1}setFromTargetPosition(t=0,n=1){var r;if(!this._controls)return!1;const i=(r=this.lookAtConstraint)==null?void 0:r.sources;if(i&&i.length>0){const o=i[t];if(o)return o.getWorldPosition(this._lookTargetPosition),this.lerpTarget(this._lookTargetPosition,n),!0}return!1}setTarget(t=null,n=!1){!this._controls||(t!==null&&this._lookTargetPosition.copy(t),n?this._controls.target.copy(this._lookTargetPosition):this._lerpToTargetPosition=!0)}lerpTarget(t,n){!this._controls||this._controls.target.lerp(t,n)}distanceToTarget(t){return this._controls?this._controls.target.distanceTo(t):-1}setTargetFromRaycast(){if(!this.controls)return;const t=this.context.physics.raycast();for(const n of t)if(n.distance>0&&Ee.isActiveInHierarchy(n.object)){if(this._lookTargetPosition.copy(n.point),this._lerpToTargetPosition=!0,this._cameraTargetPosition=null,this.context.mainCamera){this._lerpCameraToTarget=!0;const i=ni(this.context.mainCamera);this._cameraTargetPosition=i.clone().sub(this.controls.target).add(this._lookTargetPosition)}break}}}iK([we()],dh.prototype,"lookAtConstraint",2);class fo extends ye{constructor(t,n,i,r){super(t,n,i);x(this,"alpha",1);this.alpha=r}get isRGBAColor(){return!0}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return super.copy(t),"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,n){const i=t;return i.alpha&&(this.alpha=Ci.lerp(this.alpha,i.alpha,n)),super.lerp(t,n)}multiply(t){const n=t;return n.alpha&&(this.alpha=this.alpha*n.alpha),super.multiply(t)}}var sK=Object.defineProperty,rK=Object.getOwnPropertyDescriptor,fh=(a,e,t,n)=>{for(var i=n>1?void 0:n?rK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&sK(e,t,i),i};const OO=Ct("debugcam");class qs extends pt{constructor(){super(...arguments);x(this,"orthographic",!1);x(this,"orthographicSize",5);x(this,"ARBackgroundAlpha",0);x(this,"_nearClipPlane",.1);x(this,"_farClipPlane",1e3);x(this,"_backgroundColor");x(this,"_fov",60);x(this,"_cam",null);x(this,"_clearFlags",2);x(this,"_skybox")}get aspect(){return this._cam instanceof ns?this._cam.aspect:this.context.domWidth/this.context.domHeight}get fieldOfView(){return this._fov}set fieldOfView(t){const n=this._fov!=t;this._fov=t,n&&this._cam&&this._cam instanceof ns&&(this._cam.fov=this._fov,this._cam.updateProjectionMatrix())}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(t){const n=this._nearClipPlane!=t;this._nearClipPlane=t,this._cam&&n&&(this._cam.near=t,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(t){const n=this._farClipPlane!=t;this._farClipPlane=t,this._cam&&n&&(this._cam.far=t,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(t){t!==this._clearFlags&&(this._clearFlags=t,this.applyClearFlagsIfIsActiveCamera())}get backgroundColor(){var t;return(t=this._backgroundColor)!=null?t:null}set backgroundColor(t){if(!!t){if(this._backgroundColor)this._backgroundColor.copy(t);else{if(!t.clone)return;this._backgroundColor=t.clone()}this.applyClearFlagsIfIsActiveCamera()}}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}awake(){this.sourceId||console.warn("Camera has no source - the camera should be exported inside a gltf",this.name)}onEnable(){OO&&console.log(this),this.buildCamera(),this.tag=="MainCamera"&&this.context.setCurrentCamera(this),this.applyClearFlagsIfIsActiveCamera()}buildCamera(){if(this._cam)return;const t=this.gameObject.isCamera;let n=null;if(t?n=this.gameObject:n=this.gameObject.children[0],n&&n.isCamera)n.type==="PerspectiveCamera"&&(n.fov=this._fov,n.near=this._nearClipPlane,n.far=this._farClipPlane,n.updateProjectionMatrix());else if(!this.orthographic)n=new ns(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),n.fov=this.fieldOfView;else{const i=this.orthographicSize*100;n=new lh(window.innerWidth/-i,window.innerWidth/i,window.innerHeight/i,window.innerHeight/-i,this._nearClipPlane,this._farClipPlane)}this._cam=n,this.layer===0&&this._cam.layers.enableAll(),this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(){var t;if(this._cam&&this.context.mainCameraComponent===this)switch(this._clearFlags){case 1:if(this.environmentIsTransparent()&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}this.enableSkybox();break;case 2:if(this._backgroundColor){let n=this._backgroundColor.alpha;this.environmentIsTransparent()&&(n=(t=this.ARBackgroundAlpha)!=null?t:0),this.context.scene.background=null,this.context.renderer.setClearColor(this._backgroundColor,n)}break;case 4:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}environmentIsTransparent(){var r,o;const t=(r=this.context.renderer.xr)==null?void 0:r.getSession();if(!t)return!1;const n=t.environmentBlendMode,i=n==="additive"||n==="alpha-blend";return n==="opaque"&&((o=navigator.userAgent)==null?void 0:o.includes("OculusBrowser"))&&this.context.xrSessionMode===Tg.ImmersiveAR?!0:i}enableSkybox(){this._skybox||(this._skybox=new oK(this)),this._skybox.enable()}}fh([we()],qs.prototype,"fieldOfView",1);fh([we()],qs.prototype,"nearClipPlane",1);fh([we()],qs.prototype,"farClipPlane",1);fh([we()],qs.prototype,"clearFlags",1);fh([we()],qs.prototype,"orthographic",2);fh([we()],qs.prototype,"orthographicSize",2);fh([we()],qs.prototype,"ARBackgroundAlpha",2);fh([we(fo)],qs.prototype,"backgroundColor",1);class oK{constructor(e){x(this,"_camera");x(this,"_skybox");this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}enable(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?(OO&&console.log("Set skybox",this._camera,this._skybox),this._skybox.encoding=Gn,this._skybox.mapping=Qa,this.context.scene.background=this._skybox):console.warn("Failed to load/find skybox texture",this)}}function aK(a){const e="created/implictly",t=new Ft;a.add(t);const n=Ee.addNewComponent(t,qs,!1);n.sourceId=e;const i=Ee.addNewComponent(t,dh,!1);return i.sourceId=e,n}const yB={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Wv{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const cK=new lh(-1,1,1,-1,0,1),lM=new Sn;lM.setAttribute("position",new tn([-1,3,0,-1,-1,0,3,-1,0],3));lM.setAttribute("uv",new tn([0,2,0,0,2,0],2));class lK{constructor(e){this._mesh=new _t(lM,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,cK)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class _B extends Wv{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof js?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=dS.clone(e.uniforms),this.material=new js({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new lK(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class vB extends Wv{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,l;this.inverse?(o=0,l=1):(o=1,l=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),r.buffers.stencil.setClear(l),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class hK extends Wv{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class uK{constructor(e,t){if(this.renderer=e,t===void 0){const n=e.getSize(new Xe);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,t=new Xr(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],yB===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),_B===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new _B(yB),this.clock=new Sv}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,r=this.passes.length;i<r;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const l=this.renderer.getContext(),h=this.renderer.state.buffers.stencil;h.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),h.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}vB!==void 0&&(o instanceof vB?n=!0:o instanceof hK&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Xe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new lh(-1,1,1,-1,0,1);const FO=new Sn;FO.setAttribute("position",new tn([-1,3,0,-1,-1,0,3,-1,0],3));FO.setAttribute("uv",new tn([0,2,0,0,2,0],2));class dK extends Wv{constructor(e,t,n,i,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ye}render(e,t,n){const i=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=i}}class $b{constructor(e,t,n,i){x(this,"_name");x(this,"_nameHash");x(this,"_normalizedTime");x(this,"_length");x(this,"_speed");this._name=e.name,this._nameHash=e.hash,this._normalizedTime=t,this._length=n,this._speed=i}get name(){return this._name}get nameHash(){return this._nameHash}get normalizedTime(){return this._normalizedTime}get length(){return this._length}get speed(){return this._speed}}function fK(a,e){var t;return{name:"",isLooping:!1,guid:(t=e==null?void 0:e.generateUUID())!=null?t:zu.generateUUID(),index:-1,clip:new rh(a,1,[])}}var du=(a=>(a[a.If=1]="If",a[a.IfNot=2]="IfNot",a[a.Greater=3]="Greater",a[a.Less=4]="Less",a[a.Equals=6]="Equals",a[a.NotEqual=7]="NotEqual",a))(du||{}),kO=(a=>(a[a.Float=1]="Float",a[a.Int=3]="Int",a[a.Bool=4]="Bool",a[a.Trigger=9]="Trigger",a))(kO||{});const Il=Ct("debuganimatorcontroller"),eC=Ct("debugrootmotion");class Hf{constructor(e){x(this,"normalizedStartOffset",0);x(this,"_speed",1);x(this,"animator");x(this,"model");x(this,"_mixer");x(this,"_activeState");x(this,"_activeStates",[]);x(this,"rootMotionHandler");this.model=e,Il&&console.log(this)}Play(e,t=-1,n=Number.NEGATIVE_INFINITY,i=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[t].stateMachine;for(const l of o.states)if(l.name===e||l.hash===e){Il&&console.log("transition to ",l),this.transitionTo(l,i,n);return}console.warn("Could not find "+e+" to play")}Reset(){this.setStartTransition()}SetBool(e,t){var i;const n=typeof e=="string"?"name":"hash";return(i=this.model)==null?void 0:i.parameters.filter(r=>r[n]===e).forEach(r=>r.value=t)}GetBool(e){var n,i,r;const t=typeof e=="string"?"name":"hash";return(r=(i=(n=this.model)==null?void 0:n.parameters.find(o=>o[t]===e))==null?void 0:i.value)!=null?r:!1}SetFloat(e,t){var i;const n=typeof e=="string"?"name":"hash";return(i=this.model)==null?void 0:i.parameters.filter(r=>r[n]===e).forEach(r=>r.value=t)}GetFloat(e){var n,i,r;const t=typeof e=="string"?"name":"hash";return(r=(i=(n=this.model)==null?void 0:n.parameters.find(o=>o[t]===e))==null?void 0:i.value)!=null?r:0}SetInteger(e,t){var i;const n=typeof e=="string"?"name":"hash";return(i=this.model)==null?void 0:i.parameters.filter(r=>r[n]===e).forEach(r=>r.value=t)}GetInteger(e){var n,i,r;const t=typeof e=="string"?"name":"hash";return(r=(i=(n=this.model)==null?void 0:n.parameters.find(o=>o[t]===e))==null?void 0:i.value)!=null?r:0}SetTrigger(e){var n;Il&&console.log("SET TRIGGER",e);const t=typeof e=="string"?"name":"hash";return(n=this.model)==null?void 0:n.parameters.filter(i=>i[t]===e).forEach(i=>i.value=!0)}ResetTrigger(e){var n;const t=typeof e=="string"?"name":"hash";return(n=this.model)==null?void 0:n.parameters.filter(i=>i[t]===e).forEach(i=>i.value=!1)}IsInTransition(){return this._activeStates.length>1}SetSpeed(e){this._speed=e}FindState(e){if(!e)return null;for(const t of this.model.layers)for(const n of t.stateMachine.states)if(n.name===e)return n;return null}get context(){var e;return(e=this.animator)==null?void 0:e.context}bind(e){this.animator=e,this._mixer=new Tv(this.animator.gameObject),this.createActions(this.animator)}clone(){const e=qS(this.model,(n,i,r)=>{var o;return r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||((o=r==null?void 0:r.constructor)==null?void 0:o.name)==="AnimationAction"||r.tracks!==void 0)});return console.assert(e!==this.model),new Hf(e)}update(){var t,n;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates();const e=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((t=this.rootMotionHandler)==null||t.onBeforeUpdate()),this._mixer.update(e),this.animator.applyRootMotion&&((n=this.rootMotionHandler)==null||n.onAfterUpdate())}updateActiveStates(){for(let e=0;e<this._activeStates.length;e++){const t=this._activeStates[e],n=t.motion;if(!n.action)this._activeStates.splice(e,1),e--;else{const i=n.action;i.getEffectiveWeight()<=0&&!i.isRunning()&&(Il&&console.debug("REMOVE",t.name,i.getEffectiveWeight(),i.isRunning(),i.isScheduled()),this._activeStates.splice(e,1),e--)}}}setStartTransition(){for(const e of this.model.layers){const t=e.stateMachine,n=t.states[t.defaultState];this.transitionTo(n,0,this.normalizedStartOffset)}}evaluateTransitions(){var r;let e=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;e=!0}const t=this._activeState,n=t.motion.action;for(const o of t.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let l=!0;for(const h of o.conditions)if(!this.evaluateCondition(h)){l=!1;break}if(!!l){Il&&l&&console.log("All conditions are met",o.conditions,n);for(const h of o.conditions){const u=this.model.parameters.find(f=>f.name===h.parameter);(u==null?void 0:u.type)===kO.Trigger&&(u.value=!1)}if(n){const h=t.motion.clip.duration,u=h<=0?1:n.time/h;if(!o.hasExitTime||u>=o.exitTime&&n.time>=n.getClip().duration){n.clampWhenFinished=!0,Il&&(console.log("transition to "+o.destinationState,o),console.log(n.time,o.exitTime)),this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}break}}let i=!1;if(t.motion.isLooping&&n&&n.time>=n.getClip().duration&&(i=!0,n.reset(),n.time=0,n.play()),!i&&t&&!e&&n&&this.animator&&t.behaviours){const o=n==null?void 0:n.getClip().duration,l=n.time/o,h=new $b(this._activeState,l,o,this._speed);for(const u of t.behaviours)u.instance&&((r=u.instance.onStateUpdate)==null||r.call(u.instance,this.animator,h,0))}}transitionTo(e,t,n){var u,f,g,m,A,v,b,C;if(!this.animator)return;const i=0;if(typeof e=="number"&&(e==-1&&(e=this.model.layers[i].stateMachine.defaultState),e=this.model.layers[i].stateMachine.states[e]),!(e!=null&&e.motion)||!e.motion.clip)return;const r=this._activeState===e;if(r){const S=e.motion;!S.action_loopback&&S.clip&&(this._mixer.uncacheAction(S.clip,this.animator.gameObject),S.action_loopback=this.createAction(S.clip))}if(((u=this._activeState)==null?void 0:u.behaviours)&&this._activeState.motion.action){const S=(f=this._activeState)==null?void 0:f.motion.clip.duration,I=this._activeState.motion.action.time/S,M=new $b(this._activeState,I,S,this._speed);for(const R of this._activeState.behaviours)(m=(g=R.instance)==null?void 0:g.onStateExit)==null||m.call(R.instance,this.animator,M,i)}const o=(A=this._activeState)==null?void 0:A.motion.action;o&&o.fadeOut(t),r&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=o);const l=this._activeState;this._activeState=e;const h=(v=e.motion)==null?void 0:v.action;if(h){n=Math.max(0,Math.min(1,n)),h.isRunning()&&h.stop(),h.reset(),h.timeScale=this._speed,h.enabled=!0;const S=e.motion.clip.duration;if(h.time=n*S,h.clampWhenFinished=!0,h.setLoop(hv,0),t>0?h.fadeIn(t):h.setEffectiveWeight(1),h.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(h),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const I=new $b(e,n,S,this._speed);for(const M of this._activeState.behaviours)(C=(b=M.instance)==null?void 0:b.onStateEnter)==null||C.call(M.instance,this.animator,I,i)}}else console.warn("No action",e.motion,this);Il&&console.log("TRANSITION FROM "+(l==null?void 0:l.name)+" TO "+e.name,t,o,h,h==null?void 0:h.getEffectiveTimeScale(),h==null?void 0:h.getEffectiveWeight(),h==null?void 0:h.isRunning(),h==null?void 0:h.isScheduled(),h==null?void 0:h.paused)}createAction(e){var t;if(this._mixer.uncacheClip(e),(t=this.animator)!=null&&t.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new pK(this));const n=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,n,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const t=this.model.parameters.find(n=>n.name===e.parameter);if(!t)return!1;switch(e.mode){case du.If:return t.value===!0;case du.IfNot:return t.value===!1;case du.Greater:return t.value>e.threshold;case du.Less:return t.value<e.threshold;case du.Equals:return t.value===e.threshold;case du.NotEqual:return t.value!==e.threshold}return!1}createActions(e){var t,n,i;for(const r of this.model.layers){const o=r.stateMachine;for(let l=0;l<o.states.length;l++){const h=o.states[l];if(h.motion||(h.motion=fK(h.name)),this.animator&&h.motion.clips){const u=(t=h.motion.clips)==null?void 0:t.find(f=>{var g,m;return f.node.name===((m=(g=this.animator)==null?void 0:g.gameObject)==null?void 0:m.name)});h.motion.clip=u==null?void 0:u.clip}if(!h.motion.clip){const u=new rh;h.motion.clip=u}if((n=h.motion)!=null&&n.clip){const u=h.motion.clip,f=this.createAction(u);h.motion.action=f}if(h.behaviours&&Array.isArray(h.behaviours))for(const u of h.behaviours){if(!(u!=null&&u.typeName))continue;const f=Be.get(u.typeName),g=new f;g.isStateMachineBehaviour&&(g._context=(i=this.context)!=null?i:void 0,Pv(g,u.properties),u.instance=g),Il&&console.log("Created animator controller behaviour",h.name,u.typeName,u.properties,g)}}}}*enumerateActions(){for(const e of this.model.layers){const t=e.stateMachine;for(let n=0;n<t.states.length;n++){const i=t.states[n];i!=null&&i.motion&&(i.motion.action&&(yield i.motion.action),i.motion.action_loopback&&(yield i.motion.action_loopback))}}}}class xB{constructor(e,t){x(this,"track");x(this,"createdInterpolant");x(this,"originalEvaluate");x(this,"customEvaluate");this.track=e;const n=e,i=n.createInterpolant.bind(e);n.createInterpolant=()=>(n.createInterpolant=i,this.createdInterpolant=i(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return t(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}evaluate(e){this.customEvaluate&&this.customEvaluate(e)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const Cs=class{constructor(e,t,n,i,r){x(this,"_action");x(this,"root");x(this,"clip");x(this,"positionWrapper",null);x(this,"rotationWrapper",null);x(this,"context");x(this,"positionChange",new q);x(this,"rotationChange",new kt);if(this.context=e,this.root=t,this.clip=n,Cs.firstKeyframeRotation[n.uuid]||(Cs.firstKeyframeRotation[n.uuid]=new kt),r){const o=r.values;Cs.firstKeyframeRotation[n.uuid].set(o[0],o[1],o[2],o[3])}Cs.spaceRotation[n.uuid]||(Cs.spaceRotation[n.uuid]=new kt),Cs.effectiveSpaceRotation[n.uuid]||(Cs.effectiveSpaceRotation[n.uuid]=new kt),Cs.clipOffsetRotation[n.uuid]=new kt,r&&Cs.clipOffsetRotation[n.uuid].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(n,i),this.handleRotation(n,r)}set action(e){this._action=e}get action(){return this._action}onStart(e){if(e.getClip()!==this.clip)return;const t=Cs.lastObjRotation[this.root.uuid];Cs.spaceRotation[this.clip.uuid].copy(t);{const n=new _s().setFromQuaternion(t);console.log("START",this.clip.name,Ci.toDegrees(n.y))}}getClipRotationOffset(){return Cs.clipOffsetRotation[this.clip.uuid]}handlePosition(e,t){if(t){const n=this.root;eC&&n.add(new Iv),Cs.lastObjPosition[n.uuid]||(Cs.lastObjPosition[n.uuid]=new q);const i=new q,r=new q;let o=0;this.positionWrapper=new xB(t,(l,h)=>{const u=this.action.getEffectiveWeight();if(eC&&n.position.length()>8&&n.position.set(0,n.position.y,0),l>o){i.set(h[0],h[1],h[2]),i.sub(r),i.multiplyScalar(u),i.applyQuaternion(this.getClipRotationOffset());const f=this.clip.uuid;i.applyQuaternion(Cs.spaceRotation[f]),this.positionChange.copy(i)}return r.fromArray(h),o=l,h[0]=0,h[1]=0,h[2]=0,h})}}handleRotation(e,t){if(t){if(eC){const l=t.values,h=new _s().setFromQuaternion(new kt(l[0],l[1],l[2],l[3]));console.log(e.name,t.name,"FIRST ROTATION IN TRACK",Ci.toDegrees(h.y));const u=t.values.length-4,f=new kt().set(l[u],l[u+1],l[u+2],l[u+3]),g=new _s().setFromQuaternion(f);console.log(e.name,t.name,"LAST ROTATION IN TRACK",Ci.toDegrees(g.y))}const n=this.root;Cs.lastObjRotation[n.uuid]||(Cs.lastObjRotation[n.uuid]=new kt);let i=0;const r=new kt,o=new kt;this.rotationWrapper=new xB(t,(l,h)=>(l>i&&(o.set(h[0],h[1],h[2],h[3]),r.invert(),o.multiply(r),this.rotationChange.copy(o)),r.fromArray(h),i=l,h[0]=0,h[1]=0,h[2]=0,h[3]=1,h))}}onBeforeUpdate(){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(){const e=this.action.getEffectiveWeight();this.positionChange.multiplyScalar(e),this.rotationChange.slerp(Cs.identityQuaternion,1-e)}};let sa=Cs;x(sa,"lastObjPosition",{}),x(sa,"lastObjRotation",{}),x(sa,"firstKeyframeRotation",{}),x(sa,"spaceRotation",{}),x(sa,"effectiveSpaceRotation",{}),x(sa,"clipOffsetRotation",{}),x(sa,"identityQuaternion",new kt);class pK{constructor(e){x(this,"controller");x(this,"handler",[]);x(this,"root");x(this,"summedPosition",new q);x(this,"summedRotation",new kt);this.controller=e}createClip(e,t,n){this.root=t,t&&"name"in t&&t.name;const i=this.findRootTrack(n,".position"),r=this.findRootTrack(n,".quaternion"),o=new sa(this.controller.context,t,n,i,r);this.handler.push(o);const l=e.clipAction(n);return o.action=l,l}onStart(e){for(const t of this.handler)t.onStart(e)}onBeforeUpdate(){for(const e of this.handler)e.onBeforeUpdate()}onAfterUpdate(){this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const e of this.handler)e.onAfterUpdate(),this.summedPosition.add(e.positionChange),this.summedRotation.multiply(e.rotationChange);this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation),sa.lastObjRotation[this.root.uuid].copy(this.root.quaternion)}findRootTrack(e,t){const n=e.tracks;for(const i of n)if(i.name.endsWith(t))return i;return null}}var mK=Object.defineProperty,gK=Object.getOwnPropertyDescriptor,Qv=(a,e,t,n)=>{for(var i=n>1?void 0:n?gK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&mK(e,t,i),i};const AK=Ct("debuganimator");class ph extends pt{constructor(){super(...arguments);x(this,"applyRootMotion",!1);x(this,"hasRootMotion",!1);x(this,"keepAnimatorControllerStateOnDisable",!1);x(this,"speed",1);x(this,"normalizedStartOffset",0);x(this,"_animatorController",null)}set runtimeAnimatorController(t){this._animatorController&&this._animatorController.model===t||(t?t instanceof Hf?this._animatorController=t:this._animatorController=new Hf(t):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}Play(t,n=-1,i=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.Play(t,n,i,r)}Reset(){var t;(t=this._animatorController)==null||t.Reset()}SetBool(t,n){var i;(i=this.runtimeAnimatorController)==null||i.SetBool(t,n)}GetBool(t){var n,i;return(i=(n=this.runtimeAnimatorController)==null?void 0:n.GetBool(t))!=null?i:!1}SetFloat(t,n){var i;(i=this.runtimeAnimatorController)==null||i.SetFloat(t,n)}GetFloat(t){var n,i;return(i=(n=this.runtimeAnimatorController)==null?void 0:n.GetFloat(t))!=null?i:-1}SetInteger(t,n){var i;(i=this.runtimeAnimatorController)==null||i.SetInteger(t,n)}GetInteger(t){var n,i;return(i=(n=this.runtimeAnimatorController)==null?void 0:n.GetInteger(t))!=null?i:-1}SetTrigger(t){var n;(n=this.runtimeAnimatorController)==null||n.SetTrigger(t)}ResetTrigger(t){var n;(n=this.runtimeAnimatorController)==null||n.ResetTrigger(t)}IsInTransition(){var t,n;return(n=(t=this.runtimeAnimatorController)==null?void 0:t.IsInTransition())!=null?n:!1}SetSpeed(t){var n;t!==this.speed&&(this.speed=t,(n=this._animatorController)==null||n.SetSpeed(t))}set minMaxSpeed(t){this.speed=Ci.lerp(t.x,t.y,Math.random())}set minMaxOffsetNormalized(t){this.normalizedStartOffset=Ci.lerp(t.x,t.y,Math.random()),this.runtimeAnimatorController&&(this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset)}awake(){if(!!this.gameObject){if(this.runtimeAnimatorController){const t=this.runtimeAnimatorController.clone();console.assert(this.runtimeAnimatorController!==t),this.runtimeAnimatorController=t,console.assert(this.runtimeAnimatorController===t),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.SetSpeed(this.speed),this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset}AK&&console.log("ANIMATOR",this.name,this)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.Reset()}onBeforeRender(){this._animatorController&&this._animatorController.update()}}Qv([we()],ph.prototype,"applyRootMotion",2);Qv([we()],ph.prototype,"hasRootMotion",2);Qv([we()],ph.prototype,"keepAnimatorControllerStateOnDisable",2);Qv([we()],ph.prototype,"runtimeAnimatorController",1);var yK=Object.defineProperty,_K=Object.getOwnPropertyDescriptor,NO=(a,e,t,n)=>{for(var i=n>1?void 0:n?_K(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&yK(e,t,i),i};class Yl extends pt{constructor(){super(...arguments);x(this,"playAutomatically",!0);x(this,"randomStartTime",!0);x(this,"_tempAnimationClipBeforeGameObjectExisted",null);x(this,"mixer");x(this,"_actions",[]);x(this,"_currentActions",[]);x(this,"_handles",[]);x(this,"_didInit",!1)}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.gameObject){this._tempAnimationClipBeforeGameObjectExisted=t;return}!t||(this.gameObject.animations||(this.gameObject.animations=[]),this.gameObject.animations.push(t))}set animations(t){this.gameObject.animations=t}get animations(){return this.gameObject.animations}get currentAction(){return this._currentActions[0]}get currentActions(){return this._currentActions}get actions(){return this._actions}set actions(t){this._actions=t}awake(){this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.playAutomatically&&this.init()}onEnable(){if(this.playAutomatically&&this.actions.length>0&&this.currentActions.length<=0){const t=Math.floor(Math.random()*this.actions.length);this.play(t)}}start(){this.randomStartTime&&this.currentAction&&(this.currentAction.time=Math.random()*this.currentAction.getClip().duration)}update(){var t;if(!!this.mixer){this.mixer.update(this.context.time.deltaTime);for(const n of this._handles)n._update();((t=this._handles)==null?void 0:t.length)>0&&Pr.markDirty(this.gameObject)}}getAction(t){var n;return(n=this.actions)==null?void 0:n.find(i=>i.getClip().name===t)}play(t,n){if(this.init(),!this.mixer)return;let i=t;if(typeof t=="number"){if(t>=this.animations.length)return;i=this.animations[t]}else typeof t=="string"&&(i=this.animations.find(o=>o.name===t));if(!i){console.error("Could not find clip",t);return}for(const o of this.actions)if(o.getClip()===i)return this.internalOnPlay(o,n);const r=this.mixer.clipAction(i);return this.actions.push(r),this.internalOnPlay(r,n)}internalOnPlay(t,n){var l;var i=this.currentAction;if(i===t&&i.isRunning()&&i.time<i.getClip().duration){const h=this.tryFindHandle(t);if(h)return h.getPromise()}const r=(l=n==null?void 0:n.exclusive)!=null?l:!0;n!=null&&n.fadeDuration?(r&&(i==null||i.fadeOut(n.fadeDuration)),t.fadeIn(n.fadeDuration)):r&&(i==null||i.stop()),t.reset(),t.enabled=!0,t.time=0,t.timeScale=1,n!=null&&n.clampWhenFinished&&(t.clampWhenFinished=!0),(n==null?void 0:n.startTime)!==void 0&&(t.time=n.startTime),(n==null?void 0:n.loop)!==void 0&&(t.loop=n.loop?sS:hv),t.play();const o=new vK(t,this.mixer,n,h=>{this._handles.splice(this._handles.indexOf(o),1)});return this._handles.push(o),o.getPromise()}tryFindHandle(t){for(const n of this._handles)if(n.action===t)return n}init(){if(!this._didInit&&(this._didInit=!0,!!this.gameObject)){this.actions=[],this.mixer=new Tv(this.gameObject);for(let t=0;t<this.animations.length;t++){const n=this.mixer.clipAction(this.animations[t]);this.actions.push(n)}}}}NO([we()],Yl.prototype,"playAutomatically",2);NO([we()],Yl.prototype,"randomStartTime",2);class vK{constructor(e,t,n,i){x(this,"mixer");x(this,"action");x(this,"promise",null);x(this,"resolve",null);x(this,"reject",null);x(this,"_options");x(this,"_resolveCallback",null);x(this,"_rejectCallback",null);x(this,"_loopCallback");x(this,"_finishedCallback");x(this,"_resolvedOrRejectedCallback");this.action=e,this.mixer=t,this._resolvedOrRejectedCallback=i,this._options=n}getPromise(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this._resolveCallback=e,this._rejectCallback=t,this.resolve=this.onResolve.bind(this),this.reject=this.onReject.bind(this)}),this._loopCallback=this.onLoop.bind(this),this._finishedCallback=this.onFinished.bind(this),this.mixer.addEventListener("loop",this._loopCallback),this.mixer.addEventListener("finished",this._finishedCallback),this.promise)}_update(){var e;!this._options||this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=(e=this._options.startTime)!=null?e:0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,t;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}onReject(e){var t,n;this.dispose(),(t=this._resolvedOrRejectedCallback)==null||t.call(this,this),(n=this._rejectCallback)==null||n.call(this,e)}onLoop(e){}onFinished(e){e.action===this.action&&this.onResolve()}dispose(){this._loopCallback&&this.mixer.removeEventListener("loop",this._loopCallback),this._finishedCallback&&this.mixer.removeEventListener("finished",this._finishedCallback),this._loopCallback=void 0,this._finishedCallback=void 0}}class np extends _r{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.animationPointerResolver=null,this.pluginCallbacks=[],this.register(function(t){return new EK(t)}),this.register(function(t){return new LK(t)}),this.register(function(t){return new DK(t)}),this.register(function(t){return new TK(t)}),this.register(function(t){return new IK(t)}),this.register(function(t){return new RK(t)}),this.register(function(t){return new PK(t)}),this.register(function(t){return new CK(t)}),this.register(function(t){return new BK(t)}),this.register(function(t){return new MK(t)}),this.register(function(t){return new wK(t)}),this.register(function(t){return new OK(t)}),this.register(function(t){return new SK(t)})}load(e,t,n,i){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=Xa.extractUrlBase(e),this.manager.itemStart(e);const l=function(u){i?i(u):console.error(u),r.manager.itemError(e),r.manager.itemEnd(e)},h=new ks(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(u){try{r.parse(u,o,function(f){t(f),r.manager.itemEnd(e)},l)}catch(f){l(f)}},n,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const o={},l={};if(typeof e=="string")r=e;else if(Xa.decodeText(new Uint8Array(e,0,4))===UO){try{o[Xn.KHR_BINARY_GLTF]=new FK(e)}catch(g){i&&i(g);return}r=o[Xn.KHR_BINARY_GLTF].content}else r=Xa.decodeText(new Uint8Array(e));const h=JSON.parse(r);if(h.asset===void 0||h.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new XK(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder,animationPointerResolver:this.animationPointerResolver});u.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const g=this.pluginCallbacks[f](u);l[g.name]=g,o[g.name]=!0}if(h.extensionsUsed)for(let f=0;f<h.extensionsUsed.length;++f){const g=h.extensionsUsed[f],m=h.extensionsRequired||[];switch(g){case Xn.KHR_MATERIALS_UNLIT:o[g]=new bK;break;case Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[g]=new UK;break;case Xn.KHR_DRACO_MESH_COMPRESSION:o[g]=new kK(h,this.dracoLoader);break;case Xn.KHR_TEXTURE_TRANSFORM:o[g]=new NK;break;case Xn.KHR_MESH_QUANTIZATION:o[g]=new zK;break;default:m.indexOf(g)>=0&&l[g]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}u.setExtensions(o),u.setPlugins(l),u.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,t,i,r)})}}function xK(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const Xn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",KHR_ANIMATION_POINTER:"KHR_animation_pointer",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class wK{constructor(e){this.parser=e,this.name=Xn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,h=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let u;const f=new ye(16777215);h.color!==void 0&&f.fromArray(h.color);const g=h.range!==void 0?h.range:0;switch(h.type){case"directional":u=new Cv(f),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new bv(f),u.distance=g;break;case"spot":u=new wv(f),u.distance=g,h.spot=h.spot||{},h.spot.innerConeAngle=h.spot.innerConeAngle!==void 0?h.spot.innerConeAngle:0,h.spot.outerConeAngle=h.spot.outerConeAngle!==void 0?h.spot.outerConeAngle:Math.PI/4,u.angle=h.spot.outerConeAngle,u.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return u.position.set(0,0,0),u.decay=2,h.intensity!==void 0&&(u.intensity=h.intensity),u.name=t.createUniqueName(h.name||"light_"+e),i=Promise.resolve(u),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],l=(r.extensions&&r.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(h){return n._getNodeRef(t.cache,l,h)})}}class bK{constructor(){this.name=Xn.KHR_MATERIALS_UNLIT}getMaterialType(){return Hi}extendParams(e,t,n){const i=[];e.color=new ye(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",r.baseColorTexture,Gn))}return Promise.all(i)}}class CK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class EK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const l=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Xe(l,l)}return Promise.all(r)}}class SK{constructor(e){x(this,"ANIMATION_TARGET_TYPE",{node:"node",material:"material",camera:"camera",light:"light"});x(this,"_animationPointerDebug",!1);x(this,"_havePatchedPropertyBindings",!1);this.parser=e,this.name=Xn.KHR_ANIMATION_POINTER}_patchPropertyBindingFindNode(){if(this._havePatchedPropertyBindings)return;this._havePatchedPropertyBindings=!0;const e=ti.findNode;ti.findNode=(t,n)=>{if(n.startsWith(".materials.")){this._animationPointerDebug&&console.log("FIND",n);const i=n.substring(11).substring(n.indexOf(".")),r=i.indexOf("."),o=r<0?i:i.substring(0,r);let l=null;return t.traverse(h=>{var u,f;l!==null||h.type!=="Mesh"||(((u=h.material)==null?void 0:u.uuid)===o||((f=h.material)==null?void 0:f.name)===o)&&(l=h.material,this._animationPointerDebug&&console.log(l,i),l!==null&&(i.endsWith(".map")?l=l.map:i.endsWith(".emissiveMap")&&(l=l.emissiveMap)))}),l}else if(n.startsWith(".nodes.")||n.startsWith(".lights.")||n.startsWith(".cameras.")){const i=n.split(".");let r;for(let o=1;o<i.length;o++){const l=i[o];if(l.length==36)r=t.getObjectByProperty("uuid",l);else if(r&&r[l]){const u=Number.parseInt(l);let f=l;u>=0&&(f=u),r=r[f],this._animationPointerDebug&&console.log(r)}else{const u=t.getObjectByName(l);u&&(r=u)}}if(!r){const o=e(t,i[2]);return o||console.error("not found",n,t,t.name,i),o}return this._animationPointerDebug&&console.log("NODE",n,r),r}return e(t,n)}}loadAnimationTargetFromChannel(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const t=e.target,n=t.extensions&&t.extensions[Xn.KHR_ANIMATION_POINTER]&&t.path&&t.path==="pointer";if(!n)return null;let i,r=this.ANIMATION_TARGET_TYPE.node,o;if(n){const h=t.extensions[Xn.KHR_ANIMATION_POINTER];let u=h.pointer;if(this._animationPointerDebug&&console.log("Original path: "+u,t),!u){console.warn("Invalid path",h,t);return}if(u.startsWith("/materials/")?r=this.ANIMATION_TARGET_TYPE.material:u.startsWith("/extensions/KHR_lights_punctual/lights/")?r=this.ANIMATION_TARGET_TYPE.light:u.startsWith("/cameras/")&&(r=this.ANIMATION_TARGET_TYPE.camera),o=this._tryResolveTargetId(u,r),o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,u);return}else this._animationPointerDebug&&console.log("Resolved node ID for "+r,o);switch(r){case this.ANIMATION_TARGET_TYPE.material:const g=("/materials/"+o.toString()+"/").length,m=u.substring(0,g);switch(i=u.substring(g),i){case"pbrMetallicRoughness/baseColorFactor":i="color";break;case"pbrMetallicRoughness/roughnessFactor":i="roughness";break;case"pbrMetallicRoughness/metallicFactor":i="metalness";break;case"emissiveFactor":i="emissive";break;case"alphaCutoff":i="alphaTest";break;case"occlusionTexture/strength":i="aoMapIntensity";break;case"normalTexture/scale":i="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":i="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":i="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":i="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":i="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":i="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":i="transmission";break;case"extensions/KHR_materials_ior/ior":i="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":i="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":i="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":i="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":i="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":i="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":i="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":i="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":i="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":i="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":i="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":i="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":i="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":i="specularColor";break}u=m+i,this._animationPointerDebug&&console.log("PROPERTY PATH",m,i,u);break;case this.ANIMATION_TARGET_TYPE.node:const A=("/nodes/"+o.toString()+"/").length,v=u.substring(0,A);switch(i=u.substring(A),i){case"translation":i="position";break;case"rotation":i="quaternion";break;case"scale":i="scale";break;case"weights":i="morphTargetInfluences";break}u=v+i;break;case this.ANIMATION_TARGET_TYPE.light:const b=("/extensions/KHR_lights_punctual/lights/"+o.toString()+"/").length;switch(i=u.substring(b),i){case"color":break;case"intensity":break;case"spot/innerConeAngle":i="penumbra";break;case"spot/outerConeAngle":i="angle";break;case"range":i="distance";break}u="/lights/"+o.toString()+"/"+i;break;case this.ANIMATION_TARGET_TYPE.camera:const C=("/cameras/"+o.toString()+"/").length,S=u.substring(0,C);switch(i=u.substring(C),i){case"perspective/yfov":i="fov";break;case"perspective/znear":case"orthographic/znear":i="near";break;case"perspective/zfar":case"orthographic/zfar":i="far";break;case"perspective/aspect":i="aspect";break;case"orthographic/xmag":i="zoom";break;case"orthographic/ymag":i="zoom";break}u=S+i;break}const f=this.parser.options.animationPointerResolver;f&&f.resolvePath&&(u=f.resolvePath(u)),t.extensions[Xn.KHR_ANIMATION_POINTER].pointer=u}if(o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,t);return}let l;return r===this.ANIMATION_TARGET_TYPE.node?l=this.parser.getDependency("node",o):r===this.ANIMATION_TARGET_TYPE.material?l=this.parser.getDependency("material",o):r===this.ANIMATION_TARGET_TYPE.light?l=this.parser.getDependency("light",o):r===this.ANIMATION_TARGET_TYPE.camera?l=this.parser.getDependency("camera",o):console.error("Unhandled type",r),l}getDependency(e,t){}createAnimationTracks(e,t,n,i,r){var v;if(!(r.extensions&&r.extensions[Xn.KHR_ANIMATION_POINTER]&&r.path&&r.path==="pointer"))return null;let l=r.extensions[Xn.KHR_ANIMATION_POINTER].pointer;if(!l)return null;const h=[];l=l.replaceAll("/",".");const u=l.split(".");u[2]=(v=e.name)!=null?v:e.uuid,l=u.join("."),this._animationPointerDebug&&console.log(e,t,n,r,l);let f;switch(n.itemSize){case 1:f=ih;break;case 2:case 3:f=sh;break;case 4:l.endsWith(".quaternion")?f=tc:f=qg;break}const g=i.interpolation!==void 0?GO[i.interpolation]:jc;let m=HO(n);l.endsWith(".fov")&&(m=m.map(b=>b/Math.PI*180));const A=new f(l,t.array,m,g);if(g==="CUBICSPLINE"&&wE(A),h.push(A),l&&n.itemSize===4&&l.startsWith(".materials.")&&l.endsWith(".color")){const b=new Float32Array(m.length/4);for(let S=0,I=m.length/4;S<I;S+=1)b[S]=m[S*4+3];const C=new f(l.replace(".color",".opacity"),t.array,b,g);g==="CUBICSPLINE"&&wE(A),h.push(C)}return h}_tryResolveTargetId(e,t){let n="";return t==="node"?n=e.substring(7):t==="material"?n=e.substring(11):t==="light"?n=e.substring(39):t==="camera"&&(n=e.substring(9)),n=n.substring(0,n.indexOf("/")),Number.parseInt(n)}}class MK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class TK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new ye(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Gn)),o.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class IK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class RK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const l=o.attenuationColor||[1,1,1];return t.attenuationColor=new ye(l[0],l[1],l[2]),Promise.all(r)}}class PK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class BK{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const l=o.specularColorFactor||[1,1,1];return t.specularColor=new ye(l[0],l[1],l[2]),o.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,Gn)),Promise.all(r)}}class LK{constructor(e){this.parser=e,this.name=Xn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class DK{constructor(e){this.parser=e,this.name=Xn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],l=i.images[o.source];let h=n.textureLoader;if(l.uri){const u=n.options.manager.getHandler(l.uri);u!==null&&(h=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,o.source,h);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class OK{constructor(e){this.name=Xn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(l){const h=i.byteOffset||0,u=i.byteLength||0,f=i.count,g=i.byteStride,m=new Uint8Array(l,h,u);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(f,g,m,i.mode,i.filter).then(function(A){return A.buffer}):o.ready.then(function(){const A=new ArrayBuffer(f*g);return o.decodeGltfBuffer(new Uint8Array(A),f,g,m,i.mode,i.filter),A})})}else return null}}const UO="glTF",wm=12,wB={JSON:1313821514,BIN:5130562};class FK{constructor(e){this.name=Xn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,wm);if(this.header={magic:Xa.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==UO)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-wm,i=new DataView(e,wm);let r=0;for(;r<n;){const o=i.getUint32(r,!0);r+=4;const l=i.getUint32(r,!0);if(r+=4,l===wB.JSON){const h=new Uint8Array(e,wm+r,o);this.content=Xa.decodeText(h)}else if(l===wB.BIN){const h=wm+r;this.body=e.slice(h,h+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class kK{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Xn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,l={},h={},u={};for(const f in o){const g=vE[f]||f.toLowerCase();l[g]=o[f]}for(const f in e.attributes){const g=vE[f]||f.toLowerCase();if(o[f]!==void 0){const m=n.accessors[e.attributes[f]],A=Ag[m.componentType];u[g]=A.name,h[g]=m.normalized===!0}}return t.getDependency("bufferView",r).then(function(f){return new Promise(function(g){i.decodeDracoFile(f,function(m){for(const A in m.attributes){const v=m.attributes[A],b=h[A];b!==void 0&&(v.normalized=b)}g(m)},l,u)})})}}class NK{constructor(){this.name=Xn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class _E extends Kf{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),l={specular:{value:new ye().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=l,this.onBeforeCompile=function(h){for(const u in l)h.uniforms[u]=l[u];h.fragmentShader=h.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return l.specular.value},set:function(h){l.specular.value=h}},specularMap:{get:function(){return l.specularMap.value},set:function(h){l.specularMap.value=h,h?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(h){l.glossiness.value=h}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(h){l.glossinessMap.value=h,h?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class UK{constructor(){this.name=Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return _E}extendParams(e,t,n){const i=t.extensions[this.name];e.color=new ye(1,1,1),e.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(i.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",i.diffuseTexture,Gn)),e.emissive=new ye(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new ye(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){const o=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",o)),r.push(n.assignTexture(e,"specularMap",o,Gn))}return Promise.all(r)}createMaterial(e){const t=new _E(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Yc,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class zK{constructor(){this.name=Xn.KHR_MESH_QUANTIZATION}}class zO extends Zf{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let o=0;o!==i;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=l*2,u=l*3,f=i-t,g=(n-t)/f,m=g*g,A=m*g,v=e*u,b=v-u,C=-2*A+3*m,S=A-m,I=1-C,M=S-m+g;for(let R=0;R!==l;R++){const T=o[b+R+l],B=o[b+R+h]*f,F=o[v+R+l],D=o[v+R]*f;r[R]=I*T+M*B+C*F+S*D}return r}}const GK=new kt;class HK extends zO{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return GK.fromArray(r).normalize().toArray(r),r}}const Rc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ag={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bB={9728:$i,9729:vi,9984:Ff,9985:Rg,9986:kf,9987:va},CB={33071:Os,33648:ku,10497:Qc},EB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vE={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Rl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},GO={CUBICSPLINE:void 0,LINEAR:jc,STEP:Uu},tC={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function VK(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Kf({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:zo})),a.DefaultMaterial}function bm(a,e,t){for(const n in t.extensions)a[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function fu(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function WK(a,e,t){let n=!1,i=!1,r=!1;for(let u=0,f=e.length;u<f;u++){const g=e[u];if(g.POSITION!==void 0&&(n=!0),g.NORMAL!==void 0&&(i=!0),g.COLOR_0!==void 0&&(r=!0),n&&i&&r)break}if(!n&&!i&&!r)return Promise.resolve(a);const o=[],l=[],h=[];for(let u=0,f=e.length;u<f;u++){const g=e[u];if(n){const m=g.POSITION!==void 0?t.getDependency("accessor",g.POSITION):a.attributes.position;o.push(m)}if(i){const m=g.NORMAL!==void 0?t.getDependency("accessor",g.NORMAL):a.attributes.normal;l.push(m)}if(r){const m=g.COLOR_0!==void 0?t.getDependency("accessor",g.COLOR_0):a.attributes.color;h.push(m)}}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(u){const f=u[0],g=u[1],m=u[2];return n&&(a.morphAttributes.position=f),i&&(a.morphAttributes.normal=g),r&&(a.morphAttributes.color=m),a.morphTargetsRelative=!0,a})}function QK(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)a.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function jK(a){const e=a.extensions&&a.extensions[Xn.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+SB(e.attributes):t=a.indices+":"+SB(a.attributes)+":"+a.mode,t}function SB(a){let e="";const t=Object.keys(a).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+a[t[n]]+";";return e}function xE(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function HO(a){let e=a.array;if(a.normalized){const t=xE(e.constructor),n=new Float32Array(e.length);for(let i=0,r=e.length;i<r;i++)n[i]=e[i]*t;e=n}return e}function wE(a){a.createInterpolant=function(t){const n=this instanceof tc?HK:zO;return new n(this.times,this.values,this.getValueSize()/3,t)},a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}function qK(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class XK{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new xK,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||n||i&&r<98?this.textureLoader=new Xg(this.options.manager):this.textureLoader=new vD(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ks(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const l={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:n,userData:{}};bm(r,l,i),fu(l,i),Promise.all(n._invokeAll(function(h){return h.afterRoot&&h.afterRoot(l)})).then(function(){e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const o=t[i].joints;for(let l=0,h=o.length;l<h;l++)e[o[l]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(o,l)=>{const h=this.associations.get(o);h!=null&&this.associations.set(l,h);for(const[u,f]of o.children.entries())r(f,l.children[u])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Xn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(r,o){n.load(Xa.resolveURL(t.uri,i.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);const r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(o){const l=o[0],h=EB[i.type],u=Ag[i.componentType],f=u.BYTES_PER_ELEMENT,g=f*h,m=i.byteOffset||0,A=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,v=i.normalized===!0;let b,C;if(A&&A!==g){const S=Math.floor(m/A),I="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+S+":"+i.count;let M=t.cache.get(I);M||(b=new u(l,S*A,i.count*A/f),M=new Og(b,A/f),t.cache.add(I,M)),C=new th(M,h,m%A/f,v)}else l===null?b=new u(i.count*h):b=new u(l,m,i.count*h),C=new Jn(b,h,v);if(i.sparse!==void 0){const S=EB.SCALAR,I=Ag[i.sparse.indices.componentType],M=i.sparse.indices.byteOffset||0,R=i.sparse.values.byteOffset||0,T=new I(o[1],M,i.sparse.count*S),B=new u(o[2],R,i.sparse.count*h);l!==null&&(C=new Jn(C.array.slice(),C.itemSize,C.normalized));for(let F=0,D=T.length;F<D;F++){const U=T[F];if(C.setX(U,B[F*h]),h>=2&&C.setY(U,B[F*h+1]),h>=3&&C.setZ(U,B[F*h+2]),h>=4&&C.setW(U,B[F*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return C})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let l=this.textureLoader;if(o.uri){const h=n.manager.getHandler(o.uri);h!==null&&(l=h)}return this.loadTextureImage(e,r,l)}loadTextureImage(e,t,n){const i=this,r=this.json,o=r.textures[e],l=r.images[t],h=(l.uri||l.bufferView)+":"+o.sampler;if(this.textureCache[h])return this.textureCache[h];const u=this.loadImageSource(t,n).then(function(f){f.flipY=!1,o.name&&(f.name=o.name);const m=(r.samplers||{})[o.sampler]||{};return f.magFilter=bB[m.magFilter]||vi,f.minFilter=bB[m.minFilter]||va,f.wrapS=CB[m.wrapS]||Qc,f.wrapT=CB[m.wrapT]||Qc,i.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[h]=u,u}loadImageSource(e,t){const n=this,i=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(g=>g.clone());const o=i.images[e],l=self.URL||self.webkitURL;let h=o.uri||"",u=!1;if(o.bufferView!==void 0)h=n.getDependency("bufferView",o.bufferView).then(function(g){u=!0;const m=new Blob([g],{type:o.mimeType});return h=l.createObjectURL(m),h});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(h).then(function(g){return new Promise(function(m,A){let v=m;t.isImageBitmapLoader===!0&&(v=function(b){const C=new Ii(b);C.needsUpdate=!0,m(C)}),t.load(Xa.resolveURL(g,r.path),v,void 0,A)})}).then(function(g){return u===!0&&l.revokeObjectURL(h),g.userData.mimeType=o.mimeType||qK(o.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",h),g});return this.sourceCache[e]=f,f}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then(function(o){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[Xn.KHR_TEXTURE_TRANSFORM]){const l=n.extensions!==void 0?n.extensions[Xn.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const h=r.associations.get(o);o=r.extensions[Xn.KHR_TEXTURE_TRANSFORM].extendTexture(o,l),r.associations.set(o,h)}}return i!==void 0&&(o.encoding=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+n.uuid;let h=this.cache.get(l);h||(h=new kg,vs.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(l,h)),n=h}else if(e.isLine){const l="LineBasicMaterial:"+n.uuid;let h=this.cache.get(l);h||(h=new Ts,vs.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(l,h)),n=h}if(i||r||o){let l="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),i&&(l+="derivative-tangents:"),r&&(l+="vertex-colors:"),o&&(l+="flat-shading:");let h=this.cache.get(l);h||(h=n.clone(),r&&(h.vertexColors=!0),o&&(h.flatShading=!0),i&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(l,h),this.associations.set(h,this.associations.get(n))),n=h}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Kf}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let o;const l={},h=r.extensions||{},u=[];if(h[Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const g=i[Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=g.getMaterialType(),u.push(g.extendParams(l,r,t))}else if(h[Xn.KHR_MATERIALS_UNLIT]){const g=i[Xn.KHR_MATERIALS_UNLIT];o=g.getMaterialType(),u.push(g.extendParams(l,r,t))}else{const g=r.pbrMetallicRoughness||{};if(l.color=new ye(1,1,1),l.opacity=1,Array.isArray(g.baseColorFactor)){const m=g.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}g.baseColorTexture!==void 0&&u.push(t.assignTexture(l,"map",g.baseColorTexture,Gn)),l.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,l.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(l,"metalnessMap",g.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",g.metallicRoughnessTexture))),o=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,l)})))}r.doubleSided===!0&&(l.side=ir);const f=r.alphaMode||tC.OPAQUE;if(f===tC.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,f===tC.MASK&&(l.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Hi&&(u.push(t.assignTexture(l,"normalMap",r.normalTexture)),l.normalScale=new Xe(1,1),r.normalTexture.scale!==void 0)){const g=r.normalTexture.scale;l.normalScale.set(g,g)}return r.occlusionTexture!==void 0&&o!==Hi&&(u.push(t.assignTexture(l,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Hi&&(l.emissive=new ye().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==Hi&&u.push(t.assignTexture(l,"emissiveMap",r.emissiveTexture,Gn)),Promise.all(u).then(function(){let g;return o===_E?g=i[Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):g=new o(l),r.name&&(g.name=r.name),fu(g,r),t.associations.set(g,{materials:e}),r.extensions&&bm(i,g,r),g})}createUniqueName(e){const t=ti.sanitizeNodeName(e||"");let n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(l){return n[Xn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(h){return MB(h,l,t)})}const o=[];for(let l=0,h=e.length;l<h;l++){const u=e[l],f=jK(u),g=i[f];if(g)o.push(g.promise);else{let m;u.extensions&&u.extensions[Xn.KHR_DRACO_MESH_COMPRESSION]?m=r(u):m=MB(new Sn,u,t),i[f]={primitive:u,promise:m},o.push(m)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],o=r.primitives,l=[];for(let h=0,u=o.length;h<u;h++){const f=o[h].material===void 0?VK(this.cache):this.getDependency("material",o[h].material);l.push(f)}return l.push(t.loadGeometries(o)),Promise.all(l).then(function(h){const u=h.slice(0,h.length-1),f=h[h.length-1],g=[];for(let A=0,v=f.length;A<v;A++){const b=f[A],C=o[A];let S;const I=u[A];if(C.mode===Rc.TRIANGLES||C.mode===Rc.TRIANGLE_STRIP||C.mode===Rc.TRIANGLE_FAN||C.mode===void 0)S=r.isSkinnedMesh===!0?new vS(b,I):new _t(b,I),S.isSkinnedMesh===!0&&!S.geometry.attributes.skinWeight.normalized&&S.normalizeSkinWeights(),C.mode===Rc.TRIANGLE_STRIP?S.geometry=TB(S.geometry,y2):C.mode===Rc.TRIANGLE_FAN&&(S.geometry=TB(S.geometry,oS));else if(C.mode===Rc.LINES)S=new Wo(b,I);else if(C.mode===Rc.LINE_STRIP)S=new Ss(b,I);else if(C.mode===Rc.LINE_LOOP)S=new wS(b,I);else if(C.mode===Rc.POINTS)S=new yv(b,I);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+C.mode);Object.keys(S.geometry.morphAttributes).length>0&&QK(S,r),S.name=t.createUniqueName(r.name||"mesh_"+e),fu(S,r),C.extensions&&bm(i,S,C),t.assignFinalMaterial(S),g.push(S)}for(let A=0,v=g.length;A<v;A++)t.associations.set(g[A],{meshes:e,primitives:A});if(g.length===1)return g[0];const m=new ua;t.associations.set(m,{meshes:e});for(let A=0,v=g.length;A<v;A++)m.add(g[A]);return m})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new ns(zu.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new lh(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),fu(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=[],o=[],l=[],h=[],u=[];for(let f=0,g=i.channels.length;f<g;f++){const m=i.channels[f],A=i.samplers[m.sampler],v=m.target,b=i.parameters!==void 0?i.parameters[A.input]:A.input,C=i.parameters!==void 0?i.parameters[A.output]:A.output,S=n._invokeOne(function(I){return I.loadAnimationTargetFromChannel&&I.loadAnimationTargetFromChannel(m)});r.push(S),o.push(this.getDependency("accessor",b)),l.push(this.getDependency("accessor",C)),h.push(A),u.push(v)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(u)]).then(function(f){const g=f[0],m=f[1],A=f[2],v=f[3],b=f[4],C=[];for(let I=0,M=g.length;I<M;I++){const R=g[I],T=m[I],B=A[I],F=v[I],D=b[I];if(R===void 0)continue;R.updateMatrix&&(R.updateMatrix(),R.matrixAutoUpdate=!0);const U=n._invokeOne(function(W){return W.createAnimationTracks&&W.createAnimationTracks(R,T,B,F,D)});if(U)for(let W=0;W<U.length;W++)C.push(U[W])}const S=i.name?i.name:"animation_"+e;return new rh(S,void 0,C)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(r){const o=n._getNodeRef(n.meshCache,i.mesh,r);return i.weights!==void 0&&o.traverse(function(l){if(!!l.isMesh)for(let h=0,u=i.weights.length;h<u;h++)l.morphTargetInfluences[h]=i.weights[h]}),o})}loadNode(e){const t=this.json,n=this.extensions,i=this,r=t.nodes[e],o=r.name?i.createUniqueName(r.name):"";return function(){const l=[],h=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return h&&l.push(h),r.camera!==void 0&&l.push(i.getDependency("camera",r.camera).then(function(u){return i._getNodeRef(i.cameraCache,r.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){l.push(u)}),Promise.all(l)}().then(function(l){let h;if(r.isBone===!0?h=new Av:l.length>1?h=new ua:l.length===1?h=l[0]:h=new Ft,h!==l[0])for(let u=0,f=l.length;u<f;u++)h.add(l[u]);if(r.name&&(h.userData.name=r.name,h.name=o),fu(h,r),r.extensions&&bm(n,h,r),r.matrix!==void 0){const u=new fn;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return i.associations.has(h)||i.associations.set(h,{}),i.associations.get(h).nodes=e,h})}loadScene(e){const t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,o=new ua;i.name&&(o.name=r.createUniqueName(i.name)),fu(o,i),i.extensions&&bm(n,o,i);const l=i.nodes||[],h=[];for(let u=0,f=l.length;u<f;u++)h.push(VO(l[u],o,t,r));return Promise.all(h).then(function(){const u=f=>{const g=new Map;for(const[m,A]of r.associations)(m instanceof vs||m instanceof Ii)&&g.set(m,A);return f.traverse(m=>{const A=r.associations.get(m);A!=null&&g.set(m,A)}),g};return r.associations=u(o),o})}loadAnimationTargetFromChannel(e){const t=e.target,n=t.node!==void 0?t.node:t.id;return this.getDependency("node",n)}createAnimationTracks(e,t,n,i,r){const o=[],l=e.name?e.name:e.uuid,h=[];Rl[r.path]===Rl.weights?e.traverse(function(m){m.morphTargetInfluences&&h.push(m.name?m.name:m.uuid)}):h.push(l);let u;switch(Rl[r.path]){case Rl.weights:u=ih;break;case Rl.rotation:u=tc;break;case Rl.position:case Rl.scale:default:switch(n.itemSize){case 1:u=ih;break;case 2:case 3:u=sh;break;case 4:u=qg;break}break}const f=i.interpolation!==void 0?GO[i.interpolation]:jc,g=HO(n);for(let m=0,A=h.length;m<A;m++){const v=new u(h[m]+"."+Rl[r.path],t.array,g,f);f==="CUBICSPLINE"&&wE(v),o.push(v)}return o}}function VO(a,e,t,n){const i=t.nodes[a];return n.getDependency("node",a).then(function(r){if(i.skin===void 0)return r;let o;return n.getDependency("skin",i.skin).then(function(l){o=l;const h=[];for(let u=0,f=o.joints.length;u<f;u++)h.push(n.getDependency("node",o.joints[u]));return Promise.all(h)}).then(function(l){return r.traverse(function(h){if(!h.isMesh)return;const u=[],f=[];for(let g=0,m=l.length;g<m;g++){const A=l[g];if(A){u.push(A);const v=new fn;o.inverseBindMatrices!==void 0&&v.fromArray(o.inverseBindMatrices.array,g*16),f.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[g])}h.bind(new Fg(u,f),h.matrixWorld)}),r})}).then(function(r){e.add(r);const o=[];if(i.children){const l=i.children;for(let h=0,u=l.length;h<u;h++){const f=l[h];o.push(VO(f,r,t,n))}}return Promise.all(o)})}function YK(a,e,t){const n=e.attributes,i=new Rr;if(n.POSITION!==void 0){const l=t.json.accessors[n.POSITION],h=l.min,u=l.max;if(h!==void 0&&u!==void 0){if(i.set(new q(h[0],h[1],h[2]),new q(u[0],u[1],u[2])),l.normalized){const f=xE(Ag[l.componentType]);i.min.multiplyScalar(f),i.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const l=new q,h=new q;for(let u=0,f=r.length;u<f;u++){const g=r[u];if(g.POSITION!==void 0){const m=t.json.accessors[g.POSITION],A=m.min,v=m.max;if(A!==void 0&&v!==void 0){if(h.setX(Math.max(Math.abs(A[0]),Math.abs(v[0]))),h.setY(Math.max(Math.abs(A[1]),Math.abs(v[1]))),h.setZ(Math.max(Math.abs(A[2]),Math.abs(v[2]))),m.normalized){const b=xE(Ag[m.componentType]);h.multiplyScalar(b)}l.max(h)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}a.boundingBox=i;const o=new ec;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,a.boundingSphere=o}function MB(a,e,t){const n=e.attributes,i=[];function r(o,l){return t.getDependency("accessor",o).then(function(h){a.setAttribute(l,h)})}for(const o in n){const l=vE[o]||o.toLowerCase();l in a.attributes||i.push(r(n[o],l))}if(e.indices!==void 0&&!a.index){const o=t.getDependency("accessor",e.indices).then(function(l){a.setIndex(l)});i.push(o)}return fu(a,e),YK(a,e,t),Promise.all(i).then(function(){return e.targets!==void 0?WK(a,e.targets,t):a})}function TB(a,e){let t=a.getIndex();if(t===null){const o=[],l=a.getAttribute("position");if(l!==void 0){for(let h=0;h<l.count;h++)o.push(h);a.setIndex(o),t=a.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const n=t.count-2,i=[];if(e===oS)for(let o=1;o<=n;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=a.clone();return r.setIndex(i),r}var JK=Object.defineProperty,KK=Object.getOwnPropertyDescriptor,WO=(a,e,t,n)=>{for(var i=n>1?void 0:n?KK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&JK(e,t,i),i};class jv extends pt{constructor(){super(...arguments);x(this,"from");x(this,"to");x(this,"width",0);x(this,"centered",!0);x(this,"_centerPos")}awake(){this._centerPos=new q}update(){if(!this.from||!this.to)return;const t=ni(this.from).clone(),n=ni(this.to).clone(),i=t.distanceTo(n);this._centerPos.copy(t),this._centerPos.add(n),this._centerPos.multiplyScalar(.5),sr(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt(ni(this.to).clone()),this.gameObject.scale.set(this.width,this.width,i)}}WO([we(Ee)],jv.prototype,"from",2);WO([we(Ee)],jv.prototype,"to",2);var ZK=Object.defineProperty,$K=Object.getOwnPropertyDescriptor,mh=(a,e,t,n)=>{for(var i=n>1?void 0:n?$K(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ZK(e,t,i),i};class gh{constructor(){x(this,"time");x(this,"value");x(this,"inTangent");x(this,"inWeight");x(this,"outTangent");x(this,"outWeight");x(this,"weightedMode")}}mh([we()],gh.prototype,"time",2);mh([we()],gh.prototype,"value",2);mh([we()],gh.prototype,"inTangent",2);mh([we()],gh.prototype,"inWeight",2);mh([we()],gh.prototype,"outTangent",2);mh([we()],gh.prototype,"outWeight",2);mh([we()],gh.prototype,"weightedMode",2);class hM{constructor(){x(this,"keys")}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(e){if(!this.keys||this.keys.length==0)return 0;let t=null;for(const n of this.keys){if(t&&n.time>e&&e>t.time)return Ci.lerp(t.value,n.value,(e-t.time)/(n.time-t.time));t=n}return this.keys[this.keys.length-1].value}}mh([we(gh)],hM.prototype,"keys",2);class eZ extends Ss{constructor(e,t=1,n=16,i=2){const r=new Sn,o=n+i*2,l=new Float32Array((o*3+3)*3);r.setAttribute("position",new Jn(l,3));const h=new Ts({color:65280}),u=new Ts({color:16776960});super(r,[u,h]),this.audio=e,this.range=t,this.divisionsInnerAngle=n,this.divisionsOuterAngle=i,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,n=this.divisionsInnerAngle,i=this.divisionsOuterAngle,r=zu.degToRad(e.panner.coneInnerAngle),o=zu.degToRad(e.panner.coneOuterAngle),l=r/2,h=o/2;let u=0,f=0,g,m;const A=this.geometry,v=A.attributes.position;A.clearGroups();function b(C,S,I,M){const R=(S-C)/I;for(v.setXYZ(u,0,0,0),f++,g=C;g<S;g+=R)m=u+f,v.setXYZ(m,Math.sin(g)*t,0,Math.cos(g)*t),v.setXYZ(m+1,Math.sin(Math.min(g+R,S))*t,0,Math.cos(Math.min(g+R,S))*t),v.setXYZ(m+2,0,0,0),f+=3;A.addGroup(u,f,M),u+=f,f=0}b(-h,-l,i,0),b(-l,l,n,1),b(l,h,i,0),v.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var bE=(a=>(a.Visible="application-visible",a.Hidden="application-hidden",a))(bE||{});class tZ extends EventTarget{constructor(t){super();x(this,"context");x(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event("application-hidden"));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event("application-visible"));break}}}var nZ=Object.defineProperty,iZ=Object.getOwnPropertyDescriptor,Ah=(a,e,t,n)=>{for(var i=n>1?void 0:n?iZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&nZ(e,t,i),i};const zr=Ct("debugaudio");var Bm;const $s=(Bm=class extends pt{constructor(){super(...arguments);x(this,"clip","");x(this,"playOnAwake",!1);x(this,"_spatialBlend",0);x(this,"_minDistance",1);x(this,"_maxDistance",100);x(this,"_volume",1);x(this,"rollOffMode",0);x(this,"_loop",!1);x(this,"sound",null);x(this,"helper",null);x(this,"wasPlaying",!1);x(this,"audioLoader",null);x(this,"shouldPlay",!1);x(this,"_lastClipStartedLoading",null);x(this,"_focusCallback");x(this,"lerp",(e,t,n)=>e*(1-n)+t*n);x(this,"_lastContextTime",0);x(this,"_hasEnded",!0);x(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return $s._didCallBeginWaitForUserInteraction||($s._didCallBeginWaitForUserInteraction=!0,$s._beginWaitForUserInteraction()),$s._userInteractionRegistered}static registerWaitForAllowAudio(e){if(e!==null){if(this._userInteractionRegistered){e();return}this.callbacks.indexOf(e)===-1&&this.callbacks.push(e),$s._didCallBeginWaitForUserInteraction||($s._didCallBeginWaitForUserInteraction=!0,$s._beginWaitForUserInteraction())}}static _beginWaitForUserInteraction(e=null){if(this._userInteractionRegistered){e&&e();return}e!==null&&this.registerWaitForAllowAudio(e);let n=(()=>{if(n!=null&&!$s._userInteractionRegistered){$s._userInteractionRegistered=!0,console.log("registered interaction, can play audio now"),document.removeEventListener("pointerdown",n),document.removeEventListener("click",n),document.removeEventListener("dragstart",n),document.removeEventListener("touchstart",n);for(const i of this.callbacks)i();this.callbacks.length=0}}).bind(this);document.addEventListener("pointerdown",n),document.addEventListener("click",n),document.addEventListener("dragstart",n),document.addEventListener("touchstart",n)}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(e){this._loop=e,this.sound&&this.sound.setLoop(e)}get spatialBlend(){return this._spatialBlend}set spatialBlend(e){e!==this._spatialBlend&&(this._spatialBlend=e,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance!==e&&(this._minDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(e){this._maxDistance!==e&&(this._maxDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(e){this._volume=e,this.sound&&(zr&&console.log(this.name,"audio set volume",e),this.sound.setVolume(e))}get Sound(){var e;if(!this.sound&&$s._userInteractionRegistered){const t=(e=Ee.getComponent(this.context.mainCamera,yg))!=null?e:Ee.findObjectOfType(yg,this.context);t!=null&&t.listener&&(this.sound=new xD(t.listener),this.gameObject.add(this.sound))}return this.sound}get ShouldPlay(){return this.shouldPlay}awake(){this.audioLoader=new I_,this.playOnAwake&&(this.shouldPlay=!0),window.addEventListener("visibilitychange",e=>{switch(document.visibilityState){case"hidden":this.wasPlaying=this.isPlaying,this.pause();break;case"visible":this.wasPlaying&&this.play();break}}),this._focusCallback=()=>{this.enabled&&this.playOnAwake&&!this.isPlaying&&$s._userInteractionRegistered&&this.play()},this.context.application.addEventListener(bE.Visible,this._focusCallback)}onDestroy(){this.context.application.removeEventListener(bE.Visible,this._focusCallback)}onEnable(){$s._userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():$s._beginWaitForUserInteraction(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.loadAndPlay(this.clip)})}onDisable(){this.stop()}onLoaded(e){zr&&console.log("audio buffer loaded"),$s.registerWaitForAllowAudio(()=>{zr&&console.log("finished loading",e);const t=this.Sound;if(!t){console.warn("Failed getting sound",this.name);return}t.isPlaying&&t.stop(),t.setBuffer(e),t.loop=this.loop,t.setVolume(this.volume),t.autoplay=this.shouldPlay,this.applySpatialDistanceSettings(),t.isPlaying&&t.stop(),zr&&console.log(this.name,this.shouldPlay,$s.userInteractionRegistered,this),this.shouldPlay&&$s._userInteractionRegistered&&this.play()})}applySpatialDistanceSettings(){const e=this.sound;if(!e)return;this._needUpdateSpatialDistanceSettings=!1;const t=this.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(zr&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+t),e.setRefDistance(t),e.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case 0:e.setDistanceModel("exponential");break;case 1:e.setDistanceModel("linear");break}this.spatialBlend>0?zr&&!this.helper&&(this.helper=new eZ(e,e.getRefDistance()),e.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}loadAndPlay(e){if(e&&(this.clip=e),this.clip&&(zr&&console.log(this.clip),this.clip.endsWith(".mp3")||this.clip.endsWith(".wav"))){if(this.audioLoader||(this.audioLoader=new I_),this.shouldPlay=!0,this._lastClipStartedLoading===this.clip){zr&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=this.clip,zr&&console.log("load audio",this.clip),this.audioLoader.load(this.clip,this.onLoaded.bind(this),()=>{},console.error)}}play(e=void 0){var t;if(!this.audioLoader||!this.sound||e&&e!==this.clip){this.loadAndPlay(e);return}this.shouldPlay=!0,this._hasEnded=!1,zr&&console.log("play",(t=this.sound)==null?void 0:t.getVolume(),this.sound),this.sound&&!this.sound.isPlaying&&this.sound.play()}pause(){var e;zr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,this.sound.pause())}stop(){var e;zr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,zr&&console.log(this._lastContextTime),this.sound.stop())}get isPlaying(){var e,t;return(t=(e=this.sound)==null?void 0:e.isPlaying)!=null?t:!1}set isPlaying(e){}get time(){var e,t;return(e=this.sound)!=null&&e.source?((t=this.sound.source)==null?void 0:t.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(e){if(this.sound){if(e===this.sound.offset)return;const t=this.isPlaying;this.stop(),this.sound.offset=e,t&&this.play()}}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,zr&&console.log("Audio clip ended",this.clip),this.sound.dispatchEvent({type:"ended",target:this}))}},x(Bm,"_didCallBeginWaitForUserInteraction",!1),x(Bm,"callbacks",[]),x(Bm,"_userInteractionRegistered",!1),Bm);let Br=$s;Ah([we()],Br.prototype,"clip",2);Ah([we()],Br.prototype,"playOnAwake",2);Ah([we()],Br.prototype,"loop",1);Ah([we()],Br.prototype,"spatialBlend",1);Ah([we()],Br.prototype,"minDistance",1);Ah([we()],Br.prototype,"maxDistance",1);Ah([we()],Br.prototype,"volume",1);Ah([we()],Br.prototype,"rollOffMode",2);class yg extends pt{constructor(){super(...arguments);x(this,"_listener",null)}get listener(){return this._listener==null&&(this._listener=new HS),this._listener}awake(){Br.registerWaitForAllowAudio(()=>{const t=this.listener;if(t==null||t.parent)return;const n=Ee.getComponentInParent(this.gameObject,qs);n?n.cam.add(t):this.gameObject.add(t)})}}const nC=new WeakMap;class uM extends _r{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new ks(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.decodeDracoFile(o,t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){const n=JSON.stringify(t);if(nC.has(e)){const h=nC.get(e);if(h.key===n)return h.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,o=e.byteLength,l=this._getWorker(r,o).then(h=>(i=h,new Promise((u,f)=>{i._callbacks[r]={resolve:u,reject:f},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(h=>this._createGeometry(h.geometry));return l.catch(()=>!0).then(()=>{i&&r&&this._releaseTask(i,r)}),nC.set(e,{key:n,promise:l}),l}_createGeometry(e){const t=new Sn;e.index&&t.setIndex(new Jn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],r=i.name,o=i.array,l=i.itemSize;t.setAttribute(r,new Jn(o,l))}return t}_loadLibrary(e,t){const n=new ks(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,r)=>{n.load(e,i,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=sZ.toString(),o=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(r){const o=r.data;switch(o.type){case"decode":i._callbacks[o.id].resolve(o);break;case"error":i._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,r){return i._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function sZ(){let a,e;onmessage=function(o){const l=o.data;switch(l.type){case"init":a=l.decoderConfig,e=new Promise(function(f){a.onModuleLoaded=function(g){f({draco:g})},DracoDecoderModule(a)});break;case"decode":const h=l.buffer,u=l.taskConfig;e.then(f=>{const g=f.draco,m=new g.Decoder,A=new g.DecoderBuffer;A.Init(new Int8Array(h),h.byteLength);try{const v=t(g,m,A,u),b=v.attributes.map(C=>C.array.buffer);v.index&&b.push(v.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:v},b)}catch(v){console.error(v),self.postMessage({type:"error",id:l.id,error:v.message})}finally{g.destroy(A),g.destroy(m)}});break}};function t(o,l,h,u){const f=u.attributeIDs,g=u.attributeTypes;let m,A;const v=l.GetEncodedGeometryType(h);if(v===o.TRIANGULAR_MESH)m=new o.Mesh,A=l.DecodeBufferToMesh(h,m);else if(v===o.POINT_CLOUD)m=new o.PointCloud,A=l.DecodeBufferToPointCloud(h,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!A.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());const b={index:null,attributes:[]};for(const C in f){const S=self[g[C]];let I,M;if(u.useUniqueIDs)M=f[C],I=l.GetAttributeByUniqueId(m,M);else{if(M=l.GetAttributeId(m,o[f[C]]),M===-1)continue;I=l.GetAttribute(m,M)}b.attributes.push(i(o,l,m,C,S,I))}return v===o.TRIANGULAR_MESH&&(b.index=n(o,l,m)),o.destroy(m),b}function n(o,l,h){const f=h.num_faces()*3,g=f*4,m=o._malloc(g);l.GetTrianglesUInt32Array(h,g,m);const A=new Uint32Array(o.HEAPF32.buffer,m,f).slice();return o._free(m),{array:A,itemSize:1}}function i(o,l,h,u,f,g){const m=g.num_components(),v=h.num_points()*m,b=v*f.BYTES_PER_ELEMENT,C=r(o,f),S=o._malloc(b);l.GetAttributeDataArrayForAllPoints(h,g,C,b,S);const I=new f(o.HEAPF32.buffer,S,v).slice();return o._free(S),{name:u,array:I,itemSize:m}}function r(o,l){switch(l){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class rZ{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:i,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const oZ=0,aZ=2,cZ=1,lZ=2,hZ=0,QO=9,dM=15,jO=16,fM=22,qO=37,pM=43,XO=76,YO=83,JO=97,KO=100,ZO=103,$O=109;class uZ{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Cm{constructor(e,t,n,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const Sr=[171,75,84,88,32,50,48,187,13,10,26,10];function IB(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}function dZ(a){const e=new Uint8Array(a.buffer,a.byteOffset,Sr.length);if(e[0]!==Sr[0]||e[1]!==Sr[1]||e[2]!==Sr[2]||e[3]!==Sr[3]||e[4]!==Sr[4]||e[5]!==Sr[5]||e[6]!==Sr[6]||e[7]!==Sr[7]||e[8]!==Sr[8]||e[9]!==Sr[9]||e[10]!==Sr[10]||e[11]!==Sr[11])throw new Error("Missing KTX 2.0 identifier.");const t=new uZ,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new Cm(a,Sr.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const r=i._nextUint32();t.supercompressionScheme=i._nextUint32();const o=i._nextUint32(),l=i._nextUint32(),h=i._nextUint32(),u=i._nextUint32(),f=i._nextUint64(),g=i._nextUint64(),m=new Cm(a,Sr.length+n,3*r*8,!0);for(let ve=0;ve<r;ve++)t.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+m._nextUint64(),m._nextUint64()),uncompressedByteLength:m._nextUint64()});const A=new Cm(a,o,l,!0),v={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},b=(v.descriptorBlockSize/4-6)/4;for(let ve=0;ve<b;ve++){const xe={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&xe.channelType?(xe.sampleLower=A._nextInt32(),xe.sampleUpper=A._nextInt32()):(xe.sampleLower=A._nextUint32(),xe.sampleUpper=A._nextUint32()),v.samples[ve]=xe}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(v);const C=new Cm(a,h,u,!0);for(;C._offset<u;){const ve=C._nextUint32(),xe=C._scan(ve),Ae=IB(xe),Ie=C._scan(ve-xe.byteLength);t.keyValue[Ae]=Ae.match(/^ktx/i)?IB(Ie):Ie,C._offset%4&&C._skip(4-C._offset%4)}if(g<=0)return t;const S=new Cm(a,f,g,!0),I=S._nextUint16(),M=S._nextUint16(),R=S._nextUint32(),T=S._nextUint32(),B=S._nextUint32(),F=S._nextUint32(),D=[];for(let ve=0;ve<r;ve++)D.push({imageFlags:S._nextUint32(),rgbSliceByteOffset:S._nextUint32(),rgbSliceByteLength:S._nextUint32(),alphaSliceByteOffset:S._nextUint32(),alphaSliceByteLength:S._nextUint32()});const U=f+S._offset,W=U+R,J=W+T,ee=J+B,Q=new Uint8Array(a.buffer,a.byteOffset+U,R),Y=new Uint8Array(a.buffer,a.byteOffset+W,T),se=new Uint8Array(a.buffer,a.byteOffset+J,B),ae=new Uint8Array(a.buffer,a.byteOffset+ee,F);return t.globalData={endpointCount:I,selectorCount:M,imageDescs:D,endpointsData:Q,selectorsData:Y,tablesData:se,extendedData:ae},t}let iC,Pc,CE;const sC={env:{emscripten_notify_memory_growth:function(a){CE=new Uint8Array(Pc.exports.memory.buffer)}}};class fZ{init(){return iC||(iC=typeof fetch<"u"?fetch("data:application/wasm;base64,"+RB).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,sC)).then(this._init):WebAssembly.instantiate(Buffer.from(RB,"base64"),sC).then(this._init),iC)}_init(e){Pc=e.instance,sC.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Pc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=Pc.exports.malloc(n);CE.set(e,i),t=t||Number(Pc.exports.ZSTD_findDecompressedSize(i,n));const r=Pc.exports.malloc(t),o=Pc.exports.ZSTD_decompress(r,t,i,n),l=CE.slice(r,r+o);return Pc.exports.free(i),Pc.exports.free(r),l}}const RB="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",rC=new WeakMap;let oC=0,aC;class da extends _r{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new rZ,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new ks(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new ks(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([r,o])=>{const l=da.BasisWorker.toString(),h=["/* constants */","let _EngineFormat = "+JSON.stringify(da.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(da.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(da.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([h])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),f=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:f},[f]),u})}),oC>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),oC++}return this.transcoderPending}load(e,t,n,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new ks(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{if(rC.has(o))return rC.get(o).promise.then(t).catch(i);this._createTexture(o).then(l=>t?t(l):null).catch(i)},n,i)}_createTextureFrom(e){const{mipmaps:t,width:n,height:i,format:r,type:o,error:l,dfdTransferFn:h,dfdFlags:u}=e;if(o==="error")return Promise.reject(l);const f=new Nl(t,n,i,r,Tr);return f.minFilter=t.length===1?vi:va,f.magFilter=vi,f.generateMipmaps=!1,f.needsUpdate=!0,f.encoding=h===lZ?Gn:Ar,f.premultiplyAlpha=!!(u&cZ),f}_createTexture(e,t={}){const n=dZ(new Uint8Array(e));if(n.vkFormat!==hZ)return mZ(n);const i=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e])).then(o=>this._createTextureFrom(o.data));return rC.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),oC--,this}}da.BasisFormat={ETC1S:0,UASTC_4x4:1};da.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};da.EngineFormat={RGBAFormat:ds,RGBA_ASTC_4x4_Format:E_,RGBA_BPTC_Format:S_,RGBA_ETC2_EAC_Format:C_,RGBA_PVRTC_4BPPV1_Format:w_,RGBA_S3TC_DXT5_Format:zm,RGB_ETC1_Format:iS,RGB_ETC2_Format:b_,RGB_PVRTC_4BPPV1_Format:x_,RGB_S3TC_DXT1_Format:Um};da.BasisWorker=function(){let a,e,t;const n=_EngineFormat,i=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(A){const v=A.data;switch(v.type){case"init":a=v.config,o(v.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:b,height:C,hasAlpha:S,mipmaps:I,format:M,dfdTransferFn:R,dfdFlags:T}=l(v.buffer),B=[];for(let F=0;F<I.length;++F)B.push(I[F].data.buffer);self.postMessage({type:"transcode",id:v.id,width:b,height:C,hasAlpha:S,mipmaps:I,format:M,dfdTransferFn:R,dfdFlags:T},B)}catch(b){console.error(b),self.postMessage({type:"error",id:v.id,error:b.message})}});break}});function o(A){e=new Promise(v=>{t={wasmBinary:A,onRuntimeInitialized:v},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(A){const v=new t.KTX2File(new Uint8Array(A));function b(){v.close(),v.delete()}if(!v.isValid())throw b(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const C=v.isUASTC()?r.UASTC_4x4:r.ETC1S,S=v.getWidth(),I=v.getHeight(),M=v.getLevels(),R=v.getHasAlpha(),T=v.getDFDTransferFunc(),B=v.getDFDFlags(),{transcoderFormat:F,engineFormat:D}=g(C,S,I,R);if(!S||!I||!M)throw b(),new Error("THREE.KTX2Loader:	Invalid texture");if(!v.startTranscoding())throw b(),new Error("THREE.KTX2Loader: .startTranscoding failed");const U=[];for(let W=0;W<M;W++){const J=v.getImageLevelInfo(W,0,0),ee=J.origWidth,Q=J.origHeight,Y=new Uint8Array(v.getImageTranscodedSizeInBytes(W,0,0,F));if(!v.transcodeImage(Y,W,0,0,F,0,-1,-1))throw b(),new Error("THREE.KTX2Loader: .transcodeImage failed.");U.push({data:Y,width:ee,height:Q})}return b(),{width:S,height:I,hasAlpha:R,mipmaps:U,format:D,dfdTransferFn:T,dfdFlags:B}}const h=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=h.sort(function(A,v){return A.priorityETC1S-v.priorityETC1S}),f=h.sort(function(A,v){return A.priorityUASTC-v.priorityUASTC});function g(A,v,b,C){let S,I;const M=A===r.ETC1S?u:f;for(let R=0;R<M.length;R++){const T=M[R];if(!!a[T.if]&&!!T.basisFormat.includes(A)&&!(C&&T.transcoderFormat.length<2)&&!(T.needsPowerOfTwo&&!(m(v)&&m(b))))return S=T.transcoderFormat[C?1:0],I=T.engineFormat[C?1:0],{transcoderFormat:S,engineFormat:I}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),S=i.RGBA32,I=n.RGBAFormat,{transcoderFormat:S,engineFormat:I}}function m(A){return A<=2?!0:(A&A-1)===0&&A!==0}};const PB={[$O]:ds,[JO]:ds,[qO]:ds,[pM]:ds,[ZO]:gf,[YO]:gf,[jO]:gf,[fM]:gf,[KO]:vu,[XO]:vu,[dM]:vu,[QO]:vu},cC={[$O]:Ms,[JO]:Fs,[qO]:Tr,[pM]:Tr,[ZO]:Ms,[YO]:Fs,[jO]:Tr,[fM]:Tr,[KO]:Ms,[XO]:Fs,[dM]:Tr,[QO]:Tr},pZ={[pM]:Gn,[fM]:Gn,[dM]:Gn};async function mZ(a){const{vkFormat:e,pixelWidth:t,pixelHeight:n,pixelDepth:i}=a;if(PB[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const r=a.levels[0];let o,l;if(a.supercompressionScheme===oZ)o=r.levelData;else if(a.supercompressionScheme===aZ)aC||(aC=new Promise(async u=>{const f=new fZ;await f.init(),u(f)})),o=(await aC).decode(r.levelData,r.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");cC[e]===Ms?l=new Float32Array(o.buffer,o.byteOffset,o.byteLength/Float32Array.BYTES_PER_ELEMENT):cC[e]===Fs?l=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/Uint16Array.BYTES_PER_ELEMENT):l=o;const h=i===0?new ja(l,t,n):new Bg(l,t,n,i);return h.type=cC[e],h.format=PB[e],h.encoding=pZ[e]||Ar,h.needsUpdate=!0,Promise.resolve(h)}const _g=Ct("debugdecoders");let ha,zl;function BB(a){a!==void 0&&typeof a=="string"&&(ha||(ha=new uM),_g&&console.log("Setting draco decoder path to",a),ha.setDecoderPath(a))}function LB(a){a!==void 0&&typeof a=="string"&&(ha||(ha=new uM),_g&&console.log("Setting draco decoder type to",a),ha.setDecoderConfig({type:a}))}function DB(a){a!==void 0&&typeof a=="string"&&(zl||(zl=new da),_g&&console.log("Setting ktx2 transcoder path to",a),zl.setTranscoderPath(a))}function qv(a,e){ha||(ha=new uM,ha.setDecoderPath("./include/draco/"),ha.setDecoderConfig({type:"js"}),_g&&console.log("Setting draco decoder path to","./include/draco/")),zl||(zl=new da,zl.setTranscoderPath("./include/ktx2/"),_g&&console.log("Setting ktx2 transcoder path to","./include/ktx2/"),e.renderer&&zl.detectSupport(e.renderer)),a.setDRACOLoader(ha),a.setKTX2Loader(zl)}var eF={exports:{}},tF={exports:{}};(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,n){return t<<n|t>>>32-n},rotr:function(t,n){return t<<32-n|t>>>n},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var n=0;n<t.length;n++)t[n]=e.endian(t[n]);return t},randomBytes:function(t){for(var n=[];t>0;t--)n.push(Math.floor(Math.random()*256));return n},bytesToWords:function(t){for(var n=[],i=0,r=0;i<t.length;i++,r+=8)n[r>>>5]|=t[i]<<24-r%32;return n},wordsToBytes:function(t){for(var n=[],i=0;i<t.length*32;i+=8)n.push(t[i>>>5]>>>24-i%32&255);return n},bytesToHex:function(t){for(var n=[],i=0;i<t.length;i++)n.push((t[i]>>>4).toString(16)),n.push((t[i]&15).toString(16));return n.join("")},hexToBytes:function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(parseInt(t.substr(i,2),16));return n},bytesToBase64:function(t){for(var n=[],i=0;i<t.length;i+=3)for(var r=t[i]<<16|t[i+1]<<8|t[i+2],o=0;o<4;o++)i*8+o*6<=t.length*8?n.push(a.charAt(r>>>6*(3-o)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],i=0,r=0;i<t.length;r=++i%4)r!=0&&n.push((a.indexOf(t.charAt(i-1))&Math.pow(2,-2*r+8)-1)<<r*2|a.indexOf(t.charAt(i))>>>6-r*2);return n}};tF.exports=e})();var EE={utf8:{stringToBytes:function(a){return EE.bin.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(EE.bin.bytesToString(a)))}},bin:{stringToBytes:function(a){for(var e=[],t=0;t<a.length;t++)e.push(a.charCodeAt(t)&255);return e},bytesToString:function(a){for(var e=[],t=0;t<a.length;t++)e.push(String.fromCharCode(a[t]));return e.join("")}}},OB=EE;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var gZ=function(a){return a!=null&&(nF(a)||AZ(a)||!!a._isBuffer)};function nF(a){return!!a.constructor&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function AZ(a){return typeof a.readFloatLE=="function"&&typeof a.slice=="function"&&nF(a.slice(0,0))}(function(){var a=tF.exports,e=OB.utf8,t=gZ,n=OB.bin,i=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=n.stringToBytes(r):r=e.stringToBytes(r):t(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var l=a.bytesToWords(r),h=r.length*8,u=1732584193,f=-271733879,g=-1732584194,m=271733878,A=0;A<l.length;A++)l[A]=(l[A]<<8|l[A]>>>24)&16711935|(l[A]<<24|l[A]>>>8)&4278255360;l[h>>>5]|=128<<h%32,l[(h+64>>>9<<4)+14]=h;for(var v=i._ff,b=i._gg,C=i._hh,S=i._ii,A=0;A<l.length;A+=16){var I=u,M=f,R=g,T=m;u=v(u,f,g,m,l[A+0],7,-680876936),m=v(m,u,f,g,l[A+1],12,-389564586),g=v(g,m,u,f,l[A+2],17,606105819),f=v(f,g,m,u,l[A+3],22,-1044525330),u=v(u,f,g,m,l[A+4],7,-176418897),m=v(m,u,f,g,l[A+5],12,1200080426),g=v(g,m,u,f,l[A+6],17,-1473231341),f=v(f,g,m,u,l[A+7],22,-45705983),u=v(u,f,g,m,l[A+8],7,1770035416),m=v(m,u,f,g,l[A+9],12,-1958414417),g=v(g,m,u,f,l[A+10],17,-42063),f=v(f,g,m,u,l[A+11],22,-1990404162),u=v(u,f,g,m,l[A+12],7,1804603682),m=v(m,u,f,g,l[A+13],12,-40341101),g=v(g,m,u,f,l[A+14],17,-1502002290),f=v(f,g,m,u,l[A+15],22,1236535329),u=b(u,f,g,m,l[A+1],5,-165796510),m=b(m,u,f,g,l[A+6],9,-1069501632),g=b(g,m,u,f,l[A+11],14,643717713),f=b(f,g,m,u,l[A+0],20,-373897302),u=b(u,f,g,m,l[A+5],5,-701558691),m=b(m,u,f,g,l[A+10],9,38016083),g=b(g,m,u,f,l[A+15],14,-660478335),f=b(f,g,m,u,l[A+4],20,-405537848),u=b(u,f,g,m,l[A+9],5,568446438),m=b(m,u,f,g,l[A+14],9,-1019803690),g=b(g,m,u,f,l[A+3],14,-187363961),f=b(f,g,m,u,l[A+8],20,1163531501),u=b(u,f,g,m,l[A+13],5,-1444681467),m=b(m,u,f,g,l[A+2],9,-51403784),g=b(g,m,u,f,l[A+7],14,1735328473),f=b(f,g,m,u,l[A+12],20,-1926607734),u=C(u,f,g,m,l[A+5],4,-378558),m=C(m,u,f,g,l[A+8],11,-2022574463),g=C(g,m,u,f,l[A+11],16,1839030562),f=C(f,g,m,u,l[A+14],23,-35309556),u=C(u,f,g,m,l[A+1],4,-1530992060),m=C(m,u,f,g,l[A+4],11,1272893353),g=C(g,m,u,f,l[A+7],16,-155497632),f=C(f,g,m,u,l[A+10],23,-1094730640),u=C(u,f,g,m,l[A+13],4,681279174),m=C(m,u,f,g,l[A+0],11,-358537222),g=C(g,m,u,f,l[A+3],16,-722521979),f=C(f,g,m,u,l[A+6],23,76029189),u=C(u,f,g,m,l[A+9],4,-640364487),m=C(m,u,f,g,l[A+12],11,-421815835),g=C(g,m,u,f,l[A+15],16,530742520),f=C(f,g,m,u,l[A+2],23,-995338651),u=S(u,f,g,m,l[A+0],6,-198630844),m=S(m,u,f,g,l[A+7],10,1126891415),g=S(g,m,u,f,l[A+14],15,-1416354905),f=S(f,g,m,u,l[A+5],21,-57434055),u=S(u,f,g,m,l[A+12],6,1700485571),m=S(m,u,f,g,l[A+3],10,-1894986606),g=S(g,m,u,f,l[A+10],15,-1051523),f=S(f,g,m,u,l[A+1],21,-2054922799),u=S(u,f,g,m,l[A+8],6,1873313359),m=S(m,u,f,g,l[A+15],10,-30611744),g=S(g,m,u,f,l[A+6],15,-1560198380),f=S(f,g,m,u,l[A+13],21,1309151649),u=S(u,f,g,m,l[A+4],6,-145523070),m=S(m,u,f,g,l[A+11],10,-1120210379),g=S(g,m,u,f,l[A+2],15,718787259),f=S(f,g,m,u,l[A+9],21,-343485551),u=u+I>>>0,f=f+M>>>0,g=g+R>>>0,m=m+T>>>0}return a.endian([u,f,g,m])};i._ff=function(r,o,l,h,u,f,g){var m=r+(o&l|~o&h)+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._gg=function(r,o,l,h,u,f,g){var m=r+(o&h|l&~h)+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._hh=function(r,o,l,h,u,f,g){var m=r+(o^l^h)+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._ii=function(r,o,l,h,u,f,g){var m=r+(l^(o|~h))+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._blocksize=16,i._digestsize=16,eF.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var l=a.wordsToBytes(i(r,o));return o&&o.asBytes?l:o&&o.asString?n.bytesToString(l):a.bytesToHex(l)}})();class FB{constructor(e,t,n,i){x(this,"success");x(this,"filename");x(this,"hash");x(this,"size");x(this,"url");this.success=e,this.filename=t,this.hash=n,this.size=i}}async function yZ(a,e){const t=await a.arrayBuffer(),n=iF(t),i=a.name.split(".").pop(),r=n+"."+i,o=a.name.split(".").shift();console.assert(o!==void 0);const l={alias:o,filename:r},u=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(l)})).json();if(u.success||console.warn("exists check did fail"),u.exists)return console.log("file already exists",n),new FB(!0,r,n,a.size);console.log("begin uploading file",o,a.size);const f=new FormData;f.append("file",a);const g={};g.filesize=a.size,o&&(g.alias=o);const A=await(await fetch(e+"/upload/file",{method:"POST",body:f,headers:g})).json();if((A==null?void 0:A.success)===!1)return A.message!==void 0?console.error("Upload failed:",A.message):console.error("Upload failed"),null;console.assert(A.hash_sum===n,"hash sum did not match","received:",A.hash_sum,"expected:",n),A.success&&console.log("successfully uploaded",n,A.id);const v=new FB(A.success,r,n,a.size);return v.url=e,v}function iF(a){return eF.exports(new Uint8Array(a))}async function sF(a,e,t,n,i=!1){try{const r=await fetch(n+"/download/file",{method:"POST",body:a});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),l=await o.arrayBuffer();i||console.assert(o.size===t,"size mismatch","expected:",t,"got:",o.size);const h=iF(l);return i||console.assert(h===e,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function _Z(a,e){var f;const t=await fetch(a),n=(f=t.body)==null?void 0:f.getReader(),i=t.headers.get("Content-Length"),r=i?parseInt(i):0;if(!n)return null;let o=0,l=[];for(;;){const{done:g,value:m}=await n.read();if(m&&(l.push(m),o+=m.length,e.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),g)break}const h=new Uint8Array(o);let u=0;for(let g of l)h.set(g,u),u+=g.length;return h}const Em=Ct("debugavatar");class mM{constructor(e,t,n,i){x(this,"root");x(this,"head");x(this,"leftHand");x(this,"rigthHand");var r;this.root=e,this.head=t,this.leftHand=n,this.rigthHand=i,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class gM{constructor(){x(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let n=null;if(typeof t=="string"){if(n=await this.loadAvatar(e,t),!n){const r=new Go;n=Ee.instantiate(Gf(t,e.scene),r)}}else n=t;if(!n)return null;const i=this.findAvatar(n);return i.isValid?(Em&&console.log("[Custom Avatar] valid config",t,Em?i:""),i):(console.warn("[Custom Avatar] config isn't valid",t,Em?i:""),null)}async loadAvatar(e,t){var i;if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(Em&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const r=await fetch("./"+t);let o=null;if(r.ok){const h=await r.blob();h&&(o=await h.arrayBuffer())}if(!o&&(o=await sF(t,t,0,"no url here go away",!0),!o))return null;const l=await Sx(e,o,null,0);return(i=l==null?void 0:l.scene)!=null?i:null}const n=new np;return qv(n,e),new Promise((r,o)=>{const l=this.avatarRegistryUrl+"/"+t;n.load(l,async h=>{await xk(e,l,h),r(h.scene)},h=>{Em&&console.log("[Custom Avatar] "+h.loaded/h.total*100+"% loaded of "+h.total/1024+"kB")},h=>{console.error("[Custom Avatar] Error when loading: "+h),r(null)})})}cacheModel(e,t){}findAvatar(e){const t=e;let n=t;n.children.length==1&&(n=e.children[0]);let i=this.findAvatarPart(n,["head"]);const r=this.findAvatarPart(n,["left","hand"]),o=this.findAvatarPart(n,["right","hand"]);if(!i){i=t;const h=new q;new Rr().setFromObject(i).getSize(h);const u=Math.max(h.x,h.y,h.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+u+" meters! Should be < 0.3m"),u>.3&&i.scale.multiplyScalar(1/u*.3)}return new mM(t,i,r,o)}findAvatarPart(e,t){const n=e.name.toLowerCase();let i=!0;for(const r of t){if(!i)break;n.indexOf(r)===-1&&(i=!1)}if(i)return e;if(e.children)for(const r of e.children){const o=this.findAvatarPart(r,t);if(o)return o}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var vZ=Object.defineProperty,xZ=Object.getOwnPropertyDescriptor,AM=(a,e,t,n)=>{for(var i=n>1?void 0:n?xZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&vZ(e,t,i),i};class tA extends pt{constructor(){super(...arguments);x(this,"length",1);x(this,"depthTest",!0);x(this,"isGizmo",!0);x(this,"_axes",null)}onEnable(){if(this.isGizmo&&!Zg)return;this._axes||(this._axes=new Iv(this.length)),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){!this._axes||this.gameObject.remove(this._axes)}}AM([we()],tA.prototype,"length",2);AM([we()],tA.prototype,"depthTest",2);AM([we()],tA.prototype,"isGizmo",2);class rF extends pt{constructor(){super(...arguments);x(this,"from");x(this,"to");x(this,"hint");x(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;let t=ni(this.to).clone(),n=ni(this.from).clone(),i=t.distanceTo(n),r=t.clone();r.sub(n);let o=n.clone();o.add(t),o.multiplyScalar(.5);let l=ni(this.hint).clone();l.sub(o);let h=new q;h.crossVectors(l,r),h.crossVectors(r,h),h.normalize();let u=i*.5,f=Math.max(this.desiredDistance,u),g=Math.sqrt(f*f-u*u),m=h.clone();m.multiplyScalar(g),m.add(o),sr(this.gameObject,m);let A=o.clone();A.sub(h),this.gameObject.lookAt(A)}}const wZ=new zi(1,1,1);function oF(a=null){const e=new ye(a!=null?a:14540253),t=new RS(wZ);return new Wo(t,new Ts({color:e}))}const bZ=Ct("gizmos"),sv=class extends pt{constructor(){super(...arguments);x(this,"box",null);x(this,"testBox",new Rr);x(this,"_lastMatrixUpdateFrame",-1);x(this,"_helper",null);x(this,"_color",null)}isInBox(t){var n;if(!!t){if(this.box||(this.box=new Rr),this.updateBox(!1),t.type==="Mesh")this.testBox.setFromObject(t);else{const i=ni(t,sv._position),r=kD(t,sv._size);this.testBox.setFromCenterAndSize(i,r)}return(n=this.box)==null?void 0:n.intersectsBox(this.testBox)}}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){return this.box||(this.box=new Rr),(t||this.context.time.frameCount!=this._lastMatrixUpdateFrame)&&(this._lastMatrixUpdateFrame=this.context.time.frameCount,this.box.setFromCenterAndSize(new q(0,0,0),new q(1,1,1)),this.box.applyMatrix4(this.gameObject.matrixWorld)),this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,n=!1){var i;if(!(!bZ&&!n)){if(this._helper){t&&((i=this._color)==null||i.set(t)),this.gameObject.add(this._helper);return}this._helper=oF(t),this.gameObject.add(this._helper)}}};let Uc=sv;x(Uc,"_position",new q),x(Uc,"_size",new q(.01,.01,.01));class nA extends pt{constructor(){super(...arguments);x(this,"canGrab",!0)}onPointerClick(t){}}class iA extends pt{constructor(){super(...arguments);x(this,"isUsed",!0);x(this,"usedBy",null)}}class yM extends Uc{}class aF extends pt{constructor(){super(...arguments);x(this,"deleteBoxes",[])}awake(){this.deleteBoxes=Ee.findObjectsOfType(yM,this.context)}update(){for(const t of this.deleteBoxes){const n=this.gameObject;t.isInBox(n)===!0&&(Ee.getComponentInParent(this.gameObject,iA)||eM(this.gameObject,this.context.connection))}}}var CZ=Object.defineProperty,EZ=Object.getOwnPropertyDescriptor,SZ=(a,e,t,n)=>{for(var i=n>1?void 0:n?EZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&CZ(e,t,i),i};class _M extends pt{constructor(){super(...arguments);x(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||Ee.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:MZ()?(this.visibleOn&2)!==0:(this.visibleOn&1)!==0}}SZ([we()],_M.prototype,"visibleOn",2);let By;function MZ(){if(By===!0||By===!1)return By;let a=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),By=a,a}class po{constructor(){x(this,"bb",null);x(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,t,n,i){return e.prep(4,12),e.writeFloat32(i),e.writeFloat32(n),e.writeFloat32(t),e.offset()}}class cF{constructor(){x(this,"bb",null);x(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}position(e){return(e||new po).__init(this.bb_pos,this.bb)}rotation(e){return(e||new po).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new po).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,t,n,i,r,o,l,h,u,f){return e.prep(4,36),e.prep(4,12),e.writeFloat32(f),e.writeFloat32(u),e.writeFloat32(h),e.prep(4,12),e.writeFloat32(l),e.writeFloat32(o),e.writeFloat32(r),e.prep(4,12),e.writeFloat32(i),e.writeFloat32(n),e.writeFloat32(t),e.offset()}}class kc{constructor(){x(this,"bb",null);x(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedTransformModel(e,t){return(t||new kc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,t){return e.setPosition(e.position()+Vv),(t||new kc).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const t=this.bb.__offset(this.bb_pos,8);return t?(e||new cF).__init(this.bb_pos+t,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addFast(e,t){e.addFieldInt8(1,+t,0)}static addTransform(e,t){e.addFieldStruct(2,t,0)}static addDontSave(e,t){e.addFieldInt8(3,+t,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(e,t){e.finish(t,void 0,!0)}}const Pl=Ct("debugsync"),vg="STRS";aM(vg,kc.getRootAsSyncedTransformModel);const Ba=new tp;function lF(a,e,t=!0){Ba.clear();const n=Ba.createString(a);kc.startSyncedTransformModel(Ba),kc.addGuid(Ba,n),kc.addFast(Ba,t);const i=e.worldPosition,r=e.worldEuler,o=e.gameObject.scale;kc.addTransform(Ba,cF.createTransform(Ba,i.x,i.y,i.z,r.x,r.y,r.z,o.x,o.y,o.z));const l=kc.endSyncedTransformModel(Ba);return Ba.finish(l,vg),Ba.asUint8Array()}class oh extends pt{constructor(){super(...arguments);x(this,"overridePhysics",!0);x(this,"interpolatePosition",!0);x(this,"interpolateRotation",!0);x(this,"fastMode",!1);x(this,"syncDestroy",!1);x(this,"_model",null);x(this,"_needsUpdate",!0);x(this,"rb",null);x(this,"_wasKinematic",!1);x(this,"_receivedDataBefore",!1);x(this,"_targetPosition");x(this,"_targetRotation");x(this,"_receivedFastUpdate",!1);x(this,"_shouldRequestOwnership",!1);x(this,"joinedRoomCallback",null);x(this,"receivedDataCallback",null);x(this,"tempEuler",new _s);x(this,"receivedUpdate",!1);x(this,"lastWorldPos");x(this,"lastWorldRotation")}requestOwnership(){Pl&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t,n;return(n=(t=this._model)==null?void 0:t.hasOwnership)!=null?n:void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){Pl&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new q,this._targetRotation=new kt,this.lastWorldPos=new q,this.lastWorldRotation=new kt,this.rb=Ee.getComponentInChildren(this.gameObject,yr),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new cM(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(Ds.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinrary(vg,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&M9(this.guid,this.context.connection),this._model=null,this.context.connection.stopListening(Ds.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(vg,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var n;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){Pl&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const i=t.transform();if(i){Pr.markDirty(this.gameObject,!0);const r=i.position();r&&(this.interpolatePosition&&((n=this._targetPosition)==null||n.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=i.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&c9(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){var o;if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){Pl&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());let t=this.worldPosition,n=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const l=t.distanceTo(this.lastWorldPos),h=n.angleTo(this.lastWorldRotation),u=this._model.hasOwnership||this.fastMode?1e-4:.001;(l>u||h>u)&&(this._model.hasOwnership?this._needsUpdate=!0:(Pl&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,n.copy(this.lastWorldRotation),Pr.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const h=this._receivedFastUpdate||this.fastMode?.5:.3;let u=!1;if(this.interpolatePosition&&this._targetPosition){const f=this.worldPosition;f.lerp(this._targetPosition,h),this.worldPosition=f,u=!0}if(this.interpolateRotation&&this._targetRotation){const f=this.worldQuaternion;f.slerp(this._targetRotation,h),this.worldQuaternion=f,u=!0}u&&Pr.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(n),!this._model)return;if(!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership){this.rb&&(this.rb.isKinematic=(o=this._model.isOwned)!=null?o:!1,this.rb.setVelocity(0,0,0),this.rb.setBodyFromGameObject());return}this.rb&&(this._wasKinematic!==void 0&&(Pl&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic),this.gameObject.position.distanceTo(new q(0,0,0))>1e3&&(Pl&&console.log("RESET",this.name),this.gameObject.position.set(0,1,0),this.rb.setVelocity(0,0,0),this.rb.setBodyFromGameObject()));const i=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%i===0||r)){Pl&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this.overridePhysics&&this.rb&&this.rb.setBodyFromGameObject(),this._needsUpdate=!1;const l=lF(this.guid,this,!!r);this.context.connection.sendBinary(l)}}}class TZ{static createButton(e,t={}){const n=document.createElement("button");function i(){if(t.domOverlay===void 0){var h=document.createElement("div");h.style.display="none",document.body.appendChild(h);var u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("width",38),u.setAttribute("height",38),u.style.position="absolute",u.style.right="20px",u.style.top="20px",u.addEventListener("click",function(){g.end()}),h.appendChild(u);var f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),f.setAttribute("stroke","#fff"),f.setAttribute("stroke-width",2),u.appendChild(f),t.optionalFeatures===void 0&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:h}}t.optionalFeatures===void 0&&(t.optionalFeatures=[]),t.optionalFeatures.push("local-floor"),t.optionalFeatures.push("hand-tracking"),t.optionalFeatures.push("layers");let g=null;async function m(v){v.addEventListener("end",A),await e.xr.setSession(v),n.textContent="STOP AR",t.domOverlay.root.style.display="",g=v}function A(){g.removeEventListener("end",A),n.textContent="START AR",t.domOverlay.root.style.display="none",g=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="START AR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){g===null?navigator.xr.requestSession("immersive-ar",t).then(m):g.end()}}function r(){n.disabled=!0,n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function o(){r(),n.textContent="AR NOT SUPPORTED"}function l(h){h.style.position="absolute",h.style.bottom="20px",h.style.padding="12px 6px",h.style.border="1px solid #fff",h.style.borderRadius="4px",h.style.background="rgba(0,0,0,0.1)",h.style.color="#fff",h.style.font="normal 13px sans-serif",h.style.textAlign="center",h.style.opacity="0.5",h.style.outline="none",h.style.zIndex="999"}if("xr"in navigator)return n.id="ARButton",n.style.display="none",l(n),navigator.xr.isSessionSupported("immersive-ar").then(function(h){h?i():o()}).catch(o),n;{const h=document.createElement("a");return window.isSecureContext===!1?(h.href=document.location.href.replace(/^http:/,"https:"),h.innerHTML="WEBXR NEEDS HTTPS"):(h.href="https://immersiveweb.dev/",h.innerHTML="WEBXR NOT AVAILABLE"),h.style.left="calc(50% - 90px)",h.style.width="180px",h.style.textDecoration="none",l(h),h}}}const rv=class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=document.createElement("button");function i(){let h=null;async function u(g){g.addEventListener("end",f),await e.xr.setSession(g),n.textContent="EXIT VR",h=g}function f(){h.removeEventListener("end",f),n.textContent="ENTER VR",h=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(h===null){const g={optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};navigator.xr.requestSession("immersive-vr",g).then(u)}else h.end()}}function r(){n.disabled=!0,n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function o(){r(),n.textContent="VR NOT SUPPORTED"}function l(h){h.style.position="absolute",h.style.bottom="20px",h.style.padding="12px 6px",h.style.border="1px solid #fff",h.style.borderRadius="4px",h.style.background="rgba(0,0,0,0.1)",h.style.color="#fff",h.style.font="normal 13px sans-serif",h.style.textAlign="center",h.style.opacity="0.5",h.style.outline="none",h.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",l(n),navigator.xr.isSessionSupported("immersive-vr").then(function(h){h?i():o(),rv.xrSessionIsGranted&&(console.log("XR session is granted - will enter immersive web now"),n.click())}),n;{const h=document.createElement("a");return window.isSecureContext===!1?(h.href=document.location.href.replace(/^http:/,"https:"),h.innerHTML="WEBXR NEEDS HTTPS"):(h.href="https://immersiveweb.dev/",h.innerHTML="WEBXR NOT AVAILABLE"),h.style.left="calc(50% - 90px)",h.style.width="180px",h.style.textDecoration="none",l(h),h}}static registerSessionGrantedListener(){if("xr"in navigator)try{navigator.xr.addEventListener("sessiongranted",()=>{console.log("Received session granted event"),rv.xrSessionIsGranted=!0})}catch(e){console.error(e)}}};let jm=rv;x(jm,"xrSessionIsGranted",!1);jm.registerSessionGrantedListener();const U_="noVoip",Hr=Ct("debugvoip"),IZ=Ct("voip");class RZ{constructor(e){x(this,"id");this.id=e}}class PZ{constructor(e,t,n,i){x(this,"peer");x(this,"voip");x(this,"userId");x(this,"peerId");x(this,"call",null);x(this,"callErrorListener",null);x(this,"stream",null);this.voip=e,this.peer=t,this.userId=n,this.peerId=i}close(){var e;Hr&&console.log("close voip call"),this.callErrorListener&&this.peer.off("error",this.callErrorListener),this.call&&this.call.open&&this.call.close(),(e=this.stream)==null||e.getTracks().forEach(function(t){t.stop()})}updateMute(e){var n;if(!this.stream)return;const t=(n=this.stream)==null?void 0:n.getAudioTracks();for(const i of t)i.enabled=!e}async startVoipCall(){if(!await yh.HasMicrophonePermissions()){console.warn("no permission to use microphone, can not start call");return}Hr&&console.log("start voip call"),this.stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.updateMute(this.voip.muteOutput),Hr&&console.log(this.stream),this.call=this.peer.call(this.peerId,this.stream,{metadata:{userId:this.userId}}),this.call.on("error",t=>{console.error(t)}),this.call.on("stream",t=>{Hr&&console.log("received stream from remote again",t)}),this.peer.on("close",this.onCallClose.bind(this)),this.callErrorListener=t=>{var n;t.message.includes(this.peerId)?(console.log("Could not connect to "+this.peerId),this.callErrorListener&&this.peer.off("error",this.callErrorListener),this.call&&this.call.close(),(n=this.stream)==null||n.getTracks().forEach(function(i){i.stop()}),this.stream=null):console.error(t)},this.peer.on("error",this.callErrorListener)}onCallClose(e){Hr&&console.log("call closed",e)}}class BZ{constructor(e,t,n){x(this,"voip");x(this,"call");x(this,"audio",null);x(this,"stream",null);x(this,"obj");x(this,"analyzer",null);x(this,"waitingForStart",!1);x(this,"closed",!1);x(this,"audioElement",null);this.voip=e,this.obj=t,this.call=n}get currentStream(){return this.stream}get currentAudio(){return this.audio}get currentAnalyzer(){return this.analyzer}openAudioStream(e){const t=e.getAudioTracks();for(const n of t)if(n.kind==="audio"&&n.readyState==="live"){this.open(n);return}console.warn("failed finding valid audio stream to begin call")}open(e){console.assert(e.kind==="audio","invalid track kind, expected audio but received "+e.kind),!this.waitingForStart&&(this.waitingForStart=!0,Br.userInteractionRegistered||Hr&&console.log("Incoming call, waiting for user interaction before opening audio"),Br.registerWaitForAllowAudio(async()=>{if(this.call.open&&!this.closed){Hr&&console.log("Setup audio and begin listening"),this.stream=new MediaStream([e]);const t=new HS;this.audio=new Mv(t),this.audio.setVolume(this.voip.muteInput?0:1),this.audio.setMediaStreamSource(this.stream);const n=document.createElement("audio");this.audioElement=n,n.style.display="none",document.body.appendChild(n),n.srcObject=this.stream,n.sinkId!==void 0&&navigator.mediaDevices.enumerateDevices().then(i=>{if(!!n){console.log(i);for(const r of i)if(r.label==="Speakerphone"){n.sinkId=r.deviceId;break}}}),Hr&&console.log("call is setup, you should hear something now"),this.analyzer=new wD(this.audio,32)}}))}close(){var e,t,n;this.closed=!0,(e=this.call)!=null&&e.open&&this.call.close(),(t=this.audio)==null||t.disconnect(),(n=this.stream)==null||n.getTracks().forEach(i=>{i.stop()}),this.stream=null,this.audioElement&&this.audioElement.remove()}}class yh extends pt{constructor(){super(...arguments);x(this,"requireParam",!1);x(this,"peer",null);x(this,"model",null);x(this,"connections",{});x(this,"currentIncomingCalls",{});x(this,"_inputMuted",!1);x(this,"_outputMuted",!1)}set muteInput(t){var i;if(t===this._inputMuted||(this._inputMuted=t,!this.currentIncomingCalls))return;const n=this._inputMuted?0:1;for(const r in this.currentIncomingCalls){const o=this.currentIncomingCalls[r];(i=o==null?void 0:o.currentAudio)==null||i.setVolume(n)}}get muteInput(){return this._inputMuted}set muteOutput(t){if(t!==this._outputMuted&&(this._outputMuted=t,!!this.connections))for(const n in this.connections){const i=this.connections[n];i==null||i.updateMute(t)}}get muteOutput(){return this._outputMuted}getFrequency(t){if(t===null){for(const i in this.currentIncomingCalls){const r=this.currentIncomingCalls[i];if(r&&r.currentAnalyzer)return r.currentAnalyzer.getAverageFrequency()}return null}const n=this.currentIncomingCalls[t];return n&&n.currentAnalyzer?n.currentAnalyzer.getAverageFrequency():null}awake(){if(Ct(U_)){console.log("VOIP is disabled by url parameter: "+U_);return}if(this.requireParam&&!IZ){console.debug("VOIP must be enabled explicitly by url parameter");return}this.peer=new k_,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,this.context.connection.beginListen(Ds.JoinedRoom,t=>{navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}),this.context.connection.beginListen("peer-update-id",t=>{if(t.id!==this.context.connection.connectionId){const n=this.connections[t.id];if(n&&n.close(),this.peer&&this.context.connection.connectionId){const i=new PZ(this,this.peer,this.context.connection.connectionId,t.peerId);this.connections[t.id]=i,i.startVoipCall()}}}),this.context.connection.beginListen(Ds.UserLeftRoom,t=>{const{userId:n}=t,i=this.connections[n];this.connections[n]=null,i&&i.close();const r=this.currentIncomingCalls[n];Hr&&console.log("UserLeftRoom",t,n,r),r&&(r.close(),this.currentIncomingCalls[n]=null)}),this.peer.on("open",this.onOpenPeerConnection.bind(this))}onEnable(){}onDisable(){console.log("TODO: close all");for(const t in this.currentIncomingCalls){const n=this.currentIncomingCalls[t];n==null||n.close();const i=this.connections[t];i==null||i.close()}}async onOpenPeerConnection(t){Hr&&console.log("Peer connection established and received id"),this.model=new RZ(t),this.context.connection.send("peer-update-id",this.model,N_.OnRoomJoin),this.peer&&(this.peer.on("call",this.onReceiveCall.bind(this)),this.peer.on("connection",function(n){Hr&&console.log("CONNECTION",n),n.on("data",function(i){Hr&&console.log("Received",i)})}))}async onReceiveCall(t){const{metadata:n}=t;console.assert(n.userId);const{userId:i}=n,r=this.currentIncomingCalls[i];if(r&&r.close(),Hr&&console.log("received call"),await yh.HasMicrophonePermissions()){const o=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});t.answer(o)}else t.answer(null);this.currentIncomingCalls[i]=new BZ(this,this.gameObject,t),t.on("stream",o=>{var l;Hr&&console.log("receive caller stream, will setup audio now"),(l=this.currentIncomingCalls[i])==null||l.openAudioStream(o)}),t.on("error",console.error)}static async HasMicrophonePermissions(){return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}}const lf=Ct("debugflags");var pr=(a=>(a[a.Never=0]="Never",a[a.Browser=1]="Browser",a[a.AR=2]="AR",a[a.VR=4]="VR",a[a.FirstPerson=8]="FirstPerson",a[a.ThirdPerson=16]="ThirdPerson",a[a.All=4294967295]="All",a))(pr||{});const P1=class{constructor(){x(this,"Mask",17)}Has(e){const t=this.Mask&e;return lf&&console.log("HAS",e,this.Mask,"Result="+t),t!==0}Set(e){this.Mask=e,mr.Apply()}Enable(e){this.Mask|=e,mr.Apply()}Disable(e){this.Mask&=~e,mr.Apply()}Toggle(e){this.Mask^=e,mr.Apply()}EnableAll(){this.Mask=-1,mr.Apply()}DisableAll(){this.Mask=0,mr.Apply()}};let Ja=P1;x(Ja,"Global",new P1);const Fa=class extends pt{constructor(){super(...arguments);x(this,"visibleIn")}static Apply(){for(const t of this.registry)t.UpdateVisible(Ja.Global)}awake(){Fa.registry.push(this)}onEnable(){Fa.firstApply||(Fa.firstApply=!0,Fa.Apply())}onDestroy(){const t=Fa.registry.indexOf(this);t>=0&&Fa.registry.splice(t,1)}get isOn(){return this.gameObject.visible}UpdateVisible(t=null){if(!this.enabled)return;let n;const i=t;i&&typeof i=="number"&&(console.assert(typeof i=="number","XRFlag.UpdateVisible: state must be a number",i),lf&&console.log(i),Fa.buffer.Mask=i,t=Fa.buffer);const r=t;if(r?(lf&&console.log("use passed in mask"),n=r.Has(this.visibleIn)):(lf&&console.log("use global mask"),Ja.Global.Has(this.visibleIn)),n!==void 0)if(n)lf&&console.trace("is visible",this.name,this.gameObject.uuid),Ee.setActive(this.gameObject,!0);else{if(lf&&console.trace("is not visible",this.name,this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let mr=Fa;x(mr,"registry",[]),x(mr,"firstApply"),x(mr,"buffer",new Ja);const hs={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function hF(a){const e=await fetch(a);if(e.ok)return e.json();throw new Error(e.statusText)}async function LZ(a){if(!a)throw new Error("No basePath supplied");return await hF(`${a}/profilesList.json`)}async function DZ(a,e,t=null,n=!0){if(!a)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const i=await LZ(e);let r;if(a.profiles.some(h=>{const u=i[h];return u&&(r={profileId:h,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const h=i[t];if(!h)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}}const o=await hF(r.profilePath);let l;if(n){let h;if(a.handedness==="any"?h=o.layouts[Object.keys(o.layouts)[0]]:h=o.layouts[a.handedness],!h)throw new Error(`No matching handedness, ${a.handedness}, in profile ${r.profileId}`);h.assetPath&&(l=r.profilePath.replace("profile.json",h.assetPath))}return{profile:o,assetPath:l}}const OZ={xAxis:0,yAxis:0,button:0,state:hs.ComponentState.DEFAULT};function FZ(a=0,e=0){let t=a,n=e;if(Math.sqrt(a*a+e*e)>1){const o=Math.atan2(e,a);t=Math.cos(o),n=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}class kZ{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===hs.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(OZ)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){const{normalizedXAxis:r,normalizedYAxis:o}=FZ(e,t);switch(this.componentProperty){case hs.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?r:.5;break;case hs.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?o:.5;break;case hs.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case hs.ComponentProperty.STATE:this.valueNodeProperty===hs.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class NZ{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const i=new kZ(t.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:hs.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=hs.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=hs.ComponentState.PRESSED:(t.touched||this.values.button>hs.ButtonTouchThreshold)&&(this.values.state=hs.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===hs.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>hs.AxisTouchThreshold&&(this.values.state=hs.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===hs.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>hs.AxisTouchThreshold&&(this.values.state=hs.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class UZ{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{const r=this.layoutDescription.components[i];this.components[i]=new NZ(i,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const zZ="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",GZ="generic-trigger";class HZ extends Ft{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{const{valueNode:i,minNode:r,maxNode:o,value:l,valueNodeProperty:h}=n;!i||(h===hs.VisualResponseProperty.VISIBILITY?i.visible=l:h===hs.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(r.quaternion,o.quaternion,l),i.position.lerpVectors(r.position,o.position,l)))})}))}}function VZ(a,e){Object.values(a.components).forEach(t=>{const{type:n,touchPointNodeName:i,visualResponses:r}=t;if(n===hs.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const o=new mo(.001),l=new Hi({color:255}),h=new _t(o,l);t.touchPointNode.add(h)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:l,minNodeName:h,maxNodeName:u,valueNodeProperty:f}=o;if(f===hs.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(h),o.maxNode=e.getObjectByName(u),!o.minNode){console.warn(`Could not find ${h} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${u} in the model`);return}}o.valueNode=e.getObjectByName(l),o.valueNode||console.warn(`Could not find ${l} in the model`)})})}function kB(a,e){VZ(a.motionController,e),a.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=a.envMap,t.material.needsUpdate=!0)}),a.layers.mask!=0&&e.traverse(t=>{t.layers.mask=a.layers.mask}),a.add(e)}class WZ{constructor(e=null){this.gltfLoader=e,this.path=zZ,this._assetCache={},this.gltfLoader||(this.gltfLoader=new np)}createControllerModel(e){const t=new HZ;let n=null;return e.addEventListener("connected",i=>{const r=i.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||DZ(r,this.path,GZ).then(({profile:o,assetPath:l})=>{t.motionController=new UZ(r,o,l);const h=this._assetCache[t.motionController.assetUrl];if(h)n=h.scene.clone(),kB(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,u=>{this._assetCache[t.motionController.assetUrl]=u,n=u.scene.clone(),kB(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}}const QZ="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class jZ{constructor(e,t,n,i){this.controller=t,this.handModel=e,this.bones=[];const r=new np;r.setPath(n||QZ),r.load(`${i}.glb`,o=>{const l=o.scene.children[0];this.handModel.add(l),l.layers.mask=this.handModel.layers.mask;const h=l.getObjectByProperty("type","SkinnedMesh");h.frustumCulled=!1,h.castShadow=!0,h.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(f=>{const g=l.getObjectByName(f);g!==void 0?g.jointName=f:console.warn(`Couldn't find ${f} in ${i} hand mesh`),this.bones.push(g)})})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const n=this.bones[t];if(n){const i=e[n.jointName];if(i.visible){const r=i.position;n.position.copy(r),n.quaternion.copy(i.quaternion)}}}}}const qZ=.01,XZ="index-finger-tip";class YZ extends Ft{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null,e.addEventListener("connected",t=>{const n=t.data;n.hand&&!this.motionController&&(this.xrInputSource=n,this.motionController=new jZ(this,e,this.path,n.handedness))}),e.addEventListener("disconnected",()=>{this.clear(),this.motionController=null})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const e=this.controller.joints[XZ];return e?e.position:null}intersectBoxObject(e){const t=this.getPointerPosition();if(t){const n=new ec(t,qZ),i=new Rr().setFromObject(e);return n.intersectsBox(i)}else return!1}checkButton(e){this.intersectBoxObject(e)?e.onPress():e.onClear(),e.isPressed()&&e.whilePressed()}}const JZ=.05,NB=.02,Ly=.01,UB=.02,zB=1,sf=.4,KZ=.002,Sm=.01,Dy=.003,GB=.035,Ni=16,To=12,lC=110,ZZ=new q(0,1,0),$Z=new q(0,0,1),e$=.02,t$=1.5;class n$ extends Ft{constructor(e,t){super(),this.hand=e,this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null,this.pointerGeometry=null,this.pointerMesh=null,this.pointerObject=null,this.pinched=!1,this.attached=!1,this.cursorObject=null,this.raycaster=null,e.addEventListener("connected",n=>{const i=n.data;i.hand&&(this.visible=!0,this.xrInputSource=i,this.pointerObject===null&&this.createPointer())})}_drawVerticesRing(e,t,n){const i=t.clone();for(let r=0;r<Ni;r++){i.applyAxisAngle($Z,Math.PI*2/Ni);const o=n*Ni+r;e[3*o]=i.x,e[3*o+1]=i.y,e[3*o+2]=i.z}}_updatePointerVertices(e){const t=this.pointerGeometry.attributes.position.array,n=new q(KZ,0,-1*(GB-e));this._drawVerticesRing(t,n,0);const i=new q(Math.sin(Math.PI*lC/180)*e,Math.cos(Math.PI*lC/180)*e,0);for(let u=0;u<To;u++)this._drawVerticesRing(t,i,u+1),i.applyAxisAngle(ZZ,Math.PI*lC/180/(To*-2));const r=Ni*(1+To),o=Ni*(1+To)+1,l=new q(0,0,-1*(GB-e));t[r*3]=l.x,t[r*3+1]=l.y,t[r*3+2]=l.z;const h=new q(0,0,e);t[o*3]=h.x,t[o*3+1]=h.y,t[o*3+2]=h.z,this.pointerGeometry.setAttribute("position",new tn(t,3))}createPointer(){let e,t;const n=new Array(((To+1)*Ni+2)*3).fill(0),i=[];for(this.pointerGeometry=new Sn,this.pointerGeometry.setAttribute("position",new tn(n,3)),this._updatePointerVertices(Sm),e=0;e<To;e++){for(t=0;t<Ni-1;t++)i.push(e*Ni+t,e*Ni+t+1,(e+1)*Ni+t),i.push(e*Ni+t+1,(e+1)*Ni+t+1,(e+1)*Ni+t);i.push((e+1)*Ni-1,e*Ni,(e+2)*Ni-1),i.push(e*Ni,(e+1)*Ni,(e+2)*Ni-1)}const r=Ni*(1+To),o=Ni*(1+To)+1;for(e=0;e<Ni-1;e++)i.push(r,e+1,e),i.push(o,e+Ni*To,e+Ni*To+1);i.push(r,0,Ni-1),i.push(o,Ni*(To+1)-1,Ni*To);const l=new Hi;l.transparent=!0,l.opacity=sf,this.pointerGeometry.setIndex(i),this.pointerMesh=new _t(this.pointerGeometry,l),this.pointerMesh.position.set(0,0,-1*Sm),this.pointerObject=new Ft,this.pointerObject.add(this.pointerMesh),this.raycaster=new ju;const h=new mo(e$,10,10),u=new Hi;u.transparent=!0,u.opacity=sf,this.cursorObject=new _t(h,u),this.pointerObject.add(this.cursorObject),this.add(this.pointerObject),this.pointerObject.layers.mask=this.layers.mask,this.pointerMesh.layers.mask=this.layers.mask}_updateRaycaster(){if(this.raycaster){const e=this.pointerObject.matrixWorld,t=new fn;t.identity().extractRotation(e),this.raycaster.ray.origin.setFromMatrixPosition(e),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(t)}}_updatePointer(){this.pointerObject.visible=this.controller.visible;const e=this.hand.joints["index-finger-tip"],t=this.hand.joints["thumb-tip"],n=e.position.distanceTo(t.position),i=e.position.clone().add(t.position).multiplyScalar(.5);this.pointerObject.position.copy(i),this.pointerObject.quaternion.copy(this.controller.quaternion),this.pinched=n<=NB;const r=(n-Ly)/(JZ-Ly),o=(n-Ly)/(NB-Ly);if(r>1)this._updatePointerVertices(Sm),this.pointerMesh.position.set(0,0,-1*Sm),this.pointerMesh.material.opacity=sf;else if(r>0){const l=(Sm-Dy)*r+Dy;this._updatePointerVertices(l),o<1?(this.pointerMesh.position.set(0,0,-1*l-(1-o)*UB),this.pointerMesh.material.opacity=sf+(1-o)*(zB-sf)):(this.pointerMesh.position.set(0,0,-1*l),this.pointerMesh.material.opacity=sf)}else this._updatePointerVertices(Dy),this.pointerMesh.position.set(0,0,-1*Dy-UB),this.pointerMesh.material.opacity=zB;this.cursorObject.material.opacity=this.pointerMesh.material.opacity}updateMatrixWorld(e){super.updateMatrixWorld(e),this.pointerGeometry&&(this._updatePointer(),this._updateRaycaster())}isPinched(){return this.pinched}setAttached(e){this.attached=e}isAttached(){return this.attached}intersectObject(e,t=!0){if(this.raycaster)return this.raycaster.intersectObject(e,t)}intersectObjects(e,t=!0){if(this.raycaster)return this.raycaster.intersectObjects(e,t)}checkIntersections(e,t=!1){if(this.raycaster&&!this.attached){const n=this.raycaster.intersectObjects(e,t),i=new q(0,0,-1);if(n.length>0){const o=n[0].distance;this.cursorObject.position.copy(i.multiplyScalar(o))}else this.cursorObject.position.copy(i.multiplyScalar(t$))}}setCursor(e){const t=new q(0,0,-1);this.raycaster&&!this.attached&&this.cursorObject.position.copy(t.multiplyScalar(e))}}const i$=Ct("debugplayerview");var Jl=(a=>(a.Browser="browser",a.Headset="headset",a.Handheld="handheld",a))(Jl||{});class s${constructor(e,t){x(this,"userId");x(this,"context");x(this,"viewDevice","browser");x(this,"removed",!1);x(this,"_object");this.userId=e,this.context=t}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class r${constructor(e){x(this,"context");x(this,"playerViews",new Map);this.context=e}setPlayerView(e,t,n){let i=this.playerViews.get(e);i||(i=new s$(e,this.context),this.playerViews.set(e,i)),i.viewDevice=n,i.currentObject=t,i.removed=!1}getPlayerView(e){if(!e)return;if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}removePlayerView(e,t){const n=this.playerViews.get(e);(n==null?void 0:n.viewDevice)===t&&(i$&&console.log("REMOVE",e),n.removed=!0,this.playerViews.delete(e))}}const Fl=Ct("debugavatar"),oa=class extends pt{constructor(){super(...arguments);x(this,"connectionId");x(this,"avatar")}static getAvatar(t){return t>=0&&t<oa.instances.length?oa.instances[t]:null}static onAvatarMarkerCreated(t){return oa._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return oa._onAvatarMarkerDestroyed.push(t),t}awake(){oa.instances.push(this),Fl&&console.log(this);for(const t of oa._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){oa.instances.splice(oa.instances.indexOf(this),1);for(const t of oa._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}setVisible(t){this.avatar&&("setVisible"in this.avatar?this.avatar.setVisible(t):Ee.setActive(this.avatar,t))}};let nr=oa;x(nr,"instances",[]),x(nr,"_onNewAvatarMarkerAdded",[]),x(nr,"_onAvatarMarkerDestroyed",[]);const tg=class{constructor(e,t,n){x(this,"_isVisible",!0);x(this,"guid");x(this,"root",null);x(this,"head",null);x(this,"handLeft",null);x(this,"handRight",null);x(this,"lastUpdate",-1);x(this,"isLocalAvatar",!1);x(this,"flags",null);x(this,"headScale",new q(1,1,1));x(this,"handLeftScale",new q(1,1,1));x(this,"handRightScale",new q(1,1,1));x(this,"webxr");x(this,"lastAvatarId",null);x(this,"hasAvatarOverride",!1);x(this,"context");x(this,"avatarMarker",null);x(this,"_headTarget",new Ft);x(this,"_handLeftTarget",new Ft);x(this,"_handRightTarget",new Ft);x(this,"_canInterpolate",!1);this.context=e,this.guid=t,this.webxr=n,this.setupCustomAvatar(this.webxr.defaultAvatar)}setVisible(e){this._isVisible=e,this.updateVisibility()}get isWebXRAvatar(){return!0}updateFlags(){if(!this.flags)return;let e=this.isLocalAvatar?pr.FirstPerson:pr.ThirdPerson;for(const t of this.flags)t.gameObject.visible=!0,t.UpdateVisible(e)}async setAvatarOverride(e){return this.hasAvatarOverride=e!==null,this.hasAvatarOverride&&this.lastAvatarId!==e&&(this.lastAvatarId=e,e!=null&&e.length>0)?await this.setupCustomAvatar(e):null}tryUpdate(e,t){if(e.guid===this.guid&&(this.lastAvatarId!==e.avatarId&&e.avatarId&&e.avatarId.length>0&&(this.lastAvatarId=e.avatarId,this.setupCustomAvatar(e.avatarId)),this.lastUpdate=e.time,this.head)){const n=this.webxr.IsInAR?Jl.Handheld:Jl.Headset;let i=this.head;this.context.players.setPlayerView(e.guid,i,n),Pr.markDirty(this.head),this._canInterpolate=!0;const r=this.isLocalAvatar?this.head:this._headTarget;if(r.position.set(e.position.x,e.position.y,e.position.z),r.quaternion.set(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),r.scale.set(e.scale,e.scale,e.scale),r.scale.multiply(this.headScale),this.handLeft){const o=this.isLocalAvatar?this.handLeft:this._handLeftTarget;o.position.set(e.posLeftHand.x,e.posLeftHand.y,e.posLeftHand.z),o.quaternion.set(e.rotLeftHand._x,e.rotLeftHand._y,e.rotLeftHand._z,e.rotLeftHand._w),o.quaternion.multiply(tg.invertRotation),o.scale.set(e.scale,e.scale,e.scale),o.scale.multiply(this.handLeftScale),Pr.markDirty(this.handLeft)}if(this.handRight){const o=this.isLocalAvatar?this.handRight:this._handRightTarget;o.position.set(e.posRightHand.x,e.posRightHand.y,e.posRightHand.z),o.quaternion.set(e.rotRightHand._x,e.rotRightHand._y,e.rotRightHand._z,e.rotRightHand._w),o.quaternion.multiply(tg.invertRotation),o.scale.set(e.scale,e.scale,e.scale),o.scale.multiply(this.handRightScale),Pr.markDirty(this.handRight)}}}update(){if(this.isLocalAvatar||!this._canInterpolate)return;const e=this.context.time.deltaTime/.1;this.head&&(this.head.position.lerp(this._headTarget.position,e),this.head.quaternion.slerp(this._headTarget.quaternion,e),this.head.scale.lerp(this._headTarget.scale,e)),this.handLeft&&this._handLeftTarget&&(this.handLeft.position.lerp(this._handLeftTarget.position,e),this.handLeft.quaternion.slerp(this._handLeftTarget.quaternion,e),this.handLeft.scale.lerp(this._handLeftTarget.scale,e)),this.handRight&&this._handRightTarget&&(this.handRight.position.lerp(this._handRightTarget.position,e),this.handRight.quaternion.slerp(this._handRightTarget.quaternion,e),this.handRight.scale.lerp(this._handRightTarget.scale,e))}destroy(){var e,t;Fl&&console.log("Destroy avatar",this.guid),(e=this.root)==null||e.removeFromParent(),(t=this.avatarMarker)==null||t.destroy(),this.lastAvatarId=null,this.head&&Qr.Remove(this.context,this.head)}updateVisibility(){const e=this.root;e&&Ee.setActive(e,this._isVisible)}async setupCustomAvatar(e){var i,r,o,l,h;if(Fl&&console.log("LOAD",e,this),!e||typeof e=="string"&&e.length<=0)return!1;this.head&&Qr.Remove(this.context,this.head);const t=e;if((t==null?void 0:t.loadAssetAsync)!==void 0){await t.loadAssetAsync();const u=t.asset;Ee.setActive(u,!1),e=Ee.instantiate(u),Ee.setActive(e,!0)}Fl&&console.log(e);const n=await tg.loader.getOrCreateNewAvatarInstance(this.context,e);if(Fl&&console.log(n,n==null?void 0:n.isValid,this.lastAvatarId,e),n!=null&&n.isValid){if(this.root=n.root,this.root.position.set(0,0,0),this.root.quaternion.set(0,0,0,1),this.root.scale.set(1,1,1),this.avatarMarker=Ee.addNewComponent(this.root,nr),this.avatarMarker.connectionId=this.guid,this.avatarMarker.avatar=this,this.head&&this.head!==n.head&&((i=this.head)==null||i.removeFromParent()),this.head=n.head,this.headScale.copy(this.head.scale),this.head&&!this.isLocalAvatar&&Qr.Add(this.context,this.head,this.avatarMarker),n.leftHand&&((r=this.handLeft)==null||r.removeFromParent()),this.handLeft=(o=n.leftHand)!=null?o:this.handLeft,this.handLeft?this.handLeftScale.copy(this.handLeft.scale):this.handLeftScale.set(1,1,1),n.rigthHand&&((l=this.handRight)==null||l.removeFromParent()),this.handRight=(h=n.rigthHand)!=null?h:this.handRight,this.handRight?this.handRightScale.copy(this.handRight.scale):this.handRightScale.set(1,1,1),this.context.scene.add(this.root),this.flags==null&&(this.flags=[]),this.flags.length=0,this.flags.push(...Ee.getComponentsInChildren(this.root,mr)),this.flags.length<=0&&this.head){const u=Ee.addNewComponent(this.head,mr);u.visibleIn=pr.ThirdPerson|pr.VR,this.flags.push(u),Fl&&console.log("Added flag to head: "+u.visibleIn,this.head.name)}return Fl&&console.log("[Avatar], is Local? ",this.isLocalAvatar,this.root),this.updateFlags(),this.updateVisibility(),!0}else return Fl&&console.warn("build avatar failed"),!1}};let zc=tg;x(zc,"loader",new gM),x(zc,"invertRotation",new kt().setFromAxisAngle(new q(0,1,0),Math.PI));class Qr{static Add(e,t,n=null){if(!!t){for(const i of this.Pois)if(i.obj===t)return;this.Pois.push({obj:t,avatar:n}),this.LastChangeTime=e.time.time}}static Remove(e,t){var n,i;if(!!t){for(const r of this.Pois)if(r.obj===t){this.Pois.splice(this.Pois.indexOf(r),1),this.LastChangeTime=(i=e==null?void 0:e.time.time)!=null?i:(n=ui.Current)==null?void 0:n.time.time;return}}}}x(Qr,"Pois",[]),x(Qr,"LastChangeTime",0);class o${constructor(){x(this,"guid");x(this,"position",new q)}}class z_ extends pt{constructor(){super(...arguments);x(this,"target",null);x(this,"avatar",null);x(this,"_model",null);x(this,"_targetModel",new o$);x(this,"_currentTargetObject",null);x(this,"_lastUpdateTime",0);x(this,"_lookDuration",0);x(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const n=Be.get("MoveRandom");if(n&&this.target){const i=Ee.getComponent(this.target,n);i&&i.destroy()}}awake(){if(this.avatar=Ee.getComponentInParent(this.gameObject,nr),this.avatar){const t=Ee.getComponentInParent(this.gameObject,nr);this._model=new cM(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen("avatar-look-target-changed",t=>{var n;this.target&&t&&t.guid===((n=this.avatar)==null?void 0:n.guid)&&sr(this.target,t.position)})}update(){var n;if((!this.context.connection.isConnected||((n=this._model)==null?void 0:n.hasOwnership))&&(Qr.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Qr.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const i=ni(this._currentTargetObject);sr(this.target,i),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send("avatar-look-target-changed",this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(i))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const n=Qr.Pois;if(n.length>0){const i=n[Math.floor(Math.random()*n.length)];if(i&&i.obj){if(i.avatar&&i.avatar===this.avatar)return;this._currentTargetObject=i.obj}}}}}const Zy=Ct("debugwebxrcontroller");var G_=(a=>(a[a.PhysicalDevice=0]="PhysicalDevice",a[a.Touch=1]="Touch",a))(G_||{}),la=(a=>(a.SelectStart="select-start",a.SelectEnd="select-end",a.Update="update",a))(la||{});class vM extends pt{}const Vs=class extends pt{constructor(){super(...arguments);x(this,"webXR");x(this,"index",-1);x(this,"controllerModel");x(this,"controller");x(this,"controllerGrip");x(this,"hand");x(this,"handPointerModel");x(this,"grabbed",null);x(this,"input",null);x(this,"type",0);x(this,"_wristQuaternion",null);x(this,"movementVector",new q);x(this,"worldRot",new kt);x(this,"joystick",new Xe);x(this,"didRotate",!1);x(this,"didTeleport",!1);x(this,"didChangeScale",!1);x(this,"lastHit",null);x(this,"raycastLine",null);x(this,"_raycastHitPoint",null);x(this,"_connnectedCallback",null);x(this,"_disconnectedCallback",null);x(this,"_selectStartEvt",null);x(this,"_selectEndEvt",null);x(this,"_selectionPressed",!1);x(this,"_selectionPressedLastFrame",!1);x(this,"_selectionStartTime",0);x(this,"_selectionEndTime",0);x(this,"_useSmoothing",!0);x(this,"_isConnected",!1);x(this,"rayRotation",new kt);x(this,"_pinchStartTime");x(this,"selectStartCallback",null);x(this,"lastSelectStartObject",null);x(this,"_didNotEndSelection",!1)}static CreateRaycastLine(){const t=new Ss(this.geometry),n=t.material;return n.color=this.raycastColor,t.layers.set(1),t.name="line",t.scale.z=1,t}static CreateRaycastHitPoint(){const t=new mo(.5,22,22),n=new Hi({color:this.raycastColor}),i=new _t(t,n);return i.visible=!1,i.layers.set(1),i}static Create(t,n,i,r){const o=i?Ee.addNewComponent(i,Vs,!1):new Vs;o.webXR=t,o.index=n,o.type=r;const l=t.context;return o.controller=l.renderer.xr.getController(n),o.controllerGrip=l.renderer.xr.getControllerGrip(n),o.controllerModel=this.Factory.createControllerModel(o.controller),o.controllerGrip.add(o.controllerModel),o.hand=l.renderer.xr.getHand(n),o.hand.add(new YZ(o.hand)),o.hand.traverse(h=>h.layers.set(2)),o.handPointerModel=new n$(o.hand,o.controller),o.controller.addEventListener("connected",h=>{o.setControllerLayers(o.controllerModel,2),o.setControllerLayers(o.controllerGrip,2),setTimeout(()=>{o.setControllerLayers(o.controllerGrip,2)},1e3)}),o.hand.addEventListener("connected",h=>{var f;if(h.data.hand){t.Rig&&t.Rig.add(o.hand),o.type=0,o.handPointerModel.traverse(m=>m.layers.set(2)),(f=o.handPointerModel.pointerObject)==null||f.traverse(m=>m.layers.set(2));const g=o.hand.joints;if(g)for(const m of Object.keys(g)){const A=g[m];A.parent||o.hand.add(A)}}}),o}static addEventListener(t,n){var r;const i=(r=this.eventSubs[t])!=null?r:[];i.push(n),this.eventSubs[t]=i}static removeEventListener(t,n){var o;if(!n)return;const i=(o=this.eventSubs[t])!=null?o:[],r=i.indexOf(n);r>=0&&i.splice(r,1),this.eventSubs[t]=i}get isUsingHands(){var n;const t=(n=this.input)==null?void 0:n.hand;return t!=null}get wrist(){if(!this.hand)return null;const t=this.hand.joints;return t?t.wrist:null}getWristQuaternion(){const t=this.wrist;return t?(this._wristQuaternion||(this._wristQuaternion=new kt),ga(t).multiply(this._wristQuaternion.setFromEuler(new _s(-Math.PI/4,0,0)))):null}get selectionDown(){return this._selectionPressed&&!this._selectionPressedLastFrame}get selectionUp(){return!this._selectionPressed&&this._selectionPressedLastFrame}get selectionPressed(){return this._selectionPressed}get selectionClick(){return this._selectionEndTime-this._selectionStartTime<.3}get raycastHitPoint(){return this._raycastHitPoint}get useSmoothing(){return this._useSmoothing}awake(){if(!this.controller){console.warn("Missing Controller!!!",this);return}this._connnectedCallback=this.onSourceConnected.bind(this),this._disconnectedCallback=this.onSourceDisconnected.bind(this),this._selectStartEvt=this.onSelectStart.bind(this),this._selectEndEvt=this.onSelectEnd.bind(this),this.type===1&&(this.controllerGrip.addEventListener("connected",this._connnectedCallback),this.controllerGrip.addEventListener("disconnected",this._disconnectedCallback),this.controller.addEventListener("selectstart",this._selectStartEvt),this.controller.addEventListener("selectend",this._selectEndEvt)),this.type===0&&(this.controller.addEventListener("selectstart",this._selectStartEvt),this.controller.addEventListener("selectend",this._selectEndEvt))}onDestroy(){var t,n,i;this.type===1&&(this.controllerGrip.removeEventListener("connected",this._connnectedCallback),this.controllerGrip.removeEventListener("disconnected",this._disconnectedCallback),this.controller.removeEventListener("selectstart",this._selectStartEvt),this.controller.removeEventListener("selectend",this._selectEndEvt)),this.type===0&&(this.controller.removeEventListener("selectstart",this._selectStartEvt),this.controller.removeEventListener("selectend",this._selectEndEvt)),(t=this.hand)==null||t.clear(),(n=this.controllerGrip)==null||n.clear(),(i=this.controller)==null||i.clear()}onEnable(){var t,n,i,r,o;this.hand&&(this.hand.name="Hand"),this.controllerGrip&&(this.controllerGrip.name="ControllerGrip"),this.controller&&(this.controller.name="Controller"),this.raycastLine&&(this.raycastLine.name="RaycastLine;"),this.webXR.Controllers.indexOf(this)<0&&this.webXR.Controllers.push(this),this.raycastLine||(this.raycastLine=Vs.CreateRaycastLine()),this._raycastHitPoint||(this._raycastHitPoint=Vs.CreateRaycastHitPoint()),(t=this.webXR.Rig)==null||t.add(this.hand),(n=this.webXR.Rig)==null||n.add(this.controllerGrip),(i=this.webXR.Rig)==null||i.add(this.controller),(r=this.webXR.Rig)==null||r.add(this.raycastLine),(o=this.raycastLine)==null||o.add(this._raycastHitPoint),this._raycastHitPoint.visible=!1,this.hand.add(this.handPointerModel),Zy&&console.log("ADDED TO RIG",this.webXR.Rig)}onDisable(){var n,i,r,o,l;(n=this.hand)==null||n.removeFromParent(),(i=this.controllerGrip)==null||i.removeFromParent(),(r=this.controller)==null||r.removeFromParent(),(o=this.raycastLine)==null||o.removeFromParent(),(l=this._raycastHitPoint)==null||l.removeFromParent();const t=this.webXR.Controllers.indexOf(this);t>=0&&this.webXR.Controllers.splice(t,1)}onSourceConnected(t){if(this._isConnected){console.warn("Received connected event for controller that is already connected",this.index,t);return}this._isConnected=!0,this.input=t.data,this.type===1&&(this.onSelectStart(),this.createPointerEvent("down"))}onSourceDisconnected(t){if(!this._isConnected){console.warn("Received discnnected event for controller that is not connected",t);return}this._isConnected=!1,this.type===1&&(this.onSelectEnd(),this.createPointerEvent("up")),this.input=null}createPointerEvent(t){switch(t){case"down":this.context.input.createPointerDown({pointerId:this.index,clientX:0,clientY:0,button:this.index,pointerType:"touch"});break;case"move":break;case"up":this.context.input.createPointerUp({pointerId:this.index,clientX:0,clientY:0,button:this.index,pointerType:"touch"});break}}update(){this.context.time.frameCount%60===0&&(this.setControllerLayers(this.controller,2),this.setControllerLayers(this.controllerGrip,2),this.setControllerLayers(this.hand,2));const t=Vs.eventSubs.update;if(t&&t.length>0)for(const r of t)r(this);let n=1;this.type===0?n=this.context.time.deltaTime/.1:this.isUsingHands&&this.handPointerModel.pinched&&(n=this.context.time.deltaTime/.3),this.rayRotation.slerp(ga(this.controller),this.useSmoothing?n:1);const i=ni(this.controller);if(this.raycastLine)if(this.type===1)this.raycastLine.visible=!1;else if(this.isUsingHands){this.raycastLine.visible=!this.grabbed,sr(this.raycastLine,i);const r=this.hand.joints;if(r&&r.wrist&&this.grabbed&&this.grabbed.isCloseGrab){const l=this.getWristQuaternion();l&&this.rayRotation.copy(l)}Za(this.raycastLine,this.rayRotation)}else this.raycastLine.visible=!0,Za(this.raycastLine,this.rayRotation),sr(this.raycastLine,i);this.lastHit=this.updateLastHit(),this.grabbed&&this.grabbed.update(),this._selectionPressedLastFrame=this._selectionPressed,this.selectStartCallback&&this.selectStartCallback()}onUpdate(t){var r,o;if(this.lastHit=null,!t||t.inputSources.length<=this.index){this.input=null;return}if(this.type===0&&(this.input=t.inputSources[this.index]),!this.input)return;const n=this.webXR.Rig;if(!n)return;this._didNotEndSelection&&!this.handPointerModel.pinched&&(this._didNotEndSelection=!1,this.onSelectEnd()),this.updateStick(this.input);const i=(o=(r=this.input)==null?void 0:r.gamepad)==null?void 0:o.buttons;switch(this.input.handedness){case"left":const l=3*Vs.MovementSpeedFactor,h=2,u=Ci.clamp01(this.joystick.length()*2),f=this.joystick.x>0?1:-1;let g=Math.pow(this.joystick.x,h);g*=f,g*=u;const m=this.joystick.y>0?1:-1;let A=Math.pow(this.joystick.y,h);A*=m,g*=u,n.getWorldQuaternion(this.worldRot),this.movementVector.set(g,0,A),this.movementVector.applyQuaternion(this.webXR.TransformOrientation),this.movementVector.y=0,this.movementVector.applyQuaternion(this.worldRot),this.movementVector.multiplyScalar(l*this.context.time.deltaTime),n.position.add(this.movementVector),this.isUsingHands&&this.runTeleport(n,i);break;case"right":const v=this.joystick.x,b=Math.abs(v);if(b<.4)this.didRotate=!1;else if(b>.5&&!this.didRotate){const C=v>0?-1:1;n.rotateY(Ci.toRadians(30*C)),this.didRotate=!0}this.runTeleport(n,i);break}}runTeleport(t,n){var h,u,f;let i=-this.joystick.y;if(((h=this.hand)==null?void 0:h.visible)&&!this.grabbed){const g=this.handPointerModel.isPinched();g&&this._pinchStartTime===void 0&&(this._pinchStartTime=this.context.time.time),g&&this._pinchStartTime&&this.context.time.time-this._pinchStartTime>.8&&(i=this.handPointerModel.isPinched()?1:0),g||(this._pinchStartTime=void 0)}else this._pinchStartTime=void 0;let r=i>.5&&this.webXR.IsInVR,o=this.webXR.Rig?((f=(u=this.webXR.Rig)==null?void 0:u.scale)==null?void 0:f.x)<.999:!1,l=null;if(n&&this.input&&!this.input.hand)for(let g=0;g<n.length;g++){const m=n[g];if(g===4)if(m.pressed&&!this.didChangeScale&&this.webXR.IsInVR){this.didChangeScale=!0;const A=this.webXR.Rig;if(A)if(o){o=!1,A.scale.set(1,1,1),l=1,Vs.MovementSpeedFactor=1;const v=this.context.mainCamera;Vs.PreviousCameraFarDistance&&(v.far=Vs.PreviousCameraFarDistance)}else{o=!0,r=!0,l=.1,Vs.MovementSpeedFactor=l*2;const v=this.context.mainCamera;Vs.PreviousCameraFarDistance=v.far,v.far/=l}}else m.pressed||(this.didChangeScale=!1)}if(r){if(!this.didTeleport){const g=this.raycast();if(this.didTeleport=!0,g&&g.length>0){const m=g[0];if(o||this.isValidTeleportTarget(m.object)){const A=m.point;sr(t,A)}}}}else i<.1&&(this.didTeleport=!1);l!==null&&(t.scale.set(l,l,l),t.updateMatrixWorld())}isValidTeleportTarget(t){return Ee.getComponentInParent(t,vM)!=null}updateStick(t){var n;!t||!t.gamepad||((n=t.gamepad.axes)==null?void 0:n.length)<4||(this.joystick.x=t.gamepad.axes[2],this.joystick.y=t.gamepad.axes[3])}updateLastHit(){var r,o;const t=this.raycast(),n=t?t[0]:null;this.lastHit=n;let i=1;if(this.webXR.Rig&&(i/=this.webXR.Rig.scale.x),this.raycastLine){this.raycastLine.scale.z=i*((o=(r=this.lastHit)==null?void 0:r.distance)!=null?o:9999);const l=this.raycastLine.material;n!=null?l.color=Vs.raycastColor:l.color=Vs.raycastNoHitColor}if(this._raycastHitPoint){if(this.lastHit!=null){this._raycastHitPoint.position.z=-1;const l=Ci.clamp(this.lastHit.distance*.01*i,.015,.1);this._raycastHitPoint.scale.set(l,l,l)}this._raycastHitPoint.visible=this.lastHit!==null&&this.lastHit!==void 0}return n}onSelectStart(){!this.context.connection.allowEditing||(this.selectStartCallback=()=>this.onHandleSelectStart())}onHandleSelectStart(){this.selectStartCallback=null,this._selectionPressed=!0,this._selectionStartTime=this.context.time.time,this._selectionEndTime=1e3;let t=null,n=!1;if(this.isUsingHands?(t=this.overlap(),t.length<=0?(t=this.raycast(),n=!1):n=!0):t=this.raycast(),t&&t.length>0)for(const i of t){const r=i.object;if(!this.testIsVisible(r)){Zy&&console.log("not visible");continue}this.lastSelectStartObject=r;const o={selected:r,grab:r},l=Vs.eventSubs["select-start"];if(l&&l.length>0)for(const h of l)h(this,o);o.grab!==r&&Zy&&console.log("Grabbed object changed","original",r,"new",o.grab),o.grab&&(this.grabbed=fa.TryTake(this,o.grab,i,n));break}else{const i=Vs.eventSubs["select-start"],r={selected:null,grab:null};if(i&&i.length>0)for(const o of i)o(this,r)}}onSelectEnd(){var i,r;if(this.isUsingHands&&this.handPointerModel.pinched){this._didNotEndSelection=!0;return}if(!this._selectionPressed)return;this.selectStartCallback=null,this._selectionPressed=!1,this._selectionEndTime=this.context.time.time;const t={grab:(r=(i=this.grabbed)==null?void 0:i.selected)!=null?r:this.lastSelectStartObject},n=Vs.eventSubs["select-end"];if(n&&n.length>0)for(const o of n)o(this,t);this.grabbed&&(this.grabbed.free(),this.grabbed=null)}testIsVisible(t){return t?Ee.isActiveInHierarchy(t):!0}setControllerLayers(t,n){var i,r;if(!!t&&(t.layers.set(n),t.children))for(const o of t.children)((i=this.grabbed)==null?void 0:i.selected)===o||((r=this.grabbed)==null?void 0:r.selectedMesh)===o||this.setControllerLayers(o,n)}getRay(){const t=new Vu;return t.origin.copy(ni(this.controller)),t.direction.set(0,0,-1).applyQuaternion(this.rayRotation),t}overlap(){const t=this.isUsingHands&&this.handPointerModel?this.handPointerModel.pointerObject:this.controllerGrip;if(!t)return new Array;const n=ni(t).clone();return this.context.physics.sphereOverlap(n,.02)}raycast(){const t=new nc;return t.layerMask=new Ka,t.layerMask.set(0),t.ray=this.getRay(),this.context.physics.raycast(t)}};let Zi=Vs;x(Zi,"Factory",new WZ),x(Zi,"raycastColor",new ye(.9,.3,.3)),x(Zi,"raycastNoHitColor",new ye(.6,.6,.6)),x(Zi,"geometry",new Sn().setFromPoints([new q(0,0,0),new q(0,0,-1)])),x(Zi,"handModels",{}),x(Zi,"eventSubs",{}),x(Zi,"PreviousCameraFarDistance"),x(Zi,"MovementSpeedFactor",1);var SE=(a=>(a.WillTake="WillTake",a.DidTake="DidTake",a.WillFree="WillFree",a.DidFree="DidFree",a))(SE||{});const Mr=class{constructor(){x(this,"sync",null);x(this,"selected",null);x(this,"selectedParent",null);x(this,"selectedMesh",null);x(this,"controller",null);x(this,"grabTime",0);x(this,"grabUUID","");x(this,"isCloseGrab",!1);x(this,"originalMaterial",null);x(this,"usageMarker",null);x(this,"rigidbodies",null);x(this,"didReparent",!1);x(this,"grabDistance",0);x(this,"interactable",null);x(this,"positionSource",null);x(this,"grabPoint",new q);x(this,"localPositionOffsetToGrab",null);x(this,"localPositionOffsetToGrab_worldSpace",new q);x(this,"localQuaternionToGrab",new kt(0,0,0,1));x(this,"targetDir",null);x(this,"quaternionLerp",null);x(this,"controllerDir",new q);x(this,"controllerWorldPos",new q);x(this,"lastControllerWorldPos",new q);x(this,"controllerPosDelta",new q);x(this,"totalChangeAlongDirection",0);x(this,"rigPositionLastFrame",new q)}static AddEventListener(e,t){return Mr.Events[e]||(Mr.Events[e]=[]),Mr.Events[e].push(t),t}static RemoveEventListener(e,t){if(!t||!Mr.Events[e])return;const n=Mr.Events[e].indexOf(t);n>=0&&Mr.Events[e].splice(n,1)}static Register(e){this.Current.find(t=>t===e)||this.Current.push(e)}static Remove(e){const t=this.Current.indexOf(e);t>=0&&this.Current.splice(t,1)}static TryTake(e,t,n,i){const r=Ee.getComponentInParent(t,nA);if(!r)return Zy&&console.warn("Prevented taking object that is not interactable",t),null;let o=t;const l=Ee.getComponentInParent(t,oh);l&&(l.requestOwnership(),o=l.gameObject);for(const u of this.Current)if(u.selected===o)return u.controller===e||(u.free(),u.Take(e,o,t,l,r,n,i)),u;const h=new Mr;return h.Take(e,o,t,l,r,n,i),h}Take(e,t,n,i,r,o,l){var A,v;if(console.assert(t!==null,"Expected object to be taken but was",t),e.isUsingHands?this.positionSource=l?e.wrist:e.controller:this.positionSource=e.controller,!this.positionSource)return console.warn("No position source"),this;const h={controller:e,take:t,hit:n,sync:i,interactable:r};(A=Mr.Events.WillTake)==null||A.forEach(b=>b(this,h));const u=n;u!=null&&u.material&&(this.originalMaterial=u.material,Array.isArray(u.material)||(u.material=u.material.clone(),u.material&&u.material.emissive&&(u.material.emissive.b=.2))),this.selected=t,this.selectedParent||(this.selectedParent=t.parent),this.selectedMesh=u,this.controller=e,this.interactable=r,this.isCloseGrab=l,this.didReparent=!1,this.sync=i,this.grabTime=e.context.time.time,this.grabUUID=Date.now().toString(),this.usageMarker=Ee.addNewComponent(this.selected,iA),this.rigidbodies=Ee.getComponentsInChildren(this.selected,yr),ni(this.positionSource,this.lastControllerWorldPos);const f=()=>l?this.lastControllerWorldPos.clone():o.point.clone();this.grabDistance=f().distanceTo(this.lastControllerWorldPos),this.totalChangeAlongDirection=0,this.localPositionOffsetToGrab=this.selected.worldToLocal(f());const g=e.isUsingHands&&l?this.controller.getWristQuaternion().clone():e.rayRotation.clone();ga(this.selected,this.localQuaternionToGrab).premultiply(g.invert());const m=this.controller.webXR.Rig;return m&&this.rigPositionLastFrame.copy(ni(m)),Qr.Add(e.context,this.selected),Mr.Register(this),this.sync&&(this.sync.fastMode=!0),(v=Mr.Events.DidTake)==null||v.forEach(b=>b(this,h)),this}free(){var i,r,o,l;if(!this.selected)return;const e={controller:this.controller,take:this.selected,hit:this.selected,sync:this.sync,interactable:null};(i=Mr.Events.WillFree)==null||i.forEach(h=>h(this,e)),Qr.Remove(this.controller.context,this.selected),Mr.Remove(this),this.sync&&(this.sync.fastMode=!1);const t=this.selectedMesh;t&&this.originalMaterial&&t.material&&(t.material=this.originalMaterial);const n=this.selected;if(this.didReparent&&n.parent){const h=this.selectedParent;h?h.attach(n):(r=this.controller)==null||r.context.scene.attach(n)}if((o=this.usageMarker)==null||o.destroy(),this.controller&&(this.controller.grabbed=null),this.selected=null,this.selectedParent=null,this.selectedMesh=null,this.sync=null,this.rigidbodies)for(const h of this.rigidbodies)h.wakeUp(),h.smoothedVelocity&&h.setVelocity(h.smoothedVelocity.x,h.smoothedVelocity.y,h.smoothedVelocity.z);this.rigidbodies=null,this.localPositionOffsetToGrab=null,this.quaternionLerp=null,(l=Mr.Events.DidFree)==null||l.forEach(h=>h(this,e))}controllerMovementSinceLastFrame(){if(!this.positionSource||!this.controller)return 0;this.controllerDir.set(0,0,-1),this.controllerDir.applyQuaternion(this.controller.rayRotation),ni(this.positionSource,this.controllerWorldPos),this.controllerPosDelta.copy(this.controllerWorldPos),this.controllerPosDelta.sub(this.lastControllerWorldPos),this.lastControllerWorldPos.copy(this.controllerWorldPos);const e=this.controller.webXR.Rig;if(e){const n=ni(e),i=this.rigPositionLastFrame.sub(n);this.controllerPosDelta.add(i),this.rigPositionLastFrame.copy(n)}return this.controllerDir.dot(this.controllerPosDelta)}update(){var e,t;if(this.sync&&this.controller&&this.controller.context.connection.isInRoom&&this.controller.context.time.time-this.grabTime>3&&this.sync.hasOwnership()===!1&&(console.log("no ownership, will leave",this.sync.guid),this.free()),!(this.interactable&&!this.interactable.canGrab)){if(!this.didReparent&&this.selected&&this.controller){const n=(t=(e=this.controller.webXR.Rig)==null?void 0:e.scale.x)!=null?t:1;this.totalChangeAlongDirection+=this.controllerMovementSinceLastFrame();let i=1;this.controller.type===0&&(i=Math.max(0,1+this.totalChangeAlongDirection*2/n),i=i*i*i),this.grabDistance/n<.8&&(i=1),this.targetDir||(this.targetDir=new q),this.targetDir.set(0,0,-this.grabDistance*i);const r=this.targetDir.applyQuaternion(this.controller.rayRotation).add(this.controllerWorldPos),o=this.controller.rayRotation.clone().multiplyQuaternions(this.controller.rayRotation,this.localQuaternionToGrab);this.quaternionLerp||(this.quaternionLerp=o.clone()),this.quaternionLerp.slerp(o,this.controller.useSmoothing?this.controller.context.time.deltaTime/.03:1),Za(this.selected,this.quaternionLerp),this.selected.updateWorldMatrix(!1,!1),this.grabPoint.copy(r),this.localPositionOffsetToGrab&&(this.localPositionOffsetToGrab_worldSpace.copy(this.localPositionOffsetToGrab),this.selected.localToWorld(this.localPositionOffsetToGrab_worldSpace).sub(ni(this.selected)),r.sub(this.localPositionOffsetToGrab_worldSpace)),sr(this.selected,r)}if(this.rigidbodies!=null)for(const n of this.rigidbodies)n.wakeUp(),n.setBodyFromGameObject({x:0,y:0,z:0});Pr.markDirty(this.selected,!0)}}};let fa=Mr;x(fa,"Events",{}),x(fa,"Current",[]);var a$=Object.defineProperty,c$=Object.getOwnPropertyDescriptor,uF=(a,e,t,n)=>{for(var i=n>1?void 0:n?c$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&a$(e,t,i),i};class ip extends pt{constructor(){super(...arguments);x(this,"webAR",null);x(this,"invertForward",!1);x(this,"_initalMatrix",new fn);x(this,"_selectStartFn",this.onSelectStart.bind(this));x(this,"_selectEndFn",this.onSelectEnd.bind(this));x(this,"_arScale",5);x(this,"_rig",null);x(this,"_startPose",null);x(this,"_placementPose",null);x(this,"_isTouching",!1);x(this,"_rigStartPose",null)}get rig(){var t;return(t=this.webAR)==null?void 0:t.webxr.Rig}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.setScale(t))}start(){const t=Ee.findObjectOfType(_i);t&&(t.Rig.updateMatrix(),this._initalMatrix.copy(t.Rig.matrix))}onBegin(t){var n;this._placementPose=null,this.gameObject.visible=!1,this.gameObject.matrixAutoUpdate=!1,this._startPose=this.gameObject.matrix.clone(),this._rigStartPose=(n=this.rig)==null?void 0:n.matrix.clone(),t.addEventListener("selectstart",this._selectStartFn),t.addEventListener("selectend",this._selectEndFn),this.gameObject.visible=!1,this.rig&&(this.rig.matrixAutoUpdate=!0,this._initalMatrix.decompose(this.rig.position,this.rig.quaternion,this.rig.scale))}onUpdate(t,n,i){return i&&!this._placementPose&&this._isTouching?(this.webAR&&this.webAR.setReticleActive(!1),this.placeAt(t,new fn().fromArray(i.transform.matrix).invert()),!0):!1}placeAt(t,n){if(this._placementPose||(this._placementPose=new fn),this._placementPose.copy(n),t){if(this.invertForward){const i=new fn().makeRotationY(Math.PI);this._placementPose.premultiply(i)}this._rig=t,this.setScale(this.arScale)}else this._rig=null;this.gameObject.visible=!0}onEnd(t,n){this._placementPose=null,this.gameObject.visible=!1,this.gameObject.matrixAutoUpdate=!1,this._startPose&&this.gameObject.matrix.copy(this._startPose),t&&(t.matrixAutoUpdate=!0,this._rigStartPose&&this._rigStartPose.decompose(t.position,t.quaternion,t.scale)),Pr.markDirty(this.gameObject,!0),setTimeout(()=>{this.gameObject.matrixAutoUpdate=!0,this.gameObject.visible=!0},100)}onSelectStart(){this._isTouching=!0}onSelectEnd(){this._isTouching=!1}setScale(t){const n=this._rig;!n||!this._placementPose||(this._rigStartPose||(this._rigStartPose=n.matrix.clone()),n.matrixAutoUpdate=!1,n.matrix.multiplyMatrices(new fn().makeScale(t,t,t),this._placementPose),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(),console.log("Place",n.position))}}uF([we()],ip.prototype,"invertForward",2);uF([we()],ip.prototype,"arScale",1);class xM extends pt{awake(){}}const iu=Ct("debugaddressables");class l${constructor(e){x(this,"_context");x(this,"_assetReferences",{});this._context=e,this._context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.uri&&(this._assetReferences[e.uri]?console.warn("Asset reference already registered",e):this._assetReferences[e.uri]=e),e}}class Ho{constructor(e){x(this,"_loading");x(this,"_asset");x(this,"_glbRoot");x(this,"_uri");x(this,"_progressListeners",[]);x(this,"_isLoadingRawBinary",!1);x(this,"_rawBinary");this._uri=e,B9(this._uri,this.onResolvePrefab.bind(this))}static getOrCreate(e,t,n){const i=Kg(e,t);iu&&console.log("GetOrCreate Addressable from",e,t,"FinalPath=",i);const r=n.addressables,o=r.findAssetReference(i);if(o)return o;const l=new Ho(i);return r.registerAssetReference(l),l}get asset(){var e;return(e=this._glbRoot)!=null?e:this._asset}set asset(e){this._asset=e}get uri(){return this._uri}get rawAsset(){return this._asset}async onResolvePrefab(e){return e===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(iu&&console.log("Unload",this.asset),this.asset.scene?Ee.destroy(this.asset.scene):Ee.destroy(this.asset)),this.asset=null}async preload(){var t;if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,iu&&console.log("Preload",this.uri);const e=await _Z(this.uri,n=>{this.raiseProgressEvent(n)});return this._rawBinary=(t=e==null?void 0:e.buffer)!=null?t:null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(e){if(!this.mustLoad)return;if(e&&this._progressListeners.push(e),this._loading!==void 0)return this._loading;const t=ui.Current;this._rawBinary?(this._loading=Sx(t,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(iu&&console.log("Load async",this.uri),this._loading=vA(t,this.uri,null,!0,i=>{this.raiseProgressEvent(i)}));const n=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(n),this._loading=void 0,n)return pg(t),n.scene!==void 0&&(this.asset=n),this.asset}async instantiate(e){return this.onInstantiate(e,!1)}async instantiateSynced(e,t=!0){return this.onInstantiate(e,!0,t)}beginListenDownload(e){this._progressListeners.indexOf(e)<0&&this._progressListeners.push(e)}endListenDownload(e){const t=this._progressListeners.indexOf(e);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(e){for(const t of this._progressListeners)t(this,e)}async onInstantiate(e,t=!1,n){const i=ui.Current;if(e||(e=i.scene),this.mustLoad&&await this.loadAssetAsync(),iu&&console.log("Instantiate",this.uri,"parent:",e),this.asset){iu&&console.log("Add to scene",this.asset);let r=e instanceof Go?e:null;if(r||(r=new Go),typeof e=="object"&&(e instanceof Ft?r.parent=e:Object.assign(r,e)),t){r.context=i;const o=this.asset;o.guid=this.uri;const l=GD(o,r,void 0,n);if(l)return l}else{const o=Ee.instantiate(this.asset,r);if(o)return o}}else iu&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(e){if(e&&e.scene){const t=e.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}}class h$ extends $g{constructor(){super([Ho])}onSerialize(e,t){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,t){return typeof e=="string"?t.context?t.gltfId?Ho.getOrCreate(t.gltfId,e,t.context):(console.error("Missing spurce id"),null):(console.error("Missing context"),null):null}}new h$;class Tf{constructor(){x(this,"bb",null);x(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}w(){return this.bb.readFloat32(this.bb_pos+12)}static sizeOf(){return 16}static createVec4(e,t,n,i,r){return e.prep(4,16),e.writeFloat32(r),e.writeFloat32(i),e.writeFloat32(n),e.writeFloat32(t),e.offset()}}class fr{constructor(){x(this,"bb",null);x(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsVrUserStateBuffer(e,t){return(t||new fr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsVrUserStateBuffer(e,t){return e.setPosition(e.position()+Vv),(t||new fr).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}time(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}avatarId(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}position(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new po).__init(this.bb_pos+t,this.bb):null}rotation(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new Tf).__init(this.bb_pos+t,this.bb):null}scale(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readFloat32(this.bb_pos+e):0}posLeftHand(e){const t=this.bb.__offset(this.bb_pos,16);return t?(e||new po).__init(this.bb_pos+t,this.bb):null}posRightHand(e){const t=this.bb.__offset(this.bb_pos,18);return t?(e||new po).__init(this.bb_pos+t,this.bb):null}rotLeftHand(e){const t=this.bb.__offset(this.bb_pos,20);return t?(e||new Tf).__init(this.bb_pos+t,this.bb):null}rotRightHand(e){const t=this.bb.__offset(this.bb_pos,22);return t?(e||new Tf).__init(this.bb_pos+t,this.bb):null}static startVrUserStateBuffer(e){e.startObject(10)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addTime(e,t){e.addFieldInt64(1,t,e.createLong(0,0))}static addAvatarId(e,t){e.addFieldOffset(2,t,0)}static addPosition(e,t){e.addFieldStruct(3,t,0)}static addRotation(e,t){e.addFieldStruct(4,t,0)}static addScale(e,t){e.addFieldFloat32(5,t,0)}static addPosLeftHand(e,t){e.addFieldStruct(6,t,0)}static addPosRightHand(e,t){e.addFieldStruct(7,t,0)}static addRotLeftHand(e,t){e.addFieldStruct(8,t,0)}static addRotRightHand(e,t){e.addFieldStruct(9,t,0)}static endVrUserStateBuffer(e){return e.endObject()}static finishVrUserStateBufferBuffer(e,t){e.finish(t)}static finishSizePrefixedVrUserStateBufferBuffer(e,t){e.finish(t,void 0,!0)}}const HB=Ct("debugxr"),Mm=Ct("debugavatar"),wM="VRUS";aM(wM,fr.getRootAsVrUserStateBuffer);function ME(){return new Date().getTime()}function u$(a){let e=a&4294967295,t=a/Math.pow(2,32)&1048575;return Ya.create(e,t)}const ng=class{constructor(e){x(this,"guid");x(this,"time");x(this,"avatarId");x(this,"position",new q);x(this,"rotation",new Bn);x(this,"scale",1);x(this,"posLeftHand",new q);x(this,"posRightHand",new q);x(this,"rotLeftHand",new kt);x(this,"rotRightHand",new kt);this.guid=e}update(e,t,n,i,r){var f,g,m,A,v,b;this.time=ME(),this.avatarId=r,this.position.set(t.x,t.y,t.z),e&&this.position.applyMatrix4(e.matrixWorld);let o=ng.quat0;const l=ng.quat1;o.set(n.x,n.y,n.z,n.w),o=o.multiplyQuaternions(o,ng.invertRotation),e&&(e.getWorldQuaternion(l),o.multiplyQuaternions(l,o)),this.rotation.set(o.x,o.y,o.z,o.w),this.scale=e.scale.x;const h=(f=i.LeftController)==null?void 0:f.controllerGrip;h&&(h.getWorldPosition(this.posLeftHand),h.getWorldQuaternion(this.rotLeftHand));const u=(g=i.RightController)==null?void 0:g.controllerGrip;if(u&&(u.getWorldPosition(this.posRightHand),u.getWorldQuaternion(this.rotRightHand)),(A=(m=i.LeftController)==null?void 0:m.hand)!=null&&A.visible){const C=i.LeftController.wrist;C&&(C.getWorldPosition(this.posLeftHand),C.getWorldQuaternion(this.rotLeftHand))}if((b=(v=i.RightController)==null?void 0:v.hand)!=null&&b.visible){const C=i.RightController.wrist;C&&(C.getWorldPosition(this.posRightHand),C.getWorldQuaternion(this.rotRightHand))}}sendAsBuffer(e,t){e.clear();const n=e.createString(this.guid),i=e.createString(this.avatarId);fr.startVrUserStateBuffer(e),fr.addGuid(e,n),fr.addTime(e,u$(this.time)),fr.addAvatarId(e,i),fr.addPosition(e,po.createVec3(e,this.position.x,this.position.y,this.position.z)),fr.addRotation(e,Tf.createVec4(e,this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)),fr.addScale(e,this.scale),fr.addPosLeftHand(e,po.createVec3(e,this.posLeftHand.x,this.posLeftHand.y,this.posLeftHand.z)),fr.addPosRightHand(e,po.createVec3(e,this.posRightHand.x,this.posRightHand.y,this.posRightHand.z)),fr.addRotLeftHand(e,Tf.createVec4(e,this.rotLeftHand.x,this.rotLeftHand.y,this.rotLeftHand.z,this.rotLeftHand.w)),fr.addRotRightHand(e,Tf.createVec4(e,this.rotRightHand.x,this.rotRightHand.y,this.rotRightHand.z,this.rotRightHand.w));const r=fr.endVrUserStateBuffer(e);e.finish(r,wM);const o=e.asUint8Array();t.sendBinary(o)}setFromBuffer(e,t){if(!e)return;this.guid=e,this.time=t.time().toFloat64();const n=t.avatarId();n&&(this.avatarId=n);const i=t.position();i&&this.position.set(i.x(),i.y(),i.z());const r=t.rotation();r&&this.rotation.set(r.x(),r.y(),r.z(),r.w());const o=t.posLeftHand();o&&this.posLeftHand.set(o.x(),o.y(),o.z());const l=t.posRightHand();l&&this.posRightHand.set(l.x(),l.y(),l.z());const h=t.rotLeftHand();h&&this.rotLeftHand.set(h.x(),h.y(),h.z(),h.w());const u=t.rotRightHand();u&&this.rotRightHand.set(u.x(),u.y(),u.z(),u.w()),this.scale=t.scale()}};let Ha=ng;x(Ha,"invertRotation",new kt().setFromAxisAngle(new q(0,1,0),Math.PI)),x(Ha,"quat0",new kt),x(Ha,"quat1",new kt);class H_ extends pt{constructor(){super(...arguments);x(this,"webXR",null);x(this,"debugAvatarUser",null);x(this,"voip",null);x(this,"tempState",new Ha(""));x(this,"_removeAvatarsList",[]);x(this,"eventSub_ConnectionEvent",null);x(this,"eventSub_WebXRStartEvent",null);x(this,"eventSub_WebXREndEvent",null);x(this,"eventSub_WebXRUpdateEvent",null);x(this,"avatars",{});x(this,"localAvatar",null);x(this,"k_LocalAvatarNoNetworkingGuid","local");x(this,"ownership",null);x(this,"xrState",null);x(this,"builder",new tp(1024))}async awake(){if(this.webXR||(this.webXR=this.gameObject.getComponent(_i)),this.webXR||(this.webXR=Ee.findObjectOfType(_i,this.context)),!this.webXR&&(console.log("Missing webxr component"),this.webXR=Ee.findObjectOfType(_i,this.context),!this.webXR)){console.error("Could not find webxr component");return}if(this.voip||(this.voip=Ee.findObjectOfType(yh,this.context)),Mm){const t="debug-avatar-"+Mm,n=new zc(this.context,t,this.webXR);if(this.debugAvatarUser=n,typeof Mm=="string"&&Mm.length>0)if(await n.setAvatarOverride(Mm)){const i=new Ha(t);i.position.y+=1;const r=.5;i.posLeftHand.y+=r,i.posLeftHand.x+=r,i.posRightHand.y+=r,i.posRightHand.x-=r,n.tryUpdate(i,0)}else n.destroy()}}onEnable(){if(!this.webXR&&(this.webXR=Ee.getComponent(this.gameObject,_i),!this.webXR)){console.warn("Missing webxr component on "+this.gameObject.name);return}this.eventSub_WebXRStartEvent=this.onXRSessionStart.bind(this),_i.addEventListener(tr.XRStarted,this.eventSub_WebXRStartEvent),this.eventSub_WebXRUpdateEvent=this.onXRSessionUpdate.bind(this),_i.addEventListener(tr.XRUpdate,this.eventSub_WebXRUpdateEvent),this.eventSub_WebXREndEvent=this.onXRSessionEnded.bind(this),_i.addEventListener(tr.XRStopped,this.eventSub_WebXREndEvent),this.eventSub_ConnectionEvent=this.onConnected.bind(this),this.context.connection.beginListen(Ds.JoinedRoom,this.eventSub_ConnectionEvent),this.context.connection.beginListen("webxr-user-joined",t=>{console.log("webxr user joined evt")}),this.context.connection.beginListen("webxr-user-left",t=>{const n=t.id!==null&&t.id!==void 0;if(!!n&&(console.log("webxr user left evt"),n)){const i=this.avatars[t.id];i==null||i.destroy(),this.avatars[t.id]=void 0}}),this.context.connection.beginListenBinrary(wM,t=>{const n=t.guid();if(!n)return;const i=t.time().toFloat64(),r=this.tempState;r.setFromBuffer(n,t);const o=this.onTryGetAvatar(n,i);o==null||o.tryUpdate(r,i)}),this.context.connection.beginListen("vr-session-update",t=>{const n=t.guid,i=t.time,r=this.onTryGetAvatar(n,i);r==null||r.tryUpdate(t,i)})}onTryGetAvatar(t,n){if(t===this.context.connection.connectionId)return null;const i=new Date().getTime()-n;if(i>5e3)return HB&&console.log("old data",i,t),null;let r=this.avatars[t];if(r===void 0)try{console.log("create new avatar");const o=new zc(this.context,t,this.webXR);r=o,this.avatars[t]=o}catch(o){this.avatars[t]=null,console.error(o)}return r}onDisable(){this.eventSub_ConnectionEvent&&this.context.connection.stopListening(Ds.JoinedRoom,this.eventSub_ConnectionEvent),_i.removeEventListener(tr.XRStarted,this.eventSub_WebXRStartEvent),_i.removeEventListener(tr.XRUpdate,this.eventSub_WebXRUpdateEvent),_i.removeEventListener(tr.XRStopped,this.eventSub_WebXREndEvent)}update(){const t=ME();this.debugAvatarUser&&(this.debugAvatarUser.lastUpdate=t),this.detectPotentiallyDisconnectedAvatarsAndRemove();for(const n in this.avatars){const i=this.avatars[n];!i||i.update()}}detectPotentiallyDisconnectedAvatarsAndRemove(){const t=ME();for(const n in this.avatars){const i=this.avatars[n];if(!i){this._removeAvatarsList.push(n);continue}t-i.lastUpdate>1e4&&(console.log("avatar timed out (didnt receive any updates in  a while) - destroying it now"),i.destroy(),this.avatars[n]=void 0)}for(const n of this._removeAvatarsList)delete this.avatars[n];this._removeAvatarsList.length=0}buildLocalAvatar(){var n,i;if(this.localAvatar)return;const t=(i=(n=this.context.connection)==null?void 0:n.connectionId)!=null?i:this.k_LocalAvatarNoNetworkingGuid;this.localAvatar=new zc(this.context,t,this.webXR),this.localAvatar.isLocalAvatar=!0,this.localAvatar.setAvatarOverride(this.getAvatarId()),this.avatars[this.localAvatar.guid]=this.localAvatar}onConnected(){var t,n,i;HB&&console.log("Hey you are connected as "+this.context.connection.connectionId),((t=this.localAvatar)==null?void 0:t.guid)===this.k_LocalAvatarNoNetworkingGuid&&(this.localAvatar&&((n=this.localAvatar)==null||n.destroy(),this.avatars[this.localAvatar.guid]=void 0),this.localAvatar=null,this.xrState=null,(i=this.ownership)==null||i.freeOwnership(),this.ownership=null)}onXRSessionStart(t){var n,i,r;if(console.log("XR session started"),this.context.connection.send("webxr-user-joined",{id:this.context.connection.connectionId,mode:"vr"}),this.localAvatar&&((n=this.localAvatar)==null||n.destroy(),this.avatars[this.localAvatar.guid]=void 0,this.localAvatar=null),this.xrState=null,(i=this.ownership)==null||i.freeOwnership(),this.ownership=null,this.avatars)for(const o in this.avatars)(r=this.avatars[o])==null||r.updateFlags()}onXRSessionEnded(t){console.log("XR session ended"),this.context.connection.send("webxr-user-left",{id:this.context.connection.connectionId,mode:"vr"})}onXRSessionUpdate(t){var f,g,m,A,v;(g=this.xrState)!=null||(this.xrState=new Ha((f=this.context.connection.connectionId)!=null?f:this.k_LocalAvatarNoNetworkingGuid)),(A=this.ownership)!=null||(this.ownership=new cM(this.context.connection,(m=this.context.connection.connectionId)!=null?m:this.k_LocalAvatarNoNetworkingGuid)),this.ownership.guid=(v=this.context.connection.connectionId)!=null?v:this.k_LocalAvatarNoNetworkingGuid,this.buildLocalAvatar();const{frame:n,xr:i,rig:r}=t,o=n.getViewerPose(i.getReferenceSpace());if(!o)return;const l=o==null?void 0:o.transform,h=l.position,u=l.orientation;this.xrState.update(r,h,u,this.webXR,this.getAvatarId()),this.localAvatar&&(this.context.connection.connectionId&&(this.localAvatar.guid=this.context.connection.connectionId),this.localAvatar.tryUpdate(this.xrState,0)),!(this.ownership&&!this.ownership.hasOwnership&&this.context.connection.isConnected&&(this.context.time.frameCount%120===0&&this.ownership.requestOwnership(),!this.ownership.hasOwnership))&&(!this.context.connection.isConnected||!this.context.connection.connectionId||this.xrState.sendAsBuffer(this.builder,this.context.connection))}getAvatarId(){const t=Ct("avatar");return t!=null?t:null}}var d$=Object.defineProperty,f$=Object.getOwnPropertyDescriptor,p$=(a,e,t,n)=>{for(var i=n>1?void 0:n?f$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&d$(e,t,i),i};async function m$(){return"xr"in navigator?await navigator.xr.isSessionSupported("immersive-ar")===!0:!1}async function g$(){return"xr"in navigator?await navigator.xr.isSessionSupported("immersive-vr")===!0:!1}let TE=!1,IE=!1;m$().then(a=>TE=a);g$().then(a=>IE=a);var tr=(a=>(a.XRStarted="xrStarted",a.XRStopped="xrStopped",a.XRUpdate="xrUpdate",a.RequestVRSession="requestVRSession",a))(tr||{}),Vy;const er=(Vy=class extends pt{constructor(){super(...arguments);x(this,"enableVR",!0);x(this,"enableAR",!0);x(this,"defaultAvatar");x(this,"createVRButton",!0);x(this,"createARButton",!0);x(this,"controllers",[]);x(this,"rig");x(this,"isInit",!1);x(this,"_requestedAR",!1);x(this,"_requestedVR",!1);x(this,"_isInAR",!1);x(this,"_isInVR",!1);x(this,"_arButton");x(this,"_vrButton");x(this,"webAR",null);x(this,"_transformOrientation",new kt);x(this,"_currentHeadPose",null);x(this,"_originalCameraParent",null);x(this,"_originalCameraPosition",new q);x(this,"_originalCameraRotation",new kt);x(this,"xrMirrorWindow",null)}static get IsInWebXR(){return this._isInXr}static get XRSupported(){return"xr"in navigator&&(TE||IE)}static get IsARSupported(){return TE}static get IsVRSupported(){return IE}static addEventListener(e,t){return this.events.addEventListener(e,t),t}static removeEventListener(e,t){return this.events.removeEventListener(e,t),t}static createVRButton(e,t){var i;er.XRSupported||console.warn("WebXR is not supported on this device");const n=jm.createButton(e.context.renderer);return n.classList.add("webxr-ar-button"),n.classList.add("webxr-button"),this.resetButtonStyles(n),((i=t==null?void 0:t.registerClick)==null||i)&&n.addEventListener("click",e.onClickedVRButton.bind(e)),n}static createARButton(e,t){var o,l;const n=(o=e.webAR)==null?void 0:o.getAROverlayContainer(),i={};n&&(i.domOverlay={root:n},i.optionalFeatures=["hit-test","dom-overlay"]);const r=TZ.createButton(e.context.renderer,i);return r.classList.add("webxr-ar-button"),r.classList.add("webxr-button"),er.resetButtonStyles(r),((l=t==null?void 0:t.registerClick)==null||l)&&r.addEventListener("click",e.onClickedARButton.bind(e)),r}static resetButtonStyles(e){!e||(e.style.position="",e.style.bottom="",e.style.left="")}endSession(){const e=this.context.renderer.xr.getSession();e&&e.end()}get Rig(){return this.rig||this.ensureRig(),this.rig}get Controllers(){return this.controllers}get LeftController(){var e,t;return this.controllers.length>0&&((e=this.controllers[0].input)==null?void 0:e.handedness)==="left"?this.controllers[0]:this.controllers.length>1&&((t=this.controllers[1].input)==null?void 0:t.handedness)==="left"?this.controllers[1]:null}get RightController(){var e,t;return this.controllers.length>0&&((e=this.controllers[0].input)==null?void 0:e.handedness)==="right"?this.controllers[0]:this.controllers.length>1&&((t=this.controllers[1].input)==null?void 0:t.handedness)==="right"?this.controllers[1]:null}get ARButton(){return this._arButton}get VRButton(){return this._vrButton}get IsInVR(){return this._isInVR}get IsInAR(){return this._isInAR}awake(){var e;if(this.defaultAvatar&&typeof this.defaultAvatar=="string"&&(this.defaultAvatar=Ho.getOrCreate((e=this.sourceId)!=null?e:"/",this.defaultAvatar,this.context)),!Ee.findObjectOfType(H_,this.context)){const t=Ee.addNewComponent(this.gameObject,H_,!1);t.webXR=this}}onEnable(){if(this.isInit||!this.enableAR&&!this.enableVR)return;this.isInit=!0,this.context.renderer.xr.enabled=!0,this.webAR=new If(this);const e=er.XRSupported;let t,n;const i=document.createElement("div");i.classList.add("webxr-buttons"),this.context.domElement.append(i),this.enableAR&&this.createARButton&&(t=er.createARButton(this),this._arButton=t,i.appendChild(t)),this.createVRButton&&this.enableVR&&(e||!this.enableAR)&&(n=er.createVRButton(this),this._vrButton=n,i.appendChild(n)),setTimeout(()=>{er.resetButtonStyles(n),er.resetButtonStyles(t)},1e3)}get TransformOrientation(){return this._transformOrientation}get HeadPose(){return this._currentHeadPose}onBeforeRender(e){var n;if(!e)return;const t=this.context.renderer.xr.getSession();if(t){const i=e.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(this._currentHeadPose=i,!i)return;const r=i==null?void 0:i.transform;r&&this._transformOrientation.set(r.orientation.x,r.orientation.y,r.orientation.z,r.orientation.w);for(const o of this.controllers)o.onUpdate(t);this._isInAR&&((n=this.webAR)==null||n.onUpdate(t,e))}er._isInXr===!1&&t&&this.onEnterXR(t,e),er.events.dispatchEvent({type:"xrUpdate",frame:e,xr:this.context.renderer.xr,rig:this.rig})}onClickedARButton(){this._isInAR||(this._requestedAR=!0,this._requestedVR=!1,this.captureCameraState())}onClickedVRButton(){if(!this._isInVR){if(this._requestedVR){this.onExitXR(null);return}this._requestedAR=!1,this._requestedVR=!0,this.captureCameraState(),this.ensureRig();for(let e=0;e<2;e++)Zi.Create(this,e,this.gameObject,G_.PhysicalDevice);er.events.dispatchEvent({type:"requestVRSession"})}}captureCameraState(){this.context.mainCamera&&(this._originalCameraPosition.copy(ni(this.context.mainCamera)),this._originalCameraRotation.copy(ga(this.context.mainCamera)),this._originalCameraParent=this.context.mainCamera.parent)}ensureRig(){if(!this.rig){const e=Ee.findObjectOfType(xM,this.context);e?(this.rig=e.gameObject,this.rig.rotateY(Math.PI)):(this.rig=new ua,this.rig.rotateY(Math.PI),this.rig.name="XRRig",this.context.scene.add(this.rig))}}onEnterXR(e,t){var o;console.log("[XR] session begin",e),er._isInXr=!0,this.ensureRig();const n=this.context.renderer.xr.getReferenceSpace();if(n&&this.rig){const l=t.getViewerPose(n),h=l==null?void 0:l.transform.orientation;if(h){const u=new kt(h.x,h.y,h.z,h.w),f=new _s().setFromQuaternion(u);this.rig.rotateY(f.y)}}const i=this.context.renderer.xr;if(this.context.mainCamera){const l=i.getCamera(this.context.mainCamera);for(const h of l.cameras)h.layers.enableAll();this.rig.add(this.context.mainCamera)}const r=this._requestedAR?pr.AR:pr.VR;switch(Ja.Global.Set(r),r){case pr.AR:this.context.xrSessionMode=Tg.ImmersiveAR,this._isInAR=!0,(o=this.webAR)==null||o.onBegin(e);break;case pr.VR:this.context.xrSessionMode=Tg.ImmersiveVR,this._isInVR=!0,this.onEnterVR(e);break}e.addEventListener("end",()=>{console.log("[XR] session end"),er._isInXr=!1,this.onExitXR(e)}),this.onEnterXR_HandleMirrorWindow(e),er.events.dispatchEvent({type:"xrStarted",session:e})}onExitXR(e){var t,n;this._isInAR&&e&&((t=this.webAR)==null||t.onEnd(e)),this._isInAR=!1,this._isInVR=!1,this._requestedAR=!1,this._requestedVR=!1,this.context.xrSessionMode=void 0,this.xrMirrorWindow&&(this.xrMirrorWindow.close(),this.xrMirrorWindow=null),this.destroyControllers(),this.context.mainCamera&&((n=this._originalCameraParent)==null||n.add(this.context.mainCamera),sr(this.context.mainCamera,this._originalCameraPosition),Za(this.context.mainCamera,this._originalCameraRotation),this.context.mainCamera.scale.set(1,1,1)),Ja.Global.Set(pr.Browser|pr.ThirdPerson),er.events.dispatchEvent({type:"xrStopped",session:e})}onEnterVR(e){}destroyControllers(){var e;for(let t=this.controllers.length-1;t>=0;t-=1)(e=this.controllers[t])==null||e.destroy();this.controllers.length=0}onEnterXR_HandleMirrorWindow(e){!Ct("mirror")||setTimeout(()=>{if(!er.IsInWebXR)return;const t=new URL(window.location.href);R_(t.searchParams,U_,1),R_(t.searchParams,"isMirror",1);const n=t.toString();this.xrMirrorWindow=window.open(n,"webxr sync","popup=yes"),this.xrMirrorWindow&&(this.xrMirrorWindow.onload=()=>{this.xrMirrorWindow&&(this.xrMirrorWindow.onbeforeunload=()=>{er.IsInWebXR&&e.end()})})},1e3)}},x(Vy,"_isInXr",!1),x(Vy,"events",new Lr),Vy);let _i=er;p$([we(Ho)],_i.prototype,"defaultAvatar",2);const wf=class{constructor(e){x(this,"_webxr");x(this,"reticle",null);x(this,"hitTestSource",null);x(this,"reticleActive",!0);x(this,"previousBackground",null);x(this,"previousEnvironment",null);x(this,"sessionRoot",null);x(this,"_previousParent",null);x(this,"arDomOverlay",null);x(this,"arOverlayElement",null);x(this,"noHitTestAvailable",!1);x(this,"didPlaceARSessionRoot",!1);this._webxr=e}get webxr(){return this._webxr}get context(){return this.webxr.context}getAROverlayContainer(){return this.arDomOverlay=this.webxr.context.domElement,this.arOverlayElement=this.arDomOverlay.getAROverlayContainer(),this.arOverlayElement}setReticleActive(e){this.reticleActive=e}async onBegin(e){var i,r,o;const t=this.webxr.context;this.reticleActive=!0,this.didPlaceARSessionRoot=!1;const n=(i=navigator.userAgent)!=null&&i.includes("OculusBrowser")?G_.PhysicalDevice:G_.Touch;for(let l=0;l<4;l++)Zi.Create(this.webxr,l,this.webxr.gameObject,n);(!this.sessionRoot||this.sessionRoot.destroyed||!this.sessionRoot.activeAndEnabled)&&(this.sessionRoot=Ee.findObjectOfType(ip,t)),this.previousBackground=t.scene.background,this.previousEnvironment=t.scene.environment,t.scene.background=null,e.requestReferenceSpace("viewer").then(l=>{e.requestHitTestSource({space:l}).then(h=>{this.hitTestSource=h}).catch(h=>{this.noHitTestAvailable=!0,console.warn("WebXR: Hit test not supported")})}),!this.reticle&&this.sessionRoot&&(this.reticle=new _t(new Jf(.07,.09,32).rotateX(-Math.PI/2),new Hi),this.reticle.name="AR Placement reticle",this.reticle.matrixAutoUpdate=!1,this.reticle.visible=!1,this.webxr.scene?(this.webxr.scene.add(this.reticle),this.webxr.scene.visible=!0):console.warn("Could not found WebXR Rig")),this._previousParent=this.webxr.gameObject,wf.tempWebXRObject||(wf.tempWebXRObject=new Ft),this.context.scene.add(wf.tempWebXRObject),Ee.addComponent(wf.tempWebXRObject,this.webxr),this.sessionRoot?(this.sessionRoot.webAR=this,(r=this.sessionRoot)==null||r.onBegin(e)):console.warn("No WebARSessionRoot found in scene"),this.arDomOverlay&&this.arOverlayElement&&this.arDomOverlay.onEnterAR(e,this.arOverlayElement),(o=this.context.mainCameraComponent)==null||o.applyClearFlagsIfIsActiveCamera()}onEnd(e){var n;this._previousParent&&(console.log("ADD",this._previousParent),Ee.addComponent(this._previousParent,this.webxr),this._previousParent=null),this.hitTestSource=null;const t=this.webxr.context;t.scene.background=this.previousBackground,t.scene.environment=this.previousEnvironment,this.sessionRoot&&this.sessionRoot.onEnd(this.webxr.Rig,e),this.arDomOverlay&&this.arDomOverlay.onExitAR(e),(n=this.context.mainCameraComponent)==null||n.applyClearFlagsIfIsActiveCamera()}onUpdate(e,t){var i,r,o,l;if(this.noHitTestAvailable===!0){if(this.reticle&&(this.reticle.visible=!1),!this.didPlaceARSessionRoot){this.didPlaceARSessionRoot=!0;const h=this.webxr.Rig,u=A$.clone();if(h){const f=new q(0,0,0).add(h.position).divideScalar((r=(i=this.sessionRoot)==null?void 0:i.arScale)!=null?r:1);u.multiply(new fn().makeTranslation(f.x,f.y,f.z))}(o=this.sessionRoot)==null||o.placeAt(h,u)}return}if(!this.hitTestSource)return;const n=t.getHitTestResults(this.hitTestSource);if(n.length){const h=n[0],u=this.webxr.context.renderer.xr.getReferenceSpace();if(u){const f=h.getPose(u);if(this.sessionRoot){const g=this.sessionRoot.onUpdate(this.webxr.Rig,e,f);this.didPlaceARSessionRoot=g}if(this.reticle&&(this.reticle.visible=this.reticleActive,this.reticleActive&&f)){const g=f.transform.matrix;this.reticle.matrix.fromArray(g),this.webxr.Rig&&this.reticle.matrix.premultiply(this.webxr.Rig.matrix)}}}else(l=this.sessionRoot)==null||l.onUpdate(this.webxr.Rig,e,null),this.reticle&&(this.reticle.visible=!1)}};let If=wf;x(If,"tempWebXRObject");const A$=new fn().identity().makeTranslation(0,-.5,0);var dF=(a=>(a.SelectStart="selectstart",a.SelectEnd="selectend",a))(dF||{});const bf=class extends nA{constructor(){super();x(this,"transformSelf",!0);x(this,"selectStartEventListener",[]);x(this,"selectEndEventListener",[]);x(this,"_dragHelper",null);x(this,"_draggingRigidbodies",[]);x(this,"_waitingForDragStart",null);x(this,"_isDragging",!1);x(this,"_marker",null);x(this,"_dragDelta");x(this,"_didDrag",!1);this.selectStartEventListener=[],this.selectEndEventListener=[],this._dragDelta=new Xe}static get HasAnySelected(){return this._active!==null}addDragEventListener(t,n){switch(t){case"selectstart":this.selectStartEventListener.push(n);break;case"selectend":this.selectEndEventListener.push(n);break}}start(){}allowEdit(t=null){return this.context.connection.allowEditing}onPointerEnter(t){if(!this.allowEdit(this.gameObject)||_i.IsInWebXR)return;const n=Ee.getComponentInParent(t.object,bf);!n||n!==this||(bf.lastHovered=t.object,this.context.domElement.style.cursor="pointer")}onPointerExit(t){!this.allowEdit(this.gameObject)||_i.IsInWebXR||bf.lastHovered===t.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(t){!this.allowEdit(this.gameObject)||_i.IsInWebXR||(this._dragDelta.set(0,0),this._didDrag=!1,this._waitingForDragStart=t,t.StopPropagation())}onPointerUp(t){this._waitingForDragStart=null,this.allowEdit(this.gameObject)&&(_i.IsInWebXR||(this.onDragEnd(t),t.StopPropagation()))}update(){var t;if(!_i.IsInWebXR){if(this._waitingForDragStart){if(!this._didDrag){const i=this.context.input.getPointerPositionDelta(0);if(i&&this._dragDelta.add(i),this._dragDelta.length()>2)this._didDrag=!0;else return}const n=this._waitingForDragStart;this._waitingForDragStart=null,this.onDragStart(n)}this._dragHelper&&this._dragHelper.hasSelected&&this.onUpdateDrag(),this._isDragging&&!((t=this._dragHelper)!=null&&t.hasSelected)&&this.onDragEnd(null)}}onDragStart(t){if(!this._dragHelper)if(this.context.mainCamera)this._dragHelper=new $y(this.context.mainCamera);else return;if(!t||!t.object)return;const n=Ee.getComponentInParent(t.object,bf);if(!n||n!==this)return;let i=t.object;this.transformSelf&&(i=this.gameObject);const r={selected:i,attached:i};for(const u of this.selectStartEventListener)u(this,r);if(!r.attached)return;r.attached,i=r.attached,this._isDragging=!0,this._dragHelper.setSelected(i,this.context);const o=Ee.getComponentInChildren(i,oh);o&&(o.fastMode=!0,o==null||o.requestOwnership()),this._marker=Ee.addNewComponent(i,iA),this._draggingRigidbodies.length=0;const l=Ee.getComponentsInChildren(i,yr);l&&this._draggingRigidbodies.push(...l);const h=NP();Ee.invokeOnChildren(this._dragHelper.selected,h("onDragStart"))}onUpdateDrag(){if(!!this._dragHelper){this._dragHelper.onUpdate(this.context);for(const t of this._draggingRigidbodies)t.wakeUp(),t.setBodyFromGameObject()}}onDragEnd(t){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;this._draggingRigidbodies.length=0;const n=this._dragHelper.selected;if(this._dragHelper.setSelected(null,this.context),t!=null&&t.object){const r=Ee.getComponentInChildren(t.object,oh);r&&(r.fastMode=!1),this._marker&&this._marker.destroy()}for(const r of this.selectEndEventListener)r(this);const i=NP();Ee.invokeOnChildren(n,i("onDragEnd"))}};let Gc=bf;x(Gc,"_active",null),x(Gc,"lastHovered");const B1=class{constructor(e){x(this,"_selected",null);x(this,"_context",null);x(this,"_camera");x(this,"_cameraPlane",new Oo);x(this,"_hasGroundPlane",!1);x(this,"_groundPlane",new Oo);x(this,"_groundOffset",new q);x(this,"_groundOffsetFactor",0);x(this,"_groundDistance",0);x(this,"_groundPlanePoint",new q);x(this,"_raycaster",new ju);x(this,"_cameraPlaneOffset",new q);x(this,"_intersection",new q);x(this,"_worldPosition",new q);x(this,"_inverseMatrix",new fn);x(this,"_rbs",[]);x(this,"_groundLine");x(this,"_groundMarker");x(this,"_groundOffsetVector",new q(0,1,0));x(this,"_requireUpdateGroundPlane",!0);x(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=e;const t=new Ss(B1.geometry),n=t.material;n.color=new ye(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const i=new mo(.5,22,22),r=new Hi({color:n.color}),o=new _t(i,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(e,t){if(this._selected&&t)for(const n of this._rbs)n.wakeUp(),n.smoothedVelocity&&n.setVelocity(n.smoothedVelocity.x,n.smoothedVelocity.y,n.smoothedVelocity.z);if(this._selected&&Qr.Remove(t,this._selected),this._selected=e,this._context=t,this._rbs.length=0,e?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}Qr.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this._rbs=Ee.getComponentsInChildren(this._selected,yr),this.onUpdateScreenSpacePlane()}}onUpdate(e){var l,h,u,f,g;if(!this._context)return;const t=Xl.SPACE,n=Xl.KEY_D;Xl.KEY_S;const i=((l=this._context)==null?void 0:l.input.isKeyPressed(t))||((h=this._context)==null?void 0:h.input.isKeyPressed(n)),r=this._context.input.getTouchesPressedCount()>=2||i;if(r){const m=this._context.input.getPointerPositionDelta(0);m&&(this._groundOffsetVector.set(0,1,0),(u=this._selected)==null||u.rotateOnWorldAxis(this._groundOffsetVector,m.x*this._context.time.deltaTime))}const o=this._context.input.getPointerPositionRC(0);if(!!o&&(this._raycaster.setFromCamera(o,this._camera),this._selected)){this._groundOffsetVector.set(0,1,0);const m=ni(this._camera).clone().sub(ni(this._selected)).normalize(),A=Math.abs(m.dot(this._groundOffsetVector)),v=((f=this._context)==null?void 0:f.input.isKeyPressed(t))||((g=this._context)==null?void 0:g.input.isKeyPressed(n)),b=!r&&A>.2&&!v&&this._context.input.getPointerPressedCount()<=1,C=this._didDragOnGroundPlaneLastFrame!==b;if(this._didDragOnGroundPlaneLastFrame=b,this._hasGroundPlane||(this._requireUpdateGroundPlane=!0),(this._requireUpdateGroundPlane||!b||C)&&this.onUpdateGroundPlane(),this._requireUpdateGroundPlane=!1,this._hasGroundPlane)if(this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection)){const S=this._intersection.y;if(this._groundPlanePoint.copy(this._intersection).sub(this._groundOffset),this._groundPlanePoint.y=S,b){this._groundOffsetVector.set(0,1,0);const I=this._intersection.sub(this._groundOffset).add(this._groundOffsetVector.multiplyScalar(this._groundOffsetFactor));this.onUpdateWorldPosition(I,this._groundPlanePoint,!1),this.onDidUpdate();return}}else this._groundPlanePoint.set(0,99999,0);C&&this.onUpdateScreenSpacePlane(),this._requireUpdateGroundPlane=!0,this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&(this.onUpdateWorldPosition(this._intersection.sub(this._cameraPlaneOffset),this._groundPlanePoint,!0),this.onDidUpdate())}}onUpdateWorldPosition(e,t,n){if(!!this._selected){if(n){const i=ni(this._selected);i.y=e.y,e=i}if(sr(this._selected,e),sr(this._groundLine,e),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundMarker.visible=t!==null,t){const i=ni(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(i,i,i),sr(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const e=this._context.input.getPointerPositionRC(0);!e||(this._raycaster.setFromCamera(e,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const e=ni(this._selected),t=new Vu(new q(0,.1,0).add(e),new q(0,-1,0)),n=new nc;n.ignore=[this._selected];const i=this._context.physics.raycastFromRay(t,n);for(let r=0;r<i.length;r++){const o=i[r];if(!o.face||this.contains(this._selected,o.object))continue;const l=new q(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(l,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(e),this._groundOffset.copy(this._intersection).sub(e)}onDidUpdate(){Pr.markDirty(this._selected);for(const e of this._rbs)e.wakeUp(),e.setBodyFromGameObject({x:0,y:0,z:0}),e.setAngularVelocity(0,0,0)}contains(e,t){if(e===t)return!0;if(e.children){for(const n of e.children)if(this.contains(n,t))return!0}return!1}};let $y=B1;x($y,"geometry",new Sn().setFromPoints([new q(0,0,0),new q(0,-1,0)]));var y$=Object.defineProperty,_$=Object.getOwnPropertyDescriptor,fF=(a,e,t,n)=>{for(var i=n>1?void 0:n?_$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&y$(e,t,i),i};class Xv extends pt{constructor(){super(...arguments);x(this,"filesBackendUrl");x(this,"localhost");x(this,"_dragOver");x(this,"_drop")}onEnable(){this.filesBackendUrl=this.filesBackendUrl?Hu.GetUrl(this.filesBackendUrl,this.localhost):void 0,this._dragOver=this.onDrag.bind(this),this._drop=this.onDrop.bind(this),this.context.domElement.addEventListener("dragover",this._dragOver),this.context.domElement.addEventListener("drop",this._drop)}onDisable(){this.context.domElement.removeEventListener("dragover",this._dragOver),this.context.domElement.removeEventListener("drop",this._drop)}onDrag(t){t.preventDefault()}async onDrop(t){if(console.log(t),!t.dataTransfer)return;t.preventDefault();const n=t.dataTransfer.items;if(!!n)for(const i in n){const r=n[i];if(r.kind==="file"){const o=r.getAsFile();if(!o)continue;console.log("Register file "+o.name+" to",this.filesBackendUrl,o);const l=await nse(o,this.context,this.filesBackendUrl);l&&this.addObject(t,l)}else r.kind==="string"&&r.type=="text/plain"&&r.getAsString(async o=>{console.log("dropped url",o);try{const l=new URL(o);if(!l)return;const h=await ise(l,this.context);h&&this.addObject(t,h)}catch{console.log("dropped string is not a valid URL!",o)}})}}async addObject(t,n){console.log("Dropped",n);const i=new nc;i.setMask(16777215),i.screenPointFromOffset(t.offsetX,t.offsetY);const r=this.context.physics.raycast(i),o=n.scene;if(r&&r.length>0)for(const l of r){o.position.copy(l.point);break}this.gameObject.add(o),this.dispatchEvent(new CustomEvent("object-added",{detail:n}))}}fF([we()],Xv.prototype,"filesBackendUrl",2);fF([we()],Xv.prototype,"localhost",2);var v$=Object.defineProperty,x$=Object.getOwnPropertyDescriptor,Yv=(a,e,t,n)=>{for(var i=n>1?void 0:n?x$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&v$(e,t,i),i};class sp extends nA{constructor(){super(...arguments);x(this,"parent",null);x(this,"object",null);x(this,"limitCount",10);x(this,"limitInterval",60);x(this,"_currentCount",0);x(this,"_startPosition",null);x(this,"_startQuaternion",null)}awake(){var n,i,r,o;if(this.object){if(this.object===this.gameObject){console.error("Can not duplicate self");return}this.object.visible=!1,this._startPosition=(i=(n=this.object.position)==null?void 0:n.clone())!=null?i:new q(0,0,0),this._startQuaternion=(o=(r=this.object.quaternion)==null?void 0:r.clone())!=null?o:new kt(0,0,0,1)}const t=Ee.getComponentInParent(this.gameObject,Gc);t?t.addDragEventListener(dF.SelectStart,(l,h)=>{if(this._currentCount>=this.limitCount){h.attached=null;return}const u=this.handleDuplication(h.selected);u&&(console.assert(u!==h.selected,"Duplicated object is original"),h.attached=u)}):console.warn("Could no find drag controls in parent",this.name),Zi.addEventListener(la.SelectStart,(l,h)=>{if(this._currentCount>=this.limitCount){h.grab=null;return}const u=this.handleDuplication(h.selected);u&&(h.grab=u)}),this.cloneLimitIntervalFn()}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(t){var n,i;if(this._currentCount>=this.limitCount||!this.object)return null;if(t===this.gameObject||this.handleMultiObject(t)){if(this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const r=new Go;this.parent||(this.parent=this.gameObject.parent),this.parent&&(r.parent=(i=this.parent.guid)!=null?i:(n=this.parent.userData)==null?void 0:n.guid,r.keepWorldPosition=!0),r.position=this.worldPosition,r.rotation=this.worldQuaternion,r.context=this.context,this._currentCount+=1;const o=Ee.instantiateSynced(this.object,r);return console.assert(o!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),o}return null}handleMultiObject(t){return this.gameObject.type==="Group"||this.gameObject.type==="Object3D"?this.isInChildren(this.gameObject,t):!1}isInChildren(t,n){if(!t)return!1;if(t===n)return!0;if(t.children){for(let i of t.children)if(this.isInChildren(i,n))return!0}return!1}}Yv([we(Ft)],sp.prototype,"parent",2);Yv([we(Ft)],sp.prototype,"object",2);Yv([we()],sp.prototype,"limitCount",2);Yv([we()],sp.prototype,"limitInterval",2);class xg{constructor(e,t){x(this,"method");x(this,"enabled");this.method=e,this.enabled=t!==void 0?t:!0}invoke(...e){if(this.enabled!==!1){if(!this.method){console.warn("No function. Please check you assigned a method to invoke on export",this);return}this.method(...e)}}}const w$=a=>/^[A-Z]*$/.test(a);class bM extends Event{constructor(){super(...arguments);x(this,"args")}}class ya{constructor(e){x(this,"target");x(this,"key");x(this,"_isInvoking",!1);x(this,"methods",[]);this.methods=e!=null?e:[]}setEventTarget(e,t){if(this.key=e,this.target=t,this.key!==void 0){let n="",i=!1;for(let r of this.key)i&&w$(r)&&(n+="-"),i=!0,n+=r.toLowerCase();this.key=n}}invoke(...e){if(this._isInvoking){console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this);return}this._isInvoking=!0;try{for(const t of this.methods)t.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const t=this.target.dispatchEvent;if(typeof t=="function"){const n=new bM(this.key);n.args=e,t.call(this.target,n)}}}finally{this._isInvoking=!1}}addEventListener(e){return this.methods.push(new xg(e,!0)),e}removeEventListener(e){if(!!e)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].method===e&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}class pF extends pt{}const b$={type:"change"};class C$ extends Lr{constructor(e,t){super(),this.object=e,this.domElement=t,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const n=this,i=1e-6,r=new kt,o=new q;this.tmpQuaternion=new kt,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new q(0,0,0),this.rotationVector=new q(0,0,0),this.keydown=function(m){if(!m.altKey){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(m){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()},this.pointerdown=function(m){if(this.dragToLook)this.status++;else{switch(m.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(m){if(!this.dragToLook||this.status>0){const A=this.getContainerDimensions(),v=A.size[0]/2,b=A.size[1]/2;this.moveState.yawLeft=-(m.pageX-A.offset[0]-v)/v,this.moveState.pitchDown=(m.pageY-A.offset[1]-b)/b,this.updateRotationVector()}},this.pointerup=function(m){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(m.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()},this.update=function(m){const A=m*n.movementSpeed,v=m*n.rollSpeed;n.object.translateX(n.moveVector.x*A),n.object.translateY(n.moveVector.y*A),n.object.translateZ(n.moveVector.z*A),n.tmpQuaternion.set(n.rotationVector.x*v,n.rotationVector.y*v,n.rotationVector.z*v,1).normalize(),n.object.quaternion.multiply(n.tmpQuaternion),(o.distanceToSquared(n.object.position)>i||8*(1-r.dot(n.object.quaternion))>i)&&(n.dispatchEvent(b$),r.copy(n.object.quaternion),o.copy(n.object.position))},this.updateMovementVector=function(){const m=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-m+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",VB),this.domElement.removeEventListener("pointerdown",h),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",u),window.removeEventListener("keydown",f),window.removeEventListener("keyup",g)};const l=this.pointermove.bind(this),h=this.pointerdown.bind(this),u=this.pointerup.bind(this),f=this.keydown.bind(this),g=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",VB),this.domElement.addEventListener("pointerdown",h),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",u),window.addEventListener("keydown",f),window.addEventListener("keyup",g),this.updateMovementVector(),this.updateRotationVector()}}function VB(a){a.preventDefault()}class mF extends pt{constructor(){super(...arguments);x(this,"_controls",null)}onEnable(){var n;const t=(n=Ee.getComponent(this.gameObject,qs))==null?void 0:n.cam;this._controls=new C$(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var E$=Object.defineProperty,S$=Object.getOwnPropertyDescriptor,CM=(a,e,t,n)=>{for(var i=n>1?void 0:n?S$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&E$(e,t,i),i};class sA extends pt{constructor(){super(...arguments);x(this,"objectBounds",!1);x(this,"color");x(this,"isGizmo",!0);x(this,"_gizmoObject",null);x(this,"_boxHelper",null)}onEnable(){var t,n;this.isGizmo&&!Zg||(this._gizmoObject||(this.objectBounds&&this.gameObject.isMesh===!0?this._gizmoObject=new QS(this.gameObject,(t=this.color)!=null?t:16776960):(this.objectBounds=!1,this._gizmoObject=oF((n=this.color)!=null?n:16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),qr.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}CM([we()],sA.prototype,"objectBounds",2);CM([we(ye)],sA.prototype,"color",2);CM([we()],sA.prototype,"isGizmo",2);class EM{constructor(){this.pluginCallbacks=[],this.register(function(e){return new O$(e)}),this.register(function(e){return new F$(e)}),this.register(function(e){return new k$(e)}),this.register(function(e){return new z$(e)}),this.register(function(e){return new G$(e)}),this.register(function(e){return new N$(e)}),this.register(function(e){return new U$(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){const r=new D$,o=[];for(let l=0,h=this.pluginCallbacks.length;l<h;l++)o.push(this.pluginCallbacks[l](r));r.setPlugins(o),r.write(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,i,r,t)})}}const yi={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},lo={};lo[$i]=yi.NEAREST;lo[Ff]=yi.NEAREST_MIPMAP_NEAREST;lo[kf]=yi.NEAREST_MIPMAP_LINEAR;lo[vi]=yi.LINEAR;lo[Rg]=yi.LINEAR_MIPMAP_NEAREST;lo[va]=yi.LINEAR_MIPMAP_LINEAR;lo[Os]=yi.CLAMP_TO_EDGE;lo[Qc]=yi.REPEAT;lo[ku]=yi.MIRRORED_REPEAT;const WB={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},QB=12,M$=1179937895,T$=2,jB=8,I$=1313821514,R$=5130562;function Fm(a,e){return a.length===e.length&&a.every(function(t,n){return t===e[n]})}function P$(a){return new TextEncoder().encode(a).buffer}function B$(a){return Fm(a.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function L$(a,e,t){const n={min:new Array(a.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(a.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=e;i<e+t;i++)for(let r=0;r<a.itemSize;r++){let o;a.itemSize>4?o=a.array[i*a.itemSize+r]:r===0?o=a.getX(i):r===1?o=a.getY(i):r===2?o=a.getZ(i):r===3&&(o=a.getW(i)),n.min[r]=Math.min(n.min[r],o),n.max[r]=Math.max(n.max[r],o)}return n}function gF(a){return Math.ceil(a/4)*4}function hC(a,e=0){const t=gF(a.byteLength);if(t!==a.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(a)),e!==0)for(let i=a.byteLength;i<t;i++)n[i]=e;return n.buffer}return a}function qB(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function XB(a,e){if(a.toBlob!==void 0)return new Promise(n=>a.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),a.convertToBlob({type:e,quality:t})}class D${constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,r=i.buffers,o=i.json;n=i.options;const l=i.extensionsUsed,h=new Blob(r,{type:"application/octet-stream"}),u=Object.keys(l);if(u.length>0&&(o.extensionsUsed=u),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=h.size),n.binary===!0){const f=new FileReader;f.readAsArrayBuffer(h),f.onloadend=function(){const g=hC(f.result),m=new DataView(new ArrayBuffer(jB));m.setUint32(0,g.byteLength,!0),m.setUint32(4,R$,!0);const A=hC(P$(JSON.stringify(o)),32),v=new DataView(new ArrayBuffer(jB));v.setUint32(0,A.byteLength,!0),v.setUint32(4,I$,!0);const b=new ArrayBuffer(QB),C=new DataView(b);C.setUint32(0,M$,!0),C.setUint32(4,T$,!0);const S=QB+v.byteLength+A.byteLength+m.byteLength+g.byteLength;C.setUint32(8,S,!0);const I=new Blob([b,v,A,m,g],{type:"application/octet-stream"}),M=new FileReader;M.readAsArrayBuffer(I),M.onloadend=function(){t(M.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(h),f.onloadend=function(){const g=f.result;o.buffers[0].uri=g,t(o)}}else t(o);this.temporaryRenderer&&this.temporaryRenderer.dispose()}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,i=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],i[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const n=new q;for(let i=0,r=e.count;i<r;i++)if(Math.abs(n.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),i=new q;for(let r=0,o=n.count;r<o;r++)i.fromBufferAttribute(n,r),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),n.setXYZ(r,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const i={};(t.offset.x!==0||t.offset.y!==0)&&(i.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(i.rotation=t.rotation,n=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildReadableTexture(e,t){const n=new Yr(2,2,1,1),i=new js({uniforms:{blitTexture:new Yg(e)},vertexShader:`
				varying vec2 vUv;
				void main(){
					vUv = uv;
					gl_Position = vec4(position.xy * 1.0,0.,.999999);
				}`,fragmentShader:`
				uniform sampler2D blitTexture; 
				varying vec2 vUv;
				void main(){ 
					gl_FragColor = vec4(vUv.xy, 0, 1);
					gl_FragColor = texture2D( blitTexture, vUv);
				}`}),r=new _t(n,i);r.frustrumCulled=!1;const o=new ns,l=new Bu;l.add(r),this.temporaryRenderer||(this.temporaryRenderer=new Dg({antialias:!1})),this.temporaryRenderer.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),this.temporaryRenderer.clear(),this.temporaryRenderer.render(l,o);const h=new Ii(this.temporaryRenderer.domElement);return h.userData.mimeType="image/png",h}buildMetalRoughTexture(e,t){if(e===t)return e;function n(A){return A.encoding===Gn?function(b){return b<.04045?b*.0773993808:Math.pow(b*.9478672986+.0521327014,2.4)}:function(b){return b}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),typeof Nl<"u"&&(e instanceof Nl&&(e=this.buildReadableTexture(e)),t instanceof Nl&&(t=this.buildReadableTexture(t)));const i=e==null?void 0:e.image,r=t==null?void 0:t.image,o=Math.max((i==null?void 0:i.width)||0,(r==null?void 0:r.width)||0),l=Math.max((i==null?void 0:i.height)||0,(r==null?void 0:r.height)||0),h=qB();h.width=o,h.height=l;const u=h.getContext("2d");u.fillStyle="#00ffff",u.fillRect(0,0,o,l);const f=u.getImageData(0,0,o,l);if(i){u.drawImage(i,0,0,o,l);const A=n(e),v=u.getImageData(0,0,o,l).data;for(let b=2;b<v.length;b+=4)f.data[b]=A(v[b]/256)*256}if(r){u.drawImage(r,0,0,o,l);const A=n(t),v=u.getImageData(0,0,o,l).data;for(let b=1;b<v.length;b+=4)f.data[b]=A(v[b]/256)*256}u.putImageData(f,0,0);const m=(e||t).clone();return m.source=new Wl(h),m.encoding=Ar,m}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,i,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let l;t===yi.UNSIGNED_BYTE||t===yi.BYTE?l=1:t===yi.UNSIGNED_SHORT?l=2:l=4;const h=gF(i*e.itemSize*l),u=new DataView(new ArrayBuffer(h));let f=0;for(let A=n;A<n+i;A++)for(let v=0;v<e.itemSize;v++){let b;e.itemSize>4?b=e.array[A*e.itemSize+v]:v===0?b=e.getX(A):v===1?b=e.getY(A):v===2?b=e.getZ(A):v===3&&(b=e.getW(A)),t===yi.FLOAT?u.setFloat32(f,b,!0):t===yi.UNSIGNED_INT?u.setUint32(f,b,!0):t===yi.UNSIGNED_SHORT?u.setUint16(f,b,!0):t===yi.UNSIGNED_BYTE?u.setUint8(f,b):t===yi.BYTE?u.setInt8(f,b):t===yi.SHORT&&u.setInt16(f,b),f+=l}const g={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:h};return r!==void 0&&(g.target=r),r===yi.ARRAY_BUFFER&&(g.byteStride=e.itemSize*l),this.byteOffset+=h,o.bufferViews.push(g),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(i){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=hC(r.result),l={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,i(n.bufferViews.push(l)-1)}})}processAccessor(e,t,n,i){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};let l;if(e.array.constructor===Float32Array)l=yi.FLOAT;else if(e.array.constructor===Uint32Array)l=yi.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)l=yi.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)l=yi.UNSIGNED_BYTE;else if(e.array.constructor===Int8Array)l=yi.BYTE;else if(e.array.constructor===Int16Array)l=yi.SHORT;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor);if(n===void 0&&(n=0),i===void 0&&(i=e.count),i===0)return null;const h=L$(e,n,i);let u;t!==void 0&&(u=e===t.index?yi.ELEMENT_ARRAY_BUFFER:yi.ARRAY_BUFFER);const f=this.processBufferView(e,l,n,i,u),g={bufferView:f.id,byteOffset:f.byteOffset,componentType:l,count:i,max:h.max,min:h.min,type:o[e.itemSize]};return e.normalized===!0&&(g.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(g)-1}processImage(e,t,n,i="image/png"){const r=this,o=r.cache,l=r.json,h=r.options,u=r.pending;o.images.has(e)||o.images.set(e,{});const f=o.images.get(e),g=i+":flipY/"+n.toString();if(f[g]!==void 0)return f[g];l.images||(l.images=[]);const m={mimeType:i},A=qB();A.width=Math.min(e.width,h.maxTextureSize),A.height=Math.min(e.height,h.maxTextureSize);const v=A.getContext("2d");if(n===!0&&(v.translate(0,A.height),v.scale(1,-1)),e.data!==void 0){if(t!==ds&&console.error("GLTFExporter: Only RGBAFormat is supported."),e.width>h.maxTextureSize||e.height>h.maxTextureSize)v.drawImage(e,0,0,A.width,A.height);else{t!==ds&&console.error("GLTFExporter: Only RGBAFormat is supported.",e),(e.width>h.maxTextureSize||e.height>h.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const S=new Uint8ClampedArray(e.height*e.width*4);for(let I=0;I<S.length;I+=4)S[I+0]=e.data[I+0],S[I+1]=e.data[I+1],S[I+2]=e.data[I+2],S[I+3]=e.data[I+3];v.putImageData(new ImageData(S,e.width,e.height),0,0)}const C=new Uint8ClampedArray(e.height*e.width*4);for(let S=0;S<C.length;S+=4)C[S+0]=e.data[S+0],C[S+1]=e.data[S+1],C[S+2]=e.data[S+2],C[S+3]=e.data[S+3];v.putImageData(new ImageData(C,e.width,e.height),0,0)}else v.drawImage(e,0,0,A.width,A.height);h.binary===!0?u.push(XB(A,i).then(C=>r.processBufferViewImage(C)).then(C=>{m.bufferView=C})):A.toDataURL!==void 0?m.uri=A.toDataURL(i):u.push(XB(A,i).then(C=>new FileReader().readAsDataURL(C)).then(C=>{m.uri=C}));const b=l.images.push(m)-1;return f[g]=b,b}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:lo[e.magFilter],minFilter:lo[e.minFilter],wrapS:lo[e.wrapS],wrapT:lo[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const n=this.options,i=this.cache,r=this.json;if(i.textures.has(e))return i.textures.get(e);r.textures||(r.textures=[]);let o=e;typeof Nl<"u"&&e instanceof Nl&&(o=this.buildReadableTexture(e,n.maxTextureSize));let l=o.userData.mimeType;l==="image/webp"&&(l="image/png");const h={sampler:this.processSampler(e),source:this.processImage(o.image,o.format,o.flipY,l)};e.name&&(h.name=e.name),this._invokeAll(function(f){f.writeTexture&&f.writeTexture(o,h)});const u=r.textures.push(h)-1;return i.textures.set(e,u),u}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(Fm(r,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const l=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),h={index:this.processTexture(l)};this.applyTextureTransform(h,l),i.pbrMetallicRoughness.metallicRoughnessTexture=h}if(e.map){const l={index:this.processTexture(e.map)};this.applyTextureTransform(l,e.map),i.pbrMetallicRoughness.baseColorTexture=l}if(e.emissive){const l=e.emissive.clone().multiplyScalar(e.emissiveIntensity),h=Math.max(l.r,l.g,l.b);if(h>1&&(l.multiplyScalar(1/h),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),h>0&&(i.emissiveFactor=l.toArray()),e.emissiveMap){const u={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(u,e.emissiveMap),i.emissiveTexture=u}}if(e.normalMap){const l={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(l.scale=e.normalScale.x),this.applyTextureTransform(l,e.normalMap),i.normalTexture=l}if(e.aoMap){const l={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(l.strength=e.aoMapIntensity),this.applyTextureTransform(l,e.aoMap),i.occlusionTexture=l}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===ir&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(l){l.writeMaterial&&l.writeMaterial(e,i)});const o=n.materials.push(i)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let M=0,R=e.material.length;M<R;M++)i.push(e.material[M].uuid);else i.push(e.material.uuid);const r=i.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let l;e.isLineSegments?l=yi.LINES:e.isLineLoop?l=yi.LINE_LOOP:e.isLine?l=yi.LINE_STRIP:e.isPoints?l=yi.POINTS:l=e.material.wireframe?yi.LINES:yi.TRIANGLES;const h={},u={},f=[],g=[],m={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},A=o.getAttribute("normal");A!==void 0&&!this.isNormalizedNormalAttribute(A)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(A)));let v=null;for(let M in o.attributes){if(M.slice(0,5)==="morph")continue;const R=o.attributes[M];if(M=m[M]||M.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(M)||(M="_"+M),t.attributes.has(this.getUID(R))){u[M]=t.attributes.get(this.getUID(R));continue}v=null;const B=R.array;M==="JOINTS_0"&&!(B instanceof Uint16Array)&&!(B instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new Jn(new Uint16Array(B),R.itemSize,R.normalized));const F=this.processAccessor(v||R,o);F!==null&&(u[M]=F,t.attributes.set(this.getUID(R),F))}if(A!==void 0&&o.setAttribute("normal",A),Object.keys(u).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const M=[],R=[],T={};if(e.morphTargetDictionary!==void 0)for(const B in e.morphTargetDictionary)T[e.morphTargetDictionary[B]]=B;for(let B=0;B<e.morphTargetInfluences.length;++B){const F={};let D=!1;for(const U in o.morphAttributes){if(U!=="position"&&U!=="normal"){D||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),D=!0);continue}const W=o.morphAttributes[U][B],J=U.toUpperCase(),ee=o.attributes[U];if(t.attributes.has(this.getUID(W,!0))){F[J]=t.attributes.get(this.getUID(W,!0));continue}const Q=W.clone();if(!o.morphTargetsRelative)for(let Y=0,se=W.count;Y<se;Y++)Q.setXYZ(Y,W.getX(Y)-ee.getX(Y),W.getY(Y)-ee.getY(Y),W.getZ(Y)-ee.getZ(Y));F[J]=this.processAccessor(Q,o),t.attributes.set(this.getUID(ee,!0),F[J])}g.push(F),M.push(e.morphTargetInfluences[B]),e.morphTargetDictionary!==void 0&&R.push(T[B])}h.weights=M,R.length>0&&(h.extras={},h.extras.targetNames=R)}const b=Array.isArray(e.material);if(b&&o.groups.length===0)return null;const C=b?e.material:[e.material],S=b?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let M=0,R=S.length;M<R;M++){const T={mode:l,attributes:u};if(this.serializeUserData(o,T),g.length>0&&(T.targets=g),o.index!==null){let F=this.getUID(o.index);(S[M].start!==void 0||S[M].count!==void 0)&&(F+=":"+S[M].start+":"+S[M].count),t.attributes.has(F)?T.indices=t.attributes.get(F):(T.indices=this.processAccessor(o.index,o,S[M].start,S[M].count),t.attributes.set(F,T.indices)),T.indices===null&&delete T.indices}const B=this.processMaterial(C[S[M].materialIndex]);B!==null&&(T.material=B),f.push(T)}h.primitives=f,n.meshes||(n.meshes=[]),this._invokeAll(function(M){M.writeMesh&&M.writeMesh(e,h)});const I=n.meshes.push(h)-1;return t.meshes.set(r,I),I}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:zu.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]),e=EM.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],l=[];for(let h=0;h<r.length;++h){const u=r[h],f=ti.parseTrackName(u.name);let g=ti.findNode(t,f.nodeName);const m=WB[f.propertyName];if(f.objectName==="bones"&&(g.isSkinnedMesh===!0?g=g.skeleton.getBoneByName(f.objectIndex):g=void 0),!g||!m)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',u.name),null;const A=1;let v=u.values.length/u.times.length;m===WB.morphTargetInfluences&&(v/=g.morphTargetInfluences.length);let b;u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(b="CUBICSPLINE",v/=3):u.getInterpolation()===Uu?b="STEP":b="LINEAR",l.push({input:this.processAccessor(new Jn(u.times,A)),output:this.processAccessor(new Jn(u.values,v)),interpolation:b}),o.push({sampler:l.length-1,target:{node:i.get(g),path:m}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:l,channels:o}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const l=[],h=new Float32Array(r.bones.length*16),u=new fn;for(let g=0;g<r.bones.length;++g)l.push(n.get(r.bones[g])),u.copy(r.boneInverses[g]),u.multiply(e.bindMatrix).toArray(h,g*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Jn(h,16)),joints:l,skeleton:n.get(o)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(n.trs){const l=e.quaternion.toArray(),h=e.position.toArray(),u=e.scale.toArray();Fm(l,[0,0,0,1])||(r.rotation=l),Fm(h,[0,0,0])||(r.translation=h),Fm(u,[1,1,1])||(r.scale=u)}else e.matrixAutoUpdate&&e.updateMatrix(),B$(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const l=this.processMesh(e);l!==null&&(r.mesh=l)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let h=0,u=e.children.length;h<u;h++){const f=e.children[h];if(f.visible||n.onlyVisible===!1){const g=this.processNode(f);g!==null&&l.push(g)}}l.length>0&&(r.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(e,r)});const o=t.nodes.push(r)-1;return i.set(e,o),o}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const r=[];for(let o=0,l=e.children.length;o<l;o++){const h=e.children[o];if(h.visible||n.onlyVisible===!1){const u=this.processNode(h);u!==null&&r.push(u)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}processObjects(e){const t=new Bu;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const n=[];for(let i=0;i<e.length;i++)e[i]instanceof Bu?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class O${constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const n=this.writer,i=n.json,r=n.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);const l=i.extensions[this.name].lights;l.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:l.length-1}}}class F${constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class k${constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const n=this.writer,i=n.extensionsUsed,r={};t.pbrMetallicRoughness.baseColorFactor&&(r.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const o=[1,1,1];if(e.specular.toArray(o,0),r.specularFactor=o,r.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(r.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const l={index:n.processTexture(e.specularMap)};n.applyTextureTransform(l,e.specularMap),r.specularGlossinessTexture=l}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class N${constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:n.processTexture(e.clearcoatMap)};n.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:n.processTexture(e.clearcoatRoughnessMap)};n.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:n.processTexture(e.clearcoatNormalMap)};n.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class U${constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:n.processTexture(e.iridescenceMap)};n.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:n.processTexture(e.iridescenceThicknessMap)};n.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class z${constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class G${constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}EM.Utils={insertKeyframe:function(a,e){const n=a.getValueSize(),i=new a.TimeBufferType(a.times.length+1),r=new a.ValueBufferType(a.values.length+n),o=a.createInterpolant(new a.ValueBufferType(n));let l;if(a.times.length===0){i[0]=e;for(let h=0;h<n;h++)r[h]=0;l=0}else if(e<a.times[0]){if(Math.abs(a.times[0]-e)<.001)return 0;i[0]=e,i.set(a.times,1),r.set(o.evaluate(e),0),r.set(a.values,n),l=0}else if(e>a.times[a.times.length-1]){if(Math.abs(a.times[a.times.length-1]-e)<.001)return a.times.length-1;i[i.length-1]=e,i.set(a.times,0),r.set(a.values,0),r.set(o.evaluate(e),a.values.length),l=i.length-1}else for(let h=0;h<a.times.length;h++){if(Math.abs(a.times[h]-e)<.001)return h;if(a.times[h]<e&&a.times[h+1]>e){i.set(a.times.slice(0,h+1),0),i[h+1]=e,i.set(a.times.slice(h+1),h+2),r.set(a.values.slice(0,(h+1)*n),0),r.set(o.evaluate(e),(h+1)*n),r.set(a.values.slice((h+1)*n),(h+2)*n),l=h+1;break}}return a.times=i,a.values=r,l},mergeMorphTargetTracks:function(a,e){const t=[],n={},i=a.tracks;for(let r=0;r<i.length;++r){let o=i[r];const l=ti.parseTrackName(o.name),h=ti.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(jc)}const u=h.morphTargetInfluences.length,f=h.morphTargetDictionary[l.propertyIndex];if(f===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let g;if(n[h.uuid]===void 0){g=o.clone();const A=new g.ValueBufferType(u*g.times.length);for(let v=0;v<g.times.length;v++)A[v*u+f]=g.values[v];g.name=(l.nodeName||"")+".morphTargetInfluences",g.values=A,n[h.uuid]=g,t.push(g);continue}const m=o.createInterpolant(new o.ValueBufferType(1));g=n[h.uuid];for(let A=0;A<g.times.length;A++)g.values[A*u+f]=m.evaluate(g.times[A]);for(let A=0;A<o.times.length;A++){const v=this.insertKeyframe(g,o.times[A]);g.values[v*u+f]=o.values[A]}}return a.tracks=t,a}};class H${constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(e.constructor.name!=="InstancedMesh")return;const n=this.writer,i=n.extensionsUsed,r={};t.extensions=t.extensions||{},t.extensions[this.name]=r;let o=new fn;const l=new Array,h=new Array,u=new Array;for(let A=0;A<e.count;A++){e.getMatrixAt(A,o);let v=new q,b=new kt,C=new q;o.decompose(v,b,C),l.push(v.x,v.y,v.z),h.push(b.x,b.y,b.z,b.w),u.push(C.x,C.y,C.z)}const f=new Float32Array(l),g=new Float32Array(h),m=new Float32Array(u);r.attributes={TRANSLATION:n.processAccessor(new Jn(f,3)),ROTATION:n.processAccessor(new Jn(g,4)),SCALE:n.processAccessor(new Jn(m,3))},i[this.name]=!0}}class V_{constructor(e,t){x(this,"lightmapIndex",-1);x(this,"lightmapScaleOffset",new Bn(1,1,0,0));x(this,"context");x(this,"gameObject");x(this,"lightmapTexture",null);x(this,"lightmapScaleOffsetUniform",{value:new Bn(1,1,0,0)});x(this,"lightmapUniform",{value:null});x(this,"beforeRenderCallback");this.gameObject=e,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.setupLightmap())}init(e,t,n,i=!1){if(console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,this.lightmapIndex<0)return;this.lightmapScaleOffset=t,this.lightmapTexture=n,i&&this.setLightmapDebugMaterial(),this.setupLightmap()}bindOnBeforeRender(){this.beforeRenderCallback=this.onBeforeRenderThreeComplete.bind(this),this.context.addBeforeRenderListener(this.gameObject,this.beforeRenderCallback)}onBeforeRenderThreeComplete(e,t,n,i,r,o){this.onBeforeRenderThree(r)}setupLightmap(){if(this.gameObject.type==="Object3D")return;if(this.gameObject.type==="Group"){console.warn("Lightmap on multimaterial object is not supported yet... please ask kindly for implementation.");return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;e.geometry.getAttribute("uv2")||e.geometry.setAttribute("uv2",e.geometry.getAttribute("uv"));const t=this.gameObject.material.clone();if(this.gameObject.material=t,this.gameObject.material.onBeforeCompile=(n,i)=>{n.uniforms.lightmap=this.lightmapUniform,n.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform},this.lightmapIndex>=0){const n=this.lightmapTexture,i=this.gameObject.material;i&&n&&(i.uniforms||(i.uniforms={}),i.lightMap=n,i.uniforms.lightmap={value:n})}}onBeforeRenderThree(e){const t=e.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,t.lightmap=this.lightmapUniform,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}setLightmapDebugMaterial(){this.gameObject.material=new js({vertexShader:`
                attribute vec2 uv2;
                varying vec2 vUv2;
                void main()
                {
                    vUv2 = uv2;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightmap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv2;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv2.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightmap, lUv);
                    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
                    //lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
                    //lightMapTexel.a = 1.;
                    //lightMapTexel = conv_sRGBToLinear(lightMapTexel);
                    // lightMapTexel.rgb = vec3(1.);

                    // gl_FragColor = vec4(vUv2.xy, 0, 1);
                    gl_FragColor = lightMapTexel;
                }
                `,defines:{USE_LIGHTMAP:""}})}}const uC=Ct("debugstencil");function V$(a,e){return(a&1<<e.layer)!=0}const yu=class{constructor(e,t){x(this,"parser");x(this,"source");this.parser=e,this.source=t}static applyStencil(e){var i;if(!e)return;const t=e.sourceId;if(uC&&console.log(t,yu.stencils),!t)return;const n=yu.stencils[t];if(!!n)for(let r=n.length-1;r>=0;r--){const o=n[r];if(V$(o.layer,e)){uC&&console.log(o);const l=(i=e.material)==null?void 0:i.clone();l&&(e.material=l,e.gameObject.renderOrder=o.event*1e3+o.index*50,l.stencilWrite=!0,l.stencilWriteMask=255,l.stencilFuncMask=255,l.stencilRef=o.value,l.stencilFunc=o.compareFunc,l.stencilZPass=o.passOp,l.stencilFail=o.failOp,l.stencilZFail=o.zFailOp);break}}}afterRoot(e){const t=this.parser.json.extensions;if(t){const n=t[Q$];if(n){uC&&console.log(n);const i=n.stencil;if(i&&Array.isArray(i))for(const r of i){const o={...r};o.compareFunc=W$(o.compareFunc),o.passOp=dC(o.passOp),o.failOp=dC(o.failOp),o.zFailOp=dC(o.zFailOp),yu.stencils[this.source]||(yu.stencils[this.source]=[]),yu.stencils[this.source].push(o)}}}return null}};let qm=yu;x(qm,"stencils",{});function dC(a){switch(a){case 0:return Gm;case 1:return w2;case 2:return b2;case 3:return C2;case 4:return E2;case 6:return S2;case 7:return M2;case 5:return T2}return 0}function W$(a){switch(a){case 1:return I2;case 2:return R2;case 3:return P2;case 4:return B2;case 5:return L2;case 6:return D2;case 7:return O2;case 8:return aS}return 0}const Q$="NEEDLE_render_objects",fC="NEEDLE_deferred_texture",Io=Ct("debugdeferredtextures"),ig=class{constructor(e,t,n){x(this,"parser");x(this,"sourceId");x(this,"context");x(this,"_loading",[]);this.parser=e,this.sourceId=t,this.context=n}static assignTextureLOD(e,t,n,i=0){if(!!n)for(const r of Object.keys(n)){const o=n[r];(o==null?void 0:o.isTexture)===!0&&(Io&&console.log(`-----------
`,"FIND",n.name,r,o==null?void 0:o.name,o==null?void 0:o.userData,o),ig.getOrLoadTexture(e,t,n,r,o,i).then(l=>{(l==null?void 0:l.isTexture)===!0&&(l.needsUpdate=!0,Io&&console.log("Assign LOD",n.name,r,l.name,l.guid,n,"Prev:",o,"Now:",l,`
--------------`),n[r]=l,n.needsUpdate=!0)}))}}get name(){return fC}afterRoot(e){var t;return Io&&console.log("AFTER",this.sourceId,e),(t=this.parser.json.textures)==null||t.forEach((n,i)=>{if(n!=null&&n.extensions){const r=n==null?void 0:n.extensions[fC];if(r){const o=this.parser.getDependency("texture",i);this._loading.splice(this._loading.indexOf(i),1),o.then(l=>{Io&&console.log("register texture",l.name,l.uuid,r),l.userData.deferred=r,ig.cache.set(l.uuid,r)})}}}),null}static async getOrLoadTexture(e,t,n,i,r,o){const l=r.uuid,h=ig.cache.get(l);if(h){Io&&console.log(l,h.uri,h.guid);const u=Kg(t,h.uri);if(u.endsWith(".glb")||u.endsWith(".gltf")){if(!h.guid)return console.warn("missing pointer for glb/gltf texture",h),null;const f=u+"_"+h.guid;if(this.resolved[f])return Io&&console.log("Texture has already been loaded: "+f,n.name,i,r.name),this.resolved[f];const g=new np;qv(g,e),Io&&console.log("Load "+u,n.name,i,h.guid);const m=await g.loadAsync(u),A=m.parser;Io&&console.log("Loading finished "+u,n.name,i,h.guid);let v=-1,b=!1;for(const S of m.parser.json.textures)if(v++,S!=null&&S.extensions){const I=S==null?void 0:S.extensions[fC];if(I!=null&&I.guid&&I.guid===h.guid){b=!0;break}}if(!b)return null;const C=await A.getDependency("texture",v);return C&&(C.guid=h.guid),this.resolved[f]=C,Io&&console.log(n.name,i,'change "'+r.name+'" \u2192 "'+C.name+'"',u,v,C,n,f),C}else{Io&&console.log("Load texture from uri: "+u);const g=await new Xg().loadAsync(u);return g&&Io?console.log(h,g):console.warn("failed loading",u),g}}else Io&&console.warn("unknown uuid",r.name,r.uuid,r);return null}};let Eu=ig;x(Eu,"cache",new Map),x(Eu,"resolved",{});var j$=Object.defineProperty,q$=Object.getOwnPropertyDescriptor,qu=(a,e,t,n)=>{for(var i=n>1?void 0:n?q$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&j$(e,t,i),i};const YB=Ct("noInstancing"),JB=!!Ct("debuglightmaps"),X$=Ct("debuginstancing"),Y$=Ct("debugprogressiveload"),J$=Ct("noprogressiveload");class AF{constructor(){x(this,"path",null);x(this,"asset",null);x(this,"default")}}class K${constructor(e){x(this,"_renderer");x(this,"_targets",[]);this._renderer=e;const t=this.setMaterial.bind(this),n=this.getMaterial.bind(this),i=e.gameObject;if(this._targets=[],i)switch(i.type){case"Group":this._targets=[...i.children];break;case"Mesh":this._targets.push(i);break}return new Proxy(this,{get(r,o){if(typeof o=="string"){const l=parseInt(o);if(!isNaN(l))return n(l)}return r[o]},set(r,o,l){return typeof o=="string"&&t(l,Number.parseInt(o)),Reflect.set(r,o,l)}})}is(e){return this._renderer===e}get length(){return this._targets.length}setMaterial(e,t){if(t<0||t>=this._targets.length)return;const n=this._targets[t];!n||(n.material=e)}getMaterial(e){if(e<0)return null;const t=this._targets;if(e>=t.length)return null;const n=t[e];return n?n.material:null}}const yF=class extends pt{constructor(){super(...arguments);x(this,"receiveShadows",!1);x(this,"shadowCastingMode",RE.Off);x(this,"lightmapIndex",-1);x(this,"lightmapScaleOffset",new Bn(1,1,0,0));x(this,"enableInstancing");x(this,"renderOrder");x(this,"allowOcclusionWhenDynamic",!0);x(this,"_lightmaps");x(this,"_sharedMaterials");x(this,"_lightmapTextureOverride");x(this,"_isInstancingEnabled",!1);x(this,"handles");x(this,"prevLayers")}get material(){return this.gameObject.material}set material(e){this.gameObject.material=e}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._sharedMaterials=new K$(this)),this._sharedMaterials}static get shouldSuppressInstancing(){return YB}get lightmap(){var e;return(e=this._lightmaps)!=null&&e.length?this._lightmaps[0].lightmap:null}set lightmap(e){var t;if(this._lightmapTextureOverride=e,e===void 0&&(e=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(t=this._lightmaps)!=null&&t.length)for(const n of this._lightmaps)n.lightmap=e}get hasLightmap(){const e=this.lightmap;return e!=null}awake(){var t,n;this.clearInstancingState();const e=this.gameObject.type;if(e==="Group"){for(const i of this.gameObject.children)this.context.addBeforeRenderListener(i,this.onBeforeRenderThree.bind(this)),i.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let i=0;for(let r=0;r<this.gameObject.children.length;r++){const o=this.gameObject.children[r];if(!(o.type!=="Mesh"||Ee.getComponent(o,yF))){if(this.renderOrder.length<=i){console.error("Incorrect element count",this);break}o.renderOrder=this.renderOrder[i],i+=1}}}}else(e==="Mesh"||e==="SkinnedMesh")&&(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree.bind(this)),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0]));if(this.lightmapIndex>=0){const i=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(i){if(this._lightmaps=[],e==="Mesh"){if(!((t=this.gameObject.material)!=null&&t.isMeshBasicMaterial)){const r=new V_(this.gameObject,this.context);this._lightmaps.push(r),r.init(this.lightmapIndex,this.lightmapScaleOffset,i,JB)}}else if(e==="Group"){for(const r of this.gameObject.children)if(!((n=r.material)!=null&&n.isMeshBasicMaterial)){const o=new V_(r,this.context);this._lightmaps.push(o),o.init(this.lightmapIndex,this.lightmapScaleOffset,i,JB),o.bindOnBeforeRender()}}}}}clearInstancingState(){this._isInstancingEnabled=!1,this.handles=void 0,this.prevLayers=void 0}setInstancingEnabled(e){if(this._isInstancingEnabled===e)return e&&(this.handles===void 0||this.handles!=null&&this.handles.length>0);if(this._isInstancingEnabled=e,e){if(this.handles===void 0){if(this.handles=$$.setup(this.gameObject,this.context,null,{rend:this,foundMeshes:0}),this.handles)return Ee.markAsInstancedRendered(this.gameObject,!0),!0}else if(this.handles!==null){for(const t of this.handles)t.updateInstanceMatrix(!0),t.add();return Ee.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this.handles)for(const t of this.handles)t.remove();return!0}return!1}start(){if(this.enableInstancing&&!YB&&this.setInstancingEnabled(!0),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.gameObject.type==="Group")for(let e=0;e<this.gameObject.children.length;e++){const t=this.gameObject.children[e];t.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this._isInstancingEnabled?this.setInstancingEnabled(!0):this.enabled&&(this.gameObject.visible=!0,this.applyStencil())}onDisable(){this.handles&&this.handles.length>0?this.setInstancingEnabled(!1):this.enabled||(this.gameObject.visible=!1)}onDestroy(){this.handles=null}applyStencil(){qm.applyStencil(this)}onBeforeRenderThree(e,t,n,i,r,o){if(!J$&&r._didRequestTextureLOD===void 0&&(r._didRequestTextureLOD=0,Y$?(console.log("Load material LOD (with delay)",r.name),setTimeout(()=>{Eu.assignTextureLOD(this.context,this.sourceId,r)},2e3)):Eu.assignTextureLOD(this.context,this.sourceId,r)),r.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1;r.envMapIntensity=Math.max(0,this.context.rendererData.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.onBeforeRenderThree(r)}onBeforeRender(){var t;if(!this.gameObject)return;const e=this.gameObject[uE]===!0||this.gameObject.matrixWorldNeedsUpdate;if(this.gameObject.type==="Group"&&((t=this.gameObject.children)==null?void 0:t.length)>0)for(const n of this.gameObject.children)this.applySettings(n);else this.applySettings(this.gameObject);if(e&&(delete this.gameObject[uE],this.handles)){for(let n=this.handles.length-1;n>=0;n--)this.handles[n].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this.handles&&this.handles.length<=0&&Ee.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this.handles)for(let n=0;n<this.handles.length;n++){const i=this.handles[n];this.prevLayers||(this.prevLayers=[]);const r=i.object.layers.mask;n>=this.prevLayers.length?this.prevLayers.push(r):this.prevLayers[n]=r,i.object.layers.disableAll()}}onAfterRender(){if(this._isInstancingEnabled&&this.handles&&this.prevLayers&&this.prevLayers.length>=this.handles.length)for(let e=0;e<this.handles.length;e++){const t=this.handles[e];t.object.layers.mask=this.prevLayers[e]}}applySettings(e){e.receiveShadow=this.receiveShadows,this.shadowCastingMode==RE.On?e.castShadow=!0:e.castShadow=!1}};let Xs=yF;qu([we()],Xs.prototype,"receiveShadows",2);qu([we()],Xs.prototype,"shadowCastingMode",2);qu([we()],Xs.prototype,"lightmapIndex",2);qu([we(Bn)],Xs.prototype,"lightmapScaleOffset",2);qu([we()],Xs.prototype,"enableInstancing",2);qu([we()],Xs.prototype,"renderOrder",2);qu([we()],Xs.prototype,"allowOcclusionWhenDynamic",2);class SM extends Xs{}class _F extends SM{awake(){super.awake(),this.allowOcclusionWhenDynamic=!1}}var RE=(a=>(a[a.Off=0]="Off",a[a.On=1]="On",a[a.TwoSided=2]="TwoSided",a[a.ShadowsOnly=3]="ShadowsOnly",a))(RE||{});class Z${constructor(){x(this,"objs",[])}setup(e,t,n,i,r=0){const o=this.tryCreateOrAddInstance(e,t,i);if(o)return n===null&&(n=[]),n.push(o),n;if(r<=0&&e.type!=="Mesh"){const l=r+1;for(const h of e.children)n=this.setup(h,t,n,i,l)}return n}tryCreateOrAddInstance(e,t,n){if(e.type==="Mesh"){const i=n.foundMeshes;if(n.foundMeshes+=1,!n.rend.enableInstancing||i>=n.rend.enableInstancing.length||!n.rend.enableInstancing[i])return null;const r=e,o=r.geometry,l=r.material;for(const u of this.objs)if(!u.isFull()&&u.geo===o&&u.material===l)return u.addInstance(r);const h=new e_(e.name,o,l,200,t);return this.objs.push(h),h.addInstance(r)}return null}}const $$=new Z$;class eee{constructor(e,t,n){x(this,"instanceIndex",-1);x(this,"object");x(this,"instancer");this.instanceIndex=e,this.object=t,this.instancer=n,Ee.markAsInstancedRendered(t,!0)}get name(){return this.object.name}updateInstanceMatrix(e=!1){this.instanceIndex<0||(this.object.updateWorldMatrix(!0,e),this.instancer.updateInstance(this.object.matrixWorld,this.instanceIndex))}add(){this.instanceIndex>=0||this.instancer.add(this)}remove(){this.instanceIndex<0||this.instancer.remove(this)}}const L1=class{constructor(e,t,n,i,r){x(this,"name","");x(this,"geo");x(this,"material");x(this,"context");x(this,"inst");x(this,"handles",[]);x(this,"maxCount");this.name=e,this.geo=t,this.material=n,this.context=r,this.maxCount=i,X$&&(n=new Hi({color:this.randomColor()})),this.inst=new xS(t,n,i),this.inst.count=0,this.inst.layers.set(2),this.inst.visible=!0,this.context.scene.add(this.inst)}get currentCount(){return this.inst.count}isFull(){return this.currentCount>=this.maxCount}randomColor(){return new ye(Math.random(),Math.random(),Math.random())}addInstance(e){if(this.currentCount>=this.maxCount)return console.error("TOO MANY INSTANCES - resize is not yet implemented!",this.inst.count),null;const t=new eee(-1,e,this);return this.add(t),t}add(e){e.instanceIndex<0&&(e.instanceIndex=this.currentCount,e.instanceIndex>=this.handles.length?this.handles.push(e):this.handles[e.instanceIndex]=e),e.object.updateWorldMatrix(!0,!0),this.inst.setMatrixAt(e.instanceIndex,e.object.matrixWorld),this.inst.instanceMatrix.needsUpdate=!0,this.inst.count+=1,this.inst.count>0&&(this.inst.visible=!0)}remove(e){if(!e||e.instanceIndex<0||e.instanceIndex>=this.handles.length||this.inst.count<=0)return;if(this.handles[e.instanceIndex]!==e){console.error("instance handle is not part of renderer, was it removed before?",e.instanceIndex,this.name);const n=this.handles.indexOf(e);if(n<0)return;e.instanceIndex=n}if(this.handles[e.instanceIndex]=null,this.inst.setMatrixAt(e.instanceIndex,L1.nullMatrix),!(e.instanceIndex>=this.currentCount-1)&&this.currentCount>0){const n=this.handles[this.currentCount-1];n&&(n.instanceIndex=e.instanceIndex,n.updateInstanceMatrix(),this.handles[e.instanceIndex]=n,this.handles[this.currentCount-1]=null)}this.inst.count>0&&(this.inst.count-=1),e.instanceIndex=-1,this.inst.count<=0&&(this.inst.visible=!1),this.inst.instanceMatrix.needsUpdate=!0}updateInstance(e,t){this.inst.setMatrixAt(t,e),this.inst.instanceMatrix.needsUpdate=!0}};let e_=L1;x(e_,"nullMatrix",new fn);const Bl=uo,Oy="$___Export_Components",tee="NEEDLE_components";var ire;class nee{constructor(){x(this,ire)}}ire=cf;class iee{constructor(e,t,n){x(this,"node");x(this,"nodeIndex");x(this,"nodeDef");this.node=e,this.nodeIndex=t,this.nodeDef=n}}class vF{constructor(){x(this,"parser");x(this,"nodeToObjectMap",{});x(this,"exportContext");x(this,"objectToNodeMap",{});x(this,"context");x(this,"writer")}get name(){return tee}registerExport(e){e.register(t=>{const n=t.serializeUserData.bind(t);return this.writer=t,t.serializeUserData=(i,r)=>{try{this.serializeUserData(i,r),n(i,r)}finally{this.afterSerializeUserData(i,r)}},this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,t){var i;const n=(i=e.userData)==null?void 0:i.components;!n||n.length<=0||(delete e.userData.components,e[Oy]=n)}afterSerializeUserData(e,t){if(e.type==="Scene"&&Bl&&console.log("DONE",JSON.stringify(t)),e[Oy]===void 0)return;const n=e[Oy];delete e[Oy],n!==null&&(e.userData.components=n)}writeNode(e,t){let n=this.writer.json.nodes.length;console.log(e.name,n,e.uuid);const i=new iee(e,n,t);this.exportContext[n]=i,this.objectToNodeMap[e.uuid]=n}afterParse(e){var t;Bl&&console.log("AFTER",e);for(const n in this.exportContext){const i=this.exportContext[n],r=i.node,o=i.nodeDef,l=i.nodeIndex,h=(t=r.userData)==null?void 0:t.components;if(!h||h.length<=0)continue;const u=new nee;o.extensions=o.extensions||{},o.extensions[this.name]=u,this.context.object=r,this.context.nodeId=l,this.context.objectToNode=this.objectToNodeMap;const f=[];for(const g of h){this.context.target=g;const m=Tie(g,this.context);m!==null&&f.push(m)}f.length>0&&(u[cf]=f,Bl&&console.log("DID WRITE",r,"nodeIndex",l,f))}}beforeRoot(){return Bl&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const t=e.parser,n=t==null?void 0:t.extensions;if(!n)return;const i=n[this.name];Bl&&console.log("After root",e,this.parser,n);const r=[];if(i===!0){const o=t.json.nodes;for(let l=0;l<o.length;l++){const h=await t.getDependency("node",l);this.nodeToObjectMap[l]=h}for(let l=0;l<o.length;l++){const h=o[l],u=l,f=h.extensions;if(!f)continue;const g=f[this.name];if(!g)continue;Bl&&console.log("NODE",h);const m=this.nodeToObjectMap[u];if(!m){console.error("Could not find object for node index: "+u,h,t);continue}QD(m),r.push(this.createComponents(m,g))}}await Promise.all(r)}async createComponents(e,t){if(!t)return;const n=t[cf];if(n){Bl&&console.log(e.name,n);for(const i in n){const r=n[i];Bl&&console.log("Serialized data",JSON.parse(JSON.stringify(r))),r&&this.parser&&await nM(this.parser,r),e.userData=e.userData||{},e.userData[cf]=e.userData[cf]||[],e.userData[cf].push(r)}}}}class xF extends Uc{constructor(){super(...arguments);x(this,"sceneRoot")}start(){this.startCoroutine(this.updateGltfBox())}*updateGltfBox(){for(;;)for(let t=0;t<10;t++)yield}}class Gl extends pt{constructor(){super(...arguments);x(this,"binary",!0);x(this,"objects",[]);x(this,"exporter");x(this,"ext")}async exportNow(t){console.log("DO EXPORT",this.objects);const n={binary:this.binary,pivot:Gl.calculateCenter(this.objects)},i=await this.export(this.objects,n);this.binary?t.endsWith(".glb")||(t+=".glb"):t.endsWith(".gltf")||(t+=".gltf"),this.binary?Gl.saveArrayBuffer(i,t):Gl.saveJson(i,t)}async export(t,n){var h;if(t===null||t.length<=0){console.log("no objects set to export");return}this.exporter||(this.exporter=new EM,this.exporter.register(u=>new H$(u)),this.ext=new vF,this.ext.registerExport(this.exporter)),Gl.filterTopmostParent(t);const i={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:(h=n==null?void 0:n.binary)!=null?h:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:Gl.collectAnimations(t)},r=new Ft;n!=null&&n.pivot&&r.position.sub(n.pivot),console.log("EXPORT",t),t.forEach(u=>{u&&(r.children.push(u),u.matrixAutoUpdate=!1,u.matrix.copy(u.matrixWorld),Ee.getComponentsInChildren(u,Xs).forEach(f=>{Ee.isActiveInHierarchy(f.gameObject)&&f.setInstancingEnabled(!1)}))});const o=new qD(r);return this.ext.context=o,new Promise((u,f)=>{var g;try{(g=this.exporter)==null||g.parse(r,m=>{l(),u(m)},m=>{l(),f(m)},i)}catch(m){console.error(m),f(m)}finally{console.log("FINALLY")}});function l(){t.forEach(u=>{!u||(u.matrixAutoUpdate=!0,Ee.getComponentsInChildren(u,Xs).forEach(f=>{Ee.isActiveInHierarchy(f.gameObject)&&f.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(t,n){this.save(new Blob([t],{type:"application/octet-stream"}),n)}static saveJson(t,n){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),n)}static save(t,n){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof t=="string"?i.href=t:i.href=URL.createObjectURL(t),i.download=n,i.click(),i.remove()}static collectAnimations(t,n){n=n||[];for(const i of t)!i||i.traverseVisible(r=>{r.animations&&r.animations.length>0&&n.push(...r.animations)});return n}static calculateCenter(t,n){const i=n||new q;return i.set(0,0,0),t.forEach(r=>{i.add(ni(r))}),console.log(i),i.divideScalar(t.length),i}static filterTopmostParent(t){if(!(t.length<=0))for(let n=0;n<t.length;n++){let i=t[n];if(!i){t.splice(n,1),n--;continue}for(;i.parent;){if(t.includes(i.parent)){t.splice(n,1),n--;break}i=i.parent}}}}var see=Object.defineProperty,ree=Object.getOwnPropertyDescriptor,MM=(a,e,t,n)=>{for(var i=n>1?void 0:n?ree(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&see(e,t,i),i};class rA extends pt{constructor(){super(...arguments);x(this,"isGizmo",!1);x(this,"color0");x(this,"color1");x(this,"gridHelper");x(this,"size");x(this,"divisions");x(this,"offset")}onEnable(){var i,r;if(this.isGizmo&&!Zg)return;const t=this.size,n=this.divisions;this.gridHelper||(this.gridHelper=new ED(t,n,(i=this.color0)!=null?i:new ye(.4,.4,.4),(r=this.color1)!=null?r:new ye(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset),this.gameObject.add(this.gridHelper))}}MM([we()],rA.prototype,"isGizmo",2);MM([we(ye)],rA.prototype,"color0",2);MM([we(ye)],rA.prototype,"color1",2);class oee extends _t{constructor(e,t){var C,S;const n=e.isCubeTexture,r=((S=n?(C=e.image[0])==null?void 0:C.width:e.image.width)!=null?S:1024)/4,o=Math.floor(Math.log2(r)),l=Math.pow(2,o),h=3*Math.max(l,16*7),u=4*l,f=[n?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/h}`,`#define CUBEUV_TEXEL_HEIGHT ${1/u}`,`#define CUBEUV_MAX_MIP ${o}.0`],g=`
        varying vec3 vWorldPosition;

        void main() 
        {

            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

        }
        `,m=f.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV

        varying vec3 vWorldPosition;

        uniform float radius;
        uniform float height;
        uniform float angle;

        #ifdef ENVMAP_TYPE_CUBE

            uniform samplerCube map;

        #else

            uniform sampler2D map;

        #endif

        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {

            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;

        }

        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {

            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;

        }

        vec3 project() 
        {

            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;

            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;

            } else {

                p = vec3( 0.0, 1.0, 0.0 );

            }

            return p;

        }

        #include <common>
        #include <cube_uv_reflection_fragment>

        void main() 
        {

            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE

                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;

            #else

                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;

            #endif

            gl_FragColor = vec4( outcolor, 1.0 );

            #include <tonemapping_fragment>
            #include <encodings_fragment>

        }
        `,A={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},v=new Yf(1,16),b=new js({uniforms:A,fragmentShader:m,vertexShader:g,side:ir});super(v,b)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var aee=Object.defineProperty,cee=Object.getOwnPropertyDescriptor,TM=(a,e,t,n)=>{for(var i=n>1?void 0:n?cee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&aee(e,t,i),i};class oA extends pt{constructor(){super(...arguments);x(this,"_scale",20);x(this,"_radius",100);x(this,"_height",100);x(this,"_lastEnvironment");x(this,"env");x(this,"_watcher")}set scale(t){var n;this._scale=t,(n=this.env)==null||n.scale.setScalar(t)}get scale(){return this._scale}set radius(t){this._radius=t,this.env&&(this.env.height=t)}get radius(){return this._radius}set height(t){this._height=t,this.env&&(this.env.height=t)}get height(){return this._height}onEnable(){this.updateProjection(),this._watcher||(this._watcher=new Rv(this.context.scene,"environment"),this._watcher.subscribeWrite(this.updateProjection.bind(this))),this._watcher.apply()}onDisable(){var t,n;(t=this._watcher)==null||t.revoke(),(n=this.env)==null||n.removeFromParent()}updateProjection(){!this.context.scene.environment||((!this.env||this.context.scene.environment!==this._lastEnvironment)&&(console.log("Create/Update Ground Projection",this.context.scene.environment.name),this.env=new oee(this.context.scene.environment)),this._lastEnvironment=this.context.scene.environment,this.env.parent||this.gameObject.add(this.env),this.env.scale.setScalar(this._scale),this.env.radius=this._radius,this.env.height=this._height,this.env.isObject3D===!0&&this.env.layers.set(2))}}TM([we()],oA.prototype,"scale",1);TM([we()],oA.prototype,"radius",1);TM([we()],oA.prototype,"height",1);var lee=Object.defineProperty,hee=Object.getOwnPropertyDescriptor,ic=(a,e,t,n)=>{for(var i=n>1?void 0:n?hee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&lee(e,t,i),i};function pC(a){return a*Math.PI/180}const KB=300,ZB=Ct("debuglights");class Qo extends pt{constructor(){super(...arguments);x(this,"type",0);x(this,"range",1);x(this,"spotAngle",1);x(this,"innerSpotAngle",1);x(this,"color",new ye(16777215));x(this,"_shadowNearPlane",.1);x(this,"_shadowBias",0);x(this,"_shadowNormalBias",1);x(this,"_shadows",1);x(this,"lightmapBakeType",4);x(this,"_intensity",1);x(this,"_shadowDistance");x(this,"shadowWidth");x(this,"shadowHeight");x(this,"_shadowResolution");x(this,"light");x(this,"_webXRStartedListener");x(this,"_webXREndedListener");x(this,"_webARRoot")}set shadowNearPlane(t){var n,i;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((i=(n=this.light)==null?void 0:n.shadow)==null?void 0:i.camera)!==void 0)){const r=this.light.shadow.camera;r.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var n,i;t!==this._shadowBias&&(this._shadowBias=t,((i=(n=this.light)==null?void 0:n.shadow)==null?void 0:i.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var n,i;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((i=(n=this.light)==null?void 0:n.shadow)==null?void 0:i.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t===1||t===2)}get shadows(){return this._shadows}set intensity(t){var n;if(this._intensity=t,this.light){let i=1;if(this.context.isInXR&&this._webARRoot){const r=(n=this._webARRoot)==null?void 0:n.arScale;typeof r=="number"&&r>0&&(i/=r)}this.light.intensity=t*i}}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const n=this.light;if(n){const i=n.shadow.camera;i.far=t,i.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const n=this.light;n&&(n.shadow.mapSize.set(t,t),n.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===2}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===1?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}updateIntensity(){this.intensity=this._intensity}awake(){var t;this.color=new ye((t=this.color)!=null?t:16777215)}onEnable(){this.createLight(),!this.isBaked&&(this.light&&(this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===1&&this.startCoroutine(this.updateMainLightRoutine(),qr.LateUpdate),this._webXRStartedListener=_i.addEventListener(tr.XRStarted,this.onWebXRStarted.bind(this)),this._webXREndedListener=_i.addEventListener(tr.XRStopped,this.onWebXREnded.bind(this)))}onDisable(){_i.removeEventListener(tr.XRStarted,this._webXRStartedListener),_i.removeEventListener(tr.XRStopped,this._webXREndedListener)}onWebXRStarted(){var t;this._webARRoot=(t=this.gameObject.getComponentInParent(ip))!=null?t:void 0,this.startCoroutine(this._updateLightIntensityInARRoutine())}*_updateLightIntensityInARRoutine(){for(;this.context.isInXR;){yield,this.updateIntensity();for(let t=0;t<30;t++)yield}}onWebXREnded(){this.updateIntensity()}createLight(){if(this.light)return;let t=this.selfIsLight;if(t)switch(this.light=this.gameObject,this.type){case 1:this.setDirectionalLight(this.light);break}else switch(this.type){case 1:const n=new Cv(this.color,this.intensity*Math.PI);if(n.position.set(0,0,-KB*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(n.target),$S(n.target,0,0,0),this.light=n,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),ZB){const l=new SD(this.light,.2,this.color);this.context.scene.add(l)}break;case 0:const i=new wv(this.color,this.intensity*Math.PI,this.range,pC(this.spotAngle/2),1-pC(this.innerSpotAngle/2)/pC(this.spotAngle/2),2);i.position.set(0,0,0),i.rotation.set(0,0,0),this.light=i;const r=i.target;i.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case 2:const o=new bv(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light!==void 0){this._intensity=this.light.intensity,this.shadows!==0?this.light.castShadow=!0:this.light.castShadow=!1,this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),this.light.shadow.bias=this.shadowBias*1e-5,this.light.shadow.normalBias=this.shadowNormalBias*1e-4;const n=this.light.shadow.camera;if(n.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?n.far=this._shadowDistance:n.far=KB*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)n.left=-this.shadowWidth/2,n.right=this.shadowWidth/2;else{const i=this.gameObject.scale.x;n.left*=i,n.right*=i}if(this.shadowHeight!==void 0)n.top=this.shadowHeight/2,n.bottom=-this.shadowHeight/2;else{const i=this.gameObject.scale.y;n.top*=i,n.bottom*=i}this.light.shadow.needsUpdate=!0,ZB&&this.context.scene.add(new MD(n)),this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===1&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}ic([we()],Qo.prototype,"type",2);ic([we(ye)],Qo.prototype,"color",2);ic([we()],Qo.prototype,"shadowNearPlane",1);ic([we()],Qo.prototype,"shadowBias",1);ic([we()],Qo.prototype,"shadowNormalBias",1);ic([we()],Qo.prototype,"shadows",1);ic([we()],Qo.prototype,"lightmapBakeType",2);ic([we()],Qo.prototype,"intensity",1);ic([we()],Qo.prototype,"shadowDistance",1);ic([we()],Qo.prototype,"shadowResolution",1);new q(0,0,0);var uee=Object.defineProperty,dee=Object.getOwnPropertyDescriptor,aA=(a,e,t,n)=>{for(var i=n>1?void 0:n?dee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&uee(e,t,i),i};const hf=Ct("debugLODs"),fee=Ct("noLODs");class rp{constructor(){x(this,"screenRelativeTransitionHeight");x(this,"distance");x(this,"renderers")}}aA([we()],rp.prototype,"screenRelativeTransitionHeight",2);aA([we()],rp.prototype,"distance",2);aA([we()],rp.prototype,"renderers",2);class pee{constructor(e,t){x(this,"model");x(this,"renderers");this.model=t,this.renderers=[];for(const n of t.renderers){const i=this.findRenderer(n,e.gameObject);i&&i.gameObject?this.renderers.push(i):hf&&console.warn("Renderer not found: "+n,e.gameObject)}}findRenderer(e,t){const n=Ee.foreachComponent(t,i=>{var o;return i.guid===e||((o=Object.getPrototypeOf(i))==null?void 0:o.guid)===e?i:null});if(n)return n;for(const i of t.children){const r=this.findRenderer(e,i);if(r)return r}return null}}class Jv extends pt{constructor(){super(...arguments);x(this,"fadeMode",0);x(this,"localReferencePoint");x(this,"lodCount",0);x(this,"size",0);x(this,"animateCrossFading",!1);x(this,"lodModels");x(this,"_lods",[]);x(this,"_settings",[]);x(this,"_lodsHandler");x(this,"_distanceFactor",1)}start(){if(!fee&&!this._lodsHandler&&!!this.gameObject&&(hf&&console.log(this),this.lodModels&&Array.isArray(this.lodModels))){let t=0,n=[];for(const r of this.lodModels){t=Math.max(r.distance,t);const o=new pee(this,r);this._lods.push(o);for(const l of o.renderers)n.includes(l)||n.push(l)}this._lodsHandler=new Array;for(let r=0;r<n.length;r++){const o=new _S;this._lodsHandler.push(o),this.gameObject.add(o)}const i=new Ft;hf&&console.log(n);for(let r=0;r<n.length;r++){const o=n[r],l=this._lodsHandler[r],h=o.gameObject;let u=0,f=0;hf&&console.log(r,h.name);for(const m of this._lods){let A=null;m.renderers.includes(o)?A=h:A=i,hf&&console.log("add",m.model.distance,A.name);const v=m.model.distance;f=v-u,u=Math.max(v,u),this.onAddLodLevel(l,A,v)}const g=u+f;hf&&console.log("cull",g),this.onAddLodLevel(l,i,g)}}}update(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(!!t)for(const n of this._lodsHandler)n.update(t)}onAddLodLevel(t,n,i){t.addLevel(n,i*this._distanceFactor);const r={lod:t,levelIndex:t.levels.length-1,distance:i};this._settings.push(r)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const n of this._settings){const i=n.lod.levels[n.levelIndex];i.distance=n.distance*t}}}}aA([we(q)],Jv.prototype,"localReferencePoint",2);aA([we(rp)],Jv.prototype,"lodModels",2);var mee=Object.defineProperty,gee=Object.getOwnPropertyDescriptor,Aee=(a,e,t,n)=>{for(var i=n>1?void 0:n?gee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&mee(e,t,i),i};class IM extends pt{constructor(){super(...arguments);x(this,"constraintActive",!0);x(this,"locked",!1);x(this,"sources",[])}}Aee([we(Ft)],IM.prototype,"sources",2);class wF extends pt{}class bF extends pt{}var yee=Object.defineProperty,_ee=Object.getOwnPropertyDescriptor,vee=(a,e,t,n)=>{for(var i=n>1?void 0:n?_ee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&yee(e,t,i),i};const mC=Ct("debugnestedgltf");class RM extends pt{constructor(){super(...arguments);x(this,"filePath");x(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var n;(n=this.filePath)==null||n.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var n,i,r,o,l,h;if(this._isLoadingOrDoneLoading)return;mC&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const u=new Go;u.idProvider=new Aa(this.hash(this.guid)),u.parent=t,this.gameObject.updateMatrix();const f=this.gameObject.matrix;mC&&console.log("Load nested:",(i=(n=this.filePath)==null?void 0:n.uri)!=null?i:this.filePath,this.gameObject.position);const g=await((o=(r=this.filePath)==null?void 0:r.instantiate)==null?void 0:o.call(this.filePath,u));g&&(g.matrixAutoUpdate=!1,g.matrix.identity(),g.applyMatrix4(f),g.matrixAutoUpdate=!0),this.destroy(),mC&&console.log("Nested loading done:",(h=(l=this.filePath)==null?void 0:l.uri)!=null?h:this.filePath,g)}}hash(t){let n=0;for(let i=0;i<t.length;i++)n=t.charCodeAt(i)+((n<<5)-n);return n}}vee([we(Ho)],RM.prototype,"filePath",2);var xee=Object.defineProperty,wee=Object.getOwnPropertyDescriptor,Kv=(a,e,t,n)=>{for(var i=n>1?void 0:n?wee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&xee(e,t,i),i};class op extends pt{constructor(){super(...arguments);x(this,"referenceSpace");x(this,"from");x(this,"affectPosition",!1);x(this,"affectRotation",!1);x(this,"alignLookDirection",!1);x(this,"levelLookDirection",!1);x(this,"levelPosition",!1);x(this,"positionOffset",new q(0,0,0));x(this,"rotationOffset",new q(0,0,0));x(this,"offset",new q(0,0,0))}update(){if(!this.from)return;var t=ni(this.from),n=ga(this.from);this.offset.copy(this.positionOffset);const i=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(i),t.add(this.offset),this.levelPosition&&this.referenceSpace){const h=new Oo(this.gameObject.up,0),u=ni(this.referenceSpace);h.setFromNormalAndCoplanarPoint(this.gameObject.up,u);const f=new q(0,0,0);h.projectPoint(t,f),t.copy(f)}this.affectPosition&&sr(this.gameObject,t);const r=new _s(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new kt().setFromEuler(r);this.affectRotation&&Za(this.gameObject,n.multiply(o));let l=new q;this.from.getWorldDirection(l).multiplyScalar(50),this.levelLookDirection&&(l.y=0),this.alignLookDirection&&this.gameObject.lookAt(l)}}Kv([we(Ee)],op.prototype,"referenceSpace",2);Kv([we(Ee)],op.prototype,"from",2);Kv([we(q)],op.prototype,"positionOffset",2);Kv([we(q)],op.prototype,"rotationOffset",2);class CF{constructor(){x(this,"randomizeRotationDirection",0);x(this,"duration",5);x(this,"loop",!0);x(this,"prewarm",!1);x(this,"startDelay");x(this,"startDelayMultiplier",0);x(this,"startLifetime");x(this,"startLifetimeMultiplier",5);x(this,"startSpeed");x(this,"startSpeedMultiplier",5);x(this,"startSize3D",!1);x(this,"startSize");x(this,"startSizeMultiplier",1);x(this,"startSizeX");x(this,"startSizeXMultiplier",1);x(this,"startSizeY");x(this,"startSizeYMultiplier",1);x(this,"startSizeZ");x(this,"startSizeZMultiplier",1);x(this,"startRotation3D",!1);x(this,"startRotation");x(this,"startRotationMultiplier",0);x(this,"startRotationX");x(this,"startRotationXMultiplier",0);x(this,"startRotationY");x(this,"startRotationYMultiplier",0);x(this,"startRotationZ");x(this,"startRotationZMultiplier",0);x(this,"flipRotation",0);x(this,"startColor",new ye(1,1,1));x(this,"startColor1",new ye(0,0,0));x(this,"gravityModifier");x(this,"gravityModifierMultiplier",0);x(this,"simulationSpace",0);x(this,"customSimulationSpace",null);x(this,"simulationSpeed",1);x(this,"useUnscaledTime",!1);x(this,"scalingMode",1);x(this,"playOnAwake",!0);x(this,"maxParticles",1e3);x(this,"emitterVelocityMode",1);x(this,"stopAction",0);x(this,"ringBufferMode",0);x(this,"ringBufferLoopRange",new Xe(0,1));x(this,"cullingMode",0)}}class EF{constructor(){x(this,"burstCount",0);x(this,"enabled",!0);x(this,"rate",10);x(this,"rateMutliplier",1);x(this,"rateOverDistance",0);x(this,"rateOverDistanceMultiplier",0);x(this,"rateOverTime",0);x(this,"rateOverTimeMultiplier",0)}}class SF{constructor(){x(this,"shapeType",Bc.Box);x(this,"enabled",!0);x(this,"alignToDirection",!1);x(this,"angle",0);x(this,"arc",360);x(this,"arcmode",0);x(this,"box",new q(1,1,1));x(this,"boxThickness",new q(0,0,0));x(this,"position",new q(0,0,0));x(this,"rotation",new q(0,0,0));x(this,"scale",new q(1,1,1));x(this,"radius",1);x(this,"sphericalDirectionAmount",0)}}var Bc=(a=>(a[a.Sphere=0]="Sphere",a[a.SphereShell=1]="SphereShell",a[a.Hemisphere=2]="Hemisphere",a[a.HemisphereShell=3]="HemisphereShell",a[a.Cone=4]="Cone",a[a.Box=5]="Box",a[a.Mesh=6]="Mesh",a[a.ConeVolume=7]="ConeVolume",a[a.Circle=10]="Circle",a[a.SingleSidedEdge=11]="SingleSidedEdge",a[a.MeshRenderer=12]="MeshRenderer",a[a.SkinnedMeshRenderer=13]="SkinnedMeshRenderer",a[a.BoxShell=14]="BoxShell",a[a.BoxEdge=15]="BoxEdge",a[a.Donut=16]="Donut",a[a.Rectangle=17]="Rectangle",a[a.Sprite=18]="Sprite",a[a.SpriteRenderer=19]="SpriteRenderer",a))(Bc||{});const bee=Ct("debugparticles");class Cee{constructor(){x(this,"age",0);x(this,"lifetime",0);x(this,"position");x(this,"velocity");x(this,"color")}}class PM extends pt{constructor(){super(...arguments);x(this,"sharedMaterial");x(this,"mesh")}get mainTexture(){if(this.sharedMaterial){const t=this.context.assets.findTexture(this.sharedMaterial);if(t)return t}return null}getMesh(t){return this.mesh?this.context.assets.findMesh(this.mesh):null}awake(){bee&&console.log(this)}}class MF extends pt{constructor(){super(...arguments);x(this,"main");x(this,"emission");x(this,"shape");x(this,"renderer");x(this,"geometry");x(this,"material");x(this,"particlesMesh");x(this,"positions");x(this,"positionsArray");x(this,"particleStates",[]);x(this,"activeCount",0);x(this,"shapeRotation",new kt);x(this,"tempVec3",new q);x(this,"tempQuat",new kt)}awake(){this.renderer=Ee.getComponent(this.gameObject,PM),console.log(this)}onEnable(){if(this.geometry)return;this.particleStates=[],this.shapeRotation.setFromEuler(new _s(this.shape.rotation.x,this.shape.rotation.y,this.shape.rotation.z)),this.geometry=new Sn,this.positionsArray=new Float32Array(this.main.maxParticles*3),this.positions=new tn(this.positionsArray,3),this.geometry.setAttribute("position",this.positions);const t=new Float32Array(this.main.maxParticles*3);for(let i=0;i<t.length;i++)t[i*3]=1,t[i*3+1]=1,t[i*3+2]=1;const n=new tn(t,3);this.geometry.setAttribute("color",n),this.material=new kg({size:this.main.startSize,color:16777215,vertexColors:!0}),this.material.map=this.renderer.mainTexture,this.particlesMesh=new yv(this.geometry,this.material),this.particlesMesh.layers.enable(2),this.gameObject.add(this.particlesMesh),this.activeCount=this.main.prewarm?this.main.maxParticles:0}emit(t){var i;const n=this.activeCount;for(let r=0;r<n;r+=1){if(r>=this.particleStates.length){const l=new Cee;l.lifetime=(i=this.main.startLifetime)!=null?i:1,l.position=new q,l.velocity=new q,l.color=new ye(1,0,0),this.particleStates.push(l),this.initializeParticle(r,l),l.age=l.lifetime*Math.random()}const o=this.particleStates[r];if(o.age>o.lifetime){this.activeCount-=1,this.activeCount=Math.max(0,this.activeCount),this.initializeParticle(r,o);continue}o.age+=t,this.particleStates[r]=o}this.activeCount+=t*this.emission.rate,this.activeCount=Math.min(this.main.maxParticles,this.activeCount)}initializeParticle(t,n){if(!this.geometry)return;n.age=0,n.color.set(this.main.startColor),this.main.startColor1&&n.color.lerp(this.main.startColor1,Math.random()),this.geometry.attributes.color.needsUpdate=!0,this.assignPosition(n.position),this.assignVelocity(n.position,n.velocity);const i=n.position;i.multiply(this.shape.scale),i.applyQuaternion(this.shapeRotation),i.add(this.shape.position),this.particleStates.splice(t,1),this.particleStates.push(n)}updateOverLifetime(t,n){}assignPosition(t){switch(this.shape.shapeType){case Bc.Sphere:t.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).multiplyScalar(this.shape.radius);break;case Bc.Box:t.set(Math.random()-.5,Math.random()-.5,Math.random()-.5);break;default:t.set(0,0,0);break}}assignVelocity(t,n){switch(this.shape.shapeType){case Bc.Sphere:n.set(t.x,t.y,t.z);break;case Bc.Box:n.set(0,0,1),this.shape.sphericalDirectionAmount>0&&(this.tempVec3.set(t.x,t.y,t.z).multiply(this.shape.scale).normalize(),n.lerp(this.tempVec3,this.shape.sphericalDirectionAmount));break;case Bc.Cone:const i=new q(0,1,0);n.copy(i);break;case Bc.Circle:this.tempQuat.setFromAxisAngle(this.tempVec3.set(0,0,1),Math.random()*Ci.toRadians(this.shape.arc)),n.copy(this.tempVec3.set(1,0,0).applyQuaternion(this.tempQuat));break;default:n.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1);break}switch(n.normalize(),this.shape.shapeType){case Bc.Circle:t.add(n).multiplyScalar(this.shape.radius);break}n.multiplyScalar(this.main.startSpeedMultiplier)}}function*Eee(a,e=null){const t=e?e.time:ui.Current.time,n=t.time;for(;t.time-n<a;)yield}class ah extends pt{constructor(){super(...arguments);x(this,"_didAssignPlayerColor",!1)}awake(){this.context.connection.beginListen(Ds.JoinedRoom,this.tryAssignColor.bind(this))}onEnable(){this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}*waitForConnection(){for(;!this.destroyed&&this.enabled&&(yield Eee(.2),!this.tryAssignColor()););}tryAssignColor(){const t=Ee.getComponentInParent(this.gameObject,nr);return t&&t.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(t.connectionId),!0):!1}assignUserColor(t){const n=ah.hashCode(t),i=ah.colorFromHashCode(n);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(i,t,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(i,t,o)}}assignColor(t,n,i){let r=i.material;!r||(r._playerMaterial!==n&&(r=r.clone(),r._playerMaterial=n,i.material=r),r.color=t)}static hashCode(t){var n=0,i,r;if(t.length===0)return n;for(i=0;i<t.length;i++)r=t.charCodeAt(i),n=(n<<5)-n+r,n|=0;return n}static colorFromHashCode(t){const n=(t&16711680)>>16,i=(t&65280)>>8,r=t&255;return new ye(n/255,i/255,r/255)}}function See(){return new Promise((a,e)=>{let n=()=>{n!=null&&(document.removeEventListener("pointerdown",n),document.removeEventListener("click",n),document.removeEventListener("dragstart",n),document.removeEventListener("touchstart",n),a())};document.addEventListener("pointerdown",n),document.addEventListener("click",n),document.addEventListener("dragstart",n),document.addEventListener("touchstart",n)})}async function Mee(a){await See(),a()}var TF=(a=>(a[a.Quad=0]="Quad",a))(TF||{});class Tee{static createPrimitive(e,t){var i;let n;switch(e){case 0:const r=new Yr(1,1,1,1),o=(i=t==null?void 0:t.material)!=null?i:new Hi({color:16777215});n=new _t(r,o)}return t!=null&&t.name&&(n.name=t.name),n}}var Iee=Object.defineProperty,Ree=Object.getOwnPropertyDescriptor,ba=(a,e,t,n)=>{for(var i=n>1?void 0:n?Ree(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Iee(e,t,i),i};const gC=Ct("debugvideo");var IF=(a=>(a[a.CameraFarPlane=0]="CameraFarPlane",a[a.CameraNearPlane=1]="CameraNearPlane",a[a.RenderTexture=2]="RenderTexture",a[a.MaterialOverride=3]="MaterialOverride",a))(IF||{});class Dr extends pt{constructor(){super();x(this,"renderer",null);x(this,"playOnAwake",!0);x(this,"playOnEnable");x(this,"aspectMode",0);x(this,"renderMode");x(this,"targetMaterialProperty");x(this,"targetMaterialRenderer");x(this,"targetTexture");x(this,"time",0);x(this,"_playbackSpeed",1);x(this,"_isLooping",!1);x(this,"_crossOrigin","anonymous");x(this,"audioOutputMode",1);x(this,"source");x(this,"clip",null);x(this,"url",null);x(this,"videoElement",null);x(this,"_videoTexture",null);x(this,"videoMaterial",null);x(this,"_isPlaying",!1);x(this,"wasPlaying",!1);x(this,"_receivedInput",!1);x(this,"_overlay",null);x(this,"_targetObjects");x(this,"_updateAspectRoutineId",-1);Mee(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],Ct("videoscreenspace")&&window.addEventListener("keydown",t=>{t.key==="f"&&(this.screenspace=!this.screenspace)})}get playbackSpeed(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.playbackRate)!=null?n:this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this.videoElement&&(this.videoElement.playbackRate=t)}get isLooping(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.loop)!=null?n:this._isLooping}set isLooping(t){this._isLooping=t,this.videoElement&&(this.videoElement.loop=t)}get currentTime(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.currentTime)!=null?n:this.time}set currentTime(t){this.videoElement?this.videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this.videoElement;return t?t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA:!1}get crossOrigin(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.crossOrigin)!=null?n:this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this.videoElement&&(t!==null?this.videoElement.setAttribute("crossorigin",t):this.videoElement.removeAttribute("crossorigin"))}get videoTexture(){return this._videoTexture}setVideo(t){this.clip=t,this.source=0,this.videoElement?(this.videoElement.srcObject=t,this._isPlaying&&this.videoElement.play(),this.updateAspect()):this.create(!0)}setClipURL(t){this.url!==t&&(this.url=t,this.source=1,gC&&console.log("set url",t),this.videoElement?(this.videoElement.src=t,this._isPlaying&&(this.stop(),this.play())):this.create(!0))}awake(){this.create(this.playOnAwake),window.addEventListener("visibilitychange",t=>{switch(document.visibilityState){case"hidden":this.wasPlaying=this._isPlaying,this.pause();break;case"visible":this.wasPlaying&&this.play();break}})}onEnable(){var t,n;this.playOnEnable===!0&&this.handleBeginPlaying(!0),this.screenspace?(t=this._overlay)==null||t.start():(n=this._overlay)==null||n.stop()}onDisable(){this.pause()}onDestroy(){var t;this.videoElement&&((t=this.videoElement.parentElement)==null||t.removeChild(this.videoElement),this.videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var t,n,i;!this.videoElement||this._isPlaying&&!((t=this.videoElement)!=null&&t.ended)&&!((n=this.videoElement)!=null&&n.paused)||(this._isPlaying=!0,this._receivedInput||(this.videoElement.muted=!0),this.updateVideoElementSettings(),(i=this.videoElement)==null||i.play().catch(r=>{console.warn(r)}),gC&&console.log("play",this.videoElement))}stop(){this._isPlaying=!1,this.videoElement&&(this.videoElement.currentTime=0,this.videoElement.pause())}pause(){var t;this._isPlaying=!1,(t=this.videoElement)==null||t.pause()}create(t){var i,r;let n;switch(this.source){case 0:n=this.clip;break;case 1:n=this.url;break}if(!!n){if(this.videoElement||(this.videoElement=this.createVideoElement(),(i=this.context.domElement)==null||i.prepend(this.videoElement),this.updateVideoElementStyles()),typeof n=="string"){this.videoElement.src=n;const o=(r=this.videoElement.captureStream)==null?void 0:r.call(this.videoElement);this.clip=o}else this.videoElement.srcObject=n;this._videoTexture||(this._videoTexture=new J2(this.videoElement)),this._videoTexture.flipY=!1,this._videoTexture.encoding=Gn,this.handleBeginPlaying(t),console.log(this)}}updateAspect(){this.aspectMode!==0&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var t,n;return(n=(t=this._overlay)==null?void 0:t.enabled)!=null?n:!1}set screenspace(t){var n;if(t){if(!this._videoTexture)return;this._overlay||(this._overlay=new Pee(this.context)),this._overlay.add(this._videoTexture)}else(n=this._overlay)==null||n.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=t)}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),gC&&console.log("create video elment",t),t}handleBeginPlaying(t){var r,o;if(!this.enabled||!this.videoElement)return;this._targetObjects.length=0;let n=this.gameObject;switch(this.renderMode){case 3:n=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,n||(n=(o=Ee.getComponent(this.gameObject,Xs))==null?void 0:o.gameObject);break;case 2:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!n){console.error("Missing target for video material renderer",this.name,IF[this.renderMode],this);return}const i=n.material;if(i)if(this._targetObjects.push(n),i!==this.videoMaterial&&(this.videoMaterial=i.clone(),n.material=this.videoMaterial),!this.targetMaterialProperty)this.videoMaterial.map=this._videoTexture;else switch(this.targetMaterialProperty){default:this.videoMaterial.map=this._videoTexture;break}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&this.play()}updateVideoElementSettings(){!this.videoElement||(this.videoElement.loop=this._isLooping,this.videoElement.currentTime=this.currentTime,this.videoElement.playbackRate=this._playbackSpeed,this.videoElement.playsInline=!0,this.videoElement.muted=!this._receivedInput&&this.audioOutputMode!==0,(this.playOnAwake||this.playOnEnable)&&(this.videoElement.autoplay=!0))}updateVideoElementStyles(){!this.videoElement||(this.videoElement.style.userSelect="none",this.videoElement.style.visibility="hidden",this.videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const t=++this._updateAspectRoutineId,n=void 0,i=this.clip;for(;t===this._updateAspectRoutineId&&this.aspectMode!==0&&this.clip&&i===this.clip&&this._isPlaying;){if(!i||typeof i=="string")return;let r;for(const o of i.getVideoTracks()){const l=o.getSettings();if(l&&l.width&&l.height){r=l.width/l.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(n===r){yield;continue}for(const o of this._targetObjects){let l=1;if(o.parent){const h=kD(o.parent);l=h.x/h.y}switch(this.aspectMode){case 1:o.scale.y=1/r*o.scale.x*l;break;case 2:o.scale.x=r*o.scale.y*l;break}}for(let o=0;o<3;o++)yield}}}ba([we(Ft)],Dr.prototype,"renderer",2);ba([we()],Dr.prototype,"playOnAwake",2);ba([we()],Dr.prototype,"playOnEnable",2);ba([we()],Dr.prototype,"aspectMode",2);ba([we()],Dr.prototype,"renderMode",2);ba([we()],Dr.prototype,"targetMaterialProperty",2);ba([we(Xs)],Dr.prototype,"targetMaterialRenderer",2);ba([we(Ii)],Dr.prototype,"targetTexture",2);ba([we()],Dr.prototype,"time",2);ba([we()],Dr.prototype,"playbackSpeed",1);ba([we()],Dr.prototype,"isLooping",1);class Pee{constructor(e){x(this,"context");x(this,"_videos",[]);x(this,"_screenspaceModeQuad");x(this,"_isInScreenspaceMode",!1);x(this,"_input");this.context=e,this._input=new Bee(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const t=this._videos.indexOf(e);t>=0&&this._videos.splice(t,1)}start(){var i;if(this._isInScreenspaceMode||this._videos.length<0)return;const e=this._videos[this._videos.length-1];if(!e)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Tee.createPrimitive(TF.Quad,{material:new Lee(e)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const t=this._screenspaceModeQuad;this.context.scene.add(t),this.updateScreenspaceMaterialUniforms();const n=t.material;n==null||n.reset(),(i=this._input)==null||i.enable(n)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var t;const e=(t=this._screenspaceModeQuad)==null?void 0:t.material;!e||(e.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class Bee{constructor(e){x(this,"_onResizeScreenFn");x(this,"_onKeyUpFn");x(this,"_onMouseWheelFn");x(this,"context");x(this,"overlay");x(this,"_material");x(this,"_isPinching",!1);x(this,"_lastPinch",0);this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=i=>{i.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=i=>{this.overlay.enabled&&(e.zoom+=i.deltaY*5e-4,i.preventDefault())},{passive:!1});const t=new Xe;window.addEventListener("mousemove",i=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new Xe(i.movementX,i.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,t.set(r.x,r.y),t.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(t)}}),window.addEventListener("pointermove",i=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(t.set(i.movementX,i.movementY),t.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(t))});let n=0;window.addEventListener("touchstart",i=>{if(i.touches.length<2){this.context.time.time-n<.3&&this.overlay.stop(),n=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",i=>{if(!this._isPinching||!this._material)return;const r=i.touches[0],o=i.touches[1],l=r.clientX-o.clientX,h=r.clientY-o.clientY,u=Math.sqrt(l*l+h*h);if(this._lastPinch!==0){const f=u-this._lastPinch;this._material.zoom-=f*.004}this._lastPinch=u}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class Lee extends js{constructor(t){super();x(this,"_offset",new Xe);this.uniforms={map:{value:t},screenAspect:{value:1},offsetScale:{value:new Bn(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
                gl_FragColor = texture2D(map, vUv);
        }
        `}set screenAspect(t){this.uniforms.screenAspect.value=t,this.needsUpdate=!0}set offset(t){const n=this.uniforms.offsetScale.value;n.x=t.x,n.y=t.y,this.uniforms.offsetScale.value=n,this.needsUpdate=!0}get offset(){const t=this.uniforms.offsetScale.value;return this._offset.set(t.x,t.y),this._offset}set zoom(t){const n=this.uniforms.offsetScale.value;t<.001&&(t=.001),n.z=t,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}class Dee extends $g{constructor(){super([ye,fo])}onDeserialize(e){if(e!=null)return e.a!==void 0?new fo(e.r,e.g,e.b,e.a):e.alpha!==void 0?new fo(e.r,e.g,e.b,e.alpha):new ye(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}new Dee;class Oee extends $g{constructor(){super(Ft)}onSerialize(e,t){if(t.objectToNode!==void 0&&e.uuid){const n=t.objectToNode[e.uuid];return uo&&console.log(n,e.name,e.uuid),{node:n}}}onDeserialize(e,t){var n;if(e){if(e.node!==void 0&&t.nodeToObject){const i=t.nodeToObject[e.node];return uo&&console.log("Deserialized object reference?",e,i,t==null?void 0:t.nodeToObject),i||console.warn("Did not find node: "+e.node,t.nodeToObject,t.object),i}else if(e.guid){if(!t.context){console.error("Missing context");return}let i,r=(n=t.gltf)==null?void 0:n.scene;return r&&(i=Ee.findByGuid(e.guid,r)),i||(i=Ee.findByGuid(e.guid,t.context.scene)),i?uo&&console.log("Deserialized object reference?",e,i,t==null?void 0:t.nodeToObject):console.warn("could not resolve reference",e,t.target,t.path,t.context.scene),i}}}}const Fee=new Oee;class kee extends $g{constructor(){super([Do,pt])}onSerialize(e,t){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,t){var n;if(e!=null&&e.guid){uo&&console.log(e.guid,t.root,t.object,t.target);const i=this.findObjectForGuid(e.guid,t.root);if(i)return i;if(t.context)return this.findObjectForGuid(e.guid,(n=t.context)==null?void 0:n.scene)}}findObjectForGuid(e,t){if(t.guid===e)return t;const n=Ee.foreachComponent(t,i=>{if(i.guid===e)return i},!1);if(n!==void 0)return n;for(let i=0;i<t.children.length;i++){const r=t.children[i],o=this.findObjectForGuid(e,r);if(o)return o}}}const AC=new kee;class Nee extends $g{constructor(){super([ya])}onSerialize(e,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,t){var n,i,r,o;if(e&&e.type==="EventList"){uo&&console.log("DESERIALIZE EVENT",e);const l=new Array;for(const f of e.calls){uo&&console.log(f);let g=AC.findObjectForGuid(f.target,t.root);!g&&((n=t.context)==null?void 0:n.scene)&&(g=AC.findObjectForGuid(f.target,(i=t.context)==null?void 0:i.scene));const m=((r=f.method)==null?void 0:r.length)>0;if(g&&m){const C=()=>console.warn(`Could not find method ${f.method} on object ${g.name}`,g,typeof g[f.method]);if(typeof g[f.method]!="function"){let S=!1;f.method.startsWith("set_")&&f.method.length>4&&(f.method=f.method.substring(4),g[f.method]!==void 0&&(S=!0)),S||C()}}let A,v=f.argument;f.argument!==void 0?(typeof v=="object"&&(v=Fee.onDeserialize(f.argument,t),v||(v=AC.onDeserialize(f.argument,t))),A=new xg(m?(...C)=>b(...C):void 0,f.enabled)):A=new xg(m?(...C)=>b(...C):void 0,f.enabled);const b=(...C)=>{const S=g[f.method];typeof S=="function"?v!==void 0?S==null||S.call(g,v):S==null||S.call(g,...C):g[f.method]=v};if(A.method||(A.__debuginfo=(o=t.object)==null?void 0:o.name),!g||!A.method){const C=t.object?"Current object: "+t.object.name+", "+t.object.guid:null;g?console.warn('EventList method not found: "'+f.method+'" on',g):console.warn("EventList is missing target - will be ignored",f.target,C,e)}else l.push(A)}const h=new ya(l);uo&&console.log(h);const u=t.target;return u!==void 0&&t.path!==void 0&&h.setEventTarget(t.path,u),h}}}new Nee;var Uee=Object.defineProperty,zee=Object.getOwnPropertyDescriptor,RF=(a,e,t,n)=>{for(var i=n>1?void 0:n?zee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Uee(e,t,i),i};const Gee=Ct("debugscreenshare");function t_(a){if(!!a)for(const e of a.getTracks())e.stop()}class Zv extends pt{constructor(){super(...arguments);x(this,"videoPlayer");x(this,"device",0);x(this,"_net");x(this,"_requestOpen",!1);x(this,"_currentStream",null);x(this,"_currentMode",0)}onPointerClick(){if(this.isReceiving){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var t;return((t=this._currentStream)==null?void 0:t.active)&&this._currentMode===1}get isReceiving(){if(this._currentMode===2){if(!this._currentStream||this._currentStream.active===!1)return!1;const t=this._currentStream.getTracks();for(const n of t)if(n.readyState==="live")return!0}return!1}awake(){console.log(this),Br.registerWaitForAllowAudio(()=>{this.videoPlayer&&this._currentStream&&this._currentMode===2&&this.videoPlayer.setVideo(this._currentStream)})}start(){var n;if(this.videoPlayer||(this.videoPlayer=(n=Ee.getComponent(this.gameObject,Dr))!=null?n:void 0),!this.videoPlayer){console.error("Screencapture did not find a VideoPlayer component");return}const t=n_.getOrCreate(this.context,this.guid);this._net=new Qee(this.context,t),this._net.enable(),this._net.addEventListener(PF.ReceiveVideo,this.onReceiveVideo.bind(this))}async share(){this._requestOpen=!0;try{if(this.videoPlayer){const t={echoCancellation:!0,autoGainControl:!1},n={video:t,audio:t};switch(this.device){case 1:this.tryShareUserCamera(n);break;case 0:if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const i=await navigator.mediaDevices.getDisplayMedia(n);this._requestOpen?this.setVideo(i,1):t_(i);break;case 2:const r=0,o=this.context.renderer.domElement.captureStream(r);this.setVideo(o,1);break}}}catch(t){if(t.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",t)}}close(){var t;this._requestOpen=!1,this._currentStream&&(console.warn("Close current stream / disposing resources"),(t=this._net)==null||t.stopSendingVideo(this._currentStream),t_(this._currentStream),this._currentMode=0,this._currentStream=null)}setVideo(t,n){var r;if(t===this._currentStream||(this.close(),!t||!this.videoPlayer))return;this._currentStream=t,this._requestOpen=!0,this._currentMode=n,this.videoPlayer.setVideo(t),n===1&&((r=this._net)==null||r.startSendingVideo(t)),t.addEventListener("ended",()=>{this.close()})}onReceiveVideo(t){this.setVideo(t.stream,2)}async tryShareUserCamera(t){const n=(await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="videoinput");console.log("Request camera",n);for(const i of n)try{if(!this._requestOpen)break;if(i.kind!=="videoinput")continue;const r=i.deviceId;t.video!==!1&&((typeof t.video>"u"||typeof t.video=="boolean")&&(t.video={}),t.video.deviceId=r);const o=await navigator.mediaDevices.getUserMedia(t);this._requestOpen?this.setVideo(o,1):t_(o),console.log("Selected camera",i);break}catch(r){console.warn(r)}}}RF([we(Dr)],Zv.prototype,"videoPlayer",2);RF([we()],Zv.prototype,"device",2);var PF=(a=>(a.Connected="peer-user-connected",a.ReceiveVideo="receive-video",a.Disconnected="peer-user-disconnected",a))(PF||{});class Hee{constructor(e,t){x(this,"type","receive-video");x(this,"stream");x(this,"target");this.stream=e,this.target=t}}class Vee{constructor(e,t){x(this,"guid");x(this,"peerId");x(this,"dontSave",!0);this.guid=e.id,this.peerId=t}}class Wee extends Lr{constructor(t,n,i){super();x(this,"userId");x(this,"direction");x(this,"call");x(this,"_stream",null);x(this,"_isDisposed",!1);this.userId=t,this.call=n,this.direction=i,this._stream=null,n.on("stream",r=>{if(console.log("Receive video",r.getAudioTracks(),r.getVideoTracks()),this._stream=r,i==="incoming"){const o=new Hee(r,this);this.dispatchEvent(o)}})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),t_(this._stream))}get isOpen(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connected"}get isClosed(){return!this.isOpen}}const Cf=class extends Lr{constructor(t,n){super();x(this,"id");x(this,"context");x(this,"_peer");x(this,"_incomingCalls",[]);x(this,"_outgoingCalls",[]);x(this,"_enabled",!1);x(this,"_enabledPeer",!1);x(this,"onConnectRoomFn",this.onConnectRoom.bind(this));x(this,"onUserJoinedOrLeftRoomFn",this.onUserJoinedOrLeftRoom.bind(this));x(this,"onPeerConnectFn",this.onPeerConnect.bind(this));x(this,"onPeerReceiveCallFn",this.onPeerReceivingCall.bind(this));this.context=t,this.id=n,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(t,n){if(Cf.instances.has(n))return Cf.instances.get(n);const i=new Cf(t,n);return Cf.instances.set(n,i),i}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(t){return this.id+"-"+t}getUserIdFromPeerId(t){return t.substring(this.id.length+1)}makeCall(t,n){var o;const i={metadata:{userId:this.context.connection.connectionId}},r=(o=this._peer)==null?void 0:o.call(t,n,i);if(r)return this.registerCall(r,"outgoing")}get peer(){return this._peer}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(Ds.JoinedRoom,this.onConnectRoomFn),this.context.connection.beginListen(Ds.UserJoinedRoom,this.onUserJoinedOrLeftRoomFn),this.context.connection.beginListen(Ds.UserLeftRoom,this.onUserJoinedOrLeftRoomFn),this.subscribePeerEvents())}disable(){!this._enabled||(this._enabled=!1,this.context.connection.stopListening(Ds.JoinedRoom,this.onConnectRoomFn),this.context.connection.stopListening(Ds.UserJoinedRoom,this.onUserJoinedOrLeftRoomFn),this.context.connection.stopListening(Ds.UserLeftRoom,this.onUserJoinedOrLeftRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}onUserJoinedOrLeftRoom(t){}setupPeer(){if(!!this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const t=this.getMyPeerId();this._peer=new k_(t)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){!this._peer||(this._peer.on("open",this.onPeerConnectFn),this._peer.on("call",this.onPeerReceiveCallFn))}unsubscribePeerEvents(){}onPeerConnect(t){Gee&&console.log("Peer connected as",t),this.context.connection.send("peer-user-connected",new Vee(this,t))}onPeerReceivingCall(t){t.answer(),this.registerCall(t,"incoming")}registerCall(t,n){const i=t.metadata;(!i||!i.userId)&&console.error("Missing call metadata",t);const r=i.userId;console.log(n==="incoming"?"Receive call from":"Make call to",t.metadata);const o=n==="incoming"?this._incomingCalls:this._outgoingCalls,l=new Wee(r,t,n);return o.push(l),t.on("error",h=>{console.error("Call error",h)}),t.on("close",()=>{console.log("Call ended",t.metadata),t.close();const h=o.indexOf(l);h!==-1&&o.splice(h,1)}),n==="incoming"&&(l.addEventListener("receive-video",h=>{this.dispatchEvent(h)}),t.on("stream",()=>{let h=setInterval(()=>{l.isOpen||(clearInterval(h),l.close())},2e3)})),l}};let n_=Cf;x(n_,"instances",new Map);class Qee extends Lr{constructor(t,n){super();x(this,"context");x(this,"peer");x(this,"_sendingVideoStreams",new Map);x(this,"onConnectRoomFn",this.onConnectRoom.bind(this));x(this,"onUserConnectedFn",this.onUserConnected.bind(this));x(this,"onUserLeftFn",this.onUserLeft.bind(this));this.context=t,this.peer=n}startSendingVideo(t){this._sendingVideoStreams.has(t)||(this._sendingVideoStreams.set(t,[]),this.updateSendingCalls())}stopSendingVideo(t){if(t){const n=this._sendingVideoStreams.get(t);if(n){console.log("Closing calls",n);for(const i of n)i.close()}this._sendingVideoStreams.delete(t),n&&console.log("Currently sending",this._sendingVideoStreams)}}enable(){this.peer.enable(),this.context.connection.beginListen("peer-user-connected",this.onUserConnectedFn),this.peer.addEventListener("receive-video",this.onReceiveVideo.bind(this))}disable(){this.peer.disable()}onReceiveVideo(t){console.log("RECEIVE VIDEO",t),this.dispatchEvent({type:"receive-video",target:this,stream:t.stream,userId:t.userId})}onConnectRoom(){}onUserConnected(t){if(this.peer.id===t.guid){console.log("USER CONNECTED",t);const n=this._sendingVideoStreams.keys().next().value;this.peer.makeCall(t.peerId,n)}}onUserLeft(t){this.stopCallsToUsersThatAreNotInTheRoomAnymore()}updateSendingCalls(){let t=!1;for(const n of this._sendingVideoStreams.keys()){const i=this._sendingVideoStreams.get(n)||[];for(const r of this.context.connection.usersInRoom()){if(r===this.context.connection.connectionId)continue;if(!i.find(l=>l.userId===r)){const l=this.peer.makeCall(this.peer.getPeerIdFromUserId(r),n);l&&(t=!0,i.push(l))}}this._sendingVideoStreams.set(n,i)}this.stopCallsToUsersThatAreNotInTheRoomAnymore(),t&&console.log("Currently sending",this._sendingVideoStreams)}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const t of this._sendingVideoStreams.keys()){const n=this._sendingVideoStreams.get(t);if(!!n)for(let i=n.length-1;i>=0;i--){const r=n[i];this.context.connection.userIsInRoom(r.userId)||(r.close(),n.splice(i,1))}}}}var jee=Object.defineProperty,qee=Object.getOwnPropertyDescriptor,BF=(a,e,t,n)=>{for(var i=n>1?void 0:n?qee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&jee(e,t,i),i};class $v extends pt{constructor(){super(...arguments);x(this,"mode",0);x(this,"shadowColor",new fo(0,0,0,1))}awake(){switch(this.mode){case 0:this.applyShadowMaterial();break;case 1:this.applyLightBlendMaterial();break}}applyLightBlendMaterial(){const t=Ee.getComponent(this.gameObject,Xs);if(t){const n=t.material;n.blending=y_,this.applyMaterialOptions(n),n.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
                
                // diffuse-only lighting with overdrive to somewhat compensate
                // for the loss of indirect lighting and to make it more visible.
                vec3 direct = reflectedLight.directDiffuse * 3.;
                float max = max(direct.r, max(direct.g, direct.b));
                
                // early out - we're simply returning direct lighting and some alpha based on it so it can 
                // be blended onto the scene.
                gl_FragColor = vec4(direct, max);
                return;
                `)}}}applyShadowMaterial(){var n;const t=Ee.getComponent(this.gameObject,Xs);if(t)if(((n=t.material)==null?void 0:n.type)!=="ShadowMaterial"){const i=new PS;i.color=this.shadowColor,i.opacity=this.shadowColor.alpha,this.applyMaterialOptions(i),t.material=i}else{const i=t.material;i.color=this.shadowColor,i.opacity=this.shadowColor.alpha,this.applyMaterialOptions(i)}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}BF([we()],$v.prototype,"mode",2);BF([we(fo)],$v.prototype,"shadowColor",2);class Xee extends kS{constructor(e){super(e),this.type=Fs}parse(e){const l=function(M,R){switch(M){case 1:console.error("THREE.RGBELoader Read Error: "+(R||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(R||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(R||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(R||""))}return-1},g=`
`,m=function(M,R,T){R=R||1024;let F=M.pos,D=-1,U=0,W="",J=String.fromCharCode.apply(null,new Uint16Array(M.subarray(F,F+128)));for(;0>(D=J.indexOf(g))&&U<R&&F<M.byteLength;)W+=J,U+=J.length,F+=128,J+=String.fromCharCode.apply(null,new Uint16Array(M.subarray(F,F+128)));return-1<D?(T!==!1&&(M.pos+=U+D+1),W+J.slice(0,D)):!1},A=function(M){const R=/^#\?(\S+)/,T=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,B=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,F=/^\s*FORMAT=(\S+)\s*$/,D=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,U={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let W,J;if(M.pos>=M.byteLength||!(W=m(M)))return l(1,"no header found");if(!(J=W.match(R)))return l(3,"bad initial token");for(U.valid|=1,U.programtype=J[1],U.string+=W+`
`;W=m(M),W!==!1;){if(U.string+=W+`
`,W.charAt(0)==="#"){U.comments+=W+`
`;continue}if((J=W.match(T))&&(U.gamma=parseFloat(J[1])),(J=W.match(B))&&(U.exposure=parseFloat(J[1])),(J=W.match(F))&&(U.valid|=2,U.format=J[1]),(J=W.match(D))&&(U.valid|=4,U.height=parseInt(J[1],10),U.width=parseInt(J[2],10)),U.valid&2&&U.valid&4)break}return U.valid&2?U.valid&4?U:l(3,"missing image size specifier"):l(3,"missing format specifier")},v=function(M,R,T){const B=R;if(B<8||B>32767||M[0]!==2||M[1]!==2||M[2]&128)return new Uint8Array(M);if(B!==(M[2]<<8|M[3]))return l(3,"wrong scanline width");const F=new Uint8Array(4*R*T);if(!F.length)return l(4,"unable to allocate buffer space");let D=0,U=0;const W=4*B,J=new Uint8Array(4),ee=new Uint8Array(W);let Q=T;for(;Q>0&&U<M.byteLength;){if(U+4>M.byteLength)return l(1);if(J[0]=M[U++],J[1]=M[U++],J[2]=M[U++],J[3]=M[U++],J[0]!=2||J[1]!=2||(J[2]<<8|J[3])!=B)return l(3,"bad rgbe scanline format");let Y=0,se;for(;Y<W&&U<M.byteLength;){se=M[U++];const ve=se>128;if(ve&&(se-=128),se===0||Y+se>W)return l(3,"bad scanline data");if(ve){const xe=M[U++];for(let Ae=0;Ae<se;Ae++)ee[Y++]=xe}else ee.set(M.subarray(U,U+se),Y),Y+=se,U+=se}const ae=B;for(let ve=0;ve<ae;ve++){let xe=0;F[D]=ee[ve+xe],xe+=B,F[D+1]=ee[ve+xe],xe+=B,F[D+2]=ee[ve+xe],xe+=B,F[D+3]=ee[ve+xe],D+=4}Q--}return F},b=function(M,R,T,B){const F=M[R+3],D=Math.pow(2,F-128)/255;T[B+0]=M[R+0]*D,T[B+1]=M[R+1]*D,T[B+2]=M[R+2]*D,T[B+3]=1},C=function(M,R,T,B){const F=M[R+3],D=Math.pow(2,F-128)/255;T[B+0]=Cu.toHalfFloat(Math.min(M[R+0]*D,65504)),T[B+1]=Cu.toHalfFloat(Math.min(M[R+1]*D,65504)),T[B+2]=Cu.toHalfFloat(Math.min(M[R+2]*D,65504)),T[B+3]=Cu.toHalfFloat(1)},S=new Uint8Array(e);S.pos=0;const I=A(S);if(I!==-1){const M=I.width,R=I.height,T=v(S.subarray(S.pos),M,R);if(T!==-1){let B,F,D;switch(this.type){case Ms:D=T.length/4;const U=new Float32Array(D*4);for(let J=0;J<D;J++)b(T,J*4,U,J*4);B=U,F=Ms;break;case Fs:D=T.length/4;const W=new Uint16Array(D*4);for(let J=0;J<D;J++)C(T,J*4,W,J*4);B=W,F=Fs;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:M,height:R,data:B,header:I.string,gamma:I.gamma,exposure:I.exposure,type:F}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,i){function r(o,l){switch(o.type){case Ms:case Fs:o.encoding=Ar,o.minFilter=vi,o.magFilter=vi,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,l)}return super.load(e,r,n,i)}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var $B={},PE=function(a){return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))},LF=function(a){return new Worker(a)};try{URL.revokeObjectURL(PE(""))}catch{PE=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},LF=function(e){return new Worker(e,{type:"module"})}}var Yee=function(a,e,t,n,i){var r=LF($B[e]||($B[e]=PE(a)));return r.onerror=function(o){return i(o.error,null)},r.onmessage=function(o){return i(null,o.data)},r.postMessage(t,n),r},di=Uint8Array,Qs=Uint16Array,qc=Uint32Array,ap=new di([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),cp=new di([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wg=new di([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DF=function(a,e){for(var t=new Qs(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];for(var i=new qc(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)i[r]=r-t[n]<<5|n;return[t,i]},OF=DF(ap,2),BM=OF[0],W_=OF[1];BM[28]=258,W_[258]=28;var FF=DF(cp,0),kF=FF[0],BE=FF[1],bg=new Qs(32768);for(var qi=0;qi<32768;++qi){var Ll=(qi&43690)>>>1|(qi&21845)<<1;Ll=(Ll&52428)>>>2|(Ll&13107)<<2,Ll=(Ll&61680)>>>4|(Ll&3855)<<4,bg[qi]=((Ll&65280)>>>8|(Ll&255)<<8)>>>1}var No=function(a,e,t){for(var n=a.length,i=0,r=new Qs(e);i<n;++i)++r[a[i]-1];var o=new Qs(e);for(i=0;i<e;++i)o[i]=o[i-1]+r[i-1]<<1;var l;if(t){l=new Qs(1<<e);var h=15-e;for(i=0;i<n;++i)if(a[i])for(var u=i<<4|a[i],f=e-a[i],g=o[a[i]-1]++<<f,m=g|(1<<f)-1;g<=m;++g)l[bg[g]>>>h]=u}else for(l=new Qs(n),i=0;i<n;++i)a[i]&&(l[i]=bg[o[a[i]-1]++]>>>15-a[i]);return l},Xc=new di(288);for(var qi=0;qi<144;++qi)Xc[qi]=8;for(var qi=144;qi<256;++qi)Xc[qi]=9;for(var qi=256;qi<280;++qi)Xc[qi]=7;for(var qi=280;qi<288;++qi)Xc[qi]=8;var Vf=new di(32);for(var qi=0;qi<32;++qi)Vf[qi]=5;var NF=No(Xc,9,0),UF=No(Xc,9,1),zF=No(Vf,5,0),GF=No(Vf,5,1),i_=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},Po=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(e&7)&t},s_=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(e&7)},cA=function(a){return(a/8|0)+(a&7&&1)},Uo=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof Qs?Qs:a instanceof qc?qc:di)(t-e);return n.set(a.subarray(e,t)),n},lA=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new di(0);var i=!e||t,r=!t||t.i;t||(t={}),e||(e=new di(n*3));var o=function(Ve){var gn=e.length;if(Ve>gn){var Xt=new di(Math.max(gn*2,Ve));Xt.set(e),e=Xt}},l=t.f||0,h=t.p||0,u=t.b||0,f=t.l,g=t.d,m=t.m,A=t.n,v=n*8;do{if(!f){t.f=l=Po(a,h,1);var b=Po(a,h+1,3);if(h+=3,b)if(b==1)f=UF,g=GF,m=9,A=5;else if(b==2){var M=Po(a,h,31)+257,R=Po(a,h+10,15)+4,T=M+Po(a,h+5,31)+1;h+=14;for(var B=new di(T),F=new di(19),D=0;D<R;++D)F[wg[D]]=Po(a,h+D*3,7);h+=R*3;for(var U=i_(F),W=(1<<U)-1,J=No(F,U,1),D=0;D<T;){var ee=J[Po(a,h,W)];h+=ee&15;var C=ee>>>4;if(C<16)B[D++]=C;else{var Q=0,Y=0;for(C==16?(Y=3+Po(a,h,3),h+=2,Q=B[D-1]):C==17?(Y=3+Po(a,h,7),h+=3):C==18&&(Y=11+Po(a,h,127),h+=7);Y--;)B[D++]=Q}}var se=B.subarray(0,M),ae=B.subarray(M);m=i_(se),A=i_(ae),f=No(se,m,1),g=No(ae,A,1)}else throw"invalid block type";else{var C=cA(h)+4,S=a[C-4]|a[C-3]<<8,I=C+S;if(I>n){if(r)throw"unexpected EOF";break}i&&o(u+S),e.set(a.subarray(C,I),u),t.b=u+=S,t.p=h=I*8;continue}if(h>v){if(r)throw"unexpected EOF";break}}i&&o(u+131072);for(var ve=(1<<m)-1,xe=(1<<A)-1,Ae=h;;Ae=h){var Q=f[s_(a,h)&ve],Ie=Q>>>4;if(h+=Q&15,h>v){if(r)throw"unexpected EOF";break}if(!Q)throw"invalid length/literal";if(Ie<256)e[u++]=Ie;else if(Ie==256){Ae=h,f=null;break}else{var Le=Ie-254;if(Ie>264){var D=Ie-257,De=ap[D];Le=Po(a,h,(1<<De)-1)+BM[D],h+=De}var $e=g[s_(a,h)&xe],vt=$e>>>4;if(!$e)throw"invalid distance";h+=$e&15;var ae=kF[vt];if(vt>3){var De=cp[vt];ae+=s_(a,h)&(1<<De)-1,h+=De}if(h>v){if(r)throw"unexpected EOF";break}i&&o(u+131072);for(var zt=u+Le;u<zt;u+=4)e[u]=e[u-ae],e[u+1]=e[u+1-ae],e[u+2]=e[u+2-ae],e[u+3]=e[u+3-ae];u=zt}}t.l=f,t.p=Ae,t.b=u,f&&(l=1,t.m=m,t.d=g,t.n=A)}while(!l);return u==e.length?e:Uo(e,0,u)},Da=function(a,e,t){t<<=e&7;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8},uf=function(a,e,t){t<<=e&7;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8,a[n+2]|=t>>>16},r_=function(a,e){for(var t=[],n=0;n<a.length;++n)a[n]&&t.push({s:n,f:a[n]});var i=t.length,r=t.slice();if(!i)return[Hc,0];if(i==1){var o=new di(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(T,B){return T.f-B.f}),t.push({s:-1,f:25001});var l=t[0],h=t[1],u=0,f=1,g=2;for(t[0]={s:-1,f:l.f+h.f,l,r:h};f!=i-1;)l=t[t[u].f<t[g].f?u++:g++],h=t[u!=f&&t[u].f<t[g].f?u++:g++],t[f++]={s:-1,f:l.f+h.f,l,r:h};for(var m=r[0].s,n=1;n<i;++n)r[n].s>m&&(m=r[n].s);var A=new Qs(m+1),v=Q_(t[f-1],A,0);if(v>e){var n=0,b=0,C=v-e,S=1<<C;for(r.sort(function(B,F){return A[F.s]-A[B.s]||B.f-F.f});n<i;++n){var I=r[n].s;if(A[I]>e)b+=S-(1<<v-A[I]),A[I]=e;else break}for(b>>>=C;b>0;){var M=r[n].s;A[M]<e?b-=1<<e-A[M]++-1:++n}for(;n>=0&&b;--n){var R=r[n].s;A[R]==e&&(--A[R],++b)}v=e}return[new di(A),v]},Q_=function(a,e,t){return a.s==-1?Math.max(Q_(a.l,e,t+1),Q_(a.r,e,t+1)):e[a.s]=t},LE=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new Qs(++e),n=0,i=a[0],r=1,o=function(h){t[n++]=h},l=1;l<=e;++l)if(a[l]==i&&l!=e)++r;else{if(!i&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(i),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(i);r=1,i=a[l]}return[t.subarray(0,n),e]},df=function(a,e){for(var t=0,n=0;n<e.length;++n)t+=a[n]*e[n];return t},Xm=function(a,e,t){var n=t.length,i=cA(e+2);a[i]=n&255,a[i+1]=n>>>8,a[i+2]=a[i]^255,a[i+3]=a[i+1]^255;for(var r=0;r<n;++r)a[i+r+4]=t[r];return(i+4+n)*8},DE=function(a,e,t,n,i,r,o,l,h,u,f){Da(e,f++,t),++i[256];for(var g=r_(i,15),m=g[0],A=g[1],v=r_(r,15),b=v[0],C=v[1],S=LE(m),I=S[0],M=S[1],R=LE(b),T=R[0],B=R[1],F=new Qs(19),D=0;D<I.length;++D)F[I[D]&31]++;for(var D=0;D<T.length;++D)F[T[D]&31]++;for(var U=r_(F,7),W=U[0],J=U[1],ee=19;ee>4&&!W[wg[ee-1]];--ee);var Q=u+5<<3,Y=df(i,Xc)+df(r,Vf)+o,se=df(i,m)+df(r,b)+o+14+3*ee+df(F,W)+(2*F[16]+3*F[17]+7*F[18]);if(Q<=Y&&Q<=se)return Xm(e,f,a.subarray(h,h+u));var ae,ve,xe,Ae;if(Da(e,f,1+(se<Y)),f+=2,se<Y){ae=No(m,A,0),ve=m,xe=No(b,C,0),Ae=b;var Ie=No(W,J,0);Da(e,f,M-257),Da(e,f+5,B-1),Da(e,f+10,ee-4),f+=14;for(var D=0;D<ee;++D)Da(e,f+3*D,W[wg[D]]);f+=3*ee;for(var Le=[I,T],De=0;De<2;++De)for(var $e=Le[De],D=0;D<$e.length;++D){var vt=$e[D]&31;Da(e,f,Ie[vt]),f+=W[vt],vt>15&&(Da(e,f,$e[D]>>>5&127),f+=$e[D]>>>12)}}else ae=NF,ve=Xc,xe=zF,Ae=Vf;for(var D=0;D<l;++D)if(n[D]>255){var vt=n[D]>>>18&31;uf(e,f,ae[vt+257]),f+=ve[vt+257],vt>7&&(Da(e,f,n[D]>>>23&31),f+=ap[vt]);var zt=n[D]&31;uf(e,f,xe[zt]),f+=Ae[zt],zt>3&&(uf(e,f,n[D]>>>5&8191),f+=cp[zt])}else uf(e,f,ae[n[D]]),f+=ve[n[D]];return uf(e,f,ae[256]),f+ve[256]},HF=new qc([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Hc=new di(0),VF=function(a,e,t,n,i,r){var o=a.length,l=new di(n+o+5*(1+Math.ceil(o/7e3))+i),h=l.subarray(n,l.length-i),u=0;if(!e||o<8)for(var f=0;f<=o;f+=65535){var g=f+65535;g<o?u=Xm(h,u,a.subarray(f,g)):(h[f]=r,u=Xm(h,u,a.subarray(f,o)))}else{for(var m=HF[e-1],A=m>>>13,v=m&8191,b=(1<<t)-1,C=new Qs(32768),S=new Qs(b+1),I=Math.ceil(t/3),M=2*I,R=function(xt){return(a[xt]^a[xt+1]<<I^a[xt+2]<<M)&b},T=new qc(25e3),B=new Qs(288),F=new Qs(32),D=0,U=0,f=0,W=0,J=0,ee=0;f<o;++f){var Q=R(f),Y=f&32767,se=S[Q];if(C[Y]=se,S[Q]=Y,J<=f){var ae=o-f;if((D>7e3||W>24576)&&ae>423){u=DE(a,h,0,T,B,F,U,W,ee,f-ee,u),W=D=U=0,ee=f;for(var ve=0;ve<286;++ve)B[ve]=0;for(var ve=0;ve<30;++ve)F[ve]=0}var xe=2,Ae=0,Ie=v,Le=Y-se&32767;if(ae>2&&Q==R(f-Le))for(var De=Math.min(A,ae)-1,$e=Math.min(32767,f),vt=Math.min(258,ae);Le<=$e&&--Ie&&Y!=se;){if(a[f+xe]==a[f+xe-Le]){for(var zt=0;zt<vt&&a[f+zt]==a[f+zt-Le];++zt);if(zt>xe){if(xe=zt,Ae=Le,zt>De)break;for(var Ve=Math.min(Le,zt-2),gn=0,ve=0;ve<Ve;++ve){var Xt=f-Le+ve+32768&32767,mn=C[Xt],Nt=Xt-mn+32768&32767;Nt>gn&&(gn=Nt,se=Xt)}}}Y=se,se=C[Y],Le+=Y-se+32768&32767}if(Ae){T[W++]=268435456|W_[xe]<<18|BE[Ae];var vn=W_[xe]&31,it=BE[Ae]&31;U+=ap[vn]+cp[it],++B[257+vn],++F[it],J=f+xe,++D}else T[W++]=a[f],++B[a[f]]}}u=DE(a,h,r,T,B,F,U,W,ee,f-ee,u),!r&&u&7&&(u=Xm(h,u+1,Hc))}return Uo(l,0,n+cA(u)+i)},WF=function(){for(var a=new qc(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;a[e]=t}return a}(),lp=function(){var a=-1;return{p:function(e){for(var t=a,n=0;n<e.length;++n)t=WF[t&255^e[n]]^t>>>8;a=t},d:function(){return~a}}},LM=function(){var a=1,e=0;return{p:function(t){for(var n=a,i=e,r=t.length,o=0;o!=r;){for(var l=Math.min(o+2655,r);o<l;++o)i+=n+=t[o];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}a=n,e=i},d:function(){return a%=65521,e%=65521,(a&255)<<24|a>>>8<<16|(e&255)<<8|e>>>8}}},Xu=function(a,e,t,n,i){return VF(a,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):12+e.mem,t,n,!i)},hA=function(a,e){var t={};for(var n in a)t[n]=a[n];for(var n in e)t[n]=e[n];return t},eL=function(a,e,t){for(var n=a(),i=a.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var l=n[o],h=r[o];if(typeof l=="function"){e+=";"+h+"=";var u=l.toString();if(l.prototype)if(u.indexOf("[native code]")!=-1){var f=u.indexOf(" ",8)+1;e+=u.slice(f,u.indexOf("(",f))}else{e+=u;for(var g in l.prototype)e+=";"+h+".prototype."+g+"="+l.prototype[g].toString()}else e+=u}else t[h]=l}return[e,t]},Fy=[],Jee=function(a){var e=[];for(var t in a)(a[t]instanceof di||a[t]instanceof Qs||a[t]instanceof qc)&&e.push((a[t]=new a[t].constructor(a[t])).buffer);return e},QF=function(a,e,t,n){var i;if(!Fy[t]){for(var r="",o={},l=a.length-1,h=0;h<l;++h)i=eL(a[h],r,o),r=i[0],o=i[1];Fy[t]=eL(a[l],r,o)}var u=hA({},Fy[t][1]);return Yee(Fy[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,u,Jee(u),n)},hp=function(){return[di,Qs,qc,ap,cp,wg,BM,kF,UF,GF,bg,No,i_,Po,s_,cA,Uo,lA,pp,_h,DM]},up=function(){return[di,Qs,qc,ap,cp,wg,W_,BE,NF,Xc,zF,Vf,bg,HF,Hc,No,Da,uf,r_,Q_,LE,df,Xm,DE,cA,Uo,VF,Xu,uA,_h]},jF=function(){return[OM,kM,Ti,lp,WF]},qF=function(){return[FM,JF]},XF=function(){return[NM,Ti,LM]},YF=function(){return[KF]},_h=function(a){return postMessage(a,[a.buffer])},DM=function(a){return a&&a.size&&new di(a.size)},dp=function(a,e,t,n,i,r){var o=QF(t,n,i,function(l,h){o.terminate(),r(l,h)});return o.postMessage([a,e],e.consume?[a.buffer]:[]),function(){o.terminate()}},Vo=function(a){return a.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return a.push(e.data[0],e.data[1])}},fp=function(a,e,t,n,i){var r,o=QF(a,n,i,function(l,h){l?(o.terminate(),e.ondata.call(e,l)):(h[1]&&o.terminate(),e.ondata.call(e,l,h[0],h[1]))});o.postMessage(t),e.push=function(l,h){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([l,r=h],[l.buffer])},e.terminate=function(){o.terminate()}},Ir=function(a,e){return a[e]|a[e+1]<<8},ys=function(a,e){return(a[e]|a[e+1]<<8|a[e+2]<<16|a[e+3]<<24)>>>0},yC=function(a,e){return ys(a,e)+ys(a,e+4)*4294967296},Ti=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},OM=function(a,e){var t=e.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=e.level<2?4:e.level==9?2:0,a[9]=3,e.mtime!=0&&Ti(a,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){a[3]=8;for(var n=0;n<=t.length;++n)a[n+10]=t.charCodeAt(n)}},FM=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var e=a[3],t=10;e&4&&(t+=a[10]|(a[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!a[t++]);return t+(e&2)},JF=function(a){var e=a.length;return(a[e-4]|a[e-3]<<8|a[e-2]<<16|a[e-1]<<24)>>>0},kM=function(a){return 10+(a.filename&&a.filename.length+1||0)},NM=function(a,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=n<<6|(n?32-2*n:1)},KF=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function UM(a,e){return!e&&typeof a=="function"&&(e=a,a={}),this.ondata=e,a}var $a=function(){function a(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return a.prototype.p=function(e,t){this.ondata(Xu(e,this.o,0,0,!t),t)},a.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},a}(),ZF=function(){function a(e,t){fp([up,function(){return[Vo,$a]}],this,UM.call(this,e,t),function(n){var i=new $a(n.data);onmessage=Vo(i)},6)}return a}();function $F(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return dp(a,e,[up],function(n){return _h(uA(n.data[0],n.data[1]))},0,t)}function uA(a,e){return Xu(a,e||{},0,0)}var jr=function(){function a(e){this.s={},this.p=new di(0),this.ondata=e}return a.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new di(t+e.length);n.set(this.p),n.set(e,t),this.p=n},a.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=lA(this.p,this.o,this.s);this.ondata(Uo(n,t,this.s.b),this.d),this.o=Uo(n,this.s.b-32768),this.s.b=this.o.length,this.p=Uo(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(e,t){this.e(e),this.c(t)},a}(),zM=function(){function a(e){this.ondata=e,fp([hp,function(){return[Vo,jr]}],this,0,function(){var t=new jr;onmessage=Vo(t)},7)}return a}();function GM(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return dp(a,e,[hp],function(n){return _h(pp(n.data[0],DM(n.data[1])))},1,t)}function pp(a,e){return lA(a,e)}var j_=function(){function a(e,t){this.c=lp(),this.l=0,this.v=1,$a.call(this,e,t)}return a.prototype.push=function(e,t){$a.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Xu(e,this.o,this.v&&kM(this.o),t&&8,!t);this.v&&(OM(n,this.o),this.v=0),t&&(Ti(n,n.length-8,this.c.d()),Ti(n,n.length-4,this.l)),this.ondata(n,t)},a}(),tL=function(){function a(e,t){fp([up,jF,function(){return[Vo,$a,j_]}],this,UM.call(this,e,t),function(n){var i=new j_(n.data);onmessage=Vo(i)},8)}return a}();function nL(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return dp(a,e,[up,jF,function(){return[q_]}],function(n){return _h(q_(n.data[0],n.data[1]))},2,t)}function q_(a,e){e||(e={});var t=lp(),n=a.length;t.p(a);var i=Xu(a,e,kM(e),8),r=i.length;return OM(i,e),Ti(i,r-8,t.d()),Ti(i,r-4,n),i}var X_=function(){function a(e){this.v=1,jr.call(this,e)}return a.prototype.push=function(e,t){if(jr.prototype.e.call(this,e),this.v){var n=this.p.length>3?FM(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}jr.prototype.c.call(this,t)},a}(),e3=function(){function a(e){this.ondata=e,fp([hp,qF,function(){return[Vo,jr,X_]}],this,0,function(){var t=new X_;onmessage=Vo(t)},9)}return a}();function t3(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return dp(a,e,[hp,qF,function(){return[Y_]}],function(n){return _h(Y_(n.data[0]))},3,t)}function Y_(a,e){return lA(a.subarray(FM(a),-8),e||new di(JF(a)))}var OE=function(){function a(e,t){this.c=LM(),this.v=1,$a.call(this,e,t)}return a.prototype.push=function(e,t){$a.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e);var n=Xu(e,this.o,this.v&&2,t&&4,!t);this.v&&(NM(n,this.o),this.v=0),t&&Ti(n,n.length-4,this.c.d()),this.ondata(n,t)},a}(),Kee=function(){function a(e,t){fp([up,XF,function(){return[Vo,$a,OE]}],this,UM.call(this,e,t),function(n){var i=new OE(n.data);onmessage=Vo(i)},10)}return a}();function Zee(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return dp(a,e,[up,XF,function(){return[FE]}],function(n){return _h(FE(n.data[0],n.data[1]))},4,t)}function FE(a,e){e||(e={});var t=LM();t.p(a);var n=Xu(a,e,2,4);return NM(n,e),Ti(n,n.length-4,t.d()),n}var J_=function(){function a(e){this.v=1,jr.call(this,e)}return a.prototype.push=function(e,t){if(jr.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}jr.prototype.c.call(this,t)},a}(),n3=function(){function a(e){this.ondata=e,fp([hp,YF,function(){return[Vo,jr,J_]}],this,0,function(){var t=new J_;onmessage=Vo(t)},11)}return a}();function i3(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return dp(a,e,[hp,YF,function(){return[Ql]}],function(n){return _h(Ql(n.data[0],DM(n.data[1])))},5,t)}function Ql(a,e){return lA((KF(a),a.subarray(2,-4)),e)}var s3=function(){function a(e){this.G=X_,this.I=jr,this.Z=J_,this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new di(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},a}(),$ee=function(){function a(e){this.G=e3,this.I=zM,this.Z=n3,this.ondata=e}return a.prototype.push=function(e,t){s3.prototype.push.call(this,e,t)},a}();function ete(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?t3(a,e,t):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?GM(a,e,t):i3(a,e,t)}function tte(a,e){return a[0]==31&&a[1]==139&&a[2]==8?Y_(a,e):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?pp(a,e):Ql(a,e)}var HM=function(a,e,t,n){for(var i in a){var r=a[i],o=e+i;r instanceof di?t[o]=[r,n]:Array.isArray(r)?t[o]=[r[0],hA(n,r[1])]:HM(r,o+"/",t,n)}},iL=typeof TextEncoder<"u"&&new TextEncoder,kE=typeof TextDecoder<"u"&&new TextDecoder,r3=0;try{kE.decode(Hc,{stream:!0}),r3=1}catch{}var o3=function(a){for(var e="",t=0;;){var n=a[t++],i=(n>127)+(n>223)+(n>239);if(t+i>a.length)return[e,Uo(a,t-1)];i?i==3?(n=((n&15)<<18|(a[t++]&63)<<12|(a[t++]&63)<<6|a[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|a[t++]&63):e+=String.fromCharCode((n&15)<<12|(a[t++]&63)<<6|a[t++]&63):e+=String.fromCharCode(n)}},nte=function(){function a(e){this.ondata=e,r3?this.t=new TextDecoder:this.p=Hc}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new di(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=o3(n),r=i[0],o=i[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(r,t)},a}(),ite=function(){function a(e){this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(ch(e),this.d=t||!1)},a}();function ch(a,e){if(e){for(var t=new di(a.length),n=0;n<a.length;++n)t[n]=a.charCodeAt(n);return t}if(iL)return iL.encode(a);for(var i=a.length,r=new di(a.length+(a.length>>1)),o=0,l=function(f){r[o++]=f},n=0;n<i;++n){if(o+5>r.length){var h=new di(o+8+(i-n<<1));h.set(r),r=h}var u=a.charCodeAt(n);u<128||e?l(u):u<2048?(l(192|u>>6),l(128|u&63)):u>55295&&u<57344?(u=65536+(u&1023<<10)|a.charCodeAt(++n)&1023,l(240|u>>18),l(128|u>>12&63),l(128|u>>6&63),l(128|u&63)):(l(224|u>>12),l(128|u>>6&63),l(128|u&63))}return Uo(r,0,o)}function VM(a,e){if(e){for(var t="",n=0;n<a.length;n+=16384)t+=String.fromCharCode.apply(null,a.subarray(n,n+16384));return t}else{if(kE)return kE.decode(a);var i=o3(a),r=i[0],o=i[1];if(o.length)throw"invalid utf-8 data";return r}}var a3=function(a){return a==1?3:a<6?2:a==9?1:0},c3=function(a,e){return e+30+Ir(a,e+26)+Ir(a,e+28)},l3=function(a,e,t){var n=Ir(a,e+28),i=VM(a.subarray(e+46,e+46+n),!(Ir(a,e+8)&2048)),r=e+46+n,o=ys(a,e+20),l=t&&o==4294967295?h3(a,r):[o,ys(a,e+24),ys(a,e+42)],h=l[0],u=l[1],f=l[2];return[Ir(a,e+10),h,u,i,r+Ir(a,e+30)+Ir(a,e+32),f]},h3=function(a,e){for(;Ir(a,e)!=1;e+=4+Ir(a,e+2));return[yC(a,e+12),yC(a,e+4),yC(a,e+20)]},Kl=function(a){var e=0;if(a)for(var t in a){var n=a[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Wf=function(a,e,t,n,i,r,o,l){var h=n.length,u=t.extra,f=l&&l.length,g=Kl(u);Ti(a,e,o!=null?33639248:67324752),e+=4,o!=null&&(a[e++]=20,a[e++]=t.os),a[e]=20,e+=2,a[e++]=t.flag<<1|(r==null&&8),a[e++]=i&&8,a[e++]=t.compression&255,a[e++]=t.compression>>8;var m=new Date(t.mtime==null?Date.now():t.mtime),A=m.getFullYear()-1980;if(A<0||A>119)throw"date not in range 1980-2099";if(Ti(a,e,A<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),e+=4,r!=null&&(Ti(a,e,t.crc),Ti(a,e+4,r),Ti(a,e+8,t.size)),Ti(a,e+12,h),Ti(a,e+14,g),e+=16,o!=null&&(Ti(a,e,f),Ti(a,e+6,t.attrs),Ti(a,e+10,o),e+=14),a.set(n,e),e+=h,g)for(var v in u){var b=u[v],C=b.length;Ti(a,e,+v),Ti(a,e+2,C),a.set(b,e+4),e+=4+C}return f&&(a.set(l,e),e+=f),e},WM=function(a,e,t,n,i){Ti(a,e,101010256),Ti(a,e+8,t),Ti(a,e+10,t),Ti(a,e+12,n),Ti(a,e+16,i)},Cg=function(){function a(e){this.filename=e,this.c=lp(),this.size=0,this.compression=0}return a.prototype.process=function(e,t){this.ondata(null,e,t)},a.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},a}(),ste=function(){function a(e,t){var n=this;t||(t={}),Cg.call(this,e),this.d=new $a(t,function(i,r){n.ondata(null,i,r)}),this.compression=8,this.flag=a3(t.level)}return a.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},a.prototype.push=function(e,t){Cg.prototype.push.call(this,e,t)},a}(),rte=function(){function a(e,t){var n=this;t||(t={}),Cg.call(this,e),this.d=new ZF(t,function(i,r,o){n.ondata(i,r,o)}),this.compression=8,this.flag=a3(t.level),this.terminate=this.d.terminate}return a.prototype.process=function(e,t){this.d.push(e,t)},a.prototype.push=function(e,t){Cg.prototype.push.call(this,e,t)},a}(),ote=function(){function a(e){this.ondata=e,this.u=[],this.d=1}return a.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=ch(e.filename),i=n.length,r=e.comment,o=r&&ch(r),l=i!=e.filename.length||o&&r.length!=o.length,h=i+Kl(e.extra)+30;if(i>65535)throw"filename too long";var u=new di(h);Wf(u,0,e,n,l);var f=[u],g=function(){for(var C=0,S=f;C<S.length;C++){var I=S[C];t.ondata(null,I,!1)}f=[]},m=this.d;this.d=0;var A=this.u.length,v=hA(e,{f:n,u:l,o,t:function(){e.terminate&&e.terminate()},r:function(){if(g(),m){var C=t.u[A+1];C?C.r():t.d=1}m=1}}),b=0;e.ondata=function(C,S,I){if(C)t.ondata(C,S,I),t.terminate();else if(b+=S.length,f.push(S),I){var M=new di(16);Ti(M,0,134695760),Ti(M,4,e.crc),Ti(M,8,b),Ti(M,12,e.size),f.push(M),v.c=b,v.b=h+b+16,v.crc=e.crc,v.size=e.size,m&&v.r(),m=1}else m&&g()},this.u.push(v)},a.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},a.prototype.e=function(){for(var e=0,t=0,n=0,i=0,r=this.u;i<r.length;i++){var o=r[i];n+=46+o.f.length+Kl(o.extra)+(o.o?o.o.length:0)}for(var l=new di(n+22),h=0,u=this.u;h<u.length;h++){var o=u[h];Wf(l,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+Kl(o.extra)+(o.o?o.o.length:0),t+=o.b}WM(l,e,this.u.length,n,t),this.ondata(null,l,!0),this.d=2},a.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},a}();function ate(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};HM(a,"",n,e);var i=Object.keys(n),r=i.length,o=0,l=0,h=r,u=new Array(r),f=[],g=function(){for(var b=0;b<f.length;++b)f[b]()},m=function(){var b=new di(l+22),C=o,S=l-o;l=0;for(var I=0;I<h;++I){var M=u[I];try{var R=M.c.length;Wf(b,l,M,M.f,M.u,R);var T=30+M.f.length+Kl(M.extra),B=l+T;b.set(M.c,B),Wf(b,o,M,M.f,M.u,R,l,M.m),o+=16+T+(M.m?M.m.length:0),l=B+R}catch(F){return t(F,null)}}WM(b,o,u.length,S,C),t(null,b)};r||m();for(var A=function(b){var C=i[b],S=n[C],I=S[0],M=S[1],R=lp(),T=I.length;R.p(I);var B=ch(C),F=B.length,D=M.comment,U=D&&ch(D),W=U&&U.length,J=Kl(M.extra),ee=M.level==0?0:8,Q=function(Y,se){if(Y)g(),t(Y,null);else{var ae=se.length;u[b]=hA(M,{size:T,crc:R.d(),c:se,f:B,m:U,u:F!=C.length||U&&D.length!=W,compression:ee}),o+=30+F+J+ae,l+=76+2*(F+J)+(W||0)+ae,--r||m()}};if(F>65535&&Q("filename too long",null),!ee)Q(null,I);else if(T<16e4)try{Q(null,uA(I,M))}catch(Y){Q(Y,null)}else f.push($F(I,M,Q))},v=0;v<h;++v)A(v);return g}function cte(a,e){e||(e={});var t={},n=[];HM(a,"",t,e);var i=0,r=0;for(var o in t){var l=t[o],h=l[0],u=l[1],f=u.level==0?0:8,g=ch(o),m=g.length,A=u.comment,v=A&&ch(A),b=v&&v.length,C=Kl(u.extra);if(m>65535)throw"filename too long";var S=f?uA(h,u):h,I=S.length,M=lp();M.p(h),n.push(hA(u,{size:h.length,crc:M.d(),c:S,f:g,m:v,u:m!=o.length||v&&A.length!=b,o:i,compression:f})),i+=30+m+C+I,r+=76+2*(m+C)+(b||0)+I}for(var R=new di(r+22),T=i,B=r-i,F=0;F<n.length;++F){var g=n[F];Wf(R,g.o,g,g.f,g.u,g.c.length);var D=30+g.f.length+Kl(g.extra);R.set(g.c,g.o+D),Wf(R,i,g,g.f,g.u,g.c.length,g.o,g.m),i+=16+D+(g.m?g.m.length:0)}return WM(R,i,n.length,B,T),R}var u3=function(){function a(){}return a.prototype.push=function(e,t){this.ondata(null,e,t)},a.compression=0,a}(),lte=function(){function a(){var e=this;this.i=new jr(function(t,n){e.ondata(null,t,n)})}return a.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},a.compression=8,a}(),hte=function(){function a(e,t){var n=this;t<32e4?this.i=new jr(function(i,r){n.ondata(null,i,r)}):(this.i=new zM(function(i,r,o){n.ondata(i,r,o)}),this.terminate=this.i.terminate)}return a.prototype.push=function(e,t){this.i.terminate&&(e=Uo(e,0)),this.i.push(e,t)},a.compression=8,a}(),ute=function(){function a(e){this.onfile=e,this.k=[],this.o={0:u3},this.p=Hc}return a.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(i),e.length)return this.push(e,t)}else{var o=0,l=0,h=void 0,u=void 0;this.p.length?e.length?(u=new di(this.p.length+e.length),u.set(this.p),u.set(e,this.p.length)):u=this.p:u=e;for(var f=u.length,g=this.c,m=g&&this.d,A=function(){var S,I=ys(u,l);if(I==67324752){o=1,h=l,v.d=null,v.c=0;var M=Ir(u,l+6),R=Ir(u,l+8),T=M&2048,B=M&8,F=Ir(u,l+26),D=Ir(u,l+28);if(f>l+30+F+D){var U=[];v.k.unshift(U),o=2;var W=ys(u,l+18),J=ys(u,l+22),ee=VM(u.subarray(l+30,l+=30+F),!T);W==4294967295?(S=B?[-2]:h3(u,l),W=S[0],J=S[1]):B&&(W=-1),l+=D,v.c=W;var Q,Y={name:ee,compression:R,start:function(){if(!Y.ondata)throw"no callback";if(!W)Y.ondata(null,Hc,!0);else{var se=n.o[R];if(!se)throw"unknown compression type "+R;Q=W<0?new se(ee):new se(ee,W,J),Q.ondata=function(Ae,Ie,Le){Y.ondata(Ae,Ie,Le)};for(var ae=0,ve=U;ae<ve.length;ae++){var xe=ve[ae];Q.push(xe,!1)}n.k[0]==U&&n.c?n.d=Q:Q.push(Hc,!0)}},terminate:function(){Q&&Q.terminate&&Q.terminate()}};W>=0&&(Y.size=W,Y.originalSize=J),v.onfile(Y)}return"break"}else if(g){if(I==134695760)return h=l+=12+(g==-2&&8),o=3,v.c=0,"break";if(I==33639248)return h=l-=4,o=3,v.c=0,"break"}},v=this;l<f-4;++l){var b=A();if(b==="break")break}if(this.p=Hc,g<0){var C=o?u.subarray(0,h-12-(g==-2&&8)-(ys(u,h-16)==134695760&&4)):u.subarray(0,l);m?m.push(C,!!o):this.k[+(o==2)].push(C)}if(o&2)return this.push(u.subarray(l),t);this.p=u.subarray(l)}if(t){if(this.c)throw"invalid zip file";this.p=null}},a.prototype.register=function(e){this.o[e.compression]=e},a}();function dte(a,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var m=0;m<t.length;++m)t[m]()},i={},r=a.length-22;ys(a,r)!=101010256;--r)if(!r||a.length-r>65558){e("invalid zip file",null);return}var o=Ir(a,r+8);o||e(null,{});var l=o,h=ys(a,r+16),u=h==4294967295;if(u){if(r=ys(a,r-12),ys(a,r)!=101075792){e("invalid zip file",null);return}l=o=ys(a,r+32),h=ys(a,r+48)}for(var f=function(m){var A=l3(a,h,u),v=A[0],b=A[1],C=A[2],S=A[3],I=A[4],M=A[5],R=c3(a,M);h=I;var T=function(F,D){F?(n(),e(F,null)):(i[S]=D,--o||e(null,i))};if(!v)T(null,Uo(a,R,R+b));else if(v==8){var B=a.subarray(R,R+b);if(b<32e4)try{T(null,pp(B,new di(C)))}catch(F){T(F,null)}else t.push(GM(B,{size:C},T))}else T("unknown compression type "+v,null)},g=0;g<l;++g)f();return n}function fte(a){for(var e={},t=a.length-22;ys(a,t)!=101010256;--t)if(!t||a.length-t>65558)throw"invalid zip file";var n=Ir(a,t+8);if(!n)return{};var i=ys(a,t+16),r=i==4294967295;if(r){if(t=ys(a,t-12),ys(a,t)!=101075792)throw"invalid zip file";n=ys(a,t+32),i=ys(a,t+48)}for(var o=0;o<n;++o){var l=l3(a,i,r),h=l[0],u=l[1],f=l[2],g=l[3],m=l[4],A=l[5],v=c3(a,A);if(i=m,!h)e[g]=Uo(a,v,v+u);else if(h==8)e[g]=pp(a.subarray(v,v+u),new di(f));else throw"unknown compression type "+h}return e}const sL=Object.freeze(Object.defineProperty({__proto__:null,Deflate:$a,AsyncDeflate:ZF,deflate:$F,deflateSync:uA,Inflate:jr,AsyncInflate:zM,inflate:GM,inflateSync:pp,Gzip:j_,AsyncGzip:tL,gzip:nL,gzipSync:q_,Gunzip:X_,AsyncGunzip:e3,gunzip:t3,gunzipSync:Y_,Zlib:OE,AsyncZlib:Kee,zlib:Zee,zlibSync:FE,Unzlib:J_,AsyncUnzlib:n3,unzlib:i3,unzlibSync:Ql,compress:nL,AsyncCompress:tL,compressSync:q_,Compress:j_,Decompress:s3,AsyncDecompress:$ee,decompress:ete,decompressSync:tte,DecodeUTF8:nte,EncodeUTF8:ite,strToU8:ch,strFromU8:VM,ZipPassThrough:Cg,ZipDeflate:ste,AsyncZipDeflate:rte,Zip:ote,zip:ate,zipSync:cte,UnzipPassThrough:u3,UnzipInflate:lte,AsyncUnzipInflate:hte,Unzip:ute,unzip:dte,unzipSync:fte},Symbol.toStringTag,{value:"Module"}));class d3 extends kS{constructor(e){super(e),this.type=Fs}parse(e){const U=Math.pow(2.7182818,2.2);function W(j,ie){let pe=0;for(let We=0;We<65536;++We)(We==0||j[We>>3]&1<<(We&7))&&(ie[pe++]=We);const Se=pe-1;for(;pe<65536;)ie[pe++]=0;return Se}function J(j){for(let ie=0;ie<16384;ie++)j[ie]={},j[ie].len=0,j[ie].lit=0,j[ie].p=null}const ee={l:0,c:0,lc:0};function Q(j,ie,pe,Se,We){for(;pe<j;)ie=ie<<8|Ln(Se,We),pe+=8;pe-=j,ee.l=ie>>pe&(1<<j)-1,ee.c=ie,ee.lc=pe}const Y=new Array(59);function se(j){for(let pe=0;pe<=58;++pe)Y[pe]=0;for(let pe=0;pe<65537;++pe)Y[j[pe]]+=1;let ie=0;for(let pe=58;pe>0;--pe){const Se=ie+Y[pe]>>1;Y[pe]=ie,ie=Se}for(let pe=0;pe<65537;++pe){const Se=j[pe];Se>0&&(j[pe]=Se|Y[Se]++<<6)}}function ae(j,ie,pe,Se,We,Oe){const Ke=ie;let lt=0,Tt=0;for(;Se<=We;Se++){if(Ke.value-ie.value>pe)return!1;Q(6,lt,Tt,j,Ke);const ut=ee.l;if(lt=ee.c,Tt=ee.lc,Oe[Se]=ut,ut==63){if(Ke.value-ie.value>pe)throw new Error("Something wrong with hufUnpackEncTable");Q(8,lt,Tt,j,Ke);let wt=ee.l+6;if(lt=ee.c,Tt=ee.lc,Se+wt>We+1)throw new Error("Something wrong with hufUnpackEncTable");for(;wt--;)Oe[Se++]=0;Se--}else if(ut>=59){let wt=ut-59+2;if(Se+wt>We+1)throw new Error("Something wrong with hufUnpackEncTable");for(;wt--;)Oe[Se++]=0;Se--}}se(Oe)}function ve(j){return j&63}function xe(j){return j>>6}function Ae(j,ie,pe,Se){for(;ie<=pe;ie++){const We=xe(j[ie]),Oe=ve(j[ie]);if(We>>Oe)throw new Error("Invalid table entry");if(Oe>14){const Ke=Se[We>>Oe-14];if(Ke.len)throw new Error("Invalid table entry");if(Ke.lit++,Ke.p){const lt=Ke.p;Ke.p=new Array(Ke.lit);for(let Tt=0;Tt<Ke.lit-1;++Tt)Ke.p[Tt]=lt[Tt]}else Ke.p=new Array(1);Ke.p[Ke.lit-1]=ie}else if(Oe){let Ke=0;for(let lt=1<<14-Oe;lt>0;lt--){const Tt=Se[(We<<14-Oe)+Ke];if(Tt.len||Tt.p)throw new Error("Invalid table entry");Tt.len=Oe,Tt.lit=ie,Ke++}}}return!0}const Ie={c:0,lc:0};function Le(j,ie,pe,Se){j=j<<8|Ln(pe,Se),ie+=8,Ie.c=j,Ie.lc=ie}const De={c:0,lc:0};function $e(j,ie,pe,Se,We,Oe,Ke,lt,Tt){if(j==ie){Se<8&&(Le(pe,Se,We,Oe),pe=Ie.c,Se=Ie.lc),Se-=8;let ut=pe>>Se;if(ut=new Uint8Array([ut])[0],lt.value+ut>Tt)return!1;const wt=Ke[lt.value-1];for(;ut-- >0;)Ke[lt.value++]=wt}else if(lt.value<Tt)Ke[lt.value++]=j;else return!1;De.c=pe,De.lc=Se}function vt(j){return j&65535}function zt(j){const ie=vt(j);return ie>32767?ie-65536:ie}const Ve={a:0,b:0};function gn(j,ie){const pe=zt(j),We=zt(ie),Oe=pe+(We&1)+(We>>1),Ke=Oe,lt=Oe-We;Ve.a=Ke,Ve.b=lt}function Xt(j,ie){const pe=vt(j),Se=vt(ie),We=pe-(Se>>1)&65535,Oe=Se+We-32768&65535;Ve.a=Oe,Ve.b=We}function mn(j,ie,pe,Se,We,Oe,Ke){const lt=Ke<16384,Tt=pe>We?We:pe;let ut=1,wt,Zt;for(;ut<=Tt;)ut<<=1;for(ut>>=1,wt=ut,ut>>=1;ut>=1;){Zt=0;const bt=Zt+Oe*(We-wt),xn=Oe*ut,pn=Oe*wt,$t=Se*ut,un=Se*wt;let Fn,Si,Zn,Wi;for(;Zt<=bt;Zt+=pn){let pi=Zt;const In=Zt+Se*(pe-wt);for(;pi<=In;pi+=un){const Di=pi+$t,zs=pi+xn,Yi=zs+$t;lt?(gn(j[pi+ie],j[zs+ie]),Fn=Ve.a,Zn=Ve.b,gn(j[Di+ie],j[Yi+ie]),Si=Ve.a,Wi=Ve.b,gn(Fn,Si),j[pi+ie]=Ve.a,j[Di+ie]=Ve.b,gn(Zn,Wi),j[zs+ie]=Ve.a,j[Yi+ie]=Ve.b):(Xt(j[pi+ie],j[zs+ie]),Fn=Ve.a,Zn=Ve.b,Xt(j[Di+ie],j[Yi+ie]),Si=Ve.a,Wi=Ve.b,Xt(Fn,Si),j[pi+ie]=Ve.a,j[Di+ie]=Ve.b,Xt(Zn,Wi),j[zs+ie]=Ve.a,j[Yi+ie]=Ve.b)}if(pe&ut){const Di=pi+xn;lt?gn(j[pi+ie],j[Di+ie]):Xt(j[pi+ie],j[Di+ie]),Fn=Ve.a,j[Di+ie]=Ve.b,j[pi+ie]=Fn}}if(We&ut){let pi=Zt;const In=Zt+Se*(pe-wt);for(;pi<=In;pi+=un){const Di=pi+$t;lt?gn(j[pi+ie],j[Di+ie]):Xt(j[pi+ie],j[Di+ie]),Fn=Ve.a,j[Di+ie]=Ve.b,j[pi+ie]=Fn}}wt=ut,ut>>=1}return Zt}function Nt(j,ie,pe,Se,We,Oe,Ke,lt,Tt){let ut=0,wt=0;const Zt=Ke,bt=Math.trunc(Se.value+(We+7)/8);for(;Se.value<bt;)for(Le(ut,wt,pe,Se),ut=Ie.c,wt=Ie.lc;wt>=14;){const pn=ut>>wt-14&16383,$t=ie[pn];if($t.len)wt-=$t.len,$e($t.lit,Oe,ut,wt,pe,Se,lt,Tt,Zt),ut=De.c,wt=De.lc;else{if(!$t.p)throw new Error("hufDecode issues");let un;for(un=0;un<$t.lit;un++){const Fn=ve(j[$t.p[un]]);for(;wt<Fn&&Se.value<bt;)Le(ut,wt,pe,Se),ut=Ie.c,wt=Ie.lc;if(wt>=Fn&&xe(j[$t.p[un]])==(ut>>wt-Fn&(1<<Fn)-1)){wt-=Fn,$e($t.p[un],Oe,ut,wt,pe,Se,lt,Tt,Zt),ut=De.c,wt=De.lc;break}}if(un==$t.lit)throw new Error("hufDecode issues")}}const xn=8-We&7;for(ut>>=xn,wt-=xn;wt>0;){const pn=ie[ut<<14-wt&16383];if(pn.len)wt-=pn.len,$e(pn.lit,Oe,ut,wt,pe,Se,lt,Tt,Zt),ut=De.c,wt=De.lc;else throw new Error("hufDecode issues")}return!0}function vn(j,ie,pe,Se,We,Oe){const Ke={value:0},lt=pe.value,Tt=Wt(ie,pe),ut=Wt(ie,pe);pe.value+=4;const wt=Wt(ie,pe);if(pe.value+=4,Tt<0||Tt>=65537||ut<0||ut>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Zt=new Array(65537),bt=new Array(16384);J(bt);const xn=Se-(pe.value-lt);if(ae(j,pe,xn,Tt,ut,Zt),wt>8*(Se-(pe.value-lt)))throw new Error("Something wrong with hufUncompress");Ae(Zt,Tt,ut,bt),Nt(Zt,bt,j,pe,wt,ut,Oe,We,Ke)}function it(j,ie,pe){for(let Se=0;Se<pe;++Se)ie[Se]=j[ie[Se]]}function tt(j){for(let ie=1;ie<j.length;ie++){const pe=j[ie-1]+j[ie]-128;j[ie]=pe}}function xt(j,ie){let pe=0,Se=Math.floor((j.length+1)/2),We=0;const Oe=j.length-1;for(;!(We>Oe||(ie[We++]=j[pe++],We>Oe));)ie[We++]=j[Se++]}function Jt(j){let ie=j.byteLength;const pe=new Array;let Se=0;const We=new DataView(j);for(;ie>0;){const Oe=We.getInt8(Se++);if(Oe<0){const Ke=-Oe;ie-=Ke+1;for(let lt=0;lt<Ke;lt++)pe.push(We.getUint8(Se++))}else{const Ke=Oe;ie-=2;const lt=We.getUint8(Se++);for(let Tt=0;Tt<Ke+1;Tt++)pe.push(lt)}}return pe}function Dt(j,ie,pe,Se,We,Oe){let Ke=new DataView(Oe.buffer);const lt=pe[j.idx[0]].width,Tt=pe[j.idx[0]].height,ut=3,wt=Math.floor(lt/8),Zt=Math.ceil(lt/8),bt=Math.ceil(Tt/8),xn=lt-(Zt-1)*8,pn=Tt-(bt-1)*8,$t={value:0},un=new Array(ut),Fn=new Array(ut),Si=new Array(ut),Zn=new Array(ut),Wi=new Array(ut);for(let In=0;In<ut;++In)Wi[In]=ie[j.idx[In]],un[In]=In<1?0:un[In-1]+Zt*bt,Fn[In]=new Float32Array(64),Si[In]=new Uint16Array(64),Zn[In]=new Uint16Array(Zt*64);for(let In=0;In<bt;++In){let Di=8;In==bt-1&&(Di=pn);let zs=8;for(let wi=0;wi<Zt;++wi){wi==Zt-1&&(zs=xn);for(let Ri=0;Ri<ut;++Ri)Si[Ri].fill(0),Si[Ri][0]=We[un[Ri]++],Cn($t,Se,Si[Ri]),Kt(Si[Ri],Fn[Ri]),ln(Fn[Ri]);ii(Fn);for(let Ri=0;Ri<ut;++Ri)Kn(Fn[Ri],Zn[Ri],wi*64)}let Yi=0;for(let wi=0;wi<ut;++wi){const Ri=pe[j.idx[wi]].type;for(let vr=8*In;vr<8*In+Di;++vr){Yi=Wi[wi][vr];for(let jo=0;jo<wt;++jo){const xr=jo*64+(vr&7)*8;Ke.setUint16(Yi+0*2*Ri,Zn[wi][xr+0],!0),Ke.setUint16(Yi+1*2*Ri,Zn[wi][xr+1],!0),Ke.setUint16(Yi+2*2*Ri,Zn[wi][xr+2],!0),Ke.setUint16(Yi+3*2*Ri,Zn[wi][xr+3],!0),Ke.setUint16(Yi+4*2*Ri,Zn[wi][xr+4],!0),Ke.setUint16(Yi+5*2*Ri,Zn[wi][xr+5],!0),Ke.setUint16(Yi+6*2*Ri,Zn[wi][xr+6],!0),Ke.setUint16(Yi+7*2*Ri,Zn[wi][xr+7],!0),Yi+=8*2*Ri}}if(wt!=Zt)for(let vr=8*In;vr<8*In+Di;++vr){const jo=Wi[wi][vr]+8*wt*2*Ri,xr=wt*64+(vr&7)*8;for(let _o=0;_o<zs;++_o)Ke.setUint16(jo+_o*2*Ri,Zn[wi][xr+_o],!0)}}}const pi=new Uint16Array(lt);Ke=new DataView(Oe.buffer);for(let In=0;In<ut;++In){pe[j.idx[In]].decoded=!0;const Di=pe[j.idx[In]].type;if(pe[In].type==2)for(let zs=0;zs<Tt;++zs){const Yi=Wi[In][zs];for(let wi=0;wi<lt;++wi)pi[wi]=Ke.getUint16(Yi+wi*2*Di,!0);for(let wi=0;wi<lt;++wi)Ke.setFloat32(Yi+wi*2*Di,Re(pi[wi]),!0)}}}function Cn(j,ie,pe){let Se,We=1;for(;We<64;)Se=ie[j.value],Se==65280?We=64:Se>>8==255?We+=Se&255:(pe[We]=Se,We++),j.value++}function Kt(j,ie){ie[0]=Re(j[0]),ie[1]=Re(j[1]),ie[2]=Re(j[5]),ie[3]=Re(j[6]),ie[4]=Re(j[14]),ie[5]=Re(j[15]),ie[6]=Re(j[27]),ie[7]=Re(j[28]),ie[8]=Re(j[2]),ie[9]=Re(j[4]),ie[10]=Re(j[7]),ie[11]=Re(j[13]),ie[12]=Re(j[16]),ie[13]=Re(j[26]),ie[14]=Re(j[29]),ie[15]=Re(j[42]),ie[16]=Re(j[3]),ie[17]=Re(j[8]),ie[18]=Re(j[12]),ie[19]=Re(j[17]),ie[20]=Re(j[25]),ie[21]=Re(j[30]),ie[22]=Re(j[41]),ie[23]=Re(j[43]),ie[24]=Re(j[9]),ie[25]=Re(j[11]),ie[26]=Re(j[18]),ie[27]=Re(j[24]),ie[28]=Re(j[31]),ie[29]=Re(j[40]),ie[30]=Re(j[44]),ie[31]=Re(j[53]),ie[32]=Re(j[10]),ie[33]=Re(j[19]),ie[34]=Re(j[23]),ie[35]=Re(j[32]),ie[36]=Re(j[39]),ie[37]=Re(j[45]),ie[38]=Re(j[52]),ie[39]=Re(j[54]),ie[40]=Re(j[20]),ie[41]=Re(j[22]),ie[42]=Re(j[33]),ie[43]=Re(j[38]),ie[44]=Re(j[46]),ie[45]=Re(j[51]),ie[46]=Re(j[55]),ie[47]=Re(j[60]),ie[48]=Re(j[21]),ie[49]=Re(j[34]),ie[50]=Re(j[37]),ie[51]=Re(j[47]),ie[52]=Re(j[50]),ie[53]=Re(j[56]),ie[54]=Re(j[59]),ie[55]=Re(j[61]),ie[56]=Re(j[35]),ie[57]=Re(j[36]),ie[58]=Re(j[48]),ie[59]=Re(j[49]),ie[60]=Re(j[57]),ie[61]=Re(j[58]),ie[62]=Re(j[62]),ie[63]=Re(j[63])}function ln(j){const ie=.5*Math.cos(.7853975),pe=.5*Math.cos(3.14159/16),Se=.5*Math.cos(3.14159/8),We=.5*Math.cos(3*3.14159/16),Oe=.5*Math.cos(5*3.14159/16),Ke=.5*Math.cos(3*3.14159/8),lt=.5*Math.cos(7*3.14159/16),Tt=new Array(4),ut=new Array(4),wt=new Array(4),Zt=new Array(4);for(let bt=0;bt<8;++bt){const xn=bt*8;Tt[0]=Se*j[xn+2],Tt[1]=Ke*j[xn+2],Tt[2]=Se*j[xn+6],Tt[3]=Ke*j[xn+6],ut[0]=pe*j[xn+1]+We*j[xn+3]+Oe*j[xn+5]+lt*j[xn+7],ut[1]=We*j[xn+1]-lt*j[xn+3]-pe*j[xn+5]-Oe*j[xn+7],ut[2]=Oe*j[xn+1]-pe*j[xn+3]+lt*j[xn+5]+We*j[xn+7],ut[3]=lt*j[xn+1]-Oe*j[xn+3]+We*j[xn+5]-pe*j[xn+7],wt[0]=ie*(j[xn+0]+j[xn+4]),wt[3]=ie*(j[xn+0]-j[xn+4]),wt[1]=Tt[0]+Tt[3],wt[2]=Tt[1]-Tt[2],Zt[0]=wt[0]+wt[1],Zt[1]=wt[3]+wt[2],Zt[2]=wt[3]-wt[2],Zt[3]=wt[0]-wt[1],j[xn+0]=Zt[0]+ut[0],j[xn+1]=Zt[1]+ut[1],j[xn+2]=Zt[2]+ut[2],j[xn+3]=Zt[3]+ut[3],j[xn+4]=Zt[3]-ut[3],j[xn+5]=Zt[2]-ut[2],j[xn+6]=Zt[1]-ut[1],j[xn+7]=Zt[0]-ut[0]}for(let bt=0;bt<8;++bt)Tt[0]=Se*j[16+bt],Tt[1]=Ke*j[16+bt],Tt[2]=Se*j[48+bt],Tt[3]=Ke*j[48+bt],ut[0]=pe*j[8+bt]+We*j[24+bt]+Oe*j[40+bt]+lt*j[56+bt],ut[1]=We*j[8+bt]-lt*j[24+bt]-pe*j[40+bt]-Oe*j[56+bt],ut[2]=Oe*j[8+bt]-pe*j[24+bt]+lt*j[40+bt]+We*j[56+bt],ut[3]=lt*j[8+bt]-Oe*j[24+bt]+We*j[40+bt]-pe*j[56+bt],wt[0]=ie*(j[bt]+j[32+bt]),wt[3]=ie*(j[bt]-j[32+bt]),wt[1]=Tt[0]+Tt[3],wt[2]=Tt[1]-Tt[2],Zt[0]=wt[0]+wt[1],Zt[1]=wt[3]+wt[2],Zt[2]=wt[3]-wt[2],Zt[3]=wt[0]-wt[1],j[0+bt]=Zt[0]+ut[0],j[8+bt]=Zt[1]+ut[1],j[16+bt]=Zt[2]+ut[2],j[24+bt]=Zt[3]+ut[3],j[32+bt]=Zt[3]-ut[3],j[40+bt]=Zt[2]-ut[2],j[48+bt]=Zt[1]-ut[1],j[56+bt]=Zt[0]-ut[0]}function ii(j){for(let ie=0;ie<64;++ie){const pe=j[0][ie],Se=j[1][ie],We=j[2][ie];j[0][ie]=pe+1.5747*We,j[1][ie]=pe-.1873*Se-.4682*We,j[2][ie]=pe+1.8556*Se}}function Kn(j,ie,pe){for(let Se=0;Se<64;++Se)ie[pe+Se]=Cu.toHalfFloat(me(j[Se]))}function me(j){return j<=1?Math.sign(j)*Math.pow(Math.abs(j),2.2):Math.sign(j)*Math.pow(U,Math.abs(j)-1)}function ce(j){return new DataView(j.array.buffer,j.offset.value,j.size)}function je(j){const ie=j.viewer.buffer.slice(j.offset.value,j.offset.value+j.size),pe=new Uint8Array(Jt(ie)),Se=new Uint8Array(pe.length);return tt(pe),xt(pe,Se),new DataView(Se.buffer)}function yt(j){const ie=j.array.slice(j.offset.value,j.offset.value+j.size);typeof sL>"u"&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const pe=Ql(ie),Se=new Uint8Array(pe.length);return tt(pe),xt(pe,Se),new DataView(Se.buffer)}function mt(j){const ie=j.viewer,pe={value:j.offset.value},Se=new Uint16Array(j.width*j.scanlineBlockSize*(j.channels*j.type)),We=new Uint8Array(8192);let Oe=0;const Ke=new Array(j.channels);for(let pn=0;pn<j.channels;pn++)Ke[pn]={},Ke[pn].start=Oe,Ke[pn].end=Ke[pn].start,Ke[pn].nx=j.width,Ke[pn].ny=j.lines,Ke[pn].size=j.type,Oe+=Ke[pn].nx*Ke[pn].ny*Ke[pn].size;const lt=Mt(ie,pe),Tt=Mt(ie,pe);if(Tt>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(lt<=Tt)for(let pn=0;pn<Tt-lt+1;pn++)We[pn+lt]=Dn(ie,pe);const ut=new Uint16Array(65536),wt=W(We,ut),Zt=Wt(ie,pe);vn(j.array,ie,pe,Zt,Se,Oe);for(let pn=0;pn<j.channels;++pn){const $t=Ke[pn];for(let un=0;un<Ke[pn].size;++un)mn(Se,$t.start+un,$t.nx,$t.size,$t.ny,$t.nx*$t.size,wt)}it(ut,Se,Oe);let bt=0;const xn=new Uint8Array(Se.buffer.byteLength);for(let pn=0;pn<j.lines;pn++)for(let $t=0;$t<j.channels;$t++){const un=Ke[$t],Fn=un.nx*un.size,Si=new Uint8Array(Se.buffer,un.end*2,Fn*2);xn.set(Si,bt),bt+=Fn*2,un.end+=Fn}return new DataView(xn.buffer)}function Ht(j){const ie=j.array.slice(j.offset.value,j.offset.value+j.size);typeof sL>"u"&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const pe=Ql(ie),Se=j.lines*j.channels*j.width,We=j.type==1?new Uint16Array(Se):new Uint32Array(Se);let Oe=0,Ke=0;const lt=new Array(4);for(let Tt=0;Tt<j.lines;Tt++)for(let ut=0;ut<j.channels;ut++){let wt=0;switch(j.type){case 1:lt[0]=Oe,lt[1]=lt[0]+j.width,Oe=lt[1]+j.width;for(let Zt=0;Zt<j.width;++Zt)wt+=pe[lt[0]++]<<8|pe[lt[1]++],We[Ke]=wt,Ke++;break;case 2:lt[0]=Oe,lt[1]=lt[0]+j.width,lt[2]=lt[1]+j.width,Oe=lt[2]+j.width;for(let Zt=0;Zt<j.width;++Zt)wt+=pe[lt[0]++]<<24|pe[lt[1]++]<<16|pe[lt[2]++]<<8,We[Ke]=wt,Ke++;break}}return new DataView(We.buffer)}function Mn(j){const ie=j.viewer,pe={value:j.offset.value},Se=new Uint8Array(j.width*j.lines*(j.channels*j.type*2)),We={version:Me(ie,pe),unknownUncompressedSize:Me(ie,pe),unknownCompressedSize:Me(ie,pe),acCompressedSize:Me(ie,pe),dcCompressedSize:Me(ie,pe),rleCompressedSize:Me(ie,pe),rleUncompressedSize:Me(ie,pe),rleRawSize:Me(ie,pe),totalAcUncompressedCount:Me(ie,pe),totalDcUncompressedCount:Me(ie,pe),acCompression:Me(ie,pe)};if(We.version<2)throw new Error("EXRLoader.parse: "+Ge.compression+" version "+We.version+" is unsupported");const Oe=new Array;let Ke=Mt(ie,pe)-2;for(;Ke>0;){const $t=be(ie.buffer,pe),un=Dn(ie,pe),Fn=un>>2&3,Si=(un>>4)-1,Zn=new Int8Array([Si])[0],Wi=Dn(ie,pe);Oe.push({name:$t,index:Zn,type:Wi,compression:Fn}),Ke-=$t.length+3}const lt=Ge.channels,Tt=new Array(j.channels);for(let $t=0;$t<j.channels;++$t){const un=Tt[$t]={},Fn=lt[$t];un.name=Fn.name,un.compression=0,un.decoded=!1,un.type=Fn.pixelType,un.pLinear=Fn.pLinear,un.width=j.width,un.height=j.lines}const ut={idx:new Array(3)};for(let $t=0;$t<j.channels;++$t){const un=Tt[$t];for(let Fn=0;Fn<Oe.length;++Fn){const Si=Oe[Fn];un.name==Si.name&&(un.compression=Si.compression,Si.index>=0&&(ut.idx[Si.index]=$t),un.offset=$t)}}let wt,Zt,bt;if(We.acCompressedSize>0)switch(We.acCompression){case 0:wt=new Uint16Array(We.totalAcUncompressedCount),vn(j.array,ie,pe,We.acCompressedSize,wt,We.totalAcUncompressedCount);break;case 1:const $t=j.array.slice(pe.value,pe.value+We.totalAcUncompressedCount),un=Ql($t);wt=new Uint16Array(un.buffer),pe.value+=We.totalAcUncompressedCount;break}if(We.dcCompressedSize>0){const $t={array:j.array,offset:pe,size:We.dcCompressedSize};Zt=new Uint16Array(yt($t).buffer),pe.value+=We.dcCompressedSize}if(We.rleRawSize>0){const $t=j.array.slice(pe.value,pe.value+We.rleCompressedSize),un=Ql($t);bt=Jt(un.buffer),pe.value+=We.rleCompressedSize}let xn=0;const pn=new Array(Tt.length);for(let $t=0;$t<pn.length;++$t)pn[$t]=new Array;for(let $t=0;$t<j.lines;++$t)for(let un=0;un<Tt.length;++un)pn[un].push(xn),xn+=Tt[un].width*j.type*2;Dt(ut,pn,Tt,wt,Zt,Se);for(let $t=0;$t<Tt.length;++$t){const un=Tt[$t];if(!un.decoded)switch(un.compression){case 2:let Fn=0,Si=0;for(let Zn=0;Zn<j.lines;++Zn){let Wi=pn[$t][Fn];for(let pi=0;pi<un.width;++pi){for(let In=0;In<2*un.type;++In)Se[Wi++]=bt[Si+In*un.width*un.height];Si++}Fn++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(Se.buffer)}function be(j,ie){const pe=new Uint8Array(j);let Se=0;for(;pe[ie.value+Se]!=0;)Se+=1;const We=new TextDecoder().decode(pe.slice(ie.value,ie.value+Se));return ie.value=ie.value+Se+1,We}function ke(j,ie,pe){const Se=new TextDecoder().decode(new Uint8Array(j).slice(ie.value,ie.value+pe));return ie.value=ie.value+pe,Se}function Et(j,ie){const pe=nn(j,ie),Se=Wt(j,ie);return[pe,Se]}function hn(j,ie){const pe=Wt(j,ie),Se=Wt(j,ie);return[pe,Se]}function nn(j,ie){const pe=j.getInt32(ie.value,!0);return ie.value=ie.value+4,pe}function Wt(j,ie){const pe=j.getUint32(ie.value,!0);return ie.value=ie.value+4,pe}function Ln(j,ie){const pe=j[ie.value];return ie.value=ie.value+1,pe}function Dn(j,ie){const pe=j.getUint8(ie.value);return ie.value=ie.value+1,pe}const Me=function(j,ie){const pe=Number(j.getBigInt64(ie.value,!0));return ie.value+=8,pe};function Bt(j,ie){const pe=j.getFloat32(ie.value,!0);return ie.value+=4,pe}function Ut(j,ie){return Cu.toHalfFloat(Bt(j,ie))}function Re(j){const ie=(j&31744)>>10,pe=j&1023;return(j>>15?-1:1)*(ie?ie===31?pe?NaN:1/0:Math.pow(2,ie-15)*(1+pe/1024):6103515625e-14*(pe/1024))}function Mt(j,ie){const pe=j.getUint16(ie.value,!0);return ie.value+=2,pe}function wn(j,ie){return Re(Mt(j,ie))}function fi(j,ie,pe,Se){const We=pe.value,Oe=[];for(;pe.value<We+Se-1;){const Ke=be(ie,pe),lt=nn(j,pe),Tt=Dn(j,pe);pe.value+=3;const ut=nn(j,pe),wt=nn(j,pe);Oe.push({name:Ke,pixelType:lt,pLinear:Tt,xSampling:ut,ySampling:wt})}return pe.value+=1,Oe}function Vi(j,ie){const pe=Bt(j,ie),Se=Bt(j,ie),We=Bt(j,ie),Oe=Bt(j,ie),Ke=Bt(j,ie),lt=Bt(j,ie),Tt=Bt(j,ie),ut=Bt(j,ie);return{redX:pe,redY:Se,greenX:We,greenY:Oe,blueX:Ke,blueY:lt,whiteX:Tt,whiteY:ut}}function Kr(j,ie){const pe=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Se=Dn(j,ie);return pe[Se]}function xi(j,ie){const pe=Wt(j,ie),Se=Wt(j,ie),We=Wt(j,ie),Oe=Wt(j,ie);return{xMin:pe,yMin:Se,xMax:We,yMax:Oe}}function Or(j,ie){const pe=["INCREASING_Y"],Se=Dn(j,ie);return pe[Se]}function Ys(j,ie){const pe=Bt(j,ie),Se=Bt(j,ie);return[pe,Se]}function or(j,ie){const pe=Bt(j,ie),Se=Bt(j,ie),We=Bt(j,ie);return[pe,Se,We]}function ac(j,ie,pe,Se,We){if(Se==="string"||Se==="stringvector"||Se==="iccProfile")return ke(ie,pe,We);if(Se==="chlist")return fi(j,ie,pe,We);if(Se==="chromaticities")return Vi(j,pe);if(Se==="compression")return Kr(j,pe);if(Se==="box2i")return xi(j,pe);if(Se==="lineOrder")return Or(j,pe);if(Se==="float")return Bt(j,pe);if(Se==="v2f")return Ys(j,pe);if(Se==="v3f")return or(j,pe);if(Se==="int")return nn(j,pe);if(Se==="rational")return Et(j,pe);if(Se==="timecode")return hn(j,pe);if(Se==="preview")return pe.value+=We,"skipped";pe.value+=We}function wh(j,ie,pe){const Se={};if(j.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Se.version=j.getUint8(4);const We=j.getUint8(5);Se.spec={singleTile:!!(We&2),longName:!!(We&4),deepFormat:!!(We&8),multiPart:!!(We&16)},pe.value=8;let Oe=!0;for(;Oe;){const Ke=be(ie,pe);if(Ke==0)Oe=!1;else{const lt=be(ie,pe),Tt=Wt(j,pe),ut=ac(j,ie,pe,lt,Tt);ut===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${lt}'.`):Se[Ke]=ut}}if((We&-5)!=0)throw console.error("EXRHeader:",Se),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Se}function yo(j,ie,pe,Se,We){const Oe={size:0,viewer:ie,array:pe,offset:Se,width:j.dataWindow.xMax-j.dataWindow.xMin+1,height:j.dataWindow.yMax-j.dataWindow.yMin+1,channels:j.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:j.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(j.compression){case"NO_COMPRESSION":Oe.lines=1,Oe.uncompress=ce;break;case"RLE_COMPRESSION":Oe.lines=1,Oe.uncompress=je;break;case"ZIPS_COMPRESSION":Oe.lines=1,Oe.uncompress=yt;break;case"ZIP_COMPRESSION":Oe.lines=16,Oe.uncompress=yt;break;case"PIZ_COMPRESSION":Oe.lines=32,Oe.uncompress=mt;break;case"PXR24_COMPRESSION":Oe.lines=16,Oe.uncompress=Ht;break;case"DWAA_COMPRESSION":Oe.lines=32,Oe.uncompress=Mn;break;case"DWAB_COMPRESSION":Oe.lines=256,Oe.uncompress=Mn;break;default:throw new Error("EXRLoader.parse: "+j.compression+" is unsupported")}if(Oe.scanlineBlockSize=Oe.lines,Oe.type==1)switch(We){case Ms:Oe.getter=wn,Oe.inputSize=2;break;case Fs:Oe.getter=Mt,Oe.inputSize=2;break}else if(Oe.type==2)switch(We){case Ms:Oe.getter=Bt,Oe.inputSize=4;break;case Fs:Oe.getter=Ut,Oe.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+Oe.type+" for "+j.compression+".");Oe.blockCount=(j.dataWindow.yMax+1)/Oe.scanlineBlockSize;for(let lt=0;lt<Oe.blockCount;lt++)Me(ie,Se);Oe.outputChannels=Oe.channels==3?4:Oe.channels;const Ke=Oe.width*Oe.height*Oe.outputChannels;switch(We){case Ms:Oe.byteArray=new Float32Array(Ke),Oe.channels<Oe.outputChannels&&Oe.byteArray.fill(1,0,Ke);break;case Fs:Oe.byteArray=new Uint16Array(Ke),Oe.channels<Oe.outputChannels&&Oe.byteArray.fill(15360,0,Ke);break;default:console.error("THREE.EXRLoader: unsupported type: ",We);break}return Oe.bytesPerLine=Oe.width*Oe.inputSize*Oe.channels,Oe.outputChannels==4?(Oe.format=ds,Oe.encoding=Ar):(Oe.format=vu,Oe.encoding=Ar),Oe}const Fr=new DataView(e),ed=new Uint8Array(e),he={value:0},Ge=wh(Fr,e,he),ze=yo(Ge,Fr,ed,he,this.type),Ne={value:0},nt={R:0,G:1,B:2,A:3,Y:0};for(let j=0;j<ze.height/ze.scanlineBlockSize;j++){const ie=Wt(Fr,he);ze.size=Wt(Fr,he),ze.lines=ie+ze.scanlineBlockSize>ze.height?ze.height-ie:ze.scanlineBlockSize;const Se=ze.size<ze.lines*ze.bytesPerLine?ze.uncompress(ze):ce(ze);he.value+=ze.size;for(let We=0;We<ze.scanlineBlockSize;We++){const Oe=We+j*ze.scanlineBlockSize;if(Oe>=ze.height)break;for(let Ke=0;Ke<ze.channels;Ke++){const lt=nt[Ge.channels[Ke].name];for(let Tt=0;Tt<ze.width;Tt++){Ne.value=(We*(ze.channels*ze.width)+Ke*ze.width+Tt)*ze.inputSize;const ut=(ze.height-1-Oe)*(ze.width*ze.outputChannels)+Tt*ze.outputChannels+lt;ze.byteArray[ut]=ze.getter(Se,Ne)}}}}return{header:Ge,width:ze.width,height:ze.height,data:ze.byteArray,format:ze.format,encoding:ze.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){function r(o,l){o.encoding=l.encoding,o.minFilter=vi,o.magFilter=vi,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,l)}return super.load(e,r,n,i)}}const f3=Ct("debugautosync");class pte{constructor(){x(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const t=new mte(e);return this._syncers[e.guid]=t,t}}const p3=new pte;class mte{constructor(e){x(this,"comp");x(this,"hasChanges",!1);x(this,"changedProperties",{});x(this,"data",{});x(this,"_boundEvent");x(this,"_isReceiving",!1);x(this,"_isInit",!1);this.comp=e}get networkingKey(){return this.comp.constructor.name}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this._boundEvent=this.onHandleSending.bind(this),this.comp.context.post_render_callbacks.push(this._boundEvent),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving.bind(this));const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}notifyChanged(e,t){this._isReceiving||(this.hasChanges=!0,this.changedProperties[e]=t)}onHandleSending(){if(!this.hasChanges)return;this.hasChanges=!1;const e=this.comp.context.connection;if(!e||!e.isConnected){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.data)delete this.data[t];this.data.guid=this.comp.guid;for(const t in this.changedProperties){const n=this.changedProperties[t];delete this.changedProperties[t],this.data[t]=n}e.send(this.networkingKey,this.data)}onHandleReceiving(e){if(!this._isInit||!this.comp)return;const t=e.guid;if(!(t&&t!==this.comp.guid)){f3&&console.log("RECEIVED",this.comp.name,this.comp.guid,e);try{this._isReceiving=!0;for(const n in e){if(n==="guid")continue;const i=e[n];this.comp[n]=i}}catch(n){console.error(n)}finally{this._isReceiving=!1}}}}function gte(a,e){let t=e!==a;if(!t&&a&&e){if(Array.isArray(a)&&Array.isArray(e))t=!0;else if(typeof a=="object"&&typeof e=="object"){for(const n of Object.keys(a))if(a[n]!==e[n]){t=!0;break}}}return t}function Ate(a){if(a.__autoPropertySyncHandler)return a.__autoPropertySyncHandler;const e=p3.getOrCreateSyncer(a);return e==null||e.init(a),a.__autoPropertySyncHandler=e,e}const m3=function(a){return function(e,t){let n=null;const i=a?e[a]:void 0,r=e,o=r.__internalAwake;f3&&console.log(t);const l=t+"k__BackingField";r.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[t],o.call(this),n=p3.getOrCreateSyncer(this);const h=Object.getOwnPropertyDescriptor(this,t);(h==null?void 0:h.set)===void 0&&Object.defineProperty(this,t,{set:function(u){var g;const f=this[l];this[l]=u,gte(u,f)&&(i==null?void 0:i.call(this,u,f))!==!1&&((g=Ate(this))==null||g.notifyChanged(t,u))},get:function(){return this[l]},configurable:!0,enumerable:!0}),n==null||n.init(this)}}};var yte=Object.defineProperty,_te=Object.getOwnPropertyDescriptor,g3=(a,e,t,n)=>{for(var i=n>1?void 0:n?_te(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&yte(e,t,i),i};class ex extends pt{constructor(){super(...arguments);x(this,"url");x(this,"allowDrop",!0);x(this,"_loader");x(this,"_prevLoadedEnvironment");x(this,"_prevEnvironment",null);x(this,"_prevBackground",null);x(this,"dragOverEvent");x(this,"dropEvent")}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.isInXR||(this.context.scene.environment=this._prevEnvironment,this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents()}async setSkybox(t){if(!t)return;if(!(t!=null&&t.endsWith(".hdr"))&&!t.endsWith(".exr")&&console.warn("Potentially invalid skybox url",this.url,"on",this.name),!this._loader){const r=t.endsWith(".exr");this._loader=r?new d3:new Xee}const n=await this._loader.loadAsync(t);if(!n||!this.enabled)return;this.url=t,n.mapping=Of,this._prevBackground=this.context.scene.background,this._prevEnvironment=this.context.scene.environment,console.log("Set skybox",this.url),this.context.scene.environment=n,this.context.scene.background=n,this._prevLoadedEnvironment=n;const i=t.lastIndexOf("/");n.name=t.substring(i>=0?i+1:0)}registerDropEvents(){this.dragOverEvent||(this.dragOverEvent=t=>{if(!!this.allowDrop&&!!t.dataTransfer)for(const n of t.dataTransfer.types)n==="text/uri-list"&&t.preventDefault()},this.dropEvent=t=>{var n,i,r,o;if(!!this.allowDrop&&(t.preventDefault(),!!t.dataTransfer)){for(const l of t.dataTransfer.types)if(l==="text/uri-list"){const h=t.dataTransfer.getData(l);console.log(l,h);let u=(i=(n=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(h))==null?void 0:n.groups)==null?void 0:i.name;if(u||(u=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(h))==null?void 0:r.groups)==null?void 0:o.name),console.log(u),u){const f="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+u+"_1k.exr";this.setSkybox(f)}else console.warn("Could not resolve skybox name from dropped url",h)}}},this.context.domElement.addEventListener("dragover",this.dragOverEvent),this.context.domElement.addEventListener("drop",this.dropEvent))}unregisterDropEvents(){!this.dragOverEvent||(this.context.domElement.removeEventListener("dragover",this.dragOverEvent),this.context.domElement.removeEventListener("drop",this.dropEvent))}}g3([m3("setSkybox"),we()],ex.prototype,"url",2);g3([we()],ex.prototype,"allowDrop",2);var vte=Object.defineProperty,xte=Object.getOwnPropertyDescriptor,wte=(a,e,t,n)=>{for(var i=n>1?void 0:n?xte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&vte(e,t,i),i},MC;const A3=(MC=class extends pt{constructor(){super(...arguments);x(this,"target",null);x(this,"followFactor",.1);x(this,"rotateFactor",.1);x(this,"flipForward",!1);x(this,"_firstUpdate",!0)}onEnable(){const e=Ee.getComponentInChildren(this.gameObject,qs);e&&e.cam&&(e.gameObject.position.set(0,0,0),e.cam.position.set(0,0,0),e.gameObject.quaternion.identity(),e.cam.quaternion.setFromEuler(new _s(0,Math.PI,0)))}onBeforeRender(){this.followFactor<=0||this.updateNow(!1)}updateNow(e){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const t=ni(this.target),n=this._firstUpdate||e?1:Ci.clamp01(this.context.time.deltaTime*this.followFactor);this.worldPosition=this.worldPosition.lerp(t,n)}if(this.rotateFactor>0){const t=ga(this.target);this.flipForward&&t.premultiply(A3._invertForward);const n=this._firstUpdate||e?1:Ci.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(t,n)}this._firstUpdate=!1}}},x(MC,"_invertForward",new kt().setFromAxisAngle(new q(0,1,0),Math.PI)),MC);let tx=A3;wte([we(Ft)],tx.prototype,"target",2);var bte=Object.defineProperty,Cte=Object.getOwnPropertyDescriptor,dA=(a,e,t,n)=>{for(var i=n>1?void 0:n?Cte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&bte(e,t,i),i};const o_=Ct("debugspatialtrigger"),rL=new Ka,oL=new Ka;function Ete(a,e){return rL.mask=a,oL.mask=e,rL.test(oL)}class Wc extends pt{constructor(){super(...arguments);x(this,"triggerMask",0);x(this,"onEnter");x(this,"onStay");x(this,"onExit");x(this,"currentIntersected",[]);x(this,"lastIntersected",[])}start(){o_&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of nx.triggers)Ete(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const n=this.lastIntersected[t];this.currentIntersected.indexOf(n)<0&&(this.onExitTrigger(n),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var n;o_&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(n=this.onEnter)==null||n.invoke(this,t)}onExitTrigger(t){var n;o_&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(n=this.onExit)==null||n.invoke(this,t)}onStayTrigger(t){var n;t.raiseOnStayEvent(this),(n=this.onStay)==null||n.invoke(this,t)}}dA([we()],Wc.prototype,"triggerMask",2);dA([we(ya)],Wc.prototype,"onEnter",2);dA([we(ya)],Wc.prototype,"onStay",2);dA([we(ya)],Wc.prototype,"onExit",2);var TC;const a_=(TC=class extends pt{constructor(){super(...arguments);x(this,"triggerMask");x(this,"boxHelper")}start(){o_&&console.log(this.name,this.triggerMask,this)}onEnable(){var e;a_.triggers.push(this),this.boxHelper||(this.boxHelper=Ee.addNewComponent(this.gameObject,Uc),(e=this.boxHelper)==null||e.showHelper())}onDisable(){a_.triggers.splice(a_.triggers.indexOf(this),1)}test(e){var t;return this.boxHelper&&(t=this.boxHelper.isInBox(e))!=null?t:!1}raiseOnEnterEvent(e){Ee.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Wc&&t.onEnterTrigger(this)},!1)}raiseOnStayEvent(e){Ee.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Wc&&t.onStayTrigger(this)},!1)}raiseOnExitEvent(e){Ee.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Wc&&t.onExitTrigger(this)},!1)}},x(TC,"triggers",[]),TC);let nx=a_;dA([we()],nx.prototype,"triggerMask",2);const co=Ct("debugspectator");class y3 extends pt{constructor(){super(...arguments);x(this,"cam",null);x(this,"_mode",0);x(this,"orbit",null);x(this,"_handler");x(this,"eventSub_WebXRRequestStartEvent",null);x(this,"eventSub_WebXRStartEvent",null);x(this,"eventSub_WebXREndEvent",null);x(this,"_debug");x(this,"_networking")}get mode(){return this._mode}set mode(t){this._mode=t}get isSpectating(){var t;return((t=this._handler)==null?void 0:t.currentTarget)!==void 0}isSpectatingUser(t){var n;return((n=this.target)==null?void 0:n.userId)===t}isFollowedBy(t){var n;return(n=this.followers)==null?void 0:n.includes(t)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}set target(t){var n;if(this._handler){const i=(n=this._handler.currentTarget)==null?void 0:n.userId,r=this.context.players.getPlayerView(this.context.connection.connectionId);t===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===t.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),Ee.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(t,i)):this._handler.currentTarget!==t&&(this._handler.set(t),Ee.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(t,i))}}get target(){var t;return(t=this._handler)==null?void 0:t.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var t,n;return this.isSpectating&&((t=this.target)==null?void 0:t.currentObject)===((n=this.context.players.getPlayerView(this.context.connection.connectionId))==null?void 0:n.currentObject)}awake(){if(this._debug=new Tte(this.context,this),this._networking=new Pte(this.context,this),this._networking.awake(),Ee.setActive(this.gameObject,!1),this.cam=Ee.getComponent(this.gameObject,qs),!this.cam){console.error("Spectator camera needs camera component",this);return}!this._handler&&this.cam&&(this._handler=new Ste(this.context,this.cam,this)),this.eventSub_WebXRRequestStartEvent=this.onXRSessionRequestStart.bind(this),this.eventSub_WebXRStartEvent=this.onXRSessionStart.bind(this),this.eventSub_WebXREndEvent=this.onXRSessionEnded.bind(this),_i.addEventListener(tr.RequestVRSession,this.eventSub_WebXRRequestStartEvent),_i.addEventListener(tr.XRStarted,this.eventSub_WebXRStartEvent),_i.addEventListener(tr.XRStopped,this.eventSub_WebXREndEvent),this.orbit=Ee.getComponent(this.context.mainCamera,dh)}onDestroy(){var t;this.stopSpectating(),_i.removeEventListener(tr.RequestVRSession,this.eventSub_WebXRStartEvent),_i.removeEventListener(tr.XRStarted,this.eventSub_WebXRStartEvent),_i.removeEventListener(tr.XRStopped,this.eventSub_WebXREndEvent),(t=this._handler)==null||t.destroy(),this._networking.destroy()}isSupportedPlatform(){const t=window.navigator.userAgent,n=/Windows|MacOS/.test(t),i=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return n&&!i}onXRSessionRequestStart(t){!this.isSupportedPlatform()||Ee.setActive(this.gameObject,!0)}onXRSessionStart(t){!this.isSupportedPlatform()||(co&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onXRSessionEnded(t){var n,i;this.context.removeCamera(this.cam),Ee.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(n=this._handler)==null||n.set(void 0),(i=this._handler)==null||i.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),co&&console.log("Follow self",this.target)}onAfterRender(){var u,f,g;if(!this.cam)return;const t=this.context.renderer,n=t.xr.enabled;if(!t.xr.isPresenting&&!((u=this._handler)!=null&&u.currentTarget))return;(f=this._handler)==null||f.update(this._mode);const i=t.getRenderTarget();let r=null;if(!i){if(!t.state.bindFramebuffer||!t.state.bindXRFramebuffer)return;r=t._framebuffer,t.state.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const o=this.context.mainCameraComponent;if(o){const m=o.backgroundColor;m&&t.setClearColor(m,m.alpha),this.cam.backgroundColor=m,this.cam.clearFlags=o.clearFlags,this.cam.nearClipPlane=o.nearClipPlane,this.cam.farClipPlane=o.farClipPlane}else t.setClearColor(new ye(1,1,1));t.setRenderTarget(null),t.xr.enabled=!1;const l=(g=this.cam)==null?void 0:g.cam;this.context.updateAspect(l);const h=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,l),t.xr.isPresenting=h,t.xr.enabled=n,i?t.setRenderTarget(i):t.state.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const t=this._mode===0;for(const n of nr.instances)if(n.avatar&&"isLocalAvatar"in n.avatar){let i=pr.All;this.isSpectatingSelf&&(i=t&&n.avatar.isLocalAvatar?pr.FirstPerson:pr.ThirdPerson);const r=n.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(i)}}resetAvatarFlags(){var t;for(const n of nr.instances)if(n.avatar&&"flags"in n.avatar){const i=n.avatar.flags;if(!i)continue;for(const r of i)(t=n.avatar)!=null&&t.isLocalAvatar?r.UpdateVisible(pr.FirstPerson):r.UpdateVisible(pr.ThirdPerson)}}}class Ste{constructor(e,t,n){x(this,"context");x(this,"cam");x(this,"spectator");x(this,"follow");x(this,"target");x(this,"view");x(this,"currentObject");this.context=e,this.cam=t,this.spectator=n}get currentTarget(){return this.view}set(e){const t=e==null?void 0:e.currentObject;if(!t){this.spectator.stopSpectating();return}t!==this.currentObject&&(this.currentObject=t,this.view=e,this.follow||(this.follow=Ee.addNewComponent(this.cam.gameObject,tx)),this.target||(this.target=new Ft),t.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,co&&console.log("FOLLOW",t),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){co&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&Ee.destroy(this.follow)}update(e){var i,r,o,l,h,u;if(((i=this.currentTarget)==null?void 0:i.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){co&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(co&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const t=this.context.mainCamera;t&&(this.cam.cam.near!==t.near||this.cam.cam.far!==t.far)&&(this.cam.cam.near=t.near,this.cam.cam.far=t.far,this.cam.cam.updateProjectionMatrix());const n=(l=this.follow)==null?void 0:l.target;if(!(!n||!this.follow)){switch(e){case 0:((h=this.view)==null?void 0:h.viewDevice)!==Jl.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),n.position.set(0,0,0);break;case 1:this.follow.followFactor=3,this.follow.rotateFactor=2,n.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((u=this.view)==null?void 0:u.viewDevice)!==Jl.Browser?n.quaternion.copy(Mte):n.quaternion.identity()}}}const Mte=new kt().setFromAxisAngle(new q(0,1,0),Math.PI);class Tte{constructor(e,t){x(this,"context");x(this,"spectator");this.context=e,this.spectator=t,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),window.addEventListener("keydown",i=>{i.key==="Escape"&&this.spectator.stopSpectating()});let n=0;this.context.input.addEventListener(O_.PointerDown,i=>{n=this.context.time.time}),this.context.input.addEventListener(O_.PointerUp,i=>{const r=this.context.time.time-n;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const e=new nc;e.setMask(16777215);const t=this.context.physics.raycast(e);if(co&&console.log(...t),t!=null&&t.length)for(const n of t){if(n.distance<.2)continue;const i=n.object,r=Ee.getComponentInParent(i,nr),o=r==null?void 0:r.connectionId;if(o){const l=this.context.players.getPlayerView(o);this.spectator.target=l,co&&console.log("spectate",o,r);break}}}}class Ite{constructor(e,t,n){x(this,"guid");x(this,"dontSave",!0);x(this,"targetUserId");x(this,"stoppedFollowing");this.guid=e,this.targetUserId=t,this.stoppedFollowing=n}}class Rte{constructor(e,t){x(this,"guid");x(this,"userId");this.guid=e.guid,this.userId=t}}class Pte{constructor(e,t){x(this,"followers",[]);x(this,"context");x(this,"spectator");x(this,"_followerEventMethod");x(this,"_requestFollowMethod");x(this,"_joinedRoomMethod");x(this,"_lastRequestFollowUser");x(this,"_enforceFollowInterval");this.context=e,this.spectator=t,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(Ds.JoinedRoom,this._joinedRoomMethod),document.addEventListener("keydown",e=>{e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0)})}destroy(){this.context.connection.stopListening("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListening("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListening(Ds.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,t){if(co&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,t),this.context.connection.connectionId){const n=(e==null?void 0:e.userId)===void 0,i=n?t:e==null?void 0:e.userId,r=new Ite(this.context.connection.connectionId,i,n);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(e=!1){if(co&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const t=e?void 0:this.context.connection.connectionId,n=new Rte(this.spectator,t);this.context.connection.send("spectator-request-follow",n)}}onUserJoinedRoom(){Ct("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const t=e.targetUserId,n=e.guid;if(co&&console.log(e),t===this.context.connection.connectionId)if(e.stoppedFollowing){const i=this.followers.indexOf(n);i!==-1&&(this.followers.splice(i,1),this.removeDisconnectedFollowers(),console.log(n,"unfollows you",this.followers.length))}else this.followers.includes(n)||(this.followers.push(n),this.removeDisconnectedFollowers(),console.log(n,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const t=this.followers[e];this.context.connection.userIsInRoom(t)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const t=this.context.players.getPlayerView(e.userId);if(t)this.spectator.target=t;else return co&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(co&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class _3 extends pt{constructor(){super(...arguments);x(this,"anchor",null);x(this,"connectedBody",null);x(this,"connectedAnchor",null);x(this,"spring",10);x(this,"damper",.2);x(this,"rb",null)}awake(){if(this.rb=Ee.getComponent(this.gameObject,yr),!this.connectedBody||!this.connectedBody.body||!this.rb||!this.rb.body)return;this.connectedBody.body.mass=Math.min(this.rb.body.mass*.99,this.connectedBody.body.mass);const t=new Y7(this.rb.body,this.connectedBody.body,{restLength:.01,stiffness:this.spring*.5,damping:this.damper});this.context.physics.addPostStepListener(n=>{t.applyForce()})}update(){}}var Bte=Object.defineProperty,Lte=Object.getOwnPropertyDescriptor,ix=(a,e,t,n)=>{for(var i=n>1?void 0:n?Lte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Bte(e,t,i),i};class QM{constructor(){x(this,"texture");x(this,"triangles");x(this,"uv");x(this,"vertices");x(this,"_geometry")}}ix([we(Ii)],QM.prototype,"texture",2);class aL{static getOrCreateGeometry(e){if(e._geometry)return e._geometry;const t=new Sn;e._geometry=t;const n=new Float32Array(e.triangles.length*3),i=new Float32Array(e.triangles.length*2);for(let r=0;r<e.triangles.length;r+=1){const o=e.triangles[r];n[r*3]=-e.vertices[o].x,n[r*3+1]=e.vertices[o].y,n[r*3+2]=0;const l=e.uv[o];i[r*2]=l.x,i[r*2+1]=1-l.y}return t.setAttribute("position",new Jn(n,3)),t.setAttribute("uv",new Jn(i,2)),t}}class fA extends pt{constructor(){super(...arguments);x(this,"drawMode",0);x(this,"size",{x:1,y:1});x(this,"color");x(this,"sharedMaterial");x(this,"_sprite");x(this,"_currentSprite")}get sprite(){return this._sprite}set sprite(t){t!==this._sprite&&(this._sprite=t,this.updateSprite())}awake(){this._currentSprite=void 0}start(){this.drawMode===2&&console.warn("Tiled draw mode is not supported yet",this),this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(){if(!!this.__didAwake&&!!this.sprite&&!!this.sharedMaterial){if(this._currentSprite)this._currentSprite.geometry=aL.getOrCreateGeometry(this.sprite),this._currentSprite.material.map=this.sprite.texture;else{const t=new Hi({color:16777215,side:ir});if(!t)return;if(this.color&&(t.color||(t.color=new ye),t.color.copy(this.color),t.opacity=this.color.alpha),t.alphaTest=.5,this.sprite.texture&&!t.wireframe){const n=this.sprite.texture;t.map=n}this._currentSprite=new _t(aL.getOrCreateGeometry(this.sprite),t)}this._currentSprite.parent!==this.gameObject&&(this.drawMode===2&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite))}}}ix([we()],fA.prototype,"drawMode",2);ix([we(fo)],fA.prototype,"color",2);ix([we(vs)],fA.prototype,"sharedMaterial",2);class Ua{constructor(){x(this,"bb",null);x(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedCameraModel(e,t){return(t||new Ua).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,t){return e.setPosition(e.position()+Vv),(t||new Ua).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}guid(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new po).__init(this.bb_pos+t,this.bb):null}rot(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new po).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,t){e.addFieldOffset(0,t,0)}static addGuid(e,t){e.addFieldOffset(1,t,0)}static addDontSave(e,t){e.addFieldInt8(2,+t,0)}static addPos(e,t){e.addFieldStruct(3,t,0)}static addRot(e,t){e.addFieldStruct(4,t,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(e,t){e.finish(t,void 0,!0)}}var Dte=Object.defineProperty,Ote=Object.getOwnPropertyDescriptor,Fte=(a,e,t,n)=>{for(var i=n>1?void 0:n?Ote(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Dte(e,t,i),i};const K_="SCAM";aM(K_,Ua.getRootAsSyncedCameraModel);const ro=new tp;class kte{constructor(e,t){x(this,"userId");x(this,"guid");this.guid=t,this.userId=e}send(e,t){if(e){ro.clear();const n=ro.createString(this.guid),i=ro.createString(this.userId);Ua.startSyncedCameraModel(ro),Ua.addGuid(ro,n),Ua.addUserId(ro,i);const r=ni(e),o=ND(e);Ua.addPos(ro,po.createVec3(ro,r.x,r.y,r.z)),Ua.addRot(ro,po.createVec3(ro,o.x,o.y,o.z));const l=Ua.endSyncedCameraModel(ro);ro.finish(l,K_),t.sendBinary(ro.asUint8Array())}}}var IC;const NE=(IC=class extends pt{constructor(){super(...arguments);x(this,"cameraPrefab",null);x(this,"_lastWorldPosition");x(this,"_lastWorldQuaternion");x(this,"_model",null);x(this,"_needsUpdate",!0);x(this,"_lastUpdateTime",0);x(this,"remoteCams",{});x(this,"userToCamMap",{});x(this,"_camTimeoutInSeconds",10);x(this,"_receiveCallback",null)}getCameraObject(e){const t=this.userToCamMap[e];return t?this.remoteCams[t].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinrary(K_,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(K_,this._receiveCallback)}update(){for(const i in this.remoteCams){const r=this.remoteCams[i],o=this.context.time.realtimeSinceStartup-r.lastUpdate;if(!r||o>this._camTimeoutInSeconds){console.log("Remote cam timeout",r,o),r!=null&&r.obj&&Ee.destroy(r.obj),delete this.remoteCams[i],r&&delete this.userToCamMap[r.userId],NE.instances.push(r),this.context.players.removePlayerView(r.userId,Jl.Browser);continue}}if(_i.IsInWebXR)return;const e=this.context.mainCamera;if(e===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new kte(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const t=ni(e),n=ga(e);(t.distanceTo(this._lastWorldPosition)>.001||n.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(t),this._lastWorldQuaternion.copy(n),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(e,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,e,Jl.Browser))}onReceivedRemoteCameraInfoBin(e){const t=e.guid();if(!t)return;const n=e.userId();if(!n||!this.context.connection.userIsInRoom(n)||!this.cameraPrefab)return;let i=this.remoteCams[t];if(!i)if("isObject3D"in this.cameraPrefab){const h=new Go;h.context=this.context;const u=Ee.instantiate(this.cameraPrefab,h);i=this.remoteCams[t]={obj:u,lastUpdate:this.context.time.realtimeSinceStartup,userId:n},i.obj.visible=!0,this.gameObject.add(u),this.userToCamMap[n]=t,NE.instances.push(i);const f=Ee.getOrAddComponent(u,nr);f.connectionId=n,f.avatar=u}else return;const r=i.obj;this.context.players.setPlayerView(n,r,Jl.Browser),i.lastUpdate=this.context.time.realtimeSinceStartup,Pr.markDirty(r);const o=e.pos();o&&$S(r,o.x(),o.y(),o.z());const l=e.rot();l&&UD(r,l.x(),l.y(),l.z())}},x(IC,"instances",[]),IC);let jM=NE;Fte([we([Ft,Ho])],jM.prototype,"cameraPrefab",2);var Nte=Object.defineProperty,Ute=Object.getOwnPropertyDescriptor,pA=(a,e,t,n)=>{for(var i=n>1?void 0:n?Ute(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Nte(e,t,i),i};const _C="view",cL=Ct("debugsyncedroom");class Yu extends pt{constructor(){super(...arguments);x(this,"roomName");x(this,"urlParameterName");x(this,"joinRandomRoom",!0);x(this,"requireRoomParameter",!1);x(this,"autoRejoin",!0);x(this,"_roomPrefix");x(this,"_lastPingTime",0);x(this,"_lastRoomTime",-1)}awake(){this._roomPrefix===void 0&&(this._roomPrefix=this.roomName,this.roomName="")}onEnable(){const t=Ct(_C);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}this.tryJoinRoom()}onDisable(){this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}tryJoinRoom(t=0){t===void 0&&(t=0);let n=!1;if(this.urlParameterName){const i=Ct(this.urlParameterName);if(i&&typeof i=="string"){n=!0;const r=VX(i);this.roomName=r}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(console.log("generate room name"),this.roomName=this.generateRoomName());return this.requireRoomParameter&&!n?(cL&&console.log('No required room parameter "'+this.urlParameterName+'" in url - will not connect to networking backend.'),!1):!this.roomName||this.roomName.length<=0?(cL&&console.error('Missing room name on "'+this.name+'". Make sure this is correctly configured in Unity',this.context.connection.isDebugEnabled?this:""),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.context.connection.joinRoom(this.roomName),!0)}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.send("ping",{time:this.context.time.time})),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you)"))}get currentRoomName(){const t=Ct(_C);return t||Ct(this.urlParameterName)}setRandomRoomUrlParameter(){const t=ID(),n=this.generateRoomName();Ct(this.urlParameterName)?t.set(this.urlParameterName,n):t.append(this.urlParameterName,n),zX(n,t)}generateRoomName(){return HX()+"_"+GX(100,999)}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,n=new URLSearchParams(t);return n.has(this.urlParameterName)&&n.delete(this.urlParameterName),n.set(_C,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+n.toString()}return null}}pA([we()],Yu.prototype,"roomName",2);pA([we()],Yu.prototype,"urlParameterName",2);pA([we()],Yu.prototype,"joinRandomRoom",2);pA([we()],Yu.prototype,"requireRoomParameter",2);pA([we()],Yu.prototype,"autoRejoin",2);function zte(){const a=Ct("testwindowcount")||0;a&&a>0&&Gte(a)}function Gte(a){if(Ct("testwindow"))return null;const e=new URL(window.location.href);R_(e.searchParams,U_,1),R_(e.searchParams,"testwindow",1);const t=e.toString(),n=[];window.onbeforeunload=()=>{for(const h of n)h.close()};const i=.05,r=128;let o=0,l=0;for(let h=0;h<a;h++){o*r+r*.01>=window.innerWidth&&(l+=1,o=0);const u=o*(r*(1+i))+window.screenLeft,f=l*(r*(1+i))+window.screenTop+90+60*l;o+=1;const g=window.open(t,"test window "+h,`popup=yes width=${r} height=${r} top=${f} left=${u}`);if(!g){console.warn("Failed to open window");continue}n.push(g),g.onload=()=>{g.onbeforeunload=()=>{for(let m=0;m<n.length;m++){const A=n[m];A!==g&&A.close()}n.length=0}}}return n}class v3 extends pt{awake(){zte()}}class x3 extends pt{constructor(){super(...arguments);x(this,"transformsPerFrame",10);x(this,"interval",0);x(this,"useFlatbuffers",!0);x(this,"builder",null);x(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinrary(vg,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new w3(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(!!this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new tp(1024));const t=this.builder;for(let n=0;n<this.transformsPerFrame;n++){t.clear();const i=lF(this.context.connection.connectionId,this);this.context.connection.sendBinary(i)}}else if(this.models)for(let t=0;t<this.models.length;t++){const n=this.models[t];n.dontSave=!0,n.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,n)}}}}class w3{constructor(e,t){x(this,"guid");x(this,"fast",!1);x(this,"position");x(this,"rotation");x(this,"velocity");x(this,"dontSave");this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,t){const n=e.worldPosition;this.position.x=n.x,this.position.y=n.y,this.position.z=n.z;const i=e.worldQuaternion;if(this.rotation.x=i.x,this.rotation.y=i.y,this.rotation.z=i.z,this.rotation.w=i.w,this.fast=!1,t){const r=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}x(w3,"temp",new q);const su=new ju,Gr=new q,Dl=new q,Ki=new kt,lL={X:new q(1,0,0),Y:new q(0,1,0),Z:new q(0,0,1)},vC={type:"change"},hL={type:"mouseDown"},uL={type:"mouseUp",mode:null},dL={type:"objectChange"};class Hte extends Ft{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new Xte;this._gizmo=n,this.add(n);const i=new Yte;this._plane=i,this.add(i);const r=this;function o(I,M){let R=M;Object.defineProperty(r,I,{get:function(){return R!==void 0?R:M},set:function(T){R!==T&&(R=T,i[I]=T,n[I]=T,r.dispatchEvent({type:I+"-changed",value:T}),r.dispatchEvent(vC))}}),r[I]=M,i[I]=M,n[I]=M}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const l=new q,h=new q,u=new kt,f=new kt,g=new q,m=new kt,A=new q,v=new q,b=new q,C=0,S=new q;o("worldPosition",l),o("worldPositionStart",h),o("worldQuaternion",u),o("worldQuaternionStart",f),o("cameraPosition",g),o("cameraQuaternion",m),o("pointStart",A),o("pointEnd",v),o("rotationAxis",b),o("rotationAngle",C),o("eye",S),this._offset=new q,this._startNorm=new q,this._endNorm=new q,this._cameraScale=new q,this._parentPosition=new q,this._parentQuaternion=new kt,this._parentQuaternionInv=new kt,this._parentScale=new q,this._worldScaleStart=new q,this._worldQuaternionInv=new kt,this._worldScale=new q,this._positionStart=new q,this._quaternionStart=new kt,this._scaleStart=new q,this._getPointer=Vte.bind(this),this._onPointerDown=Qte.bind(this),this._onPointerHover=Wte.bind(this),this._onPointerMove=jte.bind(this),this._onPointerUp=qte.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;su.setFromCamera(e,this.camera);const t=xC(this._gizmo.picker[this.mode],su);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){su.setFromCamera(e,this.camera);const t=xC(this._plane,su,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,hL.mode=this.mode,this.dispatchEvent(hL)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let r=this.space;if(n==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;su.setFromCamera(e,this.camera);const o=xC(this._plane,su,!0);if(!!o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(Ki.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),r==="world"&&(i.parent&&i.position.add(Gr.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Gr.setFromMatrixPosition(i.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),Dl.set(l,l,l)}else Gr.copy(this.pointStart),Dl.copy(this.pointEnd),Gr.applyQuaternion(this._worldQuaternionInv),Dl.applyQuaternion(this._worldQuaternionInv),Dl.divide(Gr),t.search("X")===-1&&(Dl.x=1),t.search("Y")===-1&&(Dl.y=1),t.search("Z")===-1&&(Dl.z=1);i.scale.copy(this._scaleStart).multiply(Dl),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(Gr.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Gr.copy(this.rotationAxis).cross(this.eye))*l):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(lL[t]),Gr.copy(lL[t]),r==="local"&&Gr.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Gr.cross(this.eye).normalize())*l),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Ki.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Ki.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(vC),this.dispatchEvent(dL)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(uL.mode=this.mode,this.dispatchEvent(uL)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(vC),this.dispatchEvent(dL),this.pointStart.copy(this.pointEnd))}getRaycaster(){return su}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Vte(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function Wte(a){if(!!this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function Qte(a){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function jte(a){!this.enabled||this.pointerMove(this._getPointer(a))}function qte(a){!this.enabled||(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function xC(a,e,t){const n=e.intersectObject(a,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||t)return n[i];return!1}const ky=new _s,Ui=new q(0,1,0),fL=new q(0,0,0),pL=new fn,Ny=new kt,c_=new kt,La=new q,mL=new fn,km=new q(1,0,0),pu=new q(0,1,0),Nm=new q(0,0,1),Uy=new q,Tm=new q,Im=new q;class Xte extends Ft{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Hi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Ts({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const l=e.clone();l.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const g=e.clone();g.opacity=.25;const m=e.clone();m.color.setHex(16776960),m.opacity=.25,e.clone().color.setHex(16776960);const v=e.clone();v.color.setHex(7895160);const b=new ls(0,.04,.1,12);b.translate(0,.05,0);const C=new zi(.08,.08,.08);C.translate(0,.04,0);const S=new Sn;S.setAttribute("position",new tn([0,0,0,1,0,0],3));const I=new ls(.0075,.0075,.5,3);I.translate(0,.25,0);function M(se,ae){const ve=new za(se,.0075,3,64,ae*Math.PI*2);return ve.rotateY(Math.PI/2),ve.rotateX(Math.PI/2),ve}function R(){const se=new Sn;return se.setAttribute("position",new tn([0,0,0,1,1,1],3)),se}const T={X:[[new _t(b,r),[.5,0,0],[0,0,-Math.PI/2]],[new _t(b,r),[-.5,0,0],[0,0,Math.PI/2]],[new _t(I,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new _t(b,o),[0,.5,0]],[new _t(b,o),[0,-.5,0],[Math.PI,0,0]],[new _t(I,o)]],Z:[[new _t(b,l),[0,0,.5],[Math.PI/2,0,0]],[new _t(b,l),[0,0,-.5],[-Math.PI/2,0,0]],[new _t(I,l),null,[Math.PI/2,0,0]]],XYZ:[[new _t(new Va(.1,0),g.clone()),[0,0,0]]],XY:[[new _t(new zi(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new _t(new zi(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new zi(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},B={X:[[new _t(new ls(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new _t(new ls(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _t(new ls(.2,0,.6,4),n),[0,.3,0]],[new _t(new ls(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _t(new ls(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new _t(new ls(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new _t(new Va(.2,0),n)]],XY:[[new _t(new zi(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new _t(new zi(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new zi(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},F={START:[[new _t(new Va(.01,2),i),null,null,null,"helper"]],END:[[new _t(new Va(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ss(R(),i),null,null,null,"helper"]],X:[[new Ss(S,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ss(S,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ss(S,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D={XYZE:[[new _t(M(.5,1),v),null,[0,Math.PI/2,0]]],X:[[new _t(M(.5,.5),r)]],Y:[[new _t(M(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new _t(M(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new _t(M(.75,1),m),null,[0,Math.PI/2,0]]]},U={AXIS:[[new Ss(S,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},W={XYZE:[[new _t(new mo(.25,10,8),n)]],X:[[new _t(new za(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new _t(new za(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new _t(new za(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new _t(new za(.75,.1,2,24),n)]]},J={X:[[new _t(C,r),[.5,0,0],[0,0,-Math.PI/2]],[new _t(I,r),[0,0,0],[0,0,-Math.PI/2]],[new _t(C,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new _t(C,o),[0,.5,0]],[new _t(I,o)],[new _t(C,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new _t(C,l),[0,0,.5],[Math.PI/2,0,0]],[new _t(I,l),[0,0,0],[Math.PI/2,0,0]],[new _t(C,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new _t(new zi(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new _t(new zi(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new zi(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _t(new zi(.1,.1,.1),g.clone())]]},ee={X:[[new _t(new ls(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new _t(new ls(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _t(new ls(.2,0,.6,4),n),[0,.3,0]],[new _t(new ls(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _t(new ls(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new _t(new ls(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new _t(new zi(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new _t(new zi(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new zi(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _t(new zi(.2,.2,.2),n),[0,0,0]]]},Q={X:[[new Ss(S,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ss(S,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ss(S,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Y(se){const ae=new Ft;for(const ve in se)for(let xe=se[ve].length;xe--;){const Ae=se[ve][xe][0].clone(),Ie=se[ve][xe][1],Le=se[ve][xe][2],De=se[ve][xe][3],$e=se[ve][xe][4];Ae.name=ve,Ae.tag=$e,Ie&&Ae.position.set(Ie[0],Ie[1],Ie[2]),Le&&Ae.rotation.set(Le[0],Le[1],Le[2]),De&&Ae.scale.set(De[0],De[1],De[2]),Ae.updateMatrix();const vt=Ae.geometry.clone();vt.applyMatrix4(Ae.matrix),Ae.geometry=vt,Ae.renderOrder=1/0,Ae.position.set(0,0,0),Ae.rotation.set(0,0,0),Ae.scale.set(1,1,1),ae.add(Ae)}return ae}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Y(T)),this.add(this.gizmo.rotate=Y(D)),this.add(this.gizmo.scale=Y(J)),this.add(this.picker.translate=Y(B)),this.add(this.picker.rotate=Y(W)),this.add(this.picker.scale=Y(ee)),this.add(this.helper.translate=Y(F)),this.add(this.helper.rotate=Y(U)),this.add(this.helper.scale=Y(Q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:c_;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let r=0;r<i.length;r++){const o=i[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(l*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,this.axis==="X"&&(Ki.setFromEuler(ky.set(0,0,0)),o.quaternion.copy(n).multiply(Ki),Math.abs(Ui.copy(km).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Ki.setFromEuler(ky.set(0,0,Math.PI/2)),o.quaternion.copy(n).multiply(Ki),Math.abs(Ui.copy(pu).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Ki.setFromEuler(ky.set(0,Math.PI/2,0)),o.quaternion.copy(n).multiply(Ki),Math.abs(Ui.copy(Nm).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Ki.setFromEuler(ky.set(0,Math.PI/2,0)),Ui.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(pL.lookAt(fL,Ui,pu)),o.quaternion.multiply(Ki),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Gr.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Gr.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Gr),o.visible=this.dragging):(o.quaternion.copy(n),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Ui.copy(km).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Ui.copy(pu).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Ui.copy(Nm).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Ui.copy(Nm).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Ui.copy(km).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Ui.copy(pu).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Ny.copy(n),Ui.copy(this.eye).applyQuaternion(Ki.copy(n).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(pL.lookAt(this.eye,fL,pu)),o.name==="X"&&(Ki.setFromAxisAngle(km,Math.atan2(-Ui.y,Ui.z)),Ki.multiplyQuaternions(Ny,Ki),o.quaternion.copy(Ki)),o.name==="Y"&&(Ki.setFromAxisAngle(pu,Math.atan2(Ui.x,Ui.z)),Ki.multiplyQuaternions(Ny,Ki),o.quaternion.copy(Ki)),o.name==="Z"&&(Ki.setFromAxisAngle(Nm,Math.atan2(Ui.y,Ui.x)),Ki.multiplyQuaternions(Ny,Ki),o.quaternion.copy(Ki))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(h){return o.name===h}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class Yte extends _t{constructor(){super(new Yr(1e5,1e5,2,2),new Hi({visible:!1,wireframe:!0,side:ir,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Uy.copy(km).applyQuaternion(t==="local"?this.worldQuaternion:c_),Tm.copy(pu).applyQuaternion(t==="local"?this.worldQuaternion:c_),Im.copy(Nm).applyQuaternion(t==="local"?this.worldQuaternion:c_),Ui.copy(Tm),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ui.copy(this.eye).cross(Uy),La.copy(Uy).cross(Ui);break;case"Y":Ui.copy(this.eye).cross(Tm),La.copy(Tm).cross(Ui);break;case"Z":Ui.copy(this.eye).cross(Im),La.copy(Im).cross(Ui);break;case"XY":La.copy(Im);break;case"YZ":La.copy(Uy);break;case"XZ":Ui.copy(Im),La.copy(Tm);break;case"XYZ":case"E":La.set(0,0,0);break}break;case"rotate":default:La.set(0,0,0)}La.length()===0?this.quaternion.copy(this.cameraQuaternion):(mL.lookAt(Gr.set(0,0,0),La,Ui),this.quaternion.setFromRotationMatrix(mL)),super.updateMatrixWorld(e)}}var Jte=Object.defineProperty,Kte=Object.getOwnPropertyDescriptor,Zte=(a,e,t,n)=>{for(var i=n>1?void 0:n?Kte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Jte(e,t,i),i};class qM extends pt{constructor(){super(...arguments);x(this,"isGizmo",!0);x(this,"control");x(this,"orbit");x(this,"changeEventListener");x(this,"windowKeyDownListener");x(this,"windowKeyUpListener")}awake(){this.isGizmo&&!Zg||!this.context.mainCamera||(this.control=new Hte(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=.6,this.control.traverse(t=>{const n=t;if(n.layers.set(2),n){const i=n.material;i&&(i.opacity=.3)}}))}start(){var t;if(this.context.mainCamera){const n=(t=Ee.getComponentInParent(this.context.mainCamera,DO))!=null?t:void 0;this.orbit=n}}onEnable(){var t;this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject)),this.changeEventListener=this.onControlChangedEvent.bind(this),(t=this.control)==null||t.addEventListener("dragging-changed",this.changeEventListener),this.attachWindowEvents()}onDisable(){var t,n;(t=this.control)==null||t.removeFromParent(),this.changeEventListener&&((n=this.control)==null||n.removeEventListener("dragging-changed",this.changeEventListener))}onControlChangedEvent(t){const n=this.orbit;if(n&&(n.enabled=!t.value),t.value){const i=Ee.getComponentInParent(this.gameObject,oh);i&&i.requestOwnership()}}attachWindowEvents(){const t=this.control;!t||(this.windowKeyDownListener||(this.windowKeyDownListener=n=>{switch(n.keyCode){case 81:t.setSpace(t.space==="local"?"world":"local");break;case 16:t.setTranslationSnap(100),t.setRotationSnap(zu.degToRad(15)),t.setScaleSnap(.25);break;case 87:t.setMode("translate");break;case 69:t.setMode("rotate");break;case 82:t.setMode("scale");break;case 187:case 107:t.setSize(t.size+.1);break;case 189:case 109:t.setSize(Math.max(t.size-.1,.1));break;case 88:t.showX=!t.showX;break;case 89:t.showY=!t.showY;break;case 90:t.showZ=!t.showZ;break;case 32:t.enabled=!t.enabled;break}}),this.windowKeyUpListener||(this.windowKeyUpListener=n=>{switch(n.keyCode){case 16:t.setTranslationSnap(null),t.setRotationSnap(null),t.setScaleSnap(null);break}}),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener))}}Zte([we()],qM.prototype,"isGizmo",2);var $te=Object.defineProperty,ene=Object.getOwnPropertyDescriptor,b3=(a,e,t,n)=>{for(var i=n>1?void 0:n?ene(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&$te(e,t,i),i};const Z_=Ct("debugvolume");var C3=(a=>(a[a.None=0]="None",a[a.Neutral=1]="Neutral",a[a.ACES=2]="ACES",a))(C3||{});class E3{constructor(){x(this,"overrideState",!1);x(this,"value",0)}}class mp{constructor(){x(this,"active",!1);x(this,"parameters")}}class sx extends mp{constructor(){super(...arguments);x(this,"mode")}get isToneMapping(){return!0}}class rx extends mp{constructor(){super(...arguments);x(this,"postExposure")}}function tne(a){return"mode"in a?sx:"postExposure"in a?rx:mp}const gL=Symbol("volumeprofile");class ox{constructor(){x(this,"components")}apply(e){this.onUpdate(e,!1)}unapply(e){this.onUpdate(e,!0)}onUpdate(e,t){var o,l,h,u,f,g,m;if(!this.components)return;const n=e.renderer,r=n[gL]!==void 0;if(t){if(!r)return}else n[gL]=this;for(const A of this.components)if(A instanceof sx){const v=A;if(!A.active||t){e.renderer.toneMapping=v_;continue}switch(Z_&&console.log("VOLUME:",C3[(l=(o=v.mode)==null?void 0:o.value)!=null?l:0]),(u=(h=v.mode)==null?void 0:h.value)!=null?u:0){case 0:e.renderer.toneMapping=v_;break;case 1:e.renderer.toneMapping=eS;break;case 2:e.renderer.toneMapping=tS;break}}else if(A instanceof rx){const v=A;Z_&&console.log(v.postExposure);const b=Math.pow(2,(g=(f=v.postExposure)==null?void 0:f.value)!=null?g:0),C=((m=v.postExposure)==null?void 0:m.overrideState)&&!t;e.renderer.toneMappingExposure=C?b:1}}}b3([we([a=>tne(a),mp])],ox.prototype,"components",2);class XM extends pt{constructor(){super(...arguments);x(this,"sharedProfile")}awake(){Z_&&(console.log(this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",t=>{t.key==="p"&&(console.log("Toggle volume: "+this.name,!this.enabled),this.enabled=!this.enabled)}))}onEnable(){var t;Z_&&console.log("APPLY VOLUME",this),(t=this.sharedProfile)==null||t.apply(this.context)}onDisable(){var t;(t=this.sharedProfile)==null||t.unapply(this.context)}}b3([we(ox)],XM.prototype,"sharedProfile",2);class YM{constructor(){x(this,"guid");x(this,"dontSave",!0);x(this,"userId");x(this,"point",{x:0,y:0,z:0});x(this,"source",{x:0,y:0,z:0});x(this,"target")}update(e,t,n,i=void 0){this.userId=e.connection.connectionId,this.point.x=t.x,this.point.y=t.y,this.point.z=t.z,this.source.x=n.x,this.source.y=n.y,this.source.z=n.z,this.target=i}}class S3 extends pt{constructor(){super(...arguments);x(this,"prefab",null);x(this,"_grabModels",[]);x(this,"_grabModelsUpdateTime",[]);x(this,"_addOrUpdateSub",null);x(this,"_endSub",null);x(this,"_freeSub",null);x(this,"_instances",{});x(this,"temp",new q)}awake(){this.prefab&&(this.prefab.visible=!1)}onEnable(){this._addOrUpdateSub=this.context.connection.beginListen("xr-grab-visual-start-or-update",this.onRemoteGrabStartOrUpdate.bind(this)),this._endSub=this.context.connection.beginListen("xr-grab-visual-end",this.onRemoteGrabEnd.bind(this)),this._freeSub=fa.AddEventListener(SE.WillFree,this.onAttachedObjectFree.bind(this))}onDisable(){this.context.connection.stopListening("xr-grab-visual-start-or-update",this._addOrUpdateSub),this.context.connection.stopListening("xr-grab-visual-end",this._endSub),fa.RemoveEventListener(SE.WillFree,this._freeSub)}addOrUpdateGrab(t){this.context.connection.send("xr-grab-visual-start-or-update",t,N_.Queued)}endGrab(t){this.context.connection.send("xr-grab-visual-end",t,N_.Queued)}onRemoteGrabStartOrUpdate(t){if(!this.prefab)return;const n=this._instances[t.guid];if(!n){const i=Ee.instantiate(this.prefab);if(i.visible=!0,this._instances[t.guid]={instance:i,model:t},t.userId){const r=Ee.getComponentsInChildren(i,ah);if((r==null?void 0:r.length)>0)for(const o of r)o.assignUserColor(t.userId)}return}n.model=t}onRemoteGrabEnd(t){if(!t)return;const n=t.guid;this._instances[n]&&(Ee.destroy(this._instances[n].instance),delete this._instances[n])}onAttachedObjectFree(t){if(this._grabModels.length<=0)return;const n=this._grabModels[0];this.updateModel(n,t),this.endGrab(n)}onBeforeRender(){if(this.updateRendering(),!!this.prefab&&(this.prefab.visible=!1,this.context.time.frameCount%10===0))for(let t=0;t<fa.Current.length;t++){const n=fa.Current[t];if(!n.controller||!n.selected)continue;this._grabModels.length<=t&&(this._grabModels.push(new YM),this._grabModelsUpdateTime.push(0)),this._grabModelsUpdateTime[t]=this.context.time.time;const i=this._grabModels[t];this.updateModel(i,n),this.addOrUpdateGrab(i)}}updateModel(t,n){if(!n.controller||!n.selected)return;t.guid=n.grabUUID;const i=n.selected.guid;t.update(this.context,n.grabPoint,n.controller.worldPosition,i)}updateRendering(){const t=this.context.time.deltaTime/.5;for(const n in this._instances){const{instance:i,model:r}=this._instances[n];if(!i||!r)continue;const{point:o}=r,l=ni(i);this.temp.set(o.x,o.y,o.z),l.lerp(this.temp,t),sr(i,l)}}}var nne=Object.defineProperty,ine=Object.getOwnPropertyDescriptor,ax=(a,e,t,n)=>{for(var i=n>1?void 0:n?ine(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&nne(e,t,i),i};class gp extends pt{constructor(){super(...arguments);x(this,"eyes",[]);x(this,"lastBlinkTime",0);x(this,"blinkLength",0);x(this,"eyesOpen",!0);x(this,"state",null)}awake(){this.state=Ee.getComponentInParent(this.gameObject,mr)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const n of this.eyes)n&&(n.visible=this.eyesOpen)}}}ax([we(Ft)],gp.prototype,"eyes",2);ax([we()],gp.prototype,"lastBlinkTime",2);ax([we()],gp.prototype,"blinkLength",2);ax([we()],gp.prototype,"eyesOpen",2);var sne=Object.defineProperty,rne=Object.getOwnPropertyDescriptor,JM=(a,e,t,n)=>{for(var i=n>1?void 0:n?rne(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&sne(e,t,i),i},RC;const M3=(RC=class extends pt{constructor(){super(...arguments);x(this,"head",null);x(this,"eyes",null);x(this,"target",null);x(this,"brain",null);x(this,"vec",new q);x(this,"currentTargetPoint",new q)}awake(){this.brain||(this.brain=Ee.getComponentInParent(this.gameObject,z_)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=Ee.addNewComponent(this.gameObject,z_)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const e=this.target;if(e&&this.head){const t=this.eyes;if(t){const n=ni(e);this.currentTargetPoint.lerp(n,this.context.time.deltaTime/.1);const i=ni(this.head),r=this.vec.copy(this.currentTargetPoint).sub(i).normalize();if(r.length()<.1)return;const o=M3.forward;if(o.set(0,0,1),o.applyQuaternion(ga(this.head)),o.dot(r)>.45)for(let h=0;h<t.length;h++)t[h].lookAt(this.currentTargetPoint)}}}},x(RC,"forward",new q(0,0,1)),RC);let mA=M3;JM([we(Ft)],mA.prototype,"head",2);JM([we(Ft)],mA.prototype,"eyes",2);JM([we(Ft)],mA.prototype,"target",2);var one=Object.defineProperty,ane=Object.getOwnPropertyDescriptor,T3=(a,e,t,n)=>{for(var i=n>1?void 0:n?ane(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&one(e,t,i),i};const cne=Ct("debugmouth");class cx extends pt{constructor(){super(...arguments);x(this,"idle",[]);x(this,"talking",[]);x(this,"marker",null);x(this,"voip",null);x(this,"lastMouthChangeTime",0);x(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=Ee.findObjectOfType(yh,this.context),this.marker||(this.marker=Ee.getComponentInParent(this.gameObject,nr))},3e3)}update(){var i,r,o;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=(r=(i=this.marker)==null?void 0:i.connectionId)!=null?r:null;if(!t){cne&&(t=null);return}const n=(o=this.voip.getFrequency(t))!=null?o:0;this.updateLips(n)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const n=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,n)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const n=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,n)}}}setMouthShapeActive(t,n){if(!!t){t!=this.idle?this.idle.map(i=>i.visible=!1):this.talking.map(i=>i.visible=!1);for(let i=0;i<t.length;i++){const r=t[i];r&&(r.visible=i===n)}}}}T3([we(Ft)],cx.prototype,"idle",2);T3([we(Ft)],cx.prototype,"talking",2);class I3 extends pt{constructor(){super(...arguments);x(this,"voip",null);x(this,"marker",null);x(this,"_startPosition",null)}awake(){this.voip=Ee.findObjectOfType(yh,this.context),this.marker=Ee.getComponentInParent(this.gameObject,nr)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,n=this.voip.getFrequency(t);if(n==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());let i=n/100;this.gameObject.position.y=this._startPosition.y+i*.07}}const lne=Ct("logstats");class R3 extends pt{onEnable(){console.log(this),lne&&this.startCoroutine(this.run(),qr.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var hne=Object.defineProperty,une=Object.getOwnPropertyDescriptor,dne=(a,e,t,n)=>{for(var i=n>1?void 0:n?une(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&hne(e,t,i),i};class KM{constructor(){x(this,"guid")}}class ZM{constructor(){x(this,"signal");x(this,"reaction");x(this,"$serializedTypes",{signal:KM,reaction:ya})}}class lx extends pt{constructor(){super(...arguments);x(this,"events")}start(){console.log(this)}invoke(t){if(!this.events||!Array.isArray(this.events))return;let n=typeof t=="object"?t.guid:t;for(const i of this.events)if(i.signal.guid===n)try{if(i.reaction){if(!i.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",i,this);continue}}else{console.warn("Missing reaction for signal",i,this);continue}i.reaction.invoke()}catch(r){console.error(r)}}}dne([we(ZM)],lx.prototype,"events",2);var Oa=(a=>(a.Activation="ActivationTrack",a.Animation="AnimationTrack",a.Audio="AudioTrack",a.Control="ControlTrack",a.Marker="MarkerTrack",a.Signal="SignalTrack",a))(Oa||{}),l_=(a=>(a[a.None=0]="None",a[a.Hold=1]="Hold",a[a.Loop=2]="Loop",a[a.PingPong=3]="PingPong",a[a.Continue=4]="Continue",a))(l_||{}),P3=(a=>(a.Signal="SignalEmitter",a))(P3||{});const Rf=Ct("debugtimeline");class hx{constructor(){x(this,"director");x(this,"track")}get muted(){return this.track.muted}set muted(e){var t;e!==this.track.muted&&(this.track.muted=e,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(e=!1){var t;if(!!((t=this.track)!=null&&t.clips))if(e)for(let n=this.track.clips.length-1;n>=0;n--)yield this.track.clips[n];else for(const n of this.track.clips)yield n}getClipTime(e,t){return t.clipIn+(e-t.start)*t.timeScale}getClipTimeNormalized(e,t){return(e-t.start)/t.duration}evaluateWeight(e,t,n,i=!0){if(t<0||t>=n.length)return 0;const r=n[t];if(i||e>=r.start&&e<=r.end){let o=1,l=!1;return r.easeInDuration>0&&(o*=Math.min((e-r.start)/r.easeInDuration,1)),r.easeOutDuration>0&&!l&&(o*=Math.min((r.end-e)/r.easeOutDuration,1)),o}return 0}}class fne{constructor(e){x(this,"clip");x(this,"rootPositionOffset");x(this,"rootQuaternionOffset");x(this,"rootStartPosition");x(this,"rootEndPosition");x(this,"rootStartQuaternion");x(this,"rootEndQuaternion");const t=e.getClip();this.clip=t;const n=e.getRoot(),i=n.name+".position",r=n.name+".quaternion";Rf&&console.log(t.name,t.tracks,i);for(const o of t.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(i))this.rootStartPosition=new q().fromArray(o.values,0),this.rootEndPosition=new q().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Rf&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new kt().fromArray(o.values,0),this.rootEndQuaternion=new kt().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Rf)){const l=new _s().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",l)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class $M extends hx{constructor(){super(...arguments);x(this,"models",[]);x(this,"trackOffset");x(this,"target");x(this,"mixer");x(this,"clips",[]);x(this,"actions",[]);x(this,"_actionOffsets",[]);x(this,"_didBind",!1);x(this,"_useclipOffsets",!0);x(this,"_totalOffsetPosition",new q);x(this,"_totalOffsetRotation",new kt);x(this,"_totalOffsetPosition2",new q);x(this,"_totalOffsetRotation2",new kt);x(this,"_summedPos",new q);x(this,"_tempPos",new q);x(this,"_summedRot",new kt);x(this,"_tempRot",new kt)}createHooks(t,n){var f,g;if(((f=n.tracks)==null?void 0:f.length)<=0){console.warn("No tracks in AnimationClip",n);return}const i=n.tracks[0].name.split("."),r=i[i.length-2],o=r+".position",l=r+".quaternion";let h=!1,u=!1;for(const m of n.tracks)m.name.endsWith(o)?(h=!0,this.createPositionInterpolant(n,t,m)):m.name.endsWith(l)&&(u=!0,this.createRotationInterpolant(n,t,m));if(!h||!u){const m=(g=this.mixer)==null?void 0:g.getRoot(),A=n.tracks[0],v=A.name.lastIndexOf("."),b=A.name.substring(0,v),C=b.substring(b.lastIndexOf(".")+1),S=m.getObjectByName(C);if(S)if(h){if(!u){const I=n.tracks[0].name.substring(0,v)+".quaternion";Rf&&console.warn("Create quaternion track",C,S);const M=S.quaternion,R=new tc(I,[0,n.duration],[M.x,M.y,M.z,M.w,M.x,M.y,M.z,M.w]);n.tracks.push(R),this.createRotationInterpolant(n,t,R)}}else{const I=b+".position";Rf&&console.warn("Create position track",C,S);const M=S.position,R=new sh(I,[0,n.duration],[M.x,M.y,M.z,M.x,M.y,M.z]);n.tracks.push(R),this.createPositionInterpolant(n,t,R)}}}bind(){if(!this._didBind){this._didBind=!0,Rf&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const n=new fne(t);this._actionOffsets.push(n)}for(const t of this.models){const n=t.asset,i=n.position,r=n.rotation;i.x!==void 0&&(i.isVector3||(n.position=new q(i.x,i.y,i.z)),r.isQuaternion||(n.rotation=new kt(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new q(t.x,t.y,t.z)));const n=this.trackOffset.rotation;n&&(n.isQuaternion||(this.trackOffset.rotation=new kt(n.x,n.y,n.z,n.w)))}}evaluate(t){if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let n=0,i=0,r=!1;for(let o=0;o<this.clips.length;o++){const l=this.models[o],h=this.actions[o],u=l.asset;h.weight=0;const f=t>=l.start&&t<=l.end,g=l.postExtrapolationMode;let m=f;if(!m&&!r&&l.end<t&&l.postExtrapolationMode!==l_.None){const A=o<this.clips.length-1?this.models[o+1]:null;(!A||A.start>t)&&(m=!0,r=!0)}if(m){let A=1;A*=this.evaluateWeight(t,o,this.models,m);let v=this.getClipTime(t,l),b=0;const C=u.duration;if(f){if(u.loop)for(b+=Math.floor(v/(C+1e-6));v>C;)v-=C}else if(!f)switch(g){case l_.Loop:v%=C;break;case l_.PingPong:const M=Math.floor(v/C)%2!==0;v%=C,M&&(v=C-v);break}h.time=v,h.timeScale=0;const S=A*this.director.weight;if(h.weight=S,h.clampWhenFinished=!0,h.isRunning()||h.play(),this._useclipOffsets){const I=n==0?this._totalOffsetPosition:this._totalOffsetPosition2,M=n==0?this._totalOffsetRotation:this._totalOffsetRotation2;n<1&&(i=1-A),n+=1;const R=this._summedPos.set(0,0,0),T=this._tempPos.set(0,0,0),B=this._summedRot.identity(),F=this._tempRot.identity(),D=u.rotation,U=new kt;U.slerp(D,A);const W=this._actionOffsets[o];if(W.hasOffsets)for(let J=0;J<b;J++)W.rootPositionOffset?T.copy(W.rootPositionOffset):T.set(0,0,0),T.applyQuaternion(B).applyQuaternion(U),W.rootQuaternionOffset&&(F.copy(W.rootQuaternionOffset),B.multiply(F)),R.add(T);M.multiply(U),M.multiply(B),R.add(u.position),I.add(R)}}}this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,i),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,i)),this.mixer.update(t)}createRotationInterpolant(t,n,i){var h;const r=i.createInterpolant.bind(i),o=new kt;this.ensureTrackOffsets();const l=(h=this.trackOffset)==null?void 0:h.rotation;i.createInterpolant=()=>{const u=r(),f=u.evaluate.bind(u);return u.evaluate=g=>{const m=f(g);return o.set(m[0],m[1],m[2],m[3]),o.premultiply(this._totalOffsetRotation),l&&o.premultiply(l),m[0]=o.x,m[1]=o.y,m[2]=o.z,m[3]=o.w,m},u}}createPositionInterpolant(t,n,i){var f,g;const r=i.createInterpolant.bind(i),o=new q;this.ensureTrackOffsets();const l=(f=this.trackOffset)==null?void 0:f.rotation,h=(g=this.trackOffset)==null?void 0:g.position;let u;i.createInterpolant=()=>{const m=r(),A=m.evaluate.bind(m);return m.evaluate=v=>{var C,S;const b=A(v);return o.set(b[0],b[1],b[2]),n.removeStartOffset&&(u===void 0?(u=null,u=(S=(C=this._actionOffsets.find(I=>I.clip===t))==null?void 0:C.rootStartPosition)==null?void 0:S.clone()):u!=null&&u.isVector3&&o.sub(u)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),l&&o.applyQuaternion(l),h&&(o.x-=h.x,o.y+=h.y,o.z+=h.z),b[0]=o.x,b[1]=o.y,b[2]=o.z,b},m}}}class e1 extends hx{constructor(){super(...arguments);x(this,"models",[]);x(this,"listener");x(this,"audio",[]);x(this,"audioContextTimeOffset",[]);x(this,"lastTime",0)}getAudioFilePath(t){const n=this.director.sourceId;return Kg(n,t)}onAllowAudioChanged(t){for(let n=0;n<this.models.length;n++){const i=this.models[n];this.audio[n].setVolume(t?i.asset.volume:0)}}addModel(t){const n=this.getAudioFilePath(t.asset.clip),i=new Mv(this.listener);i.setVolume(t.asset.volume);const r=new I_;console.log(n,this.director.sourceId),r.load(n,o=>{i.setBuffer(o),i.loop=t.asset.loop,this.audio.push(i),this.models.push(t)})}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop()}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const n=this.audio[t];n!=null&&n.isPlaying&&n.stop()}}evaluate(t){if(!this.track.muted){for(let n=0;n<this.models.length;n++){const i=this.models[n],r=this.audio[n];if(t>=i.start&&t<=i.end){if(this.director.isPaused&&(r.isPlaying&&r.stop(),this.lastTime===t))continue;r.isPlaying||(r.offset=i.clipIn+(t-i.start)*i.timeScale,r.play());let o=i.asset.volume;i.easeInDuration>0&&(o*=Math.min((t-i.start)/i.easeInDuration,1)),i.easeOutDuration>0&&(o*=Math.min((i.end-t)/i.easeOutDuration,1)),r.setVolume(o*this.director.weight)}else r.isPlaying&&r.stop()}this.lastTime=t}}}class $_ extends hx{constructor(){super(...arguments);x(this,"models",[]);x(this,"didTrigger",[]);x(this,"receivers",[])}evaluate(t){if(!(this.receivers.length<=0)&&!this.track.muted)for(let n=0;n<this.models.length;n++){const i=this.models[n],r=this.didTrigger[n],o=i.time-t;if(i.retroActive?o<0:o<0&&Math.abs(o)<.1){if(!r){this.didTrigger[n]=!0;for(const h of this.receivers)!h||h.invoke(i.asset)}}else i.emitOnce||(this.didTrigger[n]=!1)}}}const sg=class extends hx{constructor(){super(...arguments);x(this,"models",[]);x(this,"timelines",[]);x(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let n=this.models.length-1;n>=0;n--){const r=this.models[n].asset;if(typeof r.sourceObject=="string"){const o=r.sourceObject;sg.resolved[o]?r.sourceObject=sg.resolved[o]:(r.sourceObject=Ee.findByGuid(o,t.scene),sg.resolved[o]=r.sourceObject)}if(r.sourceObject){const o=Ee.getComponent(r.sourceObject,Bf);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}else{this.models.splice(n,1);continue}}}evaluate(t){var n;this._previousActiveModel=null;for(let i=0;i<this.models.length;i++){const r=this.models[i],o=r.asset;if(t>=r.start&&t<=r.end){this._previousActiveModel=r;const l=this.getClipTime(t,r);if(o.controlActivation){const h=o.sourceObject;h.visible=!0}if(o.updateDirector){const h=this.timelines[i];h&&(h.isPlaying&&h.pause(),h.time=l,h.evaluate())}}else{const l=(n=this._previousActiveModel)==null?void 0:n.asset;if(o.controlActivation){const h=o.sourceObject;(l==null?void 0:l.sourceObject)!==h&&(h.visible=!1)}}}}};let Pf=sg;x(Pf,"resolved",{});const AL=Ct("debugtimeline"),ov=class extends pt{constructor(){super(...arguments);x(this,"playableAsset");x(this,"playOnAwake");x(this,"extrapolationMode",1);x(this,"_visibilityChangeEvt");x(this,"_clonedPlayableAsset",!1);x(this,"_guidsMap");x(this,"_isPlaying",!1);x(this,"_internalUpdateRoutine");x(this,"_isPaused",!1);x(this,"_time",0);x(this,"_duration",0);x(this,"_weight",1);x(this,"_animationTracks",[]);x(this,"_audioTracks",[]);x(this,"_signalTracks",[]);x(this,"_controlTracks",[]);x(this,"_customTracks",[]);x(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks])}static registerCreateTrack(t,n){this.createTrackFunctions[t]=n}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(t){this._time=t}get duration(){return this._duration}set duration(t){this._duration=t}get weight(){return this._weight}set weight(t){this._weight=t}awake(){var t,n,i;AL&&console.log(this,(t=this.playableAsset)==null?void 0:t.tracks),this.rebuildGraph(),this.playOnAwake?this.play():this.evaluate(),this.isValid()||console.warn("PlayableDirector is not valid",this.playableAsset,(n=this.playableAsset)==null?void 0:n.tracks,Array.isArray((i=this.playableAsset)==null?void 0:i.tracks),this)}onEnable(){var t,n;for(const i of this._audioTracks)(t=i.onEnable)==null||t.call(i);for(const i of this._customTracks)(n=i.onEnable)==null||n.call(i);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var t,n;this.stop();for(const i of this._audioTracks)(t=i.onDisable)==null||t.call(i);for(const i of this._customTracks)(n=i.onDisable)==null||n.call(i);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var t;for(const n of this._audioTracks)(t=n.onDestroy)==null||t.call(n)}rebuildGraph(){!this.isValid()||(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}play(){!this.isValid()||(this._isPaused=!1,!this._isPlaying&&(this._isPlaying=!0,this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate())))}pause(){this._isPaused=!0}stop(){this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.evaluate()),this._isPlaying=!1,this._isPaused=!1,this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null}evaluate(){if(!this.isValid())return;let t=this._time;switch(this.extrapolationMode){case 0:t=Math.min(t,this._duration);break;case 1:t%=this._duration;break;case 2:if(t>this._duration){this.stop();return}break}this.internalEvaluate(t)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const t of this._allTracks)for(const n of t)yield n}get audioTracks(){return this._audioTracks}resolveGuids(t){this._guidsMap=t}*internalUpdate(){for(;this._isPlaying;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime,this.evaluate()),yield}internalEvaluate(t){for(const n of this.playableAsset.tracks)if(!n.muted)switch(n.type){case Oa.Activation:for(let i=0;i<n.outputs.length;i++){const r=n.outputs[i];if(typeof r=="object"){let o=!1;for(const h of n.clips)h.start<=t&&t<=h.end&&(o=!0);const l=r;l.visible!==void 0&&(l.visible=o)}}break}for(const n of this._animationTracks)n.evaluate(t);for(const n of this._audioTracks)n.evaluate(t);for(const n of this._signalTracks)n.evaluate(t);for(const n of this._controlTracks)n.evaluate(t);for(const n of this._customTracks)n.evaluate(t)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=qS(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const t=this.findRoot(this.gameObject);for(const n of this.playableAsset.tracks)for(let i=n.outputs.length-1;i>=0;i--){let r=n.outputs[i];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=Ee.findByGuid(r,t);o===null||typeof o!="object"?(n.outputs.splice(i,1),console.warn("Failed to resolve binding",r,n.name,n.type)):(AL&&console.log("Resolved binding",r,"to",o),n.outputs[i]=o)}else if(r===null){if(n.outputs.splice(i,1),ov.createTrackFunctions[n.type])continue;n.type!==Oa.Audio&&n.type!==Oa.Control&&n.type!==Oa.Marker&&console.warn("Missing binding",r,n.name,n.type,this.name,this.playableAsset.name)}}}findRoot(t){return t.parent?this.findRoot(t.parent):t}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const t of this.playableAsset.tracks)if(t.muted!==!0)for(const n of t.clips)n.end>this._duration&&(this._duration=n.end)}}setupAndCreateTrackHandlers(){var n,i;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;const t=[];for(const r of this.playableAsset.tracks){const o=r.type,l=ov.createTrackFunctions[o];if(l!=null){const h=l(this,r);if(typeof h.evaluate=="function"){h.director=this,h.track=r,this._customTracks.push(h);continue}}if(r.type===Oa.Animation){if(r.clips.length<=0)continue;for(let h=r.outputs.length-1;h>=0;h--){const u=r.outputs[h];typeof u.enabled=="boolean"&&(u.enabled=!1);const f=(n=u==null?void 0:u.gameObject)==null?void 0:n.animations;if(f){const g=new $M;g.trackOffset=r.trackOffset,g.director=this,g.track=r;for(let m=0;m<r.clips.length;m++){const A=r.clips[m],v=A.asset;if(!v){console.error("MISSING anim model?","clip#"+m,A,r,this.playableAsset,this.name);continue}const b=v.clip;let C=b;if((typeof C=="string"||typeof C=="number")&&(C=f.find(I=>I.name===b)),!C){console.warn("Could not find animationClip for model",A,r.name,this.name,(i=this.playableAsset)==null?void 0:i.name);continue}g.mixer||(g.mixer=new Tv(u.gameObject)),g.clips.push(C),g.mixer.uncacheAction(C),g.createHooks(A.asset,C);const S=g.mixer.clipAction(C);g.actions.push(S),g.models.push(A)}this._animationTracks.push(g)}}}else if(r.type===Oa.Audio){if(r.clips.length<=0)continue;t.push(r)}else if(r.type===Oa.Marker){const h=new $_;h.director=this,h.track=r;for(const u of r.markers)switch(u.type){case P3.Signal:h.models.push(u),h.didTrigger.push(!1);break}if(h!==null&&h.models.length>0){const u=Ee.getComponent(this.gameObject,lx);u&&(h.receivers.push(u),this._signalTracks.push(h))}}else if(r.type===Oa.Signal){const h=new $_;h.director=this,h.track=r;for(const u of r.markers)h.models.push(u),h.didTrigger.push(!1);for(const u of r.outputs)h.receivers.push(u);this._signalTracks.push(h)}else if(r.type===Oa.Control){const h=new Pf;h.director=this,h.track=r;for(const u of r.clips)h.models.push(u);h.resolveSourceObjects(this.context),this._controlTracks.push(h)}}Br.registerWaitForAllowAudio(()=>{const r=Ee.findObjectOfType(yg,this.context);if(!!r)for(const o of t){const l=new e1;l.director=this,l.track=o,l.listener=r.listener;for(let h=0;h<o.clips.length;h++){const u=o.clips[h];l.addModel(u)}this._audioTracks.push(l)}})}setAudioTracksAllowPlaying(t){for(const n of this._audioTracks)n.onAllowAudioChanged(t)}};let Bf=ov;x(Bf,"createTrackFunctions",{});var rr={};rr.d=(a,e)=>{for(var t in e)rr.o(e,t)&&!rr.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:e[t]})};rr.o=(a,e)=>Object.prototype.hasOwnProperty.call(a,e);rr.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var Ao={};rr.d(Ao,{g1:()=>dx,gO:()=>Jm,km:()=>ux,zV:()=>Eg,ol:()=>g1,uM:()=>fx,N1:()=>ek,xv:()=>m1,PH:()=>mx,UH:()=>px,ZP:()=>Hne,Vx:()=>tk});var ux={};rr.r(ux);rr.d(ux,{COLUMN:()=>gx,COLUMN_REVERSE:()=>L3,ROW:()=>Ym,ROW_REVERSE:()=>B3,contentDirection:()=>D3});var dx={};rr.r(dx);rr.d(dx,{CENTER:()=>n1,END:()=>i1,START:()=>t1,STRETCH:()=>O3,alignItems:()=>F3,warnAboutDeprecatedAlignItems:()=>k3});var fx={};rr.r(fx);rr.d(fx,{CENTER:()=>r1,END:()=>o1,SPACE_AROUND:()=>a1,SPACE_BETWEEN:()=>c1,SPACE_EVENLY:()=>l1,START:()=>s1,justifyContent:()=>N3});var px={};rr.r(px);rr.d(px,{NORMAL:()=>Ax,NOWRAP:()=>gA,PRE:()=>yx,PRE_LINE:()=>Ap,PRE_WRAP:()=>_x,WHITE_CHARS:()=>UE,collapseWhitespaceOnInlines:()=>H3,collapseWhitespaceOnString:()=>U3,newlineBreakability:()=>z3,shouldBreak:()=>G3});var mx={};rr.r(mx);rr.d(mx,{CENTER:()=>u1,JUSTIFY:()=>d1,JUSTIFY_CENTER:()=>q3,JUSTIFY_LEFT:()=>j3,JUSTIFY_RIGHT:()=>ev,LEFT:()=>W3,RIGHT:()=>Q3,textAlign:()=>X3});var pne=a=>{var e={};return rr.d(e,a),e};const hi=pne({BufferAttribute:()=>Jn,BufferGeometry:()=>Sn,CanvasTexture:()=>bS,Color:()=>ye,FileLoader:()=>ks,LinearFilter:()=>vi,Mesh:()=>_t,Object3D:()=>Ft,Plane:()=>Oo,PlaneBufferGeometry:()=>TD,PlaneGeometry:()=>Yr,ShaderMaterial:()=>js,TextureLoader:()=>Xg,Vector2:()=>Xe,Vector3:()=>q}),Ym="row",B3="row-reverse",gx="column",L3="column-reverse";function D3(a,e,t,n){let i=t,r="getWidth",o="x",l="y";e.indexOf(gx)===0&&(r="getHeight",o="y",l="x");for(let h=0;h<a.childrenBoxes.length;h++){const u=a.childrenBoxes[h],f=u.id,g=u[r](),m=u.margin||0;i+=m*n,a.childrenPos[f]={[o]:i+g/2*n,[l]:0},i+=n*(g+m)}}const t1="start",n1="center",i1="end",O3="stretch";function F3(a,e){const t=a.getAlignItems();mne.indexOf(t)===-1&&console.warn(`alignItems === '${t}' is not supported`);let n="getWidth",i="x";e.indexOf(Ym)===0&&(n="getHeight",i="y");const r=a[n]()/2-(a.padding||0);a.childrenBoxes.forEach(o=>{let l;switch(t){case i1:case"right":case"bottom":e.indexOf(Ym)===0?l=-r+o[n]()/2+(o.margin||0):l=r-o[n]()/2-(o.margin||0);break;case t1:case"left":case"top":e.indexOf(Ym)===0?l=r-o[n]()/2-(o.margin||0):l=-r+o[n]()/2+(o.margin||0);break}a.childrenPos[o.id][i]=l||0})}function k3(a){gne.indexOf(a)!==-1&&console.warn(`alignItems === '${a}' is deprecated and will be remove in 7.x.x. Fallback are 'start'|'end'`)}const mne=[t1,n1,i1,O3,"top","right","bottom","left"],gne=["top","right","bottom","left"],s1="start",r1="center",o1="end",a1="space-around",c1="space-between",l1="space-evenly";function N3(a,e,t,n){const i=a.getJustifyContent();Ane.indexOf(i)===-1&&console.warn(`justifyContent === '${i}' is not supported`);const r=e.indexOf("row")===0?"width":"height",o=a.getChildrenSideSum(r),h=(r==="width"?a.getInnerWidth():a.getInnerHeight())-o,u=t*2-o*Math.sign(t),f=yne(i,u),g=_ne(a.childrenBoxes,h,i,n),m=e.indexOf("row")===0?"x":"y";a.childrenBoxes.forEach((A,v)=>{a.childrenPos[A.id][m]-=f-g[v]})}const Ane=[s1,r1,o1,a1,c1,l1];function yne(a,e){switch(a){case o1:return e;case r1:return e/2}return 0}function _ne(a,e,t,n){const i=Array(a.length).fill(0);if(e>0)switch(t){case c1:if(a.length>1){const r=e/(a.length-1)*n;i[0]=0;for(let o=1;o<a.length;o++)i[o]=r*o}break;case l1:if(a.length>1){const r=e/(a.length+1)*n;for(let o=0;o<a.length;o++)i[o]=r*(o+1)}break;case a1:if(a.length>1){const r=e/a.length*n,o=r/2;i[0]=o;for(let l=1;l<a.length;l++)i[l]=o+r*l}break}return i}function h1(a){return class extends a{constructor(t){super(t),this.isBoxComponent=!0,this.childrenPos={}}getInnerWidth(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.width-(this.padding*2||0)||this.getChildrenSideSum("width");case"column":case"column-reverse":return this.getHighestChildSizeOn("width");default:console.error(`Invalid contentDirection : ${t}`);break}}getInnerHeight(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.getHighestChildSizeOn("height");case"column":case"column-reverse":return this.height-(this.padding*2||0)||this.getChildrenSideSum("height");default:console.error(`Invalid contentDirection : ${t}`);break}}getChildrenSideSum(t){return this.childrenBoxes.reduce((n,i)=>{const r=i.margin*2||0,o=t==="width"?i.getWidth()+r:i.getHeight()+r;return n+o},0)}setPosFromParentRecords(){this.parentUI&&this.parentUI.childrenPos[this.id]&&(this.position.x=this.parentUI.childrenPos[this.id].x,this.position.y=this.parentUI.childrenPos[this.id].y)}computeChildrenPosition(){if(this.children.length>0){const t=this.getContentDirection();let n;switch(t){case Ym:n=-this.getInnerWidth()/2;break;case B3:n=this.getInnerWidth()/2;break;case gx:n=this.getInnerHeight()/2;break;case L3:n=-this.getInnerHeight()/2;break}const i=-Math.sign(n);D3(this,t,n,i),N3(this,t,n,i),F3(this,t)}}getHighestChildSizeOn(t){return this.childrenBoxes.reduce((n,i)=>{const r=i.margin||0,o=t==="width"?i.getWidth()+r*2:i.getHeight()+r*2;return Math.max(n,o)},0)}getWidth(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("column")!==-1?this.parentUI.getWidth()-(this.parentUI.padding*2||0):this.width||this.getInnerWidth()+(this.padding*2||0)}getHeight(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("row")!==-1?this.parentUI.getHeight()-(this.parentUI.padding*2||0):this.height||this.getInnerHeight()+(this.padding*2||0)}}}const UE={"	":"	","\n":`
`,"\r":"\r"," ":" "},Ax="normal",gA="nowrap",yx="pre",Ap="pre-line",_x="pre-wrap",U3=function(a,e){switch(e){case gA:case Ax:a=a.replace(/\n/g," ");case Ap:a=a.replace(/[ ]{2,}/g," ");break}return a},z3=function(a){switch(a){case yx:case _x:case Ap:return"mandatory"}},G3=function(a,e,t,n){const i=a[e];switch(n.WHITESPACE){case Ax:case Ap:case _x:if(i.lineBreak==="mandatory")return!0;const r=i.kerning?i.kerning:0,o=i.xoffset?i.xoffset:0,l=i.xadvance?i.xadvance:i.width;if(t+l+o+r>n.INNER_WIDTH)return!0;const h=V3(a,e,n);return vne(a[e-1],t,h,n);case yx:return i.lineBreak==="mandatory";case gA:default:return!1}},H3=function(a,e){const t=a[0],n=a[a.length-1];switch(e){case _x:t.glyph&&t.glyph===`
`&&a.length>1&&_L([t],a[1]),n.glyph&&n.glyph===`
`&&a.length>1&&yL([n],a[a.length-2]);break;case Ap:case gA:case Ax:let i=[],r;for(let o=0;o<a.length;o++){const l=a[o];if(l.glyph&&UE[l.glyph]&&a.length>o){i.push(l),r=a[o+1];continue}break}_L(i,r),i=[],r=null;for(let o=a.length-1;o>0;o--){const l=a[o];if(l.glyph&&UE[l.glyph]&&o>0){i.push(l),r=a[o-1];continue}break}yL(i,r);break;case yx:break;default:return console.warn(`whiteSpace: '${e}' is not valid`),0}return t.offsetX};function yL(a,e){if(!!e)for(let t=0;t<a.length;t++){const n=a[t];n.width=0,n.height=0,n.offsetX=e.offsetX+e.width}}function _L(a,e){if(!!e)for(let t=0;t<a.length;t++){const n=a[t];n.width=0,n.height=0,n.offsetX=e.offsetX}}function V3(a,e,t,n){if(n=n||0,!a[e])return n;const i=a[e],r=i.kerning?i.kerning:0,o=i.xoffset?i.xoffset:0,l=i.xadvance?i.xadvance:i.width;return i.lineBreak?n+l:V3(a,e+1,t,n+l+t.LETTERSPACING+o+r)}function vne(a,e,t,n){return!a||!a.glyph||e+t<n.INNER_WIDTH?!1:n.BREAKON.indexOf(a.glyph)>-1}const W3="left",Q3="right",u1="center",d1="justify",j3="justify-left",ev="justify-right",q3="justify-center";function X3(a,e,t){for(let n=0;n<a.length;n++){const i=a[n],r=xne(i,e,t,n===a.length-1);for(let o=0;o<i.length;o++)i[o].offsetX+=r}if(e.indexOf(d1)===0)for(let n=0;n<a.length;n++){const i=a[n];if(e.indexOf("-")!==-1&&n===a.length-1)return;const r=t-i.width;if(r<=0)return;let o=0;for(let f=1;f<i.length-1;f++)o+=i[f].glyph===" "?1:0;const l=r/o;let h=1;e===ev&&(i.reverse(),h=-1);let u=0;for(let f=1;f<=i.length-1;f++){const g=i[f];g.offsetX+=u*h,u+=g.glyph===" "?l:0}e===ev&&i.reverse()}}const xne=(a,e,t,n)=>{switch(e){case j3:case d1:case W3:return-t/2;case ev:case Q3:return-a.width+t/2;case u1:return-a.width/2;case q3:return n?-a.width/2:-t/2;default:console.warn(`textAlign: '${e}' is not valid`)}};function Y3(a){return class extends a{computeInlinesPosition(){const t=this.getWidth()-(this.padding*2||0),n=this.getHeight()-(this.padding*2||0),i=this.getJustifyContent(),r=this.getTextAlign(),o=this.getInterLine(),l=this.computeLines();let h=l.reduce((f,g,m,A)=>{const v=g.lineHeight-g.lineBase;return g.forEach(b=>{b.offsetY=f-g.lineHeight+v+A[0].lineHeight}),f-g.lineHeight-o},0)+o;h=Math.abs(h);const u=(()=>{switch(i){case"start":return n/2-l[0].lineHeight;case"end":return h-l[0].lineHeight-n/2+(l[l.length-1].lineHeight-l[l.length-1].lineHeight);case"center":return h/2-l[0].lineHeight;default:console.warn(`justifyContent: '${i}' is not valid`)}})();l.forEach(f=>{f.forEach(g=>{g.offsetY+=u})}),X3(l,r,t),this.lines=l}calculateBestFit(t){if(this.childrenInlines.length!==0)switch(t){case"grow":this.calculateGrowFit();break;case"shrink":this.calculateShrinkFit();break;case"auto":this.calculateAutoFit();break}}calculateGrowFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,r=this.childrenInlines.find(f=>f.isText);let o=1,l=2,h=r._fitFontSize?r._fitFontSize/r.getFontSize():1,u;do if(u=this.calculateHeight(h),u>t){if(h<=o){this.childrenInlines.forEach(f=>{f.isInlineBlock||(f._fitFontSize=f.getFontSize())});break}l=h,h-=(l-o)/2}else{if(Math.abs(t-u)<i)break;Math.abs(h-l)<5e-10&&(l*=2),o=h,h+=(l-o)/2}while(++n<=10)}calculateShrinkFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,r=this.childrenInlines.find(f=>f.isText);let o=0,l=1,h=r._fitFontSize?r._fitFontSize/r.getFontSize():1,u;do if(u=this.calculateHeight(h),u>t)l=h,h-=(l-o)/2;else{if(h>=l){this.childrenInlines.forEach(f=>{f.isInlineBlock||(f._fitFontSize=f.getFontSize())});break}if(Math.abs(t-u)<i)break;o=h,h+=(l-o)/2}while(++n<=10)}calculateAutoFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,r=this.childrenInlines.find(f=>f.isText);let o=0,l=2,h=r._fitFontSize?r._fitFontSize/r.getFontSize():1,u;do if(u=this.calculateHeight(h),u>t)l=h,h-=(l-o)/2;else{if(Math.abs(t-u)<i)break;Math.abs(h-l)<5e-10&&(l*=2),o=h,h+=(l-o)/2}while(++n<=10)}computeLines(){const t=this.getWidth()-(this.padding*2||0),n=[[]];return this.childrenInlines.reduce((i,r)=>{if(!r.inlines)return;const o=r._fitFontSize||r.getFontSize(),l=r.isText?r.getLetterSpacing()*o:0,h=r.getWhiteSpace(),u=r.getBreakOn(),f={WHITESPACE:h,LETTERSPACING:l,BREAKON:u,INNER_WIDTH:t};return r.inlines.reduce((m,A,v,b)=>{const C=A.kerning?A.kerning:0,S=A.xoffset?A.xoffset:0,I=A.xadvance?A.xadvance:A.width;return G3(b,v,m,f)?(n.push([A]),A.offsetX=S,A.width===0?0:I+l):(n[n.length-1].push(A),A.offsetX=m+S+C,m+I+C+l)},i)},0),n.forEach(i=>{if(i.lineHeight=i.reduce((o,l)=>{const h=l.lineHeight!==void 0?l.lineHeight:l.height;return Math.max(o,h)},0),i.lineBase=i.reduce((o,l)=>{const h=l.lineBase!==void 0?l.lineBase:l.height;return Math.max(o,h)},0),i.width=0,i[0]){const o=this.getWhiteSpace(),l=H3(i,o);i.forEach(h=>{h.offsetX-=l}),i.width=this.computeLineWidth(i)}}),n}calculateHeight(t){this.childrenInlines.forEach(o=>{o.isInlineBlock||(o._fitFontSize=o.getFontSize()*t,o.calculateInlines(o._fitFontSize))});const n=this.computeLines(),i=this.getInterLine(),r=n.reduce((o,l)=>o-l.lineHeight-i,0)+i;return Math.abs(r)}computeLineWidth(t){const n=t[0],i=t[t.length-1];return i.offsetX+i.width+n.offsetX}}}const wne=new hi.FileLoader,zE=[],h_={},bne=new hi.TextureLoader,GE=[],u_={},gr={};function Cne(a,e){typeof e=="string"?Sne(a,e):(gr[a.id]||(gr[a.id]={component:a}),f1(e),gr[a.id].json=e,a._updateFontFamily(e))}function Ene(a,e){GE.indexOf(e)===-1&&(GE.push(e),bne.load(e,t=>{t.generateMipmaps=!1,t.minFilter=hi.LinearFilter,t.magFilter=hi.LinearFilter,u_[e]=t;for(const n of Object.keys(gr))e===gr[n].textureURL&&gr[n].component._updateFontTexture(t)})),gr[a.id]||(gr[a.id]={component:a}),gr[a.id].textureURL=e,u_[e]&&a._updateFontTexture(u_[e])}function J3(a){const e=gr[a.id];return!e&&a.parentUI?J3(a.parentUI):e}function Sne(a,e){zE.indexOf(e)===-1&&(zE.push(e),wne.load(e,t=>{const n=JSON.parse(t);f1(n),h_[e]=n;for(const i of Object.keys(gr))e===gr[i].jsonURL&&gr[i].component._updateFontFamily(n)})),gr[a.id]||(gr[a.id]={component:a}),gr[a.id].jsonURL=e,h_[e]&&a._updateFontFamily(h_[e])}function f1(a){if(a._kernings)return;const e={};for(let t=0;t<a.kernings.length;t++){const n=a.kernings[t];if(n.amount===0)continue;const i=String.fromCharCode(n.first,n.second);e[i]=n.amount}a._kernings=e}function Mne(a,e,t){t.generateMipmaps=!1,t.minFilter=hi.LinearFilter,t.magFilter=hi.LinearFilter,zE.push(a),h_[a]=e,f1(e),t&&(GE.push(a),u_[a]=t)}const Tne={setFontFamily:Cne,setFontTexture:Ene,getFontOf:J3,addFont:Mne},Eg=Tne;class Ou{static requestUpdate(e,t,n,i){e.traverse(r=>{!r.isUI||(this.requestedUpdates[r.id]?(t&&(this.requestedUpdates[r.id].updateParsing=!0),n&&(this.requestedUpdates[r.id].updateLayout=!0),i&&(this.requestedUpdates[r.id].updateInner=!0)):this.requestedUpdates[r.id]={updateParsing:t,updateLayout:n,updateInner:i,needCallback:t||n||i})})}static register(e){this.components.includes(e)||this.components.push(e)}static disposeOf(e){const t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)}static update(){if(Object.keys(this.requestedUpdates).length>0){const e=this.components.filter(t=>!t.parentUI);e.forEach(t=>this.traverseParsing(t)),e.forEach(t=>this.traverseUpdates(t))}}static traverseParsing(e){const t=this.requestedUpdates[e.id];t&&t.updateParsing&&(e.parseParams(),t.updateParsing=!1),e.childrenUIs.forEach(n=>this.traverseParsing(n))}static traverseUpdates(e){const t=this.requestedUpdates[e.id];delete this.requestedUpdates[e.id],t&&t.updateLayout&&(t.updateLayout=!1,e.updateLayout()),t&&t.updateInner&&(t.updateInner=!1,e.updateInner()),e.childrenUIs.forEach(n=>{this.traverseUpdates(n)}),t&&t.needCallback&&e.onAfterUpdate()}}Ou.components=[];Ou.requestedUpdates={};const dr={container:null,fontFamily:null,fontSize:.05,fontKerning:"normal",bestFit:"none",offset:.01,interLine:.01,breakOn:`- ,.:?!
`,whiteSpace:Ap,contentDirection:gx,alignItems:n1,justifyContent:s1,fontTexture:null,textAlign:u1,textType:"MSDF",fontColor:new hi.Color(16777215),fontOpacity:1,fontPXRange:4,fontSupersampling:!0,borderRadius:.01,borderWidth:0,borderColor:new hi.Color("black"),borderOpacity:1,backgroundSize:"cover",backgroundColor:new hi.Color(2236962),backgroundWhiteColor:new hi.Color(16777215),backgroundOpacity:.8,backgroundOpaqueOpacity:1,backgroundTexture:Ine,hiddenOverflow:!1,letterSpacing:0};let zy;function Ine(){if(!zy){const a=document.createElement("canvas").getContext("2d");a.canvas.width=1,a.canvas.height=1,a.fillStyle="#ffffff",a.fillRect(0,0,1,1),zy=new hi.CanvasTexture(a.canvas),zy.isDefault=!0}return zy}function vx(a){return class extends a{constructor(n){super(n);x(this,"_rebuildParentUI",()=>{this.parent&&this.parent.isUI?this.parentUI=this.parent:this.parentUI=null});this.states={},this.currentState=void 0,this.isUI=!0,this.autoLayout=!0,this.childrenUIs=[],this.childrenBoxes=[],this.childrenTexts=[],this.childrenInlines=[],this.parentUI=null,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI)}getClippingPlanes(){const n=[];if(this.parentUI){if(this.isBlock&&this.parentUI.getHiddenOverflow()){const i=this.parentUI.getHeight()/2-(this.parentUI.padding||0),r=this.parentUI.getWidth()/2-(this.parentUI.padding||0),o=[new hi.Plane(new hi.Vector3(0,1,0),i),new hi.Plane(new hi.Vector3(0,-1,0),i),new hi.Plane(new hi.Vector3(1,0,0),r),new hi.Plane(new hi.Vector3(-1,0,0),r)];o.forEach(l=>{l.applyMatrix4(this.parent.matrixWorld)}),n.push(...o)}this.parentUI.parentUI&&n.push(...this.parentUI.getClippingPlanes())}return n}getHighestParent(){return this.parentUI?this.parent.getHighestParent():this}_getProperty(n){return this[n]===void 0&&this.parentUI?this.parent._getProperty(n):this[n]!==void 0?this[n]:dr[n]}getFontSize(){return this._getProperty("fontSize")}getFontKerning(){return this._getProperty("fontKerning")}getLetterSpacing(){return this._getProperty("letterSpacing")}getFontTexture(){return this._getProperty("fontTexture")}getFontFamily(){return this._getProperty("fontFamily")}getBreakOn(){return this._getProperty("breakOn")}getWhiteSpace(){return this._getProperty("whiteSpace")}getTextAlign(){return this._getProperty("textAlign")}getTextType(){return this._getProperty("textType")}getFontColor(){return this._getProperty("fontColor")}getFontSupersampling(){return this._getProperty("fontSupersampling")}getFontOpacity(){return this._getProperty("fontOpacity")}getFontPXRange(){return this._getProperty("fontPXRange")}getBorderRadius(){return this._getProperty("borderRadius")}getBorderWidth(){return this._getProperty("borderWidth")}getBorderColor(){return this._getProperty("borderColor")}getBorderOpacity(){return this._getProperty("borderOpacity")}getContainer(){return!this.threeOBJ&&this.parent?this.parent.getContainer():this.threeOBJ?this:dr.container}getParentsNumber(n){return n=n||0,this.parentUI?this.parentUI.getParentsNumber(n+1):n}getBackgroundOpacity(){return!this.backgroundOpacity&&this.backgroundOpacity!==0?dr.backgroundOpacity:this.backgroundOpacity}getBackgroundColor(){return this.backgroundColor||dr.backgroundColor}getBackgroundTexture(){return this.backgroundTexture||dr.backgroundTexture()}getAlignContent(){return this.alignContent||dr.alignContent}getAlignItems(){return this.alignItems||dr.alignItems}getContentDirection(){return this.contentDirection||dr.contentDirection}getJustifyContent(){return this.justifyContent||dr.justifyContent}getInterLine(){return this.interLine===void 0?dr.interLine:this.interLine}getOffset(){return this.offset===void 0?dr.offset:this.offset}getBackgroundSize(){return this.backgroundSize===void 0?dr.backgroundSize:this.backgroundSize}getHiddenOverflow(){return this.hiddenOverflow===void 0?dr.hiddenOverflow:this.hiddenOverflow}getBestFit(){return this.bestFit===void 0?dr.bestFit:this.bestFit}_rebuildChildrenLists(){this.childrenUIs=this.children.filter(n=>n.isUI),this.childrenBoxes=this.children.filter(n=>n.isBoxComponent),this.childrenInlines=this.children.filter(n=>n.isInline),this.childrenTexts=this.children.filter(n=>n.isText)}add(){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);const n=super.add(...arguments);return this._rebuildChildrenLists(),n}remove(){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);const n=super.remove(...arguments);return this._rebuildChildrenLists(),n}update(n,i,r){Ou.requestUpdate(this,n,i,r)}onAfterUpdate(){}_updateFontFamily(n){this.fontFamily=n,this.traverse(i=>{i.isUI&&i.update(!0,!0,!1)}),this.getHighestParent().update(!1,!0,!1)}_updateFontTexture(n){this.fontTexture=n,this.getHighestParent().update(!1,!0,!1)}set(n){let i,r,o;if(Ou.register(this),!(!n||JSON.stringify(n)===JSON.stringify({}))){n.alignContent&&(n.alignItems=n.alignContent,n.textAlign||(n.textAlign=n.alignContent),console.warn("`alignContent` property has been deprecated, please rely on `alignItems` and `textAlign` instead."),delete n.alignContent),n.alignItems&&k3(n.alignItems);for(const l of Object.keys(n))if(this[l]!=n[l])switch(l){case"content":case"fontSize":case"fontKerning":case"breakOn":case"whiteSpace":this.isText&&(i=!0),r=!0,this[l]=n[l];break;case"bestFit":this.isBlock&&(i=!0,r=!0),this[l]=n[l];break;case"width":case"height":case"padding":(this.isInlineBlock||this.isBlock&&this.getBestFit()!="none")&&(i=!0),r=!0,this[l]=n[l];break;case"letterSpacing":case"interLine":this.isBlock&&this.getBestFit()!="none"&&(i=!0),r=!0,this[l]=n[l];break;case"margin":case"contentDirection":case"justifyContent":case"alignContent":case"alignItems":case"textAlign":case"textType":r=!0,this[l]=n[l];break;case"fontColor":case"fontOpacity":case"fontSupersampling":case"offset":case"backgroundColor":case"backgroundOpacity":case"backgroundTexture":case"backgroundSize":case"borderRadius":case"borderWidth":case"borderColor":case"borderOpacity":o=!0,this[l]=n[l];break;case"hiddenOverflow":this[l]=n[l];break}n.fontFamily&&Eg.setFontFamily(this,n.fontFamily),n.fontTexture&&Eg.setFontTexture(this,n.fontTexture),this.parentUI&&this.parentUI.getBestFit()!="none"&&this.parentUI.update(!0,!0,!1),this.update(i,r,o),r&&this.getHighestParent().update(!1,!0,!1)}}setupState(n){this.states[n.state]={attributes:n.attributes,onSet:n.onSet}}setState(n){const i=this.states[n];if(!i){console.warn(`state "${n}" does not exist within this component`);return}n!==this.currentState&&(this.currentState=n,i.onSet&&i.onSet(),i.attributes&&this.set(i.attributes))}clear(){this.traverse(n=>{Ou.disposeOf(n),n.material&&n.material.dispose(),n.geometry&&n.geometry.dispose()})}}}function p1(a){return class extends a{constructor(t){super(t),this.textUniforms={u_texture:{value:null},u_color:{value:null},u_opacity:{value:null},u_pxRange:{value:null},u_useRGSS:{value:null}},this.backgroundUniforms={u_texture:{value:null},u_color:{value:null},u_opacity:{value:null},u_backgroundMapping:{value:null},u_borderWidth:{value:null},u_borderColor:{value:null},u_borderRadiusTopLeft:{value:null},u_borderRadiusTopRight:{value:null},u_borderRadiusBottomRight:{value:null},u_borderRadiusBottomLeft:{value:null},u_borderOpacity:{value:null},u_size:{value:new hi.Vector2(1,1)},u_tSize:{value:new hi.Vector2(1,1)}}}updateBackgroundMaterial(){this.backgroundUniforms.u_texture.value=this.getBackgroundTexture(),this.backgroundUniforms.u_tSize.value.set(this.backgroundUniforms.u_texture.value.image.width,this.backgroundUniforms.u_texture.value.image.height),this.size&&this.backgroundUniforms.u_size.value.copy(this.size),this.backgroundUniforms.u_texture.value.isDefault?(this.backgroundUniforms.u_color.value=this.getBackgroundColor(),this.backgroundUniforms.u_opacity.value=this.getBackgroundOpacity()):(this.backgroundUniforms.u_color.value=this.backgroundColor||dr.backgroundWhiteColor,this.backgroundUniforms.u_opacity.value=!this.backgroundOpacity&&this.backgroundOpacity!==0?dr.backgroundOpaqueOpacity:this.backgroundOpacity),this.backgroundUniforms.u_backgroundMapping.value=(()=>{switch(this.getBackgroundSize()){case"stretch":return 0;case"contain":return 1;case"cover":return 2}})();const t=this.getBorderRadius();this.backgroundUniforms.u_borderWidth.value=this.getBorderWidth(),this.backgroundUniforms.u_borderColor.value=this.getBorderColor(),this.backgroundUniforms.u_borderOpacity.value=this.getBorderOpacity(),Array.isArray(t)?(this.backgroundUniforms.u_borderRadiusTopLeft.value=t[0],this.backgroundUniforms.u_borderRadiusTopRight.value=t[1],this.backgroundUniforms.u_borderRadiusBottomRight.value=t[2],this.backgroundUniforms.u_borderRadiusBottomLeft.value=t[3]):(this.backgroundUniforms.u_borderRadiusTopLeft.value=t,this.backgroundUniforms.u_borderRadiusTopRight.value=t,this.backgroundUniforms.u_borderRadiusBottomRight.value=t,this.backgroundUniforms.u_borderRadiusBottomLeft.value=t)}updateTextMaterial(){this.textUniforms.u_texture.value=this.getFontTexture(),this.textUniforms.u_color.value=this.getFontColor(),this.textUniforms.u_opacity.value=this.getFontOpacity(),this.textUniforms.u_pxRange.value=this.getFontPXRange(),this.textUniforms.u_useRGSS.value=this.getFontSupersampling()}getBackgroundMaterial(){return(!this.backgroundMaterial||!this.backgroundUniforms)&&(this.backgroundMaterial=this._makeBackgroundMaterial()),this.backgroundMaterial}getFontMaterial(){return(!this.fontMaterial||!this.textUniforms)&&(this.fontMaterial=this._makeTextMaterial()),this.fontMaterial}_makeTextMaterial(){return new hi.ShaderMaterial({uniforms:this.textUniforms,transparent:!0,clipping:!0,vertexShader:Rne,fragmentShader:Pne,extensions:{derivatives:!0}})}_makeBackgroundMaterial(){return new hi.ShaderMaterial({uniforms:this.backgroundUniforms,transparent:!0,clipping:!0,vertexShader:Bne,fragmentShader:Lne,extensions:{derivatives:!0}})}updateClippingPlanes(t){const n=t!==void 0?t:this.getClippingPlanes();JSON.stringify(n)!==JSON.stringify(this.clippingPlanes)&&(this.clippingPlanes=n,this.fontMaterial&&(this.fontMaterial.clippingPlanes=this.clippingPlanes),this.backgroundMaterial&&(this.backgroundMaterial.clippingPlanes=this.clippingPlanes))}}}const Rne=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	gl_Position.z -= 0.00001;

	#include <clipping_planes_vertex>

}
`,Pne=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;
uniform float u_pxRange;
uniform bool u_useRGSS;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field

float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}

float screenPxRange() {
	vec2 unitRange = vec2(u_pxRange)/vec2(textureSize(u_texture, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUv);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}

float tap(vec2 offsetUV) {
	vec3 msd = texture( u_texture, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}

void main() {

	float alpha;

	if ( u_useRGSS ) {

		// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
		// per pixel partial derivatives
		vec2 dx = dFdx(vUv);
		vec2 dy = dFdy(vUv);

		// rotated grid uv offsets
		vec2 uvOffsets = vec2(0.125, 0.375);
		vec2 offsetUV = vec2(0.0, 0.0);

		// supersampled using 2x2 rotated grid
		alpha = 0.0;
		offsetUV.xy = vUv + uvOffsets.x * dx + uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.x * dx - uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv + uvOffsets.y * dx - uvOffsets.x * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.y * dx + uvOffsets.x * dy;
		alpha += tap(offsetUV);
		alpha *= 0.25;

	} else {

		alpha = tap( vUv );

	}


	// apply the opacity
	alpha *= u_opacity;

	// this is useful to avoid z-fighting when quads overlap because of kerning
	if ( alpha < 0.02) discard;


	gl_FragColor = vec4( u_color, alpha );

	#include <clipping_planes_fragment>

}
`,Bne=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,Lne=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;

uniform float u_borderRadiusTopLeft;
uniform float u_borderRadiusTopRight;
uniform float u_borderRadiusBottomLeft;
uniform float u_borderRadiusBottomRight;
uniform float u_borderWidth;
uniform vec3 u_borderColor;
uniform float u_borderOpacity;
uniform vec2 u_size;
uniform vec2 u_tSize;
uniform int u_backgroundMapping;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

float getEdgeDist() {
	vec2 ndc = vec2( vUv.x * 2.0 - 1.0, vUv.y * 2.0 - 1.0 );
	vec2 planeSpaceCoord = vec2( u_size.x * 0.5 * ndc.x, u_size.y * 0.5 * ndc.y );
	vec2 corner = u_size * 0.5;
	vec2 offsetCorner = corner - abs( planeSpaceCoord );
	float innerRadDist = min( offsetCorner.x, offsetCorner.y ) * -1.0;
	if (vUv.x < 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopLeft, 0.0 ) ) - u_borderRadiusTopLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopLeft );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopRight, 0.0 ) ) - u_borderRadiusTopRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomRight, 0.0 ) ) - u_borderRadiusBottomRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x < 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomLeft, 0.0 ) ) - u_borderRadiusBottomLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomLeft );
		return mix( innerRadDist, roundedDist, s );
	}
}

vec4 sampleTexture() {
	float textureRatio = u_tSize.x / u_tSize.y;
	float panelRatio = u_size.x / u_size.y;
	vec2 uv = vUv;
	if ( u_backgroundMapping == 1 ) { // contain
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		}
	} else if ( u_backgroundMapping == 2 ) { // cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		}
	}
	return texture2D( u_texture, uv ).rgba;
}

void main() {

	float edgeDist = getEdgeDist();
	float change = fwidth( edgeDist );

	vec4 textureSample = sampleTexture();
	vec3 blendedColor = textureSample.rgb * u_color;

	float alpha = smoothstep( change, 0.0, edgeDist );
	float blendedOpacity = u_opacity * textureSample.a * alpha;

	vec4 frameColor = vec4( blendedColor, blendedOpacity );

	if ( u_borderWidth <= 0.0 ) {
		gl_FragColor = frameColor;
	} else {
		vec4 borderColor = vec4( u_borderColor, u_borderOpacity * alpha );
		float stp = smoothstep( edgeDist + change, edgeDist, u_borderWidth * -1.0 );
		gl_FragColor = mix( frameColor, borderColor, stp );
	}

	#include <clipping_planes_fragment>
}
`;class K3 extends hi.Mesh{constructor(e){const t=new hi.PlaneGeometry;super(t,e),this.castShadow=!0,this.receiveShadow=!0,this.name="MeshUI-Frame"}}let d_=null;function Qf(...a){if(!d_)throw new Error("Cannot use mixins with Base null");let e=d_;d_=null;let t=a.length,n;for(;--t>=0;)n=a[t],e=n(e);return e}Qf.withBase=a=>(d_=a,Qf);class Jm extends Qf.withBase(hi.Object3D)(h1,Y3,p1,vx){constructor(e){super(e),this.isBlock=!0,this.size=new hi.Vector2(1,1),this.frame=new K3(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){const e=this.getBestFit();e!="none"&&this.childrenTexts.length?this.calculateBestFit(e):this.childrenTexts.forEach(t=>{t._fitFontSize=void 0})}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(!e||!t){console.warn("Block got no dimension from its parameters or from children parameters");return}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.autoLayout&&this.setPosFromParentRecords(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.parentUI&&(this.position.z=this.getOffset())}updateInner(){this.parentUI&&(this.position.z=this.getOffset()),this.frame&&this.updateBackgroundMaterial()}}function Z3(a){return class extends a{constructor(t){super(t),this.isInline=!0}}}function Dne(a,e=!1){const t=a[0].index!==null,n=new Set(Object.keys(a[0].attributes)),i=new Set(Object.keys(a[0].morphAttributes)),r={},o={},l=a[0].morphTargetsRelative,h=new hi.BufferGeometry;let u=0;for(let f=0;f<a.length;++f){const g=a[f];let m=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const A in g.attributes){if(!n.has(A))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+'. All geometries must have compatible attributes; make sure "'+A+'" attribute exists among all geometries, or in none of them.'),null;r[A]===void 0&&(r[A]=[]),r[A].push(g.attributes[A]),m++}if(m!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". Make sure all geometries have the same number of attributes."),null;if(l!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const A in g.morphAttributes){if(!i.has(A))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+".  .morphAttributes must be consistent throughout all geometries."),null;o[A]===void 0&&(o[A]=[]),o[A].push(g.morphAttributes[A])}if(h.userData.mergedUserData=h.userData.mergedUserData||[],h.userData.mergedUserData.push(g.userData),e){let A;if(t)A=g.index.count;else if(g.attributes.position!==void 0)A=g.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". The geometry must have either an index or a position attribute"),null;h.addGroup(u,A,f),u+=A}}if(t){let f=0;const g=[];for(let m=0;m<a.length;++m){const A=a[m].index;for(let v=0;v<A.count;++v)g.push(A.getX(v)+f);f+=a[m].attributes.position.count}h.setIndex(g)}for(const f in r){const g=vL(r[f]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+f+" attribute."),null;h.setAttribute(f,g)}for(const f in o){const g=o[f][0].length;if(g===0)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[f]=[];for(let m=0;m<g;++m){const A=[];for(let b=0;b<o[f].length;++b)A.push(o[f][b][m]);const v=vL(A);if(!v)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+f+" morphAttribute."),null;h.morphAttributes[f].push(v)}}return h}function vL(a){let e,t,n,i=0;for(let l=0;l<a.length;++l){const h=a[l];if(h.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=h.normalized),n!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=h.array.length}const r=new e(i);let o=0;for(let l=0;l<a.length;++l)r.set(a[l].array,o),o+=a[l].array.length;return new hi.BufferAttribute(r,t,n)}class One extends hi.PlaneBufferGeometry{constructor(e,t){const n=e.glyph,i=e.fontSize;super(i,i),n.match(/\s/g)===null?(t.info.charset.indexOf(n)===-1&&console.error(`The character '${n}' is not included in the font characters set.`),this.mapUVs(t,n),this.transformGeometry(t,i,n,e)):(this.nullifyUVs(),this.scale(0,0,1),this.translate(0,i/2,0))}mapUVs(e,t){const n=e.chars.find(f=>f.char===t),i=e.common,r=n.x/i.scaleW,o=(n.x+n.width)/i.scaleW,l=1-(n.y+n.height)/i.scaleH,h=1-n.y/i.scaleH,u=this.attributes.uv;for(let f=0;f<u.count;f++){let g=u.getX(f),m=u.getY(f);[g,m]=(()=>{switch(f){case 0:return[r,h];case 1:return[o,h];case 2:return[r,l];case 3:return[o,l]}})(),u.setXY(f,g,m)}}nullifyUVs(){const e=this.attributes.uv;for(let t=0;t<e.count;t++)e.setXY(t,0,0)}transformGeometry(e,t,n,i){const r=e.chars.find(u=>u.char===n),o=e.common,l=r.height/o.lineHeight,h=r.width*l/r.height;this.scale(h,l,1),this.translate(i.width/2,i.height/2-i.anchor,0)}}function Fne(a){const e=a.font,t=a.fontSize,n=a.glyph,i=t/e.info.size,r=e.chars.find(g=>g.char===n);let o=r?r.width*i:t/3,l=r?r.height*i:0;o===0&&(o=r?r.xadvance*i:t),l===0&&(l=t*.7),n===`
`&&(o=0);const h=r?r.xadvance*i:o,u=r?r.xoffset*i:0,f=r?(r.yoffset+r.height-e.common.base)*t/e.common.lineHeight:0;return{width:o,height:l,anchor:f,xadvance:h,xoffset:u}}function kne(a,e){const t=a._kernings;return t[e]?t[e]:0}function Nne(){const a=[];this.inlines.forEach((n,i)=>{a[i]=new One(n,this.getFontFamily()),a[i].translate(n.offsetX,n.offsetY,0)});const e=Dne(a);return new hi.Mesh(e,this.getFontMaterial())}const wC={getGlyphDimensions:Fne,getGlyphPairKerning:kne,buildText:Nne};function Une(a){return class extends a{createText(){const t=this,n=(()=>{switch(this.getTextType()){case"MSDF":return wC.buildText.call(this);default:console.warn(`'${this.getTextType()}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}})();return n.renderOrder=1/0,n.onBeforeRender=function(){t.updateClippingPlanes&&t.updateClippingPlanes()},n}getGlyphDimensions(t){switch(t.textType){case"MSDF":return wC.getGlyphDimensions(t);default:console.warn(`'${t.textType}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}getGlyphPairKerning(t,n,i){switch(t){case"MSDF":return wC.getGlyphPairKerning(n,i);default:console.warn(`'${t}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}}}function $3(a){a.children.forEach(e=>{e.children.length>0&&$3(e),a.remove(e),Ou.disposeOf(e),e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),a.children=[]}const zne=$3;class m1 extends Qf.withBase(hi.Object3D)(Z3,Une,p1,vx){constructor(e){super(e),this.isText=!0,this.set(e)}parseParams(){this.calculateInlines(this._fitFontSize||this.getFontSize())}updateLayout(){zne(this),this.inlines&&(this.textContent=this.createText(),this.updateTextMaterial(),this.add(this.textContent)),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.textContent&&this.updateTextMaterial()}calculateInlines(e){const t=this.content,n=this.getFontFamily(),i=this.getBreakOn(),r=this.getTextType(),o=this.getWhiteSpace();if(!n||typeof n=="string"){Eg.getFontOf(this)||console.warn("no font was found");return}if(!this.content){this.inlines=null;return}if(!r){console.error(`You must provide a 'textType' attribute so three-mesh-ui knows how to render your text.
 See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);return}const l=U3(t,o),h=Array.from?Array.from(l):String(l).split(""),u=e/n.info.size,f=n.common.lineHeight*u,g=n.common.base*u,m=h.map(A=>{const v=this.getGlyphDimensions({textType:r,glyph:A,font:n,fontSize:e});let b=null;return o!==gA&&(i.includes(A)||A.match(/\s/g))&&(b="possible"),A.match(/\n/g)&&(b=z3(o)),{height:v.height,width:v.width,anchor:v.anchor,xadvance:v.xadvance,xoffset:v.xoffset,lineBreak:b,glyph:A,fontSize:e,lineHeight:f,lineBase:g}});if(this.getFontKerning()!=="none")for(let A=1;A<m.length;A++){const v=m[A],b=m[A-1].glyph+m[A].glyph,C=this.getGlyphPairKerning(r,n,b);v.kerning=C*(e/n.info.size)}this.inlines=m}}class g1 extends Qf.withBase(hi.Object3D)(Z3,h1,Y3,p1,vx){constructor(e){super(e),this.isInlineBlock=!0,this.size=new hi.Vector2(1,1),this.frame=new K3(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){this.width||console.warn("inlineBlock has no width. Set to 0.3 by default"),this.height||console.warn("inlineBlock has no height. Set to 0.3 by default"),this.inlines=[{height:this.height||.3,width:this.width||.3,anchor:0,lineBreak:"possible"}]}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(this.inlines){const n=this.inlines[0];this.position.set(n.width/2,n.height/2,0),this.position.x+=n.offsetX,this.position.y+=n.offsetY}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.frame&&this.updateBackgroundMaterial()}}const Ol={fr:[[[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]}],[{width:.2,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],eng:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],ru:[[[{width:1/12,chars:[{lowerCase:"\u0439",upperCase:"\u0419"},{lowerCase:"q",upperCase:"Q"}]},{width:1/12,chars:[{lowerCase:"\u0446",upperCase:"\u0426"},{lowerCase:"w",upperCase:"W"}]},{width:1/12,chars:[{lowerCase:"\u0443",upperCase:"\u0423"},{lowerCase:"e",upperCase:"E"}]},{width:1/12,chars:[{lowerCase:"\u043A",upperCase:"\u041A"},{lowerCase:"r",upperCase:"R"}]},{width:1/12,chars:[{lowerCase:"\u0435",upperCase:"\u0415"},{lowerCase:"t",upperCase:"T"}]},{width:1/12,chars:[{lowerCase:"\u043D",upperCase:"\u041D"},{lowerCase:"y",upperCase:"Y"}]},{width:1/12,chars:[{lowerCase:"\u0433",upperCase:"\u0413"},{lowerCase:"u",upperCase:"U"}]},{width:1/12,chars:[{lowerCase:"\u0448",upperCase:"\u0428"},{lowerCase:"i",upperCase:"I"}]},{width:1/12,chars:[{lowerCase:"\u0449",upperCase:"\u0429"},{lowerCase:"o",upperCase:"O"}]},{width:1/12,chars:[{lowerCase:"\u0437",upperCase:"\u0417"},{lowerCase:"p",upperCase:"P"}]},{width:1/12,chars:[{lowerCase:"\u0445",upperCase:"\u0425"},{lowerCase:"{",upperCase:"["}]},{width:1/12,chars:[{lowerCase:"\u044A",upperCase:"\u042A"},{lowerCase:"}",upperCase:"]"}]}],[{width:1/12,chars:[{lowerCase:"\u0444",upperCase:"\u0424"},{lowerCase:"a",upperCase:"A"}]},{width:1/12,chars:[{lowerCase:"\u044B",upperCase:"\u042B"},{lowerCase:"s",upperCase:"S"}]},{width:1/12,chars:[{lowerCase:"\u0432",upperCase:"\u0412"},{lowerCase:"d",upperCase:"D"}]},{width:1/12,chars:[{lowerCase:"\u0430",upperCase:"\u0410"},{lowerCase:"f",upperCase:"F"}]},{width:1/12,chars:[{lowerCase:"\u043F",upperCase:"\u041F"},{lowerCase:"g",upperCase:"G"}]},{width:1/12,chars:[{lowerCase:"\u0440",upperCase:"\u0420"},{lowerCase:"h",upperCase:"H"}]},{width:1/12,chars:[{lowerCase:"\u043E",upperCase:"\u041E"},{lowerCase:"j",upperCase:"J"}]},{width:1/12,chars:[{lowerCase:"\u043B",upperCase:"\u041B"},{lowerCase:"k",upperCase:"K"}]},{width:1/12,chars:[{lowerCase:"\u0434",upperCase:"\u0414"},{lowerCase:"l",upperCase:"L"}]},{width:1/12,chars:[{lowerCase:"\u0436",upperCase:"\u0416"},{lowerCase:":",upperCase:";"}]},{width:1/12,chars:[{lowerCase:"\u044D",upperCase:"\u042D"},{lowerCase:'"',upperCase:"'"}]},{width:1/12,chars:[{lowerCase:"\u0451",upperCase:"\u0401"},{lowerCase:"|",upperCase:"\\"}]}],[{width:1.5/12,command:"shift",chars:[{icon:"shift"}]},{width:1/12,chars:[{lowerCase:"\u044F",upperCase:"\u042F"},{lowerCase:"z",upperCase:"Z"}]},{width:1/12,chars:[{lowerCase:"\u0447",upperCase:"\u0427"},{lowerCase:"x",upperCase:"X"}]},{width:1/12,chars:[{lowerCase:"\u0441",upperCase:"\u0421"},{lowerCase:"c",upperCase:"C"}]},{width:1/12,chars:[{lowerCase:"\u043C",upperCase:"\u041C"},{lowerCase:"v",upperCase:"V"}]},{width:1/12,chars:[{lowerCase:"\u0438",upperCase:"\u0418"},{lowerCase:"b",upperCase:"B"}]},{width:1/12,chars:[{lowerCase:"\u0442",upperCase:"\u0422"},{lowerCase:"n",upperCase:"N"}]},{width:1/12,chars:[{lowerCase:"\u044C",upperCase:"\u042C"},{lowerCase:"m",upperCase:"M"}]},{width:1/12,chars:[{lowerCase:"\u0431",upperCase:"\u0411"},{lowerCase:",",upperCase:""}]},{width:1/12,chars:[{lowerCase:"\u044E",upperCase:"\u042E"},{lowerCase:".",upperCase:""}]},{width:1.5/12,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.3,command:"switch",chars:[{lowerCase:"\u0410\u0411\u0412"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],de:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xFC",upperCase:"\xDC"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xF6",upperCase:"\xD6"}]},{width:1/11,chars:[{lowerCase:"\xE4",upperCase:"\xC4"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],es:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"\xF1",upperCase:"\xD1"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],el:[[[{width:.1,chars:[{lowerCase:";",upperCase:":"},{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"\u03C2",upperCase:"\u03C2"},{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"\u03B5",upperCase:"\u0395"},{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"\u03C1",upperCase:"\u03A1"},{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"\u03C4",upperCase:"\u03A4"},{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"\u03C5",upperCase:"\u03A5"},{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"\u03B8",upperCase:"\u0398"},{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"\u03B9",upperCase:"\u0399"},{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"\u03BF",upperCase:"\u039F"},{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"\u03C0",upperCase:"\u03A0"},{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"\u03B1",upperCase:"\u0391"},{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"\u03C3",upperCase:"\u03A3"},{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"\u03B4",upperCase:"\u0394"},{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"\u03C6",upperCase:"\u03A6"},{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"\u03B3",upperCase:"\u0393"},{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"\u03B7",upperCase:"\u0397"},{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"\u03BE",upperCase:"\u039E"},{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"\u03BA",upperCase:"\u039A"},{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"\u03BB",upperCase:"\u039B"},{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"\u03B6",upperCase:"\u0396"},{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"\u03C7",upperCase:"\u03A7"},{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"\u03C8",upperCase:"\u03A8"},{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"\u03C9",upperCase:"\u03A9"},{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"\u03B2",upperCase:"\u0392"},{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"\u03BD",upperCase:"\u039D"},{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"\u03BC",upperCase:"\u039C"},{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],nord:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xE5",upperCase:"\xC5"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xE6",upperCase:"\xC6"}]},{width:1/11,chars:[{lowerCase:"\xF8",upperCase:"\xD8"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]]},Gne=new hi.TextureLoader;class ek extends Qf.withBase(hi.Object3D)(h1,vx){constructor(e){e||(e={}),e.width||(e.width=1),e.height||(e.height=.4),e.margin||(e.margin=.003),e.padding||(e.padding=.01),super(e),this.currentPanel=0,this.isLowerCase=!0,this.charsetCount=1;let t;if(e.language||navigator.language)switch(e.language||navigator.language){case"fr":case"fr-CH":case"fr-CA":t=Ol.fr;break;case"ru":this.charsetCount=2,t=Ol.ru;break;case"de":case"de-DE":case"de-AT":case"de-LI":case"de-CH":t=Ol.de;break;case"es":case"es-419":case"es-AR":case"es-CL":case"es-CO":case"es-ES":case"es-CR":case"es-US":case"es-HN":case"es-MX":case"es-PE":case"es-UY":case"es-VE":t=Ol.es;break;case"el":this.charsetCount=2,t=Ol.el;break;case"nord":t=Ol.nord;break;default:t=Ol.eng;break}else t=Ol.eng;this.keys=[],this.panels=t.map(n=>{const i=e.height/n.length-e.margin*2,r=new Jm({width:e.width+e.padding*2,height:e.height+e.padding*2,offset:0,padding:e.padding,fontFamily:e.fontFamily,fontTexture:e.fontTexture,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity});return r.charset=0,r.add(...n.map(o=>{const l=new Jm({width:e.width,height:i,margin:e.margin,contentDirection:"row",justifyContent:"center"});l.frame.visible=!1;const h=[];return o.forEach(u=>{const f=new Jm({width:e.width*u.width-e.margin*2,height:i,margin:e.margin,justifyContent:"center",offset:0}),g=u.chars[r.charset].lowerCase||u.chars[r.charset].icon||"undif";if(g==="enter"&&e.enterTexture||g==="shift"&&e.shiftTexture||g==="backspace"&&e.backspaceTexture){const m=(()=>{switch(g){case"backspace":return e.backspaceTexture;case"enter":return e.enterTexture;case"shift":return e.shiftTexture;default:console.warn("There is no icon image for this key")}})();Gne.load(m,A=>{f.add(new g1({width:f.width*.65,height:f.height*.65,backgroundSize:"contain",backgroundTexture:A}))})}else f.add(new m1({content:g,offset:0}));f.type="Key",f.info=u,f.info.input=g,f.panel=r,h.push(f),this.keys.push(f)}),l.add(...h),l})),r}),this.add(this.panels[0]),this.set(e)}setNextPanel(){this.panels.forEach(e=>{this.remove(e)}),this.currentPanel=(this.currentPanel+1)%this.panels.length,this.add(this.panels[this.currentPanel]),this.update(!0,!0,!0)}setNextCharset(){this.panels[this.currentPanel].charset=(this.panels[this.currentPanel].charset+1)%this.charsetCount,this.keys.forEach(e=>{if(!this.panels[this.currentPanel].getObjectById(e.id))return;const n=e.info.chars[e.panel.charset]||e.info.chars[0],i=this.isLowerCase||!n.upperCase?n.lowerCase:n.upperCase;if(!e.childrenTexts.length)return;const r=e.childrenTexts[0];e.info.input=i,r.set({content:i}),r.update(!0,!0,!0)})}toggleCase(){this.isLowerCase=!this.isLowerCase,this.keys.forEach(e=>{const t=e.info.chars[e.panel.charset]||e.info.chars[0],n=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase;if(!e.childrenTexts.length)return;const i=e.childrenTexts[0];e.info.input=n,i.set({content:n}),i.update(!0,!0,!0)})}parseParams(){}updateLayout(){}updateInner(){}}const tk=()=>Ou.update(),nk={Block:Jm,Text:m1,InlineBlock:g1,Keyboard:ek,FontLibrary:Eg,update:tk,TextAlign:mx,Whitespace:px,JustifyContent:fx,AlignItems:dx,ContentDirection:ux};typeof global<"u"&&(global.ThreeMeshUI=nk);const Hne=nk;var Vne=Ao.g1,A1=Ao.gO,Wne=Ao.km,Qne=Ao.zV,jne=Ao.ol,qne=Ao.uM,ik=Ao.N1,sk=Ao.xv,Xne=Ao.PH,Yne=Ao.UH,Jne=Ao.ZP,Kne=Ao.Vx;const Zne=Object.freeze(Object.defineProperty({__proto__:null,AlignItems:Vne,Block:A1,ContentDirection:Wne,FontLibrary:Qne,InlineBlock:jne,JustifyContent:qne,Keyboard:ik,Text:sk,TextAlign:Xne,Whitespace:Yne,default:Jne,update:Kne},Symbol.toStringTag,{value:"Module"}));class xf{constructor(e){x(this,"used",!1);x(this,"inputSource");x(this,"object");x(this,"isDown");x(this,"isUp");x(this,"isPressed");x(this,"isClicked");x(this,"event");this.event=e}Use(){this.used=!0}StopPropagation(){var e;(e=this.event)==null||e.stopImmediatePropagation()}}const $ne=Ct("debugeventsystem"),ka=class extends pt{constructor(){super();x(this,"orbitControl",null);x(this,"orbitControlWasEnabled",!1);x(this,"raycaster",[]);x(this,"_selectStartFn");x(this,"_selectEndFn");x(this,"_selectUpdateFn");x(this,"lastPointerEvent",null);x(this,"objectsHoveredThisFrame",[]);x(this,"objectsHoveredLastFrame",[]);x(this,"raisedPointerDownEvents",[]);x(this,"_didMove",!1);x(this,"_tempComponentsArray",[]);x(this,"_sortedHits",[]);x(this,"_sortingBuffer",[]);x(this,"_noDepthTestingResults",[]);x(this,"handleEventsArray",[]);x(this,"currentActiveMeshUIComponents",[]);ka.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,ka.systems.length<=0&&ka.systems.push(...Ee.findObjectsOfType(ka,t)));for(const i of ka.systems)if(i.context===t)return;const n=new Ft;Ee.addNewComponent(n,ka),t.scene.add(n)}static ensureUpdateMeshUI(t,n){Lc.update(t,n)}static markUIDirty(t){Lc.markDirty()}static get instance(){return this.systems[0]}onDestroy(){ka.systems.splice(ka.systems.indexOf(this),1)}start(){}register(t){var n;t&&this.raycaster&&!this.raycaster.includes(t)&&((n=this.raycaster)==null||n.push(t))}unregister(t){var i,r;const n=(i=this.raycaster)==null?void 0:i.indexOf(t);n!==void 0&&n!==-1&&((r=this.raycaster)==null||r.splice(n,1))}onEnable(){var n,i,r;(n=this._selectStartFn)!=null||(this._selectStartFn=(o,l)=>{if(!l.grab)return;Lc.resetLastSelected();const h=new xf;h.inputSource=o,h.isDown=o.selectionDown,h.isUp=o.selectionUp,h.isPressed=o.selectionPressed,h.isClicked=!1,l.grab&&!this.handleEvents(l.grab,h)&&(l.grab=null)}),(i=this._selectEndFn)!=null||(this._selectEndFn=(o,l)=>{if(!l.grab)return;const h=new xf;h.inputSource=o,h.isDown=o.selectionDown,h.isUp=o.selectionUp,h.isPressed=o.selectionPressed,h.isClicked=o.selectionClick,this.handleEvents(l.grab,h)});const t=new nc;(r=this._selectUpdateFn)!=null||(this._selectUpdateFn=o=>{t.ray=o.getRay();const l=this.performRaycast(t);if(!l)return;const h=new xf;h.inputSource=o,this.handleIntersections(l,h)}),Zi.addEventListener(la.SelectStart,this._selectStartFn),Zi.addEventListener(la.SelectEnd,this._selectEndFn),Zi.addEventListener(la.Update,this._selectUpdateFn),this.context.pre_update_callbacks.push(this.onBeforeUpdate.bind(this)),this.context.input.addEventListener(O_.PointerDown,this.onPointerDown.bind(this))}onDisable(){Zi.removeEventListener(la.SelectStart,this._selectStartFn),Zi.removeEventListener(la.SelectEnd,this._selectEndFn),Zi.removeEventListener(la.Update,this._selectUpdateFn)}onPointerDown(){this.onBeforeUpdate()}onBeforeUpdate(){var r,o;if(this.objectsHoveredThisFrame.length=0,this.resetMeshUIStates(),_i.IsInWebXR||this.context.input.isKeyPressed(Xl.ALT))return;if(!this._didMove){const l=this.context.input.getPointerPositionRC(0);if(l&&l.x===0&&l.y===0)return;this._didMove=!0}const t=this.performRaycast(null),n=new xf(this.context.input.getPointerEvent(0));if(n.inputSource=this.context.input,n.isClicked=this.context.input.mouseClick,n.isDown=this.context.input.mouseDown,n.isUp=this.context.input.mouseUp,n.isPressed=this.context.input.mousePressed,this.lastPointerEvent=n,!t)return;let i=null;this.context.input.mouseDown&&this.currentActiveMeshUIComponents.length>0&&this.context.mainCameraComponent&&(i=(r=Ee.getComponent(this.context.mainCameraComponent.gameObject,dh))!=null?r:null,i&&(i.enabled,i.enabled=!1)),this.handleIntersections(t,n),i&&(this.orbitControl=i,(o=this.orbitControl)!=null&&o.enabled?(this.orbitControlWasEnabled=this.orbitControl.enabled,this.orbitControl.enabled=!1):this.orbitControl&&!this.context.input.mousePressed&&(this.orbitControl.enabled=this.orbitControlWasEnabled,this.orbitControl=null))}onBeforeRender(){if(this.lastPointerEvent)this.lastPointerEvent.used=!1;else return;if(this.lastPointerEvent.isUp){for(const n of this.raisedPointerDownEvents)n.onPointerUp&&n.onPointerUp(this.lastPointerEvent);this.raisedPointerDownEvents.length=0}for(const n of this.objectsHoveredLastFrame)if(this.objectsHoveredThisFrame.indexOf(n)<0){this._tempComponentsArray.length=0;const i=Ee.getComponentsInParent(n,pt,this._tempComponentsArray);this.lastPointerEvent.object=n;for(let r=0;r<i.length;r++){const o=i[r];if(!o.gameObject||o.destroyed)continue;const l=o;l.onPointerExit&&l.onPointerExit(this.lastPointerEvent)}}const t=this.objectsHoveredLastFrame;this.objectsHoveredLastFrame=this.objectsHoveredThisFrame,this.objectsHoveredThisFrame=t}performRaycast(t){if(!this.raycaster)return null;this._sortedHits.length=0;for(const n of this.raycaster){if(!n.activeAndEnabled)continue;const i=n.performRaycast(t);i&&i.length>0&&this._sortedHits.push(...i)}return this._sortedHits.sort((n,i)=>n.distance-i.distance),this._sortedHits}handleIntersections(t,n){if(!t||t.length<=0)return!1;t=this.sortCandidates(t);for(const i of t){const{object:r}=i;if(this.handleEvents(r,n))return!0}return!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let n=0;n<t.length;n++){const i=t[n],r=i.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(i);continue}this._sortingBuffer.push(i)}for(const n of this._sortingBuffer)this._noDepthTestingResults.push(n);return this._noDepthTestingResults}handleEvents(t,n){var l,h;if(!this.testIsVisible(t))return n.isClicked&&$ne&&console.log("not allowed",t),!1;n.object=t,this.lastPointerEvent=n;const i=t.parent;let r=!1;(l=n.isClicked)!=null;let o=null;if(i&&i.isUI){const u=(h=n.isPressed||n.isClicked)!=null?h:!1;if(i.shadowComponentOwner){const f=i.shadowComponentOwner.gameObject;if(f){if(o=this.tryFindCanvasGroup(f),(o==null?void 0:o.isCanvasGroup)===!0){if(o.blocksRaycasts===!1)return!1;if(o.interactable===!1)return!0}const g=Ee.foreachComponent(f,m=>{if(typeof m.raycastTarget=="boolean")return m},!1);if((g==null?void 0:g.raycastTarget)===!1)return!1;this.handleMeshUIIntersection(t,u),t=f,r=!0}}if(!r&&this.handleMeshUiObjectWithoutShadowDom(i,u))return!0}if(this.objectsHoveredThisFrame.push(t),o===null||o.interactable){const u=this.objectsHoveredLastFrame.indexOf(t)>=0;this.handleEventsArray.length=0;const f=Ee.getComponentsInParent(t,pt,this.handleEventsArray);for(let g=0;g<f.length;g++){if(n.used)return!0;if(f[g].destroyed)continue;const m=f[g];m.interactable!==!1&&(m.onPointerEnter&&(u||m.onPointerEnter(n)),n.isDown&&m.onPointerDown&&!this.raisedPointerDownEvents.includes(m)&&(m.onPointerDown(n),this.raisedPointerDownEvents.push(m)),n.isUp&&m.onPointerUp&&m.onPointerUp(n),n.isClicked&&m.onPointerClick&&m.onPointerClick(n))}}return!0}handleMeshUiObjectWithoutShadowDom(t,n){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,n)}handleMeshUIIntersection(t,n){const i=Lc.updateState(t,n);return i&&this.currentActiveMeshUIComponents.push(i),i!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&Lc.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const n=this.currentActiveMeshUIComponents[t];Lc.resetState(n)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?Ee.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}tryFindCanvasGroup(t){if(!t)return null;const n=Ee.foreachComponent(t,i=>{const r=i;if(r.blocksRaycasts!==void 0&&r.interactable!==void 0)return r},!1);return n!==void 0?n:this.tryFindCanvasGroup(t.parent)}};let pa=ka;x(pa,"didSearchEventSystem",!1),x(pa,"systems",[]);class Lc{static markDirty(){this.needsUpdate=!0}static update(e,t){for(const n of this.lastUpdateFrame)if(n.context===t){if(t.time.frameCount===n.frame)return;n.frame=t.time.frameCount,(this.needsUpdate||t.time.frameCount<30)&&(this.needsUpdate=!1,e.update());return}this.lastUpdateFrame=[{context:t,frame:t.time.frameCount}],e.update()}static updateState(e,t){let n=null;if(e&&(n=this.findBlockInParent(e),n&&n!==this.lastSelected)){if(n.interactable===!1)return null;t?(this.lastSelected=n,n.states.pressed&&n.setState("pressed")):n.states.hovered&&n.setState("hovered"),this.needsUpdate=!0}return n}static resetLastSelected(){const e=this.lastSelected;!e||(this.lastSelected=null,this.resetState(e))}static resetState(e){if(!e)return;e.interactable===!1?e.states.disabled&&e.setState("disabled"):e===this.lastSelected&&e.states.selected?e.setState("selected"):e.setState("normal"),this.needsUpdate=!0}static findBlockInParent(e){return e?e.isBlock&&Object.keys(e.states).length>0?e:this.findBlockInParent(e.parent):null}}x(Lc,"lastSelected",null),x(Lc,"lastUpdateFrame",[]),x(Lc,"needsUpdate",!1);const Rm="./include";A1.prototype.interactable={get(){return this.interactive},set(a){this.interactable=a}};class Zc extends pt{constructor(){super(...arguments);x(this,"shadowComponent",null);x(this,"_controlsChildLayout",!0);x(this,"_root");x(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}markDirty(){pa.markUIDirty(this.context)}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=Ee.getComponentInParent(this.gameObject,xx)),this._root}onEnable(){super.onEnable()}addShadowComponent(t,n){var r,o;this.removeShadowComponent();const i=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=Ee.getComponentInParent(i,Zc),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have a UI element outside a Canvas?`,this);return}if(t.name=this.name+" ("+((r=this.constructor.name)!=null?r:"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t.shadowComponentOwner=this,t.traverse(l=>{l.shadowComponentOwner===void 0&&(l.shadowComponentOwner=this)}),((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(t);else{let l=this._parentComponent.shadowComponent;l&&(l==null||l.add(t))}this.shadowComponent=t,n&&n.shadowComponent&&this.shadowComponent&&n.shadowComponent.add(this.shadowComponent),Zg&&t.add(new Iv(.5)),this.onAfterAddedToScene()}set(t){}traverseOwnedShadowComponents(t,n,i){if(!!t&&t.shadowComponentOwner===n){i(t);for(const r of t.children)this.traverseOwnedShadowComponents(r,n,i)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class xx extends Zc{awake(){super.awake()}}function tv(a,e){var n,i;if(!a)return;const t=a.material;(t==null?void 0:t.isMaterial)===!0&&(t.depthTest=!e.renderOnTop,t.side=(n=e.doubleSided)==null||n?ir:zo,t.depthWrite=(i=e.depthWrite)!=null?i:!1,t.shadowSide=e.doubleSided?ir:zo,a.castShadow=e.castShadows?e.castShadows:!1,a.receiveShadow=e.receiveShadows?e.receiveShadows:!1);for(const r of a.children)tv(r,e)}function rk(a,e,t){a[e]===void 0&&console.warn("Field",e,"is undefined on",a);const n=Proxy.revocable(a[e],{set(o,l,h,u){const f=o[l],g=Reflect.set(o,l,h,u);return t(h,f),g}}),i=n.revoke,r=a[e];return n.revoke=()=>{a[e]=r,i()},a[e]=n.proxy,n}function eie(a,e,t=qr.OnBeforeRender){let n=a.__scheduledActions;n||(n=a.__scheduledActions={});const i=e.name;n[t]||(n[t]={});const r=n[t];if(r[i])return;function*l(){e==null||e.call(a),r[i]=null}const h=a.startCoroutine(l(),t);r[i]=h}var tie=Object.defineProperty,nie=Object.getOwnPropertyDescriptor,wx=(a,e,t,n)=>{for(var i=n>1?void 0:n?nie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&tie(e,t,i),i};const xL=Ct("debugui");class ok{constructor(){x(this,"width");x(this,"height")}}class y1{constructor(){x(this,"x");x(this,"y");x(this,"width");x(this,"height")}}class vh extends Zc{constructor(){super(...arguments);x(this,"offset",.01);x(this,"_anchoredPosition");x(this,"rect");x(this,"sizeDelta");x(this,"anchoredPosition3D");x(this,"pivot");x(this,"lastMatrix");x(this,"rectBlock");x(this,"_transformNeedsUpdate",!1);x(this,"_createdBlocks",[])}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new q),this._anchoredPosition}awake(){super.awake(),this.lastMatrix=new fn,this.rectBlock=new Ft,this.rectBlock.position.z=.1,this.rectBlock.name=this.name,this._anchoredPosition||(this._anchoredPosition=new q),rk(this,"_anchoredPosition",()=>{this._transformNeedsUpdate=!0})}onEnable(){super.onEnable(),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0}onDisable(){super.onDisable(),this.removeShadowComponent()}applyTransform(){const t=this.shadowComponent;!t||(this._transformNeedsUpdate=!1,this.isRoot()?t.rotation.y=Math.PI:(t.position.copy(this.gameObject.position),t.position.x*=-1,t.position.z*=-1,t.position.z-=this.offset,t.quaternion.copy(this.gameObject.quaternion),t.rotation.x*=-1,t.rotation.z*=-1,t.scale.copy(this.gameObject.scale)),this.applyAnchoring(t.position),this.lastMatrix.copy(this.gameObject.matrix))}markDirty(){this._transformNeedsUpdate=!0}onBeforeRender(){(this._transformNeedsUpdate||this.lastMatrix.equals(this.gameObject.matrix)===!1)&&(xL&&console.log("updating",this.name),this.applyTransform()),pa.ensureUpdateMeshUI(Zne,this.context)}applyAnchoring(t){if(this.pivot&&this.sizeDelta){let n=this.pivot.x*2-1,i=this.pivot.y*2-1;i-=this.anchoredPosition.y*.05;const r=this.sizeDelta.x*n,o=this.sizeDelta.y*i;t.x-=r*.5,t.y-=o*.5}}getBasicOptions(){const t={width:this.rect.width,height:this.rect.height,offset:this.offset,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0};return this.ensureValidSize(t),t}ensureValidSize(t,n=1e-4){return t.width<=0&&(t.width=n),t.height<=0&&(t.height=1e-4),t}createNewBlock(t){t={...this.getBasicOptions(),...t},xL&&console.log(this.name,t);const n=new A1(t);return this._createdBlocks.push(n),n}}wx([we(y1)],vh.prototype,"rect",2);wx([we(Xe)],vh.prototype,"sizeDelta",2);wx([we(q)],vh.prototype,"anchoredPosition3D",2);wx([we(Xe)],vh.prototype,"pivot",2);var iie=Object.defineProperty,sie=Object.getOwnPropertyDescriptor,ak=(a,e,t,n)=>{for(var i=n>1?void 0:n?sie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&iie(e,t,i),i};class Ju extends Zc{constructor(){super(...arguments);x(this,"raycastTarget",!0);x(this,"uiObject",null);x(this,"_color",null);x(this,"_rect",null);x(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new fo(1,1,1,1)),this._color}set color(t){(!this._color||this._color.r!==t.r||this._color.g!==t.g||this._color.b!==t.b||this._color.alpha!==t.alpha)&&(this._color||(this._color=new fo(1,1,1,1)),this._color.copy(t))}onColorChanged(){const t=this.color;this.setOptions({backgroundColor:t,backgroundOpacity:t.alpha,borderOpacity:t.alpha})}get m_Color(){return this._color}get rectTransform(){return this._rect||(this._rect=this.gameObject.getComponent(vh)),this._rect}setState(t){this.makePanel(),this.uiObject&&this.uiObject.setState(t)}setupState(t){this.makePanel(),this.uiObject&&this.uiObject.setupState(t)}setOptions(t){var n;this.makePanel(),this.uiObject&&(this.uiObject.set(t),(t.backgroundColor!==void 0||t.backgroundOpacity!==void 0)&&((n=this.uiObject.updateBackgroundMaterial)==null||n.call(this.uiObject)))}awake(){super.awake(),this.makePanel(),rk(this,"_color",()=>eie(this,this.onColorChanged))}onEnable(){var t;super.onEnable(),this.uiObject&&((t=this.rectTransform.shadowComponent)==null||t.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const t={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:1};this.onBeforeCreate(t),this.onCreate(t),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated()}onBeforeCreate(t){}onCreate(t){this.uiObject=this.rectTransform.createNewBlock(t),this.uiObject.name=this.name}onAfterCreated(){}async setTexture(t){!t||(this.setOptions({backgroundOpacity:0}),t&&this.setOptions({backgroundTexture:t,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}))}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}}ak([we(fo)],Ju.prototype,"color",1);ak([we()],Ju.prototype,"raycastTarget",2);class bx extends Ju{onAfterCreated(){this.uiObject&&(this.uiObject.scale.y*=-1)}}var rie=Object.defineProperty,oie=Object.getOwnPropertyDescriptor,_1=(a,e,t,n)=>{for(var i=n>1?void 0:n?oie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&rie(e,t,i),i};class ck{constructor(){x(this,"texture");x(this,"rect")}}_1([we(Ii)],ck.prototype,"texture",2);class Cx extends bx{constructor(){super(...arguments);x(this,"sprite")}isBuiltinSprite(){var t,n,i,r,o,l,h,u;switch((n=(t=this.sprite)==null?void 0:t.texture)==null?void 0:n.name){case"InputFieldBackground":case"UISprite":case"Background":return!0}return((o=(r=(i=this.sprite)==null?void 0:i.texture)==null?void 0:r.image)==null?void 0:o.width)===32&&((u=(h=(l=this.sprite)==null?void 0:l.texture)==null?void 0:h.image)==null?void 0:u.height)===32}onBeforeCreate(t){this.isBuiltinSprite()&&(t.borderRadius=5,t.borderColor=new ye(.4,.4,.4),t.borderOpacity=this.color.alpha,t.borderWidth=.3)}onAfterCreated(){var t;super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture)}}_1([we(ck)],Cx.prototype,"sprite",2);class v1 extends bx{constructor(){super(...arguments);x(this,"mainTexture")}onAfterCreated(){super.onAfterCreated(),this.setTexture(this.mainTexture)}}_1([we(Ii)],v1.prototype,"mainTexture",2);var aie=Object.defineProperty,cie=Object.getOwnPropertyDescriptor,yp=(a,e,t,n)=>{for(var i=n>1?void 0:n?cie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&aie(e,t,i),i};const rf=Ct("debugbutton");class xh extends pt{constructor(){super(...arguments);x(this,"onClick");x(this,"_isHovered",!1);x(this,"colors");x(this,"transition");x(this,"animationTriggers");x(this,"animator");x(this,"_interactable",!0);x(this,"_requestedAnimatorTrigger");x(this,"_isInit",!1);x(this,"_image")}onPointerEnter(t){var n,i;rf&&console.log("Button Enter",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this._isHovered=!0,this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this.animationTriggers.highlightedTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("hovered"))}onPointerExit(){var t,n;rf&&console.log("Button Exit",(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this._isHovered=!1,this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((n=this._image)==null||n.setState("normal"))}onPointerDown(t){var n,i;rf&&console.log("Button Down",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this.animationTriggers.pressedTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("pressed"))}onPointerUp(t){var n,i;rf&&console.log("Button Down",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState(this._isHovered?"hovered":"normal"))}onPointerClick(t){var n;rf&&console.trace("Button Click",this.onClick),(n=this.onClick)==null||n.invoke()}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),rf&&console.log(this),this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable)}onEnable(){super.onEnable()}*setAnimatorTriggerAtEndOfFrame(t){var n;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((n=this.animator)==null||n.SetTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=Ee.getComponent(this.gameObject,Cx),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var A,v,b,C,S;t.setInteractable(this.interactable);const n=this.getFinalColor(t.color,(A=this.colors)==null?void 0:A.normalColor),i={state:"normal",attributes:{backgroundColor:n,backgroundOpacity:n.alpha}};t.setupState(i);const r=this.getFinalColor(t.color,(v=this.colors)==null?void 0:v.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};t.setupState(o);const l=this.getFinalColor(t.color,(b=this.colors)==null?void 0:b.pressedColor),h={state:"pressed",attributes:{backgroundColor:l,backgroundOpacity:l.alpha}};t.setupState(h);const u=this.getFinalColor(t.color,(C=this.colors)==null?void 0:C.selectedColor),f={state:"selected",attributes:{backgroundColor:u,backgroundOpacity:u.alpha}};t.setupState(f);const g=this.getFinalColor(t.color,(S=this.colors)==null?void 0:S.disabledColor),m={state:"disabled",attributes:{backgroundColor:g,backgroundOpacity:g.alpha}};t.setupState(m)}getFinalColor(t,n){return n?t.clone().multiply(n):t.clone()}}yp([we(ya)],xh.prototype,"onClick",2);yp([we()],xh.prototype,"colors",2);yp([we()],xh.prototype,"transition",2);yp([we()],xh.prototype,"animationTriggers",2);yp([we(ph)],xh.prototype,"animator",2);yp([we()],xh.prototype,"interactable",1);var lie=Object.defineProperty,hie=Object.getOwnPropertyDescriptor,Ku=(a,e,t,n)=>{for(var i=n>1?void 0:n?hie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&lie(e,t,i),i};const lk=class extends xx{constructor(){super(...arguments);x(this,"_renderOnTop",!1);x(this,"_depthWrite",!1);x(this,"_doubleSided",!0);x(this,"_castShadows",!0);x(this,"_receiveShadows",!0);x(this,"_renderMode",-1);x(this,"_rootCanvas");x(this,"previousAspect",-1);x(this,"_updateRenderSettingsRoutine");x(this,"_activeRenderMode",-1)}set renderOnTop(e){e!==this._renderOnTop&&(this._renderOnTop=e,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop}set depthWrite(e){this._depthWrite!==e&&(this._depthWrite=e,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(e){this._doubleSided!==e&&(this._doubleSided=e,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(e){this._castShadows!==e&&(this._castShadows=e,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(e){this._renderMode!==e&&(this._renderMode=e,this.onRenderSettingsChanged())}set rootCanvas(e){this._rootCanvas instanceof lk||(this._rootCanvas=e)}get rootCanvas(){return this._rootCanvas}awake(){this.shadowComponent=this.gameObject,super.awake()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this.onRenderSettingsChanged()}onBeforeRender(){this.isScreenSpace&&this.context.mainCameraComponent&&this.context.mainCameraComponent.aspect!==this.previousAspect&&(this.previousAspect=this.context.mainCameraComponent.aspect,this.updateRenderMode())}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),qr.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.updateRenderMode(),tv(this.shadowComponent,this);for(const e of this.gameObject.getComponentsInChildren(Zc))tv(e.shadowComponent,this)}}get isScreenSpace(){return this._activeRenderMode===1||this._activeRenderMode===0}updateRenderMode(){if(this.renderMode!==this._activeRenderMode)switch(this.renderMode){case 0:case 1:const e=this.context.mainCameraComponent;if(!e)return;const t=this.gameObject,n=e.gameObject;n==null||n.add(t);const i=e.farClipPlane;t.position.x=0,t.position.y=0,t.position.z=-i;const r=Math.tan(Ci.toRadians(e.fieldOfView)*i)*(e.aspect*1.333333),o=r*(this.context.domHeight/this.context.domWidth);t.scale.x=-r,t.scale.y=o;break}}};let _a=lk;Ku([we()],_a.prototype,"renderOnTop",1);Ku([we()],_a.prototype,"depthWrite",1);Ku([we()],_a.prototype,"doubleSided",1);Ku([we()],_a.prototype,"castShadows",1);Ku([we()],_a.prototype,"receiveShadows",1);Ku([we()],_a.prototype,"renderMode",1);Ku([we(_a)],_a.prototype,"rootCanvas",1);var uie=Object.defineProperty,die=Object.getOwnPropertyDescriptor,x1=(a,e,t,n)=>{for(var i=n>1?void 0:n?die(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&uie(e,t,i),i};class AA extends pt{constructor(){super(...arguments);x(this,"_alpha",1);x(this,"interactable",!0);x(this,"blocksRaycasts",!0);x(this,"_isDirty",!1);x(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),qr.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){for(const t of Ee.getComponentsInChildren(this.gameObject,Ju,this._buffer)){const n=t.color;n.alpha=this._alpha,t.color=n}}}x1([we()],AA.prototype,"alpha",1);x1([we()],AA.prototype,"interactable",2);x1([we()],AA.prototype,"blocksRaycasts",2);var fie=Object.defineProperty,pie=Object.getOwnPropertyDescriptor,sc=(a,e,t,n)=>{for(var i=n>1?void 0:n?pie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&fie(e,t,i),i};const mie=Ct("debugtext");class Jr extends Ju{constructor(){super(...arguments);x(this,"canvas");x(this,"alignment",0);x(this,"verticalOverflow",0);x(this,"horizontalOverflow",0);x(this,"lineSpacing",1);x(this,"supportRichText",!1);x(this,"font");x(this,"fontStyle",0);x(this,"_isWaitingForRebuild",!1);x(this,"_text","");x(this,"_fontSize",12);x(this,"_textMeshUi",null);x(this,"_textContainer",null);x(this,"_didHandleTextRenderOnTop",!1)}get text(){return this._text}set text(t){if(this._text=t,!this._textMeshUi&&this._text.length>0&&this.context.time.frame>0&&this.createText(t,this.getTextOpts(),this.supportRichText),this._textMeshUi){if(this._textMeshUi.length>1){this.requestRebuild();return}this._textMeshUi[0].set({content:t}),this.markDirty()}}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){if(this._fontSize=t,this._textMeshUi){if(this._textMeshUi.length>1){this.requestRebuild();return}this._textMeshUi[0].set({content:t}),this.markDirty()}}onColorChanged(){if(this._textMeshUi){if(this._textMeshUi.length>1){this.requestRebuild();return}const t=this.color;this._textMeshUi[0].set({fontColor:t,fontOpacity:t.alpha}),this.markDirty()}}requestRebuild(){this._isWaitingForRebuild||(this._isWaitingForRebuild=!0,this.startCoroutine(this.rebuildDelayedRoutine(),qr.EarlyUpdate))}*rebuildDelayedRoutine(){if(this._isWaitingForRebuild=!1,this._textMeshUi){for(const t of this._textMeshUi)t.removeFromParent();this._textMeshUi.length=0}this.createText(this.text,this.getTextOpts(),this.supportRichText),this.markDirty()}onCreate(t){mie&&console.log(this);const n=this.verticalOverflow==0&&this.horizontalOverflow==0;n&&(this.context.renderer.localClippingEnabled=!0);const i=this.rectTransform;this._textContainer=this.uiObject=this.createBlock(i,n,null,!0),this.createText(this.text,this.getTextOpts(),this.supportRichText),this.uiObject,this.uiObject=this.createBlock(i,n,this.uiObject,!1)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){var n;const t={content:this.text,fontColor:this.color,fontOpacity:this.color.alpha,fontSize:this.fontSize,fontKerning:"normal"};return this.font=(n=this.font)==null?void 0:n.toLocaleLowerCase(),this.setFont(t,this.fontStyle),t}onEnable(){super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&(this.uiObject.onAfterUpdate=this.updateWidth.bind(this))}createBlock(t,n,i,r=!1){const o={};o.hiddenOverflow=n,o.interLine=(this.lineSpacing-1)*this.fontSize*1.333,this.getAlignment(o,r);const l=t.createNewBlock(o);return i&&(Array.isArray(i)?l.add(...i):l.add(i)),l}getAlignment(t,n=!1){switch(n||(t.contentDirection="row"),this.alignment){default:case 0:case 1:case 2:t.justifyContent="start";break;case 3:case 4:case 5:t.justifyContent="center";break;case 6:case 7:case 8:t.justifyContent="end";break}switch(this.alignment){case 0:case 3:case 6:t.alignContent=n?"left":"top";break;case 1:case 4:case 7:t.alignContent="center";break;case 2:case 5:case 8:t.alignContent=n?"right":"bottom";break}return t}updateWidth(){this.horizontalOverflow===1&&setTimeout(()=>{if(!this._textMeshUi)return;const t=this._textMeshUi[0].parent;if(!!t&&t.lines){let n=t.lines.reduce((i,r)=>i+r.width,0);n+=t.getFontSize()*5,n+=t.padding*2||0,n+=this.fontSize*1.5,t.set({width:n}),this.ensureShadowComponentOwner()}},1)}ensureShadowComponentOwner(){this.shadowComponent&&this.shadowComponent.traverse(t=>{t.shadowComponentOwner===void 0&&(t.shadowComponentOwner=this)})}createText(t,n,i){if(!(!t||t.length<=0))if(this._textMeshUi||(this._textMeshUi=[]),i){let r=this.getNextTag(t);if(r)r.startIndex>0&&this.createText(t.substring(0,r.startIndex),n,!1);else return this.createText(t,n,!1);const o=[];for(;r;){const l=this.getNextTag(t,r.endIndex);if(l){const h=this.getText(t,r,l);this.handleTag(r,n,o),this.createText(h,n,!1)}else{const h=t.substring(r.endIndex);this.handleTag(r,n,o),this.createText(h,n,!1)}r=l}}else{const r={...n};r.content=t;const o=new sk(r);this._textMeshUi.push(o),this._textContainer&&this._textContainer.add(o)}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],n=this.canvas,i={renderOnTop:n.renderOnTop,depthWrite:n.depthWrite,doubleSided:n.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(t[o]===!0)continue;r=!0;const l=this._textMeshUi[o];!l.textContent||(tv(l,i),t[o]=!0)}if(!r)break;yield}}handleTag(t,n,i){if(t.isEndTag){if(i.length>0){const r=i.pop();if(r)for(const o in r.previousValues){const l=r.previousValues[o];n[o]=l}}}else if(t.type.includes("color")){const r=new bC(t,{fontColor:n.fontColor});if(i.push(r),t.type.length>6){const o=t.type.substring(6);n.fontColor=gie(o)}else n.fontColor=new ye(1,1,1)}else if(t.type=="b"){const r=new bC(t,{fontFamily:n.fontFamily,fontTexture:n.fontTexture});i.push(r),this.setFont(n,1)}else if(t.type=="i"){const r=new bC(t,{fontFamily:n.fontFamily,fontTexture:n.fontTexture});i.push(r),this.setFont(n,2)}}getText(t,n,i){return t.substring(n.endIndex,i.startIndex)}getNextTag(t,n=0){const i=t.indexOf("<",n),r=t.indexOf(">",i);if(i>=0&&r>=0){const o=t.substring(i+1,r);return{type:o,startIndex:i,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(t,n){const i=this.getFontName(n);let r=i;r!=null&&r.endsWith("-msdf.json")||(r+="-msdf.json"),t.fontFamily=r;let o=i;o!=null&&o.endsWith(".png")||(o+=".png"),t.fontTexture=o}getFontName(t){return this.font?(this.font=Kg(this.sourceId,this.font),this.font):null}}sc([we(_a)],Jr.prototype,"canvas",2);sc([we()],Jr.prototype,"alignment",2);sc([we()],Jr.prototype,"verticalOverflow",2);sc([we()],Jr.prototype,"horizontalOverflow",2);sc([we()],Jr.prototype,"lineSpacing",2);sc([we()],Jr.prototype,"supportRichText",2);sc([we()],Jr.prototype,"font",2);sc([we()],Jr.prototype,"fontStyle",2);sc([we()],Jr.prototype,"text",1);sc([we()],Jr.prototype,"fontSize",1);class bC{constructor(e,t){x(this,"tag");x(this,"previousValues");this.tag=e,this.previousValues=t}}function gie(a){if(a.startsWith("#")){const t=a.substring(1);var e=parseInt(t,16);const n=e>>16&255,i=e>>8&255,r=e&255;return new ye(n/255,i/255,r/255)}switch(a){case"black":return new ye(0,0,0);case"white":return new ye(1,1,1);case"red":return new ye(1,0,0);case"lime":return new ye(0,1,0);case"blue":return new ye(0,0,1);case"yellow":return new ye(1,1,0);case"cyan":return new ye(0,1,1);case"magenta":return new ye(1,0,1);case"silver":return new ye(.75,.75,.75);case"gray":return new ye(.5,.5,.5);case"maroon":return new ye(.5,0,0);case"olive":return new ye(.5,.5,0);case"green":return new ye(0,.5,0);case"purple":return new ye(.5,0,.5);case"teal":return new ye(0,.5,.5);case"navy":return new ye(0,0,.5);case"darkred":return new ye(.54,0,0);case"brown":return new ye(.55,.27,0);case"firebrick":return new ye(.69,.13,.13);case"crimson":return new ye(.86,.08,.24);case"tomato":return new ye(1,.39,.28);case"coral":return new ye(1,.49,.31);case"indianred":return new ye(.6,.31,.51);case"lightcoral":return new ye(.94,.5,.5);case"darkorange":return new ye(1,.55,0);case"orange":return new ye(1,.65,0);case"gold":return new ye(1,.84,0);case"darkgoldenrod":return new ye(.72,.53,.04);case"goldenrod":return new ye(.85,.65,.13);case"palegoldenrod":return new ye(.93,.87,.67);case"darkkhaki":return new ye(.74,.7,.42);case"khaki":return new ye(.94,.9,.55);case"yellowgreen":return new ye(.6,.8,.19);case"darkolivegreen":return new ye(.33,.42,.18);case"olivedrab":return new ye(.42,.56,.14);case"lawngreen":return new ye(.49,.99,0);case"chartreuse":return new ye(.5,1,0);case"greenyellow":return new ye(.68,1,.18);case"darkgreen":return new ye(0,.39,0);case"forestgreen":return new ye(.13,.55,.13);case"limegreen":return new ye(.19,.8,.19);case"lightgreen":return new ye(.56,.93,.56);case"palegreen":return new ye(.59,.98,.59);case"darkseagreen":return new ye(.56,.74,.56);case"mediumspringgreen":return new ye(0,.98,.6);case"springgreen":return new ye(0,1,.5);case"seagreen":return new ye(.18,.31,.31);case"mediumaquamarine":return new ye(.4,.8,.66);case"mediumseagreen":return new ye(.24,.7,.44);case"lightseagreen":return new ye(.13,.7,.67);case"darkslategray":return new ye(.18,.31,.31);case"darkcyan":return new ye(0,.55,.55);case"aqua":return new ye(0,1,1);case"lightcyan":return new ye(.8,1,1);case"darkturquoise":return new ye(0,.81,.82);case"turquoise":return new ye(0,.82,.82);case"mediumturquoise":return new ye(.28,.82,.8);case"paleturquoise":return new ye(.68,1,.93);case"aquamarine":return new ye(.5,1,.83);case"powderblue":return new ye(.69,.88,.9);case"cadetblue":return new ye(.37,.62,.63);case"steelblue":return new ye(.27,.51,.71);case"cornflowerblue":return new ye(.39,.58,.93);case"deepskyblue":return new ye(0,.7,1);case"dodgerblue":return new ye(.12,.56,1);case"lightblue":return new ye(.68,.85,.9);case"skyblue":return new ye(.53,.81,.92);case"lightskyblue":return new ye(.53,.81,.98);case"midnightblue":return new ye(.18,.18,.31);case"darkblue":return new ye(0,0,.55);case"mediumblue":return new ye(0,0,.82);case"royalblue":return new ye(.25,.41,.88);case"blueviolet":return new ye(.54,.17,.89);case"indigo":return new ye(.29,0,.51);case"darkslateblue":return new ye(.28,.24,.55);case"slateblue":return new ye(.42,.35,.8);case"mediumslateblue":return new ye(.48,.41,.9);case"mediumpurple":return new ye(.58,.44,.86);case"darkmagenta":return new ye(.55,0,.55);case"darkviolet":return new ye(.58,0,.83);case"darkorchid":return new ye(.6,.2,.8);case"mediumorchid":return new ye(.73,.33,.83);case"thistle":return new ye(.84,.75,.85);case"plum":return new ye(.87,.63,.87);case"violet":return new ye(.93,.51,.93);case"fuchsia":return new ye(1,0,1);case"orchid":return new ye(.85,.44,.84);case"mediumvioletred":return new ye(.78,.08,.52);case"palevioletred":return new ye(.86,.44,.58);case"hotpink":return new ye(1,.4,.71);case"deeppink":return new ye(1,.08,.58);case"lightpink":return new ye(1,.71,.76);case"pink":return new ye(1,.75,.78);case"antiquewhite":return new ye(.98,.92,.84);case"beige":return new ye(.96,.96,.86);case"bisque":return new ye(1,.89,.77);case"blanchedalmond":return new ye(1,.92,.82);case"wheat":return new ye(.96,.87,.87);case"cornsilk":return new ye(1,.97,.86);case"lemonchiffon":return new ye(1,.98,.8);case"lightgoldenrodyellow":return new ye(.98,.98,.82);case"lightyellow":return new ye(1,1,.8);case"saddlebrown":return new ye(.55,.27,.07);case"sienna":return new ye(.63,.32,.18);case"chocolate":return new ye(.82,.41,.12);case"peru":return new ye(.82,.52,.25);case"sandybrown":return new ye(.96,.64,.38);case"burlywood":return new ye(.87,.72,.53);case"tan":return new ye(.82,.71,.55);case"rosybrown":return new ye(.74,.56,.56);case"moccasin":return new ye(1,.89,.71);case"navajowhite":return new ye(1,.87,.68);case"peachpuff":return new ye(1,.85,.73);case"mistyrose":return new ye(1,.89,.88);case"lavenderblush":return new ye(1,.94,.93);case"linen":return new ye(.98,.94,.9);case"oldlace":return new ye(.99,.96,.9);case"papayawhip":return new ye(1,.94,.84);case"seashell":return new ye(1,.96,.93);case"mintcream":return new ye(.98,1,.98);case"slategray":return new ye(.44,.5,.56);case"lightslategray":return new ye(.47,.53,.6);case"lightsteelblue":return new ye(.69,.77,.87);case"lavender":return new ye(.9,.9,.98);case"floralwhite":return new ye(1,.98,.98);case"aliceblue":return new ye(.94,.97,1);case"ghostwhite":return new ye(.97,.97,1);case"honeydew":return new ye(.94,1,.94);case"ivory":return new ye(1,1,.94);case"azure":return new ye(.94,1,1);case"snow":return new ye(1,.98,.98);case"dimgray":return new ye(.4,.4,.4);case"darkgray":return new ye(.66,.66,.66);case"lightgray":return new ye(.83,.83,.83);case"gainsboro":return new ye(.86,.86,.86);case"whitesmoke":return new ye(.96,.96,.96)}return new ye(1,1,1)}var Aie=Object.defineProperty,yie=Object.getOwnPropertyDescriptor,Ex=(a,e,t,n)=>{for(var i=n>1?void 0:n?yie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Aie(e,t,i),i};const ru=Ct("debuginputfield");var Lm;const jn=(Lm=class extends pt{constructor(){super(...arguments);x(this,"textComponent");x(this,"placeholder");x(this,"onValueChanged");x(this,"onEndEdit");x(this,"inputEventFn")}get text(){var e,t;return(t=(e=this.textComponent)==null?void 0:e.text)!=null?t:""}get isFocused(){return jn.active===this}start(){ru&&console.log(this.name,this)}onEnable(){var e;jn.htmlField||(jn.htmlField=document.createElement("input"),jn.htmlField.classList.add("ar"),document.body.appendChild(jn.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),jn.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((e=this.textComponent)==null?void 0:e.text.length)&&Ee.setActive(this.placeholder.gameObject,!1)}onDisable(){var e;(e=jn.htmlField)==null||e.removeEventListener("keyup",this.inputEventFn),this.onDeselected()}onPointerClick(e){ru&&console.log("CLICK",e,jn.active),jn.activeTime=this.context.time.time,jn.active!==this&&this.startCoroutine(this.activeLoop(),qr.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();jn.active===this&&!(this.context.input.getPointerUp(0)&&this.context.time.time-jn.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var e,t,n,i;if(jn.active!==this&&(ru&&console.log("Select",this.name,this,jn.htmlField,this.context.isInXR,this.context.arOverlayElement,(e=this.textComponent)==null?void 0:e.text,(t=jn.htmlField)==null?void 0:t.value),(n=jn.active)==null||n.onDeselected(),jn.active=this,this.placeholder&&Ee.setActive(this.placeholder.gameObject,!1),jn.htmlField)){if(jn.htmlField.value=((i=this.textComponent)==null?void 0:i.text)||"",ru&&console.log("set input field value",jn.htmlField.value),this.context.isInXR){const r=this.context.arOverlayElement;r&&(jn.htmlField.style.width="0px",jn.htmlField.style.height="0px",r.append(jn.htmlField))}this.selectInputField()}}onDeselected(){var e;jn.active===this&&(jn.active=null,ru&&console.log("Deselect",this.name,this),jn.htmlField&&(jn.htmlField.blur(),document.body.append(jn.htmlField),jn.htmlField.style.width="",jn.htmlField.style.height=""),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&Ee.setActive(this.placeholder.gameObject,!0),(e=this.onEndEdit)==null||e.invoke())}onInput(e){var t,n;if(jn.active===this){if(ru&&console.log(e.code,e,(t=jn.htmlField)==null?void 0:t.value,(n=this.textComponent)==null?void 0:n.text),e.code==="Escape"||e.code==="Enter"){this.onDeselected();return}jn.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&Ee.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var e;if(this.textComponent&&jn.htmlField){if(this.textComponent.text!==jn.htmlField.value){ru&&console.log("VALUE CHANGED");const t=this.textComponent.text,n=jn.htmlField.value;(e=this.onValueChanged)==null||e.invoke(n,t)}this.textComponent.text=jn.htmlField.value}}selectInputField(){jn.htmlField&&(jn.htmlField.setSelectionRange(jn.htmlField.value.length,jn.htmlField.value.length),jn.htmlField.focus())}},x(Lm,"active",null),x(Lm,"activeTime",-1),x(Lm,"htmlField",null),Lm);let _p=jn;Ex([we(Jr)],_p.prototype,"textComponent",2);Ex([we(Jr)],_p.prototype,"placeholder",2);Ex([we(ya)],_p.prototype,"onValueChanged",2);Ex([we(ya)],_p.prototype,"onEndEdit",2);var hk=(a=>(a[a.fr=0]="fr",a[a.ru=1]="ru",a[a.de=2]="de",a[a.es=3]="es",a[a.el=4]="el",a[a.nord=5]="nord",a[a.eng=6]="eng",a))(hk||{});class uk extends Zc{constructor(){super(...arguments);x(this,"font");x(this,"text");x(this,"keymap");x(this,"padding");x(this,"margin");x(this,"fontSize");x(this,"borderRadius");x(this,"colors",{keyboardBack:8750469,panelBack:2500134,button:3552822,hovered:1842204,selected:1088605});x(this,"keyboard",null);x(this,"_lastKeyPressed");x(this,"_lastKeyPressedStartTime",0);x(this,"_lastKeyPressedTime",0)}awake(){super.awake();const t=hk[this.keymap||6];this.makeKeyboard(t)}onEnable(){this.addShadowComponent(this.keyboard)}onDisable(){this.removeShadowComponent()}makeKeyboard(t){!t&&!navigator.language&&(t="en");const n=this.font?this.font:"arial",i=this.gameObject.getComponent(vh);if(!i){console.error("Missing rect transform, please add this component inside a canvas");return}const r={...i.getBasicOptions(),margin:this.margin||0,padding:this.padding||0,language:t,fontFamily:Rm+"/"+n+"-msdf.json",fontTexture:Rm+"/"+n+".png",fontSize:this.fontSize||6,backgroundColor:new ye(this.colors.keyboardBack),backspaceTexture:Rm+"/backspace.png",shiftTexture:Rm+"/shift.png",enterTexture:Rm+"/enter.png",borderRadius:this.borderRadius||0,autoLayout:!1},o=this.gameObject.scale;r.width*=this.gameObject.scale.x,r.height*=this.gameObject.scale.y,r.fontSize*=Math.max(o.x,o.y),this.keyboard=new ik(r),this.gameObject.scale.set(1,1,1),this.keyboard.keys.forEach(l=>{l.setupState({state:"normal",attributes:{offset:.003,backgroundColor:new ye(this.colors.button),backgroundOpacity:1}}),l.setState("normal"),l.setupState({state:"hovered",attributes:{offset:.3,backgroundColor:new ye(this.colors.hovered),backgroundOpacity:1}}),l.setupState({state:"pressed",attributes:{offset:.1,backgroundColor:new ye(this.colors.selected),backgroundOpacity:1},onSet:()=>{var f,g,m;const h=l.info.input,u=l.info.command;if(this._lastKeyPressed!==h)this._lastKeyPressedStartTime=this.context.time.time;else if(this.context.time.time-this._lastKeyPressedTime>.05)this._lastKeyPressedStartTime=this.context.time.time;else if(this.context.time.time-this._lastKeyPressedStartTime<.5||u=="switch"||u=="shift"||u=="switch-set"){this._lastKeyPressedTime=this.context.time.time;return}if(this._lastKeyPressedTime=this.context.time.time,this._lastKeyPressed=h,u)switch(u){case"switch":this.keyboard.setNextPanel();break;case"switch-set":this.keyboard.setNextCharset();break;case"enter":this.tryAppend(`
`);break;case"space":this.tryAppend(" ");break;case"backspace":if(!((g=(f=this.text)==null?void 0:f.text)!=null&&g.length))break;(m=this.text)!=null&&m.text&&(this.text.text=this.text.text.substring(0,this.text.text.length-1)||"");break;case"shift":this.keyboard.toggleCase();break}else l.info.input!==void 0&&this.tryAppend(l.info.input)}})})}tryAppend(t){this.text&&(this.text.text+=t,this.markDirty())}}class yA extends pt{constructor(){super(...arguments);x(this,"reverseArrangement",!1)}}class dk extends yA{}class fk extends yA{}class pk extends yA{}class w1 extends pt{awake(){pa.createIfNoneExists(this.context)}onEnable(){var e;(e=pa.instance)==null||e.register(this)}onDisable(){var e;(e=pa.instance)==null||e.unregister(this)}performRaycast(e=null){return null}}class Sg extends w1{constructor(){super(...arguments);x(this,"targets",null);x(this,"raycastHits",[])}start(){this.targets=[this.gameObject]}performRaycast(t=null){return this.targets?(t!=null||(t=new nc),t.targets=this.targets,t.results=this.raycastHits,this.context.physics.raycast(t)):null}}class mk extends Sg{constructor(){super(...arguments);x(this,"eventCamera",null);x(this,"ignoreReversedGraphics",!1);x(this,"rootRaycaster",null)}}class _ie extends _t{constructor(e){const t=new vie(e),n=new Yr(t.image.width*.001,t.image.height*.001),i=new Hi({map:t,toneMapped:!1,transparent:!0});super(n,i);function r(o){i.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){n.dispose(),i.dispose(),i.map.dispose(),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class vie extends bS{constructor(e){super(bL(e)),this.dom=e,this.anisotropy=16,this.encoding=Gn,this.minFilter=vi,this.magFilter=vi;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),n={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,n),this.observer=t}dispatchDOMEvent(e){e.data&&xie(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=bL(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const wL=new WeakMap;function bL(a){const e=document.createRange(),t=new ye;function n(m){const A=[];let v=!1;function b(){if(v&&(v=!1,m.restore()),A.length===0)return;let C=-1/0,S=-1/0,I=1/0,M=1/0;for(let R=0;R<A.length;R++){const T=A[R];C=Math.max(C,T.x),S=Math.max(S,T.y),I=Math.min(I,T.x+T.width),M=Math.min(M,T.y+T.height)}m.save(),m.beginPath(),m.rect(C,S,I-C,M-S),m.clip(),v=!0}return{add:function(C){A.push(C),b()},remove:function(){A.pop(),b()}}}function i(m,A,v,b){b!==""&&(m.textTransform==="uppercase"&&(b=b.toUpperCase()),f.font=m.fontWeight+" "+m.fontSize+" "+m.fontFamily,f.textBaseline="top",f.fillStyle=m.color,f.fillText(b,A,v+parseFloat(m.fontSize)*.1))}function r(m,A,v,b,C){v<2*C&&(C=v/2),b<2*C&&(C=b/2),f.beginPath(),f.moveTo(m+C,A),f.arcTo(m+v,A,m+v,A+b,C),f.arcTo(m+v,A+b,m,A+b,C),f.arcTo(m,A+b,m,A,C),f.arcTo(m,A,m+v,A,C),f.closePath()}function o(m,A,v,b,C,S){const I=m[A+"Width"],M=m[A+"Style"],R=m[A+"Color"];I!=="0px"&&M!=="none"&&R!=="transparent"&&R!=="rgba(0, 0, 0, 0)"&&(f.strokeStyle=R,f.lineWidth=parseFloat(I),f.beginPath(),f.moveTo(v,b),f.lineTo(v+C,b+S),f.stroke())}function l(m,A){let v=0,b=0,C=0,S=0;if(m.nodeType===Node.TEXT_NODE){e.selectNode(m);const M=e.getBoundingClientRect();v=M.left-h.left-.5,b=M.top-h.top-.5,C=M.width,S=M.height,i(A,v,b,m.nodeValue.trim())}else{if(m.nodeType===Node.COMMENT_NODE)return;if(m instanceof HTMLCanvasElement){if(m.style.display==="none")return;f.save();const M=window.devicePixelRatio;f.scale(1/M,1/M),f.drawImage(m,0,0),f.restore()}else{if(m.style.display==="none")return;const M=m.getBoundingClientRect();v=M.left-h.left-.5,b=M.top-h.top-.5,C=M.width,S=M.height,A=window.getComputedStyle(m),r(v,b,C,S,parseFloat(A.borderRadius));const R=A.backgroundColor;R!=="transparent"&&R!=="rgba(0, 0, 0, 0)"&&(f.fillStyle=R,f.fill());const T=["borderTop","borderLeft","borderBottom","borderRight"];let B=!0,F=null;for(const D of T){if(F!==null&&(B=A[D+"Width"]===A[F+"Width"]&&A[D+"Color"]===A[F+"Color"]&&A[D+"Style"]===A[F+"Style"]),B===!1)break;F=D}if(B===!0){const D=parseFloat(A.borderTopWidth);A.borderTopWidth!=="0px"&&A.borderTopStyle!=="none"&&A.borderTopColor!=="transparent"&&A.borderTopColor!=="rgba(0, 0, 0, 0)"&&(f.strokeStyle=A.borderTopColor,f.lineWidth=D,f.stroke())}else o(A,"borderTop",v,b,C,0),o(A,"borderLeft",v,b,0,S),o(A,"borderBottom",v,b+S,C,0),o(A,"borderRight",v+C,b,0,S);if(m instanceof HTMLInputElement){let D=A.accentColor;(D===void 0||D==="auto")&&(D=A.color),t.set(D);const W=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(m.type==="radio"&&(r(v,b,C,S,S),f.fillStyle="white",f.strokeStyle=D,f.lineWidth=1,f.fill(),f.stroke(),m.checked&&(r(v+2,b+2,C-4,S-4,S),f.fillStyle=D,f.strokeStyle=W,f.lineWidth=2,f.fill(),f.stroke())),m.type==="checkbox"&&(r(v,b,C,S,2),f.fillStyle=m.checked?D:"white",f.strokeStyle=m.checked?W:D,f.lineWidth=1,f.stroke(),f.fill(),m.checked)){const J=f.textAlign;f.textAlign="center";const ee={color:W,fontFamily:A.fontFamily,fontSize:S+"px",fontWeight:"bold"};i(ee,v+C/2,b,"\u2714"),f.textAlign=J}if(m.type==="range"){const[J,ee,Q]=["min","max","value"].map(se=>parseFloat(m[se])),Y=(Q-J)/(ee-J)*(C-S);r(v,b+S/4,C,S/2,S/4),f.fillStyle=W,f.strokeStyle=D,f.lineWidth=1,f.fill(),f.stroke(),r(v,b+S/4,Y+S/2,S/2,S/4),f.fillStyle=D,f.fill(),r(v+Y,b,S,S,S/2),f.fillStyle=D,f.fill()}(m.type==="color"||m.type==="text"||m.type==="number")&&(g.add({x:v,y:b,width:C,height:S}),i(A,v+parseInt(A.paddingLeft),b+parseInt(A.paddingTop),m.value),g.remove())}}}const I=A.overflow==="auto"||A.overflow==="hidden";I&&g.add({x:v,y:b,width:C,height:S});for(let M=0;M<m.childNodes.length;M++)l(m.childNodes[M],A);I&&g.remove()}const h=a.getBoundingClientRect();let u=wL.get(a);u===void 0&&(u=document.createElement("canvas"),u.width=h.width,u.height=h.height,wL.set(a,u));const f=u.getContext("2d"),g=new n(f);return l(a),u}function xie(a,e,t,n){const i={clientX:t*a.offsetWidth+a.offsetLeft,clientY:n*a.offsetHeight+a.offsetTop,view:a.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,i));const r=a.getBoundingClientRect();t=t*r.width+r.left,n=n*r.height+r.top;function o(l){if(l.nodeType!==Node.TEXT_NODE&&l.nodeType!==Node.COMMENT_NODE){const h=l.getBoundingClientRect();if(t>h.left&&t<h.right&&n>h.top&&n<h.bottom&&(l.dispatchEvent(new MouseEvent(e,i)),l instanceof HTMLInputElement&&l.type==="range"&&(e==="mousedown"||e==="click"))){const[u,f]=["min","max"].map(v=>parseFloat(l[v])),g=h.width,A=(t-h.x)/g;l.value=u+(f-u)*A,l.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let u=0;u<l.childNodes.length;u++)o(l.childNodes[u])}}o(a)}const f_=new Xe,of={type:"",data:f_};class wie extends ua{constructor(e,t){super();const n=this,i=new ju,r=new fn,o=e.domElement;function l(m){m.stopPropagation();const A=e.domElement.getBoundingClientRect();f_.x=(m.clientX-A.left)/A.width*2-1,f_.y=-(m.clientY-A.top)/A.height*2+1,i.setFromCamera(f_,t);const v=i.intersectObjects(n.children,!1);if(v.length>0){const b=v[0],C=b.object,S=b.uv;of.type=m.type,of.data.set(S.x,1-S.y),C.dispatchEvent(of)}}o.addEventListener("pointerdown",l),o.addEventListener("pointerup",l),o.addEventListener("pointermove",l),o.addEventListener("mousedown",l),o.addEventListener("mouseup",l),o.addEventListener("mousemove",l),o.addEventListener("click",l);const h={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function u(m){const A=m.target;r.identity().extractRotation(A.matrixWorld),i.ray.origin.setFromMatrixPosition(A.matrixWorld),i.ray.direction.set(0,0,-1).applyMatrix4(r);const v=i.intersectObjects(n.children,!1);if(v.length>0){const b=v[0],C=b.object,S=b.uv;of.type=h[m.type],of.data.set(S.x,1-S.y),C.dispatchEvent(of)}}const f=e.xr.getController(0);f.addEventListener("move",u),f.addEventListener("select",u),f.addEventListener("selectstart",u),f.addEventListener("selectend",u);const g=e.xr.getController(1);g.addEventListener("move",u),g.addEventListener("select",u),g.addEventListener("selectstart",u),g.addEventListener("selectend",u)}}class gk extends pt{constructor(){super(...arguments);x(this,"id",null);x(this,"keepAspect",!1)}start(){if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const n=new wie(this.context.renderer,this.context.mainCamera);this.gameObject.add(n);const i=new _ie(t);n.add(i),i.visible=!1,console.log(i);const r=i.material;r.transparent=!0,setTimeout(()=>{i.visible=!0;const o=ND(this.gameObject).clone();UD(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const l=new Rr;l.setFromObject(n),this.setWorldRotation(o.x,o.y,o.z);const h=l.max.x-l.min.x,u=l.max.y-l.min.y;if(this.keepAspect){const g=h/u;h>u?i.scale.set(1/h,1/u/g,1):i.scale.set(1/h*g,1/u,1)}else i.scale.set(1/h,1/u,1);const f=this.gameObject.scale;i.scale.multiply(f)},1)}}class Ak{}const bie=Object.freeze(Object.defineProperty({__proto__:null,__Ignore:Ak,AlignmentConstraint:jv,Animation:Yl,AnimationCurve:hM,Animator:ph,AnimatorController:Hf,AudioListener:yg,AudioSource:Br,AvatarModel:mM,AvatarLoader:gM,AxesHelper:tA,BasicIKConstraint:rF,BoxHelperComponent:Uc,Camera:qs,Collider:uh,SphereCollider:Ov,BoxCollider:Fv,InstantiateOptions:Go,DeleteBox:yM,Deletable:aF,DeviceFlag:_M,DragControls:Gc,DropListener:Xv,Duplicatable:sp,CallInfo:xg,EventListEvent:bM,EventList:ya,EventTrigger:pF,FlyControls:mF,BoxGizmo:sA,GltfExportBox:xF,GltfExport:Gl,GridHelper:rA,GroundProjectedEnv:oA,Interactable:nA,UsageMarker:iA,Light:Qo,LODModel:rp,LODGroup:Jv,LookAtConstraint:IM,NavMesh:wF,NavMeshAgent:bF,NestedGltf:RM,Networking:Hu,OffsetConstraint:op,OrbitControls:dh,ParticleSystemRenderer:PM,ParticleSystem:MF,MainModule:CF,EmissionModule:EF,ShapeModule:SF,PlayerColor:ah,FieldWithDefault:AF,Renderer:Xs,MeshRenderer:SM,SkinnedMeshRenderer:_F,RendererLightmap:V_,Rigidbody:yr,ScreenCapture:Zv,ShadowCatcher:$v,RemoteSkybox:ex,SmoothFollow:tx,SpatialTriggerReceiver:Wc,SpatialTrigger:nx,SpectatorCamera:y3,SpringJoint:_3,Sprite:QM,SpriteRenderer:fA,SyncedCamera:jM,SyncedRoom:Yu,SyncedTransform:oh,TestRunner:v3,TestSimulateUserData:x3,TransformGizmo:qM,VideoPlayer:Dr,Voip:yh,VolumeParameter:E3,VolumeComponent:mp,ToneMapping:sx,ColorAdjustments:rx,VolumeProfile:ox,Volume:XM,WebARSessionRoot:ip,WebXR:_i,WebAR:If,AvatarMarker:nr,WebXRAvatar:zc,TeleportTarget:vM,WebXRController:Zi,AttachedObject:fa,XRGrabModel:YM,XRGrabRendering:S3,XRRig:xM,VRUserState:Ha,WebXRSync:H_,XRState:Ja,XRFlag:mr,AvatarBlink_Simple:gp,AvatarEyeLook_Rotation:mA,Avatar_POI:Qr,Avatar_Brain_LookAt:z_,Avatar_MouthShapes:cx,Avatar_MustacheShake:I3,LogStats:R3,RGBAColor:fo,PlayableDirector:Bf,SignalAsset:KM,SignalReceiverEvent:ZM,SignalReceiver:lx,AnimationTrackHandler:$M,AudioTrackHandler:e1,SignalTrackHandler:$_,ControlTrackHandler:Pf,BaseUIComponent:Zc,UIRootComponent:xx,Button:xh,Canvas:_a,CanvasGroup:AA,EventSystem:pa,Graphic:Ju,MaskableGraphic:bx,Image:Cx,RawImage:v1,InputField:_p,Keyboard:uk,LayoutGroup:yA,VerticalLayoutGroup:dk,HorizontalLayoutGroup:fk,GridLayoutGroup:pk,PointerEventData:xf,Raycaster:w1,ObjectRaycaster:Sg,GraphicRaycaster:mk,Size:ok,Rect:y1,RectTransform:vh,SpatialHtml:gk,Text:Jr},Symbol.toStringTag,{value:"Module"}));class Cie extends pt{constructor(){super(...arguments);x(this,"toggleKey",Xl.KEY_P)}update(){this.context.input.isKeyDown(Xl.KEY_P)&&this.context.domElement.classList.toggle("presentation-mode")}}var Mg={exports:{}},Z={};/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */var CL;function Eie(){if(CL)return Z;CL=1,Object.defineProperty(Z,"__esModule",{value:!0});const a="145",e={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},n=0,i=1,r=2,o=3,l=0,h=1,u=2,f=3,g=0,m=1,A=2,v=0,b=1,C=2,S=3,I=4,M=5,R=100,T=101,B=102,F=103,D=104,U=200,W=201,J=202,ee=203,Q=204,Y=205,se=206,ae=207,ve=208,xe=209,Ae=210,Ie=0,Le=1,De=2,$e=3,vt=4,zt=5,Ve=6,gn=7,Xt=0,mn=1,Nt=2,vn=0,it=1,tt=2,xt=3,Jt=4,Dt=5,Cn=300,Kt=301,ln=302,ii=303,Kn=304,me=306,ce=1e3,je=1001,yt=1002,mt=1003,Ht=1004,Mn=1004,be=1005,ke=1005,Et=1006,hn=1007,nn=1007,Wt=1008,Ln=1008,Dn=1009,Me=1010,Bt=1011,Ut=1012,Re=1013,Mt=1014,wn=1015,fi=1016,Vi=1017,Kr=1018,xi=1020,Or=1021,Ys=1022,or=1023,ac=1024,wh=1025,yo=1026,Fr=1027,ed=1028,he=1029,Ge=1030,ze=1031,Ne=1033,nt=33776,j=33777,ie=33778,pe=33779,Se=35840,We=35841,Oe=35842,Ke=35843,lt=36196,Tt=37492,ut=37496,wt=37808,Zt=37809,bt=37810,xn=37811,pn=37812,$t=37813,un=37814,Fn=37815,Si=37816,Zn=37817,Wi=37818,pi=37819,In=37820,Di=37821,zs=36492,Yi=2200,wi=2201,Ri=2202,vr=2300,jo=2301,xr=2302,_o=2400,bh=2401,wp=2402,MA=2500,Dx=2501,Hk=0,Vk=1,Wk=2,$c=3e3,es=3001,F1=3200,k1=3201,el=0,N1=1,Qk="",Ca="srgb",tl="srgb-linear",jk=0,TA=7680,qk=7681,Xk=7682,Yk=7683,Jk=34055,Kk=34056,Zk=5386,$k=512,eN=513,tN=514,nN=515,iN=516,sN=517,rN=518,U1=519,bp=35044,oN=35048,aN=35040,cN=35045,lN=35049,hN=35041,uN=35046,dN=35050,fN=35042,pN="100",Ox="300 es",IA=1035;class cc{addEventListener(s,c){this._listeners===void 0&&(this._listeners={});const d=this._listeners;d[s]===void 0&&(d[s]=[]),d[s].indexOf(c)===-1&&d[s].push(c)}hasEventListener(s,c){if(this._listeners===void 0)return!1;const d=this._listeners;return d[s]!==void 0&&d[s].indexOf(c)!==-1}removeEventListener(s,c){if(this._listeners===void 0)return;const p=this._listeners[s];if(p!==void 0){const y=p.indexOf(c);y!==-1&&p.splice(y,1)}}dispatchEvent(s){if(this._listeners===void 0)return;const d=this._listeners[s.type];if(d!==void 0){s.target=this;const p=d.slice(0);for(let y=0,w=p.length;y<w;y++)p[y].call(this,s);s.target=null}}}const ar=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let z1=1234567;const Ch=Math.PI/180,Cp=180/Math.PI;function Zr(){const _=Math.random()*4294967295|0,s=Math.random()*4294967295|0,c=Math.random()*4294967295|0,d=Math.random()*4294967295|0;return(ar[_&255]+ar[_>>8&255]+ar[_>>16&255]+ar[_>>24&255]+"-"+ar[s&255]+ar[s>>8&255]+"-"+ar[s>>16&15|64]+ar[s>>24&255]+"-"+ar[c&63|128]+ar[c>>8&255]+"-"+ar[c>>16&255]+ar[c>>24&255]+ar[d&255]+ar[d>>8&255]+ar[d>>16&255]+ar[d>>24&255]).toLowerCase()}function fs(_,s,c){return Math.max(s,Math.min(c,_))}function Fx(_,s){return(_%s+s)%s}function mN(_,s,c,d,p){return d+(_-s)*(p-d)/(c-s)}function gN(_,s,c){return _!==s?(c-_)/(s-_):0}function Ep(_,s,c){return(1-c)*_+c*s}function AN(_,s,c,d){return Ep(_,s,1-Math.exp(-c*d))}function yN(_,s=1){return s-Math.abs(Fx(_,s*2)-s)}function _N(_,s,c){return _<=s?0:_>=c?1:(_=(_-s)/(c-s),_*_*(3-2*_))}function vN(_,s,c){return _<=s?0:_>=c?1:(_=(_-s)/(c-s),_*_*_*(_*(_*6-15)+10))}function xN(_,s){return _+Math.floor(Math.random()*(s-_+1))}function wN(_,s){return _+Math.random()*(s-_)}function bN(_){return _*(.5-Math.random())}function CN(_){_!==void 0&&(z1=_);let s=z1+=1831565813;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}function EN(_){return _*Ch}function SN(_){return _*Cp}function kx(_){return(_&_-1)===0&&_!==0}function G1(_){return Math.pow(2,Math.ceil(Math.log(_)/Math.LN2))}function RA(_){return Math.pow(2,Math.floor(Math.log(_)/Math.LN2))}function MN(_,s,c,d,p){const y=Math.cos,w=Math.sin,E=y(c/2),P=w(c/2),L=y((s+d)/2),O=w((s+d)/2),k=y((s-d)/2),N=w((s-d)/2),z=y((d-s)/2),V=w((d-s)/2);switch(p){case"XYX":_.set(E*O,P*k,P*N,E*L);break;case"YZY":_.set(P*N,E*O,P*k,E*L);break;case"ZXZ":_.set(P*k,P*N,E*O,E*L);break;case"XZX":_.set(E*O,P*V,P*z,E*L);break;case"YXY":_.set(P*z,E*O,P*V,E*L);break;case"ZYZ":_.set(P*V,P*z,E*O,E*L);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+p)}}function lc(_,s){switch(s.constructor){case Float32Array:return _;case Uint16Array:return _/65535;case Uint8Array:return _/255;case Int16Array:return Math.max(_/32767,-1);case Int8Array:return Math.max(_/127,-1);default:throw new Error("Invalid component type.")}}function Oi(_,s){switch(s.constructor){case Float32Array:return _;case Uint16Array:return Math.round(_*65535);case Uint8Array:return Math.round(_*255);case Int16Array:return Math.round(_*32767);case Int8Array:return Math.round(_*127);default:throw new Error("Invalid component type.")}}var TN=Object.freeze({__proto__:null,DEG2RAD:Ch,RAD2DEG:Cp,generateUUID:Zr,clamp:fs,euclideanModulo:Fx,mapLinear:mN,inverseLerp:gN,lerp:Ep,damp:AN,pingpong:yN,smoothstep:_N,smootherstep:vN,randInt:xN,randFloat:wN,randFloatSpread:bN,seededRandom:CN,degToRad:EN,radToDeg:SN,isPowerOfTwo:kx,ceilPowerOfTwo:G1,floorPowerOfTwo:RA,setQuaternionFromProperEuler:MN,normalize:Oi,denormalize:lc});class gt{constructor(s=0,c=0){gt.prototype.isVector2=!0,this.x=s,this.y=c}get width(){return this.x}set width(s){this.x=s}get height(){return this.y}set height(s){this.y=s}set(s,c){return this.x=s,this.y=c,this}setScalar(s){return this.x=s,this.y=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setComponent(s,c){switch(s){case 0:this.x=c;break;case 1:this.y=c;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y)}copy(s){return this.x=s.x,this.y=s.y,this}add(s){return this.x+=s.x,this.y+=s.y,this}addScalar(s){return this.x+=s,this.y+=s,this}addVectors(s,c){return this.x=s.x+c.x,this.y=s.y+c.y,this}addScaledVector(s,c){return this.x+=s.x*c,this.y+=s.y*c,this}sub(s){return this.x-=s.x,this.y-=s.y,this}subScalar(s){return this.x-=s,this.y-=s,this}subVectors(s,c){return this.x=s.x-c.x,this.y=s.y-c.y,this}multiply(s){return this.x*=s.x,this.y*=s.y,this}multiplyScalar(s){return this.x*=s,this.y*=s,this}divide(s){return this.x/=s.x,this.y/=s.y,this}divideScalar(s){return this.multiplyScalar(1/s)}applyMatrix3(s){const c=this.x,d=this.y,p=s.elements;return this.x=p[0]*c+p[3]*d+p[6],this.y=p[1]*c+p[4]*d+p[7],this}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this}clamp(s,c){return this.x=Math.max(s.x,Math.min(c.x,this.x)),this.y=Math.max(s.y,Math.min(c.y,this.y)),this}clampScalar(s,c){return this.x=Math.max(s,Math.min(c,this.x)),this.y=Math.max(s,Math.min(c,this.y)),this}clampLength(s,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(s,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(s){return this.x*s.x+this.y*s.y}cross(s){return this.x*s.y-this.y*s.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(s){return Math.sqrt(this.distanceToSquared(s))}distanceToSquared(s){const c=this.x-s.x,d=this.y-s.y;return c*c+d*d}manhattanDistanceTo(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,c){return this.x+=(s.x-this.x)*c,this.y+=(s.y-this.y)*c,this}lerpVectors(s,c,d){return this.x=s.x+(c.x-s.x)*d,this.y=s.y+(c.y-s.y)*d,this}equals(s){return s.x===this.x&&s.y===this.y}fromArray(s,c=0){return this.x=s[c],this.y=s[c+1],this}toArray(s=[],c=0){return s[c]=this.x,s[c+1]=this.y,s}fromBufferAttribute(s,c){return this.x=s.getX(c),this.y=s.getY(c),this}rotateAround(s,c){const d=Math.cos(c),p=Math.sin(c),y=this.x-s.x,w=this.y-s.y;return this.x=y*d-w*p+s.x,this.y=y*p+w*d+s.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class kr{constructor(){kr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(s,c,d,p,y,w,E,P,L){const O=this.elements;return O[0]=s,O[1]=p,O[2]=E,O[3]=c,O[4]=y,O[5]=P,O[6]=d,O[7]=w,O[8]=L,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(s){const c=this.elements,d=s.elements;return c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],this}extractBasis(s,c,d){return s.setFromMatrix3Column(this,0),c.setFromMatrix3Column(this,1),d.setFromMatrix3Column(this,2),this}setFromMatrix4(s){const c=s.elements;return this.set(c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]),this}multiply(s){return this.multiplyMatrices(this,s)}premultiply(s){return this.multiplyMatrices(s,this)}multiplyMatrices(s,c){const d=s.elements,p=c.elements,y=this.elements,w=d[0],E=d[3],P=d[6],L=d[1],O=d[4],k=d[7],N=d[2],z=d[5],V=d[8],H=p[0],G=p[3],X=p[6],K=p[1],ne=p[4],te=p[7],oe=p[2],ue=p[5],Ce=p[8];return y[0]=w*H+E*K+P*oe,y[3]=w*G+E*ne+P*ue,y[6]=w*X+E*te+P*Ce,y[1]=L*H+O*K+k*oe,y[4]=L*G+O*ne+k*ue,y[7]=L*X+O*te+k*Ce,y[2]=N*H+z*K+V*oe,y[5]=N*G+z*ne+V*ue,y[8]=N*X+z*te+V*Ce,this}multiplyScalar(s){const c=this.elements;return c[0]*=s,c[3]*=s,c[6]*=s,c[1]*=s,c[4]*=s,c[7]*=s,c[2]*=s,c[5]*=s,c[8]*=s,this}determinant(){const s=this.elements,c=s[0],d=s[1],p=s[2],y=s[3],w=s[4],E=s[5],P=s[6],L=s[7],O=s[8];return c*w*O-c*E*L-d*y*O+d*E*P+p*y*L-p*w*P}invert(){const s=this.elements,c=s[0],d=s[1],p=s[2],y=s[3],w=s[4],E=s[5],P=s[6],L=s[7],O=s[8],k=O*w-E*L,N=E*P-O*y,z=L*y-w*P,V=c*k+d*N+p*z;if(V===0)return this.set(0,0,0,0,0,0,0,0,0);const H=1/V;return s[0]=k*H,s[1]=(p*L-O*d)*H,s[2]=(E*d-p*w)*H,s[3]=N*H,s[4]=(O*c-p*P)*H,s[5]=(p*y-E*c)*H,s[6]=z*H,s[7]=(d*P-L*c)*H,s[8]=(w*c-d*y)*H,this}transpose(){let s;const c=this.elements;return s=c[1],c[1]=c[3],c[3]=s,s=c[2],c[2]=c[6],c[6]=s,s=c[5],c[5]=c[7],c[7]=s,this}getNormalMatrix(s){return this.setFromMatrix4(s).invert().transpose()}transposeIntoArray(s){const c=this.elements;return s[0]=c[0],s[1]=c[3],s[2]=c[6],s[3]=c[1],s[4]=c[4],s[5]=c[7],s[6]=c[2],s[7]=c[5],s[8]=c[8],this}setUvTransform(s,c,d,p,y,w,E){const P=Math.cos(y),L=Math.sin(y);return this.set(d*P,d*L,-d*(P*w+L*E)+w+s,-p*L,p*P,-p*(-L*w+P*E)+E+c,0,0,1),this}scale(s,c){const d=this.elements;return d[0]*=s,d[3]*=s,d[6]*=s,d[1]*=c,d[4]*=c,d[7]*=c,this}rotate(s){const c=Math.cos(s),d=Math.sin(s),p=this.elements,y=p[0],w=p[3],E=p[6],P=p[1],L=p[4],O=p[7];return p[0]=c*y+d*P,p[3]=c*w+d*L,p[6]=c*E+d*O,p[1]=-d*y+c*P,p[4]=-d*w+c*L,p[7]=-d*E+c*O,this}translate(s,c){const d=this.elements;return d[0]+=s*d[2],d[3]+=s*d[5],d[6]+=s*d[8],d[1]+=c*d[2],d[4]+=c*d[5],d[7]+=c*d[8],this}equals(s){const c=this.elements,d=s.elements;for(let p=0;p<9;p++)if(c[p]!==d[p])return!1;return!0}fromArray(s,c=0){for(let d=0;d<9;d++)this.elements[d]=s[d+c];return this}toArray(s=[],c=0){const d=this.elements;return s[c]=d[0],s[c+1]=d[1],s[c+2]=d[2],s[c+3]=d[3],s[c+4]=d[4],s[c+5]=d[5],s[c+6]=d[6],s[c+7]=d[7],s[c+8]=d[8],s}clone(){return new this.constructor().fromArray(this.elements)}}function H1(_){for(let s=_.length-1;s>=0;--s)if(_[s]>=65535)return!0;return!1}const IN={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function td(_,s){return new IN[_](s)}function Sp(_){return document.createElementNS("http://www.w3.org/1999/xhtml",_)}function Eh(_){return _<.04045?_*.0773993808:Math.pow(_*.9478672986+.0521327014,2.4)}function PA(_){return _<.0031308?_*12.92:1.055*Math.pow(_,.41666)-.055}const Nx={[Ca]:{[tl]:Eh},[tl]:{[Ca]:PA}},vo={legacyMode:!0,get workingColorSpace(){return tl},set workingColorSpace(_){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(_,s,c){if(this.legacyMode||s===c||!s||!c)return _;if(Nx[s]&&Nx[s][c]!==void 0){const d=Nx[s][c];return _.r=d(_.r),_.g=d(_.g),_.b=d(_.b),_}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(_,s){return this.convert(_,this.workingColorSpace,s)},toWorkingColorSpace:function(_,s){return this.convert(_,s,this.workingColorSpace)}},V1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Is={r:0,g:0,b:0},qo={h:0,s:0,l:0},BA={h:0,s:0,l:0};function Ux(_,s,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?_+(s-_)*6*c:c<1/2?s:c<2/3?_+(s-_)*6*(2/3-c):_}function LA(_,s){return s.r=_.r,s.g=_.g,s.b=_.b,s}class dn{constructor(s,c,d){return this.isColor=!0,this.r=1,this.g=1,this.b=1,c===void 0&&d===void 0?this.set(s):this.setRGB(s,c,d)}set(s){return s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s),this}setScalar(s){return this.r=s,this.g=s,this.b=s,this}setHex(s,c=Ca){return s=Math.floor(s),this.r=(s>>16&255)/255,this.g=(s>>8&255)/255,this.b=(s&255)/255,vo.toWorkingColorSpace(this,c),this}setRGB(s,c,d,p=tl){return this.r=s,this.g=c,this.b=d,vo.toWorkingColorSpace(this,p),this}setHSL(s,c,d,p=tl){if(s=Fx(s,1),c=fs(c,0,1),d=fs(d,0,1),c===0)this.r=this.g=this.b=d;else{const y=d<=.5?d*(1+c):d+c-d*c,w=2*d-y;this.r=Ux(w,y,s+1/3),this.g=Ux(w,y,s),this.b=Ux(w,y,s-1/3)}return vo.toWorkingColorSpace(this,p),this}setStyle(s,c=Ca){function d(y){y!==void 0&&parseFloat(y)<1&&console.warn("THREE.Color: Alpha component of "+s+" will be ignored.")}let p;if(p=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(s)){let y;const w=p[1],E=p[2];switch(w){case"rgb":case"rgba":if(y=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E))return this.r=Math.min(255,parseInt(y[1],10))/255,this.g=Math.min(255,parseInt(y[2],10))/255,this.b=Math.min(255,parseInt(y[3],10))/255,vo.toWorkingColorSpace(this,c),d(y[4]),this;if(y=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E))return this.r=Math.min(100,parseInt(y[1],10))/100,this.g=Math.min(100,parseInt(y[2],10))/100,this.b=Math.min(100,parseInt(y[3],10))/100,vo.toWorkingColorSpace(this,c),d(y[4]),this;break;case"hsl":case"hsla":if(y=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E)){const P=parseFloat(y[1])/360,L=parseFloat(y[2])/100,O=parseFloat(y[3])/100;return d(y[4]),this.setHSL(P,L,O,c)}break}}else if(p=/^\#([A-Fa-f\d]+)$/.exec(s)){const y=p[1],w=y.length;if(w===3)return this.r=parseInt(y.charAt(0)+y.charAt(0),16)/255,this.g=parseInt(y.charAt(1)+y.charAt(1),16)/255,this.b=parseInt(y.charAt(2)+y.charAt(2),16)/255,vo.toWorkingColorSpace(this,c),this;if(w===6)return this.r=parseInt(y.charAt(0)+y.charAt(1),16)/255,this.g=parseInt(y.charAt(2)+y.charAt(3),16)/255,this.b=parseInt(y.charAt(4)+y.charAt(5),16)/255,vo.toWorkingColorSpace(this,c),this}return s&&s.length>0?this.setColorName(s,c):this}setColorName(s,c=Ca){const d=V1[s.toLowerCase()];return d!==void 0?this.setHex(d,c):console.warn("THREE.Color: Unknown color "+s),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(s){return this.r=s.r,this.g=s.g,this.b=s.b,this}copySRGBToLinear(s){return this.r=Eh(s.r),this.g=Eh(s.g),this.b=Eh(s.b),this}copyLinearToSRGB(s){return this.r=PA(s.r),this.g=PA(s.g),this.b=PA(s.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(s=Ca){return vo.fromWorkingColorSpace(LA(this,Is),s),fs(Is.r*255,0,255)<<16^fs(Is.g*255,0,255)<<8^fs(Is.b*255,0,255)<<0}getHexString(s=Ca){return("000000"+this.getHex(s).toString(16)).slice(-6)}getHSL(s,c=tl){vo.fromWorkingColorSpace(LA(this,Is),c);const d=Is.r,p=Is.g,y=Is.b,w=Math.max(d,p,y),E=Math.min(d,p,y);let P,L;const O=(E+w)/2;if(E===w)P=0,L=0;else{const k=w-E;switch(L=O<=.5?k/(w+E):k/(2-w-E),w){case d:P=(p-y)/k+(p<y?6:0);break;case p:P=(y-d)/k+2;break;case y:P=(d-p)/k+4;break}P/=6}return s.h=P,s.s=L,s.l=O,s}getRGB(s,c=tl){return vo.fromWorkingColorSpace(LA(this,Is),c),s.r=Is.r,s.g=Is.g,s.b=Is.b,s}getStyle(s=Ca){return vo.fromWorkingColorSpace(LA(this,Is),s),s!==Ca?`color(${s} ${Is.r} ${Is.g} ${Is.b})`:`rgb(${Is.r*255|0},${Is.g*255|0},${Is.b*255|0})`}offsetHSL(s,c,d){return this.getHSL(qo),qo.h+=s,qo.s+=c,qo.l+=d,this.setHSL(qo.h,qo.s,qo.l),this}add(s){return this.r+=s.r,this.g+=s.g,this.b+=s.b,this}addColors(s,c){return this.r=s.r+c.r,this.g=s.g+c.g,this.b=s.b+c.b,this}addScalar(s){return this.r+=s,this.g+=s,this.b+=s,this}sub(s){return this.r=Math.max(0,this.r-s.r),this.g=Math.max(0,this.g-s.g),this.b=Math.max(0,this.b-s.b),this}multiply(s){return this.r*=s.r,this.g*=s.g,this.b*=s.b,this}multiplyScalar(s){return this.r*=s,this.g*=s,this.b*=s,this}lerp(s,c){return this.r+=(s.r-this.r)*c,this.g+=(s.g-this.g)*c,this.b+=(s.b-this.b)*c,this}lerpColors(s,c,d){return this.r=s.r+(c.r-s.r)*d,this.g=s.g+(c.g-s.g)*d,this.b=s.b+(c.b-s.b)*d,this}lerpHSL(s,c){this.getHSL(qo),s.getHSL(BA);const d=Ep(qo.h,BA.h,c),p=Ep(qo.s,BA.s,c),y=Ep(qo.l,BA.l,c);return this.setHSL(d,p,y),this}equals(s){return s.r===this.r&&s.g===this.g&&s.b===this.b}fromArray(s,c=0){return this.r=s[c],this.g=s[c+1],this.b=s[c+2],this}toArray(s=[],c=0){return s[c]=this.r,s[c+1]=this.g,s[c+2]=this.b,s}fromBufferAttribute(s,c){return this.r=s.getX(c),this.g=s.getY(c),this.b=s.getZ(c),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}dn.NAMES=V1;let nd;class zx{static getDataURL(s){if(/^data:/i.test(s.src)||typeof HTMLCanvasElement>"u")return s.src;let c;if(s instanceof HTMLCanvasElement)c=s;else{nd===void 0&&(nd=Sp("canvas")),nd.width=s.width,nd.height=s.height;const d=nd.getContext("2d");s instanceof ImageData?d.putImageData(s,0,0):d.drawImage(s,0,0,s.width,s.height),c=nd}return c.width>2048||c.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",s),c.toDataURL("image/jpeg",.6)):c.toDataURL("image/png")}static sRGBToLinear(s){if(typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap){const c=Sp("canvas");c.width=s.width,c.height=s.height;const d=c.getContext("2d");d.drawImage(s,0,0,s.width,s.height);const p=d.getImageData(0,0,s.width,s.height),y=p.data;for(let w=0;w<y.length;w++)y[w]=Eh(y[w]/255)*255;return d.putImageData(p,0,0),c}else if(s.data){const c=s.data.slice(0);for(let d=0;d<c.length;d++)c instanceof Uint8Array||c instanceof Uint8ClampedArray?c[d]=Math.floor(Eh(c[d]/255)*255):c[d]=Eh(c[d]);return{data:c,width:s.width,height:s.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),s}}class Sh{constructor(s=null){this.isSource=!0,this.uuid=Zr(),this.data=s,this.version=0}set needsUpdate(s){s===!0&&this.version++}toJSON(s){const c=s===void 0||typeof s=="string";if(!c&&s.images[this.uuid]!==void 0)return s.images[this.uuid];const d={uuid:this.uuid,url:""},p=this.data;if(p!==null){let y;if(Array.isArray(p)){y=[];for(let w=0,E=p.length;w<E;w++)p[w].isDataTexture?y.push(Gx(p[w].image)):y.push(Gx(p[w]))}else y=Gx(p);d.url=y}return c||(s.images[this.uuid]=d),d}}function Gx(_){return typeof HTMLImageElement<"u"&&_ instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&_ instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&_ instanceof ImageBitmap?zx.getDataURL(_):_.data?{data:Array.from(_.data),width:_.width,height:_.height,type:_.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let RN=0;class Rs extends cc{constructor(s=Rs.DEFAULT_IMAGE,c=Rs.DEFAULT_MAPPING,d=je,p=je,y=Et,w=Wt,E=or,P=Dn,L=1,O=$c){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:RN++}),this.uuid=Zr(),this.name="",this.source=new Sh(s),this.mipmaps=[],this.mapping=c,this.wrapS=d,this.wrapT=p,this.magFilter=y,this.minFilter=w,this.anisotropy=L,this.format=E,this.internalFormat=null,this.type=P,this.offset=new gt(0,0),this.repeat=new gt(1,1),this.center=new gt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=O,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(s){this.source.data=s}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(s){return this.name=s.name,this.source=s.source,this.mipmaps=s.mipmaps.slice(0),this.mapping=s.mapping,this.wrapS=s.wrapS,this.wrapT=s.wrapT,this.magFilter=s.magFilter,this.minFilter=s.minFilter,this.anisotropy=s.anisotropy,this.format=s.format,this.internalFormat=s.internalFormat,this.type=s.type,this.offset.copy(s.offset),this.repeat.copy(s.repeat),this.center.copy(s.center),this.rotation=s.rotation,this.matrixAutoUpdate=s.matrixAutoUpdate,this.matrix.copy(s.matrix),this.generateMipmaps=s.generateMipmaps,this.premultiplyAlpha=s.premultiplyAlpha,this.flipY=s.flipY,this.unpackAlignment=s.unpackAlignment,this.encoding=s.encoding,this.userData=JSON.parse(JSON.stringify(s.userData)),this.needsUpdate=!0,this}toJSON(s){const c=s===void 0||typeof s=="string";if(!c&&s.textures[this.uuid]!==void 0)return s.textures[this.uuid];const d={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(s).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(d.userData=this.userData),c||(s.textures[this.uuid]=d),d}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(s){if(this.mapping!==Cn)return s;if(s.applyMatrix3(this.matrix),s.x<0||s.x>1)switch(this.wrapS){case ce:s.x=s.x-Math.floor(s.x);break;case je:s.x=s.x<0?0:1;break;case yt:Math.abs(Math.floor(s.x)%2)===1?s.x=Math.ceil(s.x)-s.x:s.x=s.x-Math.floor(s.x);break}if(s.y<0||s.y>1)switch(this.wrapT){case ce:s.y=s.y-Math.floor(s.y);break;case je:s.y=s.y<0?0:1;break;case yt:Math.abs(Math.floor(s.y)%2)===1?s.y=Math.ceil(s.y)-s.y:s.y=s.y-Math.floor(s.y);break}return this.flipY&&(s.y=1-s.y),s}set needsUpdate(s){s===!0&&(this.version++,this.source.needsUpdate=!0)}}Rs.DEFAULT_IMAGE=null,Rs.DEFAULT_MAPPING=Cn;class Pi{constructor(s=0,c=0,d=0,p=1){Pi.prototype.isVector4=!0,this.x=s,this.y=c,this.z=d,this.w=p}get width(){return this.z}set width(s){this.z=s}get height(){return this.w}set height(s){this.w=s}set(s,c,d,p){return this.x=s,this.y=c,this.z=d,this.w=p,this}setScalar(s){return this.x=s,this.y=s,this.z=s,this.w=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setZ(s){return this.z=s,this}setW(s){return this.w=s,this}setComponent(s,c){switch(s){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;case 3:this.w=c;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w!==void 0?s.w:1,this}add(s){return this.x+=s.x,this.y+=s.y,this.z+=s.z,this.w+=s.w,this}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this}addVectors(s,c){return this.x=s.x+c.x,this.y=s.y+c.y,this.z=s.z+c.z,this.w=s.w+c.w,this}addScaledVector(s,c){return this.x+=s.x*c,this.y+=s.y*c,this.z+=s.z*c,this.w+=s.w*c,this}sub(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w,this}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this}subVectors(s,c){return this.x=s.x-c.x,this.y=s.y-c.y,this.z=s.z-c.z,this.w=s.w-c.w,this}multiply(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this.w*=s.w,this}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}applyMatrix4(s){const c=this.x,d=this.y,p=this.z,y=this.w,w=s.elements;return this.x=w[0]*c+w[4]*d+w[8]*p+w[12]*y,this.y=w[1]*c+w[5]*d+w[9]*p+w[13]*y,this.z=w[2]*c+w[6]*d+w[10]*p+w[14]*y,this.w=w[3]*c+w[7]*d+w[11]*p+w[15]*y,this}divideScalar(s){return this.multiplyScalar(1/s)}setAxisAngleFromQuaternion(s){this.w=2*Math.acos(s.w);const c=Math.sqrt(1-s.w*s.w);return c<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=s.x/c,this.y=s.y/c,this.z=s.z/c),this}setAxisAngleFromRotationMatrix(s){let c,d,p,y;const P=s.elements,L=P[0],O=P[4],k=P[8],N=P[1],z=P[5],V=P[9],H=P[2],G=P[6],X=P[10];if(Math.abs(O-N)<.01&&Math.abs(k-H)<.01&&Math.abs(V-G)<.01){if(Math.abs(O+N)<.1&&Math.abs(k+H)<.1&&Math.abs(V+G)<.1&&Math.abs(L+z+X-3)<.1)return this.set(1,0,0,0),this;c=Math.PI;const ne=(L+1)/2,te=(z+1)/2,oe=(X+1)/2,ue=(O+N)/4,Ce=(k+H)/4,$=(V+G)/4;return ne>te&&ne>oe?ne<.01?(d=0,p=.707106781,y=.707106781):(d=Math.sqrt(ne),p=ue/d,y=Ce/d):te>oe?te<.01?(d=.707106781,p=0,y=.707106781):(p=Math.sqrt(te),d=ue/p,y=$/p):oe<.01?(d=.707106781,p=.707106781,y=0):(y=Math.sqrt(oe),d=Ce/y,p=$/y),this.set(d,p,y,c),this}let K=Math.sqrt((G-V)*(G-V)+(k-H)*(k-H)+(N-O)*(N-O));return Math.abs(K)<.001&&(K=1),this.x=(G-V)/K,this.y=(k-H)/K,this.z=(N-O)/K,this.w=Math.acos((L+z+X-1)/2),this}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this.w=Math.min(this.w,s.w),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this.w=Math.max(this.w,s.w),this}clamp(s,c){return this.x=Math.max(s.x,Math.min(c.x,this.x)),this.y=Math.max(s.y,Math.min(c.y,this.y)),this.z=Math.max(s.z,Math.min(c.z,this.z)),this.w=Math.max(s.w,Math.min(c.w,this.w)),this}clampScalar(s,c){return this.x=Math.max(s,Math.min(c,this.x)),this.y=Math.max(s,Math.min(c,this.y)),this.z=Math.max(s,Math.min(c,this.z)),this.w=Math.max(s,Math.min(c,this.w)),this}clampLength(s,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(s,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(s){return this.x*s.x+this.y*s.y+this.z*s.z+this.w*s.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,c){return this.x+=(s.x-this.x)*c,this.y+=(s.y-this.y)*c,this.z+=(s.z-this.z)*c,this.w+=(s.w-this.w)*c,this}lerpVectors(s,c,d){return this.x=s.x+(c.x-s.x)*d,this.y=s.y+(c.y-s.y)*d,this.z=s.z+(c.z-s.z)*d,this.w=s.w+(c.w-s.w)*d,this}equals(s){return s.x===this.x&&s.y===this.y&&s.z===this.z&&s.w===this.w}fromArray(s,c=0){return this.x=s[c],this.y=s[c+1],this.z=s[c+2],this.w=s[c+3],this}toArray(s=[],c=0){return s[c]=this.x,s[c+1]=this.y,s[c+2]=this.z,s[c+3]=this.w,s}fromBufferAttribute(s,c){return this.x=s.getX(c),this.y=s.getY(c),this.z=s.getZ(c),this.w=s.getW(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xo extends cc{constructor(s,c,d={}){super(),this.isWebGLRenderTarget=!0,this.width=s,this.height=c,this.depth=1,this.scissor=new Pi(0,0,s,c),this.scissorTest=!1,this.viewport=new Pi(0,0,s,c);const p={width:s,height:c,depth:1};this.texture=new Rs(p,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=d.generateMipmaps!==void 0?d.generateMipmaps:!1,this.texture.internalFormat=d.internalFormat!==void 0?d.internalFormat:null,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:Et,this.depthBuffer=d.depthBuffer!==void 0?d.depthBuffer:!0,this.stencilBuffer=d.stencilBuffer!==void 0?d.stencilBuffer:!1,this.depthTexture=d.depthTexture!==void 0?d.depthTexture:null,this.samples=d.samples!==void 0?d.samples:0}setSize(s,c,d=1){(this.width!==s||this.height!==c||this.depth!==d)&&(this.width=s,this.height=c,this.depth=d,this.texture.image.width=s,this.texture.image.height=c,this.texture.image.depth=d,this.dispose()),this.viewport.set(0,0,s,c),this.scissor.set(0,0,s,c)}clone(){return new this.constructor().copy(this)}copy(s){this.width=s.width,this.height=s.height,this.depth=s.depth,this.viewport.copy(s.viewport),this.texture=s.texture.clone(),this.texture.isRenderTargetTexture=!0;const c=Object.assign({},s.texture.image);return this.texture.source=new Sh(c),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,s.depthTexture!==null&&(this.depthTexture=s.depthTexture.clone()),this.samples=s.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Mp extends Rs{constructor(s=null,c=1,d=1,p=1){super(null),this.isDataArrayTexture=!0,this.image={data:s,width:c,height:d,depth:p},this.magFilter=mt,this.minFilter=mt,this.wrapR=je,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class PN extends xo{constructor(s,c,d){super(s,c),this.isWebGLArrayRenderTarget=!0,this.depth=d,this.texture=new Mp(null,s,c,d),this.texture.isRenderTargetTexture=!0}}class DA extends Rs{constructor(s=null,c=1,d=1,p=1){super(null),this.isData3DTexture=!0,this.image={data:s,width:c,height:d,depth:p},this.magFilter=mt,this.minFilter=mt,this.wrapR=je,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class BN extends xo{constructor(s,c,d){super(s,c),this.isWebGL3DRenderTarget=!0,this.depth=d,this.texture=new DA(null,s,c,d),this.texture.isRenderTargetTexture=!0}}class LN extends xo{constructor(s,c,d,p={}){super(s,c,p),this.isWebGLMultipleRenderTargets=!0;const y=this.texture;this.texture=[];for(let w=0;w<d;w++)this.texture[w]=y.clone(),this.texture[w].isRenderTargetTexture=!0}setSize(s,c,d=1){if(this.width!==s||this.height!==c||this.depth!==d){this.width=s,this.height=c,this.depth=d;for(let p=0,y=this.texture.length;p<y;p++)this.texture[p].image.width=s,this.texture[p].image.height=c,this.texture[p].image.depth=d;this.dispose()}return this.viewport.set(0,0,s,c),this.scissor.set(0,0,s,c),this}copy(s){this.dispose(),this.width=s.width,this.height=s.height,this.depth=s.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,s.depthTexture!==null&&(this.depthTexture=s.depthTexture.clone()),this.texture.length=0;for(let c=0,d=s.texture.length;c<d;c++)this.texture[c]=s.texture[c].clone(),this.texture[c].isRenderTargetTexture=!0;return this}}class Nr{constructor(s=0,c=0,d=0,p=1){this.isQuaternion=!0,this._x=s,this._y=c,this._z=d,this._w=p}static slerpFlat(s,c,d,p,y,w,E){let P=d[p+0],L=d[p+1],O=d[p+2],k=d[p+3];const N=y[w+0],z=y[w+1],V=y[w+2],H=y[w+3];if(E===0){s[c+0]=P,s[c+1]=L,s[c+2]=O,s[c+3]=k;return}if(E===1){s[c+0]=N,s[c+1]=z,s[c+2]=V,s[c+3]=H;return}if(k!==H||P!==N||L!==z||O!==V){let G=1-E;const X=P*N+L*z+O*V+k*H,K=X>=0?1:-1,ne=1-X*X;if(ne>Number.EPSILON){const oe=Math.sqrt(ne),ue=Math.atan2(oe,X*K);G=Math.sin(G*ue)/oe,E=Math.sin(E*ue)/oe}const te=E*K;if(P=P*G+N*te,L=L*G+z*te,O=O*G+V*te,k=k*G+H*te,G===1-E){const oe=1/Math.sqrt(P*P+L*L+O*O+k*k);P*=oe,L*=oe,O*=oe,k*=oe}}s[c]=P,s[c+1]=L,s[c+2]=O,s[c+3]=k}static multiplyQuaternionsFlat(s,c,d,p,y,w){const E=d[p],P=d[p+1],L=d[p+2],O=d[p+3],k=y[w],N=y[w+1],z=y[w+2],V=y[w+3];return s[c]=E*V+O*k+P*z-L*N,s[c+1]=P*V+O*N+L*k-E*z,s[c+2]=L*V+O*z+E*N-P*k,s[c+3]=O*V-E*k-P*N-L*z,s}get x(){return this._x}set x(s){this._x=s,this._onChangeCallback()}get y(){return this._y}set y(s){this._y=s,this._onChangeCallback()}get z(){return this._z}set z(s){this._z=s,this._onChangeCallback()}get w(){return this._w}set w(s){this._w=s,this._onChangeCallback()}set(s,c,d,p){return this._x=s,this._y=c,this._z=d,this._w=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(s){return this._x=s.x,this._y=s.y,this._z=s.z,this._w=s.w,this._onChangeCallback(),this}setFromEuler(s,c){const d=s._x,p=s._y,y=s._z,w=s._order,E=Math.cos,P=Math.sin,L=E(d/2),O=E(p/2),k=E(y/2),N=P(d/2),z=P(p/2),V=P(y/2);switch(w){case"XYZ":this._x=N*O*k+L*z*V,this._y=L*z*k-N*O*V,this._z=L*O*V+N*z*k,this._w=L*O*k-N*z*V;break;case"YXZ":this._x=N*O*k+L*z*V,this._y=L*z*k-N*O*V,this._z=L*O*V-N*z*k,this._w=L*O*k+N*z*V;break;case"ZXY":this._x=N*O*k-L*z*V,this._y=L*z*k+N*O*V,this._z=L*O*V+N*z*k,this._w=L*O*k-N*z*V;break;case"ZYX":this._x=N*O*k-L*z*V,this._y=L*z*k+N*O*V,this._z=L*O*V-N*z*k,this._w=L*O*k+N*z*V;break;case"YZX":this._x=N*O*k+L*z*V,this._y=L*z*k+N*O*V,this._z=L*O*V-N*z*k,this._w=L*O*k-N*z*V;break;case"XZY":this._x=N*O*k-L*z*V,this._y=L*z*k-N*O*V,this._z=L*O*V+N*z*k,this._w=L*O*k+N*z*V;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+w)}return c!==!1&&this._onChangeCallback(),this}setFromAxisAngle(s,c){const d=c/2,p=Math.sin(d);return this._x=s.x*p,this._y=s.y*p,this._z=s.z*p,this._w=Math.cos(d),this._onChangeCallback(),this}setFromRotationMatrix(s){const c=s.elements,d=c[0],p=c[4],y=c[8],w=c[1],E=c[5],P=c[9],L=c[2],O=c[6],k=c[10],N=d+E+k;if(N>0){const z=.5/Math.sqrt(N+1);this._w=.25/z,this._x=(O-P)*z,this._y=(y-L)*z,this._z=(w-p)*z}else if(d>E&&d>k){const z=2*Math.sqrt(1+d-E-k);this._w=(O-P)/z,this._x=.25*z,this._y=(p+w)/z,this._z=(y+L)/z}else if(E>k){const z=2*Math.sqrt(1+E-d-k);this._w=(y-L)/z,this._x=(p+w)/z,this._y=.25*z,this._z=(P+O)/z}else{const z=2*Math.sqrt(1+k-d-E);this._w=(w-p)/z,this._x=(y+L)/z,this._y=(P+O)/z,this._z=.25*z}return this._onChangeCallback(),this}setFromUnitVectors(s,c){let d=s.dot(c)+1;return d<Number.EPSILON?(d=0,Math.abs(s.x)>Math.abs(s.z)?(this._x=-s.y,this._y=s.x,this._z=0,this._w=d):(this._x=0,this._y=-s.z,this._z=s.y,this._w=d)):(this._x=s.y*c.z-s.z*c.y,this._y=s.z*c.x-s.x*c.z,this._z=s.x*c.y-s.y*c.x,this._w=d),this.normalize()}angleTo(s){return 2*Math.acos(Math.abs(fs(this.dot(s),-1,1)))}rotateTowards(s,c){const d=this.angleTo(s);if(d===0)return this;const p=Math.min(1,c/d);return this.slerp(s,p),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(s){return this._x*s._x+this._y*s._y+this._z*s._z+this._w*s._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let s=this.length();return s===0?(this._x=0,this._y=0,this._z=0,this._w=1):(s=1/s,this._x=this._x*s,this._y=this._y*s,this._z=this._z*s,this._w=this._w*s),this._onChangeCallback(),this}multiply(s){return this.multiplyQuaternions(this,s)}premultiply(s){return this.multiplyQuaternions(s,this)}multiplyQuaternions(s,c){const d=s._x,p=s._y,y=s._z,w=s._w,E=c._x,P=c._y,L=c._z,O=c._w;return this._x=d*O+w*E+p*L-y*P,this._y=p*O+w*P+y*E-d*L,this._z=y*O+w*L+d*P-p*E,this._w=w*O-d*E-p*P-y*L,this._onChangeCallback(),this}slerp(s,c){if(c===0)return this;if(c===1)return this.copy(s);const d=this._x,p=this._y,y=this._z,w=this._w;let E=w*s._w+d*s._x+p*s._y+y*s._z;if(E<0?(this._w=-s._w,this._x=-s._x,this._y=-s._y,this._z=-s._z,E=-E):this.copy(s),E>=1)return this._w=w,this._x=d,this._y=p,this._z=y,this;const P=1-E*E;if(P<=Number.EPSILON){const z=1-c;return this._w=z*w+c*this._w,this._x=z*d+c*this._x,this._y=z*p+c*this._y,this._z=z*y+c*this._z,this.normalize(),this._onChangeCallback(),this}const L=Math.sqrt(P),O=Math.atan2(L,E),k=Math.sin((1-c)*O)/L,N=Math.sin(c*O)/L;return this._w=w*k+this._w*N,this._x=d*k+this._x*N,this._y=p*k+this._y*N,this._z=y*k+this._z*N,this._onChangeCallback(),this}slerpQuaternions(s,c,d){return this.copy(s).slerp(c,d)}random(){const s=Math.random(),c=Math.sqrt(1-s),d=Math.sqrt(s),p=2*Math.PI*Math.random(),y=2*Math.PI*Math.random();return this.set(c*Math.cos(p),d*Math.sin(y),d*Math.cos(y),c*Math.sin(p))}equals(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._w===this._w}fromArray(s,c=0){return this._x=s[c],this._y=s[c+1],this._z=s[c+2],this._w=s[c+3],this._onChangeCallback(),this}toArray(s=[],c=0){return s[c]=this._x,s[c+1]=this._y,s[c+2]=this._z,s[c+3]=this._w,s}fromBufferAttribute(s,c){return this._x=s.getX(c),this._y=s.getY(c),this._z=s.getZ(c),this._w=s.getW(c),this}_onChange(s){return this._onChangeCallback=s,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class de{constructor(s=0,c=0,d=0){de.prototype.isVector3=!0,this.x=s,this.y=c,this.z=d}set(s,c,d){return d===void 0&&(d=this.z),this.x=s,this.y=c,this.z=d,this}setScalar(s){return this.x=s,this.y=s,this.z=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setZ(s){return this.z=s,this}setComponent(s,c){switch(s){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this}add(s){return this.x+=s.x,this.y+=s.y,this.z+=s.z,this}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this}addVectors(s,c){return this.x=s.x+c.x,this.y=s.y+c.y,this.z=s.z+c.z,this}addScaledVector(s,c){return this.x+=s.x*c,this.y+=s.y*c,this.z+=s.z*c,this}sub(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this}subVectors(s,c){return this.x=s.x-c.x,this.y=s.y-c.y,this.z=s.z-c.z,this}multiply(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this}multiplyVectors(s,c){return this.x=s.x*c.x,this.y=s.y*c.y,this.z=s.z*c.z,this}applyEuler(s){return this.applyQuaternion(W1.setFromEuler(s))}applyAxisAngle(s,c){return this.applyQuaternion(W1.setFromAxisAngle(s,c))}applyMatrix3(s){const c=this.x,d=this.y,p=this.z,y=s.elements;return this.x=y[0]*c+y[3]*d+y[6]*p,this.y=y[1]*c+y[4]*d+y[7]*p,this.z=y[2]*c+y[5]*d+y[8]*p,this}applyNormalMatrix(s){return this.applyMatrix3(s).normalize()}applyMatrix4(s){const c=this.x,d=this.y,p=this.z,y=s.elements,w=1/(y[3]*c+y[7]*d+y[11]*p+y[15]);return this.x=(y[0]*c+y[4]*d+y[8]*p+y[12])*w,this.y=(y[1]*c+y[5]*d+y[9]*p+y[13])*w,this.z=(y[2]*c+y[6]*d+y[10]*p+y[14])*w,this}applyQuaternion(s){const c=this.x,d=this.y,p=this.z,y=s.x,w=s.y,E=s.z,P=s.w,L=P*c+w*p-E*d,O=P*d+E*c-y*p,k=P*p+y*d-w*c,N=-y*c-w*d-E*p;return this.x=L*P+N*-y+O*-E-k*-w,this.y=O*P+N*-w+k*-y-L*-E,this.z=k*P+N*-E+L*-w-O*-y,this}project(s){return this.applyMatrix4(s.matrixWorldInverse).applyMatrix4(s.projectionMatrix)}unproject(s){return this.applyMatrix4(s.projectionMatrixInverse).applyMatrix4(s.matrixWorld)}transformDirection(s){const c=this.x,d=this.y,p=this.z,y=s.elements;return this.x=y[0]*c+y[4]*d+y[8]*p,this.y=y[1]*c+y[5]*d+y[9]*p,this.z=y[2]*c+y[6]*d+y[10]*p,this.normalize()}divide(s){return this.x/=s.x,this.y/=s.y,this.z/=s.z,this}divideScalar(s){return this.multiplyScalar(1/s)}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this}clamp(s,c){return this.x=Math.max(s.x,Math.min(c.x,this.x)),this.y=Math.max(s.y,Math.min(c.y,this.y)),this.z=Math.max(s.z,Math.min(c.z,this.z)),this}clampScalar(s,c){return this.x=Math.max(s,Math.min(c,this.x)),this.y=Math.max(s,Math.min(c,this.y)),this.z=Math.max(s,Math.min(c,this.z)),this}clampLength(s,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(s,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(s){return this.x*s.x+this.y*s.y+this.z*s.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,c){return this.x+=(s.x-this.x)*c,this.y+=(s.y-this.y)*c,this.z+=(s.z-this.z)*c,this}lerpVectors(s,c,d){return this.x=s.x+(c.x-s.x)*d,this.y=s.y+(c.y-s.y)*d,this.z=s.z+(c.z-s.z)*d,this}cross(s){return this.crossVectors(this,s)}crossVectors(s,c){const d=s.x,p=s.y,y=s.z,w=c.x,E=c.y,P=c.z;return this.x=p*P-y*E,this.y=y*w-d*P,this.z=d*E-p*w,this}projectOnVector(s){const c=s.lengthSq();if(c===0)return this.set(0,0,0);const d=s.dot(this)/c;return this.copy(s).multiplyScalar(d)}projectOnPlane(s){return Hx.copy(this).projectOnVector(s),this.sub(Hx)}reflect(s){return this.sub(Hx.copy(s).multiplyScalar(2*this.dot(s)))}angleTo(s){const c=Math.sqrt(this.lengthSq()*s.lengthSq());if(c===0)return Math.PI/2;const d=this.dot(s)/c;return Math.acos(fs(d,-1,1))}distanceTo(s){return Math.sqrt(this.distanceToSquared(s))}distanceToSquared(s){const c=this.x-s.x,d=this.y-s.y,p=this.z-s.z;return c*c+d*d+p*p}manhattanDistanceTo(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)+Math.abs(this.z-s.z)}setFromSpherical(s){return this.setFromSphericalCoords(s.radius,s.phi,s.theta)}setFromSphericalCoords(s,c,d){const p=Math.sin(c)*s;return this.x=p*Math.sin(d),this.y=Math.cos(c)*s,this.z=p*Math.cos(d),this}setFromCylindrical(s){return this.setFromCylindricalCoords(s.radius,s.theta,s.y)}setFromCylindricalCoords(s,c,d){return this.x=s*Math.sin(c),this.y=d,this.z=s*Math.cos(c),this}setFromMatrixPosition(s){const c=s.elements;return this.x=c[12],this.y=c[13],this.z=c[14],this}setFromMatrixScale(s){const c=this.setFromMatrixColumn(s,0).length(),d=this.setFromMatrixColumn(s,1).length(),p=this.setFromMatrixColumn(s,2).length();return this.x=c,this.y=d,this.z=p,this}setFromMatrixColumn(s,c){return this.fromArray(s.elements,c*4)}setFromMatrix3Column(s,c){return this.fromArray(s.elements,c*3)}setFromEuler(s){return this.x=s._x,this.y=s._y,this.z=s._z,this}equals(s){return s.x===this.x&&s.y===this.y&&s.z===this.z}fromArray(s,c=0){return this.x=s[c],this.y=s[c+1],this.z=s[c+2],this}toArray(s=[],c=0){return s[c]=this.x,s[c+1]=this.y,s[c+2]=this.z,s}fromBufferAttribute(s,c){return this.x=s.getX(c),this.y=s.getY(c),this.z=s.getZ(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const s=(Math.random()-.5)*2,c=Math.random()*Math.PI*2,d=Math.sqrt(1-s**2);return this.x=d*Math.cos(c),this.y=d*Math.sin(c),this.z=s,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Hx=new de,W1=new Nr;class Mh{constructor(s=new de(1/0,1/0,1/0),c=new de(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=s,this.max=c}set(s,c){return this.min.copy(s),this.max.copy(c),this}setFromArray(s){let c=1/0,d=1/0,p=1/0,y=-1/0,w=-1/0,E=-1/0;for(let P=0,L=s.length;P<L;P+=3){const O=s[P],k=s[P+1],N=s[P+2];O<c&&(c=O),k<d&&(d=k),N<p&&(p=N),O>y&&(y=O),k>w&&(w=k),N>E&&(E=N)}return this.min.set(c,d,p),this.max.set(y,w,E),this}setFromBufferAttribute(s){let c=1/0,d=1/0,p=1/0,y=-1/0,w=-1/0,E=-1/0;for(let P=0,L=s.count;P<L;P++){const O=s.getX(P),k=s.getY(P),N=s.getZ(P);O<c&&(c=O),k<d&&(d=k),N<p&&(p=N),O>y&&(y=O),k>w&&(w=k),N>E&&(E=N)}return this.min.set(c,d,p),this.max.set(y,w,E),this}setFromPoints(s){this.makeEmpty();for(let c=0,d=s.length;c<d;c++)this.expandByPoint(s[c]);return this}setFromCenterAndSize(s,c){const d=Th.copy(c).multiplyScalar(.5);return this.min.copy(s).sub(d),this.max.copy(s).add(d),this}setFromObject(s,c=!1){return this.makeEmpty(),this.expandByObject(s,c)}clone(){return new this.constructor().copy(this)}copy(s){return this.min.copy(s.min),this.max.copy(s.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(s){return this.isEmpty()?s.set(0,0,0):s.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(s){return this.isEmpty()?s.set(0,0,0):s.subVectors(this.max,this.min)}expandByPoint(s){return this.min.min(s),this.max.max(s),this}expandByVector(s){return this.min.sub(s),this.max.add(s),this}expandByScalar(s){return this.min.addScalar(-s),this.max.addScalar(s),this}expandByObject(s,c=!1){s.updateWorldMatrix(!1,!1);const d=s.geometry;if(d!==void 0)if(c&&d.attributes!=null&&d.attributes.position!==void 0){const y=d.attributes.position;for(let w=0,E=y.count;w<E;w++)Th.fromBufferAttribute(y,w).applyMatrix4(s.matrixWorld),this.expandByPoint(Th)}else d.boundingBox===null&&d.computeBoundingBox(),Vx.copy(d.boundingBox),Vx.applyMatrix4(s.matrixWorld),this.union(Vx);const p=s.children;for(let y=0,w=p.length;y<w;y++)this.expandByObject(p[y],c);return this}containsPoint(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y||s.z<this.min.z||s.z>this.max.z)}containsBox(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y&&this.min.z<=s.min.z&&s.max.z<=this.max.z}getParameter(s,c){return c.set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y),(s.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y||s.max.z<this.min.z||s.min.z>this.max.z)}intersectsSphere(s){return this.clampPoint(s.center,Th),Th.distanceToSquared(s.center)<=s.radius*s.radius}intersectsPlane(s){let c,d;return s.normal.x>0?(c=s.normal.x*this.min.x,d=s.normal.x*this.max.x):(c=s.normal.x*this.max.x,d=s.normal.x*this.min.x),s.normal.y>0?(c+=s.normal.y*this.min.y,d+=s.normal.y*this.max.y):(c+=s.normal.y*this.max.y,d+=s.normal.y*this.min.y),s.normal.z>0?(c+=s.normal.z*this.min.z,d+=s.normal.z*this.max.z):(c+=s.normal.z*this.max.z,d+=s.normal.z*this.min.z),c<=-s.constant&&d>=-s.constant}intersectsTriangle(s){if(this.isEmpty())return!1;this.getCenter(Tp),OA.subVectors(this.max,Tp),id.subVectors(s.a,Tp),sd.subVectors(s.b,Tp),rd.subVectors(s.c,Tp),nl.subVectors(sd,id),il.subVectors(rd,sd),Ih.subVectors(id,rd);let c=[0,-nl.z,nl.y,0,-il.z,il.y,0,-Ih.z,Ih.y,nl.z,0,-nl.x,il.z,0,-il.x,Ih.z,0,-Ih.x,-nl.y,nl.x,0,-il.y,il.x,0,-Ih.y,Ih.x,0];return!Wx(c,id,sd,rd,OA)||(c=[1,0,0,0,1,0,0,0,1],!Wx(c,id,sd,rd,OA))?!1:(FA.crossVectors(nl,il),c=[FA.x,FA.y,FA.z],Wx(c,id,sd,rd,OA))}clampPoint(s,c){return c.copy(s).clamp(this.min,this.max)}distanceToPoint(s){return Th.copy(s).clamp(this.min,this.max).sub(s).length()}getBoundingSphere(s){return this.getCenter(s.center),s.radius=this.getSize(Th).length()*.5,s}intersect(s){return this.min.max(s.min),this.max.min(s.max),this.isEmpty()&&this.makeEmpty(),this}union(s){return this.min.min(s.min),this.max.max(s.max),this}applyMatrix4(s){return this.isEmpty()?this:(hc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(s),hc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(s),hc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(s),hc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(s),hc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(s),hc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(s),hc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(s),hc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(s),this.setFromPoints(hc),this)}translate(s){return this.min.add(s),this.max.add(s),this}equals(s){return s.min.equals(this.min)&&s.max.equals(this.max)}}const hc=[new de,new de,new de,new de,new de,new de,new de,new de],Th=new de,Vx=new Mh,id=new de,sd=new de,rd=new de,nl=new de,il=new de,Ih=new de,Tp=new de,OA=new de,FA=new de,Rh=new de;function Wx(_,s,c,d,p){for(let y=0,w=_.length-3;y<=w;y+=3){Rh.fromArray(_,y);const E=p.x*Math.abs(Rh.x)+p.y*Math.abs(Rh.y)+p.z*Math.abs(Rh.z),P=s.dot(Rh),L=c.dot(Rh),O=d.dot(Rh);if(Math.max(-Math.max(P,L,O),Math.min(P,L,O))>E)return!1}return!0}const DN=new Mh,Q1=new de,kA=new de,Qx=new de;class Ph{constructor(s=new de,c=-1){this.center=s,this.radius=c}set(s,c){return this.center.copy(s),this.radius=c,this}setFromPoints(s,c){const d=this.center;c!==void 0?d.copy(c):DN.setFromPoints(s).getCenter(d);let p=0;for(let y=0,w=s.length;y<w;y++)p=Math.max(p,d.distanceToSquared(s[y]));return this.radius=Math.sqrt(p),this}copy(s){return this.center.copy(s.center),this.radius=s.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(s){return s.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(s){return s.distanceTo(this.center)-this.radius}intersectsSphere(s){const c=this.radius+s.radius;return s.center.distanceToSquared(this.center)<=c*c}intersectsBox(s){return s.intersectsSphere(this)}intersectsPlane(s){return Math.abs(s.distanceToPoint(this.center))<=this.radius}clampPoint(s,c){const d=this.center.distanceToSquared(s);return c.copy(s),d>this.radius*this.radius&&(c.sub(this.center).normalize(),c.multiplyScalar(this.radius).add(this.center)),c}getBoundingBox(s){return this.isEmpty()?(s.makeEmpty(),s):(s.set(this.center,this.center),s.expandByScalar(this.radius),s)}applyMatrix4(s){return this.center.applyMatrix4(s),this.radius=this.radius*s.getMaxScaleOnAxis(),this}translate(s){return this.center.add(s),this}expandByPoint(s){if(this.isEmpty())return this.center.copy(s),this.radius=0,this;Qx.subVectors(s,this.center);const c=Qx.lengthSq();if(c>this.radius*this.radius){const d=Math.sqrt(c),p=(d-this.radius)*.5;this.center.add(Qx.multiplyScalar(p/d)),this.radius+=p}return this}union(s){return s.isEmpty()?this:this.isEmpty()?(this.copy(s),this):(this.center.equals(s.center)===!0?kA.set(0,0,1).multiplyScalar(s.radius):kA.subVectors(s.center,this.center).normalize().multiplyScalar(s.radius),this.expandByPoint(Q1.copy(s.center).add(kA)),this.expandByPoint(Q1.copy(s.center).sub(kA)),this)}equals(s){return s.center.equals(this.center)&&s.radius===this.radius}clone(){return new this.constructor().copy(this)}}const uc=new de,jx=new de,NA=new de,sl=new de,qx=new de,UA=new de,Xx=new de;class Ip{constructor(s=new de,c=new de(0,0,-1)){this.origin=s,this.direction=c}set(s,c){return this.origin.copy(s),this.direction.copy(c),this}copy(s){return this.origin.copy(s.origin),this.direction.copy(s.direction),this}at(s,c){return c.copy(this.direction).multiplyScalar(s).add(this.origin)}lookAt(s){return this.direction.copy(s).sub(this.origin).normalize(),this}recast(s){return this.origin.copy(this.at(s,uc)),this}closestPointToPoint(s,c){c.subVectors(s,this.origin);const d=c.dot(this.direction);return d<0?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)}distanceToPoint(s){return Math.sqrt(this.distanceSqToPoint(s))}distanceSqToPoint(s){const c=uc.subVectors(s,this.origin).dot(this.direction);return c<0?this.origin.distanceToSquared(s):(uc.copy(this.direction).multiplyScalar(c).add(this.origin),uc.distanceToSquared(s))}distanceSqToSegment(s,c,d,p){jx.copy(s).add(c).multiplyScalar(.5),NA.copy(c).sub(s).normalize(),sl.copy(this.origin).sub(jx);const y=s.distanceTo(c)*.5,w=-this.direction.dot(NA),E=sl.dot(this.direction),P=-sl.dot(NA),L=sl.lengthSq(),O=Math.abs(1-w*w);let k,N,z,V;if(O>0)if(k=w*P-E,N=w*E-P,V=y*O,k>=0)if(N>=-V)if(N<=V){const H=1/O;k*=H,N*=H,z=k*(k+w*N+2*E)+N*(w*k+N+2*P)+L}else N=y,k=Math.max(0,-(w*N+E)),z=-k*k+N*(N+2*P)+L;else N=-y,k=Math.max(0,-(w*N+E)),z=-k*k+N*(N+2*P)+L;else N<=-V?(k=Math.max(0,-(-w*y+E)),N=k>0?-y:Math.min(Math.max(-y,-P),y),z=-k*k+N*(N+2*P)+L):N<=V?(k=0,N=Math.min(Math.max(-y,-P),y),z=N*(N+2*P)+L):(k=Math.max(0,-(w*y+E)),N=k>0?y:Math.min(Math.max(-y,-P),y),z=-k*k+N*(N+2*P)+L);else N=w>0?-y:y,k=Math.max(0,-(w*N+E)),z=-k*k+N*(N+2*P)+L;return d&&d.copy(this.direction).multiplyScalar(k).add(this.origin),p&&p.copy(NA).multiplyScalar(N).add(jx),z}intersectSphere(s,c){uc.subVectors(s.center,this.origin);const d=uc.dot(this.direction),p=uc.dot(uc)-d*d,y=s.radius*s.radius;if(p>y)return null;const w=Math.sqrt(y-p),E=d-w,P=d+w;return E<0&&P<0?null:E<0?this.at(P,c):this.at(E,c)}intersectsSphere(s){return this.distanceSqToPoint(s.center)<=s.radius*s.radius}distanceToPlane(s){const c=s.normal.dot(this.direction);if(c===0)return s.distanceToPoint(this.origin)===0?0:null;const d=-(this.origin.dot(s.normal)+s.constant)/c;return d>=0?d:null}intersectPlane(s,c){const d=this.distanceToPlane(s);return d===null?null:this.at(d,c)}intersectsPlane(s){const c=s.distanceToPoint(this.origin);return c===0||s.normal.dot(this.direction)*c<0}intersectBox(s,c){let d,p,y,w,E,P;const L=1/this.direction.x,O=1/this.direction.y,k=1/this.direction.z,N=this.origin;return L>=0?(d=(s.min.x-N.x)*L,p=(s.max.x-N.x)*L):(d=(s.max.x-N.x)*L,p=(s.min.x-N.x)*L),O>=0?(y=(s.min.y-N.y)*O,w=(s.max.y-N.y)*O):(y=(s.max.y-N.y)*O,w=(s.min.y-N.y)*O),d>w||y>p||((y>d||d!==d)&&(d=y),(w<p||p!==p)&&(p=w),k>=0?(E=(s.min.z-N.z)*k,P=(s.max.z-N.z)*k):(E=(s.max.z-N.z)*k,P=(s.min.z-N.z)*k),d>P||E>p)||((E>d||d!==d)&&(d=E),(P<p||p!==p)&&(p=P),p<0)?null:this.at(d>=0?d:p,c)}intersectsBox(s){return this.intersectBox(s,uc)!==null}intersectTriangle(s,c,d,p,y){qx.subVectors(c,s),UA.subVectors(d,s),Xx.crossVectors(qx,UA);let w=this.direction.dot(Xx),E;if(w>0){if(p)return null;E=1}else if(w<0)E=-1,w=-w;else return null;sl.subVectors(this.origin,s);const P=E*this.direction.dot(UA.crossVectors(sl,UA));if(P<0)return null;const L=E*this.direction.dot(qx.cross(sl));if(L<0||P+L>w)return null;const O=-E*sl.dot(Xx);return O<0?null:this.at(O/w,y)}applyMatrix4(s){return this.origin.applyMatrix4(s),this.direction.transformDirection(s),this}equals(s){return s.origin.equals(this.origin)&&s.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class $n{constructor(){$n.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(s,c,d,p,y,w,E,P,L,O,k,N,z,V,H,G){const X=this.elements;return X[0]=s,X[4]=c,X[8]=d,X[12]=p,X[1]=y,X[5]=w,X[9]=E,X[13]=P,X[2]=L,X[6]=O,X[10]=k,X[14]=N,X[3]=z,X[7]=V,X[11]=H,X[15]=G,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new $n().fromArray(this.elements)}copy(s){const c=this.elements,d=s.elements;return c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this}copyPosition(s){const c=this.elements,d=s.elements;return c[12]=d[12],c[13]=d[13],c[14]=d[14],this}setFromMatrix3(s){const c=s.elements;return this.set(c[0],c[3],c[6],0,c[1],c[4],c[7],0,c[2],c[5],c[8],0,0,0,0,1),this}extractBasis(s,c,d){return s.setFromMatrixColumn(this,0),c.setFromMatrixColumn(this,1),d.setFromMatrixColumn(this,2),this}makeBasis(s,c,d){return this.set(s.x,c.x,d.x,0,s.y,c.y,d.y,0,s.z,c.z,d.z,0,0,0,0,1),this}extractRotation(s){const c=this.elements,d=s.elements,p=1/od.setFromMatrixColumn(s,0).length(),y=1/od.setFromMatrixColumn(s,1).length(),w=1/od.setFromMatrixColumn(s,2).length();return c[0]=d[0]*p,c[1]=d[1]*p,c[2]=d[2]*p,c[3]=0,c[4]=d[4]*y,c[5]=d[5]*y,c[6]=d[6]*y,c[7]=0,c[8]=d[8]*w,c[9]=d[9]*w,c[10]=d[10]*w,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromEuler(s){const c=this.elements,d=s.x,p=s.y,y=s.z,w=Math.cos(d),E=Math.sin(d),P=Math.cos(p),L=Math.sin(p),O=Math.cos(y),k=Math.sin(y);if(s.order==="XYZ"){const N=w*O,z=w*k,V=E*O,H=E*k;c[0]=P*O,c[4]=-P*k,c[8]=L,c[1]=z+V*L,c[5]=N-H*L,c[9]=-E*P,c[2]=H-N*L,c[6]=V+z*L,c[10]=w*P}else if(s.order==="YXZ"){const N=P*O,z=P*k,V=L*O,H=L*k;c[0]=N+H*E,c[4]=V*E-z,c[8]=w*L,c[1]=w*k,c[5]=w*O,c[9]=-E,c[2]=z*E-V,c[6]=H+N*E,c[10]=w*P}else if(s.order==="ZXY"){const N=P*O,z=P*k,V=L*O,H=L*k;c[0]=N-H*E,c[4]=-w*k,c[8]=V+z*E,c[1]=z+V*E,c[5]=w*O,c[9]=H-N*E,c[2]=-w*L,c[6]=E,c[10]=w*P}else if(s.order==="ZYX"){const N=w*O,z=w*k,V=E*O,H=E*k;c[0]=P*O,c[4]=V*L-z,c[8]=N*L+H,c[1]=P*k,c[5]=H*L+N,c[9]=z*L-V,c[2]=-L,c[6]=E*P,c[10]=w*P}else if(s.order==="YZX"){const N=w*P,z=w*L,V=E*P,H=E*L;c[0]=P*O,c[4]=H-N*k,c[8]=V*k+z,c[1]=k,c[5]=w*O,c[9]=-E*O,c[2]=-L*O,c[6]=z*k+V,c[10]=N-H*k}else if(s.order==="XZY"){const N=w*P,z=w*L,V=E*P,H=E*L;c[0]=P*O,c[4]=-k,c[8]=L*O,c[1]=N*k+H,c[5]=w*O,c[9]=z*k-V,c[2]=V*k-z,c[6]=E*O,c[10]=H*k+N}return c[3]=0,c[7]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromQuaternion(s){return this.compose(ON,s,FN)}lookAt(s,c,d){const p=this.elements;return $r.subVectors(s,c),$r.lengthSq()===0&&($r.z=1),$r.normalize(),rl.crossVectors(d,$r),rl.lengthSq()===0&&(Math.abs(d.z)===1?$r.x+=1e-4:$r.z+=1e-4,$r.normalize(),rl.crossVectors(d,$r)),rl.normalize(),zA.crossVectors($r,rl),p[0]=rl.x,p[4]=zA.x,p[8]=$r.x,p[1]=rl.y,p[5]=zA.y,p[9]=$r.y,p[2]=rl.z,p[6]=zA.z,p[10]=$r.z,this}multiply(s){return this.multiplyMatrices(this,s)}premultiply(s){return this.multiplyMatrices(s,this)}multiplyMatrices(s,c){const d=s.elements,p=c.elements,y=this.elements,w=d[0],E=d[4],P=d[8],L=d[12],O=d[1],k=d[5],N=d[9],z=d[13],V=d[2],H=d[6],G=d[10],X=d[14],K=d[3],ne=d[7],te=d[11],oe=d[15],ue=p[0],Ce=p[4],$=p[8],ge=p[12],Te=p[1],et=p[5],It=p[9],Ye=p[13],Fe=p[2],rt=p[6],At=p[10],St=p[14],at=p[3],Qe=p[7],Je=p[11],Rt=p[15];return y[0]=w*ue+E*Te+P*Fe+L*at,y[4]=w*Ce+E*et+P*rt+L*Qe,y[8]=w*$+E*It+P*At+L*Je,y[12]=w*ge+E*Ye+P*St+L*Rt,y[1]=O*ue+k*Te+N*Fe+z*at,y[5]=O*Ce+k*et+N*rt+z*Qe,y[9]=O*$+k*It+N*At+z*Je,y[13]=O*ge+k*Ye+N*St+z*Rt,y[2]=V*ue+H*Te+G*Fe+X*at,y[6]=V*Ce+H*et+G*rt+X*Qe,y[10]=V*$+H*It+G*At+X*Je,y[14]=V*ge+H*Ye+G*St+X*Rt,y[3]=K*ue+ne*Te+te*Fe+oe*at,y[7]=K*Ce+ne*et+te*rt+oe*Qe,y[11]=K*$+ne*It+te*At+oe*Je,y[15]=K*ge+ne*Ye+te*St+oe*Rt,this}multiplyScalar(s){const c=this.elements;return c[0]*=s,c[4]*=s,c[8]*=s,c[12]*=s,c[1]*=s,c[5]*=s,c[9]*=s,c[13]*=s,c[2]*=s,c[6]*=s,c[10]*=s,c[14]*=s,c[3]*=s,c[7]*=s,c[11]*=s,c[15]*=s,this}determinant(){const s=this.elements,c=s[0],d=s[4],p=s[8],y=s[12],w=s[1],E=s[5],P=s[9],L=s[13],O=s[2],k=s[6],N=s[10],z=s[14],V=s[3],H=s[7],G=s[11],X=s[15];return V*(+y*P*k-p*L*k-y*E*N+d*L*N+p*E*z-d*P*z)+H*(+c*P*z-c*L*N+y*w*N-p*w*z+p*L*O-y*P*O)+G*(+c*L*k-c*E*z-y*w*k+d*w*z+y*E*O-d*L*O)+X*(-p*E*O-c*P*k+c*E*N+p*w*k-d*w*N+d*P*O)}transpose(){const s=this.elements;let c;return c=s[1],s[1]=s[4],s[4]=c,c=s[2],s[2]=s[8],s[8]=c,c=s[6],s[6]=s[9],s[9]=c,c=s[3],s[3]=s[12],s[12]=c,c=s[7],s[7]=s[13],s[13]=c,c=s[11],s[11]=s[14],s[14]=c,this}setPosition(s,c,d){const p=this.elements;return s.isVector3?(p[12]=s.x,p[13]=s.y,p[14]=s.z):(p[12]=s,p[13]=c,p[14]=d),this}invert(){const s=this.elements,c=s[0],d=s[1],p=s[2],y=s[3],w=s[4],E=s[5],P=s[6],L=s[7],O=s[8],k=s[9],N=s[10],z=s[11],V=s[12],H=s[13],G=s[14],X=s[15],K=k*G*L-H*N*L+H*P*z-E*G*z-k*P*X+E*N*X,ne=V*N*L-O*G*L-V*P*z+w*G*z+O*P*X-w*N*X,te=O*H*L-V*k*L+V*E*z-w*H*z-O*E*X+w*k*X,oe=V*k*P-O*H*P-V*E*N+w*H*N+O*E*G-w*k*G,ue=c*K+d*ne+p*te+y*oe;if(ue===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ce=1/ue;return s[0]=K*Ce,s[1]=(H*N*y-k*G*y-H*p*z+d*G*z+k*p*X-d*N*X)*Ce,s[2]=(E*G*y-H*P*y+H*p*L-d*G*L-E*p*X+d*P*X)*Ce,s[3]=(k*P*y-E*N*y-k*p*L+d*N*L+E*p*z-d*P*z)*Ce,s[4]=ne*Ce,s[5]=(O*G*y-V*N*y+V*p*z-c*G*z-O*p*X+c*N*X)*Ce,s[6]=(V*P*y-w*G*y-V*p*L+c*G*L+w*p*X-c*P*X)*Ce,s[7]=(w*N*y-O*P*y+O*p*L-c*N*L-w*p*z+c*P*z)*Ce,s[8]=te*Ce,s[9]=(V*k*y-O*H*y-V*d*z+c*H*z+O*d*X-c*k*X)*Ce,s[10]=(w*H*y-V*E*y+V*d*L-c*H*L-w*d*X+c*E*X)*Ce,s[11]=(O*E*y-w*k*y-O*d*L+c*k*L+w*d*z-c*E*z)*Ce,s[12]=oe*Ce,s[13]=(O*H*p-V*k*p+V*d*N-c*H*N-O*d*G+c*k*G)*Ce,s[14]=(V*E*p-w*H*p-V*d*P+c*H*P+w*d*G-c*E*G)*Ce,s[15]=(w*k*p-O*E*p+O*d*P-c*k*P-w*d*N+c*E*N)*Ce,this}scale(s){const c=this.elements,d=s.x,p=s.y,y=s.z;return c[0]*=d,c[4]*=p,c[8]*=y,c[1]*=d,c[5]*=p,c[9]*=y,c[2]*=d,c[6]*=p,c[10]*=y,c[3]*=d,c[7]*=p,c[11]*=y,this}getMaxScaleOnAxis(){const s=this.elements,c=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],d=s[4]*s[4]+s[5]*s[5]+s[6]*s[6],p=s[8]*s[8]+s[9]*s[9]+s[10]*s[10];return Math.sqrt(Math.max(c,d,p))}makeTranslation(s,c,d){return this.set(1,0,0,s,0,1,0,c,0,0,1,d,0,0,0,1),this}makeRotationX(s){const c=Math.cos(s),d=Math.sin(s);return this.set(1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1),this}makeRotationY(s){const c=Math.cos(s),d=Math.sin(s);return this.set(c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1),this}makeRotationZ(s){const c=Math.cos(s),d=Math.sin(s);return this.set(c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(s,c){const d=Math.cos(c),p=Math.sin(c),y=1-d,w=s.x,E=s.y,P=s.z,L=y*w,O=y*E;return this.set(L*w+d,L*E-p*P,L*P+p*E,0,L*E+p*P,O*E+d,O*P-p*w,0,L*P-p*E,O*P+p*w,y*P*P+d,0,0,0,0,1),this}makeScale(s,c,d){return this.set(s,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1),this}makeShear(s,c,d,p,y,w){return this.set(1,d,y,0,s,1,w,0,c,p,1,0,0,0,0,1),this}compose(s,c,d){const p=this.elements,y=c._x,w=c._y,E=c._z,P=c._w,L=y+y,O=w+w,k=E+E,N=y*L,z=y*O,V=y*k,H=w*O,G=w*k,X=E*k,K=P*L,ne=P*O,te=P*k,oe=d.x,ue=d.y,Ce=d.z;return p[0]=(1-(H+X))*oe,p[1]=(z+te)*oe,p[2]=(V-ne)*oe,p[3]=0,p[4]=(z-te)*ue,p[5]=(1-(N+X))*ue,p[6]=(G+K)*ue,p[7]=0,p[8]=(V+ne)*Ce,p[9]=(G-K)*Ce,p[10]=(1-(N+H))*Ce,p[11]=0,p[12]=s.x,p[13]=s.y,p[14]=s.z,p[15]=1,this}decompose(s,c,d){const p=this.elements;let y=od.set(p[0],p[1],p[2]).length();const w=od.set(p[4],p[5],p[6]).length(),E=od.set(p[8],p[9],p[10]).length();this.determinant()<0&&(y=-y),s.x=p[12],s.y=p[13],s.z=p[14],Xo.copy(this);const L=1/y,O=1/w,k=1/E;return Xo.elements[0]*=L,Xo.elements[1]*=L,Xo.elements[2]*=L,Xo.elements[4]*=O,Xo.elements[5]*=O,Xo.elements[6]*=O,Xo.elements[8]*=k,Xo.elements[9]*=k,Xo.elements[10]*=k,c.setFromRotationMatrix(Xo),d.x=y,d.y=w,d.z=E,this}makePerspective(s,c,d,p,y,w){const E=this.elements,P=2*y/(c-s),L=2*y/(d-p),O=(c+s)/(c-s),k=(d+p)/(d-p),N=-(w+y)/(w-y),z=-2*w*y/(w-y);return E[0]=P,E[4]=0,E[8]=O,E[12]=0,E[1]=0,E[5]=L,E[9]=k,E[13]=0,E[2]=0,E[6]=0,E[10]=N,E[14]=z,E[3]=0,E[7]=0,E[11]=-1,E[15]=0,this}makeOrthographic(s,c,d,p,y,w){const E=this.elements,P=1/(c-s),L=1/(d-p),O=1/(w-y),k=(c+s)*P,N=(d+p)*L,z=(w+y)*O;return E[0]=2*P,E[4]=0,E[8]=0,E[12]=-k,E[1]=0,E[5]=2*L,E[9]=0,E[13]=-N,E[2]=0,E[6]=0,E[10]=-2*O,E[14]=-z,E[3]=0,E[7]=0,E[11]=0,E[15]=1,this}equals(s){const c=this.elements,d=s.elements;for(let p=0;p<16;p++)if(c[p]!==d[p])return!1;return!0}fromArray(s,c=0){for(let d=0;d<16;d++)this.elements[d]=s[d+c];return this}toArray(s=[],c=0){const d=this.elements;return s[c]=d[0],s[c+1]=d[1],s[c+2]=d[2],s[c+3]=d[3],s[c+4]=d[4],s[c+5]=d[5],s[c+6]=d[6],s[c+7]=d[7],s[c+8]=d[8],s[c+9]=d[9],s[c+10]=d[10],s[c+11]=d[11],s[c+12]=d[12],s[c+13]=d[13],s[c+14]=d[14],s[c+15]=d[15],s}}const od=new de,Xo=new $n,ON=new de(0,0,0),FN=new de(1,1,1),rl=new de,zA=new de,$r=new de,j1=new $n,q1=new Nr;class ad{constructor(s=0,c=0,d=0,p=ad.DefaultOrder){this.isEuler=!0,this._x=s,this._y=c,this._z=d,this._order=p}get x(){return this._x}set x(s){this._x=s,this._onChangeCallback()}get y(){return this._y}set y(s){this._y=s,this._onChangeCallback()}get z(){return this._z}set z(s){this._z=s,this._onChangeCallback()}get order(){return this._order}set order(s){this._order=s,this._onChangeCallback()}set(s,c,d,p=this._order){return this._x=s,this._y=c,this._z=d,this._order=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(s){return this._x=s._x,this._y=s._y,this._z=s._z,this._order=s._order,this._onChangeCallback(),this}setFromRotationMatrix(s,c=this._order,d=!0){const p=s.elements,y=p[0],w=p[4],E=p[8],P=p[1],L=p[5],O=p[9],k=p[2],N=p[6],z=p[10];switch(c){case"XYZ":this._y=Math.asin(fs(E,-1,1)),Math.abs(E)<.9999999?(this._x=Math.atan2(-O,z),this._z=Math.atan2(-w,y)):(this._x=Math.atan2(N,L),this._z=0);break;case"YXZ":this._x=Math.asin(-fs(O,-1,1)),Math.abs(O)<.9999999?(this._y=Math.atan2(E,z),this._z=Math.atan2(P,L)):(this._y=Math.atan2(-k,y),this._z=0);break;case"ZXY":this._x=Math.asin(fs(N,-1,1)),Math.abs(N)<.9999999?(this._y=Math.atan2(-k,z),this._z=Math.atan2(-w,L)):(this._y=0,this._z=Math.atan2(P,y));break;case"ZYX":this._y=Math.asin(-fs(k,-1,1)),Math.abs(k)<.9999999?(this._x=Math.atan2(N,z),this._z=Math.atan2(P,y)):(this._x=0,this._z=Math.atan2(-w,L));break;case"YZX":this._z=Math.asin(fs(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-O,L),this._y=Math.atan2(-k,y)):(this._x=0,this._y=Math.atan2(E,z));break;case"XZY":this._z=Math.asin(-fs(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(N,L),this._y=Math.atan2(E,y)):(this._x=Math.atan2(-O,z),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+c)}return this._order=c,d===!0&&this._onChangeCallback(),this}setFromQuaternion(s,c,d){return j1.makeRotationFromQuaternion(s),this.setFromRotationMatrix(j1,c,d)}setFromVector3(s,c=this._order){return this.set(s.x,s.y,s.z,c)}reorder(s){return q1.setFromEuler(this),this.setFromQuaternion(q1,s)}equals(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._order===this._order}fromArray(s){return this._x=s[0],this._y=s[1],this._z=s[2],s[3]!==void 0&&(this._order=s[3]),this._onChangeCallback(),this}toArray(s=[],c=0){return s[c]=this._x,s[c+1]=this._y,s[c+2]=this._z,s[c+3]=this._order,s}_onChange(s){return this._onChangeCallback=s,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}ad.DefaultOrder="XYZ",ad.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class GA{constructor(){this.mask=1}set(s){this.mask=(1<<s|0)>>>0}enable(s){this.mask|=1<<s|0}enableAll(){this.mask=-1}toggle(s){this.mask^=1<<s|0}disable(s){this.mask&=~(1<<s|0)}disableAll(){this.mask=0}test(s){return(this.mask&s.mask)!==0}isEnabled(s){return(this.mask&(1<<s|0))!==0}}let kN=0;const X1=new de,cd=new Nr,dc=new $n,HA=new de,Rp=new de,NN=new de,UN=new Nr,Y1=new de(1,0,0),J1=new de(0,1,0),K1=new de(0,0,1),zN={type:"added"},Z1={type:"removed"};class bi extends cc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:kN++}),this.uuid=Zr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=bi.DefaultUp.clone();const s=new de,c=new ad,d=new Nr,p=new de(1,1,1);function y(){d.setFromEuler(c,!1)}function w(){c.setFromQuaternion(d,void 0,!1)}c._onChange(y),d._onChange(w),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:s},rotation:{configurable:!0,enumerable:!0,value:c},quaternion:{configurable:!0,enumerable:!0,value:d},scale:{configurable:!0,enumerable:!0,value:p},modelViewMatrix:{value:new $n},normalMatrix:{value:new kr}}),this.matrix=new $n,this.matrixWorld=new $n,this.matrixAutoUpdate=bi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=bi.DefaultMatrixWorldAutoUpdate,this.layers=new GA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(s){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(s),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(s){return this.quaternion.premultiply(s),this}setRotationFromAxisAngle(s,c){this.quaternion.setFromAxisAngle(s,c)}setRotationFromEuler(s){this.quaternion.setFromEuler(s,!0)}setRotationFromMatrix(s){this.quaternion.setFromRotationMatrix(s)}setRotationFromQuaternion(s){this.quaternion.copy(s)}rotateOnAxis(s,c){return cd.setFromAxisAngle(s,c),this.quaternion.multiply(cd),this}rotateOnWorldAxis(s,c){return cd.setFromAxisAngle(s,c),this.quaternion.premultiply(cd),this}rotateX(s){return this.rotateOnAxis(Y1,s)}rotateY(s){return this.rotateOnAxis(J1,s)}rotateZ(s){return this.rotateOnAxis(K1,s)}translateOnAxis(s,c){return X1.copy(s).applyQuaternion(this.quaternion),this.position.add(X1.multiplyScalar(c)),this}translateX(s){return this.translateOnAxis(Y1,s)}translateY(s){return this.translateOnAxis(J1,s)}translateZ(s){return this.translateOnAxis(K1,s)}localToWorld(s){return s.applyMatrix4(this.matrixWorld)}worldToLocal(s){return s.applyMatrix4(dc.copy(this.matrixWorld).invert())}lookAt(s,c,d){s.isVector3?HA.copy(s):HA.set(s,c,d);const p=this.parent;this.updateWorldMatrix(!0,!1),Rp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?dc.lookAt(Rp,HA,this.up):dc.lookAt(HA,Rp,this.up),this.quaternion.setFromRotationMatrix(dc),p&&(dc.extractRotation(p.matrixWorld),cd.setFromRotationMatrix(dc),this.quaternion.premultiply(cd.invert()))}add(s){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.add(arguments[c]);return this}return s===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",s),this):(s&&s.isObject3D?(s.parent!==null&&s.parent.remove(s),s.parent=this,this.children.push(s),s.dispatchEvent(zN)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",s),this)}remove(s){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.remove(arguments[d]);return this}const c=this.children.indexOf(s);return c!==-1&&(s.parent=null,this.children.splice(c,1),s.dispatchEvent(Z1)),this}removeFromParent(){const s=this.parent;return s!==null&&s.remove(this),this}clear(){for(let s=0;s<this.children.length;s++){const c=this.children[s];c.parent=null,c.dispatchEvent(Z1)}return this.children.length=0,this}attach(s){return this.updateWorldMatrix(!0,!1),dc.copy(this.matrixWorld).invert(),s.parent!==null&&(s.parent.updateWorldMatrix(!0,!1),dc.multiply(s.parent.matrixWorld)),s.applyMatrix4(dc),this.add(s),s.updateWorldMatrix(!1,!0),this}getObjectById(s){return this.getObjectByProperty("id",s)}getObjectByName(s){return this.getObjectByProperty("name",s)}getObjectByProperty(s,c){if(this[s]===c)return this;for(let d=0,p=this.children.length;d<p;d++){const w=this.children[d].getObjectByProperty(s,c);if(w!==void 0)return w}}getWorldPosition(s){return this.updateWorldMatrix(!0,!1),s.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(s){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rp,s,NN),s}getWorldScale(s){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rp,UN,s),s}getWorldDirection(s){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return s.set(c[8],c[9],c[10]).normalize()}raycast(){}traverse(s){s(this);const c=this.children;for(let d=0,p=c.length;d<p;d++)c[d].traverse(s)}traverseVisible(s){if(this.visible===!1)return;s(this);const c=this.children;for(let d=0,p=c.length;d<p;d++)c[d].traverseVisible(s)}traverseAncestors(s){const c=this.parent;c!==null&&(s(c),c.traverseAncestors(s))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(s){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||s)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);const c=this.children;for(let d=0,p=c.length;d<p;d++){const y=c[d];(y.matrixWorldAutoUpdate===!0||s===!0)&&y.updateMatrixWorld(s)}}updateWorldMatrix(s,c){const d=this.parent;if(s===!0&&d!==null&&d.matrixWorldAutoUpdate===!0&&d.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),c===!0){const p=this.children;for(let y=0,w=p.length;y<w;y++){const E=p[y];E.matrixWorldAutoUpdate===!0&&E.updateWorldMatrix(!1,!0)}}}toJSON(s){const c=s===void 0||typeof s=="string",d={};c&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},d.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const p={};p.uuid=this.uuid,p.type=this.type,this.name!==""&&(p.name=this.name),this.castShadow===!0&&(p.castShadow=!0),this.receiveShadow===!0&&(p.receiveShadow=!0),this.visible===!1&&(p.visible=!1),this.frustumCulled===!1&&(p.frustumCulled=!1),this.renderOrder!==0&&(p.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(p.userData=this.userData),p.layers=this.layers.mask,p.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(p.matrixAutoUpdate=!1),this.isInstancedMesh&&(p.type="InstancedMesh",p.count=this.count,p.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(p.instanceColor=this.instanceColor.toJSON()));function y(E,P){return E[P.uuid]===void 0&&(E[P.uuid]=P.toJSON(s)),P.uuid}if(this.isScene)this.background&&(this.background.isColor?p.background=this.background.toJSON():this.background.isTexture&&(p.background=this.background.toJSON(s).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(p.environment=this.environment.toJSON(s).uuid);else if(this.isMesh||this.isLine||this.isPoints){p.geometry=y(s.geometries,this.geometry);const E=this.geometry.parameters;if(E!==void 0&&E.shapes!==void 0){const P=E.shapes;if(Array.isArray(P))for(let L=0,O=P.length;L<O;L++){const k=P[L];y(s.shapes,k)}else y(s.shapes,P)}}if(this.isSkinnedMesh&&(p.bindMode=this.bindMode,p.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(y(s.skeletons,this.skeleton),p.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const E=[];for(let P=0,L=this.material.length;P<L;P++)E.push(y(s.materials,this.material[P]));p.material=E}else p.material=y(s.materials,this.material);if(this.children.length>0){p.children=[];for(let E=0;E<this.children.length;E++)p.children.push(this.children[E].toJSON(s).object)}if(this.animations.length>0){p.animations=[];for(let E=0;E<this.animations.length;E++){const P=this.animations[E];p.animations.push(y(s.animations,P))}}if(c){const E=w(s.geometries),P=w(s.materials),L=w(s.textures),O=w(s.images),k=w(s.shapes),N=w(s.skeletons),z=w(s.animations),V=w(s.nodes);E.length>0&&(d.geometries=E),P.length>0&&(d.materials=P),L.length>0&&(d.textures=L),O.length>0&&(d.images=O),k.length>0&&(d.shapes=k),N.length>0&&(d.skeletons=N),z.length>0&&(d.animations=z),V.length>0&&(d.nodes=V)}return d.object=p,d;function w(E){const P=[];for(const L in E){const O=E[L];delete O.metadata,P.push(O)}return P}}clone(s){return new this.constructor().copy(this,s)}copy(s,c=!0){if(this.name=s.name,this.up.copy(s.up),this.position.copy(s.position),this.rotation.order=s.rotation.order,this.quaternion.copy(s.quaternion),this.scale.copy(s.scale),this.matrix.copy(s.matrix),this.matrixWorld.copy(s.matrixWorld),this.matrixAutoUpdate=s.matrixAutoUpdate,this.matrixWorldNeedsUpdate=s.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=s.matrixWorldAutoUpdate,this.layers.mask=s.layers.mask,this.visible=s.visible,this.castShadow=s.castShadow,this.receiveShadow=s.receiveShadow,this.frustumCulled=s.frustumCulled,this.renderOrder=s.renderOrder,this.userData=JSON.parse(JSON.stringify(s.userData)),c===!0)for(let d=0;d<s.children.length;d++){const p=s.children[d];this.add(p.clone())}return this}}bi.DefaultUp=new de(0,1,0),bi.DefaultMatrixAutoUpdate=!0,bi.DefaultMatrixWorldAutoUpdate=!0;const Yo=new de,fc=new de,Yx=new de,pc=new de,ld=new de,hd=new de,$1=new de,Jx=new de,Kx=new de,Zx=new de;class wo{constructor(s=new de,c=new de,d=new de){this.a=s,this.b=c,this.c=d}static getNormal(s,c,d,p){p.subVectors(d,c),Yo.subVectors(s,c),p.cross(Yo);const y=p.lengthSq();return y>0?p.multiplyScalar(1/Math.sqrt(y)):p.set(0,0,0)}static getBarycoord(s,c,d,p,y){Yo.subVectors(p,c),fc.subVectors(d,c),Yx.subVectors(s,c);const w=Yo.dot(Yo),E=Yo.dot(fc),P=Yo.dot(Yx),L=fc.dot(fc),O=fc.dot(Yx),k=w*L-E*E;if(k===0)return y.set(-2,-1,-1);const N=1/k,z=(L*P-E*O)*N,V=(w*O-E*P)*N;return y.set(1-z-V,V,z)}static containsPoint(s,c,d,p){return this.getBarycoord(s,c,d,p,pc),pc.x>=0&&pc.y>=0&&pc.x+pc.y<=1}static getUV(s,c,d,p,y,w,E,P){return this.getBarycoord(s,c,d,p,pc),P.set(0,0),P.addScaledVector(y,pc.x),P.addScaledVector(w,pc.y),P.addScaledVector(E,pc.z),P}static isFrontFacing(s,c,d,p){return Yo.subVectors(d,c),fc.subVectors(s,c),Yo.cross(fc).dot(p)<0}set(s,c,d){return this.a.copy(s),this.b.copy(c),this.c.copy(d),this}setFromPointsAndIndices(s,c,d,p){return this.a.copy(s[c]),this.b.copy(s[d]),this.c.copy(s[p]),this}setFromAttributeAndIndices(s,c,d,p){return this.a.fromBufferAttribute(s,c),this.b.fromBufferAttribute(s,d),this.c.fromBufferAttribute(s,p),this}clone(){return new this.constructor().copy(this)}copy(s){return this.a.copy(s.a),this.b.copy(s.b),this.c.copy(s.c),this}getArea(){return Yo.subVectors(this.c,this.b),fc.subVectors(this.a,this.b),Yo.cross(fc).length()*.5}getMidpoint(s){return s.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(s){return wo.getNormal(this.a,this.b,this.c,s)}getPlane(s){return s.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(s,c){return wo.getBarycoord(s,this.a,this.b,this.c,c)}getUV(s,c,d,p,y){return wo.getUV(s,this.a,this.b,this.c,c,d,p,y)}containsPoint(s){return wo.containsPoint(s,this.a,this.b,this.c)}isFrontFacing(s){return wo.isFrontFacing(this.a,this.b,this.c,s)}intersectsBox(s){return s.intersectsTriangle(this)}closestPointToPoint(s,c){const d=this.a,p=this.b,y=this.c;let w,E;ld.subVectors(p,d),hd.subVectors(y,d),Jx.subVectors(s,d);const P=ld.dot(Jx),L=hd.dot(Jx);if(P<=0&&L<=0)return c.copy(d);Kx.subVectors(s,p);const O=ld.dot(Kx),k=hd.dot(Kx);if(O>=0&&k<=O)return c.copy(p);const N=P*k-O*L;if(N<=0&&P>=0&&O<=0)return w=P/(P-O),c.copy(d).addScaledVector(ld,w);Zx.subVectors(s,y);const z=ld.dot(Zx),V=hd.dot(Zx);if(V>=0&&z<=V)return c.copy(y);const H=z*L-P*V;if(H<=0&&L>=0&&V<=0)return E=L/(L-V),c.copy(d).addScaledVector(hd,E);const G=O*V-z*k;if(G<=0&&k-O>=0&&z-V>=0)return $1.subVectors(y,p),E=(k-O)/(k-O+(z-V)),c.copy(p).addScaledVector($1,E);const X=1/(G+H+N);return w=H*X,E=N*X,c.copy(d).addScaledVector(ld,w).addScaledVector(hd,E)}equals(s){return s.a.equals(this.a)&&s.b.equals(this.b)&&s.c.equals(this.c)}}let GN=0;class cr extends cc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:GN++}),this.uuid=Zr(),this.name="",this.type="Material",this.blending=b,this.side=g,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Q,this.blendDst=Y,this.blendEquation=R,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$e,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=U1,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=TA,this.stencilZFail=TA,this.stencilZPass=TA,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(s){this._alphaTest>0!=s>0&&this.version++,this._alphaTest=s}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(s){if(s!==void 0)for(const c in s){const d=s[c];if(d===void 0){console.warn("THREE.Material: '"+c+"' parameter is undefined.");continue}const p=this[c];if(p===void 0){console.warn("THREE."+this.type+": '"+c+"' is not a property of this material.");continue}p&&p.isColor?p.set(d):p&&p.isVector3&&d&&d.isVector3?p.copy(d):this[c]=d}}toJSON(s){const c=s===void 0||typeof s=="string";c&&(s={textures:{},images:{}});const d={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.color&&this.color.isColor&&(d.color=this.color.getHex()),this.roughness!==void 0&&(d.roughness=this.roughness),this.metalness!==void 0&&(d.metalness=this.metalness),this.sheen!==void 0&&(d.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(d.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(d.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(d.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(d.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(d.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(d.shininess=this.shininess),this.clearcoat!==void 0&&(d.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(d.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(d.clearcoatMap=this.clearcoatMap.toJSON(s).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(d.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(s).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(d.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(s).uuid,d.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(d.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(d.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(d.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(d.iridescenceMap=this.iridescenceMap.toJSON(s).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(d.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(s).uuid),this.map&&this.map.isTexture&&(d.map=this.map.toJSON(s).uuid),this.matcap&&this.matcap.isTexture&&(d.matcap=this.matcap.toJSON(s).uuid),this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(s).uuid),this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(s).uuid,d.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(s).uuid,d.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(s).uuid,d.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(s).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(s).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(s).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(s).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(s).uuid),this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(s).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(d.specularIntensityMap=this.specularIntensityMap.toJSON(s).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(d.specularColorMap=this.specularColorMap.toJSON(s).uuid),this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(s).uuid,this.combine!==void 0&&(d.combine=this.combine)),this.envMapIntensity!==void 0&&(d.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(d.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(d.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(s).uuid),this.transmission!==void 0&&(d.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(d.transmissionMap=this.transmissionMap.toJSON(s).uuid),this.thickness!==void 0&&(d.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(d.thicknessMap=this.thicknessMap.toJSON(s).uuid),this.attenuationDistance!==void 0&&(d.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(d.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(d.size=this.size),this.shadowSide!==null&&(d.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(d.sizeAttenuation=this.sizeAttenuation),this.blending!==b&&(d.blending=this.blending),this.side!==g&&(d.side=this.side),this.vertexColors&&(d.vertexColors=!0),this.opacity<1&&(d.opacity=this.opacity),this.transparent===!0&&(d.transparent=this.transparent),d.depthFunc=this.depthFunc,d.depthTest=this.depthTest,d.depthWrite=this.depthWrite,d.colorWrite=this.colorWrite,d.stencilWrite=this.stencilWrite,d.stencilWriteMask=this.stencilWriteMask,d.stencilFunc=this.stencilFunc,d.stencilRef=this.stencilRef,d.stencilFuncMask=this.stencilFuncMask,d.stencilFail=this.stencilFail,d.stencilZFail=this.stencilZFail,d.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(d.rotation=this.rotation),this.polygonOffset===!0&&(d.polygonOffset=!0),this.polygonOffsetFactor!==0&&(d.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(d.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(d.linewidth=this.linewidth),this.dashSize!==void 0&&(d.dashSize=this.dashSize),this.gapSize!==void 0&&(d.gapSize=this.gapSize),this.scale!==void 0&&(d.scale=this.scale),this.dithering===!0&&(d.dithering=!0),this.alphaTest>0&&(d.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(d.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(d.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(d.wireframe=this.wireframe),this.wireframeLinewidth>1&&(d.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(d.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(d.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(d.flatShading=this.flatShading),this.visible===!1&&(d.visible=!1),this.toneMapped===!1&&(d.toneMapped=!1),this.fog===!1&&(d.fog=!1),JSON.stringify(this.userData)!=="{}"&&(d.userData=this.userData);function p(y){const w=[];for(const E in y){const P=y[E];delete P.metadata,w.push(P)}return w}if(c){const y=p(s.textures),w=p(s.images);y.length>0&&(d.textures=y),w.length>0&&(d.images=w)}return d}clone(){return new this.constructor().copy(this)}copy(s){this.name=s.name,this.blending=s.blending,this.side=s.side,this.vertexColors=s.vertexColors,this.opacity=s.opacity,this.transparent=s.transparent,this.blendSrc=s.blendSrc,this.blendDst=s.blendDst,this.blendEquation=s.blendEquation,this.blendSrcAlpha=s.blendSrcAlpha,this.blendDstAlpha=s.blendDstAlpha,this.blendEquationAlpha=s.blendEquationAlpha,this.depthFunc=s.depthFunc,this.depthTest=s.depthTest,this.depthWrite=s.depthWrite,this.stencilWriteMask=s.stencilWriteMask,this.stencilFunc=s.stencilFunc,this.stencilRef=s.stencilRef,this.stencilFuncMask=s.stencilFuncMask,this.stencilFail=s.stencilFail,this.stencilZFail=s.stencilZFail,this.stencilZPass=s.stencilZPass,this.stencilWrite=s.stencilWrite;const c=s.clippingPlanes;let d=null;if(c!==null){const p=c.length;d=new Array(p);for(let y=0;y!==p;++y)d[y]=c[y].clone()}return this.clippingPlanes=d,this.clipIntersection=s.clipIntersection,this.clipShadows=s.clipShadows,this.shadowSide=s.shadowSide,this.colorWrite=s.colorWrite,this.precision=s.precision,this.polygonOffset=s.polygonOffset,this.polygonOffsetFactor=s.polygonOffsetFactor,this.polygonOffsetUnits=s.polygonOffsetUnits,this.dithering=s.dithering,this.alphaTest=s.alphaTest,this.alphaToCoverage=s.alphaToCoverage,this.premultipliedAlpha=s.premultipliedAlpha,this.visible=s.visible,this.toneMapped=s.toneMapped,this.userData=JSON.parse(JSON.stringify(s.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(s){s===!0&&this.version++}}class ol extends cr{constructor(s){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.fog=s.fog,this}}const xs=new de,VA=new gt;class Fi{constructor(s,c,d){if(Array.isArray(s))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=s,this.itemSize=c,this.count=s!==void 0?s.length/c:0,this.normalized=d===!0,this.usage=bp,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(s){s===!0&&this.version++}setUsage(s){return this.usage=s,this}copy(s){return this.name=s.name,this.array=new s.array.constructor(s.array),this.itemSize=s.itemSize,this.count=s.count,this.normalized=s.normalized,this.usage=s.usage,this}copyAt(s,c,d){s*=this.itemSize,d*=c.itemSize;for(let p=0,y=this.itemSize;p<y;p++)this.array[s+p]=c.array[d+p];return this}copyArray(s){return this.array.set(s),this}applyMatrix3(s){if(this.itemSize===2)for(let c=0,d=this.count;c<d;c++)VA.fromBufferAttribute(this,c),VA.applyMatrix3(s),this.setXY(c,VA.x,VA.y);else if(this.itemSize===3)for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.applyMatrix3(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}applyMatrix4(s){for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.applyMatrix4(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}applyNormalMatrix(s){for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.applyNormalMatrix(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}transformDirection(s){for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.transformDirection(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}set(s,c=0){return this.array.set(s,c),this}getX(s){let c=this.array[s*this.itemSize];return this.normalized&&(c=lc(c,this.array)),c}setX(s,c){return this.normalized&&(c=Oi(c,this.array)),this.array[s*this.itemSize]=c,this}getY(s){let c=this.array[s*this.itemSize+1];return this.normalized&&(c=lc(c,this.array)),c}setY(s,c){return this.normalized&&(c=Oi(c,this.array)),this.array[s*this.itemSize+1]=c,this}getZ(s){let c=this.array[s*this.itemSize+2];return this.normalized&&(c=lc(c,this.array)),c}setZ(s,c){return this.normalized&&(c=Oi(c,this.array)),this.array[s*this.itemSize+2]=c,this}getW(s){let c=this.array[s*this.itemSize+3];return this.normalized&&(c=lc(c,this.array)),c}setW(s,c){return this.normalized&&(c=Oi(c,this.array)),this.array[s*this.itemSize+3]=c,this}setXY(s,c,d){return s*=this.itemSize,this.normalized&&(c=Oi(c,this.array),d=Oi(d,this.array)),this.array[s+0]=c,this.array[s+1]=d,this}setXYZ(s,c,d,p){return s*=this.itemSize,this.normalized&&(c=Oi(c,this.array),d=Oi(d,this.array),p=Oi(p,this.array)),this.array[s+0]=c,this.array[s+1]=d,this.array[s+2]=p,this}setXYZW(s,c,d,p,y){return s*=this.itemSize,this.normalized&&(c=Oi(c,this.array),d=Oi(d,this.array),p=Oi(p,this.array),y=Oi(y,this.array)),this.array[s+0]=c,this.array[s+1]=d,this.array[s+2]=p,this.array[s+3]=y,this}onUpload(s){return this.onUploadCallback=s,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const s={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(s.name=this.name),this.usage!==bp&&(s.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(s.updateRange=this.updateRange),s}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class HN extends Fi{constructor(s,c,d){super(new Int8Array(s),c,d)}}class VN extends Fi{constructor(s,c,d){super(new Uint8Array(s),c,d)}}class WN extends Fi{constructor(s,c,d){super(new Uint8ClampedArray(s),c,d)}}class QN extends Fi{constructor(s,c,d){super(new Int16Array(s),c,d)}}class $x extends Fi{constructor(s,c,d){super(new Uint16Array(s),c,d)}}class jN extends Fi{constructor(s,c,d){super(new Int32Array(s),c,d)}}class ew extends Fi{constructor(s,c,d){super(new Uint32Array(s),c,d)}}class qN extends Fi{constructor(s,c,d){super(new Uint16Array(s),c,d),this.isFloat16BufferAttribute=!0}}class An extends Fi{constructor(s,c,d){super(new Float32Array(s),c,d)}}class XN extends Fi{constructor(s,c,d){super(new Float64Array(s),c,d)}}let YN=0;const bo=new $n,tw=new bi,ud=new de,eo=new Mh,Pp=new Mh,Gs=new de;class si extends cc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:YN++}),this.uuid=Zr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(s){return Array.isArray(s)?this.index=new(H1(s)?ew:$x)(s,1):this.index=s,this}getAttribute(s){return this.attributes[s]}setAttribute(s,c){return this.attributes[s]=c,this}deleteAttribute(s){return delete this.attributes[s],this}hasAttribute(s){return this.attributes[s]!==void 0}addGroup(s,c,d=0){this.groups.push({start:s,count:c,materialIndex:d})}clearGroups(){this.groups=[]}setDrawRange(s,c){this.drawRange.start=s,this.drawRange.count=c}applyMatrix4(s){const c=this.attributes.position;c!==void 0&&(c.applyMatrix4(s),c.needsUpdate=!0);const d=this.attributes.normal;if(d!==void 0){const y=new kr().getNormalMatrix(s);d.applyNormalMatrix(y),d.needsUpdate=!0}const p=this.attributes.tangent;return p!==void 0&&(p.transformDirection(s),p.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(s){return bo.makeRotationFromQuaternion(s),this.applyMatrix4(bo),this}rotateX(s){return bo.makeRotationX(s),this.applyMatrix4(bo),this}rotateY(s){return bo.makeRotationY(s),this.applyMatrix4(bo),this}rotateZ(s){return bo.makeRotationZ(s),this.applyMatrix4(bo),this}translate(s,c,d){return bo.makeTranslation(s,c,d),this.applyMatrix4(bo),this}scale(s,c,d){return bo.makeScale(s,c,d),this.applyMatrix4(bo),this}lookAt(s){return tw.lookAt(s),tw.updateMatrix(),this.applyMatrix4(tw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ud).negate(),this.translate(ud.x,ud.y,ud.z),this}setFromPoints(s){const c=[];for(let d=0,p=s.length;d<p;d++){const y=s[d];c.push(y.x,y.y,y.z||0)}return this.setAttribute("position",new An(c,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Mh);const s=this.attributes.position,c=this.morphAttributes.position;if(s&&s.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new de(-1/0,-1/0,-1/0),new de(1/0,1/0,1/0));return}if(s!==void 0){if(this.boundingBox.setFromBufferAttribute(s),c)for(let d=0,p=c.length;d<p;d++){const y=c[d];eo.setFromBufferAttribute(y),this.morphTargetsRelative?(Gs.addVectors(this.boundingBox.min,eo.min),this.boundingBox.expandByPoint(Gs),Gs.addVectors(this.boundingBox.max,eo.max),this.boundingBox.expandByPoint(Gs)):(this.boundingBox.expandByPoint(eo.min),this.boundingBox.expandByPoint(eo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ph);const s=this.attributes.position,c=this.morphAttributes.position;if(s&&s.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new de,1/0);return}if(s){const d=this.boundingSphere.center;if(eo.setFromBufferAttribute(s),c)for(let y=0,w=c.length;y<w;y++){const E=c[y];Pp.setFromBufferAttribute(E),this.morphTargetsRelative?(Gs.addVectors(eo.min,Pp.min),eo.expandByPoint(Gs),Gs.addVectors(eo.max,Pp.max),eo.expandByPoint(Gs)):(eo.expandByPoint(Pp.min),eo.expandByPoint(Pp.max))}eo.getCenter(d);let p=0;for(let y=0,w=s.count;y<w;y++)Gs.fromBufferAttribute(s,y),p=Math.max(p,d.distanceToSquared(Gs));if(c)for(let y=0,w=c.length;y<w;y++){const E=c[y],P=this.morphTargetsRelative;for(let L=0,O=E.count;L<O;L++)Gs.fromBufferAttribute(E,L),P&&(ud.fromBufferAttribute(s,L),Gs.add(ud)),p=Math.max(p,d.distanceToSquared(Gs))}this.boundingSphere.radius=Math.sqrt(p),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const s=this.index,c=this.attributes;if(s===null||c.position===void 0||c.normal===void 0||c.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const d=s.array,p=c.position.array,y=c.normal.array,w=c.uv.array,E=p.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Fi(new Float32Array(4*E),4));const P=this.getAttribute("tangent").array,L=[],O=[];for(let Te=0;Te<E;Te++)L[Te]=new de,O[Te]=new de;const k=new de,N=new de,z=new de,V=new gt,H=new gt,G=new gt,X=new de,K=new de;function ne(Te,et,It){k.fromArray(p,Te*3),N.fromArray(p,et*3),z.fromArray(p,It*3),V.fromArray(w,Te*2),H.fromArray(w,et*2),G.fromArray(w,It*2),N.sub(k),z.sub(k),H.sub(V),G.sub(V);const Ye=1/(H.x*G.y-G.x*H.y);!isFinite(Ye)||(X.copy(N).multiplyScalar(G.y).addScaledVector(z,-H.y).multiplyScalar(Ye),K.copy(z).multiplyScalar(H.x).addScaledVector(N,-G.x).multiplyScalar(Ye),L[Te].add(X),L[et].add(X),L[It].add(X),O[Te].add(K),O[et].add(K),O[It].add(K))}let te=this.groups;te.length===0&&(te=[{start:0,count:d.length}]);for(let Te=0,et=te.length;Te<et;++Te){const It=te[Te],Ye=It.start,Fe=It.count;for(let rt=Ye,At=Ye+Fe;rt<At;rt+=3)ne(d[rt+0],d[rt+1],d[rt+2])}const oe=new de,ue=new de,Ce=new de,$=new de;function ge(Te){Ce.fromArray(y,Te*3),$.copy(Ce);const et=L[Te];oe.copy(et),oe.sub(Ce.multiplyScalar(Ce.dot(et))).normalize(),ue.crossVectors($,et);const Ye=ue.dot(O[Te])<0?-1:1;P[Te*4]=oe.x,P[Te*4+1]=oe.y,P[Te*4+2]=oe.z,P[Te*4+3]=Ye}for(let Te=0,et=te.length;Te<et;++Te){const It=te[Te],Ye=It.start,Fe=It.count;for(let rt=Ye,At=Ye+Fe;rt<At;rt+=3)ge(d[rt+0]),ge(d[rt+1]),ge(d[rt+2])}}computeVertexNormals(){const s=this.index,c=this.getAttribute("position");if(c!==void 0){let d=this.getAttribute("normal");if(d===void 0)d=new Fi(new Float32Array(c.count*3),3),this.setAttribute("normal",d);else for(let N=0,z=d.count;N<z;N++)d.setXYZ(N,0,0,0);const p=new de,y=new de,w=new de,E=new de,P=new de,L=new de,O=new de,k=new de;if(s)for(let N=0,z=s.count;N<z;N+=3){const V=s.getX(N+0),H=s.getX(N+1),G=s.getX(N+2);p.fromBufferAttribute(c,V),y.fromBufferAttribute(c,H),w.fromBufferAttribute(c,G),O.subVectors(w,y),k.subVectors(p,y),O.cross(k),E.fromBufferAttribute(d,V),P.fromBufferAttribute(d,H),L.fromBufferAttribute(d,G),E.add(O),P.add(O),L.add(O),d.setXYZ(V,E.x,E.y,E.z),d.setXYZ(H,P.x,P.y,P.z),d.setXYZ(G,L.x,L.y,L.z)}else for(let N=0,z=c.count;N<z;N+=3)p.fromBufferAttribute(c,N+0),y.fromBufferAttribute(c,N+1),w.fromBufferAttribute(c,N+2),O.subVectors(w,y),k.subVectors(p,y),O.cross(k),d.setXYZ(N+0,O.x,O.y,O.z),d.setXYZ(N+1,O.x,O.y,O.z),d.setXYZ(N+2,O.x,O.y,O.z);this.normalizeNormals(),d.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const s=this.attributes.normal;for(let c=0,d=s.count;c<d;c++)Gs.fromBufferAttribute(s,c),Gs.normalize(),s.setXYZ(c,Gs.x,Gs.y,Gs.z)}toNonIndexed(){function s(E,P){const L=E.array,O=E.itemSize,k=E.normalized,N=new L.constructor(P.length*O);let z=0,V=0;for(let H=0,G=P.length;H<G;H++){E.isInterleavedBufferAttribute?z=P[H]*E.data.stride+E.offset:z=P[H]*O;for(let X=0;X<O;X++)N[V++]=L[z++]}return new Fi(N,O,k)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const c=new si,d=this.index.array,p=this.attributes;for(const E in p){const P=p[E],L=s(P,d);c.setAttribute(E,L)}const y=this.morphAttributes;for(const E in y){const P=[],L=y[E];for(let O=0,k=L.length;O<k;O++){const N=L[O],z=s(N,d);P.push(z)}c.morphAttributes[E]=P}c.morphTargetsRelative=this.morphTargetsRelative;const w=this.groups;for(let E=0,P=w.length;E<P;E++){const L=w[E];c.addGroup(L.start,L.count,L.materialIndex)}return c}toJSON(){const s={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),Object.keys(this.userData).length>0&&(s.userData=this.userData),this.parameters!==void 0){const P=this.parameters;for(const L in P)P[L]!==void 0&&(s[L]=P[L]);return s}s.data={attributes:{}};const c=this.index;c!==null&&(s.data.index={type:c.array.constructor.name,array:Array.prototype.slice.call(c.array)});const d=this.attributes;for(const P in d){const L=d[P];s.data.attributes[P]=L.toJSON(s.data)}const p={};let y=!1;for(const P in this.morphAttributes){const L=this.morphAttributes[P],O=[];for(let k=0,N=L.length;k<N;k++){const z=L[k];O.push(z.toJSON(s.data))}O.length>0&&(p[P]=O,y=!0)}y&&(s.data.morphAttributes=p,s.data.morphTargetsRelative=this.morphTargetsRelative);const w=this.groups;w.length>0&&(s.data.groups=JSON.parse(JSON.stringify(w)));const E=this.boundingSphere;return E!==null&&(s.data.boundingSphere={center:E.center.toArray(),radius:E.radius}),s}clone(){return new this.constructor().copy(this)}copy(s){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const c={};this.name=s.name;const d=s.index;d!==null&&this.setIndex(d.clone(c));const p=s.attributes;for(const L in p){const O=p[L];this.setAttribute(L,O.clone(c))}const y=s.morphAttributes;for(const L in y){const O=[],k=y[L];for(let N=0,z=k.length;N<z;N++)O.push(k[N].clone(c));this.morphAttributes[L]=O}this.morphTargetsRelative=s.morphTargetsRelative;const w=s.groups;for(let L=0,O=w.length;L<O;L++){const k=w[L];this.addGroup(k.start,k.count,k.materialIndex)}const E=s.boundingBox;E!==null&&(this.boundingBox=E.clone());const P=s.boundingSphere;return P!==null&&(this.boundingSphere=P.clone()),this.drawRange.start=s.drawRange.start,this.drawRange.count=s.drawRange.count,this.userData=s.userData,s.parameters!==void 0&&(this.parameters=Object.assign({},s.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const eT=new $n,dd=new Ip,nw=new Ph,al=new de,cl=new de,ll=new de,iw=new de,sw=new de,rw=new de,WA=new de,QA=new de,jA=new de,qA=new gt,XA=new gt,YA=new gt,ow=new de,JA=new de;class Js extends bi{constructor(s=new si,c=new ol){super(),this.isMesh=!0,this.type="Mesh",this.geometry=s,this.material=c,this.updateMorphTargets()}copy(s,c){return super.copy(s,c),s.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=s.morphTargetInfluences.slice()),s.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},s.morphTargetDictionary)),this.material=s.material,this.geometry=s.geometry,this}updateMorphTargets(){const c=this.geometry.morphAttributes,d=Object.keys(c);if(d.length>0){const p=c[d[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let y=0,w=p.length;y<w;y++){const E=p[y].name||String(y);this.morphTargetInfluences.push(0),this.morphTargetDictionary[E]=y}}}}raycast(s,c){const d=this.geometry,p=this.material,y=this.matrixWorld;if(p===void 0||(d.boundingSphere===null&&d.computeBoundingSphere(),nw.copy(d.boundingSphere),nw.applyMatrix4(y),s.ray.intersectsSphere(nw)===!1)||(eT.copy(y).invert(),dd.copy(s.ray).applyMatrix4(eT),d.boundingBox!==null&&dd.intersectsBox(d.boundingBox)===!1))return;let w;const E=d.index,P=d.attributes.position,L=d.morphAttributes.position,O=d.morphTargetsRelative,k=d.attributes.uv,N=d.attributes.uv2,z=d.groups,V=d.drawRange;if(E!==null)if(Array.isArray(p))for(let H=0,G=z.length;H<G;H++){const X=z[H],K=p[X.materialIndex],ne=Math.max(X.start,V.start),te=Math.min(E.count,Math.min(X.start+X.count,V.start+V.count));for(let oe=ne,ue=te;oe<ue;oe+=3){const Ce=E.getX(oe),$=E.getX(oe+1),ge=E.getX(oe+2);w=KA(this,K,s,dd,P,L,O,k,N,Ce,$,ge),w&&(w.faceIndex=Math.floor(oe/3),w.face.materialIndex=X.materialIndex,c.push(w))}}else{const H=Math.max(0,V.start),G=Math.min(E.count,V.start+V.count);for(let X=H,K=G;X<K;X+=3){const ne=E.getX(X),te=E.getX(X+1),oe=E.getX(X+2);w=KA(this,p,s,dd,P,L,O,k,N,ne,te,oe),w&&(w.faceIndex=Math.floor(X/3),c.push(w))}}else if(P!==void 0)if(Array.isArray(p))for(let H=0,G=z.length;H<G;H++){const X=z[H],K=p[X.materialIndex],ne=Math.max(X.start,V.start),te=Math.min(P.count,Math.min(X.start+X.count,V.start+V.count));for(let oe=ne,ue=te;oe<ue;oe+=3){const Ce=oe,$=oe+1,ge=oe+2;w=KA(this,K,s,dd,P,L,O,k,N,Ce,$,ge),w&&(w.faceIndex=Math.floor(oe/3),w.face.materialIndex=X.materialIndex,c.push(w))}}else{const H=Math.max(0,V.start),G=Math.min(P.count,V.start+V.count);for(let X=H,K=G;X<K;X+=3){const ne=X,te=X+1,oe=X+2;w=KA(this,p,s,dd,P,L,O,k,N,ne,te,oe),w&&(w.faceIndex=Math.floor(X/3),c.push(w))}}}}function JN(_,s,c,d,p,y,w,E){let P;if(s.side===m?P=d.intersectTriangle(w,y,p,!0,E):P=d.intersectTriangle(p,y,w,s.side!==A,E),P===null)return null;JA.copy(E),JA.applyMatrix4(_.matrixWorld);const L=c.ray.origin.distanceTo(JA);return L<c.near||L>c.far?null:{distance:L,point:JA.clone(),object:_}}function KA(_,s,c,d,p,y,w,E,P,L,O,k){al.fromBufferAttribute(p,L),cl.fromBufferAttribute(p,O),ll.fromBufferAttribute(p,k);const N=_.morphTargetInfluences;if(y&&N){WA.set(0,0,0),QA.set(0,0,0),jA.set(0,0,0);for(let V=0,H=y.length;V<H;V++){const G=N[V],X=y[V];G!==0&&(iw.fromBufferAttribute(X,L),sw.fromBufferAttribute(X,O),rw.fromBufferAttribute(X,k),w?(WA.addScaledVector(iw,G),QA.addScaledVector(sw,G),jA.addScaledVector(rw,G)):(WA.addScaledVector(iw.sub(al),G),QA.addScaledVector(sw.sub(cl),G),jA.addScaledVector(rw.sub(ll),G)))}al.add(WA),cl.add(QA),ll.add(jA)}_.isSkinnedMesh&&(_.boneTransform(L,al),_.boneTransform(O,cl),_.boneTransform(k,ll));const z=JN(_,s,c,d,al,cl,ll,ow);if(z){E&&(qA.fromBufferAttribute(E,L),XA.fromBufferAttribute(E,O),YA.fromBufferAttribute(E,k),z.uv=wo.getUV(ow,al,cl,ll,qA,XA,YA,new gt)),P&&(qA.fromBufferAttribute(P,L),XA.fromBufferAttribute(P,O),YA.fromBufferAttribute(P,k),z.uv2=wo.getUV(ow,al,cl,ll,qA,XA,YA,new gt));const V={a:L,b:O,c:k,normal:new de,materialIndex:0};wo.getNormal(al,cl,ll,V.normal),z.face=V}return z}class hl extends si{constructor(s=1,c=1,d=1,p=1,y=1,w=1){super(),this.type="BoxGeometry",this.parameters={width:s,height:c,depth:d,widthSegments:p,heightSegments:y,depthSegments:w};const E=this;p=Math.floor(p),y=Math.floor(y),w=Math.floor(w);const P=[],L=[],O=[],k=[];let N=0,z=0;V("z","y","x",-1,-1,d,c,s,w,y,0),V("z","y","x",1,-1,d,c,-s,w,y,1),V("x","z","y",1,1,s,d,c,p,w,2),V("x","z","y",1,-1,s,d,-c,p,w,3),V("x","y","z",1,-1,s,c,d,p,y,4),V("x","y","z",-1,-1,s,c,-d,p,y,5),this.setIndex(P),this.setAttribute("position",new An(L,3)),this.setAttribute("normal",new An(O,3)),this.setAttribute("uv",new An(k,2));function V(H,G,X,K,ne,te,oe,ue,Ce,$,ge){const Te=te/Ce,et=oe/$,It=te/2,Ye=oe/2,Fe=ue/2,rt=Ce+1,At=$+1;let St=0,at=0;const Qe=new de;for(let Je=0;Je<At;Je++){const Rt=Je*et-Ye;for(let Pt=0;Pt<rt;Pt++){const Lt=Pt*Te-It;Qe[H]=Lt*K,Qe[G]=Rt*ne,Qe[X]=Fe,L.push(Qe.x,Qe.y,Qe.z),Qe[H]=0,Qe[G]=0,Qe[X]=ue>0?1:-1,O.push(Qe.x,Qe.y,Qe.z),k.push(Pt/Ce),k.push(1-Je/$),St+=1}}for(let Je=0;Je<$;Je++)for(let Rt=0;Rt<Ce;Rt++){const Pt=N+Rt+rt*Je,Lt=N+Rt+rt*(Je+1),yn=N+(Rt+1)+rt*(Je+1),Hn=N+(Rt+1)+rt*Je;P.push(Pt,Lt,Hn),P.push(Lt,yn,Hn),at+=6}E.addGroup(z,at,ge),z+=at,N+=St}}static fromJSON(s){return new hl(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments)}}function fd(_){const s={};for(const c in _){s[c]={};for(const d in _[c]){const p=_[c][d];p&&(p.isColor||p.isMatrix3||p.isMatrix4||p.isVector2||p.isVector3||p.isVector4||p.isTexture||p.isQuaternion)?s[c][d]=p.clone():Array.isArray(p)?s[c][d]=p.slice():s[c][d]=p}}return s}function lr(_){const s={};for(let c=0;c<_.length;c++){const d=fd(_[c]);for(const p in d)s[p]=d[p]}return s}function KN(_){const s=[];for(let c=0;c<_.length;c++)s.push(_[c].clone());return s}const tT={clone:fd,merge:lr};var ZN=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,$N=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ea extends cr{constructor(s){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ZN,this.fragmentShader=$N,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,s!==void 0&&this.setValues(s)}copy(s){return super.copy(s),this.fragmentShader=s.fragmentShader,this.vertexShader=s.vertexShader,this.uniforms=fd(s.uniforms),this.uniformsGroups=KN(s.uniformsGroups),this.defines=Object.assign({},s.defines),this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.fog=s.fog,this.lights=s.lights,this.clipping=s.clipping,this.extensions=Object.assign({},s.extensions),this.glslVersion=s.glslVersion,this}toJSON(s){const c=super.toJSON(s);c.glslVersion=this.glslVersion,c.uniforms={};for(const p in this.uniforms){const w=this.uniforms[p].value;w&&w.isTexture?c.uniforms[p]={type:"t",value:w.toJSON(s).uuid}:w&&w.isColor?c.uniforms[p]={type:"c",value:w.getHex()}:w&&w.isVector2?c.uniforms[p]={type:"v2",value:w.toArray()}:w&&w.isVector3?c.uniforms[p]={type:"v3",value:w.toArray()}:w&&w.isVector4?c.uniforms[p]={type:"v4",value:w.toArray()}:w&&w.isMatrix3?c.uniforms[p]={type:"m3",value:w.toArray()}:w&&w.isMatrix4?c.uniforms[p]={type:"m4",value:w.toArray()}:c.uniforms[p]={value:w}}Object.keys(this.defines).length>0&&(c.defines=this.defines),c.vertexShader=this.vertexShader,c.fragmentShader=this.fragmentShader;const d={};for(const p in this.extensions)this.extensions[p]===!0&&(d[p]=!0);return Object.keys(d).length>0&&(c.extensions=d),c}}class ZA extends bi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new $n,this.projectionMatrix=new $n,this.projectionMatrixInverse=new $n}copy(s,c){return super.copy(s,c),this.matrixWorldInverse.copy(s.matrixWorldInverse),this.projectionMatrix.copy(s.projectionMatrix),this.projectionMatrixInverse.copy(s.projectionMatrixInverse),this}getWorldDirection(s){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return s.set(-c[8],-c[9],-c[10]).normalize()}updateMatrixWorld(s){super.updateMatrixWorld(s),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(s,c){super.updateWorldMatrix(s,c),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Ks extends ZA{constructor(s=50,c=1,d=.1,p=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=s,this.zoom=1,this.near=d,this.far=p,this.focus=10,this.aspect=c,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(s,c){return super.copy(s,c),this.fov=s.fov,this.zoom=s.zoom,this.near=s.near,this.far=s.far,this.focus=s.focus,this.aspect=s.aspect,this.view=s.view===null?null:Object.assign({},s.view),this.filmGauge=s.filmGauge,this.filmOffset=s.filmOffset,this}setFocalLength(s){const c=.5*this.getFilmHeight()/s;this.fov=Cp*2*Math.atan(c),this.updateProjectionMatrix()}getFocalLength(){const s=Math.tan(Ch*.5*this.fov);return .5*this.getFilmHeight()/s}getEffectiveFOV(){return Cp*2*Math.atan(Math.tan(Ch*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(s,c,d,p,y,w){this.aspect=s/c,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=s,this.view.fullHeight=c,this.view.offsetX=d,this.view.offsetY=p,this.view.width=y,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const s=this.near;let c=s*Math.tan(Ch*.5*this.fov)/this.zoom,d=2*c,p=this.aspect*d,y=-.5*p;const w=this.view;if(this.view!==null&&this.view.enabled){const P=w.fullWidth,L=w.fullHeight;y+=w.offsetX*p/P,c-=w.offsetY*d/L,p*=w.width/P,d*=w.height/L}const E=this.filmOffset;E!==0&&(y+=s*E/this.getFilmWidth()),this.projectionMatrix.makePerspective(y,y+p,c,c-d,s,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(s){const c=super.toJSON(s);return c.object.fov=this.fov,c.object.zoom=this.zoom,c.object.near=this.near,c.object.far=this.far,c.object.focus=this.focus,c.object.aspect=this.aspect,this.view!==null&&(c.object.view=Object.assign({},this.view)),c.object.filmGauge=this.filmGauge,c.object.filmOffset=this.filmOffset,c}}const pd=90,md=1;class nT extends bi{constructor(s,c,d){super(),this.type="CubeCamera",this.renderTarget=d;const p=new Ks(pd,md,s,c);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new de(1,0,0)),this.add(p);const y=new Ks(pd,md,s,c);y.layers=this.layers,y.up.set(0,-1,0),y.lookAt(new de(-1,0,0)),this.add(y);const w=new Ks(pd,md,s,c);w.layers=this.layers,w.up.set(0,0,1),w.lookAt(new de(0,1,0)),this.add(w);const E=new Ks(pd,md,s,c);E.layers=this.layers,E.up.set(0,0,-1),E.lookAt(new de(0,-1,0)),this.add(E);const P=new Ks(pd,md,s,c);P.layers=this.layers,P.up.set(0,-1,0),P.lookAt(new de(0,0,1)),this.add(P);const L=new Ks(pd,md,s,c);L.layers=this.layers,L.up.set(0,-1,0),L.lookAt(new de(0,0,-1)),this.add(L)}update(s,c){this.parent===null&&this.updateMatrixWorld();const d=this.renderTarget,[p,y,w,E,P,L]=this.children,O=s.getRenderTarget(),k=s.toneMapping,N=s.xr.enabled;s.toneMapping=vn,s.xr.enabled=!1;const z=d.texture.generateMipmaps;d.texture.generateMipmaps=!1,s.setRenderTarget(d,0),s.render(c,p),s.setRenderTarget(d,1),s.render(c,y),s.setRenderTarget(d,2),s.render(c,w),s.setRenderTarget(d,3),s.render(c,E),s.setRenderTarget(d,4),s.render(c,P),d.texture.generateMipmaps=z,s.setRenderTarget(d,5),s.render(c,L),s.setRenderTarget(O),s.toneMapping=k,s.xr.enabled=N,d.texture.needsPMREMUpdate=!0}}class Bp extends Rs{constructor(s,c,d,p,y,w,E,P,L,O){s=s!==void 0?s:[],c=c!==void 0?c:Kt,super(s,c,d,p,y,w,E,P,L,O),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(s){this.image=s}}class iT extends xo{constructor(s,c={}){super(s,s,c),this.isWebGLCubeRenderTarget=!0;const d={width:s,height:s,depth:1},p=[d,d,d,d,d,d];this.texture=new Bp(p,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=c.generateMipmaps!==void 0?c.generateMipmaps:!1,this.texture.minFilter=c.minFilter!==void 0?c.minFilter:Et}fromEquirectangularTexture(s,c){this.texture.type=c.type,this.texture.encoding=c.encoding,this.texture.generateMipmaps=c.generateMipmaps,this.texture.minFilter=c.minFilter,this.texture.magFilter=c.magFilter;const d={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},p=new hl(5,5,5),y=new Ea({name:"CubemapFromEquirect",uniforms:fd(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,side:m,blending:v});y.uniforms.tEquirect.value=c;const w=new Js(p,y),E=c.minFilter;return c.minFilter===Wt&&(c.minFilter=Et),new nT(1,10,this).update(s,w),c.minFilter=E,w.geometry.dispose(),w.material.dispose(),this}clear(s,c,d,p){const y=s.getRenderTarget();for(let w=0;w<6;w++)s.setRenderTarget(this,w),s.clear(c,d,p);s.setRenderTarget(y)}}const aw=new de,eU=new de,tU=new kr;class ul{constructor(s=new de(1,0,0),c=0){this.isPlane=!0,this.normal=s,this.constant=c}set(s,c){return this.normal.copy(s),this.constant=c,this}setComponents(s,c,d,p){return this.normal.set(s,c,d),this.constant=p,this}setFromNormalAndCoplanarPoint(s,c){return this.normal.copy(s),this.constant=-c.dot(this.normal),this}setFromCoplanarPoints(s,c,d){const p=aw.subVectors(d,c).cross(eU.subVectors(s,c)).normalize();return this.setFromNormalAndCoplanarPoint(p,s),this}copy(s){return this.normal.copy(s.normal),this.constant=s.constant,this}normalize(){const s=1/this.normal.length();return this.normal.multiplyScalar(s),this.constant*=s,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(s){return this.normal.dot(s)+this.constant}distanceToSphere(s){return this.distanceToPoint(s.center)-s.radius}projectPoint(s,c){return c.copy(this.normal).multiplyScalar(-this.distanceToPoint(s)).add(s)}intersectLine(s,c){const d=s.delta(aw),p=this.normal.dot(d);if(p===0)return this.distanceToPoint(s.start)===0?c.copy(s.start):null;const y=-(s.start.dot(this.normal)+this.constant)/p;return y<0||y>1?null:c.copy(d).multiplyScalar(y).add(s.start)}intersectsLine(s){const c=this.distanceToPoint(s.start),d=this.distanceToPoint(s.end);return c<0&&d>0||d<0&&c>0}intersectsBox(s){return s.intersectsPlane(this)}intersectsSphere(s){return s.intersectsPlane(this)}coplanarPoint(s){return s.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(s,c){const d=c||tU.getNormalMatrix(s),p=this.coplanarPoint(aw).applyMatrix4(s),y=this.normal.applyMatrix3(d).normalize();return this.constant=-p.dot(y),this}translate(s){return this.constant-=s.dot(this.normal),this}equals(s){return s.normal.equals(this.normal)&&s.constant===this.constant}clone(){return new this.constructor().copy(this)}}const gd=new Ph,$A=new de;class e0{constructor(s=new ul,c=new ul,d=new ul,p=new ul,y=new ul,w=new ul){this.planes=[s,c,d,p,y,w]}set(s,c,d,p,y,w){const E=this.planes;return E[0].copy(s),E[1].copy(c),E[2].copy(d),E[3].copy(p),E[4].copy(y),E[5].copy(w),this}copy(s){const c=this.planes;for(let d=0;d<6;d++)c[d].copy(s.planes[d]);return this}setFromProjectionMatrix(s){const c=this.planes,d=s.elements,p=d[0],y=d[1],w=d[2],E=d[3],P=d[4],L=d[5],O=d[6],k=d[7],N=d[8],z=d[9],V=d[10],H=d[11],G=d[12],X=d[13],K=d[14],ne=d[15];return c[0].setComponents(E-p,k-P,H-N,ne-G).normalize(),c[1].setComponents(E+p,k+P,H+N,ne+G).normalize(),c[2].setComponents(E+y,k+L,H+z,ne+X).normalize(),c[3].setComponents(E-y,k-L,H-z,ne-X).normalize(),c[4].setComponents(E-w,k-O,H-V,ne-K).normalize(),c[5].setComponents(E+w,k+O,H+V,ne+K).normalize(),this}intersectsObject(s){const c=s.geometry;return c.boundingSphere===null&&c.computeBoundingSphere(),gd.copy(c.boundingSphere).applyMatrix4(s.matrixWorld),this.intersectsSphere(gd)}intersectsSprite(s){return gd.center.set(0,0,0),gd.radius=.7071067811865476,gd.applyMatrix4(s.matrixWorld),this.intersectsSphere(gd)}intersectsSphere(s){const c=this.planes,d=s.center,p=-s.radius;for(let y=0;y<6;y++)if(c[y].distanceToPoint(d)<p)return!1;return!0}intersectsBox(s){const c=this.planes;for(let d=0;d<6;d++){const p=c[d];if($A.x=p.normal.x>0?s.max.x:s.min.x,$A.y=p.normal.y>0?s.max.y:s.min.y,$A.z=p.normal.z>0?s.max.z:s.min.z,p.distanceToPoint($A)<0)return!1}return!0}containsPoint(s){const c=this.planes;for(let d=0;d<6;d++)if(c[d].distanceToPoint(s)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function sT(){let _=null,s=!1,c=null,d=null;function p(y,w){c(y,w),d=_.requestAnimationFrame(p)}return{start:function(){s!==!0&&c!==null&&(d=_.requestAnimationFrame(p),s=!0)},stop:function(){_.cancelAnimationFrame(d),s=!1},setAnimationLoop:function(y){c=y},setContext:function(y){_=y}}}function nU(_,s){const c=s.isWebGL2,d=new WeakMap;function p(L,O){const k=L.array,N=L.usage,z=_.createBuffer();_.bindBuffer(O,z),_.bufferData(O,k,N),L.onUploadCallback();let V;if(k instanceof Float32Array)V=_.FLOAT;else if(k instanceof Uint16Array)if(L.isFloat16BufferAttribute)if(c)V=_.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else V=_.UNSIGNED_SHORT;else if(k instanceof Int16Array)V=_.SHORT;else if(k instanceof Uint32Array)V=_.UNSIGNED_INT;else if(k instanceof Int32Array)V=_.INT;else if(k instanceof Int8Array)V=_.BYTE;else if(k instanceof Uint8Array)V=_.UNSIGNED_BYTE;else if(k instanceof Uint8ClampedArray)V=_.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+k);return{buffer:z,type:V,bytesPerElement:k.BYTES_PER_ELEMENT,version:L.version}}function y(L,O,k){const N=O.array,z=O.updateRange;_.bindBuffer(k,L),z.count===-1?_.bufferSubData(k,0,N):(c?_.bufferSubData(k,z.offset*N.BYTES_PER_ELEMENT,N,z.offset,z.count):_.bufferSubData(k,z.offset*N.BYTES_PER_ELEMENT,N.subarray(z.offset,z.offset+z.count)),z.count=-1)}function w(L){return L.isInterleavedBufferAttribute&&(L=L.data),d.get(L)}function E(L){L.isInterleavedBufferAttribute&&(L=L.data);const O=d.get(L);O&&(_.deleteBuffer(O.buffer),d.delete(L))}function P(L,O){if(L.isGLBufferAttribute){const N=d.get(L);(!N||N.version<L.version)&&d.set(L,{buffer:L.buffer,type:L.type,bytesPerElement:L.elementSize,version:L.version});return}L.isInterleavedBufferAttribute&&(L=L.data);const k=d.get(L);k===void 0?d.set(L,p(L,O)):k.version<L.version&&(y(k.buffer,L,O),k.version=L.version)}return{get:w,remove:E,update:P}}class Ad extends si{constructor(s=1,c=1,d=1,p=1){super(),this.type="PlaneGeometry",this.parameters={width:s,height:c,widthSegments:d,heightSegments:p};const y=s/2,w=c/2,E=Math.floor(d),P=Math.floor(p),L=E+1,O=P+1,k=s/E,N=c/P,z=[],V=[],H=[],G=[];for(let X=0;X<O;X++){const K=X*N-w;for(let ne=0;ne<L;ne++){const te=ne*k-y;V.push(te,-K,0),H.push(0,0,1),G.push(ne/E),G.push(1-X/P)}}for(let X=0;X<P;X++)for(let K=0;K<E;K++){const ne=K+L*X,te=K+L*(X+1),oe=K+1+L*(X+1),ue=K+1+L*X;z.push(ne,te,ue),z.push(te,oe,ue)}this.setIndex(z),this.setAttribute("position",new An(V,3)),this.setAttribute("normal",new An(H,3)),this.setAttribute("uv",new An(G,2))}static fromJSON(s){return new Ad(s.width,s.height,s.widthSegments,s.heightSegments)}}var iU=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,sU=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,rU=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,oU=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aU=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,cU=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,lU="vec3 transformed = vec3( position );",hU=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,uU=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
		float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
		float x2 = x * x;
		float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
		return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,dU=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,	0.0556434,
		-1.5371385,	1.8760108, -0.2040259,
		-0.4985314,	0.0415560,	1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,fU=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,pU=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,mU=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,gU=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,AU=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,yU=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,_U=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,vU=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,xU=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,wU=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,bU=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,CU=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,EU=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,SU=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,MU=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,TU=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,IU="gl_FragColor = linearToOutputTexel( gl_FragColor );",RU=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,PU=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,BU=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,LU=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,DU=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,OU=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,FU=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,kU=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,NU=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,UU=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,zU=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,GU=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,HU=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,VU=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,WU=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,QU=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,jU=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,qU=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,XU=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,YU=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,JU=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,KU=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,ZU=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,$U=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ez=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,tz=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,nz=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,iz=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,sz=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,rz=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,oz=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,az=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,cz=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,lz=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hz=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,uz=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,dz=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,fz=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,pz=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,mz=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,gz=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Az=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,yz=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,_z=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,vz=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,xz=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,wz=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,bz=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Cz=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Ez=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Sz=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Mz=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Tz=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Iz=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Rz=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Pz=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Bz=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Lz=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Dz=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Oz=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Fz=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,kz=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Nz=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Uz=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,zz=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Gz=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Hz=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Vz=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Wz=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Qz=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,jz=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,qz=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Xz=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Yz=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Jz=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Kz=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Zz=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,$z=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,eG=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const oi={alphamap_fragment:iU,alphamap_pars_fragment:sU,alphatest_fragment:rU,alphatest_pars_fragment:oU,aomap_fragment:aU,aomap_pars_fragment:cU,begin_vertex:lU,beginnormal_vertex:hU,bsdfs:uU,iridescence_fragment:dU,bumpmap_pars_fragment:fU,clipping_planes_fragment:pU,clipping_planes_pars_fragment:mU,clipping_planes_pars_vertex:gU,clipping_planes_vertex:AU,color_fragment:yU,color_pars_fragment:_U,color_pars_vertex:vU,color_vertex:xU,common:wU,cube_uv_reflection_fragment:bU,defaultnormal_vertex:CU,displacementmap_pars_vertex:EU,displacementmap_vertex:SU,emissivemap_fragment:MU,emissivemap_pars_fragment:TU,encodings_fragment:IU,encodings_pars_fragment:RU,envmap_fragment:PU,envmap_common_pars_fragment:BU,envmap_pars_fragment:LU,envmap_pars_vertex:DU,envmap_physical_pars_fragment:jU,envmap_vertex:OU,fog_vertex:FU,fog_pars_vertex:kU,fog_fragment:NU,fog_pars_fragment:UU,gradientmap_pars_fragment:zU,lightmap_fragment:GU,lightmap_pars_fragment:HU,lights_lambert_fragment:VU,lights_lambert_pars_fragment:WU,lights_pars_begin:QU,lights_toon_fragment:qU,lights_toon_pars_fragment:XU,lights_phong_fragment:YU,lights_phong_pars_fragment:JU,lights_physical_fragment:KU,lights_physical_pars_fragment:ZU,lights_fragment_begin:$U,lights_fragment_maps:ez,lights_fragment_end:tz,logdepthbuf_fragment:nz,logdepthbuf_pars_fragment:iz,logdepthbuf_pars_vertex:sz,logdepthbuf_vertex:rz,map_fragment:oz,map_pars_fragment:az,map_particle_fragment:cz,map_particle_pars_fragment:lz,metalnessmap_fragment:hz,metalnessmap_pars_fragment:uz,morphcolor_vertex:dz,morphnormal_vertex:fz,morphtarget_pars_vertex:pz,morphtarget_vertex:mz,normal_fragment_begin:gz,normal_fragment_maps:Az,normal_pars_fragment:yz,normal_pars_vertex:_z,normal_vertex:vz,normalmap_pars_fragment:xz,clearcoat_normal_fragment_begin:wz,clearcoat_normal_fragment_maps:bz,clearcoat_pars_fragment:Cz,iridescence_pars_fragment:Ez,output_fragment:Sz,packing:Mz,premultiplied_alpha_fragment:Tz,project_vertex:Iz,dithering_fragment:Rz,dithering_pars_fragment:Pz,roughnessmap_fragment:Bz,roughnessmap_pars_fragment:Lz,shadowmap_pars_fragment:Dz,shadowmap_pars_vertex:Oz,shadowmap_vertex:Fz,shadowmask_pars_fragment:kz,skinbase_vertex:Nz,skinning_pars_vertex:Uz,skinning_vertex:zz,skinnormal_vertex:Gz,specularmap_fragment:Hz,specularmap_pars_fragment:Vz,tonemapping_fragment:Wz,tonemapping_pars_fragment:Qz,transmission_fragment:jz,transmission_pars_fragment:qz,uv_pars_fragment:Xz,uv_pars_vertex:Yz,uv_vertex:Jz,uv2_pars_fragment:Kz,uv2_pars_vertex:Zz,uv2_vertex:$z,worldpos_vertex:eG,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Qt={common:{diffuse:{value:new dn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new kr},uv2Transform:{value:new kr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new gt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new kr}},sprite:{diffuse:{value:new dn(16777215)},opacity:{value:1},center:{value:new gt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new kr}}},Jo={basic:{uniforms:lr([Qt.common,Qt.specularmap,Qt.envmap,Qt.aomap,Qt.lightmap,Qt.fog]),vertexShader:oi.meshbasic_vert,fragmentShader:oi.meshbasic_frag},lambert:{uniforms:lr([Qt.common,Qt.specularmap,Qt.envmap,Qt.aomap,Qt.lightmap,Qt.emissivemap,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,Qt.fog,Qt.lights,{emissive:{value:new dn(0)}}]),vertexShader:oi.meshlambert_vert,fragmentShader:oi.meshlambert_frag},phong:{uniforms:lr([Qt.common,Qt.specularmap,Qt.envmap,Qt.aomap,Qt.lightmap,Qt.emissivemap,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,Qt.fog,Qt.lights,{emissive:{value:new dn(0)},specular:{value:new dn(1118481)},shininess:{value:30}}]),vertexShader:oi.meshphong_vert,fragmentShader:oi.meshphong_frag},standard:{uniforms:lr([Qt.common,Qt.envmap,Qt.aomap,Qt.lightmap,Qt.emissivemap,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,Qt.roughnessmap,Qt.metalnessmap,Qt.fog,Qt.lights,{emissive:{value:new dn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag},toon:{uniforms:lr([Qt.common,Qt.aomap,Qt.lightmap,Qt.emissivemap,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,Qt.gradientmap,Qt.fog,Qt.lights,{emissive:{value:new dn(0)}}]),vertexShader:oi.meshtoon_vert,fragmentShader:oi.meshtoon_frag},matcap:{uniforms:lr([Qt.common,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,Qt.fog,{matcap:{value:null}}]),vertexShader:oi.meshmatcap_vert,fragmentShader:oi.meshmatcap_frag},points:{uniforms:lr([Qt.points,Qt.fog]),vertexShader:oi.points_vert,fragmentShader:oi.points_frag},dashed:{uniforms:lr([Qt.common,Qt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oi.linedashed_vert,fragmentShader:oi.linedashed_frag},depth:{uniforms:lr([Qt.common,Qt.displacementmap]),vertexShader:oi.depth_vert,fragmentShader:oi.depth_frag},normal:{uniforms:lr([Qt.common,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,{opacity:{value:1}}]),vertexShader:oi.meshnormal_vert,fragmentShader:oi.meshnormal_frag},sprite:{uniforms:lr([Qt.sprite,Qt.fog]),vertexShader:oi.sprite_vert,fragmentShader:oi.sprite_frag},background:{uniforms:{uvTransform:{value:new kr},t2D:{value:null}},vertexShader:oi.background_vert,fragmentShader:oi.background_frag},cube:{uniforms:lr([Qt.envmap,{opacity:{value:1}}]),vertexShader:oi.cube_vert,fragmentShader:oi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oi.equirect_vert,fragmentShader:oi.equirect_frag},distanceRGBA:{uniforms:lr([Qt.common,Qt.displacementmap,{referencePosition:{value:new de},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oi.distanceRGBA_vert,fragmentShader:oi.distanceRGBA_frag},shadow:{uniforms:lr([Qt.lights,Qt.fog,{color:{value:new dn(0)},opacity:{value:1}}]),vertexShader:oi.shadow_vert,fragmentShader:oi.shadow_frag}};Jo.physical={uniforms:lr([Jo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new gt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new dn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new gt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new dn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new dn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag};function tG(_,s,c,d,p,y){const w=new dn(0);let E=p===!0?0:1,P,L,O=null,k=0,N=null;function z(H,G){let X=!1,K=G.isScene===!0?G.background:null;K&&K.isTexture&&(K=s.get(K));const ne=_.xr,te=ne.getSession&&ne.getSession();te&&te.environmentBlendMode==="additive"&&(K=null),K===null?V(w,E):K&&K.isColor&&(V(K,1),X=!0),(_.autoClear||X)&&_.clear(_.autoClearColor,_.autoClearDepth,_.autoClearStencil),K&&(K.isCubeTexture||K.mapping===me)?(L===void 0&&(L=new Js(new hl(1,1,1),new Ea({name:"BackgroundCubeMaterial",uniforms:fd(Jo.cube.uniforms),vertexShader:Jo.cube.vertexShader,fragmentShader:Jo.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),L.geometry.deleteAttribute("normal"),L.geometry.deleteAttribute("uv"),L.onBeforeRender=function(oe,ue,Ce){this.matrixWorld.copyPosition(Ce.matrixWorld)},Object.defineProperty(L.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),d.update(L)),L.material.uniforms.envMap.value=K,L.material.uniforms.flipEnvMap.value=K.isCubeTexture&&K.isRenderTargetTexture===!1?-1:1,(O!==K||k!==K.version||N!==_.toneMapping)&&(L.material.needsUpdate=!0,O=K,k=K.version,N=_.toneMapping),L.layers.enableAll(),H.unshift(L,L.geometry,L.material,0,0,null)):K&&K.isTexture&&(P===void 0&&(P=new Js(new Ad(2,2),new Ea({name:"BackgroundMaterial",uniforms:fd(Jo.background.uniforms),vertexShader:Jo.background.vertexShader,fragmentShader:Jo.background.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),Object.defineProperty(P.material,"map",{get:function(){return this.uniforms.t2D.value}}),d.update(P)),P.material.uniforms.t2D.value=K,K.matrixAutoUpdate===!0&&K.updateMatrix(),P.material.uniforms.uvTransform.value.copy(K.matrix),(O!==K||k!==K.version||N!==_.toneMapping)&&(P.material.needsUpdate=!0,O=K,k=K.version,N=_.toneMapping),P.layers.enableAll(),H.unshift(P,P.geometry,P.material,0,0,null))}function V(H,G){c.buffers.color.setClear(H.r,H.g,H.b,G,y)}return{getClearColor:function(){return w},setClearColor:function(H,G=1){w.set(H),E=G,V(w,E)},getClearAlpha:function(){return E},setClearAlpha:function(H){E=H,V(w,E)},render:z}}function nG(_,s,c,d){const p=_.getParameter(_.MAX_VERTEX_ATTRIBS),y=d.isWebGL2?null:s.get("OES_vertex_array_object"),w=d.isWebGL2||y!==null,E={},P=G(null);let L=P,O=!1;function k(Fe,rt,At,St,at){let Qe=!1;if(w){const Je=H(St,At,rt);L!==Je&&(L=Je,z(L.object)),Qe=X(Fe,St,At,at),Qe&&K(Fe,St,At,at)}else{const Je=rt.wireframe===!0;(L.geometry!==St.id||L.program!==At.id||L.wireframe!==Je)&&(L.geometry=St.id,L.program=At.id,L.wireframe=Je,Qe=!0)}at!==null&&c.update(at,_.ELEMENT_ARRAY_BUFFER),(Qe||O)&&(O=!1,$(Fe,rt,At,St),at!==null&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,c.get(at).buffer))}function N(){return d.isWebGL2?_.createVertexArray():y.createVertexArrayOES()}function z(Fe){return d.isWebGL2?_.bindVertexArray(Fe):y.bindVertexArrayOES(Fe)}function V(Fe){return d.isWebGL2?_.deleteVertexArray(Fe):y.deleteVertexArrayOES(Fe)}function H(Fe,rt,At){const St=At.wireframe===!0;let at=E[Fe.id];at===void 0&&(at={},E[Fe.id]=at);let Qe=at[rt.id];Qe===void 0&&(Qe={},at[rt.id]=Qe);let Je=Qe[St];return Je===void 0&&(Je=G(N()),Qe[St]=Je),Je}function G(Fe){const rt=[],At=[],St=[];for(let at=0;at<p;at++)rt[at]=0,At[at]=0,St[at]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:rt,enabledAttributes:At,attributeDivisors:St,object:Fe,attributes:{},index:null}}function X(Fe,rt,At,St){const at=L.attributes,Qe=rt.attributes;let Je=0;const Rt=At.getAttributes();for(const Pt in Rt)if(Rt[Pt].location>=0){const yn=at[Pt];let Hn=Qe[Pt];if(Hn===void 0&&(Pt==="instanceMatrix"&&Fe.instanceMatrix&&(Hn=Fe.instanceMatrix),Pt==="instanceColor"&&Fe.instanceColor&&(Hn=Fe.instanceColor)),yn===void 0||yn.attribute!==Hn||Hn&&yn.data!==Hn.data)return!0;Je++}return L.attributesNum!==Je||L.index!==St}function K(Fe,rt,At,St){const at={},Qe=rt.attributes;let Je=0;const Rt=At.getAttributes();for(const Pt in Rt)if(Rt[Pt].location>=0){let yn=Qe[Pt];yn===void 0&&(Pt==="instanceMatrix"&&Fe.instanceMatrix&&(yn=Fe.instanceMatrix),Pt==="instanceColor"&&Fe.instanceColor&&(yn=Fe.instanceColor));const Hn={};Hn.attribute=yn,yn&&yn.data&&(Hn.data=yn.data),at[Pt]=Hn,Je++}L.attributes=at,L.attributesNum=Je,L.index=St}function ne(){const Fe=L.newAttributes;for(let rt=0,At=Fe.length;rt<At;rt++)Fe[rt]=0}function te(Fe){oe(Fe,0)}function oe(Fe,rt){const At=L.newAttributes,St=L.enabledAttributes,at=L.attributeDivisors;At[Fe]=1,St[Fe]===0&&(_.enableVertexAttribArray(Fe),St[Fe]=1),at[Fe]!==rt&&((d.isWebGL2?_:s.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Fe,rt),at[Fe]=rt)}function ue(){const Fe=L.newAttributes,rt=L.enabledAttributes;for(let At=0,St=rt.length;At<St;At++)rt[At]!==Fe[At]&&(_.disableVertexAttribArray(At),rt[At]=0)}function Ce(Fe,rt,At,St,at,Qe){d.isWebGL2===!0&&(At===_.INT||At===_.UNSIGNED_INT)?_.vertexAttribIPointer(Fe,rt,At,at,Qe):_.vertexAttribPointer(Fe,rt,At,St,at,Qe)}function $(Fe,rt,At,St){if(d.isWebGL2===!1&&(Fe.isInstancedMesh||St.isInstancedBufferGeometry)&&s.get("ANGLE_instanced_arrays")===null)return;ne();const at=St.attributes,Qe=At.getAttributes(),Je=rt.defaultAttributeValues;for(const Rt in Qe){const Pt=Qe[Rt];if(Pt.location>=0){let Lt=at[Rt];if(Lt===void 0&&(Rt==="instanceMatrix"&&Fe.instanceMatrix&&(Lt=Fe.instanceMatrix),Rt==="instanceColor"&&Fe.instanceColor&&(Lt=Fe.instanceColor)),Lt!==void 0){const yn=Lt.normalized,Hn=Lt.itemSize,Ue=c.get(Lt);if(Ue===void 0)continue;const ai=Ue.buffer,On=Ue.type,Vn=Ue.bytesPerElement;if(Lt.isInterleavedBufferAttribute){const on=Lt.data,li=on.stride,dt=Lt.offset;if(on.isInstancedInterleavedBuffer){for(let ct=0;ct<Pt.locationSize;ct++)oe(Pt.location+ct,on.meshPerAttribute);Fe.isInstancedMesh!==!0&&St._maxInstanceCount===void 0&&(St._maxInstanceCount=on.meshPerAttribute*on.count)}else for(let ct=0;ct<Pt.locationSize;ct++)te(Pt.location+ct);_.bindBuffer(_.ARRAY_BUFFER,ai);for(let ct=0;ct<Pt.locationSize;ct++)Ce(Pt.location+ct,Hn/Pt.locationSize,On,yn,li*Vn,(dt+Hn/Pt.locationSize*ct)*Vn)}else{if(Lt.isInstancedBufferAttribute){for(let on=0;on<Pt.locationSize;on++)oe(Pt.location+on,Lt.meshPerAttribute);Fe.isInstancedMesh!==!0&&St._maxInstanceCount===void 0&&(St._maxInstanceCount=Lt.meshPerAttribute*Lt.count)}else for(let on=0;on<Pt.locationSize;on++)te(Pt.location+on);_.bindBuffer(_.ARRAY_BUFFER,ai);for(let on=0;on<Pt.locationSize;on++)Ce(Pt.location+on,Hn/Pt.locationSize,On,yn,Hn*Vn,Hn/Pt.locationSize*on*Vn)}}else if(Je!==void 0){const yn=Je[Rt];if(yn!==void 0)switch(yn.length){case 2:_.vertexAttrib2fv(Pt.location,yn);break;case 3:_.vertexAttrib3fv(Pt.location,yn);break;case 4:_.vertexAttrib4fv(Pt.location,yn);break;default:_.vertexAttrib1fv(Pt.location,yn)}}}}ue()}function ge(){It();for(const Fe in E){const rt=E[Fe];for(const At in rt){const St=rt[At];for(const at in St)V(St[at].object),delete St[at];delete rt[At]}delete E[Fe]}}function Te(Fe){if(E[Fe.id]===void 0)return;const rt=E[Fe.id];for(const At in rt){const St=rt[At];for(const at in St)V(St[at].object),delete St[at];delete rt[At]}delete E[Fe.id]}function et(Fe){for(const rt in E){const At=E[rt];if(At[Fe.id]===void 0)continue;const St=At[Fe.id];for(const at in St)V(St[at].object),delete St[at];delete At[Fe.id]}}function It(){Ye(),O=!0,L!==P&&(L=P,z(L.object))}function Ye(){P.geometry=null,P.program=null,P.wireframe=!1}return{setup:k,reset:It,resetDefaultState:Ye,dispose:ge,releaseStatesOfGeometry:Te,releaseStatesOfProgram:et,initAttributes:ne,enableAttribute:te,disableUnusedAttributes:ue}}function iG(_,s,c,d){const p=d.isWebGL2;let y;function w(L){y=L}function E(L,O){_.drawArrays(y,L,O),c.update(O,y,1)}function P(L,O,k){if(k===0)return;let N,z;if(p)N=_,z="drawArraysInstanced";else if(N=s.get("ANGLE_instanced_arrays"),z="drawArraysInstancedANGLE",N===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}N[z](y,L,O,k),c.update(O,y,k)}this.setMode=w,this.render=E,this.renderInstances=P}function sG(_,s,c){let d;function p(){if(d!==void 0)return d;if(s.has("EXT_texture_filter_anisotropic")===!0){const Ce=s.get("EXT_texture_filter_anisotropic");d=_.getParameter(Ce.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else d=0;return d}function y(Ce){if(Ce==="highp"){if(_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.HIGH_FLOAT).precision>0&&_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.HIGH_FLOAT).precision>0)return"highp";Ce="mediump"}return Ce==="mediump"&&_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.MEDIUM_FLOAT).precision>0&&_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const w=typeof WebGL2RenderingContext<"u"&&_ instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&_ instanceof WebGL2ComputeRenderingContext;let E=c.precision!==void 0?c.precision:"highp";const P=y(E);P!==E&&(console.warn("THREE.WebGLRenderer:",E,"not supported, using",P,"instead."),E=P);const L=w||s.has("WEBGL_draw_buffers"),O=c.logarithmicDepthBuffer===!0,k=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS),N=_.getParameter(_.MAX_VERTEX_TEXTURE_IMAGE_UNITS),z=_.getParameter(_.MAX_TEXTURE_SIZE),V=_.getParameter(_.MAX_CUBE_MAP_TEXTURE_SIZE),H=_.getParameter(_.MAX_VERTEX_ATTRIBS),G=_.getParameter(_.MAX_VERTEX_UNIFORM_VECTORS),X=_.getParameter(_.MAX_VARYING_VECTORS),K=_.getParameter(_.MAX_FRAGMENT_UNIFORM_VECTORS),ne=N>0,te=w||s.has("OES_texture_float"),oe=ne&&te,ue=w?_.getParameter(_.MAX_SAMPLES):0;return{isWebGL2:w,drawBuffers:L,getMaxAnisotropy:p,getMaxPrecision:y,precision:E,logarithmicDepthBuffer:O,maxTextures:k,maxVertexTextures:N,maxTextureSize:z,maxCubemapSize:V,maxAttributes:H,maxVertexUniforms:G,maxVaryings:X,maxFragmentUniforms:K,vertexTextures:ne,floatFragmentTextures:te,floatVertexTextures:oe,maxSamples:ue}}function rG(_){const s=this;let c=null,d=0,p=!1,y=!1;const w=new ul,E=new kr,P={value:null,needsUpdate:!1};this.uniform=P,this.numPlanes=0,this.numIntersection=0,this.init=function(k,N,z){const V=k.length!==0||N||d!==0||p;return p=N,c=O(k,z,0),d=k.length,V},this.beginShadows=function(){y=!0,O(null)},this.endShadows=function(){y=!1,L()},this.setState=function(k,N,z){const V=k.clippingPlanes,H=k.clipIntersection,G=k.clipShadows,X=_.get(k);if(!p||V===null||V.length===0||y&&!G)y?O(null):L();else{const K=y?0:d,ne=K*4;let te=X.clippingState||null;P.value=te,te=O(V,N,ne,z);for(let oe=0;oe!==ne;++oe)te[oe]=c[oe];X.clippingState=te,this.numIntersection=H?this.numPlanes:0,this.numPlanes+=K}};function L(){P.value!==c&&(P.value=c,P.needsUpdate=d>0),s.numPlanes=d,s.numIntersection=0}function O(k,N,z,V){const H=k!==null?k.length:0;let G=null;if(H!==0){if(G=P.value,V!==!0||G===null){const X=z+H*4,K=N.matrixWorldInverse;E.getNormalMatrix(K),(G===null||G.length<X)&&(G=new Float32Array(X));for(let ne=0,te=z;ne!==H;++ne,te+=4)w.copy(k[ne]).applyMatrix4(K,E),w.normal.toArray(G,te),G[te+3]=w.constant}P.value=G,P.needsUpdate=!0}return s.numPlanes=H,s.numIntersection=0,G}}function oG(_){let s=new WeakMap;function c(w,E){return E===ii?w.mapping=Kt:E===Kn&&(w.mapping=ln),w}function d(w){if(w&&w.isTexture&&w.isRenderTargetTexture===!1){const E=w.mapping;if(E===ii||E===Kn)if(s.has(w)){const P=s.get(w).texture;return c(P,w.mapping)}else{const P=w.image;if(P&&P.height>0){const L=new iT(P.height/2);return L.fromEquirectangularTexture(_,w),s.set(w,L),w.addEventListener("dispose",p),c(L.texture,w.mapping)}else return null}}return w}function p(w){const E=w.target;E.removeEventListener("dispose",p);const P=s.get(E);P!==void 0&&(s.delete(E),P.dispose())}function y(){s=new WeakMap}return{get:d,dispose:y}}class t0 extends ZA{constructor(s=-1,c=1,d=1,p=-1,y=.1,w=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=s,this.right=c,this.top=d,this.bottom=p,this.near=y,this.far=w,this.updateProjectionMatrix()}copy(s,c){return super.copy(s,c),this.left=s.left,this.right=s.right,this.top=s.top,this.bottom=s.bottom,this.near=s.near,this.far=s.far,this.zoom=s.zoom,this.view=s.view===null?null:Object.assign({},s.view),this}setViewOffset(s,c,d,p,y,w){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=s,this.view.fullHeight=c,this.view.offsetX=d,this.view.offsetY=p,this.view.width=y,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const s=(this.right-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),d=(this.right+this.left)/2,p=(this.top+this.bottom)/2;let y=d-s,w=d+s,E=p+c,P=p-c;if(this.view!==null&&this.view.enabled){const L=(this.right-this.left)/this.view.fullWidth/this.zoom,O=(this.top-this.bottom)/this.view.fullHeight/this.zoom;y+=L*this.view.offsetX,w=y+L*this.view.width,E-=O*this.view.offsetY,P=E-O*this.view.height}this.projectionMatrix.makeOrthographic(y,w,E,P,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(s){const c=super.toJSON(s);return c.object.zoom=this.zoom,c.object.left=this.left,c.object.right=this.right,c.object.top=this.top,c.object.bottom=this.bottom,c.object.near=this.near,c.object.far=this.far,this.view!==null&&(c.object.view=Object.assign({},this.view)),c}}const yd=4,rT=[.125,.215,.35,.446,.526,.582],Bh=20,cw=new t0,oT=new dn;let lw=null;const Lh=(1+Math.sqrt(5))/2,_d=1/Lh,aT=[new de(1,1,1),new de(-1,1,1),new de(1,1,-1),new de(-1,1,-1),new de(0,Lh,_d),new de(0,Lh,-_d),new de(_d,0,Lh),new de(-_d,0,Lh),new de(Lh,_d,0),new de(-Lh,_d,0)];class hw{constructor(s){this._renderer=s,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(s,c=0,d=.1,p=100){lw=this._renderer.getRenderTarget(),this._setSize(256);const y=this._allocateTargets();return y.depthBuffer=!0,this._sceneToCubeUV(s,d,p,y),c>0&&this._blur(y,0,0,c),this._applyPMREM(y),this._cleanup(y),y}fromEquirectangular(s,c=null){return this._fromTexture(s,c)}fromCubemap(s,c=null){return this._fromTexture(s,c)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=hT(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=lT(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(s){this._lodMax=Math.floor(Math.log2(s)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let s=0;s<this._lodPlanes.length;s++)this._lodPlanes[s].dispose()}_cleanup(s){this._renderer.setRenderTarget(lw),s.scissorTest=!1,n0(s,0,0,s.width,s.height)}_fromTexture(s,c){s.mapping===Kt||s.mapping===ln?this._setSize(s.image.length===0?16:s.image[0].width||s.image[0].image.width):this._setSize(s.image.width/4),lw=this._renderer.getRenderTarget();const d=c||this._allocateTargets();return this._textureToCubeUV(s,d),this._applyPMREM(d),this._cleanup(d),d}_allocateTargets(){const s=3*Math.max(this._cubeSize,112),c=4*this._cubeSize,d={magFilter:Et,minFilter:Et,generateMipmaps:!1,type:fi,format:or,encoding:$c,depthBuffer:!1},p=cT(s,c,d);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==s){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=cT(s,c,d);const{_lodMax:y}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=aG(y)),this._blurMaterial=cG(y,s,c)}return p}_compileMaterial(s){const c=new Js(this._lodPlanes[0],s);this._renderer.compile(c,cw)}_sceneToCubeUV(s,c,d,p){const E=new Ks(90,1,c,d),P=[1,-1,1,1,1,1],L=[1,1,1,-1,-1,-1],O=this._renderer,k=O.autoClear,N=O.toneMapping;O.getClearColor(oT),O.toneMapping=vn,O.autoClear=!1;const z=new ol({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),V=new Js(new hl,z);let H=!1;const G=s.background;G?G.isColor&&(z.color.copy(G),s.background=null,H=!0):(z.color.copy(oT),H=!0);for(let X=0;X<6;X++){const K=X%3;K===0?(E.up.set(0,P[X],0),E.lookAt(L[X],0,0)):K===1?(E.up.set(0,0,P[X]),E.lookAt(0,L[X],0)):(E.up.set(0,P[X],0),E.lookAt(0,0,L[X]));const ne=this._cubeSize;n0(p,K*ne,X>2?ne:0,ne,ne),O.setRenderTarget(p),H&&O.render(V,E),O.render(s,E)}V.geometry.dispose(),V.material.dispose(),O.toneMapping=N,O.autoClear=k,s.background=G}_textureToCubeUV(s,c){const d=this._renderer,p=s.mapping===Kt||s.mapping===ln;p?(this._cubemapMaterial===null&&(this._cubemapMaterial=hT()),this._cubemapMaterial.uniforms.flipEnvMap.value=s.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=lT());const y=p?this._cubemapMaterial:this._equirectMaterial,w=new Js(this._lodPlanes[0],y),E=y.uniforms;E.envMap.value=s;const P=this._cubeSize;n0(c,0,0,3*P,2*P),d.setRenderTarget(c),d.render(w,cw)}_applyPMREM(s){const c=this._renderer,d=c.autoClear;c.autoClear=!1;for(let p=1;p<this._lodPlanes.length;p++){const y=Math.sqrt(this._sigmas[p]*this._sigmas[p]-this._sigmas[p-1]*this._sigmas[p-1]),w=aT[(p-1)%aT.length];this._blur(s,p-1,p,y,w)}c.autoClear=d}_blur(s,c,d,p,y){const w=this._pingPongRenderTarget;this._halfBlur(s,w,c,d,p,"latitudinal",y),this._halfBlur(w,s,d,d,p,"longitudinal",y)}_halfBlur(s,c,d,p,y,w,E){const P=this._renderer,L=this._blurMaterial;w!=="latitudinal"&&w!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const O=3,k=new Js(this._lodPlanes[p],L),N=L.uniforms,z=this._sizeLods[d]-1,V=isFinite(y)?Math.PI/(2*z):2*Math.PI/(2*Bh-1),H=y/V,G=isFinite(y)?1+Math.floor(O*H):Bh;G>Bh&&console.warn(`sigmaRadians, ${y}, is too large and will clip, as it requested ${G} samples when the maximum is set to ${Bh}`);const X=[];let K=0;for(let Ce=0;Ce<Bh;++Ce){const $=Ce/H,ge=Math.exp(-$*$/2);X.push(ge),Ce===0?K+=ge:Ce<G&&(K+=2*ge)}for(let Ce=0;Ce<X.length;Ce++)X[Ce]=X[Ce]/K;N.envMap.value=s.texture,N.samples.value=G,N.weights.value=X,N.latitudinal.value=w==="latitudinal",E&&(N.poleAxis.value=E);const{_lodMax:ne}=this;N.dTheta.value=V,N.mipInt.value=ne-d;const te=this._sizeLods[p],oe=3*te*(p>ne-yd?p-ne+yd:0),ue=4*(this._cubeSize-te);n0(c,oe,ue,3*te,2*te),P.setRenderTarget(c),P.render(k,cw)}}function aG(_){const s=[],c=[],d=[];let p=_;const y=_-yd+1+rT.length;for(let w=0;w<y;w++){const E=Math.pow(2,p);c.push(E);let P=1/E;w>_-yd?P=rT[w-_+yd-1]:w===0&&(P=0),d.push(P);const L=1/(E-2),O=-L,k=1+L,N=[O,O,k,O,k,k,O,O,k,k,O,k],z=6,V=6,H=3,G=2,X=1,K=new Float32Array(H*V*z),ne=new Float32Array(G*V*z),te=new Float32Array(X*V*z);for(let ue=0;ue<z;ue++){const Ce=ue%3*2/3-1,$=ue>2?0:-1,ge=[Ce,$,0,Ce+2/3,$,0,Ce+2/3,$+1,0,Ce,$,0,Ce+2/3,$+1,0,Ce,$+1,0];K.set(ge,H*V*ue),ne.set(N,G*V*ue);const Te=[ue,ue,ue,ue,ue,ue];te.set(Te,X*V*ue)}const oe=new si;oe.setAttribute("position",new Fi(K,H)),oe.setAttribute("uv",new Fi(ne,G)),oe.setAttribute("faceIndex",new Fi(te,X)),s.push(oe),p>yd&&p--}return{lodPlanes:s,sizeLods:c,sigmas:d}}function cT(_,s,c){const d=new xo(_,s,c);return d.texture.mapping=me,d.texture.name="PMREM.cubeUv",d.scissorTest=!0,d}function n0(_,s,c,d,p){_.viewport.set(s,c,d,p),_.scissor.set(s,c,d,p)}function cG(_,s,c){const d=new Float32Array(Bh),p=new de(0,1,0);return new Ea({name:"SphericalGaussianBlur",defines:{n:Bh,CUBEUV_TEXEL_WIDTH:1/s,CUBEUV_TEXEL_HEIGHT:1/c,CUBEUV_MAX_MIP:`${_}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:d},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:p}},vertexShader:uw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function lT(){return new Ea({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:uw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function hT(){return new Ea({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:uw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function uw(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function lG(_){let s=new WeakMap,c=null;function d(E){if(E&&E.isTexture){const P=E.mapping,L=P===ii||P===Kn,O=P===Kt||P===ln;if(L||O)if(E.isRenderTargetTexture&&E.needsPMREMUpdate===!0){E.needsPMREMUpdate=!1;let k=s.get(E);return c===null&&(c=new hw(_)),k=L?c.fromEquirectangular(E,k):c.fromCubemap(E,k),s.set(E,k),k.texture}else{if(s.has(E))return s.get(E).texture;{const k=E.image;if(L&&k&&k.height>0||O&&k&&p(k)){c===null&&(c=new hw(_));const N=L?c.fromEquirectangular(E):c.fromCubemap(E);return s.set(E,N),E.addEventListener("dispose",y),N.texture}else return null}}}return E}function p(E){let P=0;const L=6;for(let O=0;O<L;O++)E[O]!==void 0&&P++;return P===L}function y(E){const P=E.target;P.removeEventListener("dispose",y);const L=s.get(P);L!==void 0&&(s.delete(P),L.dispose())}function w(){s=new WeakMap,c!==null&&(c.dispose(),c=null)}return{get:d,dispose:w}}function hG(_){const s={};function c(d){if(s[d]!==void 0)return s[d];let p;switch(d){case"WEBGL_depth_texture":p=_.getExtension("WEBGL_depth_texture")||_.getExtension("MOZ_WEBGL_depth_texture")||_.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":p=_.getExtension("EXT_texture_filter_anisotropic")||_.getExtension("MOZ_EXT_texture_filter_anisotropic")||_.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":p=_.getExtension("WEBGL_compressed_texture_s3tc")||_.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||_.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":p=_.getExtension("WEBGL_compressed_texture_pvrtc")||_.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:p=_.getExtension(d)}return s[d]=p,p}return{has:function(d){return c(d)!==null},init:function(d){d.isWebGL2?c("EXT_color_buffer_float"):(c("WEBGL_depth_texture"),c("OES_texture_float"),c("OES_texture_half_float"),c("OES_texture_half_float_linear"),c("OES_standard_derivatives"),c("OES_element_index_uint"),c("OES_vertex_array_object"),c("ANGLE_instanced_arrays")),c("OES_texture_float_linear"),c("EXT_color_buffer_half_float"),c("WEBGL_multisampled_render_to_texture")},get:function(d){const p=c(d);return p===null&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported."),p}}}function uG(_,s,c,d){const p={},y=new WeakMap;function w(k){const N=k.target;N.index!==null&&s.remove(N.index);for(const V in N.attributes)s.remove(N.attributes[V]);N.removeEventListener("dispose",w),delete p[N.id];const z=y.get(N);z&&(s.remove(z),y.delete(N)),d.releaseStatesOfGeometry(N),N.isInstancedBufferGeometry===!0&&delete N._maxInstanceCount,c.memory.geometries--}function E(k,N){return p[N.id]===!0||(N.addEventListener("dispose",w),p[N.id]=!0,c.memory.geometries++),N}function P(k){const N=k.attributes;for(const V in N)s.update(N[V],_.ARRAY_BUFFER);const z=k.morphAttributes;for(const V in z){const H=z[V];for(let G=0,X=H.length;G<X;G++)s.update(H[G],_.ARRAY_BUFFER)}}function L(k){const N=[],z=k.index,V=k.attributes.position;let H=0;if(z!==null){const K=z.array;H=z.version;for(let ne=0,te=K.length;ne<te;ne+=3){const oe=K[ne+0],ue=K[ne+1],Ce=K[ne+2];N.push(oe,ue,ue,Ce,Ce,oe)}}else{const K=V.array;H=V.version;for(let ne=0,te=K.length/3-1;ne<te;ne+=3){const oe=ne+0,ue=ne+1,Ce=ne+2;N.push(oe,ue,ue,Ce,Ce,oe)}}const G=new(H1(N)?ew:$x)(N,1);G.version=H;const X=y.get(k);X&&s.remove(X),y.set(k,G)}function O(k){const N=y.get(k);if(N){const z=k.index;z!==null&&N.version<z.version&&L(k)}else L(k);return y.get(k)}return{get:E,update:P,getWireframeAttribute:O}}function dG(_,s,c,d){const p=d.isWebGL2;let y;function w(N){y=N}let E,P;function L(N){E=N.type,P=N.bytesPerElement}function O(N,z){_.drawElements(y,z,E,N*P),c.update(z,y,1)}function k(N,z,V){if(V===0)return;let H,G;if(p)H=_,G="drawElementsInstanced";else if(H=s.get("ANGLE_instanced_arrays"),G="drawElementsInstancedANGLE",H===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}H[G](y,z,E,N*P,V),c.update(z,y,V)}this.setMode=w,this.setIndex=L,this.render=O,this.renderInstances=k}function fG(_){const s={geometries:0,textures:0},c={frame:0,calls:0,triangles:0,points:0,lines:0};function d(y,w,E){switch(c.calls++,w){case _.TRIANGLES:c.triangles+=E*(y/3);break;case _.LINES:c.lines+=E*(y/2);break;case _.LINE_STRIP:c.lines+=E*(y-1);break;case _.LINE_LOOP:c.lines+=E*y;break;case _.POINTS:c.points+=E*y;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",w);break}}function p(){c.frame++,c.calls=0,c.triangles=0,c.points=0,c.lines=0}return{memory:s,render:c,programs:null,autoReset:!0,reset:p,update:d}}function pG(_,s){return _[0]-s[0]}function mG(_,s){return Math.abs(s[1])-Math.abs(_[1])}function gG(_,s,c){const d={},p=new Float32Array(8),y=new WeakMap,w=new Pi,E=[];for(let L=0;L<8;L++)E[L]=[L,0];function P(L,O,k,N){const z=L.morphTargetInfluences;if(s.isWebGL2===!0){const H=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,G=H!==void 0?H.length:0;let X=y.get(O);if(X===void 0||X.count!==G){let At=function(){Fe.dispose(),y.delete(O),O.removeEventListener("dispose",At)};var V=At;X!==void 0&&X.texture.dispose();const te=O.morphAttributes.position!==void 0,oe=O.morphAttributes.normal!==void 0,ue=O.morphAttributes.color!==void 0,Ce=O.morphAttributes.position||[],$=O.morphAttributes.normal||[],ge=O.morphAttributes.color||[];let Te=0;te===!0&&(Te=1),oe===!0&&(Te=2),ue===!0&&(Te=3);let et=O.attributes.position.count*Te,It=1;et>s.maxTextureSize&&(It=Math.ceil(et/s.maxTextureSize),et=s.maxTextureSize);const Ye=new Float32Array(et*It*4*G),Fe=new Mp(Ye,et,It,G);Fe.type=wn,Fe.needsUpdate=!0;const rt=Te*4;for(let St=0;St<G;St++){const at=Ce[St],Qe=$[St],Je=ge[St],Rt=et*It*4*St;for(let Pt=0;Pt<at.count;Pt++){const Lt=Pt*rt;te===!0&&(w.fromBufferAttribute(at,Pt),Ye[Rt+Lt+0]=w.x,Ye[Rt+Lt+1]=w.y,Ye[Rt+Lt+2]=w.z,Ye[Rt+Lt+3]=0),oe===!0&&(w.fromBufferAttribute(Qe,Pt),Ye[Rt+Lt+4]=w.x,Ye[Rt+Lt+5]=w.y,Ye[Rt+Lt+6]=w.z,Ye[Rt+Lt+7]=0),ue===!0&&(w.fromBufferAttribute(Je,Pt),Ye[Rt+Lt+8]=w.x,Ye[Rt+Lt+9]=w.y,Ye[Rt+Lt+10]=w.z,Ye[Rt+Lt+11]=Je.itemSize===4?w.w:1)}}X={count:G,texture:Fe,size:new gt(et,It)},y.set(O,X),O.addEventListener("dispose",At)}let K=0;for(let te=0;te<z.length;te++)K+=z[te];const ne=O.morphTargetsRelative?1:1-K;N.getUniforms().setValue(_,"morphTargetBaseInfluence",ne),N.getUniforms().setValue(_,"morphTargetInfluences",z),N.getUniforms().setValue(_,"morphTargetsTexture",X.texture,c),N.getUniforms().setValue(_,"morphTargetsTextureSize",X.size)}else{const H=z===void 0?0:z.length;let G=d[O.id];if(G===void 0||G.length!==H){G=[];for(let oe=0;oe<H;oe++)G[oe]=[oe,0];d[O.id]=G}for(let oe=0;oe<H;oe++){const ue=G[oe];ue[0]=oe,ue[1]=z[oe]}G.sort(mG);for(let oe=0;oe<8;oe++)oe<H&&G[oe][1]?(E[oe][0]=G[oe][0],E[oe][1]=G[oe][1]):(E[oe][0]=Number.MAX_SAFE_INTEGER,E[oe][1]=0);E.sort(pG);const X=O.morphAttributes.position,K=O.morphAttributes.normal;let ne=0;for(let oe=0;oe<8;oe++){const ue=E[oe],Ce=ue[0],$=ue[1];Ce!==Number.MAX_SAFE_INTEGER&&$?(X&&O.getAttribute("morphTarget"+oe)!==X[Ce]&&O.setAttribute("morphTarget"+oe,X[Ce]),K&&O.getAttribute("morphNormal"+oe)!==K[Ce]&&O.setAttribute("morphNormal"+oe,K[Ce]),p[oe]=$,ne+=$):(X&&O.hasAttribute("morphTarget"+oe)===!0&&O.deleteAttribute("morphTarget"+oe),K&&O.hasAttribute("morphNormal"+oe)===!0&&O.deleteAttribute("morphNormal"+oe),p[oe]=0)}const te=O.morphTargetsRelative?1:1-ne;N.getUniforms().setValue(_,"morphTargetBaseInfluence",te),N.getUniforms().setValue(_,"morphTargetInfluences",p)}}return{update:P}}function AG(_,s,c,d){let p=new WeakMap;function y(P){const L=d.render.frame,O=P.geometry,k=s.get(P,O);return p.get(k)!==L&&(s.update(k),p.set(k,L)),P.isInstancedMesh&&(P.hasEventListener("dispose",E)===!1&&P.addEventListener("dispose",E),c.update(P.instanceMatrix,_.ARRAY_BUFFER),P.instanceColor!==null&&c.update(P.instanceColor,_.ARRAY_BUFFER)),k}function w(){p=new WeakMap}function E(P){const L=P.target;L.removeEventListener("dispose",E),c.remove(L.instanceMatrix),L.instanceColor!==null&&c.remove(L.instanceColor)}return{update:y,dispose:w}}const uT=new Rs,dT=new Mp,fT=new DA,pT=new Bp,mT=[],gT=[],AT=new Float32Array(16),yT=new Float32Array(9),_T=new Float32Array(4);function vd(_,s,c){const d=_[0];if(d<=0||d>0)return _;const p=s*c;let y=mT[p];if(y===void 0&&(y=new Float32Array(p),mT[p]=y),s!==0){d.toArray(y,0);for(let w=1,E=0;w!==s;++w)E+=c,_[w].toArray(y,E)}return y}function Ps(_,s){if(_.length!==s.length)return!1;for(let c=0,d=_.length;c<d;c++)if(_[c]!==s[c])return!1;return!0}function Bs(_,s){for(let c=0,d=s.length;c<d;c++)_[c]=s[c]}function i0(_,s){let c=gT[s];c===void 0&&(c=new Int32Array(s),gT[s]=c);for(let d=0;d!==s;++d)c[d]=_.allocateTextureUnit();return c}function yG(_,s){const c=this.cache;c[0]!==s&&(_.uniform1f(this.addr,s),c[0]=s)}function _G(_,s){const c=this.cache;if(s.x!==void 0)(c[0]!==s.x||c[1]!==s.y)&&(_.uniform2f(this.addr,s.x,s.y),c[0]=s.x,c[1]=s.y);else{if(Ps(c,s))return;_.uniform2fv(this.addr,s),Bs(c,s)}}function vG(_,s){const c=this.cache;if(s.x!==void 0)(c[0]!==s.x||c[1]!==s.y||c[2]!==s.z)&&(_.uniform3f(this.addr,s.x,s.y,s.z),c[0]=s.x,c[1]=s.y,c[2]=s.z);else if(s.r!==void 0)(c[0]!==s.r||c[1]!==s.g||c[2]!==s.b)&&(_.uniform3f(this.addr,s.r,s.g,s.b),c[0]=s.r,c[1]=s.g,c[2]=s.b);else{if(Ps(c,s))return;_.uniform3fv(this.addr,s),Bs(c,s)}}function xG(_,s){const c=this.cache;if(s.x!==void 0)(c[0]!==s.x||c[1]!==s.y||c[2]!==s.z||c[3]!==s.w)&&(_.uniform4f(this.addr,s.x,s.y,s.z,s.w),c[0]=s.x,c[1]=s.y,c[2]=s.z,c[3]=s.w);else{if(Ps(c,s))return;_.uniform4fv(this.addr,s),Bs(c,s)}}function wG(_,s){const c=this.cache,d=s.elements;if(d===void 0){if(Ps(c,s))return;_.uniformMatrix2fv(this.addr,!1,s),Bs(c,s)}else{if(Ps(c,d))return;_T.set(d),_.uniformMatrix2fv(this.addr,!1,_T),Bs(c,d)}}function bG(_,s){const c=this.cache,d=s.elements;if(d===void 0){if(Ps(c,s))return;_.uniformMatrix3fv(this.addr,!1,s),Bs(c,s)}else{if(Ps(c,d))return;yT.set(d),_.uniformMatrix3fv(this.addr,!1,yT),Bs(c,d)}}function CG(_,s){const c=this.cache,d=s.elements;if(d===void 0){if(Ps(c,s))return;_.uniformMatrix4fv(this.addr,!1,s),Bs(c,s)}else{if(Ps(c,d))return;AT.set(d),_.uniformMatrix4fv(this.addr,!1,AT),Bs(c,d)}}function EG(_,s){const c=this.cache;c[0]!==s&&(_.uniform1i(this.addr,s),c[0]=s)}function SG(_,s){const c=this.cache;Ps(c,s)||(_.uniform2iv(this.addr,s),Bs(c,s))}function MG(_,s){const c=this.cache;Ps(c,s)||(_.uniform3iv(this.addr,s),Bs(c,s))}function TG(_,s){const c=this.cache;Ps(c,s)||(_.uniform4iv(this.addr,s),Bs(c,s))}function IG(_,s){const c=this.cache;c[0]!==s&&(_.uniform1ui(this.addr,s),c[0]=s)}function RG(_,s){const c=this.cache;Ps(c,s)||(_.uniform2uiv(this.addr,s),Bs(c,s))}function PG(_,s){const c=this.cache;Ps(c,s)||(_.uniform3uiv(this.addr,s),Bs(c,s))}function BG(_,s){const c=this.cache;Ps(c,s)||(_.uniform4uiv(this.addr,s),Bs(c,s))}function LG(_,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(_.uniform1i(this.addr,p),d[0]=p),c.setTexture2D(s||uT,p)}function DG(_,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(_.uniform1i(this.addr,p),d[0]=p),c.setTexture3D(s||fT,p)}function OG(_,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(_.uniform1i(this.addr,p),d[0]=p),c.setTextureCube(s||pT,p)}function FG(_,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(_.uniform1i(this.addr,p),d[0]=p),c.setTexture2DArray(s||dT,p)}function kG(_){switch(_){case 5126:return yG;case 35664:return _G;case 35665:return vG;case 35666:return xG;case 35674:return wG;case 35675:return bG;case 35676:return CG;case 5124:case 35670:return EG;case 35667:case 35671:return SG;case 35668:case 35672:return MG;case 35669:case 35673:return TG;case 5125:return IG;case 36294:return RG;case 36295:return PG;case 36296:return BG;case 35678:case 36198:case 36298:case 36306:case 35682:return LG;case 35679:case 36299:case 36307:return DG;case 35680:case 36300:case 36308:case 36293:return OG;case 36289:case 36303:case 36311:case 36292:return FG}}function NG(_,s){_.uniform1fv(this.addr,s)}function UG(_,s){const c=vd(s,this.size,2);_.uniform2fv(this.addr,c)}function zG(_,s){const c=vd(s,this.size,3);_.uniform3fv(this.addr,c)}function GG(_,s){const c=vd(s,this.size,4);_.uniform4fv(this.addr,c)}function HG(_,s){const c=vd(s,this.size,4);_.uniformMatrix2fv(this.addr,!1,c)}function VG(_,s){const c=vd(s,this.size,9);_.uniformMatrix3fv(this.addr,!1,c)}function WG(_,s){const c=vd(s,this.size,16);_.uniformMatrix4fv(this.addr,!1,c)}function QG(_,s){_.uniform1iv(this.addr,s)}function jG(_,s){_.uniform2iv(this.addr,s)}function qG(_,s){_.uniform3iv(this.addr,s)}function XG(_,s){_.uniform4iv(this.addr,s)}function YG(_,s){_.uniform1uiv(this.addr,s)}function JG(_,s){_.uniform2uiv(this.addr,s)}function KG(_,s){_.uniform3uiv(this.addr,s)}function ZG(_,s){_.uniform4uiv(this.addr,s)}function $G(_,s,c){const d=this.cache,p=s.length,y=i0(c,p);Ps(d,y)||(_.uniform1iv(this.addr,y),Bs(d,y));for(let w=0;w!==p;++w)c.setTexture2D(s[w]||uT,y[w])}function e4(_,s,c){const d=this.cache,p=s.length,y=i0(c,p);Ps(d,y)||(_.uniform1iv(this.addr,y),Bs(d,y));for(let w=0;w!==p;++w)c.setTexture3D(s[w]||fT,y[w])}function t4(_,s,c){const d=this.cache,p=s.length,y=i0(c,p);Ps(d,y)||(_.uniform1iv(this.addr,y),Bs(d,y));for(let w=0;w!==p;++w)c.setTextureCube(s[w]||pT,y[w])}function n4(_,s,c){const d=this.cache,p=s.length,y=i0(c,p);Ps(d,y)||(_.uniform1iv(this.addr,y),Bs(d,y));for(let w=0;w!==p;++w)c.setTexture2DArray(s[w]||dT,y[w])}function i4(_){switch(_){case 5126:return NG;case 35664:return UG;case 35665:return zG;case 35666:return GG;case 35674:return HG;case 35675:return VG;case 35676:return WG;case 5124:case 35670:return QG;case 35667:case 35671:return jG;case 35668:case 35672:return qG;case 35669:case 35673:return XG;case 5125:return YG;case 36294:return JG;case 36295:return KG;case 36296:return ZG;case 35678:case 36198:case 36298:case 36306:case 35682:return $G;case 35679:case 36299:case 36307:return e4;case 35680:case 36300:case 36308:case 36293:return t4;case 36289:case 36303:case 36311:case 36292:return n4}}class s4{constructor(s,c,d){this.id=s,this.addr=d,this.cache=[],this.setValue=kG(c.type)}}class r4{constructor(s,c,d){this.id=s,this.addr=d,this.cache=[],this.size=c.size,this.setValue=i4(c.type)}}class o4{constructor(s){this.id=s,this.seq=[],this.map={}}setValue(s,c,d){const p=this.seq;for(let y=0,w=p.length;y!==w;++y){const E=p[y];E.setValue(s,c[E.id],d)}}}const dw=/(\w+)(\])?(\[|\.)?/g;function vT(_,s){_.seq.push(s),_.map[s.id]=s}function a4(_,s,c){const d=_.name,p=d.length;for(dw.lastIndex=0;;){const y=dw.exec(d),w=dw.lastIndex;let E=y[1];const P=y[2]==="]",L=y[3];if(P&&(E=E|0),L===void 0||L==="["&&w+2===p){vT(c,L===void 0?new s4(E,_,s):new r4(E,_,s));break}else{let k=c.map[E];k===void 0&&(k=new o4(E),vT(c,k)),c=k}}}class s0{constructor(s,c){this.seq=[],this.map={};const d=s.getProgramParameter(c,s.ACTIVE_UNIFORMS);for(let p=0;p<d;++p){const y=s.getActiveUniform(c,p),w=s.getUniformLocation(c,y.name);a4(y,w,this)}}setValue(s,c,d,p){const y=this.map[c];y!==void 0&&y.setValue(s,d,p)}setOptional(s,c,d){const p=c[d];p!==void 0&&this.setValue(s,d,p)}static upload(s,c,d,p){for(let y=0,w=c.length;y!==w;++y){const E=c[y],P=d[E.id];P.needsUpdate!==!1&&E.setValue(s,P.value,p)}}static seqWithValue(s,c){const d=[];for(let p=0,y=s.length;p!==y;++p){const w=s[p];w.id in c&&d.push(w)}return d}}function xT(_,s,c){const d=_.createShader(s);return _.shaderSource(d,c),_.compileShader(d),d}let c4=0;function l4(_,s){const c=_.split(`
`),d=[],p=Math.max(s-6,0),y=Math.min(s+6,c.length);for(let w=p;w<y;w++){const E=w+1;d.push(`${E===s?">":" "} ${E}: ${c[w]}`)}return d.join(`
`)}function h4(_){switch(_){case $c:return["Linear","( value )"];case es:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",_),["Linear","( value )"]}}function wT(_,s,c){const d=_.getShaderParameter(s,_.COMPILE_STATUS),p=_.getShaderInfoLog(s).trim();if(d&&p==="")return"";const y=/ERROR: 0:(\d+)/.exec(p);if(y){const w=parseInt(y[1]);return c.toUpperCase()+`

`+p+`

`+l4(_.getShaderSource(s),w)}else return p}function u4(_,s){const c=h4(s);return"vec4 "+_+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function d4(_,s){let c;switch(s){case it:c="Linear";break;case tt:c="Reinhard";break;case xt:c="OptimizedCineon";break;case Jt:c="ACESFilmic";break;case Dt:c="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",s),c="Linear"}return"vec3 "+_+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function f4(_){return[_.extensionDerivatives||!!_.envMapCubeUVHeight||_.bumpMap||_.tangentSpaceNormalMap||_.clearcoatNormalMap||_.flatShading||_.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(_.extensionFragDepth||_.logarithmicDepthBuffer)&&_.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",_.extensionDrawBuffers&&_.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(_.extensionShaderTextureLOD||_.envMap||_.transmission)&&_.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Lp).join(`
`)}function p4(_){const s=[];for(const c in _){const d=_[c];d!==!1&&s.push("#define "+c+" "+d)}return s.join(`
`)}function m4(_,s){const c={},d=_.getProgramParameter(s,_.ACTIVE_ATTRIBUTES);for(let p=0;p<d;p++){const y=_.getActiveAttrib(s,p),w=y.name;let E=1;y.type===_.FLOAT_MAT2&&(E=2),y.type===_.FLOAT_MAT3&&(E=3),y.type===_.FLOAT_MAT4&&(E=4),c[w]={type:y.type,location:_.getAttribLocation(s,w),locationSize:E}}return c}function Lp(_){return _!==""}function bT(_,s){const c=s.numSpotLightShadows+s.numSpotLightMaps-s.numSpotLightShadowsWithMaps;return _.replace(/NUM_DIR_LIGHTS/g,s.numDirLights).replace(/NUM_SPOT_LIGHTS/g,s.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,s.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,c).replace(/NUM_RECT_AREA_LIGHTS/g,s.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,s.numPointLights).replace(/NUM_HEMI_LIGHTS/g,s.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,s.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,s.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,s.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,s.numPointLightShadows)}function CT(_,s){return _.replace(/NUM_CLIPPING_PLANES/g,s.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,s.numClippingPlanes-s.numClipIntersection)}const g4=/^[ \t]*#include +<([\w\d./]+)>/gm;function fw(_){return _.replace(g4,A4)}function A4(_,s){const c=oi[s];if(c===void 0)throw new Error("Can not resolve #include <"+s+">");return fw(c)}const y4=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ET(_){return _.replace(y4,_4)}function _4(_,s,c,d){let p="";for(let y=parseInt(s);y<parseInt(c);y++)p+=d.replace(/\[\s*i\s*\]/g,"[ "+y+" ]").replace(/UNROLLED_LOOP_INDEX/g,y);return p}function ST(_){let s="precision "+_.precision+` float;
precision `+_.precision+" int;";return _.precision==="highp"?s+=`
#define HIGH_PRECISION`:_.precision==="mediump"?s+=`
#define MEDIUM_PRECISION`:_.precision==="lowp"&&(s+=`
#define LOW_PRECISION`),s}function v4(_){let s="SHADOWMAP_TYPE_BASIC";return _.shadowMapType===h?s="SHADOWMAP_TYPE_PCF":_.shadowMapType===u?s="SHADOWMAP_TYPE_PCF_SOFT":_.shadowMapType===f&&(s="SHADOWMAP_TYPE_VSM"),s}function x4(_){let s="ENVMAP_TYPE_CUBE";if(_.envMap)switch(_.envMapMode){case Kt:case ln:s="ENVMAP_TYPE_CUBE";break;case me:s="ENVMAP_TYPE_CUBE_UV";break}return s}function w4(_){let s="ENVMAP_MODE_REFLECTION";if(_.envMap)switch(_.envMapMode){case ln:s="ENVMAP_MODE_REFRACTION";break}return s}function b4(_){let s="ENVMAP_BLENDING_NONE";if(_.envMap)switch(_.combine){case Xt:s="ENVMAP_BLENDING_MULTIPLY";break;case mn:s="ENVMAP_BLENDING_MIX";break;case Nt:s="ENVMAP_BLENDING_ADD";break}return s}function C4(_){const s=_.envMapCubeUVHeight;if(s===null)return null;const c=Math.log2(s)-2,d=1/s;return{texelWidth:1/(3*Math.max(Math.pow(2,c),7*16)),texelHeight:d,maxMip:c}}function E4(_,s,c,d){const p=_.getContext(),y=c.defines;let w=c.vertexShader,E=c.fragmentShader;const P=v4(c),L=x4(c),O=w4(c),k=b4(c),N=C4(c),z=c.isWebGL2?"":f4(c),V=p4(y),H=p.createProgram();let G,X,K=c.glslVersion?"#version "+c.glslVersion+`
`:"";c.isRawShaderMaterial?(G=[V].filter(Lp).join(`
`),G.length>0&&(G+=`
`),X=[z,V].filter(Lp).join(`
`),X.length>0&&(X+=`
`)):(G=[ST(c),"#define SHADER_NAME "+c.shaderName,V,c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.supportsVertexTextures?"#define VERTEX_TEXTURES":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+O:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.displacementMap&&c.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",c.specularColorMap?"#define USE_SPECULARCOLORMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.sheenColorMap?"#define USE_SHEENCOLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&c.flatShading===!1?"#define USE_MORPHNORMALS":"",c.morphColors&&c.isWebGL2?"#define USE_MORPHCOLORS":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+c.morphTextureStride:"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_COUNT "+c.morphTargetsCount:"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+P:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Lp).join(`
`),X=[z,ST(c),"#define SHADER_NAME "+c.shaderName,V,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+L:"",c.envMap?"#define "+O:"",c.envMap?"#define "+k:"",N?"#define CUBEUV_TEXEL_WIDTH "+N.texelWidth:"",N?"#define CUBEUV_TEXEL_HEIGHT "+N.texelHeight:"",N?"#define CUBEUV_MAX_MIP "+N.maxMip+".0":"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoat?"#define USE_CLEARCOAT":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescence?"#define USE_IRIDESCENCE":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",c.specularColorMap?"#define USE_SPECULARCOLORMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaTest?"#define USE_ALPHATEST":"",c.sheen?"#define USE_SHEEN":"",c.sheenColorMap?"#define USE_SHEENCOLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors||c.instancingColor?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+P:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",c.toneMapping!==vn?"#define TONE_MAPPING":"",c.toneMapping!==vn?oi.tonemapping_pars_fragment:"",c.toneMapping!==vn?d4("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",c.opaque?"#define OPAQUE":"",oi.encodings_pars_fragment,u4("linearToOutputTexel",c.outputEncoding),c.useDepthPacking?"#define DEPTH_PACKING "+c.depthPacking:"",`
`].filter(Lp).join(`
`)),w=fw(w),w=bT(w,c),w=CT(w,c),E=fw(E),E=bT(E,c),E=CT(E,c),w=ET(w),E=ET(E),c.isWebGL2&&c.isRawShaderMaterial!==!0&&(K=`#version 300 es
`,G=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+G,X=["#define varying in",c.glslVersion===Ox?"":"layout(location = 0) out highp vec4 pc_fragColor;",c.glslVersion===Ox?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+X);const ne=K+G+w,te=K+X+E,oe=xT(p,p.VERTEX_SHADER,ne),ue=xT(p,p.FRAGMENT_SHADER,te);if(p.attachShader(H,oe),p.attachShader(H,ue),c.index0AttributeName!==void 0?p.bindAttribLocation(H,0,c.index0AttributeName):c.morphTargets===!0&&p.bindAttribLocation(H,0,"position"),p.linkProgram(H),_.debug.checkShaderErrors){const ge=p.getProgramInfoLog(H).trim(),Te=p.getShaderInfoLog(oe).trim(),et=p.getShaderInfoLog(ue).trim();let It=!0,Ye=!0;if(p.getProgramParameter(H,p.LINK_STATUS)===!1){It=!1;const Fe=wT(p,oe,"vertex"),rt=wT(p,ue,"fragment");console.error("THREE.WebGLProgram: Shader Error "+p.getError()+" - VALIDATE_STATUS "+p.getProgramParameter(H,p.VALIDATE_STATUS)+`

Program Info Log: `+ge+`
`+Fe+`
`+rt)}else ge!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ge):(Te===""||et==="")&&(Ye=!1);Ye&&(this.diagnostics={runnable:It,programLog:ge,vertexShader:{log:Te,prefix:G},fragmentShader:{log:et,prefix:X}})}p.deleteShader(oe),p.deleteShader(ue);let Ce;this.getUniforms=function(){return Ce===void 0&&(Ce=new s0(p,H)),Ce};let $;return this.getAttributes=function(){return $===void 0&&($=m4(p,H)),$},this.destroy=function(){d.releaseStatesOfProgram(this),p.deleteProgram(H),this.program=void 0},this.name=c.shaderName,this.id=c4++,this.cacheKey=s,this.usedTimes=1,this.program=H,this.vertexShader=oe,this.fragmentShader=ue,this}let S4=0;class M4{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(s){const c=s.vertexShader,d=s.fragmentShader,p=this._getShaderStage(c),y=this._getShaderStage(d),w=this._getShaderCacheForMaterial(s);return w.has(p)===!1&&(w.add(p),p.usedTimes++),w.has(y)===!1&&(w.add(y),y.usedTimes++),this}remove(s){const c=this.materialCache.get(s);for(const d of c)d.usedTimes--,d.usedTimes===0&&this.shaderCache.delete(d.code);return this.materialCache.delete(s),this}getVertexShaderID(s){return this._getShaderStage(s.vertexShader).id}getFragmentShaderID(s){return this._getShaderStage(s.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(s){const c=this.materialCache;let d=c.get(s);return d===void 0&&(d=new Set,c.set(s,d)),d}_getShaderStage(s){const c=this.shaderCache;let d=c.get(s);return d===void 0&&(d=new T4(s),c.set(s,d)),d}}class T4{constructor(s){this.id=S4++,this.code=s,this.usedTimes=0}}function I4(_,s,c,d,p,y,w){const E=new GA,P=new M4,L=[],O=p.isWebGL2,k=p.logarithmicDepthBuffer,N=p.vertexTextures;let z=p.precision;const V={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function H($,ge,Te,et,It){const Ye=et.fog,Fe=It.geometry,rt=$.isMeshStandardMaterial?et.environment:null,At=($.isMeshStandardMaterial?c:s).get($.envMap||rt),St=!!At&&At.mapping===me?At.image.height:null,at=V[$.type];$.precision!==null&&(z=p.getMaxPrecision($.precision),z!==$.precision&&console.warn("THREE.WebGLProgram.getParameters:",$.precision,"not supported, using",z,"instead."));const Qe=Fe.morphAttributes.position||Fe.morphAttributes.normal||Fe.morphAttributes.color,Je=Qe!==void 0?Qe.length:0;let Rt=0;Fe.morphAttributes.position!==void 0&&(Rt=1),Fe.morphAttributes.normal!==void 0&&(Rt=2),Fe.morphAttributes.color!==void 0&&(Rt=3);let Pt,Lt,yn,Hn;if(at){const li=Jo[at];Pt=li.vertexShader,Lt=li.fragmentShader}else Pt=$.vertexShader,Lt=$.fragmentShader,P.update($),yn=P.getVertexShaderID($),Hn=P.getFragmentShaderID($);const Ue=_.getRenderTarget(),ai=$.alphaTest>0,On=$.clearcoat>0,Vn=$.iridescence>0;return{isWebGL2:O,shaderID:at,shaderName:$.type,vertexShader:Pt,fragmentShader:Lt,defines:$.defines,customVertexShaderID:yn,customFragmentShaderID:Hn,isRawShaderMaterial:$.isRawShaderMaterial===!0,glslVersion:$.glslVersion,precision:z,instancing:It.isInstancedMesh===!0,instancingColor:It.isInstancedMesh===!0&&It.instanceColor!==null,supportsVertexTextures:N,outputEncoding:Ue===null?_.outputEncoding:Ue.isXRRenderTarget===!0?Ue.texture.encoding:$c,map:!!$.map,matcap:!!$.matcap,envMap:!!At,envMapMode:At&&At.mapping,envMapCubeUVHeight:St,lightMap:!!$.lightMap,aoMap:!!$.aoMap,emissiveMap:!!$.emissiveMap,bumpMap:!!$.bumpMap,normalMap:!!$.normalMap,objectSpaceNormalMap:$.normalMapType===N1,tangentSpaceNormalMap:$.normalMapType===el,decodeVideoTexture:!!$.map&&$.map.isVideoTexture===!0&&$.map.encoding===es,clearcoat:On,clearcoatMap:On&&!!$.clearcoatMap,clearcoatRoughnessMap:On&&!!$.clearcoatRoughnessMap,clearcoatNormalMap:On&&!!$.clearcoatNormalMap,iridescence:Vn,iridescenceMap:Vn&&!!$.iridescenceMap,iridescenceThicknessMap:Vn&&!!$.iridescenceThicknessMap,displacementMap:!!$.displacementMap,roughnessMap:!!$.roughnessMap,metalnessMap:!!$.metalnessMap,specularMap:!!$.specularMap,specularIntensityMap:!!$.specularIntensityMap,specularColorMap:!!$.specularColorMap,opaque:$.transparent===!1&&$.blending===b,alphaMap:!!$.alphaMap,alphaTest:ai,gradientMap:!!$.gradientMap,sheen:$.sheen>0,sheenColorMap:!!$.sheenColorMap,sheenRoughnessMap:!!$.sheenRoughnessMap,transmission:$.transmission>0,transmissionMap:!!$.transmissionMap,thicknessMap:!!$.thicknessMap,combine:$.combine,vertexTangents:!!$.normalMap&&!!Fe.attributes.tangent,vertexColors:$.vertexColors,vertexAlphas:$.vertexColors===!0&&!!Fe.attributes.color&&Fe.attributes.color.itemSize===4,vertexUvs:!!$.map||!!$.bumpMap||!!$.normalMap||!!$.specularMap||!!$.alphaMap||!!$.emissiveMap||!!$.roughnessMap||!!$.metalnessMap||!!$.clearcoatMap||!!$.clearcoatRoughnessMap||!!$.clearcoatNormalMap||!!$.iridescenceMap||!!$.iridescenceThicknessMap||!!$.displacementMap||!!$.transmissionMap||!!$.thicknessMap||!!$.specularIntensityMap||!!$.specularColorMap||!!$.sheenColorMap||!!$.sheenRoughnessMap,uvsVertexOnly:!(!!$.map||!!$.bumpMap||!!$.normalMap||!!$.specularMap||!!$.alphaMap||!!$.emissiveMap||!!$.roughnessMap||!!$.metalnessMap||!!$.clearcoatNormalMap||!!$.iridescenceMap||!!$.iridescenceThicknessMap||$.transmission>0||!!$.transmissionMap||!!$.thicknessMap||!!$.specularIntensityMap||!!$.specularColorMap||$.sheen>0||!!$.sheenColorMap||!!$.sheenRoughnessMap)&&!!$.displacementMap,fog:!!Ye,useFog:$.fog===!0,fogExp2:Ye&&Ye.isFogExp2,flatShading:!!$.flatShading,sizeAttenuation:$.sizeAttenuation,logarithmicDepthBuffer:k,skinning:It.isSkinnedMesh===!0,morphTargets:Fe.morphAttributes.position!==void 0,morphNormals:Fe.morphAttributes.normal!==void 0,morphColors:Fe.morphAttributes.color!==void 0,morphTargetsCount:Je,morphTextureStride:Rt,numDirLights:ge.directional.length,numPointLights:ge.point.length,numSpotLights:ge.spot.length,numSpotLightMaps:ge.spotLightMap.length,numRectAreaLights:ge.rectArea.length,numHemiLights:ge.hemi.length,numDirLightShadows:ge.directionalShadowMap.length,numPointLightShadows:ge.pointShadowMap.length,numSpotLightShadows:ge.spotShadowMap.length,numSpotLightShadowsWithMaps:ge.numSpotLightShadowsWithMaps,numClippingPlanes:w.numPlanes,numClipIntersection:w.numIntersection,dithering:$.dithering,shadowMapEnabled:_.shadowMap.enabled&&Te.length>0,shadowMapType:_.shadowMap.type,toneMapping:$.toneMapped?_.toneMapping:vn,physicallyCorrectLights:_.physicallyCorrectLights,premultipliedAlpha:$.premultipliedAlpha,doubleSided:$.side===A,flipSided:$.side===m,useDepthPacking:!!$.depthPacking,depthPacking:$.depthPacking||0,index0AttributeName:$.index0AttributeName,extensionDerivatives:$.extensions&&$.extensions.derivatives,extensionFragDepth:$.extensions&&$.extensions.fragDepth,extensionDrawBuffers:$.extensions&&$.extensions.drawBuffers,extensionShaderTextureLOD:$.extensions&&$.extensions.shaderTextureLOD,rendererExtensionFragDepth:O||d.has("EXT_frag_depth"),rendererExtensionDrawBuffers:O||d.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:O||d.has("EXT_shader_texture_lod"),customProgramCacheKey:$.customProgramCacheKey()}}function G($){const ge=[];if($.shaderID?ge.push($.shaderID):(ge.push($.customVertexShaderID),ge.push($.customFragmentShaderID)),$.defines!==void 0)for(const Te in $.defines)ge.push(Te),ge.push($.defines[Te]);return $.isRawShaderMaterial===!1&&(X(ge,$),K(ge,$),ge.push(_.outputEncoding)),ge.push($.customProgramCacheKey),ge.join()}function X($,ge){$.push(ge.precision),$.push(ge.outputEncoding),$.push(ge.envMapMode),$.push(ge.envMapCubeUVHeight),$.push(ge.combine),$.push(ge.vertexUvs),$.push(ge.fogExp2),$.push(ge.sizeAttenuation),$.push(ge.morphTargetsCount),$.push(ge.morphAttributeCount),$.push(ge.numDirLights),$.push(ge.numPointLights),$.push(ge.numSpotLights),$.push(ge.numSpotLightMaps),$.push(ge.numHemiLights),$.push(ge.numRectAreaLights),$.push(ge.numDirLightShadows),$.push(ge.numPointLightShadows),$.push(ge.numSpotLightShadows),$.push(ge.numSpotLightShadowsWithMaps),$.push(ge.shadowMapType),$.push(ge.toneMapping),$.push(ge.numClippingPlanes),$.push(ge.numClipIntersection),$.push(ge.depthPacking)}function K($,ge){E.disableAll(),ge.isWebGL2&&E.enable(0),ge.supportsVertexTextures&&E.enable(1),ge.instancing&&E.enable(2),ge.instancingColor&&E.enable(3),ge.map&&E.enable(4),ge.matcap&&E.enable(5),ge.envMap&&E.enable(6),ge.lightMap&&E.enable(7),ge.aoMap&&E.enable(8),ge.emissiveMap&&E.enable(9),ge.bumpMap&&E.enable(10),ge.normalMap&&E.enable(11),ge.objectSpaceNormalMap&&E.enable(12),ge.tangentSpaceNormalMap&&E.enable(13),ge.clearcoat&&E.enable(14),ge.clearcoatMap&&E.enable(15),ge.clearcoatRoughnessMap&&E.enable(16),ge.clearcoatNormalMap&&E.enable(17),ge.iridescence&&E.enable(18),ge.iridescenceMap&&E.enable(19),ge.iridescenceThicknessMap&&E.enable(20),ge.displacementMap&&E.enable(21),ge.specularMap&&E.enable(22),ge.roughnessMap&&E.enable(23),ge.metalnessMap&&E.enable(24),ge.gradientMap&&E.enable(25),ge.alphaMap&&E.enable(26),ge.alphaTest&&E.enable(27),ge.vertexColors&&E.enable(28),ge.vertexAlphas&&E.enable(29),ge.vertexUvs&&E.enable(30),ge.vertexTangents&&E.enable(31),ge.uvsVertexOnly&&E.enable(32),$.push(E.mask),E.disableAll(),ge.fog&&E.enable(0),ge.useFog&&E.enable(1),ge.flatShading&&E.enable(2),ge.logarithmicDepthBuffer&&E.enable(3),ge.skinning&&E.enable(4),ge.morphTargets&&E.enable(5),ge.morphNormals&&E.enable(6),ge.morphColors&&E.enable(7),ge.premultipliedAlpha&&E.enable(8),ge.shadowMapEnabled&&E.enable(9),ge.physicallyCorrectLights&&E.enable(10),ge.doubleSided&&E.enable(11),ge.flipSided&&E.enable(12),ge.useDepthPacking&&E.enable(13),ge.dithering&&E.enable(14),ge.specularIntensityMap&&E.enable(15),ge.specularColorMap&&E.enable(16),ge.transmission&&E.enable(17),ge.transmissionMap&&E.enable(18),ge.thicknessMap&&E.enable(19),ge.sheen&&E.enable(20),ge.sheenColorMap&&E.enable(21),ge.sheenRoughnessMap&&E.enable(22),ge.decodeVideoTexture&&E.enable(23),ge.opaque&&E.enable(24),$.push(E.mask)}function ne($){const ge=V[$.type];let Te;if(ge){const et=Jo[ge];Te=tT.clone(et.uniforms)}else Te=$.uniforms;return Te}function te($,ge){let Te;for(let et=0,It=L.length;et<It;et++){const Ye=L[et];if(Ye.cacheKey===ge){Te=Ye,++Te.usedTimes;break}}return Te===void 0&&(Te=new E4(_,ge,$,y),L.push(Te)),Te}function oe($){if(--$.usedTimes===0){const ge=L.indexOf($);L[ge]=L[L.length-1],L.pop(),$.destroy()}}function ue($){P.remove($)}function Ce(){P.dispose()}return{getParameters:H,getProgramCacheKey:G,getUniforms:ne,acquireProgram:te,releaseProgram:oe,releaseShaderCache:ue,programs:L,dispose:Ce}}function R4(){let _=new WeakMap;function s(y){let w=_.get(y);return w===void 0&&(w={},_.set(y,w)),w}function c(y){_.delete(y)}function d(y,w,E){_.get(y)[w]=E}function p(){_=new WeakMap}return{get:s,remove:c,update:d,dispose:p}}function P4(_,s){return _.groupOrder!==s.groupOrder?_.groupOrder-s.groupOrder:_.renderOrder!==s.renderOrder?_.renderOrder-s.renderOrder:_.material.id!==s.material.id?_.material.id-s.material.id:_.z!==s.z?_.z-s.z:_.id-s.id}function MT(_,s){return _.groupOrder!==s.groupOrder?_.groupOrder-s.groupOrder:_.renderOrder!==s.renderOrder?_.renderOrder-s.renderOrder:_.z!==s.z?s.z-_.z:_.id-s.id}function TT(){const _=[];let s=0;const c=[],d=[],p=[];function y(){s=0,c.length=0,d.length=0,p.length=0}function w(k,N,z,V,H,G){let X=_[s];return X===void 0?(X={id:k.id,object:k,geometry:N,material:z,groupOrder:V,renderOrder:k.renderOrder,z:H,group:G},_[s]=X):(X.id=k.id,X.object=k,X.geometry=N,X.material=z,X.groupOrder=V,X.renderOrder=k.renderOrder,X.z=H,X.group=G),s++,X}function E(k,N,z,V,H,G){const X=w(k,N,z,V,H,G);z.transmission>0?d.push(X):z.transparent===!0?p.push(X):c.push(X)}function P(k,N,z,V,H,G){const X=w(k,N,z,V,H,G);z.transmission>0?d.unshift(X):z.transparent===!0?p.unshift(X):c.unshift(X)}function L(k,N){c.length>1&&c.sort(k||P4),d.length>1&&d.sort(N||MT),p.length>1&&p.sort(N||MT)}function O(){for(let k=s,N=_.length;k<N;k++){const z=_[k];if(z.id===null)break;z.id=null,z.object=null,z.geometry=null,z.material=null,z.group=null}}return{opaque:c,transmissive:d,transparent:p,init:y,push:E,unshift:P,finish:O,sort:L}}function B4(){let _=new WeakMap;function s(d,p){const y=_.get(d);let w;return y===void 0?(w=new TT,_.set(d,[w])):p>=y.length?(w=new TT,y.push(w)):w=y[p],w}function c(){_=new WeakMap}return{get:s,dispose:c}}function L4(){const _={};return{get:function(s){if(_[s.id]!==void 0)return _[s.id];let c;switch(s.type){case"DirectionalLight":c={direction:new de,color:new dn};break;case"SpotLight":c={position:new de,direction:new de,color:new dn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new de,color:new dn,distance:0,decay:0};break;case"HemisphereLight":c={direction:new de,skyColor:new dn,groundColor:new dn};break;case"RectAreaLight":c={color:new dn,position:new de,halfWidth:new de,halfHeight:new de};break}return _[s.id]=c,c}}}function D4(){const _={};return{get:function(s){if(_[s.id]!==void 0)return _[s.id];let c;switch(s.type){case"DirectionalLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"SpotLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"PointLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt,shadowCameraNear:1,shadowCameraFar:1e3};break}return _[s.id]=c,c}}}let O4=0;function F4(_,s){return(s.castShadow?2:0)-(_.castShadow?2:0)+(s.map?1:0)-(_.map?1:0)}function k4(_,s){const c=new L4,d=D4(),p={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let O=0;O<9;O++)p.probe.push(new de);const y=new de,w=new $n,E=new $n;function P(O,k){let N=0,z=0,V=0;for(let et=0;et<9;et++)p.probe[et].set(0,0,0);let H=0,G=0,X=0,K=0,ne=0,te=0,oe=0,ue=0,Ce=0,$=0;O.sort(F4);const ge=k!==!0?Math.PI:1;for(let et=0,It=O.length;et<It;et++){const Ye=O[et],Fe=Ye.color,rt=Ye.intensity,At=Ye.distance,St=Ye.shadow&&Ye.shadow.map?Ye.shadow.map.texture:null;if(Ye.isAmbientLight)N+=Fe.r*rt*ge,z+=Fe.g*rt*ge,V+=Fe.b*rt*ge;else if(Ye.isLightProbe)for(let at=0;at<9;at++)p.probe[at].addScaledVector(Ye.sh.coefficients[at],rt);else if(Ye.isDirectionalLight){const at=c.get(Ye);if(at.color.copy(Ye.color).multiplyScalar(Ye.intensity*ge),Ye.castShadow){const Qe=Ye.shadow,Je=d.get(Ye);Je.shadowBias=Qe.bias,Je.shadowNormalBias=Qe.normalBias,Je.shadowRadius=Qe.radius,Je.shadowMapSize=Qe.mapSize,p.directionalShadow[H]=Je,p.directionalShadowMap[H]=St,p.directionalShadowMatrix[H]=Ye.shadow.matrix,te++}p.directional[H]=at,H++}else if(Ye.isSpotLight){const at=c.get(Ye);at.position.setFromMatrixPosition(Ye.matrixWorld),at.color.copy(Fe).multiplyScalar(rt*ge),at.distance=At,at.coneCos=Math.cos(Ye.angle),at.penumbraCos=Math.cos(Ye.angle*(1-Ye.penumbra)),at.decay=Ye.decay,p.spot[X]=at;const Qe=Ye.shadow;if(Ye.map&&(p.spotLightMap[Ce]=Ye.map,Ce++,Qe.updateMatrices(Ye),Ye.castShadow&&$++),p.spotLightMatrix[X]=Qe.matrix,Ye.castShadow){const Je=d.get(Ye);Je.shadowBias=Qe.bias,Je.shadowNormalBias=Qe.normalBias,Je.shadowRadius=Qe.radius,Je.shadowMapSize=Qe.mapSize,p.spotShadow[X]=Je,p.spotShadowMap[X]=St,ue++}X++}else if(Ye.isRectAreaLight){const at=c.get(Ye);at.color.copy(Fe).multiplyScalar(rt),at.halfWidth.set(Ye.width*.5,0,0),at.halfHeight.set(0,Ye.height*.5,0),p.rectArea[K]=at,K++}else if(Ye.isPointLight){const at=c.get(Ye);if(at.color.copy(Ye.color).multiplyScalar(Ye.intensity*ge),at.distance=Ye.distance,at.decay=Ye.decay,Ye.castShadow){const Qe=Ye.shadow,Je=d.get(Ye);Je.shadowBias=Qe.bias,Je.shadowNormalBias=Qe.normalBias,Je.shadowRadius=Qe.radius,Je.shadowMapSize=Qe.mapSize,Je.shadowCameraNear=Qe.camera.near,Je.shadowCameraFar=Qe.camera.far,p.pointShadow[G]=Je,p.pointShadowMap[G]=St,p.pointShadowMatrix[G]=Ye.shadow.matrix,oe++}p.point[G]=at,G++}else if(Ye.isHemisphereLight){const at=c.get(Ye);at.skyColor.copy(Ye.color).multiplyScalar(rt*ge),at.groundColor.copy(Ye.groundColor).multiplyScalar(rt*ge),p.hemi[ne]=at,ne++}}K>0&&(s.isWebGL2||_.has("OES_texture_float_linear")===!0?(p.rectAreaLTC1=Qt.LTC_FLOAT_1,p.rectAreaLTC2=Qt.LTC_FLOAT_2):_.has("OES_texture_half_float_linear")===!0?(p.rectAreaLTC1=Qt.LTC_HALF_1,p.rectAreaLTC2=Qt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),p.ambient[0]=N,p.ambient[1]=z,p.ambient[2]=V;const Te=p.hash;(Te.directionalLength!==H||Te.pointLength!==G||Te.spotLength!==X||Te.rectAreaLength!==K||Te.hemiLength!==ne||Te.numDirectionalShadows!==te||Te.numPointShadows!==oe||Te.numSpotShadows!==ue||Te.numSpotMaps!==Ce)&&(p.directional.length=H,p.spot.length=X,p.rectArea.length=K,p.point.length=G,p.hemi.length=ne,p.directionalShadow.length=te,p.directionalShadowMap.length=te,p.pointShadow.length=oe,p.pointShadowMap.length=oe,p.spotShadow.length=ue,p.spotShadowMap.length=ue,p.directionalShadowMatrix.length=te,p.pointShadowMatrix.length=oe,p.spotLightMatrix.length=ue+Ce-$,p.spotLightMap.length=Ce,p.numSpotLightShadowsWithMaps=$,Te.directionalLength=H,Te.pointLength=G,Te.spotLength=X,Te.rectAreaLength=K,Te.hemiLength=ne,Te.numDirectionalShadows=te,Te.numPointShadows=oe,Te.numSpotShadows=ue,Te.numSpotMaps=Ce,p.version=O4++)}function L(O,k){let N=0,z=0,V=0,H=0,G=0;const X=k.matrixWorldInverse;for(let K=0,ne=O.length;K<ne;K++){const te=O[K];if(te.isDirectionalLight){const oe=p.directional[N];oe.direction.setFromMatrixPosition(te.matrixWorld),y.setFromMatrixPosition(te.target.matrixWorld),oe.direction.sub(y),oe.direction.transformDirection(X),N++}else if(te.isSpotLight){const oe=p.spot[V];oe.position.setFromMatrixPosition(te.matrixWorld),oe.position.applyMatrix4(X),oe.direction.setFromMatrixPosition(te.matrixWorld),y.setFromMatrixPosition(te.target.matrixWorld),oe.direction.sub(y),oe.direction.transformDirection(X),V++}else if(te.isRectAreaLight){const oe=p.rectArea[H];oe.position.setFromMatrixPosition(te.matrixWorld),oe.position.applyMatrix4(X),E.identity(),w.copy(te.matrixWorld),w.premultiply(X),E.extractRotation(w),oe.halfWidth.set(te.width*.5,0,0),oe.halfHeight.set(0,te.height*.5,0),oe.halfWidth.applyMatrix4(E),oe.halfHeight.applyMatrix4(E),H++}else if(te.isPointLight){const oe=p.point[z];oe.position.setFromMatrixPosition(te.matrixWorld),oe.position.applyMatrix4(X),z++}else if(te.isHemisphereLight){const oe=p.hemi[G];oe.direction.setFromMatrixPosition(te.matrixWorld),oe.direction.transformDirection(X),G++}}}return{setup:P,setupView:L,state:p}}function IT(_,s){const c=new k4(_,s),d=[],p=[];function y(){d.length=0,p.length=0}function w(k){d.push(k)}function E(k){p.push(k)}function P(k){c.setup(d,k)}function L(k){c.setupView(d,k)}return{init:y,state:{lightsArray:d,shadowsArray:p,lights:c},setupLights:P,setupLightsView:L,pushLight:w,pushShadow:E}}function N4(_,s){let c=new WeakMap;function d(y,w){const E=c.get(y);let P;return E===void 0?(P=new IT(_,s),c.set(y,[P])):w>=E.length?(P=new IT(_,s),E.push(P)):P=E[w],P}function p(){c=new WeakMap}return{get:d,dispose:p}}class pw extends cr{constructor(s){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=F1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(s)}copy(s){return super.copy(s),this.depthPacking=s.depthPacking,this.map=s.map,this.alphaMap=s.alphaMap,this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this}}class mw extends cr{constructor(s){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new de,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(s)}copy(s){return super.copy(s),this.referencePosition.copy(s.referencePosition),this.nearDistance=s.nearDistance,this.farDistance=s.farDistance,this.map=s.map,this.alphaMap=s.alphaMap,this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this}}const U4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,z4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function G4(_,s,c){let d=new e0;const p=new gt,y=new gt,w=new Pi,E=new pw({depthPacking:k1}),P=new mw,L={},O=c.maxTextureSize,k={0:m,1:g,2:A},N=new Ea({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new gt},radius:{value:4}},vertexShader:U4,fragmentShader:z4}),z=N.clone();z.defines.HORIZONTAL_PASS=1;const V=new si;V.setAttribute("position",new Fi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const H=new Js(V,N),G=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(te,oe,ue){if(G.enabled===!1||G.autoUpdate===!1&&G.needsUpdate===!1||te.length===0)return;const Ce=_.getRenderTarget(),$=_.getActiveCubeFace(),ge=_.getActiveMipmapLevel(),Te=_.state;Te.setBlending(v),Te.buffers.color.setClear(1,1,1,1),Te.buffers.depth.setTest(!0),Te.setScissorTest(!1);for(let et=0,It=te.length;et<It;et++){const Ye=te[et],Fe=Ye.shadow;if(Fe===void 0){console.warn("THREE.WebGLShadowMap:",Ye,"has no shadow.");continue}if(Fe.autoUpdate===!1&&Fe.needsUpdate===!1)continue;p.copy(Fe.mapSize);const rt=Fe.getFrameExtents();if(p.multiply(rt),y.copy(Fe.mapSize),(p.x>O||p.y>O)&&(p.x>O&&(y.x=Math.floor(O/rt.x),p.x=y.x*rt.x,Fe.mapSize.x=y.x),p.y>O&&(y.y=Math.floor(O/rt.y),p.y=y.y*rt.y,Fe.mapSize.y=y.y)),Fe.map===null){const St=this.type!==f?{minFilter:mt,magFilter:mt}:{};Fe.map=new xo(p.x,p.y,St),Fe.map.texture.name=Ye.name+".shadowMap",Fe.camera.updateProjectionMatrix()}_.setRenderTarget(Fe.map),_.clear();const At=Fe.getViewportCount();for(let St=0;St<At;St++){const at=Fe.getViewport(St);w.set(y.x*at.x,y.y*at.y,y.x*at.z,y.y*at.w),Te.viewport(w),Fe.updateMatrices(Ye,St),d=Fe.getFrustum(),ne(oe,ue,Fe.camera,Ye,this.type)}Fe.isPointLightShadow!==!0&&this.type===f&&X(Fe,ue),Fe.needsUpdate=!1}G.needsUpdate=!1,_.setRenderTarget(Ce,$,ge)};function X(te,oe){const ue=s.update(H);N.defines.VSM_SAMPLES!==te.blurSamples&&(N.defines.VSM_SAMPLES=te.blurSamples,z.defines.VSM_SAMPLES=te.blurSamples,N.needsUpdate=!0,z.needsUpdate=!0),te.mapPass===null&&(te.mapPass=new xo(p.x,p.y)),N.uniforms.shadow_pass.value=te.map.texture,N.uniforms.resolution.value=te.mapSize,N.uniforms.radius.value=te.radius,_.setRenderTarget(te.mapPass),_.clear(),_.renderBufferDirect(oe,null,ue,N,H,null),z.uniforms.shadow_pass.value=te.mapPass.texture,z.uniforms.resolution.value=te.mapSize,z.uniforms.radius.value=te.radius,_.setRenderTarget(te.map),_.clear(),_.renderBufferDirect(oe,null,ue,z,H,null)}function K(te,oe,ue,Ce,$,ge){let Te=null;const et=ue.isPointLight===!0?te.customDistanceMaterial:te.customDepthMaterial;if(et!==void 0?Te=et:Te=ue.isPointLight===!0?P:E,_.localClippingEnabled&&oe.clipShadows===!0&&Array.isArray(oe.clippingPlanes)&&oe.clippingPlanes.length!==0||oe.displacementMap&&oe.displacementScale!==0||oe.alphaMap&&oe.alphaTest>0){const It=Te.uuid,Ye=oe.uuid;let Fe=L[It];Fe===void 0&&(Fe={},L[It]=Fe);let rt=Fe[Ye];rt===void 0&&(rt=Te.clone(),Fe[Ye]=rt),Te=rt}return Te.visible=oe.visible,Te.wireframe=oe.wireframe,ge===f?Te.side=oe.shadowSide!==null?oe.shadowSide:oe.side:Te.side=oe.shadowSide!==null?oe.shadowSide:k[oe.side],Te.alphaMap=oe.alphaMap,Te.alphaTest=oe.alphaTest,Te.clipShadows=oe.clipShadows,Te.clippingPlanes=oe.clippingPlanes,Te.clipIntersection=oe.clipIntersection,Te.displacementMap=oe.displacementMap,Te.displacementScale=oe.displacementScale,Te.displacementBias=oe.displacementBias,Te.wireframeLinewidth=oe.wireframeLinewidth,Te.linewidth=oe.linewidth,ue.isPointLight===!0&&Te.isMeshDistanceMaterial===!0&&(Te.referencePosition.setFromMatrixPosition(ue.matrixWorld),Te.nearDistance=Ce,Te.farDistance=$),Te}function ne(te,oe,ue,Ce,$){if(te.visible===!1)return;if(te.layers.test(oe.layers)&&(te.isMesh||te.isLine||te.isPoints)&&(te.castShadow||te.receiveShadow&&$===f)&&(!te.frustumCulled||d.intersectsObject(te))){te.modelViewMatrix.multiplyMatrices(ue.matrixWorldInverse,te.matrixWorld);const et=s.update(te),It=te.material;if(Array.isArray(It)){const Ye=et.groups;for(let Fe=0,rt=Ye.length;Fe<rt;Fe++){const At=Ye[Fe],St=It[At.materialIndex];if(St&&St.visible){const at=K(te,St,Ce,ue.near,ue.far,$);_.renderBufferDirect(ue,null,et,at,te,At)}}}else if(It.visible){const Ye=K(te,It,Ce,ue.near,ue.far,$);_.renderBufferDirect(ue,null,et,Ye,te,null)}}const Te=te.children;for(let et=0,It=Te.length;et<It;et++)ne(Te[et],oe,ue,Ce,$)}}function H4(_,s,c){const d=c.isWebGL2;function p(){let Pe=!1;const _n=new Pi;let qt=null;const ht=new Pi(0,0,0,0);return{setMask:function(Yt){qt!==Yt&&!Pe&&(_.colorMask(Yt,Yt,Yt,Yt),qt=Yt)},setLocked:function(Yt){Pe=Yt},setClear:function(Yt,Un,ji,ms,gl){gl===!0&&(Yt*=ms,Un*=ms,ji*=ms),_n.set(Yt,Un,ji,ms),ht.equals(_n)===!1&&(_.clearColor(Yt,Un,ji,ms),ht.copy(_n))},reset:function(){Pe=!1,qt=null,ht.set(-1,0,0,0)}}}function y(){let Pe=!1,_n=null,qt=null,ht=null;return{setTest:function(Yt){Yt?ai(_.DEPTH_TEST):On(_.DEPTH_TEST)},setMask:function(Yt){_n!==Yt&&!Pe&&(_.depthMask(Yt),_n=Yt)},setFunc:function(Yt){if(qt!==Yt){switch(Yt){case Ie:_.depthFunc(_.NEVER);break;case Le:_.depthFunc(_.ALWAYS);break;case De:_.depthFunc(_.LESS);break;case $e:_.depthFunc(_.LEQUAL);break;case vt:_.depthFunc(_.EQUAL);break;case zt:_.depthFunc(_.GEQUAL);break;case Ve:_.depthFunc(_.GREATER);break;case gn:_.depthFunc(_.NOTEQUAL);break;default:_.depthFunc(_.LEQUAL)}qt=Yt}},setLocked:function(Yt){Pe=Yt},setClear:function(Yt){ht!==Yt&&(_.clearDepth(Yt),ht=Yt)},reset:function(){Pe=!1,_n=null,qt=null,ht=null}}}function w(){let Pe=!1,_n=null,qt=null,ht=null,Yt=null,Un=null,ji=null,ms=null,gl=null;return{setTest:function(rs){Pe||(rs?ai(_.STENCIL_TEST):On(_.STENCIL_TEST))},setMask:function(rs){_n!==rs&&!Pe&&(_.stencilMask(rs),_n=rs)},setFunc:function(rs,_c,Eo){(qt!==rs||ht!==_c||Yt!==Eo)&&(_.stencilFunc(rs,_c,Eo),qt=rs,ht=_c,Yt=Eo)},setOp:function(rs,_c,Eo){(Un!==rs||ji!==_c||ms!==Eo)&&(_.stencilOp(rs,_c,Eo),Un=rs,ji=_c,ms=Eo)},setLocked:function(rs){Pe=rs},setClear:function(rs){gl!==rs&&(_.clearStencil(rs),gl=rs)},reset:function(){Pe=!1,_n=null,qt=null,ht=null,Yt=null,Un=null,ji=null,ms=null,gl=null}}}const E=new p,P=new y,L=new w,O=new WeakMap,k=new WeakMap;let N={},z={},V=new WeakMap,H=[],G=null,X=!1,K=null,ne=null,te=null,oe=null,ue=null,Ce=null,$=null,ge=!1,Te=null,et=null,It=null,Ye=null,Fe=null;const rt=_.getParameter(_.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let At=!1,St=0;const at=_.getParameter(_.VERSION);at.indexOf("WebGL")!==-1?(St=parseFloat(/^WebGL (\d)/.exec(at)[1]),At=St>=1):at.indexOf("OpenGL ES")!==-1&&(St=parseFloat(/^OpenGL ES (\d)/.exec(at)[1]),At=St>=2);let Qe=null,Je={};const Rt=_.getParameter(_.SCISSOR_BOX),Pt=_.getParameter(_.VIEWPORT),Lt=new Pi().fromArray(Rt),yn=new Pi().fromArray(Pt);function Hn(Pe,_n,qt){const ht=new Uint8Array(4),Yt=_.createTexture();_.bindTexture(Pe,Yt),_.texParameteri(Pe,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(Pe,_.TEXTURE_MAG_FILTER,_.NEAREST);for(let Un=0;Un<qt;Un++)_.texImage2D(_n+Un,0,_.RGBA,1,1,0,_.RGBA,_.UNSIGNED_BYTE,ht);return Yt}const Ue={};Ue[_.TEXTURE_2D]=Hn(_.TEXTURE_2D,_.TEXTURE_2D,1),Ue[_.TEXTURE_CUBE_MAP]=Hn(_.TEXTURE_CUBE_MAP,_.TEXTURE_CUBE_MAP_POSITIVE_X,6),E.setClear(0,0,0,1),P.setClear(1),L.setClear(0),ai(_.DEPTH_TEST),P.setFunc($e),sn(!1),ei(i),ai(_.CULL_FACE),Gt(v);function ai(Pe){N[Pe]!==!0&&(_.enable(Pe),N[Pe]=!0)}function On(Pe){N[Pe]!==!1&&(_.disable(Pe),N[Pe]=!1)}function Vn(Pe,_n){return z[Pe]!==_n?(_.bindFramebuffer(Pe,_n),z[Pe]=_n,d&&(Pe===_.DRAW_FRAMEBUFFER&&(z[_.FRAMEBUFFER]=_n),Pe===_.FRAMEBUFFER&&(z[_.DRAW_FRAMEBUFFER]=_n)),!0):!1}function on(Pe,_n){let qt=H,ht=!1;if(Pe)if(qt=V.get(_n),qt===void 0&&(qt=[],V.set(_n,qt)),Pe.isWebGLMultipleRenderTargets){const Yt=Pe.texture;if(qt.length!==Yt.length||qt[0]!==_.COLOR_ATTACHMENT0){for(let Un=0,ji=Yt.length;Un<ji;Un++)qt[Un]=_.COLOR_ATTACHMENT0+Un;qt.length=Yt.length,ht=!0}}else qt[0]!==_.COLOR_ATTACHMENT0&&(qt[0]=_.COLOR_ATTACHMENT0,ht=!0);else qt[0]!==_.BACK&&(qt[0]=_.BACK,ht=!0);ht&&(c.isWebGL2?_.drawBuffers(qt):s.get("WEBGL_draw_buffers").drawBuffersWEBGL(qt))}function li(Pe){return G!==Pe?(_.useProgram(Pe),G=Pe,!0):!1}const dt={[R]:_.FUNC_ADD,[T]:_.FUNC_SUBTRACT,[B]:_.FUNC_REVERSE_SUBTRACT};if(d)dt[F]=_.MIN,dt[D]=_.MAX;else{const Pe=s.get("EXT_blend_minmax");Pe!==null&&(dt[F]=Pe.MIN_EXT,dt[D]=Pe.MAX_EXT)}const ct={[U]:_.ZERO,[W]:_.ONE,[J]:_.SRC_COLOR,[Q]:_.SRC_ALPHA,[Ae]:_.SRC_ALPHA_SATURATE,[ve]:_.DST_COLOR,[se]:_.DST_ALPHA,[ee]:_.ONE_MINUS_SRC_COLOR,[Y]:_.ONE_MINUS_SRC_ALPHA,[xe]:_.ONE_MINUS_DST_COLOR,[ae]:_.ONE_MINUS_DST_ALPHA};function Gt(Pe,_n,qt,ht,Yt,Un,ji,ms){if(Pe===v){X===!0&&(On(_.BLEND),X=!1);return}if(X===!1&&(ai(_.BLEND),X=!0),Pe!==M){if(Pe!==K||ms!==ge){if((ne!==R||ue!==R)&&(_.blendEquation(_.FUNC_ADD),ne=R,ue=R),ms)switch(Pe){case b:_.blendFuncSeparate(_.ONE,_.ONE_MINUS_SRC_ALPHA,_.ONE,_.ONE_MINUS_SRC_ALPHA);break;case C:_.blendFunc(_.ONE,_.ONE);break;case S:_.blendFuncSeparate(_.ZERO,_.ONE_MINUS_SRC_COLOR,_.ZERO,_.ONE);break;case I:_.blendFuncSeparate(_.ZERO,_.SRC_COLOR,_.ZERO,_.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}else switch(Pe){case b:_.blendFuncSeparate(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA,_.ONE,_.ONE_MINUS_SRC_ALPHA);break;case C:_.blendFunc(_.SRC_ALPHA,_.ONE);break;case S:_.blendFuncSeparate(_.ZERO,_.ONE_MINUS_SRC_COLOR,_.ZERO,_.ONE);break;case I:_.blendFunc(_.ZERO,_.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}te=null,oe=null,Ce=null,$=null,K=Pe,ge=ms}return}Yt=Yt||_n,Un=Un||qt,ji=ji||ht,(_n!==ne||Yt!==ue)&&(_.blendEquationSeparate(dt[_n],dt[Yt]),ne=_n,ue=Yt),(qt!==te||ht!==oe||Un!==Ce||ji!==$)&&(_.blendFuncSeparate(ct[qt],ct[ht],ct[Un],ct[ji]),te=qt,oe=ht,Ce=Un,$=ji),K=Pe,ge=null}function bn(Pe,_n){Pe.side===A?On(_.CULL_FACE):ai(_.CULL_FACE);let qt=Pe.side===m;_n&&(qt=!qt),sn(qt),Pe.blending===b&&Pe.transparent===!1?Gt(v):Gt(Pe.blending,Pe.blendEquation,Pe.blendSrc,Pe.blendDst,Pe.blendEquationAlpha,Pe.blendSrcAlpha,Pe.blendDstAlpha,Pe.premultipliedAlpha),P.setFunc(Pe.depthFunc),P.setTest(Pe.depthTest),P.setMask(Pe.depthWrite),E.setMask(Pe.colorWrite);const ht=Pe.stencilWrite;L.setTest(ht),ht&&(L.setMask(Pe.stencilWriteMask),L.setFunc(Pe.stencilFunc,Pe.stencilRef,Pe.stencilFuncMask),L.setOp(Pe.stencilFail,Pe.stencilZFail,Pe.stencilZPass)),Pn(Pe.polygonOffset,Pe.polygonOffsetFactor,Pe.polygonOffsetUnits),Pe.alphaToCoverage===!0?ai(_.SAMPLE_ALPHA_TO_COVERAGE):On(_.SAMPLE_ALPHA_TO_COVERAGE)}function sn(Pe){Te!==Pe&&(Pe?_.frontFace(_.CW):_.frontFace(_.CCW),Te=Pe)}function ei(Pe){Pe!==n?(ai(_.CULL_FACE),Pe!==et&&(Pe===i?_.cullFace(_.BACK):Pe===r?_.cullFace(_.FRONT):_.cullFace(_.FRONT_AND_BACK))):On(_.CULL_FACE),et=Pe}function kn(Pe){Pe!==It&&(At&&_.lineWidth(Pe),It=Pe)}function Pn(Pe,_n,qt){Pe?(ai(_.POLYGON_OFFSET_FILL),(Ye!==_n||Fe!==qt)&&(_.polygonOffset(_n,qt),Ye=_n,Fe=qt)):On(_.POLYGON_OFFSET_FILL)}function Qi(Pe){Pe?ai(_.SCISSOR_TEST):On(_.SCISSOR_TEST)}function ki(Pe){Pe===void 0&&(Pe=_.TEXTURE0+rt-1),Qe!==Pe&&(_.activeTexture(Pe),Qe=Pe)}function _e(Pe,_n,qt){qt===void 0&&(Qe===null?qt=_.TEXTURE0+rt-1:qt=Qe);let ht=Je[qt];ht===void 0&&(ht={type:void 0,texture:void 0},Je[qt]=ht),(ht.type!==Pe||ht.texture!==_n)&&(Qe!==qt&&(_.activeTexture(qt),Qe=qt),_.bindTexture(Pe,_n||Ue[Pe]),ht.type=Pe,ht.texture=_n)}function le(){const Pe=Je[Qe];Pe!==void 0&&Pe.type!==void 0&&(_.bindTexture(Pe.type,null),Pe.type=void 0,Pe.texture=void 0)}function Ze(){try{_.compressedTexImage2D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Ot(){try{_.texSubImage2D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function jt(){try{_.texSubImage3D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function an(){try{_.compressedTexSubImage2D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function zn(){try{_.texStorage2D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function cn(){try{_.texStorage3D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ft(){try{_.texImage2D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Tn(){try{_.texImage3D.apply(_,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Wn(Pe){Lt.equals(Pe)===!1&&(_.scissor(Pe.x,Pe.y,Pe.z,Pe.w),Lt.copy(Pe))}function En(Pe){yn.equals(Pe)===!1&&(_.viewport(Pe.x,Pe.y,Pe.z,Pe.w),yn.copy(Pe))}function Nn(Pe,_n){let qt=k.get(_n);qt===void 0&&(qt=new WeakMap,k.set(_n,qt));let ht=qt.get(Pe);ht===void 0&&(ht=_.getUniformBlockIndex(_n,Pe.name),qt.set(Pe,ht))}function ri(Pe,_n){const ht=k.get(_n).get(Pe);O.get(Pe)!==ht&&(_.uniformBlockBinding(_n,ht,Pe.__bindingPointIndex),O.set(Pe,ht))}function Li(){_.disable(_.BLEND),_.disable(_.CULL_FACE),_.disable(_.DEPTH_TEST),_.disable(_.POLYGON_OFFSET_FILL),_.disable(_.SCISSOR_TEST),_.disable(_.STENCIL_TEST),_.disable(_.SAMPLE_ALPHA_TO_COVERAGE),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ONE,_.ZERO),_.blendFuncSeparate(_.ONE,_.ZERO,_.ONE,_.ZERO),_.colorMask(!0,!0,!0,!0),_.clearColor(0,0,0,0),_.depthMask(!0),_.depthFunc(_.LESS),_.clearDepth(1),_.stencilMask(4294967295),_.stencilFunc(_.ALWAYS,0,4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP),_.clearStencil(0),_.cullFace(_.BACK),_.frontFace(_.CCW),_.polygonOffset(0,0),_.activeTexture(_.TEXTURE0),_.bindFramebuffer(_.FRAMEBUFFER,null),d===!0&&(_.bindFramebuffer(_.DRAW_FRAMEBUFFER,null),_.bindFramebuffer(_.READ_FRAMEBUFFER,null)),_.useProgram(null),_.lineWidth(1),_.scissor(0,0,_.canvas.width,_.canvas.height),_.viewport(0,0,_.canvas.width,_.canvas.height),N={},Qe=null,Je={},z={},V=new WeakMap,H=[],G=null,X=!1,K=null,ne=null,te=null,oe=null,ue=null,Ce=null,$=null,ge=!1,Te=null,et=null,It=null,Ye=null,Fe=null,Lt.set(0,0,_.canvas.width,_.canvas.height),yn.set(0,0,_.canvas.width,_.canvas.height),E.reset(),P.reset(),L.reset()}return{buffers:{color:E,depth:P,stencil:L},enable:ai,disable:On,bindFramebuffer:Vn,drawBuffers:on,useProgram:li,setBlending:Gt,setMaterial:bn,setFlipSided:sn,setCullFace:ei,setLineWidth:kn,setPolygonOffset:Pn,setScissorTest:Qi,activeTexture:ki,bindTexture:_e,unbindTexture:le,compressedTexImage2D:Ze,texImage2D:ft,texImage3D:Tn,updateUBOMapping:Nn,uniformBlockBinding:ri,texStorage2D:zn,texStorage3D:cn,texSubImage2D:Ot,texSubImage3D:jt,compressedTexSubImage2D:an,scissor:Wn,viewport:En,reset:Li}}function V4(_,s,c,d,p,y,w){const E=p.isWebGL2,P=p.maxTextures,L=p.maxCubemapSize,O=p.maxTextureSize,k=p.maxSamples,N=s.has("WEBGL_multisampled_render_to_texture")?s.get("WEBGL_multisampled_render_to_texture"):null,z=/OculusBrowser/g.test(navigator.userAgent),V=new WeakMap;let H;const G=new WeakMap;let X=!1;try{X=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function K(_e,le){return X?new OffscreenCanvas(_e,le):Sp("canvas")}function ne(_e,le,Ze,Ot){let jt=1;if((_e.width>Ot||_e.height>Ot)&&(jt=Ot/Math.max(_e.width,_e.height)),jt<1||le===!0)if(typeof HTMLImageElement<"u"&&_e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&_e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&_e instanceof ImageBitmap){const an=le?RA:Math.floor,zn=an(jt*_e.width),cn=an(jt*_e.height);H===void 0&&(H=K(zn,cn));const ft=Ze?K(zn,cn):H;return ft.width=zn,ft.height=cn,ft.getContext("2d").drawImage(_e,0,0,zn,cn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+_e.width+"x"+_e.height+") to ("+zn+"x"+cn+")."),ft}else return"data"in _e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+_e.width+"x"+_e.height+")."),_e;return _e}function te(_e){return kx(_e.width)&&kx(_e.height)}function oe(_e){return E?!1:_e.wrapS!==je||_e.wrapT!==je||_e.minFilter!==mt&&_e.minFilter!==Et}function ue(_e,le){return _e.generateMipmaps&&le&&_e.minFilter!==mt&&_e.minFilter!==Et}function Ce(_e){_.generateMipmap(_e)}function $(_e,le,Ze,Ot,jt=!1){if(E===!1)return le;if(_e!==null){if(_[_e]!==void 0)return _[_e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+_e+"'")}let an=le;return le===_.RED&&(Ze===_.FLOAT&&(an=_.R32F),Ze===_.HALF_FLOAT&&(an=_.R16F),Ze===_.UNSIGNED_BYTE&&(an=_.R8)),le===_.RG&&(Ze===_.FLOAT&&(an=_.RG32F),Ze===_.HALF_FLOAT&&(an=_.RG16F),Ze===_.UNSIGNED_BYTE&&(an=_.RG8)),le===_.RGBA&&(Ze===_.FLOAT&&(an=_.RGBA32F),Ze===_.HALF_FLOAT&&(an=_.RGBA16F),Ze===_.UNSIGNED_BYTE&&(an=Ot===es&&jt===!1?_.SRGB8_ALPHA8:_.RGBA8),Ze===_.UNSIGNED_SHORT_4_4_4_4&&(an=_.RGBA4),Ze===_.UNSIGNED_SHORT_5_5_5_1&&(an=_.RGB5_A1)),(an===_.R16F||an===_.R32F||an===_.RG16F||an===_.RG32F||an===_.RGBA16F||an===_.RGBA32F)&&s.get("EXT_color_buffer_float"),an}function ge(_e,le,Ze){return ue(_e,Ze)===!0||_e.isFramebufferTexture&&_e.minFilter!==mt&&_e.minFilter!==Et?Math.log2(Math.max(le.width,le.height))+1:_e.mipmaps!==void 0&&_e.mipmaps.length>0?_e.mipmaps.length:_e.isCompressedTexture&&Array.isArray(_e.image)?le.mipmaps.length:1}function Te(_e){return _e===mt||_e===Ht||_e===be?_.NEAREST:_.LINEAR}function et(_e){const le=_e.target;le.removeEventListener("dispose",et),Ye(le),le.isVideoTexture&&V.delete(le)}function It(_e){const le=_e.target;le.removeEventListener("dispose",It),rt(le)}function Ye(_e){const le=d.get(_e);if(le.__webglInit===void 0)return;const Ze=_e.source,Ot=G.get(Ze);if(Ot){const jt=Ot[le.__cacheKey];jt.usedTimes--,jt.usedTimes===0&&Fe(_e),Object.keys(Ot).length===0&&G.delete(Ze)}d.remove(_e)}function Fe(_e){const le=d.get(_e);_.deleteTexture(le.__webglTexture);const Ze=_e.source,Ot=G.get(Ze);delete Ot[le.__cacheKey],w.memory.textures--}function rt(_e){const le=_e.texture,Ze=d.get(_e),Ot=d.get(le);if(Ot.__webglTexture!==void 0&&(_.deleteTexture(Ot.__webglTexture),w.memory.textures--),_e.depthTexture&&_e.depthTexture.dispose(),_e.isWebGLCubeRenderTarget)for(let jt=0;jt<6;jt++)_.deleteFramebuffer(Ze.__webglFramebuffer[jt]),Ze.__webglDepthbuffer&&_.deleteRenderbuffer(Ze.__webglDepthbuffer[jt]);else{if(_.deleteFramebuffer(Ze.__webglFramebuffer),Ze.__webglDepthbuffer&&_.deleteRenderbuffer(Ze.__webglDepthbuffer),Ze.__webglMultisampledFramebuffer&&_.deleteFramebuffer(Ze.__webglMultisampledFramebuffer),Ze.__webglColorRenderbuffer)for(let jt=0;jt<Ze.__webglColorRenderbuffer.length;jt++)Ze.__webglColorRenderbuffer[jt]&&_.deleteRenderbuffer(Ze.__webglColorRenderbuffer[jt]);Ze.__webglDepthRenderbuffer&&_.deleteRenderbuffer(Ze.__webglDepthRenderbuffer)}if(_e.isWebGLMultipleRenderTargets)for(let jt=0,an=le.length;jt<an;jt++){const zn=d.get(le[jt]);zn.__webglTexture&&(_.deleteTexture(zn.__webglTexture),w.memory.textures--),d.remove(le[jt])}d.remove(le),d.remove(_e)}let At=0;function St(){At=0}function at(){const _e=At;return _e>=P&&console.warn("THREE.WebGLTextures: Trying to use "+_e+" texture units while this GPU supports only "+P),At+=1,_e}function Qe(_e){const le=[];return le.push(_e.wrapS),le.push(_e.wrapT),le.push(_e.magFilter),le.push(_e.minFilter),le.push(_e.anisotropy),le.push(_e.internalFormat),le.push(_e.format),le.push(_e.type),le.push(_e.generateMipmaps),le.push(_e.premultiplyAlpha),le.push(_e.flipY),le.push(_e.unpackAlignment),le.push(_e.encoding),le.join()}function Je(_e,le){const Ze=d.get(_e);if(_e.isVideoTexture&&Qi(_e),_e.isRenderTargetTexture===!1&&_e.version>0&&Ze.__version!==_e.version){const Ot=_e.image;if(Ot===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ot.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{On(Ze,_e,le);return}}c.bindTexture(_.TEXTURE_2D,Ze.__webglTexture,_.TEXTURE0+le)}function Rt(_e,le){const Ze=d.get(_e);if(_e.version>0&&Ze.__version!==_e.version){On(Ze,_e,le);return}c.bindTexture(_.TEXTURE_2D_ARRAY,Ze.__webglTexture,_.TEXTURE0+le)}function Pt(_e,le){const Ze=d.get(_e);if(_e.version>0&&Ze.__version!==_e.version){On(Ze,_e,le);return}c.bindTexture(_.TEXTURE_3D,Ze.__webglTexture,_.TEXTURE0+le)}function Lt(_e,le){const Ze=d.get(_e);if(_e.version>0&&Ze.__version!==_e.version){Vn(Ze,_e,le);return}c.bindTexture(_.TEXTURE_CUBE_MAP,Ze.__webglTexture,_.TEXTURE0+le)}const yn={[ce]:_.REPEAT,[je]:_.CLAMP_TO_EDGE,[yt]:_.MIRRORED_REPEAT},Hn={[mt]:_.NEAREST,[Ht]:_.NEAREST_MIPMAP_NEAREST,[be]:_.NEAREST_MIPMAP_LINEAR,[Et]:_.LINEAR,[hn]:_.LINEAR_MIPMAP_NEAREST,[Wt]:_.LINEAR_MIPMAP_LINEAR};function Ue(_e,le,Ze){if(Ze?(_.texParameteri(_e,_.TEXTURE_WRAP_S,yn[le.wrapS]),_.texParameteri(_e,_.TEXTURE_WRAP_T,yn[le.wrapT]),(_e===_.TEXTURE_3D||_e===_.TEXTURE_2D_ARRAY)&&_.texParameteri(_e,_.TEXTURE_WRAP_R,yn[le.wrapR]),_.texParameteri(_e,_.TEXTURE_MAG_FILTER,Hn[le.magFilter]),_.texParameteri(_e,_.TEXTURE_MIN_FILTER,Hn[le.minFilter])):(_.texParameteri(_e,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_e,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),(_e===_.TEXTURE_3D||_e===_.TEXTURE_2D_ARRAY)&&_.texParameteri(_e,_.TEXTURE_WRAP_R,_.CLAMP_TO_EDGE),(le.wrapS!==je||le.wrapT!==je)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),_.texParameteri(_e,_.TEXTURE_MAG_FILTER,Te(le.magFilter)),_.texParameteri(_e,_.TEXTURE_MIN_FILTER,Te(le.minFilter)),le.minFilter!==mt&&le.minFilter!==Et&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.has("EXT_texture_filter_anisotropic")===!0){const Ot=s.get("EXT_texture_filter_anisotropic");if(le.type===wn&&s.has("OES_texture_float_linear")===!1||E===!1&&le.type===fi&&s.has("OES_texture_half_float_linear")===!1)return;(le.anisotropy>1||d.get(le).__currentAnisotropy)&&(_.texParameterf(_e,Ot.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(le.anisotropy,p.getMaxAnisotropy())),d.get(le).__currentAnisotropy=le.anisotropy)}}function ai(_e,le){let Ze=!1;_e.__webglInit===void 0&&(_e.__webglInit=!0,le.addEventListener("dispose",et));const Ot=le.source;let jt=G.get(Ot);jt===void 0&&(jt={},G.set(Ot,jt));const an=Qe(le);if(an!==_e.__cacheKey){jt[an]===void 0&&(jt[an]={texture:_.createTexture(),usedTimes:0},w.memory.textures++,Ze=!0),jt[an].usedTimes++;const zn=jt[_e.__cacheKey];zn!==void 0&&(jt[_e.__cacheKey].usedTimes--,zn.usedTimes===0&&Fe(le)),_e.__cacheKey=an,_e.__webglTexture=jt[an].texture}return Ze}function On(_e,le,Ze){let Ot=_.TEXTURE_2D;le.isDataArrayTexture&&(Ot=_.TEXTURE_2D_ARRAY),le.isData3DTexture&&(Ot=_.TEXTURE_3D);const jt=ai(_e,le),an=le.source;c.bindTexture(Ot,_e.__webglTexture,_.TEXTURE0+Ze);const zn=d.get(an);if(an.version!==zn.__version||jt===!0){c.activeTexture(_.TEXTURE0+Ze),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,le.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,le.unpackAlignment),_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.NONE);const cn=oe(le)&&te(le.image)===!1;let ft=ne(le.image,cn,!1,O);ft=ki(le,ft);const Tn=te(ft)||E,Wn=y.convert(le.format,le.encoding);let En=y.convert(le.type),Nn=$(le.internalFormat,Wn,En,le.encoding,le.isVideoTexture);Ue(Ot,le,Tn);let ri;const Li=le.mipmaps,Pe=E&&le.isVideoTexture!==!0,_n=zn.__version===void 0||jt===!0,qt=ge(le,ft,Tn);if(le.isDepthTexture)Nn=_.DEPTH_COMPONENT,E?le.type===wn?Nn=_.DEPTH_COMPONENT32F:le.type===Mt?Nn=_.DEPTH_COMPONENT24:le.type===xi?Nn=_.DEPTH24_STENCIL8:Nn=_.DEPTH_COMPONENT16:le.type===wn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),le.format===yo&&Nn===_.DEPTH_COMPONENT&&le.type!==Ut&&le.type!==Mt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),le.type=Mt,En=y.convert(le.type)),le.format===Fr&&Nn===_.DEPTH_COMPONENT&&(Nn=_.DEPTH_STENCIL,le.type!==xi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),le.type=xi,En=y.convert(le.type))),_n&&(Pe?c.texStorage2D(_.TEXTURE_2D,1,Nn,ft.width,ft.height):c.texImage2D(_.TEXTURE_2D,0,Nn,ft.width,ft.height,0,Wn,En,null));else if(le.isDataTexture)if(Li.length>0&&Tn){Pe&&_n&&c.texStorage2D(_.TEXTURE_2D,qt,Nn,Li[0].width,Li[0].height);for(let ht=0,Yt=Li.length;ht<Yt;ht++)ri=Li[ht],Pe?c.texSubImage2D(_.TEXTURE_2D,ht,0,0,ri.width,ri.height,Wn,En,ri.data):c.texImage2D(_.TEXTURE_2D,ht,Nn,ri.width,ri.height,0,Wn,En,ri.data);le.generateMipmaps=!1}else Pe?(_n&&c.texStorage2D(_.TEXTURE_2D,qt,Nn,ft.width,ft.height),c.texSubImage2D(_.TEXTURE_2D,0,0,0,ft.width,ft.height,Wn,En,ft.data)):c.texImage2D(_.TEXTURE_2D,0,Nn,ft.width,ft.height,0,Wn,En,ft.data);else if(le.isCompressedTexture){Pe&&_n&&c.texStorage2D(_.TEXTURE_2D,qt,Nn,Li[0].width,Li[0].height);for(let ht=0,Yt=Li.length;ht<Yt;ht++)ri=Li[ht],le.format!==or?Wn!==null?Pe?c.compressedTexSubImage2D(_.TEXTURE_2D,ht,0,0,ri.width,ri.height,Wn,ri.data):c.compressedTexImage2D(_.TEXTURE_2D,ht,Nn,ri.width,ri.height,0,ri.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pe?c.texSubImage2D(_.TEXTURE_2D,ht,0,0,ri.width,ri.height,Wn,En,ri.data):c.texImage2D(_.TEXTURE_2D,ht,Nn,ri.width,ri.height,0,Wn,En,ri.data)}else if(le.isDataArrayTexture)Pe?(_n&&c.texStorage3D(_.TEXTURE_2D_ARRAY,qt,Nn,ft.width,ft.height,ft.depth),c.texSubImage3D(_.TEXTURE_2D_ARRAY,0,0,0,0,ft.width,ft.height,ft.depth,Wn,En,ft.data)):c.texImage3D(_.TEXTURE_2D_ARRAY,0,Nn,ft.width,ft.height,ft.depth,0,Wn,En,ft.data);else if(le.isData3DTexture)Pe?(_n&&c.texStorage3D(_.TEXTURE_3D,qt,Nn,ft.width,ft.height,ft.depth),c.texSubImage3D(_.TEXTURE_3D,0,0,0,0,ft.width,ft.height,ft.depth,Wn,En,ft.data)):c.texImage3D(_.TEXTURE_3D,0,Nn,ft.width,ft.height,ft.depth,0,Wn,En,ft.data);else if(le.isFramebufferTexture){if(_n)if(Pe)c.texStorage2D(_.TEXTURE_2D,qt,Nn,ft.width,ft.height);else{let ht=ft.width,Yt=ft.height;for(let Un=0;Un<qt;Un++)c.texImage2D(_.TEXTURE_2D,Un,Nn,ht,Yt,0,Wn,En,null),ht>>=1,Yt>>=1}}else if(Li.length>0&&Tn){Pe&&_n&&c.texStorage2D(_.TEXTURE_2D,qt,Nn,Li[0].width,Li[0].height);for(let ht=0,Yt=Li.length;ht<Yt;ht++)ri=Li[ht],Pe?c.texSubImage2D(_.TEXTURE_2D,ht,0,0,Wn,En,ri):c.texImage2D(_.TEXTURE_2D,ht,Nn,Wn,En,ri);le.generateMipmaps=!1}else Pe?(_n&&c.texStorage2D(_.TEXTURE_2D,qt,Nn,ft.width,ft.height),c.texSubImage2D(_.TEXTURE_2D,0,0,0,Wn,En,ft)):c.texImage2D(_.TEXTURE_2D,0,Nn,Wn,En,ft);ue(le,Tn)&&Ce(Ot),zn.__version=an.version,le.onUpdate&&le.onUpdate(le)}_e.__version=le.version}function Vn(_e,le,Ze){if(le.image.length!==6)return;const Ot=ai(_e,le),jt=le.source;c.bindTexture(_.TEXTURE_CUBE_MAP,_e.__webglTexture,_.TEXTURE0+Ze);const an=d.get(jt);if(jt.version!==an.__version||Ot===!0){c.activeTexture(_.TEXTURE0+Ze),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,le.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,le.unpackAlignment),_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.NONE);const zn=le.isCompressedTexture||le.image[0].isCompressedTexture,cn=le.image[0]&&le.image[0].isDataTexture,ft=[];for(let ht=0;ht<6;ht++)!zn&&!cn?ft[ht]=ne(le.image[ht],!1,!0,L):ft[ht]=cn?le.image[ht].image:le.image[ht],ft[ht]=ki(le,ft[ht]);const Tn=ft[0],Wn=te(Tn)||E,En=y.convert(le.format,le.encoding),Nn=y.convert(le.type),ri=$(le.internalFormat,En,Nn,le.encoding),Li=E&&le.isVideoTexture!==!0,Pe=an.__version===void 0||Ot===!0;let _n=ge(le,Tn,Wn);Ue(_.TEXTURE_CUBE_MAP,le,Wn);let qt;if(zn){Li&&Pe&&c.texStorage2D(_.TEXTURE_CUBE_MAP,_n,ri,Tn.width,Tn.height);for(let ht=0;ht<6;ht++){qt=ft[ht].mipmaps;for(let Yt=0;Yt<qt.length;Yt++){const Un=qt[Yt];le.format!==or?En!==null?Li?c.compressedTexSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,0,0,Un.width,Un.height,En,Un.data):c.compressedTexImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,ri,Un.width,Un.height,0,Un.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Li?c.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,0,0,Un.width,Un.height,En,Nn,Un.data):c.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,ri,Un.width,Un.height,0,En,Nn,Un.data)}}}else{qt=le.mipmaps,Li&&Pe&&(qt.length>0&&_n++,c.texStorage2D(_.TEXTURE_CUBE_MAP,_n,ri,ft[0].width,ft[0].height));for(let ht=0;ht<6;ht++)if(cn){Li?c.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,ft[ht].width,ft[ht].height,En,Nn,ft[ht].data):c.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,ri,ft[ht].width,ft[ht].height,0,En,Nn,ft[ht].data);for(let Yt=0;Yt<qt.length;Yt++){const ji=qt[Yt].image[ht].image;Li?c.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,0,0,ji.width,ji.height,En,Nn,ji.data):c.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,ri,ji.width,ji.height,0,En,Nn,ji.data)}}else{Li?c.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,En,Nn,ft[ht]):c.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,ri,En,Nn,ft[ht]);for(let Yt=0;Yt<qt.length;Yt++){const Un=qt[Yt];Li?c.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,0,0,En,Nn,Un.image[ht]):c.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,ri,En,Nn,Un.image[ht])}}}ue(le,Wn)&&Ce(_.TEXTURE_CUBE_MAP),an.__version=jt.version,le.onUpdate&&le.onUpdate(le)}_e.__version=le.version}function on(_e,le,Ze,Ot,jt){const an=y.convert(Ze.format,Ze.encoding),zn=y.convert(Ze.type),cn=$(Ze.internalFormat,an,zn,Ze.encoding);d.get(le).__hasExternalTextures||(jt===_.TEXTURE_3D||jt===_.TEXTURE_2D_ARRAY?c.texImage3D(jt,0,cn,le.width,le.height,le.depth,0,an,zn,null):c.texImage2D(jt,0,cn,le.width,le.height,0,an,zn,null)),c.bindFramebuffer(_.FRAMEBUFFER,_e),Pn(le)?N.framebufferTexture2DMultisampleEXT(_.FRAMEBUFFER,Ot,jt,d.get(Ze).__webglTexture,0,kn(le)):_.framebufferTexture2D(_.FRAMEBUFFER,Ot,jt,d.get(Ze).__webglTexture,0),c.bindFramebuffer(_.FRAMEBUFFER,null)}function li(_e,le,Ze){if(_.bindRenderbuffer(_.RENDERBUFFER,_e),le.depthBuffer&&!le.stencilBuffer){let Ot=_.DEPTH_COMPONENT16;if(Ze||Pn(le)){const jt=le.depthTexture;jt&&jt.isDepthTexture&&(jt.type===wn?Ot=_.DEPTH_COMPONENT32F:jt.type===Mt&&(Ot=_.DEPTH_COMPONENT24));const an=kn(le);Pn(le)?N.renderbufferStorageMultisampleEXT(_.RENDERBUFFER,an,Ot,le.width,le.height):_.renderbufferStorageMultisample(_.RENDERBUFFER,an,Ot,le.width,le.height)}else _.renderbufferStorage(_.RENDERBUFFER,Ot,le.width,le.height);_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,_e)}else if(le.depthBuffer&&le.stencilBuffer){const Ot=kn(le);Ze&&Pn(le)===!1?_.renderbufferStorageMultisample(_.RENDERBUFFER,Ot,_.DEPTH24_STENCIL8,le.width,le.height):Pn(le)?N.renderbufferStorageMultisampleEXT(_.RENDERBUFFER,Ot,_.DEPTH24_STENCIL8,le.width,le.height):_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_STENCIL,le.width,le.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,_e)}else{const Ot=le.isWebGLMultipleRenderTargets===!0?le.texture:[le.texture];for(let jt=0;jt<Ot.length;jt++){const an=Ot[jt],zn=y.convert(an.format,an.encoding),cn=y.convert(an.type),ft=$(an.internalFormat,zn,cn,an.encoding),Tn=kn(le);Ze&&Pn(le)===!1?_.renderbufferStorageMultisample(_.RENDERBUFFER,Tn,ft,le.width,le.height):Pn(le)?N.renderbufferStorageMultisampleEXT(_.RENDERBUFFER,Tn,ft,le.width,le.height):_.renderbufferStorage(_.RENDERBUFFER,ft,le.width,le.height)}}_.bindRenderbuffer(_.RENDERBUFFER,null)}function dt(_e,le){if(le&&le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(c.bindFramebuffer(_.FRAMEBUFFER,_e),!(le.depthTexture&&le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!d.get(le.depthTexture).__webglTexture||le.depthTexture.image.width!==le.width||le.depthTexture.image.height!==le.height)&&(le.depthTexture.image.width=le.width,le.depthTexture.image.height=le.height,le.depthTexture.needsUpdate=!0),Je(le.depthTexture,0);const Ot=d.get(le.depthTexture).__webglTexture,jt=kn(le);if(le.depthTexture.format===yo)Pn(le)?N.framebufferTexture2DMultisampleEXT(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.TEXTURE_2D,Ot,0,jt):_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.TEXTURE_2D,Ot,0);else if(le.depthTexture.format===Fr)Pn(le)?N.framebufferTexture2DMultisampleEXT(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.TEXTURE_2D,Ot,0,jt):_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.TEXTURE_2D,Ot,0);else throw new Error("Unknown depthTexture format")}function ct(_e){const le=d.get(_e),Ze=_e.isWebGLCubeRenderTarget===!0;if(_e.depthTexture&&!le.__autoAllocateDepthBuffer){if(Ze)throw new Error("target.depthTexture not supported in Cube render targets");dt(le.__webglFramebuffer,_e)}else if(Ze){le.__webglDepthbuffer=[];for(let Ot=0;Ot<6;Ot++)c.bindFramebuffer(_.FRAMEBUFFER,le.__webglFramebuffer[Ot]),le.__webglDepthbuffer[Ot]=_.createRenderbuffer(),li(le.__webglDepthbuffer[Ot],_e,!1)}else c.bindFramebuffer(_.FRAMEBUFFER,le.__webglFramebuffer),le.__webglDepthbuffer=_.createRenderbuffer(),li(le.__webglDepthbuffer,_e,!1);c.bindFramebuffer(_.FRAMEBUFFER,null)}function Gt(_e,le,Ze){const Ot=d.get(_e);le!==void 0&&on(Ot.__webglFramebuffer,_e,_e.texture,_.COLOR_ATTACHMENT0,_.TEXTURE_2D),Ze!==void 0&&ct(_e)}function bn(_e){const le=_e.texture,Ze=d.get(_e),Ot=d.get(le);_e.addEventListener("dispose",It),_e.isWebGLMultipleRenderTargets!==!0&&(Ot.__webglTexture===void 0&&(Ot.__webglTexture=_.createTexture()),Ot.__version=le.version,w.memory.textures++);const jt=_e.isWebGLCubeRenderTarget===!0,an=_e.isWebGLMultipleRenderTargets===!0,zn=te(_e)||E;if(jt){Ze.__webglFramebuffer=[];for(let cn=0;cn<6;cn++)Ze.__webglFramebuffer[cn]=_.createFramebuffer()}else{if(Ze.__webglFramebuffer=_.createFramebuffer(),an)if(p.drawBuffers){const cn=_e.texture;for(let ft=0,Tn=cn.length;ft<Tn;ft++){const Wn=d.get(cn[ft]);Wn.__webglTexture===void 0&&(Wn.__webglTexture=_.createTexture(),w.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(E&&_e.samples>0&&Pn(_e)===!1){const cn=an?le:[le];Ze.__webglMultisampledFramebuffer=_.createFramebuffer(),Ze.__webglColorRenderbuffer=[],c.bindFramebuffer(_.FRAMEBUFFER,Ze.__webglMultisampledFramebuffer);for(let ft=0;ft<cn.length;ft++){const Tn=cn[ft];Ze.__webglColorRenderbuffer[ft]=_.createRenderbuffer(),_.bindRenderbuffer(_.RENDERBUFFER,Ze.__webglColorRenderbuffer[ft]);const Wn=y.convert(Tn.format,Tn.encoding),En=y.convert(Tn.type),Nn=$(Tn.internalFormat,Wn,En,Tn.encoding,_e.isXRRenderTarget===!0),ri=kn(_e);_.renderbufferStorageMultisample(_.RENDERBUFFER,ri,Nn,_e.width,_e.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0+ft,_.RENDERBUFFER,Ze.__webglColorRenderbuffer[ft])}_.bindRenderbuffer(_.RENDERBUFFER,null),_e.depthBuffer&&(Ze.__webglDepthRenderbuffer=_.createRenderbuffer(),li(Ze.__webglDepthRenderbuffer,_e,!0)),c.bindFramebuffer(_.FRAMEBUFFER,null)}}if(jt){c.bindTexture(_.TEXTURE_CUBE_MAP,Ot.__webglTexture),Ue(_.TEXTURE_CUBE_MAP,le,zn);for(let cn=0;cn<6;cn++)on(Ze.__webglFramebuffer[cn],_e,le,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+cn);ue(le,zn)&&Ce(_.TEXTURE_CUBE_MAP),c.unbindTexture()}else if(an){const cn=_e.texture;for(let ft=0,Tn=cn.length;ft<Tn;ft++){const Wn=cn[ft],En=d.get(Wn);c.bindTexture(_.TEXTURE_2D,En.__webglTexture),Ue(_.TEXTURE_2D,Wn,zn),on(Ze.__webglFramebuffer,_e,Wn,_.COLOR_ATTACHMENT0+ft,_.TEXTURE_2D),ue(Wn,zn)&&Ce(_.TEXTURE_2D)}c.unbindTexture()}else{let cn=_.TEXTURE_2D;(_e.isWebGL3DRenderTarget||_e.isWebGLArrayRenderTarget)&&(E?cn=_e.isWebGL3DRenderTarget?_.TEXTURE_3D:_.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),c.bindTexture(cn,Ot.__webglTexture),Ue(cn,le,zn),on(Ze.__webglFramebuffer,_e,le,_.COLOR_ATTACHMENT0,cn),ue(le,zn)&&Ce(cn),c.unbindTexture()}_e.depthBuffer&&ct(_e)}function sn(_e){const le=te(_e)||E,Ze=_e.isWebGLMultipleRenderTargets===!0?_e.texture:[_e.texture];for(let Ot=0,jt=Ze.length;Ot<jt;Ot++){const an=Ze[Ot];if(ue(an,le)){const zn=_e.isWebGLCubeRenderTarget?_.TEXTURE_CUBE_MAP:_.TEXTURE_2D,cn=d.get(an).__webglTexture;c.bindTexture(zn,cn),Ce(zn),c.unbindTexture()}}}function ei(_e){if(E&&_e.samples>0&&Pn(_e)===!1){const le=_e.isWebGLMultipleRenderTargets?_e.texture:[_e.texture],Ze=_e.width,Ot=_e.height;let jt=_.COLOR_BUFFER_BIT;const an=[],zn=_e.stencilBuffer?_.DEPTH_STENCIL_ATTACHMENT:_.DEPTH_ATTACHMENT,cn=d.get(_e),ft=_e.isWebGLMultipleRenderTargets===!0;if(ft)for(let Tn=0;Tn<le.length;Tn++)c.bindFramebuffer(_.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0+Tn,_.RENDERBUFFER,null),c.bindFramebuffer(_.FRAMEBUFFER,cn.__webglFramebuffer),_.framebufferTexture2D(_.DRAW_FRAMEBUFFER,_.COLOR_ATTACHMENT0+Tn,_.TEXTURE_2D,null,0);c.bindFramebuffer(_.READ_FRAMEBUFFER,cn.__webglMultisampledFramebuffer),c.bindFramebuffer(_.DRAW_FRAMEBUFFER,cn.__webglFramebuffer);for(let Tn=0;Tn<le.length;Tn++){an.push(_.COLOR_ATTACHMENT0+Tn),_e.depthBuffer&&an.push(zn);const Wn=cn.__ignoreDepthValues!==void 0?cn.__ignoreDepthValues:!1;if(Wn===!1&&(_e.depthBuffer&&(jt|=_.DEPTH_BUFFER_BIT),_e.stencilBuffer&&(jt|=_.STENCIL_BUFFER_BIT)),ft&&_.framebufferRenderbuffer(_.READ_FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.RENDERBUFFER,cn.__webglColorRenderbuffer[Tn]),Wn===!0&&(_.invalidateFramebuffer(_.READ_FRAMEBUFFER,[zn]),_.invalidateFramebuffer(_.DRAW_FRAMEBUFFER,[zn])),ft){const En=d.get(le[Tn]).__webglTexture;_.framebufferTexture2D(_.DRAW_FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,En,0)}_.blitFramebuffer(0,0,Ze,Ot,0,0,Ze,Ot,jt,_.NEAREST),z&&_.invalidateFramebuffer(_.READ_FRAMEBUFFER,an)}if(c.bindFramebuffer(_.READ_FRAMEBUFFER,null),c.bindFramebuffer(_.DRAW_FRAMEBUFFER,null),ft)for(let Tn=0;Tn<le.length;Tn++){c.bindFramebuffer(_.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0+Tn,_.RENDERBUFFER,cn.__webglColorRenderbuffer[Tn]);const Wn=d.get(le[Tn]).__webglTexture;c.bindFramebuffer(_.FRAMEBUFFER,cn.__webglFramebuffer),_.framebufferTexture2D(_.DRAW_FRAMEBUFFER,_.COLOR_ATTACHMENT0+Tn,_.TEXTURE_2D,Wn,0)}c.bindFramebuffer(_.DRAW_FRAMEBUFFER,cn.__webglMultisampledFramebuffer)}}function kn(_e){return Math.min(k,_e.samples)}function Pn(_e){const le=d.get(_e);return E&&_e.samples>0&&s.has("WEBGL_multisampled_render_to_texture")===!0&&le.__useRenderToTexture!==!1}function Qi(_e){const le=w.render.frame;V.get(_e)!==le&&(V.set(_e,le),_e.update())}function ki(_e,le){const Ze=_e.encoding,Ot=_e.format,jt=_e.type;return _e.isCompressedTexture===!0||_e.isVideoTexture===!0||_e.format===IA||Ze!==$c&&(Ze===es?E===!1?s.has("EXT_sRGB")===!0&&Ot===or?(_e.format=IA,_e.minFilter=Et,_e.generateMipmaps=!1):le=zx.sRGBToLinear(le):(Ot!==or||jt!==Dn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Ze)),le}this.allocateTextureUnit=at,this.resetTextureUnits=St,this.setTexture2D=Je,this.setTexture2DArray=Rt,this.setTexture3D=Pt,this.setTextureCube=Lt,this.rebindTextures=Gt,this.setupRenderTarget=bn,this.updateRenderTargetMipmap=sn,this.updateMultisampleRenderTarget=ei,this.setupDepthRenderbuffer=ct,this.setupFrameBufferTexture=on,this.useMultisampledRTT=Pn}function RT(_,s,c){const d=c.isWebGL2;function p(y,w=null){let E;if(y===Dn)return _.UNSIGNED_BYTE;if(y===Vi)return _.UNSIGNED_SHORT_4_4_4_4;if(y===Kr)return _.UNSIGNED_SHORT_5_5_5_1;if(y===Me)return _.BYTE;if(y===Bt)return _.SHORT;if(y===Ut)return _.UNSIGNED_SHORT;if(y===Re)return _.INT;if(y===Mt)return _.UNSIGNED_INT;if(y===wn)return _.FLOAT;if(y===fi)return d?_.HALF_FLOAT:(E=s.get("OES_texture_half_float"),E!==null?E.HALF_FLOAT_OES:null);if(y===Or)return _.ALPHA;if(y===or)return _.RGBA;if(y===ac)return _.LUMINANCE;if(y===wh)return _.LUMINANCE_ALPHA;if(y===yo)return _.DEPTH_COMPONENT;if(y===Fr)return _.DEPTH_STENCIL;if(y===ed)return _.RED;if(y===Ys)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),_.RGBA;if(y===IA)return E=s.get("EXT_sRGB"),E!==null?E.SRGB_ALPHA_EXT:null;if(y===he)return _.RED_INTEGER;if(y===Ge)return _.RG;if(y===ze)return _.RG_INTEGER;if(y===Ne)return _.RGBA_INTEGER;if(y===nt||y===j||y===ie||y===pe)if(w===es)if(E=s.get("WEBGL_compressed_texture_s3tc_srgb"),E!==null){if(y===nt)return E.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(y===j)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(y===ie)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(y===pe)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(E=s.get("WEBGL_compressed_texture_s3tc"),E!==null){if(y===nt)return E.COMPRESSED_RGB_S3TC_DXT1_EXT;if(y===j)return E.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(y===ie)return E.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(y===pe)return E.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(y===Se||y===We||y===Oe||y===Ke)if(E=s.get("WEBGL_compressed_texture_pvrtc"),E!==null){if(y===Se)return E.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(y===We)return E.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(y===Oe)return E.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(y===Ke)return E.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(y===lt)return E=s.get("WEBGL_compressed_texture_etc1"),E!==null?E.COMPRESSED_RGB_ETC1_WEBGL:null;if(y===Tt||y===ut)if(E=s.get("WEBGL_compressed_texture_etc"),E!==null){if(y===Tt)return w===es?E.COMPRESSED_SRGB8_ETC2:E.COMPRESSED_RGB8_ETC2;if(y===ut)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:E.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(y===wt||y===Zt||y===bt||y===xn||y===pn||y===$t||y===un||y===Fn||y===Si||y===Zn||y===Wi||y===pi||y===In||y===Di)if(E=s.get("WEBGL_compressed_texture_astc"),E!==null){if(y===wt)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:E.COMPRESSED_RGBA_ASTC_4x4_KHR;if(y===Zt)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:E.COMPRESSED_RGBA_ASTC_5x4_KHR;if(y===bt)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:E.COMPRESSED_RGBA_ASTC_5x5_KHR;if(y===xn)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:E.COMPRESSED_RGBA_ASTC_6x5_KHR;if(y===pn)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:E.COMPRESSED_RGBA_ASTC_6x6_KHR;if(y===$t)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:E.COMPRESSED_RGBA_ASTC_8x5_KHR;if(y===un)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:E.COMPRESSED_RGBA_ASTC_8x6_KHR;if(y===Fn)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:E.COMPRESSED_RGBA_ASTC_8x8_KHR;if(y===Si)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:E.COMPRESSED_RGBA_ASTC_10x5_KHR;if(y===Zn)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:E.COMPRESSED_RGBA_ASTC_10x6_KHR;if(y===Wi)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:E.COMPRESSED_RGBA_ASTC_10x8_KHR;if(y===pi)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:E.COMPRESSED_RGBA_ASTC_10x10_KHR;if(y===In)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:E.COMPRESSED_RGBA_ASTC_12x10_KHR;if(y===Di)return w===es?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:E.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(y===zs)if(E=s.get("EXT_texture_compression_bptc"),E!==null){if(y===zs)return w===es?E.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:E.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return y===xi?d?_.UNSIGNED_INT_24_8:(E=s.get("WEBGL_depth_texture"),E!==null?E.UNSIGNED_INT_24_8_WEBGL:null):_[y]!==void 0?_[y]:null}return{convert:p}}class PT extends Ks{constructor(s=[]){super(),this.isArrayCamera=!0,this.cameras=s}}class xd extends bi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const W4={type:"move"};class gw{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new xd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new xd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new de,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new de),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new xd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new de,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new de),this._grip}dispatchEvent(s){return this._targetRay!==null&&this._targetRay.dispatchEvent(s),this._grip!==null&&this._grip.dispatchEvent(s),this._hand!==null&&this._hand.dispatchEvent(s),this}disconnect(s){return this.dispatchEvent({type:"disconnected",data:s}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(s,c,d){let p=null,y=null,w=null;const E=this._targetRay,P=this._grip,L=this._hand;if(s&&c.session.visibilityState!=="visible-blurred"){if(L&&s.hand){w=!0;for(const H of s.hand.values()){const G=c.getJointPose(H,d);if(L.joints[H.jointName]===void 0){const K=new xd;K.matrixAutoUpdate=!1,K.visible=!1,L.joints[H.jointName]=K,L.add(K)}const X=L.joints[H.jointName];G!==null&&(X.matrix.fromArray(G.transform.matrix),X.matrix.decompose(X.position,X.rotation,X.scale),X.jointRadius=G.radius),X.visible=G!==null}const O=L.joints["index-finger-tip"],k=L.joints["thumb-tip"],N=O.position.distanceTo(k.position),z=.02,V=.005;L.inputState.pinching&&N>z+V?(L.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:s.handedness,target:this})):!L.inputState.pinching&&N<=z-V&&(L.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:s.handedness,target:this}))}else P!==null&&s.gripSpace&&(y=c.getPose(s.gripSpace,d),y!==null&&(P.matrix.fromArray(y.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),y.linearVelocity?(P.hasLinearVelocity=!0,P.linearVelocity.copy(y.linearVelocity)):P.hasLinearVelocity=!1,y.angularVelocity?(P.hasAngularVelocity=!0,P.angularVelocity.copy(y.angularVelocity)):P.hasAngularVelocity=!1));E!==null&&(p=c.getPose(s.targetRaySpace,d),p===null&&y!==null&&(p=y),p!==null&&(E.matrix.fromArray(p.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),p.linearVelocity?(E.hasLinearVelocity=!0,E.linearVelocity.copy(p.linearVelocity)):E.hasLinearVelocity=!1,p.angularVelocity?(E.hasAngularVelocity=!0,E.angularVelocity.copy(p.angularVelocity)):E.hasAngularVelocity=!1,this.dispatchEvent(W4)))}return E!==null&&(E.visible=p!==null),P!==null&&(P.visible=y!==null),L!==null&&(L.visible=w!==null),this}}class BT extends Rs{constructor(s,c,d,p,y,w,E,P,L,O){if(O=O!==void 0?O:yo,O!==yo&&O!==Fr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");d===void 0&&O===yo&&(d=Mt),d===void 0&&O===Fr&&(d=xi),super(null,p,y,w,E,P,O,d,L),this.isDepthTexture=!0,this.image={width:s,height:c},this.magFilter=E!==void 0?E:mt,this.minFilter=P!==void 0?P:mt,this.flipY=!1,this.generateMipmaps=!1}}class Q4 extends cc{constructor(s,c){super();const d=this;let p=null,y=1,w=null,E="local-floor",P=null,L=null,O=null,k=null,N=null,z=null;const V=c.getContextAttributes();let H=null,G=null;const X=[],K=[],ne=new Ks;ne.layers.enable(1),ne.viewport=new Pi;const te=new Ks;te.layers.enable(2),te.viewport=new Pi;const oe=[ne,te],ue=new PT;ue.layers.enable(1),ue.layers.enable(2);let Ce=null,$=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Qe){let Je=X[Qe];return Je===void 0&&(Je=new gw,X[Qe]=Je),Je.getTargetRaySpace()},this.getControllerGrip=function(Qe){let Je=X[Qe];return Je===void 0&&(Je=new gw,X[Qe]=Je),Je.getGripSpace()},this.getHand=function(Qe){let Je=X[Qe];return Je===void 0&&(Je=new gw,X[Qe]=Je),Je.getHandSpace()};function ge(Qe){const Je=K.indexOf(Qe.inputSource);if(Je===-1)return;const Rt=X[Je];Rt!==void 0&&Rt.dispatchEvent({type:Qe.type,data:Qe.inputSource})}function Te(){p.removeEventListener("select",ge),p.removeEventListener("selectstart",ge),p.removeEventListener("selectend",ge),p.removeEventListener("squeeze",ge),p.removeEventListener("squeezestart",ge),p.removeEventListener("squeezeend",ge),p.removeEventListener("end",Te),p.removeEventListener("inputsourceschange",et);for(let Qe=0;Qe<X.length;Qe++){const Je=K[Qe];Je!==null&&(K[Qe]=null,X[Qe].disconnect(Je))}Ce=null,$=null,s.setRenderTarget(H),N=null,k=null,O=null,p=null,G=null,at.stop(),d.isPresenting=!1,d.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Qe){y=Qe,d.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Qe){E=Qe,d.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return P||w},this.setReferenceSpace=function(Qe){P=Qe},this.getBaseLayer=function(){return k!==null?k:N},this.getBinding=function(){return O},this.getFrame=function(){return z},this.getSession=function(){return p},this.setSession=async function(Qe){if(p=Qe,p!==null){if(H=s.getRenderTarget(),p.addEventListener("select",ge),p.addEventListener("selectstart",ge),p.addEventListener("selectend",ge),p.addEventListener("squeeze",ge),p.addEventListener("squeezestart",ge),p.addEventListener("squeezeend",ge),p.addEventListener("end",Te),p.addEventListener("inputsourceschange",et),V.xrCompatible!==!0&&await c.makeXRCompatible(),p.renderState.layers===void 0||s.capabilities.isWebGL2===!1){const Je={antialias:p.renderState.layers===void 0?V.antialias:!0,alpha:V.alpha,depth:V.depth,stencil:V.stencil,framebufferScaleFactor:y};N=new XRWebGLLayer(p,c,Je),p.updateRenderState({baseLayer:N}),G=new xo(N.framebufferWidth,N.framebufferHeight,{format:or,type:Dn,encoding:s.outputEncoding,stencilBuffer:V.stencil})}else{let Je=null,Rt=null,Pt=null;V.depth&&(Pt=V.stencil?c.DEPTH24_STENCIL8:c.DEPTH_COMPONENT24,Je=V.stencil?Fr:yo,Rt=V.stencil?xi:Mt);const Lt={colorFormat:c.RGBA8,depthFormat:Pt,scaleFactor:y};O=new XRWebGLBinding(p,c),k=O.createProjectionLayer(Lt),p.updateRenderState({layers:[k]}),G=new xo(k.textureWidth,k.textureHeight,{format:or,type:Dn,depthTexture:new BT(k.textureWidth,k.textureHeight,Rt,void 0,void 0,void 0,void 0,void 0,void 0,Je),stencilBuffer:V.stencil,encoding:s.outputEncoding,samples:V.antialias?4:0});const yn=s.properties.get(G);yn.__ignoreDepthValues=k.ignoreDepthValues}G.isXRRenderTarget=!0,this.setFoveation(1),P=null,w=await p.requestReferenceSpace(E),at.setContext(p),at.start(),d.isPresenting=!0,d.dispatchEvent({type:"sessionstart"})}};function et(Qe){for(let Je=0;Je<Qe.removed.length;Je++){const Rt=Qe.removed[Je],Pt=K.indexOf(Rt);Pt>=0&&(K[Pt]=null,X[Pt].dispatchEvent({type:"disconnected",data:Rt}))}for(let Je=0;Je<Qe.added.length;Je++){const Rt=Qe.added[Je];let Pt=K.indexOf(Rt);if(Pt===-1){for(let yn=0;yn<X.length;yn++)if(yn>=K.length){K.push(Rt),Pt=yn;break}else if(K[yn]===null){K[yn]=Rt,Pt=yn;break}if(Pt===-1)break}const Lt=X[Pt];Lt&&Lt.dispatchEvent({type:"connected",data:Rt})}}const It=new de,Ye=new de;function Fe(Qe,Je,Rt){It.setFromMatrixPosition(Je.matrixWorld),Ye.setFromMatrixPosition(Rt.matrixWorld);const Pt=It.distanceTo(Ye),Lt=Je.projectionMatrix.elements,yn=Rt.projectionMatrix.elements,Hn=Lt[14]/(Lt[10]-1),Ue=Lt[14]/(Lt[10]+1),ai=(Lt[9]+1)/Lt[5],On=(Lt[9]-1)/Lt[5],Vn=(Lt[8]-1)/Lt[0],on=(yn[8]+1)/yn[0],li=Hn*Vn,dt=Hn*on,ct=Pt/(-Vn+on),Gt=ct*-Vn;Je.matrixWorld.decompose(Qe.position,Qe.quaternion,Qe.scale),Qe.translateX(Gt),Qe.translateZ(ct),Qe.matrixWorld.compose(Qe.position,Qe.quaternion,Qe.scale),Qe.matrixWorldInverse.copy(Qe.matrixWorld).invert();const bn=Hn+ct,sn=Ue+ct,ei=li-Gt,kn=dt+(Pt-Gt),Pn=ai*Ue/sn*bn,Qi=On*Ue/sn*bn;Qe.projectionMatrix.makePerspective(ei,kn,Pn,Qi,bn,sn)}function rt(Qe,Je){Je===null?Qe.matrixWorld.copy(Qe.matrix):Qe.matrixWorld.multiplyMatrices(Je.matrixWorld,Qe.matrix),Qe.matrixWorldInverse.copy(Qe.matrixWorld).invert()}this.updateCamera=function(Qe){if(p===null)return;ue.near=te.near=ne.near=Qe.near,ue.far=te.far=ne.far=Qe.far,(Ce!==ue.near||$!==ue.far)&&(p.updateRenderState({depthNear:ue.near,depthFar:ue.far}),Ce=ue.near,$=ue.far);const Je=Qe.parent,Rt=ue.cameras;rt(ue,Je);for(let Lt=0;Lt<Rt.length;Lt++)rt(Rt[Lt],Je);ue.matrixWorld.decompose(ue.position,ue.quaternion,ue.scale),Qe.matrix.copy(ue.matrix),Qe.matrix.decompose(Qe.position,Qe.quaternion,Qe.scale);const Pt=Qe.children;for(let Lt=0,yn=Pt.length;Lt<yn;Lt++)Pt[Lt].updateMatrixWorld(!0);Rt.length===2?Fe(ue,ne,te):ue.projectionMatrix.copy(ne.projectionMatrix)},this.getCamera=function(){return ue},this.getFoveation=function(){if(k!==null)return k.fixedFoveation;if(N!==null)return N.fixedFoveation},this.setFoveation=function(Qe){k!==null&&(k.fixedFoveation=Qe),N!==null&&N.fixedFoveation!==void 0&&(N.fixedFoveation=Qe)};let At=null;function St(Qe,Je){if(L=Je.getViewerPose(P||w),z=Je,L!==null){const Rt=L.views;N!==null&&(s.setRenderTargetFramebuffer(G,N.framebuffer),s.setRenderTarget(G));let Pt=!1;Rt.length!==ue.cameras.length&&(ue.cameras.length=0,Pt=!0);for(let Lt=0;Lt<Rt.length;Lt++){const yn=Rt[Lt];let Hn=null;if(N!==null)Hn=N.getViewport(yn);else{const ai=O.getViewSubImage(k,yn);Hn=ai.viewport,Lt===0&&(s.setRenderTargetTextures(G,ai.colorTexture,k.ignoreDepthValues?void 0:ai.depthStencilTexture),s.setRenderTarget(G))}let Ue=oe[Lt];Ue===void 0&&(Ue=new Ks,Ue.layers.enable(Lt),Ue.viewport=new Pi,oe[Lt]=Ue),Ue.matrix.fromArray(yn.transform.matrix),Ue.projectionMatrix.fromArray(yn.projectionMatrix),Ue.viewport.set(Hn.x,Hn.y,Hn.width,Hn.height),Lt===0&&ue.matrix.copy(Ue.matrix),Pt===!0&&ue.cameras.push(Ue)}}for(let Rt=0;Rt<X.length;Rt++){const Pt=K[Rt],Lt=X[Rt];Pt!==null&&Lt!==void 0&&Lt.update(Pt,Je,P||w)}At&&At(Qe,Je),z=null}const at=new sT;at.setAnimationLoop(St),this.setAnimationLoop=function(Qe){At=Qe},this.dispose=function(){}}}function j4(_,s){function c(H,G){H.fogColor.value.copy(G.color),G.isFog?(H.fogNear.value=G.near,H.fogFar.value=G.far):G.isFogExp2&&(H.fogDensity.value=G.density)}function d(H,G,X,K,ne){G.isMeshBasicMaterial||G.isMeshLambertMaterial?p(H,G):G.isMeshToonMaterial?(p(H,G),O(H,G)):G.isMeshPhongMaterial?(p(H,G),L(H,G)):G.isMeshStandardMaterial?(p(H,G),k(H,G),G.isMeshPhysicalMaterial&&N(H,G,ne)):G.isMeshMatcapMaterial?(p(H,G),z(H,G)):G.isMeshDepthMaterial?p(H,G):G.isMeshDistanceMaterial?(p(H,G),V(H,G)):G.isMeshNormalMaterial?p(H,G):G.isLineBasicMaterial?(y(H,G),G.isLineDashedMaterial&&w(H,G)):G.isPointsMaterial?E(H,G,X,K):G.isSpriteMaterial?P(H,G):G.isShadowMaterial?(H.color.value.copy(G.color),H.opacity.value=G.opacity):G.isShaderMaterial&&(G.uniformsNeedUpdate=!1)}function p(H,G){H.opacity.value=G.opacity,G.color&&H.diffuse.value.copy(G.color),G.emissive&&H.emissive.value.copy(G.emissive).multiplyScalar(G.emissiveIntensity),G.map&&(H.map.value=G.map),G.alphaMap&&(H.alphaMap.value=G.alphaMap),G.bumpMap&&(H.bumpMap.value=G.bumpMap,H.bumpScale.value=G.bumpScale,G.side===m&&(H.bumpScale.value*=-1)),G.displacementMap&&(H.displacementMap.value=G.displacementMap,H.displacementScale.value=G.displacementScale,H.displacementBias.value=G.displacementBias),G.emissiveMap&&(H.emissiveMap.value=G.emissiveMap),G.normalMap&&(H.normalMap.value=G.normalMap,H.normalScale.value.copy(G.normalScale),G.side===m&&H.normalScale.value.negate()),G.specularMap&&(H.specularMap.value=G.specularMap),G.alphaTest>0&&(H.alphaTest.value=G.alphaTest);const X=s.get(G).envMap;if(X&&(H.envMap.value=X,H.flipEnvMap.value=X.isCubeTexture&&X.isRenderTargetTexture===!1?-1:1,H.reflectivity.value=G.reflectivity,H.ior.value=G.ior,H.refractionRatio.value=G.refractionRatio),G.lightMap){H.lightMap.value=G.lightMap;const te=_.physicallyCorrectLights!==!0?Math.PI:1;H.lightMapIntensity.value=G.lightMapIntensity*te}G.aoMap&&(H.aoMap.value=G.aoMap,H.aoMapIntensity.value=G.aoMapIntensity);let K;G.map?K=G.map:G.specularMap?K=G.specularMap:G.displacementMap?K=G.displacementMap:G.normalMap?K=G.normalMap:G.bumpMap?K=G.bumpMap:G.roughnessMap?K=G.roughnessMap:G.metalnessMap?K=G.metalnessMap:G.alphaMap?K=G.alphaMap:G.emissiveMap?K=G.emissiveMap:G.clearcoatMap?K=G.clearcoatMap:G.clearcoatNormalMap?K=G.clearcoatNormalMap:G.clearcoatRoughnessMap?K=G.clearcoatRoughnessMap:G.iridescenceMap?K=G.iridescenceMap:G.iridescenceThicknessMap?K=G.iridescenceThicknessMap:G.specularIntensityMap?K=G.specularIntensityMap:G.specularColorMap?K=G.specularColorMap:G.transmissionMap?K=G.transmissionMap:G.thicknessMap?K=G.thicknessMap:G.sheenColorMap?K=G.sheenColorMap:G.sheenRoughnessMap&&(K=G.sheenRoughnessMap),K!==void 0&&(K.isWebGLRenderTarget&&(K=K.texture),K.matrixAutoUpdate===!0&&K.updateMatrix(),H.uvTransform.value.copy(K.matrix));let ne;G.aoMap?ne=G.aoMap:G.lightMap&&(ne=G.lightMap),ne!==void 0&&(ne.isWebGLRenderTarget&&(ne=ne.texture),ne.matrixAutoUpdate===!0&&ne.updateMatrix(),H.uv2Transform.value.copy(ne.matrix))}function y(H,G){H.diffuse.value.copy(G.color),H.opacity.value=G.opacity}function w(H,G){H.dashSize.value=G.dashSize,H.totalSize.value=G.dashSize+G.gapSize,H.scale.value=G.scale}function E(H,G,X,K){H.diffuse.value.copy(G.color),H.opacity.value=G.opacity,H.size.value=G.size*X,H.scale.value=K*.5,G.map&&(H.map.value=G.map),G.alphaMap&&(H.alphaMap.value=G.alphaMap),G.alphaTest>0&&(H.alphaTest.value=G.alphaTest);let ne;G.map?ne=G.map:G.alphaMap&&(ne=G.alphaMap),ne!==void 0&&(ne.matrixAutoUpdate===!0&&ne.updateMatrix(),H.uvTransform.value.copy(ne.matrix))}function P(H,G){H.diffuse.value.copy(G.color),H.opacity.value=G.opacity,H.rotation.value=G.rotation,G.map&&(H.map.value=G.map),G.alphaMap&&(H.alphaMap.value=G.alphaMap),G.alphaTest>0&&(H.alphaTest.value=G.alphaTest);let X;G.map?X=G.map:G.alphaMap&&(X=G.alphaMap),X!==void 0&&(X.matrixAutoUpdate===!0&&X.updateMatrix(),H.uvTransform.value.copy(X.matrix))}function L(H,G){H.specular.value.copy(G.specular),H.shininess.value=Math.max(G.shininess,1e-4)}function O(H,G){G.gradientMap&&(H.gradientMap.value=G.gradientMap)}function k(H,G){H.roughness.value=G.roughness,H.metalness.value=G.metalness,G.roughnessMap&&(H.roughnessMap.value=G.roughnessMap),G.metalnessMap&&(H.metalnessMap.value=G.metalnessMap),s.get(G).envMap&&(H.envMapIntensity.value=G.envMapIntensity)}function N(H,G,X){H.ior.value=G.ior,G.sheen>0&&(H.sheenColor.value.copy(G.sheenColor).multiplyScalar(G.sheen),H.sheenRoughness.value=G.sheenRoughness,G.sheenColorMap&&(H.sheenColorMap.value=G.sheenColorMap),G.sheenRoughnessMap&&(H.sheenRoughnessMap.value=G.sheenRoughnessMap)),G.clearcoat>0&&(H.clearcoat.value=G.clearcoat,H.clearcoatRoughness.value=G.clearcoatRoughness,G.clearcoatMap&&(H.clearcoatMap.value=G.clearcoatMap),G.clearcoatRoughnessMap&&(H.clearcoatRoughnessMap.value=G.clearcoatRoughnessMap),G.clearcoatNormalMap&&(H.clearcoatNormalScale.value.copy(G.clearcoatNormalScale),H.clearcoatNormalMap.value=G.clearcoatNormalMap,G.side===m&&H.clearcoatNormalScale.value.negate())),G.iridescence>0&&(H.iridescence.value=G.iridescence,H.iridescenceIOR.value=G.iridescenceIOR,H.iridescenceThicknessMinimum.value=G.iridescenceThicknessRange[0],H.iridescenceThicknessMaximum.value=G.iridescenceThicknessRange[1],G.iridescenceMap&&(H.iridescenceMap.value=G.iridescenceMap),G.iridescenceThicknessMap&&(H.iridescenceThicknessMap.value=G.iridescenceThicknessMap)),G.transmission>0&&(H.transmission.value=G.transmission,H.transmissionSamplerMap.value=X.texture,H.transmissionSamplerSize.value.set(X.width,X.height),G.transmissionMap&&(H.transmissionMap.value=G.transmissionMap),H.thickness.value=G.thickness,G.thicknessMap&&(H.thicknessMap.value=G.thicknessMap),H.attenuationDistance.value=G.attenuationDistance,H.attenuationColor.value.copy(G.attenuationColor)),H.specularIntensity.value=G.specularIntensity,H.specularColor.value.copy(G.specularColor),G.specularIntensityMap&&(H.specularIntensityMap.value=G.specularIntensityMap),G.specularColorMap&&(H.specularColorMap.value=G.specularColorMap)}function z(H,G){G.matcap&&(H.matcap.value=G.matcap)}function V(H,G){H.referencePosition.value.copy(G.referencePosition),H.nearDistance.value=G.nearDistance,H.farDistance.value=G.farDistance}return{refreshFogUniforms:c,refreshMaterialUniforms:d}}function q4(_,s,c,d){let p={},y={},w=[];const E=c.isWebGL2?_.getParameter(_.MAX_UNIFORM_BUFFER_BINDINGS):0;function P(K,ne){const te=ne.program;d.uniformBlockBinding(K,te)}function L(K,ne){let te=p[K.id];te===void 0&&(V(K),te=O(K),p[K.id]=te,K.addEventListener("dispose",G));const oe=ne.program;d.updateUBOMapping(K,oe);const ue=s.render.frame;y[K.id]!==ue&&(N(K),y[K.id]=ue)}function O(K){const ne=k();K.__bindingPointIndex=ne;const te=_.createBuffer(),oe=K.__size,ue=K.usage;return _.bindBuffer(_.UNIFORM_BUFFER,te),_.bufferData(_.UNIFORM_BUFFER,oe,ue),_.bindBuffer(_.UNIFORM_BUFFER,null),_.bindBufferBase(_.UNIFORM_BUFFER,ne,te),te}function k(){for(let K=0;K<E;K++)if(w.indexOf(K)===-1)return w.push(K),K;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function N(K){const ne=p[K.id],te=K.uniforms,oe=K.__cache;_.bindBuffer(_.UNIFORM_BUFFER,ne);for(let ue=0,Ce=te.length;ue<Ce;ue++){const $=te[ue];if(z($,ue,oe)===!0){const ge=$.value,Te=$.__offset;typeof ge=="number"?($.__data[0]=ge,_.bufferSubData(_.UNIFORM_BUFFER,Te,$.__data)):($.value.isMatrix3?($.__data[0]=$.value.elements[0],$.__data[1]=$.value.elements[1],$.__data[2]=$.value.elements[2],$.__data[3]=$.value.elements[0],$.__data[4]=$.value.elements[3],$.__data[5]=$.value.elements[4],$.__data[6]=$.value.elements[5],$.__data[7]=$.value.elements[0],$.__data[8]=$.value.elements[6],$.__data[9]=$.value.elements[7],$.__data[10]=$.value.elements[8],$.__data[11]=$.value.elements[0]):ge.toArray($.__data),_.bufferSubData(_.UNIFORM_BUFFER,Te,$.__data))}}_.bindBuffer(_.UNIFORM_BUFFER,null)}function z(K,ne,te){const oe=K.value;if(te[ne]===void 0)return typeof oe=="number"?te[ne]=oe:te[ne]=oe.clone(),!0;if(typeof oe=="number"){if(te[ne]!==oe)return te[ne]=oe,!0}else{const ue=te[ne];if(ue.equals(oe)===!1)return ue.copy(oe),!0}return!1}function V(K){const ne=K.uniforms;let te=0;const oe=16;let ue=0;for(let Ce=0,$=ne.length;Ce<$;Ce++){const ge=ne[Ce],Te=H(ge);if(ge.__data=new Float32Array(Te.storage/Float32Array.BYTES_PER_ELEMENT),ge.__offset=te,Ce>0){ue=te%oe;const et=oe-ue;ue!==0&&et-Te.boundary<0&&(te+=oe-ue,ge.__offset=te)}te+=Te.storage}return ue=te%oe,ue>0&&(te+=oe-ue),K.__size=te,K.__cache={},this}function H(K){const ne=K.value,te={boundary:0,storage:0};return typeof ne=="number"?(te.boundary=4,te.storage=4):ne.isVector2?(te.boundary=8,te.storage=8):ne.isVector3||ne.isColor?(te.boundary=16,te.storage=12):ne.isVector4?(te.boundary=16,te.storage=16):ne.isMatrix3?(te.boundary=48,te.storage=48):ne.isMatrix4?(te.boundary=64,te.storage=64):ne.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",ne),te}function G(K){const ne=K.target;ne.removeEventListener("dispose",G);const te=w.indexOf(ne.__bindingPointIndex);w.splice(te,1),_.deleteBuffer(p[ne.id]),delete p[ne.id],delete y[ne.id]}function X(){for(const K in p)_.deleteBuffer(p[K]);w=[],p={},y={}}return{bind:P,update:L,dispose:X}}function X4(){const _=Sp("canvas");return _.style.display="block",_}function LT(_={}){this.isWebGLRenderer=!0;const s=_.canvas!==void 0?_.canvas:X4(),c=_.context!==void 0?_.context:null,d=_.depth!==void 0?_.depth:!0,p=_.stencil!==void 0?_.stencil:!0,y=_.antialias!==void 0?_.antialias:!1,w=_.premultipliedAlpha!==void 0?_.premultipliedAlpha:!0,E=_.preserveDrawingBuffer!==void 0?_.preserveDrawingBuffer:!1,P=_.powerPreference!==void 0?_.powerPreference:"default",L=_.failIfMajorPerformanceCaveat!==void 0?_.failIfMajorPerformanceCaveat:!1;let O;c!==null?O=c.getContextAttributes().alpha:O=_.alpha!==void 0?_.alpha:!1;let k=null,N=null;const z=[],V=[];this.domElement=s,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=$c,this.physicallyCorrectLights=!1,this.toneMapping=vn,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const H=this;let G=!1,X=0,K=0,ne=null,te=-1,oe=null;const ue=new Pi,Ce=new Pi;let $=null,ge=s.width,Te=s.height,et=1,It=null,Ye=null;const Fe=new Pi(0,0,ge,Te),rt=new Pi(0,0,ge,Te);let At=!1;const St=new e0;let at=!1,Qe=!1,Je=null;const Rt=new $n,Pt=new gt,Lt=new de,yn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Hn(){return ne===null?et:1}let Ue=c;function ai(fe,qe){for(let st=0;st<fe.length;st++){const He=fe[st],ot=s.getContext(He,qe);if(ot!==null)return ot}return null}try{const fe={alpha:!0,depth:d,stencil:p,antialias:y,premultipliedAlpha:w,preserveDrawingBuffer:E,powerPreference:P,failIfMajorPerformanceCaveat:L};if("setAttribute"in s&&s.setAttribute("data-engine",`three.js r${a}`),s.addEventListener("webglcontextlost",Nn,!1),s.addEventListener("webglcontextrestored",ri,!1),s.addEventListener("webglcontextcreationerror",Li,!1),Ue===null){const qe=["webgl2","webgl","experimental-webgl"];if(H.isWebGL1Renderer===!0&&qe.shift(),Ue=ai(qe,fe),Ue===null)throw ai(qe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ue.getShaderPrecisionFormat===void 0&&(Ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(fe){throw console.error("THREE.WebGLRenderer: "+fe.message),fe}let On,Vn,on,li,dt,ct,Gt,bn,sn,ei,kn,Pn,Qi,ki,_e,le,Ze,Ot,jt,an,zn,cn,ft,Tn;function Wn(){On=new hG(Ue),Vn=new sG(Ue,On,_),On.init(Vn),cn=new RT(Ue,On,Vn),on=new H4(Ue,On,Vn),li=new fG(Ue),dt=new R4,ct=new V4(Ue,On,on,dt,Vn,cn,li),Gt=new oG(H),bn=new lG(H),sn=new nU(Ue,Vn),ft=new nG(Ue,On,sn,Vn),ei=new uG(Ue,sn,li,ft),kn=new AG(Ue,ei,sn,li),jt=new gG(Ue,Vn,ct),le=new rG(dt),Pn=new I4(H,Gt,bn,On,Vn,ft,le),Qi=new j4(H,dt),ki=new B4,_e=new N4(On,Vn),Ot=new tG(H,Gt,on,kn,O,w),Ze=new G4(H,kn,Vn),Tn=new q4(Ue,li,Vn,on),an=new iG(Ue,On,li,Vn),zn=new dG(Ue,On,li,Vn),li.programs=Pn.programs,H.capabilities=Vn,H.extensions=On,H.properties=dt,H.renderLists=ki,H.shadowMap=Ze,H.state=on,H.info=li}Wn();const En=new Q4(H,Ue);this.xr=En,this.getContext=function(){return Ue},this.getContextAttributes=function(){return Ue.getContextAttributes()},this.forceContextLoss=function(){const fe=On.get("WEBGL_lose_context");fe&&fe.loseContext()},this.forceContextRestore=function(){const fe=On.get("WEBGL_lose_context");fe&&fe.restoreContext()},this.getPixelRatio=function(){return et},this.setPixelRatio=function(fe){fe!==void 0&&(et=fe,this.setSize(ge,Te,!1))},this.getSize=function(fe){return fe.set(ge,Te)},this.setSize=function(fe,qe,st){if(En.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ge=fe,Te=qe,s.width=Math.floor(fe*et),s.height=Math.floor(qe*et),st!==!1&&(s.style.width=fe+"px",s.style.height=qe+"px"),this.setViewport(0,0,fe,qe)},this.getDrawingBufferSize=function(fe){return fe.set(ge*et,Te*et).floor()},this.setDrawingBufferSize=function(fe,qe,st){ge=fe,Te=qe,et=st,s.width=Math.floor(fe*st),s.height=Math.floor(qe*st),this.setViewport(0,0,fe,qe)},this.getCurrentViewport=function(fe){return fe.copy(ue)},this.getViewport=function(fe){return fe.copy(Fe)},this.setViewport=function(fe,qe,st,He){fe.isVector4?Fe.set(fe.x,fe.y,fe.z,fe.w):Fe.set(fe,qe,st,He),on.viewport(ue.copy(Fe).multiplyScalar(et).floor())},this.getScissor=function(fe){return fe.copy(rt)},this.setScissor=function(fe,qe,st,He){fe.isVector4?rt.set(fe.x,fe.y,fe.z,fe.w):rt.set(fe,qe,st,He),on.scissor(Ce.copy(rt).multiplyScalar(et).floor())},this.getScissorTest=function(){return At},this.setScissorTest=function(fe){on.setScissorTest(At=fe)},this.setOpaqueSort=function(fe){It=fe},this.setTransparentSort=function(fe){Ye=fe},this.getClearColor=function(fe){return fe.copy(Ot.getClearColor())},this.setClearColor=function(){Ot.setClearColor.apply(Ot,arguments)},this.getClearAlpha=function(){return Ot.getClearAlpha()},this.setClearAlpha=function(){Ot.setClearAlpha.apply(Ot,arguments)},this.clear=function(fe=!0,qe=!0,st=!0){let He=0;fe&&(He|=Ue.COLOR_BUFFER_BIT),qe&&(He|=Ue.DEPTH_BUFFER_BIT),st&&(He|=Ue.STENCIL_BUFFER_BIT),Ue.clear(He)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){s.removeEventListener("webglcontextlost",Nn,!1),s.removeEventListener("webglcontextrestored",ri,!1),s.removeEventListener("webglcontextcreationerror",Li,!1),ki.dispose(),_e.dispose(),dt.dispose(),Gt.dispose(),bn.dispose(),kn.dispose(),ft.dispose(),Tn.dispose(),Pn.dispose(),En.dispose(),En.removeEventListener("sessionstart",Un),En.removeEventListener("sessionend",ji),Je&&(Je.dispose(),Je=null),ms.stop()};function Nn(fe){fe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),G=!0}function ri(){console.log("THREE.WebGLRenderer: Context Restored."),G=!1;const fe=li.autoReset,qe=Ze.enabled,st=Ze.autoUpdate,He=Ze.needsUpdate,ot=Ze.type;Wn(),li.autoReset=fe,Ze.enabled=qe,Ze.autoUpdate=st,Ze.needsUpdate=He,Ze.type=ot}function Li(fe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",fe.statusMessage)}function Pe(fe){const qe=fe.target;qe.removeEventListener("dispose",Pe),_n(qe)}function _n(fe){qt(fe),dt.remove(fe)}function qt(fe){const qe=dt.get(fe).programs;qe!==void 0&&(qe.forEach(function(st){Pn.releaseProgram(st)}),fe.isShaderMaterial&&Pn.releaseShaderCache(fe))}this.renderBufferDirect=function(fe,qe,st,He,ot,Rn){qe===null&&(qe=yn);const Qn=ot.isMesh&&ot.matrixWorld.determinant()<0,ci=hV(fe,qe,st,He,ot);on.setMaterial(He,Qn);let Yn=st.index;const Bi=st.attributes.position;if(Yn===null){if(Bi===void 0||Bi.count===0)return}else if(Yn.count===0)return;let gi=1;He.wireframe===!0&&(Yn=ei.getWireframeAttribute(st),gi=2),ft.setup(ot,He,ci,st,Yn);let Ai,os=an;Yn!==null&&(Ai=sn.get(Yn),os=zn,os.setIndex(Ai));const jh=Yn!==null?Yn.count:Bi.count,Ld=st.drawRange.start*gi,Dd=st.drawRange.count*gi,Ta=Rn!==null?Rn.start*gi:0,Mi=Rn!==null?Rn.count*gi:1/0,Od=Math.max(Ld,Ta),ws=Math.min(jh,Ld+Dd,Ta+Mi)-1,So=Math.max(0,ws-Od+1);if(So!==0){if(ot.isMesh)He.wireframe===!0?(on.setLineWidth(He.wireframeLinewidth*Hn()),os.setMode(Ue.LINES)):os.setMode(Ue.TRIANGLES);else if(ot.isLine){let Al=He.linewidth;Al===void 0&&(Al=1),on.setLineWidth(Al*Hn()),ot.isLineSegments?os.setMode(Ue.LINES):ot.isLineLoop?os.setMode(Ue.LINE_LOOP):os.setMode(Ue.LINE_STRIP)}else ot.isPoints?os.setMode(Ue.POINTS):ot.isSprite&&os.setMode(Ue.TRIANGLES);if(ot.isInstancedMesh)os.renderInstances(Od,So,ot.count);else if(st.isInstancedBufferGeometry){const Al=Math.min(st.instanceCount,st._maxInstanceCount);os.renderInstances(Od,So,Al)}else os.render(Od,So)}},this.compile=function(fe,qe){function st(He,ot,Rn){He.transparent===!0&&He.side===A?(He.side=m,He.needsUpdate=!0,O0(He,ot,Rn),He.side=g,He.needsUpdate=!0,O0(He,ot,Rn),He.side=A):O0(He,ot,Rn)}N=_e.get(fe),N.init(),V.push(N),fe.traverseVisible(function(He){He.isLight&&He.layers.test(qe.layers)&&(N.pushLight(He),He.castShadow&&N.pushShadow(He))}),N.setupLights(H.physicallyCorrectLights),fe.traverse(function(He){const ot=He.material;if(ot)if(Array.isArray(ot))for(let Rn=0;Rn<ot.length;Rn++){const Qn=ot[Rn];st(Qn,fe,He)}else st(ot,fe,He)}),V.pop(),N=null};let ht=null;function Yt(fe){ht&&ht(fe)}function Un(){ms.stop()}function ji(){ms.start()}const ms=new sT;ms.setAnimationLoop(Yt),typeof self<"u"&&ms.setContext(self),this.setAnimationLoop=function(fe){ht=fe,En.setAnimationLoop(fe),fe===null?ms.stop():ms.start()},En.addEventListener("sessionstart",Un),En.addEventListener("sessionend",ji),this.render=function(fe,qe){if(qe!==void 0&&qe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(G===!0)return;fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),qe.parent===null&&qe.matrixWorldAutoUpdate===!0&&qe.updateMatrixWorld(),En.enabled===!0&&En.isPresenting===!0&&(En.cameraAutoUpdate===!0&&En.updateCamera(qe),qe=En.getCamera()),fe.isScene===!0&&fe.onBeforeRender(H,fe,qe,ne),N=_e.get(fe,V.length),N.init(),V.push(N),Rt.multiplyMatrices(qe.projectionMatrix,qe.matrixWorldInverse),St.setFromProjectionMatrix(Rt),Qe=this.localClippingEnabled,at=le.init(this.clippingPlanes,Qe,qe),k=ki.get(fe,z.length),k.init(),z.push(k),gl(fe,qe,0,H.sortObjects),k.finish(),H.sortObjects===!0&&k.sort(It,Ye),at===!0&&le.beginShadows();const st=N.state.shadowsArray;if(Ze.render(st,fe,qe),at===!0&&le.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ot.render(k,fe),N.setupLights(H.physicallyCorrectLights),qe.isArrayCamera){const He=qe.cameras;for(let ot=0,Rn=He.length;ot<Rn;ot++){const Qn=He[ot];rs(k,fe,Qn,Qn.viewport)}}else rs(k,fe,qe);ne!==null&&(ct.updateMultisampleRenderTarget(ne),ct.updateRenderTargetMipmap(ne)),fe.isScene===!0&&fe.onAfterRender(H,fe,qe),ft.resetDefaultState(),te=-1,oe=null,V.pop(),V.length>0?N=V[V.length-1]:N=null,z.pop(),z.length>0?k=z[z.length-1]:k=null};function gl(fe,qe,st,He){if(fe.visible===!1)return;if(fe.layers.test(qe.layers)){if(fe.isGroup)st=fe.renderOrder;else if(fe.isLOD)fe.autoUpdate===!0&&fe.update(qe);else if(fe.isLight)N.pushLight(fe),fe.castShadow&&N.pushShadow(fe);else if(fe.isSprite){if(!fe.frustumCulled||St.intersectsSprite(fe)){He&&Lt.setFromMatrixPosition(fe.matrixWorld).applyMatrix4(Rt);const Qn=kn.update(fe),ci=fe.material;ci.visible&&k.push(fe,Qn,ci,st,Lt.z,null)}}else if((fe.isMesh||fe.isLine||fe.isPoints)&&(fe.isSkinnedMesh&&fe.skeleton.frame!==li.render.frame&&(fe.skeleton.update(),fe.skeleton.frame=li.render.frame),!fe.frustumCulled||St.intersectsObject(fe))){He&&Lt.setFromMatrixPosition(fe.matrixWorld).applyMatrix4(Rt);const Qn=kn.update(fe),ci=fe.material;if(Array.isArray(ci)){const Yn=Qn.groups;for(let Bi=0,gi=Yn.length;Bi<gi;Bi++){const Ai=Yn[Bi],os=ci[Ai.materialIndex];os&&os.visible&&k.push(fe,Qn,os,st,Lt.z,Ai)}}else ci.visible&&k.push(fe,Qn,ci,st,Lt.z,null)}}const Rn=fe.children;for(let Qn=0,ci=Rn.length;Qn<ci;Qn++)gl(Rn[Qn],qe,st,He)}function rs(fe,qe,st,He){const ot=fe.opaque,Rn=fe.transmissive,Qn=fe.transparent;N.setupLightsView(st),Rn.length>0&&_c(ot,qe,st),He&&on.viewport(ue.copy(He)),ot.length>0&&Eo(ot,qe,st),Rn.length>0&&Eo(Rn,qe,st),Qn.length>0&&Eo(Qn,qe,st),on.buffers.depth.setTest(!0),on.buffers.depth.setMask(!0),on.buffers.color.setMask(!0),on.setPolygonOffset(!1)}function _c(fe,qe,st){const He=Vn.isWebGL2;Je===null&&(Je=new xo(1,1,{generateMipmaps:!0,type:On.has("EXT_color_buffer_half_float")?fi:Dn,minFilter:Wt,samples:He&&y===!0?4:0})),H.getDrawingBufferSize(Pt),He?Je.setSize(Pt.x,Pt.y):Je.setSize(RA(Pt.x),RA(Pt.y));const ot=H.getRenderTarget();H.setRenderTarget(Je),H.clear();const Rn=H.toneMapping;H.toneMapping=vn,Eo(fe,qe,st),H.toneMapping=Rn,ct.updateMultisampleRenderTarget(Je),ct.updateRenderTargetMipmap(Je),H.setRenderTarget(ot)}function Eo(fe,qe,st){const He=qe.isScene===!0?qe.overrideMaterial:null;for(let ot=0,Rn=fe.length;ot<Rn;ot++){const Qn=fe[ot],ci=Qn.object,Yn=Qn.geometry,Bi=He===null?Qn.material:He,gi=Qn.group;ci.layers.test(st.layers)&&lV(ci,qe,st,Yn,Bi,gi)}}function lV(fe,qe,st,He,ot,Rn){fe.onBeforeRender(H,qe,st,He,ot,Rn),fe.modelViewMatrix.multiplyMatrices(st.matrixWorldInverse,fe.matrixWorld),fe.normalMatrix.getNormalMatrix(fe.modelViewMatrix),ot.onBeforeRender(H,qe,st,He,fe,Rn),ot.transparent===!0&&ot.side===A?(ot.side=m,ot.needsUpdate=!0,H.renderBufferDirect(st,qe,He,ot,fe,Rn),ot.side=g,ot.needsUpdate=!0,H.renderBufferDirect(st,qe,He,ot,fe,Rn),ot.side=A):H.renderBufferDirect(st,qe,He,ot,fe,Rn),fe.onAfterRender(H,qe,st,He,ot,Rn)}function O0(fe,qe,st){qe.isScene!==!0&&(qe=yn);const He=dt.get(fe),ot=N.state.lights,Rn=N.state.shadowsArray,Qn=ot.state.version,ci=Pn.getParameters(fe,ot.state,Rn,qe,st),Yn=Pn.getProgramCacheKey(ci);let Bi=He.programs;He.environment=fe.isMeshStandardMaterial?qe.environment:null,He.fog=qe.fog,He.envMap=(fe.isMeshStandardMaterial?bn:Gt).get(fe.envMap||He.environment),Bi===void 0&&(fe.addEventListener("dispose",Pe),Bi=new Map,He.programs=Bi);let gi=Bi.get(Yn);if(gi!==void 0){if(He.currentProgram===gi&&He.lightsStateVersion===Qn)return mR(fe,ci),gi}else ci.uniforms=Pn.getUniforms(fe),fe.onBuild(st,ci,H),fe.onBeforeCompile(ci,H),gi=Pn.acquireProgram(ci,Yn),Bi.set(Yn,gi),He.uniforms=ci.uniforms;const Ai=He.uniforms;(!fe.isShaderMaterial&&!fe.isRawShaderMaterial||fe.clipping===!0)&&(Ai.clippingPlanes=le.uniform),mR(fe,ci),He.needsLights=dV(fe),He.lightsStateVersion=Qn,He.needsLights&&(Ai.ambientLightColor.value=ot.state.ambient,Ai.lightProbe.value=ot.state.probe,Ai.directionalLights.value=ot.state.directional,Ai.directionalLightShadows.value=ot.state.directionalShadow,Ai.spotLights.value=ot.state.spot,Ai.spotLightShadows.value=ot.state.spotShadow,Ai.rectAreaLights.value=ot.state.rectArea,Ai.ltc_1.value=ot.state.rectAreaLTC1,Ai.ltc_2.value=ot.state.rectAreaLTC2,Ai.pointLights.value=ot.state.point,Ai.pointLightShadows.value=ot.state.pointShadow,Ai.hemisphereLights.value=ot.state.hemi,Ai.directionalShadowMap.value=ot.state.directionalShadowMap,Ai.directionalShadowMatrix.value=ot.state.directionalShadowMatrix,Ai.spotShadowMap.value=ot.state.spotShadowMap,Ai.spotLightMatrix.value=ot.state.spotLightMatrix,Ai.spotLightMap.value=ot.state.spotLightMap,Ai.pointShadowMap.value=ot.state.pointShadowMap,Ai.pointShadowMatrix.value=ot.state.pointShadowMatrix);const os=gi.getUniforms(),jh=s0.seqWithValue(os.seq,Ai);return He.currentProgram=gi,He.uniformsList=jh,gi}function mR(fe,qe){const st=dt.get(fe);st.outputEncoding=qe.outputEncoding,st.instancing=qe.instancing,st.skinning=qe.skinning,st.morphTargets=qe.morphTargets,st.morphNormals=qe.morphNormals,st.morphColors=qe.morphColors,st.morphTargetsCount=qe.morphTargetsCount,st.numClippingPlanes=qe.numClippingPlanes,st.numIntersection=qe.numClipIntersection,st.vertexAlphas=qe.vertexAlphas,st.vertexTangents=qe.vertexTangents,st.toneMapping=qe.toneMapping}function hV(fe,qe,st,He,ot){qe.isScene!==!0&&(qe=yn),ct.resetTextureUnits();const Rn=qe.fog,Qn=He.isMeshStandardMaterial?qe.environment:null,ci=ne===null?H.outputEncoding:ne.isXRRenderTarget===!0?ne.texture.encoding:$c,Yn=(He.isMeshStandardMaterial?bn:Gt).get(He.envMap||Qn),Bi=He.vertexColors===!0&&!!st.attributes.color&&st.attributes.color.itemSize===4,gi=!!He.normalMap&&!!st.attributes.tangent,Ai=!!st.morphAttributes.position,os=!!st.morphAttributes.normal,jh=!!st.morphAttributes.color,Ld=He.toneMapped?H.toneMapping:vn,Dd=st.morphAttributes.position||st.morphAttributes.normal||st.morphAttributes.color,Ta=Dd!==void 0?Dd.length:0,Mi=dt.get(He),Od=N.state.lights;if(at===!0&&(Qe===!0||fe!==oe)){const no=fe===oe&&He.id===te;le.setState(He,fe,no)}let ws=!1;He.version===Mi.__version?(Mi.needsLights&&Mi.lightsStateVersion!==Od.state.version||Mi.outputEncoding!==ci||ot.isInstancedMesh&&Mi.instancing===!1||!ot.isInstancedMesh&&Mi.instancing===!0||ot.isSkinnedMesh&&Mi.skinning===!1||!ot.isSkinnedMesh&&Mi.skinning===!0||Mi.envMap!==Yn||He.fog===!0&&Mi.fog!==Rn||Mi.numClippingPlanes!==void 0&&(Mi.numClippingPlanes!==le.numPlanes||Mi.numIntersection!==le.numIntersection)||Mi.vertexAlphas!==Bi||Mi.vertexTangents!==gi||Mi.morphTargets!==Ai||Mi.morphNormals!==os||Mi.morphColors!==jh||Mi.toneMapping!==Ld||Vn.isWebGL2===!0&&Mi.morphTargetsCount!==Ta)&&(ws=!0):(ws=!0,Mi.__version=He.version);let So=Mi.currentProgram;ws===!0&&(So=O0(He,qe,ot));let Al=!1,cm=!1,$w=!1;const Cr=So.getUniforms(),qh=Mi.uniforms;if(on.useProgram(So.program)&&(Al=!0,cm=!0,$w=!0),He.id!==te&&(te=He.id,cm=!0),Al||oe!==fe){if(Cr.setValue(Ue,"projectionMatrix",fe.projectionMatrix),Vn.logarithmicDepthBuffer&&Cr.setValue(Ue,"logDepthBufFC",2/(Math.log(fe.far+1)/Math.LN2)),oe!==fe&&(oe=fe,cm=!0,$w=!0),He.isShaderMaterial||He.isMeshPhongMaterial||He.isMeshToonMaterial||He.isMeshStandardMaterial||He.envMap){const no=Cr.map.cameraPosition;no!==void 0&&no.setValue(Ue,Lt.setFromMatrixPosition(fe.matrixWorld))}(He.isMeshPhongMaterial||He.isMeshToonMaterial||He.isMeshLambertMaterial||He.isMeshBasicMaterial||He.isMeshStandardMaterial||He.isShaderMaterial)&&Cr.setValue(Ue,"isOrthographic",fe.isOrthographicCamera===!0),(He.isMeshPhongMaterial||He.isMeshToonMaterial||He.isMeshLambertMaterial||He.isMeshBasicMaterial||He.isMeshStandardMaterial||He.isShaderMaterial||He.isShadowMaterial||ot.isSkinnedMesh)&&Cr.setValue(Ue,"viewMatrix",fe.matrixWorldInverse)}if(ot.isSkinnedMesh){Cr.setOptional(Ue,ot,"bindMatrix"),Cr.setOptional(Ue,ot,"bindMatrixInverse");const no=ot.skeleton;no&&(Vn.floatVertexTextures?(no.boneTexture===null&&no.computeBoneTexture(),Cr.setValue(Ue,"boneTexture",no.boneTexture,ct),Cr.setValue(Ue,"boneTextureSize",no.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const eb=st.morphAttributes;if((eb.position!==void 0||eb.normal!==void 0||eb.color!==void 0&&Vn.isWebGL2===!0)&&jt.update(ot,st,He,So),(cm||Mi.receiveShadow!==ot.receiveShadow)&&(Mi.receiveShadow=ot.receiveShadow,Cr.setValue(Ue,"receiveShadow",ot.receiveShadow)),He.isMeshGouraudMaterial&&He.envMap!==null&&(qh.envMap.value=Yn,qh.flipEnvMap.value=Yn.isCubeTexture&&Yn.isRenderTargetTexture===!1?-1:1),cm&&(Cr.setValue(Ue,"toneMappingExposure",H.toneMappingExposure),Mi.needsLights&&uV(qh,$w),Rn&&He.fog===!0&&Qi.refreshFogUniforms(qh,Rn),Qi.refreshMaterialUniforms(qh,He,et,Te,Je),s0.upload(Ue,Mi.uniformsList,qh,ct)),He.isShaderMaterial&&He.uniformsNeedUpdate===!0&&(s0.upload(Ue,Mi.uniformsList,qh,ct),He.uniformsNeedUpdate=!1),He.isSpriteMaterial&&Cr.setValue(Ue,"center",ot.center),Cr.setValue(Ue,"modelViewMatrix",ot.modelViewMatrix),Cr.setValue(Ue,"normalMatrix",ot.normalMatrix),Cr.setValue(Ue,"modelMatrix",ot.matrixWorld),He.isShaderMaterial||He.isRawShaderMaterial){const no=He.uniformsGroups;for(let tb=0,fV=no.length;tb<fV;tb++)if(Vn.isWebGL2){const gR=no[tb];Tn.update(gR,So),Tn.bind(gR,So)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return So}function uV(fe,qe){fe.ambientLightColor.needsUpdate=qe,fe.lightProbe.needsUpdate=qe,fe.directionalLights.needsUpdate=qe,fe.directionalLightShadows.needsUpdate=qe,fe.pointLights.needsUpdate=qe,fe.pointLightShadows.needsUpdate=qe,fe.spotLights.needsUpdate=qe,fe.spotLightShadows.needsUpdate=qe,fe.rectAreaLights.needsUpdate=qe,fe.hemisphereLights.needsUpdate=qe}function dV(fe){return fe.isMeshLambertMaterial||fe.isMeshToonMaterial||fe.isMeshPhongMaterial||fe.isMeshStandardMaterial||fe.isShadowMaterial||fe.isShaderMaterial&&fe.lights===!0}this.getActiveCubeFace=function(){return X},this.getActiveMipmapLevel=function(){return K},this.getRenderTarget=function(){return ne},this.setRenderTargetTextures=function(fe,qe,st){dt.get(fe.texture).__webglTexture=qe,dt.get(fe.depthTexture).__webglTexture=st;const He=dt.get(fe);He.__hasExternalTextures=!0,He.__hasExternalTextures&&(He.__autoAllocateDepthBuffer=st===void 0,He.__autoAllocateDepthBuffer||On.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),He.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(fe,qe){const st=dt.get(fe);st.__webglFramebuffer=qe,st.__useDefaultFramebuffer=qe===void 0},this.setRenderTarget=function(fe,qe=0,st=0){ne=fe,X=qe,K=st;let He=!0;if(fe){const Yn=dt.get(fe);Yn.__useDefaultFramebuffer!==void 0?(on.bindFramebuffer(Ue.FRAMEBUFFER,null),He=!1):Yn.__webglFramebuffer===void 0?ct.setupRenderTarget(fe):Yn.__hasExternalTextures&&ct.rebindTextures(fe,dt.get(fe.texture).__webglTexture,dt.get(fe.depthTexture).__webglTexture)}let ot=null,Rn=!1,Qn=!1;if(fe){const Yn=fe.texture;(Yn.isData3DTexture||Yn.isDataArrayTexture)&&(Qn=!0);const Bi=dt.get(fe).__webglFramebuffer;fe.isWebGLCubeRenderTarget?(ot=Bi[qe],Rn=!0):Vn.isWebGL2&&fe.samples>0&&ct.useMultisampledRTT(fe)===!1?ot=dt.get(fe).__webglMultisampledFramebuffer:ot=Bi,ue.copy(fe.viewport),Ce.copy(fe.scissor),$=fe.scissorTest}else ue.copy(Fe).multiplyScalar(et).floor(),Ce.copy(rt).multiplyScalar(et).floor(),$=At;if(on.bindFramebuffer(Ue.FRAMEBUFFER,ot)&&Vn.drawBuffers&&He&&on.drawBuffers(fe,ot),on.viewport(ue),on.scissor(Ce),on.setScissorTest($),Rn){const Yn=dt.get(fe.texture);Ue.framebufferTexture2D(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_CUBE_MAP_POSITIVE_X+qe,Yn.__webglTexture,st)}else if(Qn){const Yn=dt.get(fe.texture),Bi=qe||0;Ue.framebufferTextureLayer(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Yn.__webglTexture,st||0,Bi)}te=-1},this.readRenderTargetPixels=function(fe,qe,st,He,ot,Rn,Qn){if(!(fe&&fe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ci=dt.get(fe).__webglFramebuffer;if(fe.isWebGLCubeRenderTarget&&Qn!==void 0&&(ci=ci[Qn]),ci){on.bindFramebuffer(Ue.FRAMEBUFFER,ci);try{const Yn=fe.texture,Bi=Yn.format,gi=Yn.type;if(Bi!==or&&cn.convert(Bi)!==Ue.getParameter(Ue.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Ai=gi===fi&&(On.has("EXT_color_buffer_half_float")||Vn.isWebGL2&&On.has("EXT_color_buffer_float"));if(gi!==Dn&&cn.convert(gi)!==Ue.getParameter(Ue.IMPLEMENTATION_COLOR_READ_TYPE)&&!(gi===wn&&(Vn.isWebGL2||On.has("OES_texture_float")||On.has("WEBGL_color_buffer_float")))&&!Ai){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}qe>=0&&qe<=fe.width-He&&st>=0&&st<=fe.height-ot&&Ue.readPixels(qe,st,He,ot,cn.convert(Bi),cn.convert(gi),Rn)}finally{const Yn=ne!==null?dt.get(ne).__webglFramebuffer:null;on.bindFramebuffer(Ue.FRAMEBUFFER,Yn)}}},this.copyFramebufferToTexture=function(fe,qe,st=0){const He=Math.pow(2,-st),ot=Math.floor(qe.image.width*He),Rn=Math.floor(qe.image.height*He);ct.setTexture2D(qe,0),Ue.copyTexSubImage2D(Ue.TEXTURE_2D,st,0,0,fe.x,fe.y,ot,Rn),on.unbindTexture()},this.copyTextureToTexture=function(fe,qe,st,He=0){const ot=qe.image.width,Rn=qe.image.height,Qn=cn.convert(st.format),ci=cn.convert(st.type);ct.setTexture2D(st,0),Ue.pixelStorei(Ue.UNPACK_FLIP_Y_WEBGL,st.flipY),Ue.pixelStorei(Ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,st.premultiplyAlpha),Ue.pixelStorei(Ue.UNPACK_ALIGNMENT,st.unpackAlignment),qe.isDataTexture?Ue.texSubImage2D(Ue.TEXTURE_2D,He,fe.x,fe.y,ot,Rn,Qn,ci,qe.image.data):qe.isCompressedTexture?Ue.compressedTexSubImage2D(Ue.TEXTURE_2D,He,fe.x,fe.y,qe.mipmaps[0].width,qe.mipmaps[0].height,Qn,qe.mipmaps[0].data):Ue.texSubImage2D(Ue.TEXTURE_2D,He,fe.x,fe.y,Qn,ci,qe.image),He===0&&st.generateMipmaps&&Ue.generateMipmap(Ue.TEXTURE_2D),on.unbindTexture()},this.copyTextureToTexture3D=function(fe,qe,st,He,ot=0){if(H.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Rn=fe.max.x-fe.min.x+1,Qn=fe.max.y-fe.min.y+1,ci=fe.max.z-fe.min.z+1,Yn=cn.convert(He.format),Bi=cn.convert(He.type);let gi;if(He.isData3DTexture)ct.setTexture3D(He,0),gi=Ue.TEXTURE_3D;else if(He.isDataArrayTexture)ct.setTexture2DArray(He,0),gi=Ue.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ue.pixelStorei(Ue.UNPACK_FLIP_Y_WEBGL,He.flipY),Ue.pixelStorei(Ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,He.premultiplyAlpha),Ue.pixelStorei(Ue.UNPACK_ALIGNMENT,He.unpackAlignment);const Ai=Ue.getParameter(Ue.UNPACK_ROW_LENGTH),os=Ue.getParameter(Ue.UNPACK_IMAGE_HEIGHT),jh=Ue.getParameter(Ue.UNPACK_SKIP_PIXELS),Ld=Ue.getParameter(Ue.UNPACK_SKIP_ROWS),Dd=Ue.getParameter(Ue.UNPACK_SKIP_IMAGES),Ta=st.isCompressedTexture?st.mipmaps[0]:st.image;Ue.pixelStorei(Ue.UNPACK_ROW_LENGTH,Ta.width),Ue.pixelStorei(Ue.UNPACK_IMAGE_HEIGHT,Ta.height),Ue.pixelStorei(Ue.UNPACK_SKIP_PIXELS,fe.min.x),Ue.pixelStorei(Ue.UNPACK_SKIP_ROWS,fe.min.y),Ue.pixelStorei(Ue.UNPACK_SKIP_IMAGES,fe.min.z),st.isDataTexture||st.isData3DTexture?Ue.texSubImage3D(gi,ot,qe.x,qe.y,qe.z,Rn,Qn,ci,Yn,Bi,Ta.data):st.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ue.compressedTexSubImage3D(gi,ot,qe.x,qe.y,qe.z,Rn,Qn,ci,Yn,Ta.data)):Ue.texSubImage3D(gi,ot,qe.x,qe.y,qe.z,Rn,Qn,ci,Yn,Bi,Ta),Ue.pixelStorei(Ue.UNPACK_ROW_LENGTH,Ai),Ue.pixelStorei(Ue.UNPACK_IMAGE_HEIGHT,os),Ue.pixelStorei(Ue.UNPACK_SKIP_PIXELS,jh),Ue.pixelStorei(Ue.UNPACK_SKIP_ROWS,Ld),Ue.pixelStorei(Ue.UNPACK_SKIP_IMAGES,Dd),ot===0&&He.generateMipmaps&&Ue.generateMipmap(gi),on.unbindTexture()},this.initTexture=function(fe){fe.isCubeTexture?ct.setTextureCube(fe,0):fe.isData3DTexture?ct.setTexture3D(fe,0):fe.isDataArrayTexture?ct.setTexture2DArray(fe,0):ct.setTexture2D(fe,0),on.unbindTexture()},this.resetState=function(){X=0,K=0,ne=null,on.reset(),ft.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class DT extends LT{}DT.prototype.isWebGL1Renderer=!0;class r0{constructor(s,c=25e-5){this.isFogExp2=!0,this.name="",this.color=new dn(s),this.density=c}clone(){return new r0(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class o0{constructor(s,c=1,d=1e3){this.isFog=!0,this.name="",this.color=new dn(s),this.near=c,this.far=d}clone(){return new o0(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class OT extends bi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(s,c){return super.copy(s,c),s.background!==null&&(this.background=s.background.clone()),s.environment!==null&&(this.environment=s.environment.clone()),s.fog!==null&&(this.fog=s.fog.clone()),s.overrideMaterial!==null&&(this.overrideMaterial=s.overrideMaterial.clone()),this.matrixAutoUpdate=s.matrixAutoUpdate,this}toJSON(s){const c=super.toJSON(s);return this.fog!==null&&(c.object.fog=this.fog.toJSON()),c}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(s){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=s}}class a0{constructor(s,c){this.isInterleavedBuffer=!0,this.array=s,this.stride=c,this.count=s!==void 0?s.length/c:0,this.usage=bp,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Zr()}onUploadCallback(){}set needsUpdate(s){s===!0&&this.version++}setUsage(s){return this.usage=s,this}copy(s){return this.array=new s.array.constructor(s.array),this.count=s.count,this.stride=s.stride,this.usage=s.usage,this}copyAt(s,c,d){s*=this.stride,d*=c.stride;for(let p=0,y=this.stride;p<y;p++)this.array[s+p]=c.array[d+p];return this}set(s,c=0){return this.array.set(s,c),this}clone(s){s.arrayBuffers===void 0&&(s.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zr()),s.arrayBuffers[this.array.buffer._uuid]===void 0&&(s.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const c=new this.array.constructor(s.arrayBuffers[this.array.buffer._uuid]),d=new this.constructor(c,this.stride);return d.setUsage(this.usage),d}onUpload(s){return this.onUploadCallback=s,this}toJSON(s){return s.arrayBuffers===void 0&&(s.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zr()),s.arrayBuffers[this.array.buffer._uuid]===void 0&&(s.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const wr=new de;class Dh{constructor(s,c,d,p=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=s,this.itemSize=c,this.offset=d,this.normalized=p===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(s){this.data.needsUpdate=s}applyMatrix4(s){for(let c=0,d=this.data.count;c<d;c++)wr.fromBufferAttribute(this,c),wr.applyMatrix4(s),this.setXYZ(c,wr.x,wr.y,wr.z);return this}applyNormalMatrix(s){for(let c=0,d=this.count;c<d;c++)wr.fromBufferAttribute(this,c),wr.applyNormalMatrix(s),this.setXYZ(c,wr.x,wr.y,wr.z);return this}transformDirection(s){for(let c=0,d=this.count;c<d;c++)wr.fromBufferAttribute(this,c),wr.transformDirection(s),this.setXYZ(c,wr.x,wr.y,wr.z);return this}setX(s,c){return this.normalized&&(c=Oi(c,this.array)),this.data.array[s*this.data.stride+this.offset]=c,this}setY(s,c){return this.normalized&&(c=Oi(c,this.array)),this.data.array[s*this.data.stride+this.offset+1]=c,this}setZ(s,c){return this.normalized&&(c=Oi(c,this.array)),this.data.array[s*this.data.stride+this.offset+2]=c,this}setW(s,c){return this.normalized&&(c=Oi(c,this.array)),this.data.array[s*this.data.stride+this.offset+3]=c,this}getX(s){let c=this.data.array[s*this.data.stride+this.offset];return this.normalized&&(c=lc(c,this.array)),c}getY(s){let c=this.data.array[s*this.data.stride+this.offset+1];return this.normalized&&(c=lc(c,this.array)),c}getZ(s){let c=this.data.array[s*this.data.stride+this.offset+2];return this.normalized&&(c=lc(c,this.array)),c}getW(s){let c=this.data.array[s*this.data.stride+this.offset+3];return this.normalized&&(c=lc(c,this.array)),c}setXY(s,c,d){return s=s*this.data.stride+this.offset,this.normalized&&(c=Oi(c,this.array),d=Oi(d,this.array)),this.data.array[s+0]=c,this.data.array[s+1]=d,this}setXYZ(s,c,d,p){return s=s*this.data.stride+this.offset,this.normalized&&(c=Oi(c,this.array),d=Oi(d,this.array),p=Oi(p,this.array)),this.data.array[s+0]=c,this.data.array[s+1]=d,this.data.array[s+2]=p,this}setXYZW(s,c,d,p,y){return s=s*this.data.stride+this.offset,this.normalized&&(c=Oi(c,this.array),d=Oi(d,this.array),p=Oi(p,this.array),y=Oi(y,this.array)),this.data.array[s+0]=c,this.data.array[s+1]=d,this.data.array[s+2]=p,this.data.array[s+3]=y,this}clone(s){if(s===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const c=[];for(let d=0;d<this.count;d++){const p=d*this.data.stride+this.offset;for(let y=0;y<this.itemSize;y++)c.push(this.data.array[p+y])}return new Fi(new this.array.constructor(c),this.itemSize,this.normalized)}else return s.interleavedBuffers===void 0&&(s.interleavedBuffers={}),s.interleavedBuffers[this.data.uuid]===void 0&&(s.interleavedBuffers[this.data.uuid]=this.data.clone(s)),new Dh(s.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(s){if(s===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const c=[];for(let d=0;d<this.count;d++){const p=d*this.data.stride+this.offset;for(let y=0;y<this.itemSize;y++)c.push(this.data.array[p+y])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:c,normalized:this.normalized}}else return s.interleavedBuffers===void 0&&(s.interleavedBuffers={}),s.interleavedBuffers[this.data.uuid]===void 0&&(s.interleavedBuffers[this.data.uuid]=this.data.toJSON(s)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Aw extends cr{constructor(s){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new dn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.alphaMap=s.alphaMap,this.rotation=s.rotation,this.sizeAttenuation=s.sizeAttenuation,this.fog=s.fog,this}}let wd;const Dp=new de,bd=new de,Cd=new de,Ed=new gt,Op=new gt,FT=new $n,c0=new de,Fp=new de,l0=new de,kT=new gt,yw=new gt,NT=new gt;class UT extends bi{constructor(s){if(super(),this.isSprite=!0,this.type="Sprite",wd===void 0){wd=new si;const c=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),d=new a0(c,5);wd.setIndex([0,1,2,0,2,3]),wd.setAttribute("position",new Dh(d,3,0,!1)),wd.setAttribute("uv",new Dh(d,2,3,!1))}this.geometry=wd,this.material=s!==void 0?s:new Aw,this.center=new gt(.5,.5)}raycast(s,c){s.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),bd.setFromMatrixScale(this.matrixWorld),FT.copy(s.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(s.camera.matrixWorldInverse,this.matrixWorld),Cd.setFromMatrixPosition(this.modelViewMatrix),s.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&bd.multiplyScalar(-Cd.z);const d=this.material.rotation;let p,y;d!==0&&(y=Math.cos(d),p=Math.sin(d));const w=this.center;h0(c0.set(-.5,-.5,0),Cd,w,bd,p,y),h0(Fp.set(.5,-.5,0),Cd,w,bd,p,y),h0(l0.set(.5,.5,0),Cd,w,bd,p,y),kT.set(0,0),yw.set(1,0),NT.set(1,1);let E=s.ray.intersectTriangle(c0,Fp,l0,!1,Dp);if(E===null&&(h0(Fp.set(-.5,.5,0),Cd,w,bd,p,y),yw.set(0,1),E=s.ray.intersectTriangle(c0,l0,Fp,!1,Dp),E===null))return;const P=s.ray.origin.distanceTo(Dp);P<s.near||P>s.far||c.push({distance:P,point:Dp.clone(),uv:wo.getUV(Dp,c0,Fp,l0,kT,yw,NT,new gt),face:null,object:this})}copy(s,c){return super.copy(s,c),s.center!==void 0&&this.center.copy(s.center),this.material=s.material,this}}function h0(_,s,c,d,p,y){Ed.subVectors(_,c).addScalar(.5).multiply(d),p!==void 0?(Op.x=y*Ed.x-p*Ed.y,Op.y=p*Ed.x+y*Ed.y):Op.copy(Ed),_.copy(s),_.x+=Op.x,_.y+=Op.y,_.applyMatrix4(FT)}const u0=new de,zT=new de;class GT extends bi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(s){super.copy(s,!1);const c=s.levels;for(let d=0,p=c.length;d<p;d++){const y=c[d];this.addLevel(y.object.clone(),y.distance)}return this.autoUpdate=s.autoUpdate,this}addLevel(s,c=0){c=Math.abs(c);const d=this.levels;let p;for(p=0;p<d.length&&!(c<d[p].distance);p++);return d.splice(p,0,{distance:c,object:s}),this.add(s),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(s){const c=this.levels;if(c.length>0){let d,p;for(d=1,p=c.length;d<p&&!(s<c[d].distance);d++);return c[d-1].object}return null}raycast(s,c){if(this.levels.length>0){u0.setFromMatrixPosition(this.matrixWorld);const p=s.ray.origin.distanceTo(u0);this.getObjectForDistance(p).raycast(s,c)}}update(s){const c=this.levels;if(c.length>1){u0.setFromMatrixPosition(s.matrixWorld),zT.setFromMatrixPosition(this.matrixWorld);const d=u0.distanceTo(zT)/s.zoom;c[0].object.visible=!0;let p,y;for(p=1,y=c.length;p<y&&d>=c[p].distance;p++)c[p-1].object.visible=!1,c[p].object.visible=!0;for(this._currentLevel=p-1;p<y;p++)c[p].object.visible=!1}}toJSON(s){const c=super.toJSON(s);this.autoUpdate===!1&&(c.object.autoUpdate=!1),c.object.levels=[];const d=this.levels;for(let p=0,y=d.length;p<y;p++){const w=d[p];c.object.levels.push({object:w.object.uuid,distance:w.distance})}return c}}const HT=new de,VT=new Pi,WT=new Pi,Y4=new de,QT=new $n;class jT extends Js{constructor(s,c){super(s,c),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new $n,this.bindMatrixInverse=new $n}copy(s,c){return super.copy(s,c),this.bindMode=s.bindMode,this.bindMatrix.copy(s.bindMatrix),this.bindMatrixInverse.copy(s.bindMatrixInverse),this.skeleton=s.skeleton,this}bind(s,c){this.skeleton=s,c===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),c=this.matrixWorld),this.bindMatrix.copy(c),this.bindMatrixInverse.copy(c).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const s=new Pi,c=this.geometry.attributes.skinWeight;for(let d=0,p=c.count;d<p;d++){s.fromBufferAttribute(c,d);const y=1/s.manhattanLength();y!==1/0?s.multiplyScalar(y):s.set(1,0,0,0),c.setXYZW(d,s.x,s.y,s.z,s.w)}}updateMatrixWorld(s){super.updateMatrixWorld(s),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(s,c){const d=this.skeleton,p=this.geometry;VT.fromBufferAttribute(p.attributes.skinIndex,s),WT.fromBufferAttribute(p.attributes.skinWeight,s),HT.copy(c).applyMatrix4(this.bindMatrix),c.set(0,0,0);for(let y=0;y<4;y++){const w=WT.getComponent(y);if(w!==0){const E=VT.getComponent(y);QT.multiplyMatrices(d.bones[E].matrixWorld,d.boneInverses[E]),c.addScaledVector(Y4.copy(HT).applyMatrix4(QT),w)}}return c.applyMatrix4(this.bindMatrixInverse)}}class _w extends bi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Sd extends Rs{constructor(s=null,c=1,d=1,p,y,w,E,P,L=mt,O=mt,k,N){super(null,w,E,P,L,O,p,y,k,N),this.isDataTexture=!0,this.image={data:s,width:c,height:d},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const qT=new $n,J4=new $n;class d0{constructor(s=[],c=[]){this.uuid=Zr(),this.bones=s.slice(0),this.boneInverses=c,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const s=this.bones,c=this.boneInverses;if(this.boneMatrices=new Float32Array(s.length*16),c.length===0)this.calculateInverses();else if(s.length!==c.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let d=0,p=this.bones.length;d<p;d++)this.boneInverses.push(new $n)}}calculateInverses(){this.boneInverses.length=0;for(let s=0,c=this.bones.length;s<c;s++){const d=new $n;this.bones[s]&&d.copy(this.bones[s].matrixWorld).invert(),this.boneInverses.push(d)}}pose(){for(let s=0,c=this.bones.length;s<c;s++){const d=this.bones[s];d&&d.matrixWorld.copy(this.boneInverses[s]).invert()}for(let s=0,c=this.bones.length;s<c;s++){const d=this.bones[s];d&&(d.parent&&d.parent.isBone?(d.matrix.copy(d.parent.matrixWorld).invert(),d.matrix.multiply(d.matrixWorld)):d.matrix.copy(d.matrixWorld),d.matrix.decompose(d.position,d.quaternion,d.scale))}}update(){const s=this.bones,c=this.boneInverses,d=this.boneMatrices,p=this.boneTexture;for(let y=0,w=s.length;y<w;y++){const E=s[y]?s[y].matrixWorld:J4;qT.multiplyMatrices(E,c[y]),qT.toArray(d,y*16)}p!==null&&(p.needsUpdate=!0)}clone(){return new d0(this.bones,this.boneInverses)}computeBoneTexture(){let s=Math.sqrt(this.bones.length*4);s=G1(s),s=Math.max(s,4);const c=new Float32Array(s*s*4);c.set(this.boneMatrices);const d=new Sd(c,s,s,or,wn);return d.needsUpdate=!0,this.boneMatrices=c,this.boneTexture=d,this.boneTextureSize=s,this}getBoneByName(s){for(let c=0,d=this.bones.length;c<d;c++){const p=this.bones[c];if(p.name===s)return p}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(s,c){this.uuid=s.uuid;for(let d=0,p=s.bones.length;d<p;d++){const y=s.bones[d];let w=c[y];w===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",y),w=new _w),this.bones.push(w),this.boneInverses.push(new $n().fromArray(s.boneInverses[d]))}return this.init(),this}toJSON(){const s={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};s.uuid=this.uuid;const c=this.bones,d=this.boneInverses;for(let p=0,y=c.length;p<y;p++){const w=c[p];s.bones.push(w.uuid);const E=d[p];s.boneInverses.push(E.toArray())}return s}}class Md extends Fi{constructor(s,c,d,p=1){super(s,c,d),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=p}copy(s){return super.copy(s),this.meshPerAttribute=s.meshPerAttribute,this}toJSON(){const s=super.toJSON();return s.meshPerAttribute=this.meshPerAttribute,s.isInstancedBufferAttribute=!0,s}}const XT=new $n,YT=new $n,f0=[],kp=new Js;class JT extends Js{constructor(s,c,d){super(s,c),this.isInstancedMesh=!0,this.instanceMatrix=new Md(new Float32Array(d*16),16),this.instanceColor=null,this.count=d,this.frustumCulled=!1}copy(s,c){return super.copy(s,c),this.instanceMatrix.copy(s.instanceMatrix),s.instanceColor!==null&&(this.instanceColor=s.instanceColor.clone()),this.count=s.count,this}getColorAt(s,c){c.fromArray(this.instanceColor.array,s*3)}getMatrixAt(s,c){c.fromArray(this.instanceMatrix.array,s*16)}raycast(s,c){const d=this.matrixWorld,p=this.count;if(kp.geometry=this.geometry,kp.material=this.material,kp.material!==void 0)for(let y=0;y<p;y++){this.getMatrixAt(y,XT),YT.multiplyMatrices(d,XT),kp.matrixWorld=YT,kp.raycast(s,f0);for(let w=0,E=f0.length;w<E;w++){const P=f0[w];P.instanceId=y,P.object=this,c.push(P)}f0.length=0}}setColorAt(s,c){this.instanceColor===null&&(this.instanceColor=new Md(new Float32Array(this.instanceMatrix.count*3),3)),c.toArray(this.instanceColor.array,s*3)}setMatrixAt(s,c){c.toArray(this.instanceMatrix.array,s*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class br extends cr{constructor(s){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new dn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.linewidth=s.linewidth,this.linecap=s.linecap,this.linejoin=s.linejoin,this.fog=s.fog,this}}const KT=new de,ZT=new de,$T=new $n,vw=new Ip,p0=new Ph;class dl extends bi{constructor(s=new si,c=new br){super(),this.isLine=!0,this.type="Line",this.geometry=s,this.material=c,this.updateMorphTargets()}copy(s,c){return super.copy(s,c),this.material=s.material,this.geometry=s.geometry,this}computeLineDistances(){const s=this.geometry;if(s.index===null){const c=s.attributes.position,d=[0];for(let p=1,y=c.count;p<y;p++)KT.fromBufferAttribute(c,p-1),ZT.fromBufferAttribute(c,p),d[p]=d[p-1],d[p]+=KT.distanceTo(ZT);s.setAttribute("lineDistance",new An(d,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(s,c){const d=this.geometry,p=this.matrixWorld,y=s.params.Line.threshold,w=d.drawRange;if(d.boundingSphere===null&&d.computeBoundingSphere(),p0.copy(d.boundingSphere),p0.applyMatrix4(p),p0.radius+=y,s.ray.intersectsSphere(p0)===!1)return;$T.copy(p).invert(),vw.copy(s.ray).applyMatrix4($T);const E=y/((this.scale.x+this.scale.y+this.scale.z)/3),P=E*E,L=new de,O=new de,k=new de,N=new de,z=this.isLineSegments?2:1,V=d.index,G=d.attributes.position;if(V!==null){const X=Math.max(0,w.start),K=Math.min(V.count,w.start+w.count);for(let ne=X,te=K-1;ne<te;ne+=z){const oe=V.getX(ne),ue=V.getX(ne+1);if(L.fromBufferAttribute(G,oe),O.fromBufferAttribute(G,ue),vw.distanceSqToSegment(L,O,N,k)>P)continue;N.applyMatrix4(this.matrixWorld);const $=s.ray.origin.distanceTo(N);$<s.near||$>s.far||c.push({distance:$,point:k.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}}else{const X=Math.max(0,w.start),K=Math.min(G.count,w.start+w.count);for(let ne=X,te=K-1;ne<te;ne+=z){if(L.fromBufferAttribute(G,ne),O.fromBufferAttribute(G,ne+1),vw.distanceSqToSegment(L,O,N,k)>P)continue;N.applyMatrix4(this.matrixWorld);const ue=s.ray.origin.distanceTo(N);ue<s.near||ue>s.far||c.push({distance:ue,point:k.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const c=this.geometry.morphAttributes,d=Object.keys(c);if(d.length>0){const p=c[d[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let y=0,w=p.length;y<w;y++){const E=p[y].name||String(y);this.morphTargetInfluences.push(0),this.morphTargetDictionary[E]=y}}}}}const eI=new de,tI=new de;class Sa extends dl{constructor(s,c){super(s,c),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const s=this.geometry;if(s.index===null){const c=s.attributes.position,d=[];for(let p=0,y=c.count;p<y;p+=2)eI.fromBufferAttribute(c,p),tI.fromBufferAttribute(c,p+1),d[p]=p===0?0:d[p-1],d[p+1]=d[p]+eI.distanceTo(tI);s.setAttribute("lineDistance",new An(d,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class nI extends dl{constructor(s,c){super(s,c),this.isLineLoop=!0,this.type="LineLoop"}}class xw extends cr{constructor(s){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new dn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.alphaMap=s.alphaMap,this.size=s.size,this.sizeAttenuation=s.sizeAttenuation,this.fog=s.fog,this}}const iI=new $n,ww=new Ip,m0=new Ph,g0=new de;class sI extends bi{constructor(s=new si,c=new xw){super(),this.isPoints=!0,this.type="Points",this.geometry=s,this.material=c,this.updateMorphTargets()}copy(s,c){return super.copy(s,c),this.material=s.material,this.geometry=s.geometry,this}raycast(s,c){const d=this.geometry,p=this.matrixWorld,y=s.params.Points.threshold,w=d.drawRange;if(d.boundingSphere===null&&d.computeBoundingSphere(),m0.copy(d.boundingSphere),m0.applyMatrix4(p),m0.radius+=y,s.ray.intersectsSphere(m0)===!1)return;iI.copy(p).invert(),ww.copy(s.ray).applyMatrix4(iI);const E=y/((this.scale.x+this.scale.y+this.scale.z)/3),P=E*E,L=d.index,k=d.attributes.position;if(L!==null){const N=Math.max(0,w.start),z=Math.min(L.count,w.start+w.count);for(let V=N,H=z;V<H;V++){const G=L.getX(V);g0.fromBufferAttribute(k,G),rI(g0,G,P,p,s,c,this)}}else{const N=Math.max(0,w.start),z=Math.min(k.count,w.start+w.count);for(let V=N,H=z;V<H;V++)g0.fromBufferAttribute(k,V),rI(g0,V,P,p,s,c,this)}}updateMorphTargets(){const c=this.geometry.morphAttributes,d=Object.keys(c);if(d.length>0){const p=c[d[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let y=0,w=p.length;y<w;y++){const E=p[y].name||String(y);this.morphTargetInfluences.push(0),this.morphTargetDictionary[E]=y}}}}}function rI(_,s,c,d,p,y,w){const E=ww.distanceSqToPoint(_);if(E<c){const P=new de;ww.closestPointToPoint(_,P),P.applyMatrix4(d);const L=p.ray.origin.distanceTo(P);if(L<p.near||L>p.far)return;y.push({distance:L,distanceToRay:Math.sqrt(E),point:P,index:s,face:null,object:w})}}class K4 extends Rs{constructor(s,c,d,p,y,w,E,P,L){super(s,c,d,p,y,w,E,P,L),this.isVideoTexture=!0,this.minFilter=w!==void 0?w:Et,this.magFilter=y!==void 0?y:Et,this.generateMipmaps=!1;const O=this;function k(){O.needsUpdate=!0,s.requestVideoFrameCallback(k)}"requestVideoFrameCallback"in s&&s.requestVideoFrameCallback(k)}clone(){return new this.constructor(this.image).copy(this)}update(){const s=this.image;"requestVideoFrameCallback"in s===!1&&s.readyState>=s.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Z4 extends Rs{constructor(s,c,d){super({width:s,height:c}),this.isFramebufferTexture=!0,this.format=d,this.magFilter=mt,this.minFilter=mt,this.generateMipmaps=!1,this.needsUpdate=!0}}class oI extends Rs{constructor(s,c,d,p,y,w,E,P,L,O,k,N){super(null,w,E,P,L,O,p,y,k,N),this.isCompressedTexture=!0,this.image={width:c,height:d},this.mipmaps=s,this.flipY=!1,this.generateMipmaps=!1}}class $4 extends Rs{constructor(s,c,d,p,y,w,E,P,L){super(s,c,d,p,y,w,E,P,L),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ko{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(s,c){const d=this.getUtoTmapping(s);return this.getPoint(d,c)}getPoints(s=5){const c=[];for(let d=0;d<=s;d++)c.push(this.getPoint(d/s));return c}getSpacedPoints(s=5){const c=[];for(let d=0;d<=s;d++)c.push(this.getPointAt(d/s));return c}getLength(){const s=this.getLengths();return s[s.length-1]}getLengths(s=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===s+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const c=[];let d,p=this.getPoint(0),y=0;c.push(0);for(let w=1;w<=s;w++)d=this.getPoint(w/s),y+=d.distanceTo(p),c.push(y),p=d;return this.cacheArcLengths=c,c}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(s,c){const d=this.getLengths();let p=0;const y=d.length;let w;c?w=c:w=s*d[y-1];let E=0,P=y-1,L;for(;E<=P;)if(p=Math.floor(E+(P-E)/2),L=d[p]-w,L<0)E=p+1;else if(L>0)P=p-1;else{P=p;break}if(p=P,d[p]===w)return p/(y-1);const O=d[p],N=d[p+1]-O,z=(w-O)/N;return(p+z)/(y-1)}getTangent(s,c){let p=s-1e-4,y=s+1e-4;p<0&&(p=0),y>1&&(y=1);const w=this.getPoint(p),E=this.getPoint(y),P=c||(w.isVector2?new gt:new de);return P.copy(E).sub(w).normalize(),P}getTangentAt(s,c){const d=this.getUtoTmapping(s);return this.getTangent(d,c)}computeFrenetFrames(s,c){const d=new de,p=[],y=[],w=[],E=new de,P=new $n;for(let z=0;z<=s;z++){const V=z/s;p[z]=this.getTangentAt(V,new de)}y[0]=new de,w[0]=new de;let L=Number.MAX_VALUE;const O=Math.abs(p[0].x),k=Math.abs(p[0].y),N=Math.abs(p[0].z);O<=L&&(L=O,d.set(1,0,0)),k<=L&&(L=k,d.set(0,1,0)),N<=L&&d.set(0,0,1),E.crossVectors(p[0],d).normalize(),y[0].crossVectors(p[0],E),w[0].crossVectors(p[0],y[0]);for(let z=1;z<=s;z++){if(y[z]=y[z-1].clone(),w[z]=w[z-1].clone(),E.crossVectors(p[z-1],p[z]),E.length()>Number.EPSILON){E.normalize();const V=Math.acos(fs(p[z-1].dot(p[z]),-1,1));y[z].applyMatrix4(P.makeRotationAxis(E,V))}w[z].crossVectors(p[z],y[z])}if(c===!0){let z=Math.acos(fs(y[0].dot(y[s]),-1,1));z/=s,p[0].dot(E.crossVectors(y[0],y[s]))>0&&(z=-z);for(let V=1;V<=s;V++)y[V].applyMatrix4(P.makeRotationAxis(p[V],z*V)),w[V].crossVectors(p[V],y[V])}return{tangents:p,normals:y,binormals:w}}clone(){return new this.constructor().copy(this)}copy(s){return this.arcLengthDivisions=s.arcLengthDivisions,this}toJSON(){const s={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return s.arcLengthDivisions=this.arcLengthDivisions,s.type=this.type,s}fromJSON(s){return this.arcLengthDivisions=s.arcLengthDivisions,this}}class A0 extends Ko{constructor(s=0,c=0,d=1,p=1,y=0,w=Math.PI*2,E=!1,P=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=s,this.aY=c,this.xRadius=d,this.yRadius=p,this.aStartAngle=y,this.aEndAngle=w,this.aClockwise=E,this.aRotation=P}getPoint(s,c){const d=c||new gt,p=Math.PI*2;let y=this.aEndAngle-this.aStartAngle;const w=Math.abs(y)<Number.EPSILON;for(;y<0;)y+=p;for(;y>p;)y-=p;y<Number.EPSILON&&(w?y=0:y=p),this.aClockwise===!0&&!w&&(y===p?y=-p:y=y-p);const E=this.aStartAngle+s*y;let P=this.aX+this.xRadius*Math.cos(E),L=this.aY+this.yRadius*Math.sin(E);if(this.aRotation!==0){const O=Math.cos(this.aRotation),k=Math.sin(this.aRotation),N=P-this.aX,z=L-this.aY;P=N*O-z*k+this.aX,L=N*k+z*O+this.aY}return d.set(P,L)}copy(s){return super.copy(s),this.aX=s.aX,this.aY=s.aY,this.xRadius=s.xRadius,this.yRadius=s.yRadius,this.aStartAngle=s.aStartAngle,this.aEndAngle=s.aEndAngle,this.aClockwise=s.aClockwise,this.aRotation=s.aRotation,this}toJSON(){const s=super.toJSON();return s.aX=this.aX,s.aY=this.aY,s.xRadius=this.xRadius,s.yRadius=this.yRadius,s.aStartAngle=this.aStartAngle,s.aEndAngle=this.aEndAngle,s.aClockwise=this.aClockwise,s.aRotation=this.aRotation,s}fromJSON(s){return super.fromJSON(s),this.aX=s.aX,this.aY=s.aY,this.xRadius=s.xRadius,this.yRadius=s.yRadius,this.aStartAngle=s.aStartAngle,this.aEndAngle=s.aEndAngle,this.aClockwise=s.aClockwise,this.aRotation=s.aRotation,this}}class aI extends A0{constructor(s,c,d,p,y,w){super(s,c,d,d,p,y,w),this.isArcCurve=!0,this.type="ArcCurve"}}function bw(){let _=0,s=0,c=0,d=0;function p(y,w,E,P){_=y,s=E,c=-3*y+3*w-2*E-P,d=2*y-2*w+E+P}return{initCatmullRom:function(y,w,E,P,L){p(w,E,L*(E-y),L*(P-w))},initNonuniformCatmullRom:function(y,w,E,P,L,O,k){let N=(w-y)/L-(E-y)/(L+O)+(E-w)/O,z=(E-w)/O-(P-w)/(O+k)+(P-E)/k;N*=O,z*=O,p(w,E,N,z)},calc:function(y){const w=y*y,E=w*y;return _+s*y+c*w+d*E}}}const y0=new de,Cw=new bw,Ew=new bw,Sw=new bw;class cI extends Ko{constructor(s=[],c=!1,d="centripetal",p=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=s,this.closed=c,this.curveType=d,this.tension=p}getPoint(s,c=new de){const d=c,p=this.points,y=p.length,w=(y-(this.closed?0:1))*s;let E=Math.floor(w),P=w-E;this.closed?E+=E>0?0:(Math.floor(Math.abs(E)/y)+1)*y:P===0&&E===y-1&&(E=y-2,P=1);let L,O;this.closed||E>0?L=p[(E-1)%y]:(y0.subVectors(p[0],p[1]).add(p[0]),L=y0);const k=p[E%y],N=p[(E+1)%y];if(this.closed||E+2<y?O=p[(E+2)%y]:(y0.subVectors(p[y-1],p[y-2]).add(p[y-1]),O=y0),this.curveType==="centripetal"||this.curveType==="chordal"){const z=this.curveType==="chordal"?.5:.25;let V=Math.pow(L.distanceToSquared(k),z),H=Math.pow(k.distanceToSquared(N),z),G=Math.pow(N.distanceToSquared(O),z);H<1e-4&&(H=1),V<1e-4&&(V=H),G<1e-4&&(G=H),Cw.initNonuniformCatmullRom(L.x,k.x,N.x,O.x,V,H,G),Ew.initNonuniformCatmullRom(L.y,k.y,N.y,O.y,V,H,G),Sw.initNonuniformCatmullRom(L.z,k.z,N.z,O.z,V,H,G)}else this.curveType==="catmullrom"&&(Cw.initCatmullRom(L.x,k.x,N.x,O.x,this.tension),Ew.initCatmullRom(L.y,k.y,N.y,O.y,this.tension),Sw.initCatmullRom(L.z,k.z,N.z,O.z,this.tension));return d.set(Cw.calc(P),Ew.calc(P),Sw.calc(P)),d}copy(s){super.copy(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(p.clone())}return this.closed=s.closed,this.curveType=s.curveType,this.tension=s.tension,this}toJSON(){const s=super.toJSON();s.points=[];for(let c=0,d=this.points.length;c<d;c++){const p=this.points[c];s.points.push(p.toArray())}return s.closed=this.closed,s.curveType=this.curveType,s.tension=this.tension,s}fromJSON(s){super.fromJSON(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(new de().fromArray(p))}return this.closed=s.closed,this.curveType=s.curveType,this.tension=s.tension,this}}function lI(_,s,c,d,p){const y=(d-s)*.5,w=(p-c)*.5,E=_*_,P=_*E;return(2*c-2*d+y+w)*P+(-3*c+3*d-2*y-w)*E+y*_+c}function eH(_,s){const c=1-_;return c*c*s}function tH(_,s){return 2*(1-_)*_*s}function nH(_,s){return _*_*s}function Np(_,s,c,d){return eH(_,s)+tH(_,c)+nH(_,d)}function iH(_,s){const c=1-_;return c*c*c*s}function sH(_,s){const c=1-_;return 3*c*c*_*s}function rH(_,s){return 3*(1-_)*_*_*s}function oH(_,s){return _*_*_*s}function Up(_,s,c,d,p){return iH(_,s)+sH(_,c)+rH(_,d)+oH(_,p)}class Mw extends Ko{constructor(s=new gt,c=new gt,d=new gt,p=new gt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=s,this.v1=c,this.v2=d,this.v3=p}getPoint(s,c=new gt){const d=c,p=this.v0,y=this.v1,w=this.v2,E=this.v3;return d.set(Up(s,p.x,y.x,w.x,E.x),Up(s,p.y,y.y,w.y,E.y)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this.v3.copy(s.v3),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s.v3=this.v3.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this.v3.fromArray(s.v3),this}}class hI extends Ko{constructor(s=new de,c=new de,d=new de,p=new de){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=s,this.v1=c,this.v2=d,this.v3=p}getPoint(s,c=new de){const d=c,p=this.v0,y=this.v1,w=this.v2,E=this.v3;return d.set(Up(s,p.x,y.x,w.x,E.x),Up(s,p.y,y.y,w.y,E.y),Up(s,p.z,y.z,w.z,E.z)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this.v3.copy(s.v3),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s.v3=this.v3.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this.v3.fromArray(s.v3),this}}class _0 extends Ko{constructor(s=new gt,c=new gt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=s,this.v2=c}getPoint(s,c=new gt){const d=c;return s===1?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(s).add(this.v1)),d}getPointAt(s,c){return this.getPoint(s,c)}getTangent(s,c){const d=c||new gt;return d.copy(this.v2).sub(this.v1).normalize(),d}copy(s){return super.copy(s),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class uI extends Ko{constructor(s=new de,c=new de){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=s,this.v2=c}getPoint(s,c=new de){const d=c;return s===1?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(s).add(this.v1)),d}getPointAt(s,c){return this.getPoint(s,c)}copy(s){return super.copy(s),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class Tw extends Ko{constructor(s=new gt,c=new gt,d=new gt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=s,this.v1=c,this.v2=d}getPoint(s,c=new gt){const d=c,p=this.v0,y=this.v1,w=this.v2;return d.set(Np(s,p.x,y.x,w.x),Np(s,p.y,y.y,w.y)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class Iw extends Ko{constructor(s=new de,c=new de,d=new de){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=s,this.v1=c,this.v2=d}getPoint(s,c=new de){const d=c,p=this.v0,y=this.v1,w=this.v2;return d.set(Np(s,p.x,y.x,w.x),Np(s,p.y,y.y,w.y),Np(s,p.z,y.z,w.z)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class Rw extends Ko{constructor(s=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=s}getPoint(s,c=new gt){const d=c,p=this.points,y=(p.length-1)*s,w=Math.floor(y),E=y-w,P=p[w===0?w:w-1],L=p[w],O=p[w>p.length-2?p.length-1:w+1],k=p[w>p.length-3?p.length-1:w+2];return d.set(lI(E,P.x,L.x,O.x,k.x),lI(E,P.y,L.y,O.y,k.y)),d}copy(s){super.copy(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(p.clone())}return this}toJSON(){const s=super.toJSON();s.points=[];for(let c=0,d=this.points.length;c<d;c++){const p=this.points[c];s.points.push(p.toArray())}return s}fromJSON(s){super.fromJSON(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(new gt().fromArray(p))}return this}}var Pw=Object.freeze({__proto__:null,ArcCurve:aI,CatmullRomCurve3:cI,CubicBezierCurve:Mw,CubicBezierCurve3:hI,EllipseCurve:A0,LineCurve:_0,LineCurve3:uI,QuadraticBezierCurve:Tw,QuadraticBezierCurve3:Iw,SplineCurve:Rw});class dI extends Ko{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(s){this.curves.push(s)}closePath(){const s=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);s.equals(c)||this.curves.push(new _0(c,s))}getPoint(s,c){const d=s*this.getLength(),p=this.getCurveLengths();let y=0;for(;y<p.length;){if(p[y]>=d){const w=p[y]-d,E=this.curves[y],P=E.getLength(),L=P===0?0:1-w/P;return E.getPointAt(L,c)}y++}return null}getLength(){const s=this.getCurveLengths();return s[s.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const s=[];let c=0;for(let d=0,p=this.curves.length;d<p;d++)c+=this.curves[d].getLength(),s.push(c);return this.cacheLengths=s,s}getSpacedPoints(s=40){const c=[];for(let d=0;d<=s;d++)c.push(this.getPoint(d/s));return this.autoClose&&c.push(c[0]),c}getPoints(s=12){const c=[];let d;for(let p=0,y=this.curves;p<y.length;p++){const w=y[p],E=w.isEllipseCurve?s*2:w.isLineCurve||w.isLineCurve3?1:w.isSplineCurve?s*w.points.length:s,P=w.getPoints(E);for(let L=0;L<P.length;L++){const O=P[L];d&&d.equals(O)||(c.push(O),d=O)}}return this.autoClose&&c.length>1&&!c[c.length-1].equals(c[0])&&c.push(c[0]),c}copy(s){super.copy(s),this.curves=[];for(let c=0,d=s.curves.length;c<d;c++){const p=s.curves[c];this.curves.push(p.clone())}return this.autoClose=s.autoClose,this}toJSON(){const s=super.toJSON();s.autoClose=this.autoClose,s.curves=[];for(let c=0,d=this.curves.length;c<d;c++){const p=this.curves[c];s.curves.push(p.toJSON())}return s}fromJSON(s){super.fromJSON(s),this.autoClose=s.autoClose,this.curves=[];for(let c=0,d=s.curves.length;c<d;c++){const p=s.curves[c];this.curves.push(new Pw[p.type]().fromJSON(p))}return this}}class zp extends dI{constructor(s){super(),this.type="Path",this.currentPoint=new gt,s&&this.setFromPoints(s)}setFromPoints(s){this.moveTo(s[0].x,s[0].y);for(let c=1,d=s.length;c<d;c++)this.lineTo(s[c].x,s[c].y);return this}moveTo(s,c){return this.currentPoint.set(s,c),this}lineTo(s,c){const d=new _0(this.currentPoint.clone(),new gt(s,c));return this.curves.push(d),this.currentPoint.set(s,c),this}quadraticCurveTo(s,c,d,p){const y=new Tw(this.currentPoint.clone(),new gt(s,c),new gt(d,p));return this.curves.push(y),this.currentPoint.set(d,p),this}bezierCurveTo(s,c,d,p,y,w){const E=new Mw(this.currentPoint.clone(),new gt(s,c),new gt(d,p),new gt(y,w));return this.curves.push(E),this.currentPoint.set(y,w),this}splineThru(s){const c=[this.currentPoint.clone()].concat(s),d=new Rw(c);return this.curves.push(d),this.currentPoint.copy(s[s.length-1]),this}arc(s,c,d,p,y,w){const E=this.currentPoint.x,P=this.currentPoint.y;return this.absarc(s+E,c+P,d,p,y,w),this}absarc(s,c,d,p,y,w){return this.absellipse(s,c,d,d,p,y,w),this}ellipse(s,c,d,p,y,w,E,P){const L=this.currentPoint.x,O=this.currentPoint.y;return this.absellipse(s+L,c+O,d,p,y,w,E,P),this}absellipse(s,c,d,p,y,w,E,P){const L=new A0(s,c,d,p,y,w,E,P);if(this.curves.length>0){const k=L.getPoint(0);k.equals(this.currentPoint)||this.lineTo(k.x,k.y)}this.curves.push(L);const O=L.getPoint(1);return this.currentPoint.copy(O),this}copy(s){return super.copy(s),this.currentPoint.copy(s.currentPoint),this}toJSON(){const s=super.toJSON();return s.currentPoint=this.currentPoint.toArray(),s}fromJSON(s){return super.fromJSON(s),this.currentPoint.fromArray(s.currentPoint),this}}class Td extends si{constructor(s=[new gt(0,-.5),new gt(.5,0),new gt(0,.5)],c=12,d=0,p=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:s,segments:c,phiStart:d,phiLength:p},c=Math.floor(c),p=fs(p,0,Math.PI*2);const y=[],w=[],E=[],P=[],L=[],O=1/c,k=new de,N=new gt,z=new de,V=new de,H=new de;let G=0,X=0;for(let K=0;K<=s.length-1;K++)switch(K){case 0:G=s[K+1].x-s[K].x,X=s[K+1].y-s[K].y,z.x=X*1,z.y=-G,z.z=X*0,H.copy(z),z.normalize(),P.push(z.x,z.y,z.z);break;case s.length-1:P.push(H.x,H.y,H.z);break;default:G=s[K+1].x-s[K].x,X=s[K+1].y-s[K].y,z.x=X*1,z.y=-G,z.z=X*0,V.copy(z),z.x+=H.x,z.y+=H.y,z.z+=H.z,z.normalize(),P.push(z.x,z.y,z.z),H.copy(V)}for(let K=0;K<=c;K++){const ne=d+K*O*p,te=Math.sin(ne),oe=Math.cos(ne);for(let ue=0;ue<=s.length-1;ue++){k.x=s[ue].x*te,k.y=s[ue].y,k.z=s[ue].x*oe,w.push(k.x,k.y,k.z),N.x=K/c,N.y=ue/(s.length-1),E.push(N.x,N.y);const Ce=P[3*ue+0]*te,$=P[3*ue+1],ge=P[3*ue+0]*oe;L.push(Ce,$,ge)}}for(let K=0;K<c;K++)for(let ne=0;ne<s.length-1;ne++){const te=ne+K*s.length,oe=te,ue=te+s.length,Ce=te+s.length+1,$=te+1;y.push(oe,ue,$),y.push(Ce,$,ue)}this.setIndex(y),this.setAttribute("position",new An(w,3)),this.setAttribute("uv",new An(E,2)),this.setAttribute("normal",new An(L,3))}static fromJSON(s){return new Td(s.points,s.segments,s.phiStart,s.phiLength)}}class Gp extends Td{constructor(s=1,c=1,d=4,p=8){const y=new zp;y.absarc(0,-c/2,s,Math.PI*1.5,0),y.absarc(0,c/2,s,0,Math.PI*.5),super(y.getPoints(d),p),this.type="CapsuleGeometry",this.parameters={radius:s,height:c,capSegments:d,radialSegments:p}}static fromJSON(s){return new Gp(s.radius,s.length,s.capSegments,s.radialSegments)}}class Hp extends si{constructor(s=1,c=8,d=0,p=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:s,segments:c,thetaStart:d,thetaLength:p},c=Math.max(3,c);const y=[],w=[],E=[],P=[],L=new de,O=new gt;w.push(0,0,0),E.push(0,0,1),P.push(.5,.5);for(let k=0,N=3;k<=c;k++,N+=3){const z=d+k/c*p;L.x=s*Math.cos(z),L.y=s*Math.sin(z),w.push(L.x,L.y,L.z),E.push(0,0,1),O.x=(w[N]/s+1)/2,O.y=(w[N+1]/s+1)/2,P.push(O.x,O.y)}for(let k=1;k<=c;k++)y.push(k,k+1,0);this.setIndex(y),this.setAttribute("position",new An(w,3)),this.setAttribute("normal",new An(E,3)),this.setAttribute("uv",new An(P,2))}static fromJSON(s){return new Hp(s.radius,s.segments,s.thetaStart,s.thetaLength)}}class Oh extends si{constructor(s=1,c=1,d=1,p=8,y=1,w=!1,E=0,P=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:s,radiusBottom:c,height:d,radialSegments:p,heightSegments:y,openEnded:w,thetaStart:E,thetaLength:P};const L=this;p=Math.floor(p),y=Math.floor(y);const O=[],k=[],N=[],z=[];let V=0;const H=[],G=d/2;let X=0;K(),w===!1&&(s>0&&ne(!0),c>0&&ne(!1)),this.setIndex(O),this.setAttribute("position",new An(k,3)),this.setAttribute("normal",new An(N,3)),this.setAttribute("uv",new An(z,2));function K(){const te=new de,oe=new de;let ue=0;const Ce=(c-s)/d;for(let $=0;$<=y;$++){const ge=[],Te=$/y,et=Te*(c-s)+s;for(let It=0;It<=p;It++){const Ye=It/p,Fe=Ye*P+E,rt=Math.sin(Fe),At=Math.cos(Fe);oe.x=et*rt,oe.y=-Te*d+G,oe.z=et*At,k.push(oe.x,oe.y,oe.z),te.set(rt,Ce,At).normalize(),N.push(te.x,te.y,te.z),z.push(Ye,1-Te),ge.push(V++)}H.push(ge)}for(let $=0;$<p;$++)for(let ge=0;ge<y;ge++){const Te=H[ge][$],et=H[ge+1][$],It=H[ge+1][$+1],Ye=H[ge][$+1];O.push(Te,et,Ye),O.push(et,It,Ye),ue+=6}L.addGroup(X,ue,0),X+=ue}function ne(te){const oe=V,ue=new gt,Ce=new de;let $=0;const ge=te===!0?s:c,Te=te===!0?1:-1;for(let It=1;It<=p;It++)k.push(0,G*Te,0),N.push(0,Te,0),z.push(.5,.5),V++;const et=V;for(let It=0;It<=p;It++){const Fe=It/p*P+E,rt=Math.cos(Fe),At=Math.sin(Fe);Ce.x=ge*At,Ce.y=G*Te,Ce.z=ge*rt,k.push(Ce.x,Ce.y,Ce.z),N.push(0,Te,0),ue.x=rt*.5+.5,ue.y=At*.5*Te+.5,z.push(ue.x,ue.y),V++}for(let It=0;It<p;It++){const Ye=oe+It,Fe=et+It;te===!0?O.push(Fe,Fe+1,Ye):O.push(Fe+1,Fe,Ye),$+=3}L.addGroup(X,$,te===!0?1:2),X+=$}}static fromJSON(s){return new Oh(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength)}}class Vp extends Oh{constructor(s=1,c=1,d=8,p=1,y=!1,w=0,E=Math.PI*2){super(0,s,c,d,p,y,w,E),this.type="ConeGeometry",this.parameters={radius:s,height:c,radialSegments:d,heightSegments:p,openEnded:y,thetaStart:w,thetaLength:E}}static fromJSON(s){return new Vp(s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength)}}class mc extends si{constructor(s=[],c=[],d=1,p=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:s,indices:c,radius:d,detail:p};const y=[],w=[];E(p),L(d),O(),this.setAttribute("position",new An(y,3)),this.setAttribute("normal",new An(y.slice(),3)),this.setAttribute("uv",new An(w,2)),p===0?this.computeVertexNormals():this.normalizeNormals();function E(K){const ne=new de,te=new de,oe=new de;for(let ue=0;ue<c.length;ue+=3)z(c[ue+0],ne),z(c[ue+1],te),z(c[ue+2],oe),P(ne,te,oe,K)}function P(K,ne,te,oe){const ue=oe+1,Ce=[];for(let $=0;$<=ue;$++){Ce[$]=[];const ge=K.clone().lerp(te,$/ue),Te=ne.clone().lerp(te,$/ue),et=ue-$;for(let It=0;It<=et;It++)It===0&&$===ue?Ce[$][It]=ge:Ce[$][It]=ge.clone().lerp(Te,It/et)}for(let $=0;$<ue;$++)for(let ge=0;ge<2*(ue-$)-1;ge++){const Te=Math.floor(ge/2);ge%2===0?(N(Ce[$][Te+1]),N(Ce[$+1][Te]),N(Ce[$][Te])):(N(Ce[$][Te+1]),N(Ce[$+1][Te+1]),N(Ce[$+1][Te]))}}function L(K){const ne=new de;for(let te=0;te<y.length;te+=3)ne.x=y[te+0],ne.y=y[te+1],ne.z=y[te+2],ne.normalize().multiplyScalar(K),y[te+0]=ne.x,y[te+1]=ne.y,y[te+2]=ne.z}function O(){const K=new de;for(let ne=0;ne<y.length;ne+=3){K.x=y[ne+0],K.y=y[ne+1],K.z=y[ne+2];const te=G(K)/2/Math.PI+.5,oe=X(K)/Math.PI+.5;w.push(te,1-oe)}V(),k()}function k(){for(let K=0;K<w.length;K+=6){const ne=w[K+0],te=w[K+2],oe=w[K+4],ue=Math.max(ne,te,oe),Ce=Math.min(ne,te,oe);ue>.9&&Ce<.1&&(ne<.2&&(w[K+0]+=1),te<.2&&(w[K+2]+=1),oe<.2&&(w[K+4]+=1))}}function N(K){y.push(K.x,K.y,K.z)}function z(K,ne){const te=K*3;ne.x=s[te+0],ne.y=s[te+1],ne.z=s[te+2]}function V(){const K=new de,ne=new de,te=new de,oe=new de,ue=new gt,Ce=new gt,$=new gt;for(let ge=0,Te=0;ge<y.length;ge+=9,Te+=6){K.set(y[ge+0],y[ge+1],y[ge+2]),ne.set(y[ge+3],y[ge+4],y[ge+5]),te.set(y[ge+6],y[ge+7],y[ge+8]),ue.set(w[Te+0],w[Te+1]),Ce.set(w[Te+2],w[Te+3]),$.set(w[Te+4],w[Te+5]),oe.copy(K).add(ne).add(te).divideScalar(3);const et=G(oe);H(ue,Te+0,K,et),H(Ce,Te+2,ne,et),H($,Te+4,te,et)}}function H(K,ne,te,oe){oe<0&&K.x===1&&(w[ne]=K.x-1),te.x===0&&te.z===0&&(w[ne]=oe/2/Math.PI+.5)}function G(K){return Math.atan2(K.z,-K.x)}function X(K){return Math.atan2(-K.y,Math.sqrt(K.x*K.x+K.z*K.z))}}static fromJSON(s){return new mc(s.vertices,s.indices,s.radius,s.details)}}class Wp extends mc{constructor(s=1,c=0){const d=(1+Math.sqrt(5))/2,p=1/d,y=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-p,-d,0,-p,d,0,p,-d,0,p,d,-p,-d,0,-p,d,0,p,-d,0,p,d,0,-d,0,-p,d,0,-p,-d,0,p,d,0,p],w=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(y,w,s,c),this.type="DodecahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Wp(s.radius,s.detail)}}const v0=new de,x0=new de,Bw=new de,w0=new wo;class fI extends si{constructor(s=null,c=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:s,thresholdAngle:c},s!==null){const p=Math.pow(10,4),y=Math.cos(Ch*c),w=s.getIndex(),E=s.getAttribute("position"),P=w?w.count:E.count,L=[0,0,0],O=["a","b","c"],k=new Array(3),N={},z=[];for(let V=0;V<P;V+=3){w?(L[0]=w.getX(V),L[1]=w.getX(V+1),L[2]=w.getX(V+2)):(L[0]=V,L[1]=V+1,L[2]=V+2);const{a:H,b:G,c:X}=w0;if(H.fromBufferAttribute(E,L[0]),G.fromBufferAttribute(E,L[1]),X.fromBufferAttribute(E,L[2]),w0.getNormal(Bw),k[0]=`${Math.round(H.x*p)},${Math.round(H.y*p)},${Math.round(H.z*p)}`,k[1]=`${Math.round(G.x*p)},${Math.round(G.y*p)},${Math.round(G.z*p)}`,k[2]=`${Math.round(X.x*p)},${Math.round(X.y*p)},${Math.round(X.z*p)}`,!(k[0]===k[1]||k[1]===k[2]||k[2]===k[0]))for(let K=0;K<3;K++){const ne=(K+1)%3,te=k[K],oe=k[ne],ue=w0[O[K]],Ce=w0[O[ne]],$=`${te}_${oe}`,ge=`${oe}_${te}`;ge in N&&N[ge]?(Bw.dot(N[ge].normal)<=y&&(z.push(ue.x,ue.y,ue.z),z.push(Ce.x,Ce.y,Ce.z)),N[ge]=null):$ in N||(N[$]={index0:L[K],index1:L[ne],normal:Bw.clone()})}}for(const V in N)if(N[V]){const{index0:H,index1:G}=N[V];v0.fromBufferAttribute(E,H),x0.fromBufferAttribute(E,G),z.push(v0.x,v0.y,v0.z),z.push(x0.x,x0.y,x0.z)}this.setAttribute("position",new An(z,3))}}}class Fh extends zp{constructor(s){super(s),this.uuid=Zr(),this.type="Shape",this.holes=[]}getPointsHoles(s){const c=[];for(let d=0,p=this.holes.length;d<p;d++)c[d]=this.holes[d].getPoints(s);return c}extractPoints(s){return{shape:this.getPoints(s),holes:this.getPointsHoles(s)}}copy(s){super.copy(s),this.holes=[];for(let c=0,d=s.holes.length;c<d;c++){const p=s.holes[c];this.holes.push(p.clone())}return this}toJSON(){const s=super.toJSON();s.uuid=this.uuid,s.holes=[];for(let c=0,d=this.holes.length;c<d;c++){const p=this.holes[c];s.holes.push(p.toJSON())}return s}fromJSON(s){super.fromJSON(s),this.uuid=s.uuid,this.holes=[];for(let c=0,d=s.holes.length;c<d;c++){const p=s.holes[c];this.holes.push(new zp().fromJSON(p))}return this}}const aH={triangulate:function(_,s,c=2){const d=s&&s.length,p=d?s[0]*c:_.length;let y=pI(_,0,p,c,!0);const w=[];if(!y||y.next===y.prev)return w;let E,P,L,O,k,N,z;if(d&&(y=dH(_,s,y,c)),_.length>80*c){E=L=_[0],P=O=_[1];for(let V=c;V<p;V+=c)k=_[V],N=_[V+1],k<E&&(E=k),N<P&&(P=N),k>L&&(L=k),N>O&&(O=N);z=Math.max(L-E,O-P),z=z!==0?1/z:0}return Qp(y,w,c,E,P,z),w}};function pI(_,s,c,d,p){let y,w;if(p===bH(_,s,c,d)>0)for(y=s;y<c;y+=d)w=AI(y,_[y],_[y+1],w);else for(y=c-d;y>=s;y-=d)w=AI(y,_[y],_[y+1],w);return w&&b0(w,w.next)&&(qp(w),w=w.next),w}function fl(_,s){if(!_)return _;s||(s=_);let c=_,d;do if(d=!1,!c.steiner&&(b0(c,c.next)||ts(c.prev,c,c.next)===0)){if(qp(c),c=s=c.prev,c===c.next)break;d=!0}else c=c.next;while(d||c!==s);return s}function Qp(_,s,c,d,p,y,w){if(!_)return;!w&&y&&AH(_,d,p,y);let E=_,P,L;for(;_.prev!==_.next;){if(P=_.prev,L=_.next,y?lH(_,d,p,y):cH(_)){s.push(P.i/c),s.push(_.i/c),s.push(L.i/c),qp(_),_=L.next,E=L.next;continue}if(_=L,_===E){w?w===1?(_=hH(fl(_),s,c),Qp(_,s,c,d,p,y,2)):w===2&&uH(_,s,c,d,p,y):Qp(fl(_),s,c,d,p,y,1);break}}}function cH(_){const s=_.prev,c=_,d=_.next;if(ts(s,c,d)>=0)return!1;let p=_.next.next;for(;p!==_.prev;){if(Id(s.x,s.y,c.x,c.y,d.x,d.y,p.x,p.y)&&ts(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function lH(_,s,c,d){const p=_.prev,y=_,w=_.next;if(ts(p,y,w)>=0)return!1;const E=p.x<y.x?p.x<w.x?p.x:w.x:y.x<w.x?y.x:w.x,P=p.y<y.y?p.y<w.y?p.y:w.y:y.y<w.y?y.y:w.y,L=p.x>y.x?p.x>w.x?p.x:w.x:y.x>w.x?y.x:w.x,O=p.y>y.y?p.y>w.y?p.y:w.y:y.y>w.y?y.y:w.y,k=Lw(E,P,s,c,d),N=Lw(L,O,s,c,d);let z=_.prevZ,V=_.nextZ;for(;z&&z.z>=k&&V&&V.z<=N;){if(z!==_.prev&&z!==_.next&&Id(p.x,p.y,y.x,y.y,w.x,w.y,z.x,z.y)&&ts(z.prev,z,z.next)>=0||(z=z.prevZ,V!==_.prev&&V!==_.next&&Id(p.x,p.y,y.x,y.y,w.x,w.y,V.x,V.y)&&ts(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;z&&z.z>=k;){if(z!==_.prev&&z!==_.next&&Id(p.x,p.y,y.x,y.y,w.x,w.y,z.x,z.y)&&ts(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;V&&V.z<=N;){if(V!==_.prev&&V!==_.next&&Id(p.x,p.y,y.x,y.y,w.x,w.y,V.x,V.y)&&ts(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function hH(_,s,c){let d=_;do{const p=d.prev,y=d.next.next;!b0(p,y)&&mI(p,d,d.next,y)&&jp(p,y)&&jp(y,p)&&(s.push(p.i/c),s.push(d.i/c),s.push(y.i/c),qp(d),qp(d.next),d=_=y),d=d.next}while(d!==_);return fl(d)}function uH(_,s,c,d,p,y){let w=_;do{let E=w.next.next;for(;E!==w.prev;){if(w.i!==E.i&&vH(w,E)){let P=gI(w,E);w=fl(w,w.next),P=fl(P,P.next),Qp(w,s,c,d,p,y),Qp(P,s,c,d,p,y);return}E=E.next}w=w.next}while(w!==_)}function dH(_,s,c,d){const p=[];let y,w,E,P,L;for(y=0,w=s.length;y<w;y++)E=s[y]*d,P=y<w-1?s[y+1]*d:_.length,L=pI(_,E,P,d,!1),L===L.next&&(L.steiner=!0),p.push(_H(L));for(p.sort(fH),y=0;y<p.length;y++)pH(p[y],c),c=fl(c,c.next);return c}function fH(_,s){return _.x-s.x}function pH(_,s){if(s=mH(_,s),s){const c=gI(s,_);fl(s,s.next),fl(c,c.next)}}function mH(_,s){let c=s;const d=_.x,p=_.y;let y=-1/0,w;do{if(p<=c.y&&p>=c.next.y&&c.next.y!==c.y){const N=c.x+(p-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(N<=d&&N>y){if(y=N,N===d){if(p===c.y)return c;if(p===c.next.y)return c.next}w=c.x<c.next.x?c:c.next}}c=c.next}while(c!==s);if(!w)return null;if(d===y)return w;const E=w,P=w.x,L=w.y;let O=1/0,k;c=w;do d>=c.x&&c.x>=P&&d!==c.x&&Id(p<L?d:y,p,P,L,p<L?y:d,p,c.x,c.y)&&(k=Math.abs(p-c.y)/(d-c.x),jp(c,_)&&(k<O||k===O&&(c.x>w.x||c.x===w.x&&gH(w,c)))&&(w=c,O=k)),c=c.next;while(c!==E);return w}function gH(_,s){return ts(_.prev,_,s.prev)<0&&ts(s.next,_,_.next)<0}function AH(_,s,c,d){let p=_;do p.z===null&&(p.z=Lw(p.x,p.y,s,c,d)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==_);p.prevZ.nextZ=null,p.prevZ=null,yH(p)}function yH(_){let s,c,d,p,y,w,E,P,L=1;do{for(c=_,_=null,y=null,w=0;c;){for(w++,d=c,E=0,s=0;s<L&&(E++,d=d.nextZ,!!d);s++);for(P=L;E>0||P>0&&d;)E!==0&&(P===0||!d||c.z<=d.z)?(p=c,c=c.nextZ,E--):(p=d,d=d.nextZ,P--),y?y.nextZ=p:_=p,p.prevZ=y,y=p;c=d}y.nextZ=null,L*=2}while(w>1);return _}function Lw(_,s,c,d,p){return _=32767*(_-c)*p,s=32767*(s-d)*p,_=(_|_<<8)&16711935,_=(_|_<<4)&252645135,_=(_|_<<2)&858993459,_=(_|_<<1)&1431655765,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,_|s<<1}function _H(_){let s=_,c=_;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==_);return c}function Id(_,s,c,d,p,y,w,E){return(p-w)*(s-E)-(_-w)*(y-E)>=0&&(_-w)*(d-E)-(c-w)*(s-E)>=0&&(c-w)*(y-E)-(p-w)*(d-E)>=0}function vH(_,s){return _.next.i!==s.i&&_.prev.i!==s.i&&!xH(_,s)&&(jp(_,s)&&jp(s,_)&&wH(_,s)&&(ts(_.prev,_,s.prev)||ts(_,s.prev,s))||b0(_,s)&&ts(_.prev,_,_.next)>0&&ts(s.prev,s,s.next)>0)}function ts(_,s,c){return(s.y-_.y)*(c.x-s.x)-(s.x-_.x)*(c.y-s.y)}function b0(_,s){return _.x===s.x&&_.y===s.y}function mI(_,s,c,d){const p=E0(ts(_,s,c)),y=E0(ts(_,s,d)),w=E0(ts(c,d,_)),E=E0(ts(c,d,s));return!!(p!==y&&w!==E||p===0&&C0(_,c,s)||y===0&&C0(_,d,s)||w===0&&C0(c,_,d)||E===0&&C0(c,s,d))}function C0(_,s,c){return s.x<=Math.max(_.x,c.x)&&s.x>=Math.min(_.x,c.x)&&s.y<=Math.max(_.y,c.y)&&s.y>=Math.min(_.y,c.y)}function E0(_){return _>0?1:_<0?-1:0}function xH(_,s){let c=_;do{if(c.i!==_.i&&c.next.i!==_.i&&c.i!==s.i&&c.next.i!==s.i&&mI(c,c.next,_,s))return!0;c=c.next}while(c!==_);return!1}function jp(_,s){return ts(_.prev,_,_.next)<0?ts(_,s,_.next)>=0&&ts(_,_.prev,s)>=0:ts(_,s,_.prev)<0||ts(_,_.next,s)<0}function wH(_,s){let c=_,d=!1;const p=(_.x+s.x)/2,y=(_.y+s.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&p<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==_);return d}function gI(_,s){const c=new Dw(_.i,_.x,_.y),d=new Dw(s.i,s.x,s.y),p=_.next,y=s.prev;return _.next=s,s.prev=_,c.next=p,p.prev=c,d.next=c,c.prev=d,y.next=d,d.prev=y,d}function AI(_,s,c,d){const p=new Dw(_,s,c);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function qp(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function Dw(_,s,c){this.i=_,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bH(_,s,c,d){let p=0;for(let y=s,w=c-d;y<c;y+=d)p+=(_[w]-_[y])*(_[y+1]+_[w+1]),w=y;return p}class Ma{static area(s){const c=s.length;let d=0;for(let p=c-1,y=0;y<c;p=y++)d+=s[p].x*s[y].y-s[y].x*s[p].y;return d*.5}static isClockWise(s){return Ma.area(s)<0}static triangulateShape(s,c){const d=[],p=[],y=[];yI(s),_I(d,s);let w=s.length;c.forEach(yI);for(let P=0;P<c.length;P++)p.push(w),w+=c[P].length,_I(d,c[P]);const E=aH.triangulate(d,p);for(let P=0;P<E.length;P+=3)y.push(E.slice(P,P+3));return y}}function yI(_){const s=_.length;s>2&&_[s-1].equals(_[0])&&_.pop()}function _I(_,s){for(let c=0;c<s.length;c++)_.push(s[c].x),_.push(s[c].y)}class Xp extends si{constructor(s=new Fh([new gt(.5,.5),new gt(-.5,.5),new gt(-.5,-.5),new gt(.5,-.5)]),c={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:s,options:c},s=Array.isArray(s)?s:[s];const d=this,p=[],y=[];for(let E=0,P=s.length;E<P;E++){const L=s[E];w(L)}this.setAttribute("position",new An(p,3)),this.setAttribute("uv",new An(y,2)),this.computeVertexNormals();function w(E){const P=[],L=c.curveSegments!==void 0?c.curveSegments:12,O=c.steps!==void 0?c.steps:1,k=c.depth!==void 0?c.depth:1;let N=c.bevelEnabled!==void 0?c.bevelEnabled:!0,z=c.bevelThickness!==void 0?c.bevelThickness:.2,V=c.bevelSize!==void 0?c.bevelSize:z-.1,H=c.bevelOffset!==void 0?c.bevelOffset:0,G=c.bevelSegments!==void 0?c.bevelSegments:3;const X=c.extrudePath,K=c.UVGenerator!==void 0?c.UVGenerator:CH;let ne,te=!1,oe,ue,Ce,$;X&&(ne=X.getSpacedPoints(O),te=!0,N=!1,oe=X.computeFrenetFrames(O,!1),ue=new de,Ce=new de,$=new de),N||(G=0,z=0,V=0,H=0);const ge=E.extractPoints(L);let Te=ge.shape;const et=ge.holes;if(!Ma.isClockWise(Te)){Te=Te.reverse();for(let dt=0,ct=et.length;dt<ct;dt++){const Gt=et[dt];Ma.isClockWise(Gt)&&(et[dt]=Gt.reverse())}}const Ye=Ma.triangulateShape(Te,et),Fe=Te;for(let dt=0,ct=et.length;dt<ct;dt++){const Gt=et[dt];Te=Te.concat(Gt)}function rt(dt,ct,Gt){return ct||console.error("THREE.ExtrudeGeometry: vec does not exist"),ct.clone().multiplyScalar(Gt).add(dt)}const At=Te.length,St=Ye.length;function at(dt,ct,Gt){let bn,sn,ei;const kn=dt.x-ct.x,Pn=dt.y-ct.y,Qi=Gt.x-dt.x,ki=Gt.y-dt.y,_e=kn*kn+Pn*Pn,le=kn*ki-Pn*Qi;if(Math.abs(le)>Number.EPSILON){const Ze=Math.sqrt(_e),Ot=Math.sqrt(Qi*Qi+ki*ki),jt=ct.x-Pn/Ze,an=ct.y+kn/Ze,zn=Gt.x-ki/Ot,cn=Gt.y+Qi/Ot,ft=((zn-jt)*ki-(cn-an)*Qi)/(kn*ki-Pn*Qi);bn=jt+kn*ft-dt.x,sn=an+Pn*ft-dt.y;const Tn=bn*bn+sn*sn;if(Tn<=2)return new gt(bn,sn);ei=Math.sqrt(Tn/2)}else{let Ze=!1;kn>Number.EPSILON?Qi>Number.EPSILON&&(Ze=!0):kn<-Number.EPSILON?Qi<-Number.EPSILON&&(Ze=!0):Math.sign(Pn)===Math.sign(ki)&&(Ze=!0),Ze?(bn=-Pn,sn=kn,ei=Math.sqrt(_e)):(bn=kn,sn=Pn,ei=Math.sqrt(_e/2))}return new gt(bn/ei,sn/ei)}const Qe=[];for(let dt=0,ct=Fe.length,Gt=ct-1,bn=dt+1;dt<ct;dt++,Gt++,bn++)Gt===ct&&(Gt=0),bn===ct&&(bn=0),Qe[dt]=at(Fe[dt],Fe[Gt],Fe[bn]);const Je=[];let Rt,Pt=Qe.concat();for(let dt=0,ct=et.length;dt<ct;dt++){const Gt=et[dt];Rt=[];for(let bn=0,sn=Gt.length,ei=sn-1,kn=bn+1;bn<sn;bn++,ei++,kn++)ei===sn&&(ei=0),kn===sn&&(kn=0),Rt[bn]=at(Gt[bn],Gt[ei],Gt[kn]);Je.push(Rt),Pt=Pt.concat(Rt)}for(let dt=0;dt<G;dt++){const ct=dt/G,Gt=z*Math.cos(ct*Math.PI/2),bn=V*Math.sin(ct*Math.PI/2)+H;for(let sn=0,ei=Fe.length;sn<ei;sn++){const kn=rt(Fe[sn],Qe[sn],bn);ai(kn.x,kn.y,-Gt)}for(let sn=0,ei=et.length;sn<ei;sn++){const kn=et[sn];Rt=Je[sn];for(let Pn=0,Qi=kn.length;Pn<Qi;Pn++){const ki=rt(kn[Pn],Rt[Pn],bn);ai(ki.x,ki.y,-Gt)}}}const Lt=V+H;for(let dt=0;dt<At;dt++){const ct=N?rt(Te[dt],Pt[dt],Lt):Te[dt];te?(Ce.copy(oe.normals[0]).multiplyScalar(ct.x),ue.copy(oe.binormals[0]).multiplyScalar(ct.y),$.copy(ne[0]).add(Ce).add(ue),ai($.x,$.y,$.z)):ai(ct.x,ct.y,0)}for(let dt=1;dt<=O;dt++)for(let ct=0;ct<At;ct++){const Gt=N?rt(Te[ct],Pt[ct],Lt):Te[ct];te?(Ce.copy(oe.normals[dt]).multiplyScalar(Gt.x),ue.copy(oe.binormals[dt]).multiplyScalar(Gt.y),$.copy(ne[dt]).add(Ce).add(ue),ai($.x,$.y,$.z)):ai(Gt.x,Gt.y,k/O*dt)}for(let dt=G-1;dt>=0;dt--){const ct=dt/G,Gt=z*Math.cos(ct*Math.PI/2),bn=V*Math.sin(ct*Math.PI/2)+H;for(let sn=0,ei=Fe.length;sn<ei;sn++){const kn=rt(Fe[sn],Qe[sn],bn);ai(kn.x,kn.y,k+Gt)}for(let sn=0,ei=et.length;sn<ei;sn++){const kn=et[sn];Rt=Je[sn];for(let Pn=0,Qi=kn.length;Pn<Qi;Pn++){const ki=rt(kn[Pn],Rt[Pn],bn);te?ai(ki.x,ki.y+ne[O-1].y,ne[O-1].x+Gt):ai(ki.x,ki.y,k+Gt)}}}yn(),Hn();function yn(){const dt=p.length/3;if(N){let ct=0,Gt=At*ct;for(let bn=0;bn<St;bn++){const sn=Ye[bn];On(sn[2]+Gt,sn[1]+Gt,sn[0]+Gt)}ct=O+G*2,Gt=At*ct;for(let bn=0;bn<St;bn++){const sn=Ye[bn];On(sn[0]+Gt,sn[1]+Gt,sn[2]+Gt)}}else{for(let ct=0;ct<St;ct++){const Gt=Ye[ct];On(Gt[2],Gt[1],Gt[0])}for(let ct=0;ct<St;ct++){const Gt=Ye[ct];On(Gt[0]+At*O,Gt[1]+At*O,Gt[2]+At*O)}}d.addGroup(dt,p.length/3-dt,0)}function Hn(){const dt=p.length/3;let ct=0;Ue(Fe,ct),ct+=Fe.length;for(let Gt=0,bn=et.length;Gt<bn;Gt++){const sn=et[Gt];Ue(sn,ct),ct+=sn.length}d.addGroup(dt,p.length/3-dt,1)}function Ue(dt,ct){let Gt=dt.length;for(;--Gt>=0;){const bn=Gt;let sn=Gt-1;sn<0&&(sn=dt.length-1);for(let ei=0,kn=O+G*2;ei<kn;ei++){const Pn=At*ei,Qi=At*(ei+1),ki=ct+bn+Pn,_e=ct+sn+Pn,le=ct+sn+Qi,Ze=ct+bn+Qi;Vn(ki,_e,le,Ze)}}}function ai(dt,ct,Gt){P.push(dt),P.push(ct),P.push(Gt)}function On(dt,ct,Gt){on(dt),on(ct),on(Gt);const bn=p.length/3,sn=K.generateTopUV(d,p,bn-3,bn-2,bn-1);li(sn[0]),li(sn[1]),li(sn[2])}function Vn(dt,ct,Gt,bn){on(dt),on(ct),on(bn),on(ct),on(Gt),on(bn);const sn=p.length/3,ei=K.generateSideWallUV(d,p,sn-6,sn-3,sn-2,sn-1);li(ei[0]),li(ei[1]),li(ei[3]),li(ei[1]),li(ei[2]),li(ei[3])}function on(dt){p.push(P[dt*3+0]),p.push(P[dt*3+1]),p.push(P[dt*3+2])}function li(dt){y.push(dt.x),y.push(dt.y)}}}toJSON(){const s=super.toJSON(),c=this.parameters.shapes,d=this.parameters.options;return EH(c,d,s)}static fromJSON(s,c){const d=[];for(let y=0,w=s.shapes.length;y<w;y++){const E=c[s.shapes[y]];d.push(E)}const p=s.options.extrudePath;return p!==void 0&&(s.options.extrudePath=new Pw[p.type]().fromJSON(p)),new Xp(d,s.options)}}const CH={generateTopUV:function(_,s,c,d,p){const y=s[c*3],w=s[c*3+1],E=s[d*3],P=s[d*3+1],L=s[p*3],O=s[p*3+1];return[new gt(y,w),new gt(E,P),new gt(L,O)]},generateSideWallUV:function(_,s,c,d,p,y){const w=s[c*3],E=s[c*3+1],P=s[c*3+2],L=s[d*3],O=s[d*3+1],k=s[d*3+2],N=s[p*3],z=s[p*3+1],V=s[p*3+2],H=s[y*3],G=s[y*3+1],X=s[y*3+2];return Math.abs(E-O)<Math.abs(w-L)?[new gt(w,1-P),new gt(L,1-k),new gt(N,1-V),new gt(H,1-X)]:[new gt(E,1-P),new gt(O,1-k),new gt(z,1-V),new gt(G,1-X)]}};function EH(_,s,c){if(c.shapes=[],Array.isArray(_))for(let d=0,p=_.length;d<p;d++){const y=_[d];c.shapes.push(y.uuid)}else c.shapes.push(_.uuid);return c.options=Object.assign({},s),s.extrudePath!==void 0&&(c.options.extrudePath=s.extrudePath.toJSON()),c}class Yp extends mc{constructor(s=1,c=0){const d=(1+Math.sqrt(5))/2,p=[-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,0,1,-d,0,-1,-d,0,1],y=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(p,y,s,c),this.type="IcosahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Yp(s.radius,s.detail)}}class Rd extends mc{constructor(s=1,c=0){const d=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],p=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(d,p,s,c),this.type="OctahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Rd(s.radius,s.detail)}}class Jp extends si{constructor(s=.5,c=1,d=8,p=1,y=0,w=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:s,outerRadius:c,thetaSegments:d,phiSegments:p,thetaStart:y,thetaLength:w},d=Math.max(3,d),p=Math.max(1,p);const E=[],P=[],L=[],O=[];let k=s;const N=(c-s)/p,z=new de,V=new gt;for(let H=0;H<=p;H++){for(let G=0;G<=d;G++){const X=y+G/d*w;z.x=k*Math.cos(X),z.y=k*Math.sin(X),P.push(z.x,z.y,z.z),L.push(0,0,1),V.x=(z.x/c+1)/2,V.y=(z.y/c+1)/2,O.push(V.x,V.y)}k+=N}for(let H=0;H<p;H++){const G=H*(d+1);for(let X=0;X<d;X++){const K=X+G,ne=K,te=K+d+1,oe=K+d+2,ue=K+1;E.push(ne,te,ue),E.push(te,oe,ue)}}this.setIndex(E),this.setAttribute("position",new An(P,3)),this.setAttribute("normal",new An(L,3)),this.setAttribute("uv",new An(O,2))}static fromJSON(s){return new Jp(s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength)}}class Kp extends si{constructor(s=new Fh([new gt(0,.5),new gt(-.5,-.5),new gt(.5,-.5)]),c=12){super(),this.type="ShapeGeometry",this.parameters={shapes:s,curveSegments:c};const d=[],p=[],y=[],w=[];let E=0,P=0;if(Array.isArray(s)===!1)L(s);else for(let O=0;O<s.length;O++)L(s[O]),this.addGroup(E,P,O),E+=P,P=0;this.setIndex(d),this.setAttribute("position",new An(p,3)),this.setAttribute("normal",new An(y,3)),this.setAttribute("uv",new An(w,2));function L(O){const k=p.length/3,N=O.extractPoints(c);let z=N.shape;const V=N.holes;Ma.isClockWise(z)===!1&&(z=z.reverse());for(let G=0,X=V.length;G<X;G++){const K=V[G];Ma.isClockWise(K)===!0&&(V[G]=K.reverse())}const H=Ma.triangulateShape(z,V);for(let G=0,X=V.length;G<X;G++){const K=V[G];z=z.concat(K)}for(let G=0,X=z.length;G<X;G++){const K=z[G];p.push(K.x,K.y,0),y.push(0,0,1),w.push(K.x,K.y)}for(let G=0,X=H.length;G<X;G++){const K=H[G],ne=K[0]+k,te=K[1]+k,oe=K[2]+k;d.push(ne,te,oe),P+=3}}}toJSON(){const s=super.toJSON(),c=this.parameters.shapes;return SH(c,s)}static fromJSON(s,c){const d=[];for(let p=0,y=s.shapes.length;p<y;p++){const w=c[s.shapes[p]];d.push(w)}return new Kp(d,s.curveSegments)}}function SH(_,s){if(s.shapes=[],Array.isArray(_))for(let c=0,d=_.length;c<d;c++){const p=_[c];s.shapes.push(p.uuid)}else s.shapes.push(_.uuid);return s}class Pd extends si{constructor(s=1,c=32,d=16,p=0,y=Math.PI*2,w=0,E=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:s,widthSegments:c,heightSegments:d,phiStart:p,phiLength:y,thetaStart:w,thetaLength:E},c=Math.max(3,Math.floor(c)),d=Math.max(2,Math.floor(d));const P=Math.min(w+E,Math.PI);let L=0;const O=[],k=new de,N=new de,z=[],V=[],H=[],G=[];for(let X=0;X<=d;X++){const K=[],ne=X/d;let te=0;X==0&&w==0?te=.5/c:X==d&&P==Math.PI&&(te=-.5/c);for(let oe=0;oe<=c;oe++){const ue=oe/c;k.x=-s*Math.cos(p+ue*y)*Math.sin(w+ne*E),k.y=s*Math.cos(w+ne*E),k.z=s*Math.sin(p+ue*y)*Math.sin(w+ne*E),V.push(k.x,k.y,k.z),N.copy(k).normalize(),H.push(N.x,N.y,N.z),G.push(ue+te,1-ne),K.push(L++)}O.push(K)}for(let X=0;X<d;X++)for(let K=0;K<c;K++){const ne=O[X][K+1],te=O[X][K],oe=O[X+1][K],ue=O[X+1][K+1];(X!==0||w>0)&&z.push(ne,te,ue),(X!==d-1||P<Math.PI)&&z.push(te,oe,ue)}this.setIndex(z),this.setAttribute("position",new An(V,3)),this.setAttribute("normal",new An(H,3)),this.setAttribute("uv",new An(G,2))}static fromJSON(s){return new Pd(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength)}}class Zp extends mc{constructor(s=1,c=0){const d=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],p=[2,1,0,0,3,2,1,3,0,2,3,1];super(d,p,s,c),this.type="TetrahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Zp(s.radius,s.detail)}}class $p extends si{constructor(s=1,c=.4,d=8,p=6,y=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:s,tube:c,radialSegments:d,tubularSegments:p,arc:y},d=Math.floor(d),p=Math.floor(p);const w=[],E=[],P=[],L=[],O=new de,k=new de,N=new de;for(let z=0;z<=d;z++)for(let V=0;V<=p;V++){const H=V/p*y,G=z/d*Math.PI*2;k.x=(s+c*Math.cos(G))*Math.cos(H),k.y=(s+c*Math.cos(G))*Math.sin(H),k.z=c*Math.sin(G),E.push(k.x,k.y,k.z),O.x=s*Math.cos(H),O.y=s*Math.sin(H),N.subVectors(k,O).normalize(),P.push(N.x,N.y,N.z),L.push(V/p),L.push(z/d)}for(let z=1;z<=d;z++)for(let V=1;V<=p;V++){const H=(p+1)*z+V-1,G=(p+1)*(z-1)+V-1,X=(p+1)*(z-1)+V,K=(p+1)*z+V;w.push(H,G,K),w.push(G,X,K)}this.setIndex(w),this.setAttribute("position",new An(E,3)),this.setAttribute("normal",new An(P,3)),this.setAttribute("uv",new An(L,2))}static fromJSON(s){return new $p(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc)}}class em extends si{constructor(s=1,c=.4,d=64,p=8,y=2,w=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:s,tube:c,tubularSegments:d,radialSegments:p,p:y,q:w},d=Math.floor(d),p=Math.floor(p);const E=[],P=[],L=[],O=[],k=new de,N=new de,z=new de,V=new de,H=new de,G=new de,X=new de;for(let ne=0;ne<=d;++ne){const te=ne/d*y*Math.PI*2;K(te,y,w,s,z),K(te+.01,y,w,s,V),G.subVectors(V,z),X.addVectors(V,z),H.crossVectors(G,X),X.crossVectors(H,G),H.normalize(),X.normalize();for(let oe=0;oe<=p;++oe){const ue=oe/p*Math.PI*2,Ce=-c*Math.cos(ue),$=c*Math.sin(ue);k.x=z.x+(Ce*X.x+$*H.x),k.y=z.y+(Ce*X.y+$*H.y),k.z=z.z+(Ce*X.z+$*H.z),P.push(k.x,k.y,k.z),N.subVectors(k,z).normalize(),L.push(N.x,N.y,N.z),O.push(ne/d),O.push(oe/p)}}for(let ne=1;ne<=d;ne++)for(let te=1;te<=p;te++){const oe=(p+1)*(ne-1)+(te-1),ue=(p+1)*ne+(te-1),Ce=(p+1)*ne+te,$=(p+1)*(ne-1)+te;E.push(oe,ue,$),E.push(ue,Ce,$)}this.setIndex(E),this.setAttribute("position",new An(P,3)),this.setAttribute("normal",new An(L,3)),this.setAttribute("uv",new An(O,2));function K(ne,te,oe,ue,Ce){const $=Math.cos(ne),ge=Math.sin(ne),Te=oe/te*ne,et=Math.cos(Te);Ce.x=ue*(2+et)*.5*$,Ce.y=ue*(2+et)*ge*.5,Ce.z=ue*Math.sin(Te)*.5}}static fromJSON(s){return new em(s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q)}}class tm extends si{constructor(s=new Iw(new de(-1,-1,0),new de(-1,1,0),new de(1,1,0)),c=64,d=1,p=8,y=!1){super(),this.type="TubeGeometry",this.parameters={path:s,tubularSegments:c,radius:d,radialSegments:p,closed:y};const w=s.computeFrenetFrames(c,y);this.tangents=w.tangents,this.normals=w.normals,this.binormals=w.binormals;const E=new de,P=new de,L=new gt;let O=new de;const k=[],N=[],z=[],V=[];H(),this.setIndex(V),this.setAttribute("position",new An(k,3)),this.setAttribute("normal",new An(N,3)),this.setAttribute("uv",new An(z,2));function H(){for(let ne=0;ne<c;ne++)G(ne);G(y===!1?c:0),K(),X()}function G(ne){O=s.getPointAt(ne/c,O);const te=w.normals[ne],oe=w.binormals[ne];for(let ue=0;ue<=p;ue++){const Ce=ue/p*Math.PI*2,$=Math.sin(Ce),ge=-Math.cos(Ce);P.x=ge*te.x+$*oe.x,P.y=ge*te.y+$*oe.y,P.z=ge*te.z+$*oe.z,P.normalize(),N.push(P.x,P.y,P.z),E.x=O.x+d*P.x,E.y=O.y+d*P.y,E.z=O.z+d*P.z,k.push(E.x,E.y,E.z)}}function X(){for(let ne=1;ne<=c;ne++)for(let te=1;te<=p;te++){const oe=(p+1)*(ne-1)+(te-1),ue=(p+1)*ne+(te-1),Ce=(p+1)*ne+te,$=(p+1)*(ne-1)+te;V.push(oe,ue,$),V.push(ue,Ce,$)}}function K(){for(let ne=0;ne<=c;ne++)for(let te=0;te<=p;te++)L.x=ne/c,L.y=te/p,z.push(L.x,L.y)}}toJSON(){const s=super.toJSON();return s.path=this.parameters.path.toJSON(),s}static fromJSON(s){return new tm(new Pw[s.path.type]().fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed)}}class vI extends si{constructor(s=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:s},s!==null){const c=[],d=new Set,p=new de,y=new de;if(s.index!==null){const w=s.attributes.position,E=s.index;let P=s.groups;P.length===0&&(P=[{start:0,count:E.count,materialIndex:0}]);for(let L=0,O=P.length;L<O;++L){const k=P[L],N=k.start,z=k.count;for(let V=N,H=N+z;V<H;V+=3)for(let G=0;G<3;G++){const X=E.getX(V+G),K=E.getX(V+(G+1)%3);p.fromBufferAttribute(w,X),y.fromBufferAttribute(w,K),xI(p,y,d)===!0&&(c.push(p.x,p.y,p.z),c.push(y.x,y.y,y.z))}}}else{const w=s.attributes.position;for(let E=0,P=w.count/3;E<P;E++)for(let L=0;L<3;L++){const O=3*E+L,k=3*E+(L+1)%3;p.fromBufferAttribute(w,O),y.fromBufferAttribute(w,k),xI(p,y,d)===!0&&(c.push(p.x,p.y,p.z),c.push(y.x,y.y,y.z))}}this.setAttribute("position",new An(c,3))}}}function xI(_,s,c){const d=`${_.x},${_.y},${_.z}-${s.x},${s.y},${s.z}`,p=`${s.x},${s.y},${s.z}-${_.x},${_.y},${_.z}`;return c.has(d)===!0||c.has(p)===!0?!1:(c.add(d),c.add(p),!0)}var wI=Object.freeze({__proto__:null,BoxGeometry:hl,CapsuleGeometry:Gp,CircleGeometry:Hp,ConeGeometry:Vp,CylinderGeometry:Oh,DodecahedronGeometry:Wp,EdgesGeometry:fI,ExtrudeGeometry:Xp,IcosahedronGeometry:Yp,LatheGeometry:Td,OctahedronGeometry:Rd,PlaneGeometry:Ad,PolyhedronGeometry:mc,RingGeometry:Jp,ShapeGeometry:Kp,SphereGeometry:Pd,TetrahedronGeometry:Zp,TorusGeometry:$p,TorusKnotGeometry:em,TubeGeometry:tm,WireframeGeometry:vI});class bI extends cr{constructor(s){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new dn(0),this.transparent=!0,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.fog=s.fog,this}}class CI extends Ea{constructor(s){super(s),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Ow extends cr{constructor(s){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new dn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=el,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.defines={STANDARD:""},this.color.copy(s.color),this.roughness=s.roughness,this.metalness=s.metalness,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.roughnessMap=s.roughnessMap,this.metalnessMap=s.metalnessMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.envMapIntensity=s.envMapIntensity,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this.fog=s.fog,this}}class EI extends Ow{constructor(s){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new gt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return fs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(c){this.ior=(1+.4*c)/(1-.4*c)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(s)}get sheen(){return this._sheen}set sheen(s){this._sheen>0!=s>0&&this.version++,this._sheen=s}get clearcoat(){return this._clearcoat}set clearcoat(s){this._clearcoat>0!=s>0&&this.version++,this._clearcoat=s}get iridescence(){return this._iridescence}set iridescence(s){this._iridescence>0!=s>0&&this.version++,this._iridescence=s}get transmission(){return this._transmission}set transmission(s){this._transmission>0!=s>0&&this.version++,this._transmission=s}copy(s){return super.copy(s),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=s.clearcoat,this.clearcoatMap=s.clearcoatMap,this.clearcoatRoughness=s.clearcoatRoughness,this.clearcoatRoughnessMap=s.clearcoatRoughnessMap,this.clearcoatNormalMap=s.clearcoatNormalMap,this.clearcoatNormalScale.copy(s.clearcoatNormalScale),this.ior=s.ior,this.iridescence=s.iridescence,this.iridescenceMap=s.iridescenceMap,this.iridescenceIOR=s.iridescenceIOR,this.iridescenceThicknessRange=[...s.iridescenceThicknessRange],this.iridescenceThicknessMap=s.iridescenceThicknessMap,this.sheen=s.sheen,this.sheenColor.copy(s.sheenColor),this.sheenColorMap=s.sheenColorMap,this.sheenRoughness=s.sheenRoughness,this.sheenRoughnessMap=s.sheenRoughnessMap,this.transmission=s.transmission,this.transmissionMap=s.transmissionMap,this.thickness=s.thickness,this.thicknessMap=s.thicknessMap,this.attenuationDistance=s.attenuationDistance,this.attenuationColor.copy(s.attenuationColor),this.specularIntensity=s.specularIntensity,this.specularIntensityMap=s.specularIntensityMap,this.specularColor.copy(s.specularColor),this.specularColorMap=s.specularColorMap,this}}class SI extends cr{constructor(s){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new dn(16777215),this.specular=new dn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=el,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.specular.copy(s.specular),this.shininess=s.shininess,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this.fog=s.fog,this}}class MI extends cr{constructor(s){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new dn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=el,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.gradientMap=s.gradientMap,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.alphaMap=s.alphaMap,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.fog=s.fog,this}}class TI extends cr{constructor(s){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=el,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(s)}copy(s){return super.copy(s),this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.flatShading=s.flatShading,this}}class II extends cr{constructor(s){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new dn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=el,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this.fog=s.fog,this}}class RI extends cr{constructor(s){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new dn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=el,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.defines={MATCAP:""},this.color.copy(s.color),this.matcap=s.matcap,this.map=s.map,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.alphaMap=s.alphaMap,this.flatShading=s.flatShading,this.fog=s.fog,this}}class PI extends br{constructor(s){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(s)}copy(s){return super.copy(s),this.scale=s.scale,this.dashSize=s.dashSize,this.gapSize=s.gapSize,this}}function Co(_,s,c){return Fw(_)?new _.constructor(_.subarray(s,c!==void 0?c:_.length)):_.slice(s,c)}function kh(_,s,c){return!_||!c&&_.constructor===s?_:typeof s.BYTES_PER_ELEMENT=="number"?new s(_):Array.prototype.slice.call(_)}function Fw(_){return ArrayBuffer.isView(_)&&!(_ instanceof DataView)}function BI(_){function s(p,y){return _[p]-_[y]}const c=_.length,d=new Array(c);for(let p=0;p!==c;++p)d[p]=p;return d.sort(s),d}function kw(_,s,c){const d=_.length,p=new _.constructor(d);for(let y=0,w=0;w!==d;++y){const E=c[y]*s;for(let P=0;P!==s;++P)p[w++]=_[E+P]}return p}function Nw(_,s,c,d){let p=1,y=_[0];for(;y!==void 0&&y[d]===void 0;)y=_[p++];if(y===void 0)return;let w=y[d];if(w!==void 0)if(Array.isArray(w))do w=y[d],w!==void 0&&(s.push(y.time),c.push.apply(c,w)),y=_[p++];while(y!==void 0);else if(w.toArray!==void 0)do w=y[d],w!==void 0&&(s.push(y.time),w.toArray(c,c.length)),y=_[p++];while(y!==void 0);else do w=y[d],w!==void 0&&(s.push(y.time),c.push(w)),y=_[p++];while(y!==void 0)}function MH(_,s,c,d,p=30){const y=_.clone();y.name=s;const w=[];for(let P=0;P<y.tracks.length;++P){const L=y.tracks[P],O=L.getValueSize(),k=[],N=[];for(let z=0;z<L.times.length;++z){const V=L.times[z]*p;if(!(V<c||V>=d)){k.push(L.times[z]);for(let H=0;H<O;++H)N.push(L.values[z*O+H])}}k.length!==0&&(L.times=kh(k,L.times.constructor),L.values=kh(N,L.values.constructor),w.push(L))}y.tracks=w;let E=1/0;for(let P=0;P<y.tracks.length;++P)E>y.tracks[P].times[0]&&(E=y.tracks[P].times[0]);for(let P=0;P<y.tracks.length;++P)y.tracks[P].shift(-1*E);return y.resetDuration(),y}function TH(_,s=0,c=_,d=30){d<=0&&(d=30);const p=c.tracks.length,y=s/d;for(let w=0;w<p;++w){const E=c.tracks[w],P=E.ValueTypeName;if(P==="bool"||P==="string")continue;const L=_.tracks.find(function(X){return X.name===E.name&&X.ValueTypeName===P});if(L===void 0)continue;let O=0;const k=E.getValueSize();E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(O=k/3);let N=0;const z=L.getValueSize();L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(N=z/3);const V=E.times.length-1;let H;if(y<=E.times[0]){const X=O,K=k-O;H=Co(E.values,X,K)}else if(y>=E.times[V]){const X=V*k+O,K=X+k-O;H=Co(E.values,X,K)}else{const X=E.createInterpolant(),K=O,ne=k-O;X.evaluate(y),H=Co(X.resultBuffer,K,ne)}P==="quaternion"&&new Nr().fromArray(H).normalize().conjugate().toArray(H);const G=L.times.length;for(let X=0;X<G;++X){const K=X*z+N;if(P==="quaternion")Nr.multiplyQuaternionsFlat(L.values,K,H,0,L.values,K);else{const ne=z-N*2;for(let te=0;te<ne;++te)L.values[K+te]-=H[te]}}}return _.blendMode=Dx,_}var IH=Object.freeze({__proto__:null,arraySlice:Co,convertArray:kh,isTypedArray:Fw,getKeyframeOrder:BI,sortedArray:kw,flattenJSON:Nw,subclip:MH,makeClipAdditive:TH});class nm{constructor(s,c,d,p){this.parameterPositions=s,this._cachedIndex=0,this.resultBuffer=p!==void 0?p:new c.constructor(d),this.sampleValues=c,this.valueSize=d,this.settings=null,this.DefaultSettings_={}}evaluate(s){const c=this.parameterPositions;let d=this._cachedIndex,p=c[d],y=c[d-1];e:{t:{let w;n:{i:if(!(s<p)){for(let E=d+2;;){if(p===void 0){if(s<y)break i;return d=c.length,this._cachedIndex=d,this.copySampleValue_(d-1)}if(d===E)break;if(y=p,p=c[++d],s<p)break t}w=c.length;break n}if(!(s>=y)){const E=c[1];s<E&&(d=2,y=E);for(let P=d-2;;){if(y===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(d===P)break;if(p=y,y=c[--d-1],s>=y)break t}w=d,d=0;break n}break e}for(;d<w;){const E=d+w>>>1;s<c[E]?w=E:d=E+1}if(p=c[d],y=c[d-1],y===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(p===void 0)return d=c.length,this._cachedIndex=d,this.copySampleValue_(d-1)}this._cachedIndex=d,this.intervalChanged_(d,y,p)}return this.interpolate_(d,y,s,p)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(s){const c=this.resultBuffer,d=this.sampleValues,p=this.valueSize,y=s*p;for(let w=0;w!==p;++w)c[w]=d[y+w];return c}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class LI extends nm{constructor(s,c,d,p){super(s,c,d,p),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_o,endingEnd:_o}}intervalChanged_(s,c,d){const p=this.parameterPositions;let y=s-2,w=s+1,E=p[y],P=p[w];if(E===void 0)switch(this.getSettings_().endingStart){case bh:y=s,E=2*c-d;break;case wp:y=p.length-2,E=c+p[y]-p[y+1];break;default:y=s,E=d}if(P===void 0)switch(this.getSettings_().endingEnd){case bh:w=s,P=2*d-c;break;case wp:w=1,P=d+p[1]-p[0];break;default:w=s-1,P=c}const L=(d-c)*.5,O=this.valueSize;this._weightPrev=L/(c-E),this._weightNext=L/(P-d),this._offsetPrev=y*O,this._offsetNext=w*O}interpolate_(s,c,d,p){const y=this.resultBuffer,w=this.sampleValues,E=this.valueSize,P=s*E,L=P-E,O=this._offsetPrev,k=this._offsetNext,N=this._weightPrev,z=this._weightNext,V=(d-c)/(p-c),H=V*V,G=H*V,X=-N*G+2*N*H-N*V,K=(1+N)*G+(-1.5-2*N)*H+(-.5+N)*V+1,ne=(-1-z)*G+(1.5+z)*H+.5*V,te=z*G-z*H;for(let oe=0;oe!==E;++oe)y[oe]=X*w[O+oe]+K*w[L+oe]+ne*w[P+oe]+te*w[k+oe];return y}}class Uw extends nm{constructor(s,c,d,p){super(s,c,d,p)}interpolate_(s,c,d,p){const y=this.resultBuffer,w=this.sampleValues,E=this.valueSize,P=s*E,L=P-E,O=(d-c)/(p-c),k=1-O;for(let N=0;N!==E;++N)y[N]=w[L+N]*k+w[P+N]*O;return y}}class DI extends nm{constructor(s,c,d,p){super(s,c,d,p)}interpolate_(s){return this.copySampleValue_(s-1)}}class Zo{constructor(s,c,d,p){if(s===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(c===void 0||c.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+s);this.name=s,this.times=kh(c,this.TimeBufferType),this.values=kh(d,this.ValueBufferType),this.setInterpolation(p||this.DefaultInterpolation)}static toJSON(s){const c=s.constructor;let d;if(c.toJSON!==this.toJSON)d=c.toJSON(s);else{d={name:s.name,times:kh(s.times,Array),values:kh(s.values,Array)};const p=s.getInterpolation();p!==s.DefaultInterpolation&&(d.interpolation=p)}return d.type=s.ValueTypeName,d}InterpolantFactoryMethodDiscrete(s){return new DI(this.times,this.values,this.getValueSize(),s)}InterpolantFactoryMethodLinear(s){return new Uw(this.times,this.values,this.getValueSize(),s)}InterpolantFactoryMethodSmooth(s){return new LI(this.times,this.values,this.getValueSize(),s)}setInterpolation(s){let c;switch(s){case vr:c=this.InterpolantFactoryMethodDiscrete;break;case jo:c=this.InterpolantFactoryMethodLinear;break;case xr:c=this.InterpolantFactoryMethodSmooth;break}if(c===void 0){const d="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(s!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(d);return console.warn("THREE.KeyframeTrack:",d),this}return this.createInterpolant=c,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return vr;case this.InterpolantFactoryMethodLinear:return jo;case this.InterpolantFactoryMethodSmooth:return xr}}getValueSize(){return this.values.length/this.times.length}shift(s){if(s!==0){const c=this.times;for(let d=0,p=c.length;d!==p;++d)c[d]+=s}return this}scale(s){if(s!==1){const c=this.times;for(let d=0,p=c.length;d!==p;++d)c[d]*=s}return this}trim(s,c){const d=this.times,p=d.length;let y=0,w=p-1;for(;y!==p&&d[y]<s;)++y;for(;w!==-1&&d[w]>c;)--w;if(++w,y!==0||w!==p){y>=w&&(w=Math.max(w,1),y=w-1);const E=this.getValueSize();this.times=Co(d,y,w),this.values=Co(this.values,y*E,w*E)}return this}validate(){let s=!0;const c=this.getValueSize();c-Math.floor(c)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),s=!1);const d=this.times,p=this.values,y=d.length;y===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),s=!1);let w=null;for(let E=0;E!==y;E++){const P=d[E];if(typeof P=="number"&&isNaN(P)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,E,P),s=!1;break}if(w!==null&&w>P){console.error("THREE.KeyframeTrack: Out of order keys.",this,E,P,w),s=!1;break}w=P}if(p!==void 0&&Fw(p))for(let E=0,P=p.length;E!==P;++E){const L=p[E];if(isNaN(L)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,E,L),s=!1;break}}return s}optimize(){const s=Co(this.times),c=Co(this.values),d=this.getValueSize(),p=this.getInterpolation()===xr,y=s.length-1;let w=1;for(let E=1;E<y;++E){let P=!1;const L=s[E],O=s[E+1];if(L!==O&&(E!==1||L!==s[0]))if(p)P=!0;else{const k=E*d,N=k-d,z=k+d;for(let V=0;V!==d;++V){const H=c[k+V];if(H!==c[N+V]||H!==c[z+V]){P=!0;break}}}if(P){if(E!==w){s[w]=s[E];const k=E*d,N=w*d;for(let z=0;z!==d;++z)c[N+z]=c[k+z]}++w}}if(y>0){s[w]=s[y];for(let E=y*d,P=w*d,L=0;L!==d;++L)c[P+L]=c[E+L];++w}return w!==s.length?(this.times=Co(s,0,w),this.values=Co(c,0,w*d)):(this.times=s,this.values=c),this}clone(){const s=Co(this.times,0),c=Co(this.values,0),d=this.constructor,p=new d(this.name,s,c);return p.createInterpolant=this.createInterpolant,p}}Zo.prototype.TimeBufferType=Float32Array,Zo.prototype.ValueBufferType=Float32Array,Zo.prototype.DefaultInterpolation=jo;class Nh extends Zo{}Nh.prototype.ValueTypeName="bool",Nh.prototype.ValueBufferType=Array,Nh.prototype.DefaultInterpolation=vr,Nh.prototype.InterpolantFactoryMethodLinear=void 0,Nh.prototype.InterpolantFactoryMethodSmooth=void 0;class zw extends Zo{}zw.prototype.ValueTypeName="color";class im extends Zo{}im.prototype.ValueTypeName="number";class OI extends nm{constructor(s,c,d,p){super(s,c,d,p)}interpolate_(s,c,d,p){const y=this.resultBuffer,w=this.sampleValues,E=this.valueSize,P=(d-c)/(p-c);let L=s*E;for(let O=L+E;L!==O;L+=4)Nr.slerpFlat(y,0,w,L-E,w,L,P);return y}}class Bd extends Zo{InterpolantFactoryMethodLinear(s){return new OI(this.times,this.values,this.getValueSize(),s)}}Bd.prototype.ValueTypeName="quaternion",Bd.prototype.DefaultInterpolation=jo,Bd.prototype.InterpolantFactoryMethodSmooth=void 0;class Uh extends Zo{}Uh.prototype.ValueTypeName="string",Uh.prototype.ValueBufferType=Array,Uh.prototype.DefaultInterpolation=vr,Uh.prototype.InterpolantFactoryMethodLinear=void 0,Uh.prototype.InterpolantFactoryMethodSmooth=void 0;class sm extends Zo{}sm.prototype.ValueTypeName="vector";class rm{constructor(s,c=-1,d,p=MA){this.name=s,this.tracks=d,this.duration=c,this.blendMode=p,this.uuid=Zr(),this.duration<0&&this.resetDuration()}static parse(s){const c=[],d=s.tracks,p=1/(s.fps||1);for(let w=0,E=d.length;w!==E;++w)c.push(PH(d[w]).scale(p));const y=new this(s.name,s.duration,c,s.blendMode);return y.uuid=s.uuid,y}static toJSON(s){const c=[],d=s.tracks,p={name:s.name,duration:s.duration,tracks:c,uuid:s.uuid,blendMode:s.blendMode};for(let y=0,w=d.length;y!==w;++y)c.push(Zo.toJSON(d[y]));return p}static CreateFromMorphTargetSequence(s,c,d,p){const y=c.length,w=[];for(let E=0;E<y;E++){let P=[],L=[];P.push((E+y-1)%y,E,(E+1)%y),L.push(0,1,0);const O=BI(P);P=kw(P,1,O),L=kw(L,1,O),!p&&P[0]===0&&(P.push(y),L.push(L[0])),w.push(new im(".morphTargetInfluences["+c[E].name+"]",P,L).scale(1/d))}return new this(s,-1,w)}static findByName(s,c){let d=s;if(!Array.isArray(s)){const p=s;d=p.geometry&&p.geometry.animations||p.animations}for(let p=0;p<d.length;p++)if(d[p].name===c)return d[p];return null}static CreateClipsFromMorphTargetSequences(s,c,d){const p={},y=/^([\w-]*?)([\d]+)$/;for(let E=0,P=s.length;E<P;E++){const L=s[E],O=L.name.match(y);if(O&&O.length>1){const k=O[1];let N=p[k];N||(p[k]=N=[]),N.push(L)}}const w=[];for(const E in p)w.push(this.CreateFromMorphTargetSequence(E,p[E],c,d));return w}static parseAnimation(s,c){if(!s)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const d=function(k,N,z,V,H){if(z.length!==0){const G=[],X=[];Nw(z,G,X,V),G.length!==0&&H.push(new k(N,G,X))}},p=[],y=s.name||"default",w=s.fps||30,E=s.blendMode;let P=s.length||-1;const L=s.hierarchy||[];for(let k=0;k<L.length;k++){const N=L[k].keys;if(!(!N||N.length===0))if(N[0].morphTargets){const z={};let V;for(V=0;V<N.length;V++)if(N[V].morphTargets)for(let H=0;H<N[V].morphTargets.length;H++)z[N[V].morphTargets[H]]=-1;for(const H in z){const G=[],X=[];for(let K=0;K!==N[V].morphTargets.length;++K){const ne=N[V];G.push(ne.time),X.push(ne.morphTarget===H?1:0)}p.push(new im(".morphTargetInfluence["+H+"]",G,X))}P=z.length*w}else{const z=".bones["+c[k].name+"]";d(sm,z+".position",N,"pos",p),d(Bd,z+".quaternion",N,"rot",p),d(sm,z+".scale",N,"scl",p)}}return p.length===0?null:new this(y,P,p,E)}resetDuration(){const s=this.tracks;let c=0;for(let d=0,p=s.length;d!==p;++d){const y=this.tracks[d];c=Math.max(c,y.times[y.times.length-1])}return this.duration=c,this}trim(){for(let s=0;s<this.tracks.length;s++)this.tracks[s].trim(0,this.duration);return this}validate(){let s=!0;for(let c=0;c<this.tracks.length;c++)s=s&&this.tracks[c].validate();return s}optimize(){for(let s=0;s<this.tracks.length;s++)this.tracks[s].optimize();return this}clone(){const s=[];for(let c=0;c<this.tracks.length;c++)s.push(this.tracks[c].clone());return new this.constructor(this.name,this.duration,s,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function RH(_){switch(_.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return im;case"vector":case"vector2":case"vector3":case"vector4":return sm;case"color":return zw;case"quaternion":return Bd;case"bool":case"boolean":return Nh;case"string":return Uh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+_)}function PH(_){if(_.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const s=RH(_.type);if(_.times===void 0){const c=[],d=[];Nw(_.keys,c,d,"value"),_.times=c,_.values=d}return s.parse!==void 0?s.parse(_):new s(_.name,_.times,_.values,_.interpolation)}const zh={enabled:!1,files:{},add:function(_,s){this.enabled!==!1&&(this.files[_]=s)},get:function(_){if(this.enabled!==!1)return this.files[_]},remove:function(_){delete this.files[_]},clear:function(){this.files={}}};class Gw{constructor(s,c,d){const p=this;let y=!1,w=0,E=0,P;const L=[];this.onStart=void 0,this.onLoad=s,this.onProgress=c,this.onError=d,this.itemStart=function(O){E++,y===!1&&p.onStart!==void 0&&p.onStart(O,w,E),y=!0},this.itemEnd=function(O){w++,p.onProgress!==void 0&&p.onProgress(O,w,E),w===E&&(y=!1,p.onLoad!==void 0&&p.onLoad())},this.itemError=function(O){p.onError!==void 0&&p.onError(O)},this.resolveURL=function(O){return P?P(O):O},this.setURLModifier=function(O){return P=O,this},this.addHandler=function(O,k){return L.push(O,k),this},this.removeHandler=function(O){const k=L.indexOf(O);return k!==-1&&L.splice(k,2),this},this.getHandler=function(O){for(let k=0,N=L.length;k<N;k+=2){const z=L[k],V=L[k+1];if(z.global&&(z.lastIndex=0),z.test(O))return V}return null}}}const FI=new Gw;class to{constructor(s){this.manager=s!==void 0?s:FI,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(s,c){const d=this;return new Promise(function(p,y){d.load(s,p,c,y)})}parse(){}setCrossOrigin(s){return this.crossOrigin=s,this}setWithCredentials(s){return this.withCredentials=s,this}setPath(s){return this.path=s,this}setResourcePath(s){return this.resourcePath=s,this}setRequestHeader(s){return this.requestHeader=s,this}}const gc={};class BH extends Error{constructor(s,c){super(s),this.response=c}}class Ac extends to{constructor(s){super(s)}load(s,c,d,p){s===void 0&&(s=""),this.path!==void 0&&(s=this.path+s),s=this.manager.resolveURL(s);const y=zh.get(s);if(y!==void 0)return this.manager.itemStart(s),setTimeout(()=>{c&&c(y),this.manager.itemEnd(s)},0),y;if(gc[s]!==void 0){gc[s].push({onLoad:c,onProgress:d,onError:p});return}gc[s]=[],gc[s].push({onLoad:c,onProgress:d,onError:p});const w=new Request(s,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),E=this.mimeType,P=this.responseType;fetch(w).then(L=>{if(L.status===200||L.status===0){if(L.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||L.body===void 0||L.body.getReader===void 0)return L;const O=gc[s],k=L.body.getReader(),N=L.headers.get("Content-Length"),z=N?parseInt(N):0,V=z!==0;let H=0;const G=new ReadableStream({start(X){K();function K(){k.read().then(({done:ne,value:te})=>{if(ne)X.close();else{H+=te.byteLength;const oe=new ProgressEvent("progress",{lengthComputable:V,loaded:H,total:z});for(let ue=0,Ce=O.length;ue<Ce;ue++){const $=O[ue];$.onProgress&&$.onProgress(oe)}X.enqueue(te),K()}})}}});return new Response(G)}else throw new BH(`fetch for "${L.url}" responded with ${L.status}: ${L.statusText}`,L)}).then(L=>{switch(P){case"arraybuffer":return L.arrayBuffer();case"blob":return L.blob();case"document":return L.text().then(O=>new DOMParser().parseFromString(O,E));case"json":return L.json();default:if(E===void 0)return L.text();{const k=/charset="?([^;"\s]*)"?/i.exec(E),N=k&&k[1]?k[1].toLowerCase():void 0,z=new TextDecoder(N);return L.arrayBuffer().then(V=>z.decode(V))}}}).then(L=>{zh.add(s,L);const O=gc[s];delete gc[s];for(let k=0,N=O.length;k<N;k++){const z=O[k];z.onLoad&&z.onLoad(L)}}).catch(L=>{const O=gc[s];if(O===void 0)throw this.manager.itemError(s),L;delete gc[s];for(let k=0,N=O.length;k<N;k++){const z=O[k];z.onError&&z.onError(L)}this.manager.itemError(s)}).finally(()=>{this.manager.itemEnd(s)}),this.manager.itemStart(s)}setResponseType(s){return this.responseType=s,this}setMimeType(s){return this.mimeType=s,this}}class LH extends to{constructor(s){super(s)}load(s,c,d,p){const y=this,w=new Ac(this.manager);w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials),w.load(s,function(E){try{c(y.parse(JSON.parse(E)))}catch(P){p?p(P):console.error(P),y.manager.itemError(s)}},d,p)}parse(s){const c=[];for(let d=0;d<s.length;d++){const p=rm.parse(s[d]);c.push(p)}return c}}class DH extends to{constructor(s){super(s)}load(s,c,d,p){const y=this,w=[],E=new oI,P=new Ac(this.manager);P.setPath(this.path),P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setWithCredentials(y.withCredentials);let L=0;function O(k){P.load(s[k],function(N){const z=y.parse(N,!0);w[k]={width:z.width,height:z.height,format:z.format,mipmaps:z.mipmaps},L+=1,L===6&&(z.mipmapCount===1&&(E.minFilter=Et),E.image=w,E.format=z.format,E.needsUpdate=!0,c&&c(E))},d,p)}if(Array.isArray(s))for(let k=0,N=s.length;k<N;++k)O(k);else P.load(s,function(k){const N=y.parse(k,!0);if(N.isCubemap){const z=N.mipmaps.length/N.mipmapCount;for(let V=0;V<z;V++){w[V]={mipmaps:[]};for(let H=0;H<N.mipmapCount;H++)w[V].mipmaps.push(N.mipmaps[V*N.mipmapCount+H]),w[V].format=N.format,w[V].width=N.width,w[V].height=N.height}E.image=w}else E.image.width=N.width,E.image.height=N.height,E.mipmaps=N.mipmaps;N.mipmapCount===1&&(E.minFilter=Et),E.format=N.format,E.needsUpdate=!0,c&&c(E)},d,p);return E}}class om extends to{constructor(s){super(s)}load(s,c,d,p){this.path!==void 0&&(s=this.path+s),s=this.manager.resolveURL(s);const y=this,w=zh.get(s);if(w!==void 0)return y.manager.itemStart(s),setTimeout(function(){c&&c(w),y.manager.itemEnd(s)},0),w;const E=Sp("img");function P(){O(),zh.add(s,this),c&&c(this),y.manager.itemEnd(s)}function L(k){O(),p&&p(k),y.manager.itemError(s),y.manager.itemEnd(s)}function O(){E.removeEventListener("load",P,!1),E.removeEventListener("error",L,!1)}return E.addEventListener("load",P,!1),E.addEventListener("error",L,!1),s.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(E.crossOrigin=this.crossOrigin),y.manager.itemStart(s),E.src=s,E}}class OH extends to{constructor(s){super(s)}load(s,c,d,p){const y=new Bp,w=new om(this.manager);w.setCrossOrigin(this.crossOrigin),w.setPath(this.path);let E=0;function P(L){w.load(s[L],function(O){y.images[L]=O,E++,E===6&&(y.needsUpdate=!0,c&&c(y))},void 0,p)}for(let L=0;L<s.length;++L)P(L);return y}}class FH extends to{constructor(s){super(s)}load(s,c,d,p){const y=this,w=new Sd,E=new Ac(this.manager);return E.setResponseType("arraybuffer"),E.setRequestHeader(this.requestHeader),E.setPath(this.path),E.setWithCredentials(y.withCredentials),E.load(s,function(P){const L=y.parse(P);!L||(L.image!==void 0?w.image=L.image:L.data!==void 0&&(w.image.width=L.width,w.image.height=L.height,w.image.data=L.data),w.wrapS=L.wrapS!==void 0?L.wrapS:je,w.wrapT=L.wrapT!==void 0?L.wrapT:je,w.magFilter=L.magFilter!==void 0?L.magFilter:Et,w.minFilter=L.minFilter!==void 0?L.minFilter:Et,w.anisotropy=L.anisotropy!==void 0?L.anisotropy:1,L.encoding!==void 0&&(w.encoding=L.encoding),L.flipY!==void 0&&(w.flipY=L.flipY),L.format!==void 0&&(w.format=L.format),L.type!==void 0&&(w.type=L.type),L.mipmaps!==void 0&&(w.mipmaps=L.mipmaps,w.minFilter=Wt),L.mipmapCount===1&&(w.minFilter=Et),L.generateMipmaps!==void 0&&(w.generateMipmaps=L.generateMipmaps),w.needsUpdate=!0,c&&c(w,L))},d,p),w}}class kH extends to{constructor(s){super(s)}load(s,c,d,p){const y=new Rs,w=new om(this.manager);return w.setCrossOrigin(this.crossOrigin),w.setPath(this.path),w.load(s,function(E){y.image=E,y.needsUpdate=!0,c!==void 0&&c(y)},d,p),y}}class pl extends bi{constructor(s,c=1){super(),this.isLight=!0,this.type="Light",this.color=new dn(s),this.intensity=c}dispose(){}copy(s,c){return super.copy(s,c),this.color.copy(s.color),this.intensity=s.intensity,this}toJSON(s){const c=super.toJSON(s);return c.object.color=this.color.getHex(),c.object.intensity=this.intensity,this.groundColor!==void 0&&(c.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(c.object.distance=this.distance),this.angle!==void 0&&(c.object.angle=this.angle),this.decay!==void 0&&(c.object.decay=this.decay),this.penumbra!==void 0&&(c.object.penumbra=this.penumbra),this.shadow!==void 0&&(c.object.shadow=this.shadow.toJSON()),c}}class kI extends pl{constructor(s,c,d){super(s,d),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.groundColor=new dn(c)}copy(s,c){return super.copy(s,c),this.groundColor.copy(s.groundColor),this}}const Hw=new $n,NI=new de,UI=new de;class Vw{constructor(s){this.camera=s,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new gt(512,512),this.map=null,this.mapPass=null,this.matrix=new $n,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new e0,this._frameExtents=new gt(1,1),this._viewportCount=1,this._viewports=[new Pi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(s){const c=this.camera,d=this.matrix;NI.setFromMatrixPosition(s.matrixWorld),c.position.copy(NI),UI.setFromMatrixPosition(s.target.matrixWorld),c.lookAt(UI),c.updateMatrixWorld(),Hw.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Hw),d.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),d.multiply(Hw)}getViewport(s){return this._viewports[s]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(s){return this.camera=s.camera.clone(),this.bias=s.bias,this.radius=s.radius,this.mapSize.copy(s.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const s={};return this.bias!==0&&(s.bias=this.bias),this.normalBias!==0&&(s.normalBias=this.normalBias),this.radius!==1&&(s.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(s.mapSize=this.mapSize.toArray()),s.camera=this.camera.toJSON(!1).object,delete s.camera.matrix,s}}class NH extends Vw{constructor(){super(new Ks(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(s){const c=this.camera,d=Cp*2*s.angle*this.focus,p=this.mapSize.width/this.mapSize.height,y=s.distance||c.far;(d!==c.fov||p!==c.aspect||y!==c.far)&&(c.fov=d,c.aspect=p,c.far=y,c.updateProjectionMatrix()),super.updateMatrices(s)}copy(s){return super.copy(s),this.focus=s.focus,this}}class zI extends pl{constructor(s,c,d=0,p=Math.PI/3,y=0,w=1){super(s,c),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.target=new bi,this.distance=d,this.angle=p,this.penumbra=y,this.decay=w,this.map=null,this.shadow=new NH}get power(){return this.intensity*Math.PI}set power(s){this.intensity=s/Math.PI}dispose(){this.shadow.dispose()}copy(s,c){return super.copy(s,c),this.distance=s.distance,this.angle=s.angle,this.penumbra=s.penumbra,this.decay=s.decay,this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}const GI=new $n,am=new de,Ww=new de;class UH extends Vw{constructor(){super(new Ks(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new gt(4,2),this._viewportCount=6,this._viewports=[new Pi(2,1,1,1),new Pi(0,1,1,1),new Pi(3,1,1,1),new Pi(1,1,1,1),new Pi(3,0,1,1),new Pi(1,0,1,1)],this._cubeDirections=[new de(1,0,0),new de(-1,0,0),new de(0,0,1),new de(0,0,-1),new de(0,1,0),new de(0,-1,0)],this._cubeUps=[new de(0,1,0),new de(0,1,0),new de(0,1,0),new de(0,1,0),new de(0,0,1),new de(0,0,-1)]}updateMatrices(s,c=0){const d=this.camera,p=this.matrix,y=s.distance||d.far;y!==d.far&&(d.far=y,d.updateProjectionMatrix()),am.setFromMatrixPosition(s.matrixWorld),d.position.copy(am),Ww.copy(d.position),Ww.add(this._cubeDirections[c]),d.up.copy(this._cubeUps[c]),d.lookAt(Ww),d.updateMatrixWorld(),p.makeTranslation(-am.x,-am.y,-am.z),GI.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(GI)}}class HI extends pl{constructor(s,c,d=0,p=1){super(s,c),this.isPointLight=!0,this.type="PointLight",this.distance=d,this.decay=p,this.shadow=new UH}get power(){return this.intensity*4*Math.PI}set power(s){this.intensity=s/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(s,c){return super.copy(s,c),this.distance=s.distance,this.decay=s.decay,this.shadow=s.shadow.clone(),this}}class zH extends Vw{constructor(){super(new t0(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class VI extends pl{constructor(s,c){super(s,c),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.target=new bi,this.shadow=new zH}dispose(){this.shadow.dispose()}copy(s){return super.copy(s),this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}class WI extends pl{constructor(s,c){super(s,c),this.isAmbientLight=!0,this.type="AmbientLight"}}class QI extends pl{constructor(s,c,d=10,p=10){super(s,c),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=d,this.height=p}get power(){return this.intensity*this.width*this.height*Math.PI}set power(s){this.intensity=s/(this.width*this.height*Math.PI)}copy(s){return super.copy(s),this.width=s.width,this.height=s.height,this}toJSON(s){const c=super.toJSON(s);return c.object.width=this.width,c.object.height=this.height,c}}class jI{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let s=0;s<9;s++)this.coefficients.push(new de)}set(s){for(let c=0;c<9;c++)this.coefficients[c].copy(s[c]);return this}zero(){for(let s=0;s<9;s++)this.coefficients[s].set(0,0,0);return this}getAt(s,c){const d=s.x,p=s.y,y=s.z,w=this.coefficients;return c.copy(w[0]).multiplyScalar(.282095),c.addScaledVector(w[1],.488603*p),c.addScaledVector(w[2],.488603*y),c.addScaledVector(w[3],.488603*d),c.addScaledVector(w[4],1.092548*(d*p)),c.addScaledVector(w[5],1.092548*(p*y)),c.addScaledVector(w[6],.315392*(3*y*y-1)),c.addScaledVector(w[7],1.092548*(d*y)),c.addScaledVector(w[8],.546274*(d*d-p*p)),c}getIrradianceAt(s,c){const d=s.x,p=s.y,y=s.z,w=this.coefficients;return c.copy(w[0]).multiplyScalar(.886227),c.addScaledVector(w[1],2*.511664*p),c.addScaledVector(w[2],2*.511664*y),c.addScaledVector(w[3],2*.511664*d),c.addScaledVector(w[4],2*.429043*d*p),c.addScaledVector(w[5],2*.429043*p*y),c.addScaledVector(w[6],.743125*y*y-.247708),c.addScaledVector(w[7],2*.429043*d*y),c.addScaledVector(w[8],.429043*(d*d-p*p)),c}add(s){for(let c=0;c<9;c++)this.coefficients[c].add(s.coefficients[c]);return this}addScaledSH(s,c){for(let d=0;d<9;d++)this.coefficients[d].addScaledVector(s.coefficients[d],c);return this}scale(s){for(let c=0;c<9;c++)this.coefficients[c].multiplyScalar(s);return this}lerp(s,c){for(let d=0;d<9;d++)this.coefficients[d].lerp(s.coefficients[d],c);return this}equals(s){for(let c=0;c<9;c++)if(!this.coefficients[c].equals(s.coefficients[c]))return!1;return!0}copy(s){return this.set(s.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(s,c=0){const d=this.coefficients;for(let p=0;p<9;p++)d[p].fromArray(s,c+p*3);return this}toArray(s=[],c=0){const d=this.coefficients;for(let p=0;p<9;p++)d[p].toArray(s,c+p*3);return s}static getBasisAt(s,c){const d=s.x,p=s.y,y=s.z;c[0]=.282095,c[1]=.488603*p,c[2]=.488603*y,c[3]=.488603*d,c[4]=1.092548*d*p,c[5]=1.092548*p*y,c[6]=.315392*(3*y*y-1),c[7]=1.092548*d*y,c[8]=.546274*(d*d-p*p)}}class S0 extends pl{constructor(s=new jI,c=1){super(void 0,c),this.isLightProbe=!0,this.sh=s}copy(s){return super.copy(s),this.sh.copy(s.sh),this}fromJSON(s){return this.intensity=s.intensity,this.sh.fromArray(s.sh),this}toJSON(s){const c=super.toJSON(s);return c.object.sh=this.sh.toArray(),c}}class M0 extends to{constructor(s){super(s),this.textures={}}load(s,c,d,p){const y=this,w=new Ac(y.manager);w.setPath(y.path),w.setRequestHeader(y.requestHeader),w.setWithCredentials(y.withCredentials),w.load(s,function(E){try{c(y.parse(JSON.parse(E)))}catch(P){p?p(P):console.error(P),y.manager.itemError(s)}},d,p)}parse(s){const c=this.textures;function d(y){return c[y]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",y),c[y]}const p=M0.createMaterialFromType(s.type);if(s.uuid!==void 0&&(p.uuid=s.uuid),s.name!==void 0&&(p.name=s.name),s.color!==void 0&&p.color!==void 0&&p.color.setHex(s.color),s.roughness!==void 0&&(p.roughness=s.roughness),s.metalness!==void 0&&(p.metalness=s.metalness),s.sheen!==void 0&&(p.sheen=s.sheen),s.sheenColor!==void 0&&(p.sheenColor=new dn().setHex(s.sheenColor)),s.sheenRoughness!==void 0&&(p.sheenRoughness=s.sheenRoughness),s.emissive!==void 0&&p.emissive!==void 0&&p.emissive.setHex(s.emissive),s.specular!==void 0&&p.specular!==void 0&&p.specular.setHex(s.specular),s.specularIntensity!==void 0&&(p.specularIntensity=s.specularIntensity),s.specularColor!==void 0&&p.specularColor!==void 0&&p.specularColor.setHex(s.specularColor),s.shininess!==void 0&&(p.shininess=s.shininess),s.clearcoat!==void 0&&(p.clearcoat=s.clearcoat),s.clearcoatRoughness!==void 0&&(p.clearcoatRoughness=s.clearcoatRoughness),s.iridescence!==void 0&&(p.iridescence=s.iridescence),s.iridescenceIOR!==void 0&&(p.iridescenceIOR=s.iridescenceIOR),s.iridescenceThicknessRange!==void 0&&(p.iridescenceThicknessRange=s.iridescenceThicknessRange),s.transmission!==void 0&&(p.transmission=s.transmission),s.thickness!==void 0&&(p.thickness=s.thickness),s.attenuationDistance!==void 0&&(p.attenuationDistance=s.attenuationDistance),s.attenuationColor!==void 0&&p.attenuationColor!==void 0&&p.attenuationColor.setHex(s.attenuationColor),s.fog!==void 0&&(p.fog=s.fog),s.flatShading!==void 0&&(p.flatShading=s.flatShading),s.blending!==void 0&&(p.blending=s.blending),s.combine!==void 0&&(p.combine=s.combine),s.side!==void 0&&(p.side=s.side),s.shadowSide!==void 0&&(p.shadowSide=s.shadowSide),s.opacity!==void 0&&(p.opacity=s.opacity),s.transparent!==void 0&&(p.transparent=s.transparent),s.alphaTest!==void 0&&(p.alphaTest=s.alphaTest),s.depthTest!==void 0&&(p.depthTest=s.depthTest),s.depthWrite!==void 0&&(p.depthWrite=s.depthWrite),s.colorWrite!==void 0&&(p.colorWrite=s.colorWrite),s.stencilWrite!==void 0&&(p.stencilWrite=s.stencilWrite),s.stencilWriteMask!==void 0&&(p.stencilWriteMask=s.stencilWriteMask),s.stencilFunc!==void 0&&(p.stencilFunc=s.stencilFunc),s.stencilRef!==void 0&&(p.stencilRef=s.stencilRef),s.stencilFuncMask!==void 0&&(p.stencilFuncMask=s.stencilFuncMask),s.stencilFail!==void 0&&(p.stencilFail=s.stencilFail),s.stencilZFail!==void 0&&(p.stencilZFail=s.stencilZFail),s.stencilZPass!==void 0&&(p.stencilZPass=s.stencilZPass),s.wireframe!==void 0&&(p.wireframe=s.wireframe),s.wireframeLinewidth!==void 0&&(p.wireframeLinewidth=s.wireframeLinewidth),s.wireframeLinecap!==void 0&&(p.wireframeLinecap=s.wireframeLinecap),s.wireframeLinejoin!==void 0&&(p.wireframeLinejoin=s.wireframeLinejoin),s.rotation!==void 0&&(p.rotation=s.rotation),s.linewidth!==1&&(p.linewidth=s.linewidth),s.dashSize!==void 0&&(p.dashSize=s.dashSize),s.gapSize!==void 0&&(p.gapSize=s.gapSize),s.scale!==void 0&&(p.scale=s.scale),s.polygonOffset!==void 0&&(p.polygonOffset=s.polygonOffset),s.polygonOffsetFactor!==void 0&&(p.polygonOffsetFactor=s.polygonOffsetFactor),s.polygonOffsetUnits!==void 0&&(p.polygonOffsetUnits=s.polygonOffsetUnits),s.dithering!==void 0&&(p.dithering=s.dithering),s.alphaToCoverage!==void 0&&(p.alphaToCoverage=s.alphaToCoverage),s.premultipliedAlpha!==void 0&&(p.premultipliedAlpha=s.premultipliedAlpha),s.visible!==void 0&&(p.visible=s.visible),s.toneMapped!==void 0&&(p.toneMapped=s.toneMapped),s.userData!==void 0&&(p.userData=s.userData),s.vertexColors!==void 0&&(typeof s.vertexColors=="number"?p.vertexColors=s.vertexColors>0:p.vertexColors=s.vertexColors),s.uniforms!==void 0)for(const y in s.uniforms){const w=s.uniforms[y];switch(p.uniforms[y]={},w.type){case"t":p.uniforms[y].value=d(w.value);break;case"c":p.uniforms[y].value=new dn().setHex(w.value);break;case"v2":p.uniforms[y].value=new gt().fromArray(w.value);break;case"v3":p.uniforms[y].value=new de().fromArray(w.value);break;case"v4":p.uniforms[y].value=new Pi().fromArray(w.value);break;case"m3":p.uniforms[y].value=new kr().fromArray(w.value);break;case"m4":p.uniforms[y].value=new $n().fromArray(w.value);break;default:p.uniforms[y].value=w.value}}if(s.defines!==void 0&&(p.defines=s.defines),s.vertexShader!==void 0&&(p.vertexShader=s.vertexShader),s.fragmentShader!==void 0&&(p.fragmentShader=s.fragmentShader),s.glslVersion!==void 0&&(p.glslVersion=s.glslVersion),s.extensions!==void 0)for(const y in s.extensions)p.extensions[y]=s.extensions[y];if(s.size!==void 0&&(p.size=s.size),s.sizeAttenuation!==void 0&&(p.sizeAttenuation=s.sizeAttenuation),s.map!==void 0&&(p.map=d(s.map)),s.matcap!==void 0&&(p.matcap=d(s.matcap)),s.alphaMap!==void 0&&(p.alphaMap=d(s.alphaMap)),s.bumpMap!==void 0&&(p.bumpMap=d(s.bumpMap)),s.bumpScale!==void 0&&(p.bumpScale=s.bumpScale),s.normalMap!==void 0&&(p.normalMap=d(s.normalMap)),s.normalMapType!==void 0&&(p.normalMapType=s.normalMapType),s.normalScale!==void 0){let y=s.normalScale;Array.isArray(y)===!1&&(y=[y,y]),p.normalScale=new gt().fromArray(y)}return s.displacementMap!==void 0&&(p.displacementMap=d(s.displacementMap)),s.displacementScale!==void 0&&(p.displacementScale=s.displacementScale),s.displacementBias!==void 0&&(p.displacementBias=s.displacementBias),s.roughnessMap!==void 0&&(p.roughnessMap=d(s.roughnessMap)),s.metalnessMap!==void 0&&(p.metalnessMap=d(s.metalnessMap)),s.emissiveMap!==void 0&&(p.emissiveMap=d(s.emissiveMap)),s.emissiveIntensity!==void 0&&(p.emissiveIntensity=s.emissiveIntensity),s.specularMap!==void 0&&(p.specularMap=d(s.specularMap)),s.specularIntensityMap!==void 0&&(p.specularIntensityMap=d(s.specularIntensityMap)),s.specularColorMap!==void 0&&(p.specularColorMap=d(s.specularColorMap)),s.envMap!==void 0&&(p.envMap=d(s.envMap)),s.envMapIntensity!==void 0&&(p.envMapIntensity=s.envMapIntensity),s.reflectivity!==void 0&&(p.reflectivity=s.reflectivity),s.refractionRatio!==void 0&&(p.refractionRatio=s.refractionRatio),s.lightMap!==void 0&&(p.lightMap=d(s.lightMap)),s.lightMapIntensity!==void 0&&(p.lightMapIntensity=s.lightMapIntensity),s.aoMap!==void 0&&(p.aoMap=d(s.aoMap)),s.aoMapIntensity!==void 0&&(p.aoMapIntensity=s.aoMapIntensity),s.gradientMap!==void 0&&(p.gradientMap=d(s.gradientMap)),s.clearcoatMap!==void 0&&(p.clearcoatMap=d(s.clearcoatMap)),s.clearcoatRoughnessMap!==void 0&&(p.clearcoatRoughnessMap=d(s.clearcoatRoughnessMap)),s.clearcoatNormalMap!==void 0&&(p.clearcoatNormalMap=d(s.clearcoatNormalMap)),s.clearcoatNormalScale!==void 0&&(p.clearcoatNormalScale=new gt().fromArray(s.clearcoatNormalScale)),s.iridescenceMap!==void 0&&(p.iridescenceMap=d(s.iridescenceMap)),s.iridescenceThicknessMap!==void 0&&(p.iridescenceThicknessMap=d(s.iridescenceThicknessMap)),s.transmissionMap!==void 0&&(p.transmissionMap=d(s.transmissionMap)),s.thicknessMap!==void 0&&(p.thicknessMap=d(s.thicknessMap)),s.sheenColorMap!==void 0&&(p.sheenColorMap=d(s.sheenColorMap)),s.sheenRoughnessMap!==void 0&&(p.sheenRoughnessMap=d(s.sheenRoughnessMap)),p}setTextures(s){return this.textures=s,this}static createMaterialFromType(s){const c={ShadowMaterial:bI,SpriteMaterial:Aw,RawShaderMaterial:CI,ShaderMaterial:Ea,PointsMaterial:xw,MeshPhysicalMaterial:EI,MeshStandardMaterial:Ow,MeshPhongMaterial:SI,MeshToonMaterial:MI,MeshNormalMaterial:TI,MeshLambertMaterial:II,MeshDepthMaterial:pw,MeshDistanceMaterial:mw,MeshBasicMaterial:ol,MeshMatcapMaterial:RI,LineDashedMaterial:PI,LineBasicMaterial:br,Material:cr};return new c[s]}}class Qw{static decodeText(s){if(typeof TextDecoder<"u")return new TextDecoder().decode(s);let c="";for(let d=0,p=s.length;d<p;d++)c+=String.fromCharCode(s[d]);try{return decodeURIComponent(escape(c))}catch{return c}}static extractUrlBase(s){const c=s.lastIndexOf("/");return c===-1?"./":s.slice(0,c+1)}static resolveURL(s,c){return typeof s!="string"||s===""?"":(/^https?:\/\//i.test(c)&&/^\//.test(s)&&(c=c.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(s)||/^data:.*,.*$/i.test(s)||/^blob:.*$/i.test(s)?s:c+s)}}class qI extends si{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(s){return super.copy(s),this.instanceCount=s.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const s=super.toJSON(this);return s.instanceCount=this.instanceCount,s.isInstancedBufferGeometry=!0,s}}class XI extends to{constructor(s){super(s)}load(s,c,d,p){const y=this,w=new Ac(y.manager);w.setPath(y.path),w.setRequestHeader(y.requestHeader),w.setWithCredentials(y.withCredentials),w.load(s,function(E){try{c(y.parse(JSON.parse(E)))}catch(P){p?p(P):console.error(P),y.manager.itemError(s)}},d,p)}parse(s){const c={},d={};function p(z,V){if(c[V]!==void 0)return c[V];const G=z.interleavedBuffers[V],X=y(z,G.buffer),K=td(G.type,X),ne=new a0(K,G.stride);return ne.uuid=G.uuid,c[V]=ne,ne}function y(z,V){if(d[V]!==void 0)return d[V];const G=z.arrayBuffers[V],X=new Uint32Array(G).buffer;return d[V]=X,X}const w=s.isInstancedBufferGeometry?new qI:new si,E=s.data.index;if(E!==void 0){const z=td(E.type,E.array);w.setIndex(new Fi(z,1))}const P=s.data.attributes;for(const z in P){const V=P[z];let H;if(V.isInterleavedBufferAttribute){const G=p(s.data,V.data);H=new Dh(G,V.itemSize,V.offset,V.normalized)}else{const G=td(V.type,V.array),X=V.isInstancedBufferAttribute?Md:Fi;H=new X(G,V.itemSize,V.normalized)}V.name!==void 0&&(H.name=V.name),V.usage!==void 0&&H.setUsage(V.usage),V.updateRange!==void 0&&(H.updateRange.offset=V.updateRange.offset,H.updateRange.count=V.updateRange.count),w.setAttribute(z,H)}const L=s.data.morphAttributes;if(L)for(const z in L){const V=L[z],H=[];for(let G=0,X=V.length;G<X;G++){const K=V[G];let ne;if(K.isInterleavedBufferAttribute){const te=p(s.data,K.data);ne=new Dh(te,K.itemSize,K.offset,K.normalized)}else{const te=td(K.type,K.array);ne=new Fi(te,K.itemSize,K.normalized)}K.name!==void 0&&(ne.name=K.name),H.push(ne)}w.morphAttributes[z]=H}s.data.morphTargetsRelative&&(w.morphTargetsRelative=!0);const k=s.data.groups||s.data.drawcalls||s.data.offsets;if(k!==void 0)for(let z=0,V=k.length;z!==V;++z){const H=k[z];w.addGroup(H.start,H.count,H.materialIndex)}const N=s.data.boundingSphere;if(N!==void 0){const z=new de;N.center!==void 0&&z.fromArray(N.center),w.boundingSphere=new Ph(z,N.radius)}return s.name&&(w.name=s.name),s.userData&&(w.userData=s.userData),w}}class GH extends to{constructor(s){super(s)}load(s,c,d,p){const y=this,w=this.path===""?Qw.extractUrlBase(s):this.path;this.resourcePath=this.resourcePath||w;const E=new Ac(this.manager);E.setPath(this.path),E.setRequestHeader(this.requestHeader),E.setWithCredentials(this.withCredentials),E.load(s,function(P){let L=null;try{L=JSON.parse(P)}catch(k){p!==void 0&&p(k),console.error("THREE:ObjectLoader: Can't parse "+s+".",k.message);return}const O=L.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+s);return}y.parse(L,c)},d,p)}async loadAsync(s,c){const d=this,p=this.path===""?Qw.extractUrlBase(s):this.path;this.resourcePath=this.resourcePath||p;const y=new Ac(this.manager);y.setPath(this.path),y.setRequestHeader(this.requestHeader),y.setWithCredentials(this.withCredentials);const w=await y.loadAsync(s,c),E=JSON.parse(w),P=E.metadata;if(P===void 0||P.type===void 0||P.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+s);return await d.parseAsync(E)}parse(s,c){const d=this.parseAnimations(s.animations),p=this.parseShapes(s.shapes),y=this.parseGeometries(s.geometries,p),w=this.parseImages(s.images,function(){c!==void 0&&c(L)}),E=this.parseTextures(s.textures,w),P=this.parseMaterials(s.materials,E),L=this.parseObject(s.object,y,P,E,d),O=this.parseSkeletons(s.skeletons,L);if(this.bindSkeletons(L,O),c!==void 0){let k=!1;for(const N in w)if(w[N].data instanceof HTMLImageElement){k=!0;break}k===!1&&c(L)}return L}async parseAsync(s){const c=this.parseAnimations(s.animations),d=this.parseShapes(s.shapes),p=this.parseGeometries(s.geometries,d),y=await this.parseImagesAsync(s.images),w=this.parseTextures(s.textures,y),E=this.parseMaterials(s.materials,w),P=this.parseObject(s.object,p,E,w,c),L=this.parseSkeletons(s.skeletons,P);return this.bindSkeletons(P,L),P}parseShapes(s){const c={};if(s!==void 0)for(let d=0,p=s.length;d<p;d++){const y=new Fh().fromJSON(s[d]);c[y.uuid]=y}return c}parseSkeletons(s,c){const d={},p={};if(c.traverse(function(y){y.isBone&&(p[y.uuid]=y)}),s!==void 0)for(let y=0,w=s.length;y<w;y++){const E=new d0().fromJSON(s[y],p);d[E.uuid]=E}return d}parseGeometries(s,c){const d={};if(s!==void 0){const p=new XI;for(let y=0,w=s.length;y<w;y++){let E;const P=s[y];switch(P.type){case"BufferGeometry":case"InstancedBufferGeometry":E=p.parse(P);break;default:P.type in wI?E=wI[P.type].fromJSON(P,c):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${P.type}"`)}E.uuid=P.uuid,P.name!==void 0&&(E.name=P.name),E.isBufferGeometry===!0&&P.userData!==void 0&&(E.userData=P.userData),d[P.uuid]=E}}return d}parseMaterials(s,c){const d={},p={};if(s!==void 0){const y=new M0;y.setTextures(c);for(let w=0,E=s.length;w<E;w++){const P=s[w];d[P.uuid]===void 0&&(d[P.uuid]=y.parse(P)),p[P.uuid]=d[P.uuid]}}return p}parseAnimations(s){const c={};if(s!==void 0)for(let d=0;d<s.length;d++){const p=s[d],y=rm.parse(p);c[y.uuid]=y}return c}parseImages(s,c){const d=this,p={};let y;function w(P){return d.manager.itemStart(P),y.load(P,function(){d.manager.itemEnd(P)},void 0,function(){d.manager.itemError(P),d.manager.itemEnd(P)})}function E(P){if(typeof P=="string"){const L=P,O=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(L)?L:d.resourcePath+L;return w(O)}else return P.data?{data:td(P.type,P.data),width:P.width,height:P.height}:null}if(s!==void 0&&s.length>0){const P=new Gw(c);y=new om(P),y.setCrossOrigin(this.crossOrigin);for(let L=0,O=s.length;L<O;L++){const k=s[L],N=k.url;if(Array.isArray(N)){const z=[];for(let V=0,H=N.length;V<H;V++){const G=N[V],X=E(G);X!==null&&(X instanceof HTMLImageElement?z.push(X):z.push(new Sd(X.data,X.width,X.height)))}p[k.uuid]=new Sh(z)}else{const z=E(k.url);p[k.uuid]=new Sh(z)}}}return p}async parseImagesAsync(s){const c=this,d={};let p;async function y(w){if(typeof w=="string"){const E=w,P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(E)?E:c.resourcePath+E;return await p.loadAsync(P)}else return w.data?{data:td(w.type,w.data),width:w.width,height:w.height}:null}if(s!==void 0&&s.length>0){p=new om(this.manager),p.setCrossOrigin(this.crossOrigin);for(let w=0,E=s.length;w<E;w++){const P=s[w],L=P.url;if(Array.isArray(L)){const O=[];for(let k=0,N=L.length;k<N;k++){const z=L[k],V=await y(z);V!==null&&(V instanceof HTMLImageElement?O.push(V):O.push(new Sd(V.data,V.width,V.height)))}d[P.uuid]=new Sh(O)}else{const O=await y(P.url);d[P.uuid]=new Sh(O)}}}return d}parseTextures(s,c){function d(y,w){return typeof y=="number"?y:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",y),w[y])}const p={};if(s!==void 0)for(let y=0,w=s.length;y<w;y++){const E=s[y];E.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',E.uuid),c[E.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",E.image);const P=c[E.image],L=P.data;let O;Array.isArray(L)?(O=new Bp,L.length===6&&(O.needsUpdate=!0)):(L&&L.data?O=new Sd:O=new Rs,L&&(O.needsUpdate=!0)),O.source=P,O.uuid=E.uuid,E.name!==void 0&&(O.name=E.name),E.mapping!==void 0&&(O.mapping=d(E.mapping,HH)),E.offset!==void 0&&O.offset.fromArray(E.offset),E.repeat!==void 0&&O.repeat.fromArray(E.repeat),E.center!==void 0&&O.center.fromArray(E.center),E.rotation!==void 0&&(O.rotation=E.rotation),E.wrap!==void 0&&(O.wrapS=d(E.wrap[0],YI),O.wrapT=d(E.wrap[1],YI)),E.format!==void 0&&(O.format=E.format),E.type!==void 0&&(O.type=E.type),E.encoding!==void 0&&(O.encoding=E.encoding),E.minFilter!==void 0&&(O.minFilter=d(E.minFilter,JI)),E.magFilter!==void 0&&(O.magFilter=d(E.magFilter,JI)),E.anisotropy!==void 0&&(O.anisotropy=E.anisotropy),E.flipY!==void 0&&(O.flipY=E.flipY),E.premultiplyAlpha!==void 0&&(O.premultiplyAlpha=E.premultiplyAlpha),E.unpackAlignment!==void 0&&(O.unpackAlignment=E.unpackAlignment),E.userData!==void 0&&(O.userData=E.userData),p[E.uuid]=O}return p}parseObject(s,c,d,p,y){let w;function E(N){return c[N]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",N),c[N]}function P(N){if(N!==void 0){if(Array.isArray(N)){const z=[];for(let V=0,H=N.length;V<H;V++){const G=N[V];d[G]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",G),z.push(d[G])}return z}return d[N]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",N),d[N]}}function L(N){return p[N]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",N),p[N]}let O,k;switch(s.type){case"Scene":w=new OT,s.background!==void 0&&(Number.isInteger(s.background)?w.background=new dn(s.background):w.background=L(s.background)),s.environment!==void 0&&(w.environment=L(s.environment)),s.fog!==void 0&&(s.fog.type==="Fog"?w.fog=new o0(s.fog.color,s.fog.near,s.fog.far):s.fog.type==="FogExp2"&&(w.fog=new r0(s.fog.color,s.fog.density)));break;case"PerspectiveCamera":w=new Ks(s.fov,s.aspect,s.near,s.far),s.focus!==void 0&&(w.focus=s.focus),s.zoom!==void 0&&(w.zoom=s.zoom),s.filmGauge!==void 0&&(w.filmGauge=s.filmGauge),s.filmOffset!==void 0&&(w.filmOffset=s.filmOffset),s.view!==void 0&&(w.view=Object.assign({},s.view));break;case"OrthographicCamera":w=new t0(s.left,s.right,s.top,s.bottom,s.near,s.far),s.zoom!==void 0&&(w.zoom=s.zoom),s.view!==void 0&&(w.view=Object.assign({},s.view));break;case"AmbientLight":w=new WI(s.color,s.intensity);break;case"DirectionalLight":w=new VI(s.color,s.intensity);break;case"PointLight":w=new HI(s.color,s.intensity,s.distance,s.decay);break;case"RectAreaLight":w=new QI(s.color,s.intensity,s.width,s.height);break;case"SpotLight":w=new zI(s.color,s.intensity,s.distance,s.angle,s.penumbra,s.decay);break;case"HemisphereLight":w=new kI(s.color,s.groundColor,s.intensity);break;case"LightProbe":w=new S0().fromJSON(s);break;case"SkinnedMesh":O=E(s.geometry),k=P(s.material),w=new jT(O,k),s.bindMode!==void 0&&(w.bindMode=s.bindMode),s.bindMatrix!==void 0&&w.bindMatrix.fromArray(s.bindMatrix),s.skeleton!==void 0&&(w.skeleton=s.skeleton);break;case"Mesh":O=E(s.geometry),k=P(s.material),w=new Js(O,k);break;case"InstancedMesh":O=E(s.geometry),k=P(s.material);const N=s.count,z=s.instanceMatrix,V=s.instanceColor;w=new JT(O,k,N),w.instanceMatrix=new Md(new Float32Array(z.array),16),V!==void 0&&(w.instanceColor=new Md(new Float32Array(V.array),V.itemSize));break;case"LOD":w=new GT;break;case"Line":w=new dl(E(s.geometry),P(s.material));break;case"LineLoop":w=new nI(E(s.geometry),P(s.material));break;case"LineSegments":w=new Sa(E(s.geometry),P(s.material));break;case"PointCloud":case"Points":w=new sI(E(s.geometry),P(s.material));break;case"Sprite":w=new UT(P(s.material));break;case"Group":w=new xd;break;case"Bone":w=new _w;break;default:w=new bi}if(w.uuid=s.uuid,s.name!==void 0&&(w.name=s.name),s.matrix!==void 0?(w.matrix.fromArray(s.matrix),s.matrixAutoUpdate!==void 0&&(w.matrixAutoUpdate=s.matrixAutoUpdate),w.matrixAutoUpdate&&w.matrix.decompose(w.position,w.quaternion,w.scale)):(s.position!==void 0&&w.position.fromArray(s.position),s.rotation!==void 0&&w.rotation.fromArray(s.rotation),s.quaternion!==void 0&&w.quaternion.fromArray(s.quaternion),s.scale!==void 0&&w.scale.fromArray(s.scale)),s.castShadow!==void 0&&(w.castShadow=s.castShadow),s.receiveShadow!==void 0&&(w.receiveShadow=s.receiveShadow),s.shadow&&(s.shadow.bias!==void 0&&(w.shadow.bias=s.shadow.bias),s.shadow.normalBias!==void 0&&(w.shadow.normalBias=s.shadow.normalBias),s.shadow.radius!==void 0&&(w.shadow.radius=s.shadow.radius),s.shadow.mapSize!==void 0&&w.shadow.mapSize.fromArray(s.shadow.mapSize),s.shadow.camera!==void 0&&(w.shadow.camera=this.parseObject(s.shadow.camera))),s.visible!==void 0&&(w.visible=s.visible),s.frustumCulled!==void 0&&(w.frustumCulled=s.frustumCulled),s.renderOrder!==void 0&&(w.renderOrder=s.renderOrder),s.userData!==void 0&&(w.userData=s.userData),s.layers!==void 0&&(w.layers.mask=s.layers),s.children!==void 0){const N=s.children;for(let z=0;z<N.length;z++)w.add(this.parseObject(N[z],c,d,p,y))}if(s.animations!==void 0){const N=s.animations;for(let z=0;z<N.length;z++){const V=N[z];w.animations.push(y[V])}}if(s.type==="LOD"){s.autoUpdate!==void 0&&(w.autoUpdate=s.autoUpdate);const N=s.levels;for(let z=0;z<N.length;z++){const V=N[z],H=w.getObjectByProperty("uuid",V.object);H!==void 0&&w.addLevel(H,V.distance)}}return w}bindSkeletons(s,c){Object.keys(c).length!==0&&s.traverse(function(d){if(d.isSkinnedMesh===!0&&d.skeleton!==void 0){const p=c[d.skeleton];p===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",d.skeleton):d.bind(p,d.bindMatrix)}})}}const HH={UVMapping:Cn,CubeReflectionMapping:Kt,CubeRefractionMapping:ln,EquirectangularReflectionMapping:ii,EquirectangularRefractionMapping:Kn,CubeUVReflectionMapping:me},YI={RepeatWrapping:ce,ClampToEdgeWrapping:je,MirroredRepeatWrapping:yt},JI={NearestFilter:mt,NearestMipmapNearestFilter:Ht,NearestMipmapLinearFilter:be,LinearFilter:Et,LinearMipmapNearestFilter:hn,LinearMipmapLinearFilter:Wt};class VH extends to{constructor(s){super(s),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(s){return this.options=s,this}load(s,c,d,p){s===void 0&&(s=""),this.path!==void 0&&(s=this.path+s),s=this.manager.resolveURL(s);const y=this,w=zh.get(s);if(w!==void 0)return y.manager.itemStart(s),setTimeout(function(){c&&c(w),y.manager.itemEnd(s)},0),w;const E={};E.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",E.headers=this.requestHeader,fetch(s,E).then(function(P){return P.blob()}).then(function(P){return createImageBitmap(P,Object.assign(y.options,{colorSpaceConversion:"none"}))}).then(function(P){zh.add(s,P),c&&c(P),y.manager.itemEnd(s)}).catch(function(P){p&&p(P),y.manager.itemError(s),y.manager.itemEnd(s)}),y.manager.itemStart(s)}}let T0;const jw={getContext:function(){return T0===void 0&&(T0=new(window.AudioContext||window.webkitAudioContext)),T0},setContext:function(_){T0=_}};class WH extends to{constructor(s){super(s)}load(s,c,d,p){const y=this,w=new Ac(this.manager);w.setResponseType("arraybuffer"),w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials),w.load(s,function(E){try{const P=E.slice(0);jw.getContext().decodeAudioData(P,function(O){c(O)})}catch(P){p?p(P):console.error(P),y.manager.itemError(s)}},d,p)}}class QH extends S0{constructor(s,c,d=1){super(void 0,d),this.isHemisphereLightProbe=!0;const p=new dn().set(s),y=new dn().set(c),w=new de(p.r,p.g,p.b),E=new de(y.r,y.g,y.b),P=Math.sqrt(Math.PI),L=P*Math.sqrt(.75);this.sh.coefficients[0].copy(w).add(E).multiplyScalar(P),this.sh.coefficients[1].copy(w).sub(E).multiplyScalar(L)}}class jH extends S0{constructor(s,c=1){super(void 0,c),this.isAmbientLightProbe=!0;const d=new dn().set(s);this.sh.coefficients[0].set(d.r,d.g,d.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const KI=new $n,ZI=new $n,Gh=new $n;class qH{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ks,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ks,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(s){const c=this._cache;if(c.focus!==s.focus||c.fov!==s.fov||c.aspect!==s.aspect*this.aspect||c.near!==s.near||c.far!==s.far||c.zoom!==s.zoom||c.eyeSep!==this.eyeSep){c.focus=s.focus,c.fov=s.fov,c.aspect=s.aspect*this.aspect,c.near=s.near,c.far=s.far,c.zoom=s.zoom,c.eyeSep=this.eyeSep,Gh.copy(s.projectionMatrix);const p=c.eyeSep/2,y=p*c.near/c.focus,w=c.near*Math.tan(Ch*c.fov*.5)/c.zoom;let E,P;ZI.elements[12]=-p,KI.elements[12]=p,E=-w*c.aspect+y,P=w*c.aspect+y,Gh.elements[0]=2*c.near/(P-E),Gh.elements[8]=(P+E)/(P-E),this.cameraL.projectionMatrix.copy(Gh),E=-w*c.aspect-y,P=w*c.aspect-y,Gh.elements[0]=2*c.near/(P-E),Gh.elements[8]=(P+E)/(P-E),this.cameraR.projectionMatrix.copy(Gh)}this.cameraL.matrixWorld.copy(s.matrixWorld).multiply(ZI),this.cameraR.matrixWorld.copy(s.matrixWorld).multiply(KI)}}class $I{constructor(s=!0){this.autoStart=s,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=eR(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let s=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const c=eR();s=(c-this.oldTime)/1e3,this.oldTime=c,this.elapsedTime+=s}return s}}function eR(){return(typeof performance>"u"?Date:performance).now()}const Hh=new de,tR=new Nr,XH=new de,Vh=new de;class YH extends bi{constructor(){super(),this.type="AudioListener",this.context=jw.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new $I}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(s){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=s,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(s){return this.gain.gain.setTargetAtTime(s,this.context.currentTime,.01),this}updateMatrixWorld(s){super.updateMatrixWorld(s);const c=this.context.listener,d=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Hh,tR,XH),Vh.set(0,0,-1).applyQuaternion(tR),c.positionX){const p=this.context.currentTime+this.timeDelta;c.positionX.linearRampToValueAtTime(Hh.x,p),c.positionY.linearRampToValueAtTime(Hh.y,p),c.positionZ.linearRampToValueAtTime(Hh.z,p),c.forwardX.linearRampToValueAtTime(Vh.x,p),c.forwardY.linearRampToValueAtTime(Vh.y,p),c.forwardZ.linearRampToValueAtTime(Vh.z,p),c.upX.linearRampToValueAtTime(d.x,p),c.upY.linearRampToValueAtTime(d.y,p),c.upZ.linearRampToValueAtTime(d.z,p)}else c.setPosition(Hh.x,Hh.y,Hh.z),c.setOrientation(Vh.x,Vh.y,Vh.z,d.x,d.y,d.z)}}class nR extends bi{constructor(s){super(),this.type="Audio",this.listener=s,this.context=s.context,this.gain=this.context.createGain(),this.gain.connect(s.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(s){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=s,this.connect(),this}setMediaElementSource(s){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(s),this.connect(),this}setMediaStreamSource(s){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(s),this.connect(),this}setBuffer(s){return this.buffer=s,this.sourceType="buffer",this.autoplay&&this.play(),this}play(s=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+s;const c=this.context.createBufferSource();return c.buffer=this.buffer,c.loop=this.loop,c.loopStart=this.loopStart,c.loopEnd=this.loopEnd,c.onended=this.onEnded.bind(this),c.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=c,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let s=1,c=this.filters.length;s<c;s++)this.filters[s-1].connect(this.filters[s]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let s=1,c=this.filters.length;s<c;s++)this.filters[s-1].disconnect(this.filters[s]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(s){return s||(s=[]),this._connected===!0?(this.disconnect(),this.filters=s.slice(),this.connect()):this.filters=s.slice(),this}setDetune(s){if(this.detune=s,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(s){return this.setFilters(s?[s]:[])}setPlaybackRate(s){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=s,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(s){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=s,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(s){return this.loopStart=s,this}setLoopEnd(s){return this.loopEnd=s,this}getVolume(){return this.gain.gain.value}setVolume(s){return this.gain.gain.setTargetAtTime(s,this.context.currentTime,.01),this}}const Wh=new de,iR=new Nr,JH=new de,Qh=new de;class KH extends nR{constructor(s){super(s),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(s){return this.panner.refDistance=s,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(s){return this.panner.rolloffFactor=s,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(s){return this.panner.distanceModel=s,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(s){return this.panner.maxDistance=s,this}setDirectionalCone(s,c,d){return this.panner.coneInnerAngle=s,this.panner.coneOuterAngle=c,this.panner.coneOuterGain=d,this}updateMatrixWorld(s){if(super.updateMatrixWorld(s),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Wh,iR,JH),Qh.set(0,0,1).applyQuaternion(iR);const c=this.panner;if(c.positionX){const d=this.context.currentTime+this.listener.timeDelta;c.positionX.linearRampToValueAtTime(Wh.x,d),c.positionY.linearRampToValueAtTime(Wh.y,d),c.positionZ.linearRampToValueAtTime(Wh.z,d),c.orientationX.linearRampToValueAtTime(Qh.x,d),c.orientationY.linearRampToValueAtTime(Qh.y,d),c.orientationZ.linearRampToValueAtTime(Qh.z,d)}else c.setPosition(Wh.x,Wh.y,Wh.z),c.setOrientation(Qh.x,Qh.y,Qh.z)}}class ZH{constructor(s,c=2048){this.analyser=s.context.createAnalyser(),this.analyser.fftSize=c,this.data=new Uint8Array(this.analyser.frequencyBinCount),s.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let s=0;const c=this.getFrequencyData();for(let d=0;d<c.length;d++)s+=c[d];return s/c.length}}class sR{constructor(s,c,d){this.binding=s,this.valueSize=d;let p,y,w;switch(c){case"quaternion":p=this._slerp,y=this._slerpAdditive,w=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(d*6),this._workIndex=5;break;case"string":case"bool":p=this._select,y=this._select,w=this._setAdditiveIdentityOther,this.buffer=new Array(d*5);break;default:p=this._lerp,y=this._lerpAdditive,w=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(d*5)}this._mixBufferRegion=p,this._mixBufferRegionAdditive=y,this._setIdentity=w,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(s,c){const d=this.buffer,p=this.valueSize,y=s*p+p;let w=this.cumulativeWeight;if(w===0){for(let E=0;E!==p;++E)d[y+E]=d[E];w=c}else{w+=c;const E=c/w;this._mixBufferRegion(d,y,0,E,p)}this.cumulativeWeight=w}accumulateAdditive(s){const c=this.buffer,d=this.valueSize,p=d*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(c,p,0,s,d),this.cumulativeWeightAdditive+=s}apply(s){const c=this.valueSize,d=this.buffer,p=s*c+c,y=this.cumulativeWeight,w=this.cumulativeWeightAdditive,E=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,y<1){const P=c*this._origIndex;this._mixBufferRegion(d,p,P,1-y,c)}w>0&&this._mixBufferRegionAdditive(d,p,this._addIndex*c,1,c);for(let P=c,L=c+c;P!==L;++P)if(d[P]!==d[P+c]){E.setValue(d,p);break}}saveOriginalState(){const s=this.binding,c=this.buffer,d=this.valueSize,p=d*this._origIndex;s.getValue(c,p);for(let y=d,w=p;y!==w;++y)c[y]=c[p+y%d];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const s=this.valueSize*3;this.binding.setValue(this.buffer,s)}_setAdditiveIdentityNumeric(){const s=this._addIndex*this.valueSize,c=s+this.valueSize;for(let d=s;d<c;d++)this.buffer[d]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const s=this._origIndex*this.valueSize,c=this._addIndex*this.valueSize;for(let d=0;d<this.valueSize;d++)this.buffer[c+d]=this.buffer[s+d]}_select(s,c,d,p,y){if(p>=.5)for(let w=0;w!==y;++w)s[c+w]=s[d+w]}_slerp(s,c,d,p){Nr.slerpFlat(s,c,s,c,s,d,p)}_slerpAdditive(s,c,d,p,y){const w=this._workIndex*y;Nr.multiplyQuaternionsFlat(s,w,s,c,s,d),Nr.slerpFlat(s,c,s,c,s,w,p)}_lerp(s,c,d,p,y){const w=1-p;for(let E=0;E!==y;++E){const P=c+E;s[P]=s[P]*w+s[d+E]*p}}_lerpAdditive(s,c,d,p,y){for(let w=0;w!==y;++w){const E=c+w;s[E]=s[E]+s[d+w]*p}}}const qw="\\[\\]\\.:\\/",$H=new RegExp("["+qw+"]","g"),Xw="[^"+qw+"]",e5="[^"+qw.replace("\\.","")+"]",t5=/((?:WC+[\/:])*)/.source.replace("WC",Xw),n5=/(WCOD+)?/.source.replace("WCOD",e5),i5=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Xw),s5=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Xw),r5=new RegExp("^"+t5+n5+i5+s5+"$"),o5=["material","materials","bones","map"];class a5{constructor(s,c,d){const p=d||mi.parseTrackName(c);this._targetGroup=s,this._bindings=s.subscribe_(c,p)}getValue(s,c){this.bind();const d=this._targetGroup.nCachedObjects_,p=this._bindings[d];p!==void 0&&p.getValue(s,c)}setValue(s,c){const d=this._bindings;for(let p=this._targetGroup.nCachedObjects_,y=d.length;p!==y;++p)d[p].setValue(s,c)}bind(){const s=this._bindings;for(let c=this._targetGroup.nCachedObjects_,d=s.length;c!==d;++c)s[c].bind()}unbind(){const s=this._bindings;for(let c=this._targetGroup.nCachedObjects_,d=s.length;c!==d;++c)s[c].unbind()}}class mi{constructor(s,c,d){this.path=c,this.parsedPath=d||mi.parseTrackName(c),this.node=mi.findNode(s,this.parsedPath.nodeName)||s,this.rootNode=s,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(s,c,d){return s&&s.isAnimationObjectGroup?new mi.Composite(s,c,d):new mi(s,c,d)}static sanitizeNodeName(s){return s.replace(/\s/g,"_").replace($H,"")}static parseTrackName(s){const c=r5.exec(s);if(c===null)throw new Error("PropertyBinding: Cannot parse trackName: "+s);const d={nodeName:c[2],objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]},p=d.nodeName&&d.nodeName.lastIndexOf(".");if(p!==void 0&&p!==-1){const y=d.nodeName.substring(p+1);o5.indexOf(y)!==-1&&(d.nodeName=d.nodeName.substring(0,p),d.objectName=y)}if(d.propertyName===null||d.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+s);return d}static findNode(s,c){if(c===void 0||c===""||c==="."||c===-1||c===s.name||c===s.uuid)return s;if(s.skeleton){const d=s.skeleton.getBoneByName(c);if(d!==void 0)return d}if(s.children){const d=function(y){for(let w=0;w<y.length;w++){const E=y[w];if(E.name===c||E.uuid===c)return E;const P=d(E.children);if(P)return P}return null},p=d(s.children);if(p)return p}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(s,c){s[c]=this.targetObject[this.propertyName]}_getValue_array(s,c){const d=this.resolvedProperty;for(let p=0,y=d.length;p!==y;++p)s[c++]=d[p]}_getValue_arrayElement(s,c){s[c]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(s,c){this.resolvedProperty.toArray(s,c)}_setValue_direct(s,c){this.targetObject[this.propertyName]=s[c]}_setValue_direct_setNeedsUpdate(s,c){this.targetObject[this.propertyName]=s[c],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(s,c){this.targetObject[this.propertyName]=s[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(s,c){const d=this.resolvedProperty;for(let p=0,y=d.length;p!==y;++p)d[p]=s[c++]}_setValue_array_setNeedsUpdate(s,c){const d=this.resolvedProperty;for(let p=0,y=d.length;p!==y;++p)d[p]=s[c++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(s,c){const d=this.resolvedProperty;for(let p=0,y=d.length;p!==y;++p)d[p]=s[c++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(s,c){this.resolvedProperty[this.propertyIndex]=s[c]}_setValue_arrayElement_setNeedsUpdate(s,c){this.resolvedProperty[this.propertyIndex]=s[c],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(s,c){this.resolvedProperty[this.propertyIndex]=s[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(s,c){this.resolvedProperty.fromArray(s,c)}_setValue_fromArray_setNeedsUpdate(s,c){this.resolvedProperty.fromArray(s,c),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(s,c){this.resolvedProperty.fromArray(s,c),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(s,c){this.bind(),this.getValue(s,c)}_setValue_unbound(s,c){this.bind(),this.setValue(s,c)}bind(){let s=this.node;const c=this.parsedPath,d=c.objectName,p=c.propertyName;let y=c.propertyIndex;if(s||(s=mi.findNode(this.rootNode,c.nodeName)||this.rootNode,this.node=s),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!s){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(d){let L=c.objectIndex;switch(d){case"materials":if(!s.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!s.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}s=s.material.materials;break;case"bones":if(!s.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}s=s.skeleton.bones;for(let O=0;O<s.length;O++)if(s[O].name===L){L=O;break}break;case"map":if("map"in s){s=s.map;break}if(!s.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!s.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}s=s.material.map;break;default:if(s[d]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}s=s[d]}if(L!==void 0){if(s[L]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,s);return}s=s[L]}}const w=s[p];if(w===void 0){const L=c.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+L+"."+p+" but it wasn't found.",s);return}let E=this.Versioning.None;this.targetObject=s,s.needsUpdate!==void 0?E=this.Versioning.NeedsUpdate:s.matrixWorldNeedsUpdate!==void 0&&(E=this.Versioning.MatrixWorldNeedsUpdate);let P=this.BindingType.Direct;if(y!==void 0){if(p==="morphTargetInfluences"){if(!s.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!s.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}s.morphTargetDictionary[y]!==void 0&&(y=s.morphTargetDictionary[y])}P=this.BindingType.ArrayElement,this.resolvedProperty=w,this.propertyIndex=y}else w.fromArray!==void 0&&w.toArray!==void 0?(P=this.BindingType.HasFromToArray,this.resolvedProperty=w):Array.isArray(w)?(P=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=p;this.getValue=this.GetterByBindingType[P],this.setValue=this.SetterByBindingTypeAndVersioning[P][E]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}mi.Composite=a5,mi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},mi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},mi.prototype.GetterByBindingType=[mi.prototype._getValue_direct,mi.prototype._getValue_array,mi.prototype._getValue_arrayElement,mi.prototype._getValue_toArray],mi.prototype.SetterByBindingTypeAndVersioning=[[mi.prototype._setValue_direct,mi.prototype._setValue_direct_setNeedsUpdate,mi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_array,mi.prototype._setValue_array_setNeedsUpdate,mi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_arrayElement,mi.prototype._setValue_arrayElement_setNeedsUpdate,mi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_fromArray,mi.prototype._setValue_fromArray_setNeedsUpdate,mi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class c5{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Zr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const s={};this._indicesByUUID=s;for(let d=0,p=arguments.length;d!==p;++d)s[arguments[d].uuid]=d;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const c=this;this.stats={objects:{get total(){return c._objects.length},get inUse(){return this.total-c.nCachedObjects_}},get bindingsPerObject(){return c._bindings.length}}}add(){const s=this._objects,c=this._indicesByUUID,d=this._paths,p=this._parsedPaths,y=this._bindings,w=y.length;let E,P=s.length,L=this.nCachedObjects_;for(let O=0,k=arguments.length;O!==k;++O){const N=arguments[O],z=N.uuid;let V=c[z];if(V===void 0){V=P++,c[z]=V,s.push(N);for(let H=0,G=w;H!==G;++H)y[H].push(new mi(N,d[H],p[H]))}else if(V<L){E=s[V];const H=--L,G=s[H];c[G.uuid]=V,s[V]=G,c[z]=H,s[H]=N;for(let X=0,K=w;X!==K;++X){const ne=y[X],te=ne[H];let oe=ne[V];ne[V]=te,oe===void 0&&(oe=new mi(N,d[X],p[X])),ne[H]=oe}}else s[V]!==E&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=L}remove(){const s=this._objects,c=this._indicesByUUID,d=this._bindings,p=d.length;let y=this.nCachedObjects_;for(let w=0,E=arguments.length;w!==E;++w){const P=arguments[w],L=P.uuid,O=c[L];if(O!==void 0&&O>=y){const k=y++,N=s[k];c[N.uuid]=O,s[O]=N,c[L]=k,s[k]=P;for(let z=0,V=p;z!==V;++z){const H=d[z],G=H[k],X=H[O];H[O]=G,H[k]=X}}}this.nCachedObjects_=y}uncache(){const s=this._objects,c=this._indicesByUUID,d=this._bindings,p=d.length;let y=this.nCachedObjects_,w=s.length;for(let E=0,P=arguments.length;E!==P;++E){const L=arguments[E],O=L.uuid,k=c[O];if(k!==void 0)if(delete c[O],k<y){const N=--y,z=s[N],V=--w,H=s[V];c[z.uuid]=k,s[k]=z,c[H.uuid]=N,s[N]=H,s.pop();for(let G=0,X=p;G!==X;++G){const K=d[G],ne=K[N],te=K[V];K[k]=ne,K[N]=te,K.pop()}}else{const N=--w,z=s[N];N>0&&(c[z.uuid]=k),s[k]=z,s.pop();for(let V=0,H=p;V!==H;++V){const G=d[V];G[k]=G[N],G.pop()}}}this.nCachedObjects_=y}subscribe_(s,c){const d=this._bindingsIndicesByPath;let p=d[s];const y=this._bindings;if(p!==void 0)return y[p];const w=this._paths,E=this._parsedPaths,P=this._objects,L=P.length,O=this.nCachedObjects_,k=new Array(L);p=y.length,d[s]=p,w.push(s),E.push(c),y.push(k);for(let N=O,z=P.length;N!==z;++N){const V=P[N];k[N]=new mi(V,s,c)}return k}unsubscribe_(s){const c=this._bindingsIndicesByPath,d=c[s];if(d!==void 0){const p=this._paths,y=this._parsedPaths,w=this._bindings,E=w.length-1,P=w[E],L=s[E];c[L]=d,w[d]=P,w.pop(),y[d]=y[E],y.pop(),p[d]=p[E],p.pop()}}}class l5{constructor(s,c,d=null,p=c.blendMode){this._mixer=s,this._clip=c,this._localRoot=d,this.blendMode=p;const y=c.tracks,w=y.length,E=new Array(w),P={endingStart:_o,endingEnd:_o};for(let L=0;L!==w;++L){const O=y[L].createInterpolant(null);E[L]=O,O.settings=P}this._interpolantSettings=P,this._interpolants=E,this._propertyBindings=new Array(w),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=wi,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(s){return this._startTime=s,this}setLoop(s,c){return this.loop=s,this.repetitions=c,this}setEffectiveWeight(s){return this.weight=s,this._effectiveWeight=this.enabled?s:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(s){return this._scheduleFading(s,0,1)}fadeOut(s){return this._scheduleFading(s,1,0)}crossFadeFrom(s,c,d){if(s.fadeOut(c),this.fadeIn(c),d){const p=this._clip.duration,y=s._clip.duration,w=y/p,E=p/y;s.warp(1,w,c),this.warp(E,1,c)}return this}crossFadeTo(s,c,d){return s.crossFadeFrom(this,c,d)}stopFading(){const s=this._weightInterpolant;return s!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this}setEffectiveTimeScale(s){return this.timeScale=s,this._effectiveTimeScale=this.paused?0:s,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(s){return this.timeScale=this._clip.duration/s,this.stopWarping()}syncWith(s){return this.time=s.time,this.timeScale=s.timeScale,this.stopWarping()}halt(s){return this.warp(this._effectiveTimeScale,0,s)}warp(s,c,d){const p=this._mixer,y=p.time,w=this.timeScale;let E=this._timeScaleInterpolant;E===null&&(E=p._lendControlInterpolant(),this._timeScaleInterpolant=E);const P=E.parameterPositions,L=E.sampleValues;return P[0]=y,P[1]=y+d,L[0]=s/w,L[1]=c/w,this}stopWarping(){const s=this._timeScaleInterpolant;return s!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(s,c,d,p){if(!this.enabled){this._updateWeight(s);return}const y=this._startTime;if(y!==null){const P=(s-y)*d;P<0||d===0?c=0:(this._startTime=null,c=d*P)}c*=this._updateTimeScale(s);const w=this._updateTime(c),E=this._updateWeight(s);if(E>0){const P=this._interpolants,L=this._propertyBindings;switch(this.blendMode){case Dx:for(let O=0,k=P.length;O!==k;++O)P[O].evaluate(w),L[O].accumulateAdditive(E);break;case MA:default:for(let O=0,k=P.length;O!==k;++O)P[O].evaluate(w),L[O].accumulate(p,E)}}}_updateWeight(s){let c=0;if(this.enabled){c=this.weight;const d=this._weightInterpolant;if(d!==null){const p=d.evaluate(s)[0];c*=p,s>d.parameterPositions[1]&&(this.stopFading(),p===0&&(this.enabled=!1))}}return this._effectiveWeight=c,c}_updateTimeScale(s){let c=0;if(!this.paused){c=this.timeScale;const d=this._timeScaleInterpolant;d!==null&&(c*=d.evaluate(s)[0],s>d.parameterPositions[1]&&(this.stopWarping(),c===0?this.paused=!0:this.timeScale=c))}return this._effectiveTimeScale=c,c}_updateTime(s){const c=this._clip.duration,d=this.loop;let p=this.time+s,y=this._loopCount;const w=d===Ri;if(s===0)return y===-1?p:w&&(y&1)===1?c-p:p;if(d===Yi){y===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(p>=c)p=c;else if(p<0)p=0;else{this.time=p;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=p,this._mixer.dispatchEvent({type:"finished",action:this,direction:s<0?-1:1})}}else{if(y===-1&&(s>=0?(y=0,this._setEndings(!0,this.repetitions===0,w)):this._setEndings(this.repetitions===0,!0,w)),p>=c||p<0){const E=Math.floor(p/c);p-=c*E,y+=Math.abs(E);const P=this.repetitions-y;if(P<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,p=s>0?c:0,this.time=p,this._mixer.dispatchEvent({type:"finished",action:this,direction:s>0?1:-1});else{if(P===1){const L=s<0;this._setEndings(L,!L,w)}else this._setEndings(!1,!1,w);this._loopCount=y,this.time=p,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:E})}}else this.time=p;if(w&&(y&1)===1)return c-p}return p}_setEndings(s,c,d){const p=this._interpolantSettings;d?(p.endingStart=bh,p.endingEnd=bh):(s?p.endingStart=this.zeroSlopeAtStart?bh:_o:p.endingStart=wp,c?p.endingEnd=this.zeroSlopeAtEnd?bh:_o:p.endingEnd=wp)}_scheduleFading(s,c,d){const p=this._mixer,y=p.time;let w=this._weightInterpolant;w===null&&(w=p._lendControlInterpolant(),this._weightInterpolant=w);const E=w.parameterPositions,P=w.sampleValues;return E[0]=y,P[0]=c,E[1]=y+s,P[1]=d,this}}const h5=new Float32Array(1);class u5 extends cc{constructor(s){super(),this._root=s,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(s,c){const d=s._localRoot||this._root,p=s._clip.tracks,y=p.length,w=s._propertyBindings,E=s._interpolants,P=d.uuid,L=this._bindingsByRootAndName;let O=L[P];O===void 0&&(O={},L[P]=O);for(let k=0;k!==y;++k){const N=p[k],z=N.name;let V=O[z];if(V!==void 0)++V.referenceCount,w[k]=V;else{if(V=w[k],V!==void 0){V._cacheIndex===null&&(++V.referenceCount,this._addInactiveBinding(V,P,z));continue}const H=c&&c._propertyBindings[k].binding.parsedPath;V=new sR(mi.create(d,z,H),N.ValueTypeName,N.getValueSize()),++V.referenceCount,this._addInactiveBinding(V,P,z),w[k]=V}E[k].resultBuffer=V.buffer}}_activateAction(s){if(!this._isActiveAction(s)){if(s._cacheIndex===null){const d=(s._localRoot||this._root).uuid,p=s._clip.uuid,y=this._actionsByClip[p];this._bindAction(s,y&&y.knownActions[0]),this._addInactiveAction(s,p,d)}const c=s._propertyBindings;for(let d=0,p=c.length;d!==p;++d){const y=c[d];y.useCount++===0&&(this._lendBinding(y),y.saveOriginalState())}this._lendAction(s)}}_deactivateAction(s){if(this._isActiveAction(s)){const c=s._propertyBindings;for(let d=0,p=c.length;d!==p;++d){const y=c[d];--y.useCount===0&&(y.restoreOriginalState(),this._takeBackBinding(y))}this._takeBackAction(s)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const s=this;this.stats={actions:{get total(){return s._actions.length},get inUse(){return s._nActiveActions}},bindings:{get total(){return s._bindings.length},get inUse(){return s._nActiveBindings}},controlInterpolants:{get total(){return s._controlInterpolants.length},get inUse(){return s._nActiveControlInterpolants}}}}_isActiveAction(s){const c=s._cacheIndex;return c!==null&&c<this._nActiveActions}_addInactiveAction(s,c,d){const p=this._actions,y=this._actionsByClip;let w=y[c];if(w===void 0)w={knownActions:[s],actionByRoot:{}},s._byClipCacheIndex=0,y[c]=w;else{const E=w.knownActions;s._byClipCacheIndex=E.length,E.push(s)}s._cacheIndex=p.length,p.push(s),w.actionByRoot[d]=s}_removeInactiveAction(s){const c=this._actions,d=c[c.length-1],p=s._cacheIndex;d._cacheIndex=p,c[p]=d,c.pop(),s._cacheIndex=null;const y=s._clip.uuid,w=this._actionsByClip,E=w[y],P=E.knownActions,L=P[P.length-1],O=s._byClipCacheIndex;L._byClipCacheIndex=O,P[O]=L,P.pop(),s._byClipCacheIndex=null;const k=E.actionByRoot,N=(s._localRoot||this._root).uuid;delete k[N],P.length===0&&delete w[y],this._removeInactiveBindingsForAction(s)}_removeInactiveBindingsForAction(s){const c=s._propertyBindings;for(let d=0,p=c.length;d!==p;++d){const y=c[d];--y.referenceCount===0&&this._removeInactiveBinding(y)}}_lendAction(s){const c=this._actions,d=s._cacheIndex,p=this._nActiveActions++,y=c[p];s._cacheIndex=p,c[p]=s,y._cacheIndex=d,c[d]=y}_takeBackAction(s){const c=this._actions,d=s._cacheIndex,p=--this._nActiveActions,y=c[p];s._cacheIndex=p,c[p]=s,y._cacheIndex=d,c[d]=y}_addInactiveBinding(s,c,d){const p=this._bindingsByRootAndName,y=this._bindings;let w=p[c];w===void 0&&(w={},p[c]=w),w[d]=s,s._cacheIndex=y.length,y.push(s)}_removeInactiveBinding(s){const c=this._bindings,d=s.binding,p=d.rootNode.uuid,y=d.path,w=this._bindingsByRootAndName,E=w[p],P=c[c.length-1],L=s._cacheIndex;P._cacheIndex=L,c[L]=P,c.pop(),delete E[y],Object.keys(E).length===0&&delete w[p]}_lendBinding(s){const c=this._bindings,d=s._cacheIndex,p=this._nActiveBindings++,y=c[p];s._cacheIndex=p,c[p]=s,y._cacheIndex=d,c[d]=y}_takeBackBinding(s){const c=this._bindings,d=s._cacheIndex,p=--this._nActiveBindings,y=c[p];s._cacheIndex=p,c[p]=s,y._cacheIndex=d,c[d]=y}_lendControlInterpolant(){const s=this._controlInterpolants,c=this._nActiveControlInterpolants++;let d=s[c];return d===void 0&&(d=new Uw(new Float32Array(2),new Float32Array(2),1,h5),d.__cacheIndex=c,s[c]=d),d}_takeBackControlInterpolant(s){const c=this._controlInterpolants,d=s.__cacheIndex,p=--this._nActiveControlInterpolants,y=c[p];s.__cacheIndex=p,c[p]=s,y.__cacheIndex=d,c[d]=y}clipAction(s,c,d){const p=c||this._root,y=p.uuid;let w=typeof s=="string"?rm.findByName(p,s):s;const E=w!==null?w.uuid:s,P=this._actionsByClip[E];let L=null;if(d===void 0&&(w!==null?d=w.blendMode:d=MA),P!==void 0){const k=P.actionByRoot[y];if(k!==void 0&&k.blendMode===d)return k;L=P.knownActions[0],w===null&&(w=L._clip)}if(w===null)return null;const O=new l5(this,w,c,d);return this._bindAction(O,L),this._addInactiveAction(O,E,y),O}existingAction(s,c){const d=c||this._root,p=d.uuid,y=typeof s=="string"?rm.findByName(d,s):s,w=y?y.uuid:s,E=this._actionsByClip[w];return E!==void 0&&E.actionByRoot[p]||null}stopAllAction(){const s=this._actions,c=this._nActiveActions;for(let d=c-1;d>=0;--d)s[d].stop();return this}update(s){s*=this.timeScale;const c=this._actions,d=this._nActiveActions,p=this.time+=s,y=Math.sign(s),w=this._accuIndex^=1;for(let L=0;L!==d;++L)c[L]._update(p,s,y,w);const E=this._bindings,P=this._nActiveBindings;for(let L=0;L!==P;++L)E[L].apply(w);return this}setTime(s){this.time=0;for(let c=0;c<this._actions.length;c++)this._actions[c].time=0;return this.update(s)}getRoot(){return this._root}uncacheClip(s){const c=this._actions,d=s.uuid,p=this._actionsByClip,y=p[d];if(y!==void 0){const w=y.knownActions;for(let E=0,P=w.length;E!==P;++E){const L=w[E];this._deactivateAction(L);const O=L._cacheIndex,k=c[c.length-1];L._cacheIndex=null,L._byClipCacheIndex=null,k._cacheIndex=O,c[O]=k,c.pop(),this._removeInactiveBindingsForAction(L)}delete p[d]}}uncacheRoot(s){const c=s.uuid,d=this._actionsByClip;for(const w in d){const E=d[w].actionByRoot,P=E[c];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const p=this._bindingsByRootAndName,y=p[c];if(y!==void 0)for(const w in y){const E=y[w];E.restoreOriginalState(),this._removeInactiveBinding(E)}}uncacheAction(s,c){const d=this.existingAction(s,c);d!==null&&(this._deactivateAction(d),this._removeInactiveAction(d))}}class Yw{constructor(s){this.value=s}clone(){return new Yw(this.value.clone===void 0?this.value:this.value.clone())}}let d5=0;class f5 extends cc{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:d5++}),this.name="",this.usage=bp,this.uniforms=[]}add(s){return this.uniforms.push(s),this}remove(s){const c=this.uniforms.indexOf(s);return c!==-1&&this.uniforms.splice(c,1),this}setName(s){return this.name=s,this}setUsage(s){return this.usage=s,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(s){this.name=s.name,this.usage=s.usage;const c=s.uniforms;this.uniforms.length=0;for(let d=0,p=c.length;d<p;d++)this.uniforms.push(c[d].clone());return this}clone(){return new this.constructor().copy(this)}}class p5 extends a0{constructor(s,c,d=1){super(s,c),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=d}copy(s){return super.copy(s),this.meshPerAttribute=s.meshPerAttribute,this}clone(s){const c=super.clone(s);return c.meshPerAttribute=this.meshPerAttribute,c}toJSON(s){const c=super.toJSON(s);return c.isInstancedInterleavedBuffer=!0,c.meshPerAttribute=this.meshPerAttribute,c}}class m5{constructor(s,c,d,p,y){this.isGLBufferAttribute=!0,this.buffer=s,this.type=c,this.itemSize=d,this.elementSize=p,this.count=y,this.version=0}set needsUpdate(s){s===!0&&this.version++}setBuffer(s){return this.buffer=s,this}setType(s,c){return this.type=s,this.elementSize=c,this}setItemSize(s){return this.itemSize=s,this}setCount(s){return this.count=s,this}}class g5{constructor(s,c,d=0,p=1/0){this.ray=new Ip(s,c),this.near=d,this.far=p,this.camera=null,this.layers=new GA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(s,c){this.ray.set(s,c)}setFromCamera(s,c){c.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(s.x,s.y,.5).unproject(c).sub(this.ray.origin).normalize(),this.camera=c):c.isOrthographicCamera?(this.ray.origin.set(s.x,s.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld),this.camera=c):console.error("THREE.Raycaster: Unsupported camera type: "+c.type)}intersectObject(s,c=!0,d=[]){return Jw(s,this,d,c),d.sort(rR),d}intersectObjects(s,c=!0,d=[]){for(let p=0,y=s.length;p<y;p++)Jw(s[p],this,d,c);return d.sort(rR),d}}function rR(_,s){return _.distance-s.distance}function Jw(_,s,c,d){if(_.layers.test(s.layers)&&_.raycast(s,c),d===!0){const p=_.children;for(let y=0,w=p.length;y<w;y++)Jw(p[y],s,c,!0)}}class A5{constructor(s=1,c=0,d=0){return this.radius=s,this.phi=c,this.theta=d,this}set(s,c,d){return this.radius=s,this.phi=c,this.theta=d,this}copy(s){return this.radius=s.radius,this.phi=s.phi,this.theta=s.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(s){return this.setFromCartesianCoords(s.x,s.y,s.z)}setFromCartesianCoords(s,c,d){return this.radius=Math.sqrt(s*s+c*c+d*d),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(s,d),this.phi=Math.acos(fs(c/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class y5{constructor(s=1,c=0,d=0){return this.radius=s,this.theta=c,this.y=d,this}set(s,c,d){return this.radius=s,this.theta=c,this.y=d,this}copy(s){return this.radius=s.radius,this.theta=s.theta,this.y=s.y,this}setFromVector3(s){return this.setFromCartesianCoords(s.x,s.y,s.z)}setFromCartesianCoords(s,c,d){return this.radius=Math.sqrt(s*s+d*d),this.theta=Math.atan2(s,d),this.y=c,this}clone(){return new this.constructor().copy(this)}}const oR=new gt;class _5{constructor(s=new gt(1/0,1/0),c=new gt(-1/0,-1/0)){this.isBox2=!0,this.min=s,this.max=c}set(s,c){return this.min.copy(s),this.max.copy(c),this}setFromPoints(s){this.makeEmpty();for(let c=0,d=s.length;c<d;c++)this.expandByPoint(s[c]);return this}setFromCenterAndSize(s,c){const d=oR.copy(c).multiplyScalar(.5);return this.min.copy(s).sub(d),this.max.copy(s).add(d),this}clone(){return new this.constructor().copy(this)}copy(s){return this.min.copy(s.min),this.max.copy(s.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(s){return this.isEmpty()?s.set(0,0):s.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(s){return this.isEmpty()?s.set(0,0):s.subVectors(this.max,this.min)}expandByPoint(s){return this.min.min(s),this.max.max(s),this}expandByVector(s){return this.min.sub(s),this.max.add(s),this}expandByScalar(s){return this.min.addScalar(-s),this.max.addScalar(s),this}containsPoint(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y)}containsBox(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y}getParameter(s,c){return c.set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y)}clampPoint(s,c){return c.copy(s).clamp(this.min,this.max)}distanceToPoint(s){return oR.copy(s).clamp(this.min,this.max).sub(s).length()}intersect(s){return this.min.max(s.min),this.max.min(s.max),this}union(s){return this.min.min(s.min),this.max.max(s.max),this}translate(s){return this.min.add(s),this.max.add(s),this}equals(s){return s.min.equals(this.min)&&s.max.equals(this.max)}}const aR=new de,I0=new de;class v5{constructor(s=new de,c=new de){this.start=s,this.end=c}set(s,c){return this.start.copy(s),this.end.copy(c),this}copy(s){return this.start.copy(s.start),this.end.copy(s.end),this}getCenter(s){return s.addVectors(this.start,this.end).multiplyScalar(.5)}delta(s){return s.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(s,c){return this.delta(c).multiplyScalar(s).add(this.start)}closestPointToPointParameter(s,c){aR.subVectors(s,this.start),I0.subVectors(this.end,this.start);const d=I0.dot(I0);let y=I0.dot(aR)/d;return c&&(y=fs(y,0,1)),y}closestPointToPoint(s,c,d){const p=this.closestPointToPointParameter(s,c);return this.delta(d).multiplyScalar(p).add(this.start)}applyMatrix4(s){return this.start.applyMatrix4(s),this.end.applyMatrix4(s),this}equals(s){return s.start.equals(this.start)&&s.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const cR=new de;class x5 extends bi{constructor(s,c){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=c;const d=new si,p=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let w=0,E=1,P=32;w<P;w++,E++){const L=w/P*Math.PI*2,O=E/P*Math.PI*2;p.push(Math.cos(L),Math.sin(L),1,Math.cos(O),Math.sin(O),1)}d.setAttribute("position",new An(p,3));const y=new br({fog:!1,toneMapped:!1});this.cone=new Sa(d,y),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const s=this.light.distance?this.light.distance:1e3,c=s*Math.tan(this.light.angle);this.cone.scale.set(c,c,s),cR.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(cR),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ml=new de,R0=new $n,Kw=new $n;class w5 extends Sa{constructor(s){const c=lR(s),d=new si,p=[],y=[],w=new dn(0,0,1),E=new dn(0,1,0);for(let L=0;L<c.length;L++){const O=c[L];O.parent&&O.parent.isBone&&(p.push(0,0,0),p.push(0,0,0),y.push(w.r,w.g,w.b),y.push(E.r,E.g,E.b))}d.setAttribute("position",new An(p,3)),d.setAttribute("color",new An(y,3));const P=new br({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(d,P),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=s,this.bones=c,this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(s){const c=this.bones,d=this.geometry,p=d.getAttribute("position");Kw.copy(this.root.matrixWorld).invert();for(let y=0,w=0;y<c.length;y++){const E=c[y];E.parent&&E.parent.isBone&&(R0.multiplyMatrices(Kw,E.matrixWorld),ml.setFromMatrixPosition(R0),p.setXYZ(w,ml.x,ml.y,ml.z),R0.multiplyMatrices(Kw,E.parent.matrixWorld),ml.setFromMatrixPosition(R0),p.setXYZ(w+1,ml.x,ml.y,ml.z),w+=2)}d.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(s)}dispose(){this.geometry.dispose(),this.material.dispose()}}function lR(_){const s=[];_.isBone===!0&&s.push(_);for(let c=0;c<_.children.length;c++)s.push.apply(s,lR(_.children[c]));return s}class b5 extends Js{constructor(s,c,d){const p=new Pd(c,4,2),y=new ol({wireframe:!0,fog:!1,toneMapped:!1});super(p,y),this.light=s,this.light.updateMatrixWorld(),this.color=d,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const C5=new de,hR=new dn,uR=new dn;class E5 extends bi{constructor(s,c,d){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=d;const p=new Rd(c);p.rotateY(Math.PI*.5),this.material=new ol({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const y=p.getAttribute("position"),w=new Float32Array(y.count*3);p.setAttribute("color",new Fi(w,3)),this.add(new Js(p,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const s=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const c=s.geometry.getAttribute("color");hR.copy(this.light.color),uR.copy(this.light.groundColor);for(let d=0,p=c.count;d<p;d++){const y=d<p/2?hR:uR;c.setXYZ(d,y.r,y.g,y.b)}c.needsUpdate=!0}s.lookAt(C5.setFromMatrixPosition(this.light.matrixWorld).negate())}}class S5 extends Sa{constructor(s=10,c=10,d=4473924,p=8947848){d=new dn(d),p=new dn(p);const y=c/2,w=s/c,E=s/2,P=[],L=[];for(let N=0,z=0,V=-E;N<=c;N++,V+=w){P.push(-E,0,V,E,0,V),P.push(V,0,-E,V,0,E);const H=N===y?d:p;H.toArray(L,z),z+=3,H.toArray(L,z),z+=3,H.toArray(L,z),z+=3,H.toArray(L,z),z+=3}const O=new si;O.setAttribute("position",new An(P,3)),O.setAttribute("color",new An(L,3));const k=new br({vertexColors:!0,toneMapped:!1});super(O,k),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class M5 extends Sa{constructor(s=10,c=16,d=8,p=64,y=4473924,w=8947848){y=new dn(y),w=new dn(w);const E=[],P=[];if(c>1)for(let k=0;k<c;k++){const N=k/c*(Math.PI*2),z=Math.sin(N)*s,V=Math.cos(N)*s;E.push(0,0,0),E.push(z,0,V);const H=k&1?y:w;P.push(H.r,H.g,H.b),P.push(H.r,H.g,H.b)}for(let k=0;k<d;k++){const N=k&1?y:w,z=s-s/d*k;for(let V=0;V<p;V++){let H=V/p*(Math.PI*2),G=Math.sin(H)*z,X=Math.cos(H)*z;E.push(G,0,X),P.push(N.r,N.g,N.b),H=(V+1)/p*(Math.PI*2),G=Math.sin(H)*z,X=Math.cos(H)*z,E.push(G,0,X),P.push(N.r,N.g,N.b)}}const L=new si;L.setAttribute("position",new An(E,3)),L.setAttribute("color",new An(P,3));const O=new br({vertexColors:!0,toneMapped:!1});super(L,O),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const dR=new de,P0=new de,fR=new de;class T5 extends bi{constructor(s,c,d){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=d,c===void 0&&(c=1);let p=new si;p.setAttribute("position",new An([-c,c,0,c,c,0,c,-c,0,-c,-c,0,-c,c,0],3));const y=new br({fog:!1,toneMapped:!1});this.lightPlane=new dl(p,y),this.add(this.lightPlane),p=new si,p.setAttribute("position",new An([0,0,0,0,0,1],3)),this.targetLine=new dl(p,y),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){dR.setFromMatrixPosition(this.light.matrixWorld),P0.setFromMatrixPosition(this.light.target.matrixWorld),fR.subVectors(P0,dR),this.lightPlane.lookAt(P0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(P0),this.targetLine.scale.z=fR.length()}}const B0=new de,ss=new ZA;class I5 extends Sa{constructor(s){const c=new si,d=new br({color:16777215,vertexColors:!0,toneMapped:!1}),p=[],y=[],w={};E("n1","n2"),E("n2","n4"),E("n4","n3"),E("n3","n1"),E("f1","f2"),E("f2","f4"),E("f4","f3"),E("f3","f1"),E("n1","f1"),E("n2","f2"),E("n3","f3"),E("n4","f4"),E("p","n1"),E("p","n2"),E("p","n3"),E("p","n4"),E("u1","u2"),E("u2","u3"),E("u3","u1"),E("c","t"),E("p","c"),E("cn1","cn2"),E("cn3","cn4"),E("cf1","cf2"),E("cf3","cf4");function E(V,H){P(V),P(H)}function P(V){p.push(0,0,0),y.push(0,0,0),w[V]===void 0&&(w[V]=[]),w[V].push(p.length/3-1)}c.setAttribute("position",new An(p,3)),c.setAttribute("color",new An(y,3)),super(c,d),this.type="CameraHelper",this.camera=s,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=w,this.update();const L=new dn(16755200),O=new dn(16711680),k=new dn(43775),N=new dn(16777215),z=new dn(3355443);this.setColors(L,O,k,N,z)}setColors(s,c,d,p,y){const E=this.geometry.getAttribute("color");E.setXYZ(0,s.r,s.g,s.b),E.setXYZ(1,s.r,s.g,s.b),E.setXYZ(2,s.r,s.g,s.b),E.setXYZ(3,s.r,s.g,s.b),E.setXYZ(4,s.r,s.g,s.b),E.setXYZ(5,s.r,s.g,s.b),E.setXYZ(6,s.r,s.g,s.b),E.setXYZ(7,s.r,s.g,s.b),E.setXYZ(8,s.r,s.g,s.b),E.setXYZ(9,s.r,s.g,s.b),E.setXYZ(10,s.r,s.g,s.b),E.setXYZ(11,s.r,s.g,s.b),E.setXYZ(12,s.r,s.g,s.b),E.setXYZ(13,s.r,s.g,s.b),E.setXYZ(14,s.r,s.g,s.b),E.setXYZ(15,s.r,s.g,s.b),E.setXYZ(16,s.r,s.g,s.b),E.setXYZ(17,s.r,s.g,s.b),E.setXYZ(18,s.r,s.g,s.b),E.setXYZ(19,s.r,s.g,s.b),E.setXYZ(20,s.r,s.g,s.b),E.setXYZ(21,s.r,s.g,s.b),E.setXYZ(22,s.r,s.g,s.b),E.setXYZ(23,s.r,s.g,s.b),E.setXYZ(24,c.r,c.g,c.b),E.setXYZ(25,c.r,c.g,c.b),E.setXYZ(26,c.r,c.g,c.b),E.setXYZ(27,c.r,c.g,c.b),E.setXYZ(28,c.r,c.g,c.b),E.setXYZ(29,c.r,c.g,c.b),E.setXYZ(30,c.r,c.g,c.b),E.setXYZ(31,c.r,c.g,c.b),E.setXYZ(32,d.r,d.g,d.b),E.setXYZ(33,d.r,d.g,d.b),E.setXYZ(34,d.r,d.g,d.b),E.setXYZ(35,d.r,d.g,d.b),E.setXYZ(36,d.r,d.g,d.b),E.setXYZ(37,d.r,d.g,d.b),E.setXYZ(38,p.r,p.g,p.b),E.setXYZ(39,p.r,p.g,p.b),E.setXYZ(40,y.r,y.g,y.b),E.setXYZ(41,y.r,y.g,y.b),E.setXYZ(42,y.r,y.g,y.b),E.setXYZ(43,y.r,y.g,y.b),E.setXYZ(44,y.r,y.g,y.b),E.setXYZ(45,y.r,y.g,y.b),E.setXYZ(46,y.r,y.g,y.b),E.setXYZ(47,y.r,y.g,y.b),E.setXYZ(48,y.r,y.g,y.b),E.setXYZ(49,y.r,y.g,y.b),E.needsUpdate=!0}update(){const s=this.geometry,c=this.pointMap,d=1,p=1;ss.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ps("c",c,s,ss,0,0,-1),ps("t",c,s,ss,0,0,1),ps("n1",c,s,ss,-d,-p,-1),ps("n2",c,s,ss,d,-p,-1),ps("n3",c,s,ss,-d,p,-1),ps("n4",c,s,ss,d,p,-1),ps("f1",c,s,ss,-d,-p,1),ps("f2",c,s,ss,d,-p,1),ps("f3",c,s,ss,-d,p,1),ps("f4",c,s,ss,d,p,1),ps("u1",c,s,ss,d*.7,p*1.1,-1),ps("u2",c,s,ss,-d*.7,p*1.1,-1),ps("u3",c,s,ss,0,p*2,-1),ps("cf1",c,s,ss,-d,0,1),ps("cf2",c,s,ss,d,0,1),ps("cf3",c,s,ss,0,-p,1),ps("cf4",c,s,ss,0,p,1),ps("cn1",c,s,ss,-d,0,-1),ps("cn2",c,s,ss,d,0,-1),ps("cn3",c,s,ss,0,-p,-1),ps("cn4",c,s,ss,0,p,-1),s.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ps(_,s,c,d,p,y,w){B0.set(p,y,w).unproject(d);const E=s[_];if(E!==void 0){const P=c.getAttribute("position");for(let L=0,O=E.length;L<O;L++)P.setXYZ(E[L],B0.x,B0.y,B0.z)}}const L0=new Mh;class R5 extends Sa{constructor(s,c=16776960){const d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=new Float32Array(8*3),y=new si;y.setIndex(new Fi(d,1)),y.setAttribute("position",new Fi(p,3)),super(y,new br({color:c,toneMapped:!1})),this.object=s,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(s){if(s!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&L0.setFromObject(this.object),L0.isEmpty())return;const c=L0.min,d=L0.max,p=this.geometry.attributes.position,y=p.array;y[0]=d.x,y[1]=d.y,y[2]=d.z,y[3]=c.x,y[4]=d.y,y[5]=d.z,y[6]=c.x,y[7]=c.y,y[8]=d.z,y[9]=d.x,y[10]=c.y,y[11]=d.z,y[12]=d.x,y[13]=d.y,y[14]=c.z,y[15]=c.x,y[16]=d.y,y[17]=c.z,y[18]=c.x,y[19]=c.y,y[20]=c.z,y[21]=d.x,y[22]=c.y,y[23]=c.z,p.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(s){return this.object=s,this.update(),this}copy(s,c){return super.copy(s,c),this.object=s.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class P5 extends Sa{constructor(s,c=16776960){const d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],y=new si;y.setIndex(new Fi(d,1)),y.setAttribute("position",new An(p,3)),super(y,new br({color:c,toneMapped:!1})),this.box=s,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(s){const c=this.box;c.isEmpty()||(c.getCenter(this.position),c.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(s))}dispose(){this.geometry.dispose(),this.material.dispose()}}class B5 extends dl{constructor(s,c=1,d=16776960){const p=d,y=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],w=new si;w.setAttribute("position",new An(y,3)),w.computeBoundingSphere(),super(w,new br({color:p,toneMapped:!1})),this.type="PlaneHelper",this.plane=s,this.size=c;const E=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],P=new si;P.setAttribute("position",new An(E,3)),P.computeBoundingSphere(),this.add(new Js(P,new ol({color:p,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(s){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(s)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const pR=new de;let D0,Zw;class L5 extends bi{constructor(s=new de(0,0,1),c=new de(0,0,0),d=1,p=16776960,y=d*.2,w=y*.2){super(),this.type="ArrowHelper",D0===void 0&&(D0=new si,D0.setAttribute("position",new An([0,0,0,0,1,0],3)),Zw=new Oh(0,.5,1,5,1),Zw.translate(0,-.5,0)),this.position.copy(c),this.line=new dl(D0,new br({color:p,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Js(Zw,new ol({color:p,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(s),this.setLength(d,y,w)}setDirection(s){if(s.y>.99999)this.quaternion.set(0,0,0,1);else if(s.y<-.99999)this.quaternion.set(1,0,0,0);else{pR.set(s.z,0,-s.x).normalize();const c=Math.acos(s.y);this.quaternion.setFromAxisAngle(pR,c)}}setLength(s,c=s*.2,d=c*.2){this.line.scale.set(1,Math.max(1e-4,s-c),1),this.line.updateMatrix(),this.cone.scale.set(d,c,d),this.cone.position.y=s,this.cone.updateMatrix()}setColor(s){this.line.material.color.set(s),this.cone.material.color.set(s)}copy(s){return super.copy(s,!1),this.line.copy(s.line),this.cone.copy(s.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class D5 extends Sa{constructor(s=1){const c=[0,0,0,s,0,0,0,0,0,0,s,0,0,0,0,0,0,s],d=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],p=new si;p.setAttribute("position",new An(c,3)),p.setAttribute("color",new An(d,3));const y=new br({vertexColors:!0,toneMapped:!1});super(p,y),this.type="AxesHelper"}setColors(s,c,d){const p=new dn,y=this.geometry.attributes.color.array;return p.set(s),p.toArray(y,0),p.toArray(y,3),p.set(c),p.toArray(y,6),p.toArray(y,9),p.set(d),p.toArray(y,12),p.toArray(y,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class O5{constructor(){this.type="ShapePath",this.color=new dn,this.subPaths=[],this.currentPath=null}moveTo(s,c){return this.currentPath=new zp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(s,c),this}lineTo(s,c){return this.currentPath.lineTo(s,c),this}quadraticCurveTo(s,c,d,p){return this.currentPath.quadraticCurveTo(s,c,d,p),this}bezierCurveTo(s,c,d,p,y,w){return this.currentPath.bezierCurveTo(s,c,d,p,y,w),this}splineThru(s){return this.currentPath.splineThru(s),this}toShapes(s){function c(X){const K=[];for(let ne=0,te=X.length;ne<te;ne++){const oe=X[ne],ue=new Fh;ue.curves=oe.curves,K.push(ue)}return K}function d(X,K){const ne=K.length;let te=!1;for(let oe=ne-1,ue=0;ue<ne;oe=ue++){let Ce=K[oe],$=K[ue],ge=$.x-Ce.x,Te=$.y-Ce.y;if(Math.abs(Te)>Number.EPSILON){if(Te<0&&(Ce=K[ue],ge=-ge,$=K[oe],Te=-Te),X.y<Ce.y||X.y>$.y)continue;if(X.y===Ce.y){if(X.x===Ce.x)return!0}else{const et=Te*(X.x-Ce.x)-ge*(X.y-Ce.y);if(et===0)return!0;if(et<0)continue;te=!te}}else{if(X.y!==Ce.y)continue;if($.x<=X.x&&X.x<=Ce.x||Ce.x<=X.x&&X.x<=$.x)return!0}}return te}const p=Ma.isClockWise,y=this.subPaths;if(y.length===0)return[];let w,E,P;const L=[];if(y.length===1)return E=y[0],P=new Fh,P.curves=E.curves,L.push(P),L;let O=!p(y[0].getPoints());O=s?!O:O;const k=[],N=[];let z=[],V=0,H;N[V]=void 0,z[V]=[];for(let X=0,K=y.length;X<K;X++)E=y[X],H=E.getPoints(),w=p(H),w=s?!w:w,w?(!O&&N[V]&&V++,N[V]={s:new Fh,p:H},N[V].s.curves=E.curves,O&&V++,z[V]=[]):z[V].push({h:E,p:H[0]});if(!N[0])return c(y);if(N.length>1){let X=!1,K=0;for(let ne=0,te=N.length;ne<te;ne++)k[ne]=[];for(let ne=0,te=N.length;ne<te;ne++){const oe=z[ne];for(let ue=0;ue<oe.length;ue++){const Ce=oe[ue];let $=!0;for(let ge=0;ge<N.length;ge++)d(Ce.p,N[ge].p)&&(ne!==ge&&K++,$?($=!1,k[ge].push(Ce)):X=!0);$&&k[ne].push(Ce)}}K>0&&X===!1&&(z=k)}let G;for(let X=0,K=N.length;X<K;X++){P=N[X].s,L.push(P),G=z[X];for(let ne=0,te=G.length;ne<te;ne++)P.holes.push(G[ne].h)}return L}}const yc=F5();function F5(){const _=new ArrayBuffer(4),s=new Float32Array(_),c=new Uint32Array(_),d=new Uint32Array(512),p=new Uint32Array(512);for(let P=0;P<256;++P){const L=P-127;L<-27?(d[P]=0,d[P|256]=32768,p[P]=24,p[P|256]=24):L<-14?(d[P]=1024>>-L-14,d[P|256]=1024>>-L-14|32768,p[P]=-L-1,p[P|256]=-L-1):L<=15?(d[P]=L+15<<10,d[P|256]=L+15<<10|32768,p[P]=13,p[P|256]=13):L<128?(d[P]=31744,d[P|256]=64512,p[P]=24,p[P|256]=24):(d[P]=31744,d[P|256]=64512,p[P]=13,p[P|256]=13)}const y=new Uint32Array(2048),w=new Uint32Array(64),E=new Uint32Array(64);for(let P=1;P<1024;++P){let L=P<<13,O=0;for(;(L&8388608)===0;)L<<=1,O-=8388608;L&=-8388609,O+=947912704,y[P]=L|O}for(let P=1024;P<2048;++P)y[P]=939524096+(P-1024<<13);for(let P=1;P<31;++P)w[P]=P<<23;w[31]=1199570944,w[32]=2147483648;for(let P=33;P<63;++P)w[P]=2147483648+(P-32<<23);w[63]=3347054592;for(let P=1;P<64;++P)P!==32&&(E[P]=1024);return{floatView:s,uint32View:c,baseTable:d,shiftTable:p,mantissaTable:y,exponentTable:w,offsetTable:E}}function k5(_){Math.abs(_)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),_=fs(_,-65504,65504),yc.floatView[0]=_;const s=yc.uint32View[0],c=s>>23&511;return yc.baseTable[c]+((s&8388607)>>yc.shiftTable[c])}function N5(_){const s=_>>10;return yc.uint32View[0]=yc.mantissaTable[yc.offsetTable[s]+(_&1023)]+yc.exponentTable[s],yc.floatView[0]}var U5=Object.freeze({__proto__:null,toHalfFloat:k5,fromHalfFloat:N5});function z5(){console.error("THREE.ImmediateRenderObject has been removed.")}class G5 extends xo{constructor(s,c,d){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(s,c,d),this.samples=4}}class H5 extends Mp{constructor(s,c,d,p){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(s,c,d,p)}}class V5 extends DA{constructor(s,c,d,p){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(s,c,d,p)}}class W5 extends hl{constructor(s,c,d,p,y,w){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(s,c,d,p,y,w)}}class Q5 extends Gp{constructor(s,c,d,p){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(s,c,d,p)}}class j5 extends Hp{constructor(s,c,d,p){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(s,c,d,p)}}class q5 extends Vp{constructor(s,c,d,p,y,w,E){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(s,c,d,p,y,w,E)}}class X5 extends Oh{constructor(s,c,d,p,y,w,E,P){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(s,c,d,p,y,w,E,P)}}class Y5 extends Wp{constructor(s,c){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(s,c)}}class J5 extends Xp{constructor(s,c){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(s,c)}}class K5 extends Yp{constructor(s,c){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(s,c)}}class Z5 extends Td{constructor(s,c,d,p){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(s,c,d,p)}}class $5 extends Rd{constructor(s,c){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(s,c)}}class eV extends Ad{constructor(s,c,d,p){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(s,c,d,p)}}class tV extends mc{constructor(s,c,d,p){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(s,c,d,p)}}class nV extends Jp{constructor(s,c,d,p,y,w){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(s,c,d,p,y,w)}}class iV extends Kp{constructor(s,c){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(s,c)}}class sV extends Pd{constructor(s,c,d,p,y,w,E){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(s,c,d,p,y,w,E)}}class rV extends Zp{constructor(s,c){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(s,c)}}class oV extends $p{constructor(s,c,d,p,y){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(s,c,d,p,y)}}class aV extends em{constructor(s,c,d,p,y,w){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(s,c,d,p,y,w)}}class cV extends tm{constructor(s,c,d,p,y){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(s,c,d,p,y)}}return typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:a}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=a),Z.ACESFilmicToneMapping=Jt,Z.AddEquation=R,Z.AddOperation=Nt,Z.AdditiveAnimationBlendMode=Dx,Z.AdditiveBlending=C,Z.AlphaFormat=Or,Z.AlwaysDepth=Le,Z.AlwaysStencilFunc=U1,Z.AmbientLight=WI,Z.AmbientLightProbe=jH,Z.AnimationClip=rm,Z.AnimationLoader=LH,Z.AnimationMixer=u5,Z.AnimationObjectGroup=c5,Z.AnimationUtils=IH,Z.ArcCurve=aI,Z.ArrayCamera=PT,Z.ArrowHelper=L5,Z.Audio=nR,Z.AudioAnalyser=ZH,Z.AudioContext=jw,Z.AudioListener=YH,Z.AudioLoader=WH,Z.AxesHelper=D5,Z.BackSide=m,Z.BasicDepthPacking=F1,Z.BasicShadowMap=l,Z.Bone=_w,Z.BooleanKeyframeTrack=Nh,Z.Box2=_5,Z.Box3=Mh,Z.Box3Helper=P5,Z.BoxBufferGeometry=W5,Z.BoxGeometry=hl,Z.BoxHelper=R5,Z.BufferAttribute=Fi,Z.BufferGeometry=si,Z.BufferGeometryLoader=XI,Z.ByteType=Me,Z.Cache=zh,Z.Camera=ZA,Z.CameraHelper=I5,Z.CanvasTexture=$4,Z.CapsuleBufferGeometry=Q5,Z.CapsuleGeometry=Gp,Z.CatmullRomCurve3=cI,Z.CineonToneMapping=xt,Z.CircleBufferGeometry=j5,Z.CircleGeometry=Hp,Z.ClampToEdgeWrapping=je,Z.Clock=$I,Z.Color=dn,Z.ColorKeyframeTrack=zw,Z.ColorManagement=vo,Z.CompressedTexture=oI,Z.CompressedTextureLoader=DH,Z.ConeBufferGeometry=q5,Z.ConeGeometry=Vp,Z.CubeCamera=nT,Z.CubeReflectionMapping=Kt,Z.CubeRefractionMapping=ln,Z.CubeTexture=Bp,Z.CubeTextureLoader=OH,Z.CubeUVReflectionMapping=me,Z.CubicBezierCurve=Mw,Z.CubicBezierCurve3=hI,Z.CubicInterpolant=LI,Z.CullFaceBack=i,Z.CullFaceFront=r,Z.CullFaceFrontBack=o,Z.CullFaceNone=n,Z.Curve=Ko,Z.CurvePath=dI,Z.CustomBlending=M,Z.CustomToneMapping=Dt,Z.CylinderBufferGeometry=X5,Z.CylinderGeometry=Oh,Z.Cylindrical=y5,Z.Data3DTexture=DA,Z.DataArrayTexture=Mp,Z.DataTexture=Sd,Z.DataTexture2DArray=H5,Z.DataTexture3D=V5,Z.DataTextureLoader=FH,Z.DataUtils=U5,Z.DecrementStencilOp=Yk,Z.DecrementWrapStencilOp=Kk,Z.DefaultLoadingManager=FI,Z.DepthFormat=yo,Z.DepthStencilFormat=Fr,Z.DepthTexture=BT,Z.DirectionalLight=VI,Z.DirectionalLightHelper=T5,Z.DiscreteInterpolant=DI,Z.DodecahedronBufferGeometry=Y5,Z.DodecahedronGeometry=Wp,Z.DoubleSide=A,Z.DstAlphaFactor=se,Z.DstColorFactor=ve,Z.DynamicCopyUsage=dN,Z.DynamicDrawUsage=oN,Z.DynamicReadUsage=lN,Z.EdgesGeometry=fI,Z.EllipseCurve=A0,Z.EqualDepth=vt,Z.EqualStencilFunc=tN,Z.EquirectangularReflectionMapping=ii,Z.EquirectangularRefractionMapping=Kn,Z.Euler=ad,Z.EventDispatcher=cc,Z.ExtrudeBufferGeometry=J5,Z.ExtrudeGeometry=Xp,Z.FileLoader=Ac,Z.Float16BufferAttribute=qN,Z.Float32BufferAttribute=An,Z.Float64BufferAttribute=XN,Z.FloatType=wn,Z.Fog=o0,Z.FogExp2=r0,Z.FramebufferTexture=Z4,Z.FrontSide=g,Z.Frustum=e0,Z.GLBufferAttribute=m5,Z.GLSL1=pN,Z.GLSL3=Ox,Z.GreaterDepth=Ve,Z.GreaterEqualDepth=zt,Z.GreaterEqualStencilFunc=rN,Z.GreaterStencilFunc=iN,Z.GridHelper=S5,Z.Group=xd,Z.HalfFloatType=fi,Z.HemisphereLight=kI,Z.HemisphereLightHelper=E5,Z.HemisphereLightProbe=QH,Z.IcosahedronBufferGeometry=K5,Z.IcosahedronGeometry=Yp,Z.ImageBitmapLoader=VH,Z.ImageLoader=om,Z.ImageUtils=zx,Z.ImmediateRenderObject=z5,Z.IncrementStencilOp=Xk,Z.IncrementWrapStencilOp=Jk,Z.InstancedBufferAttribute=Md,Z.InstancedBufferGeometry=qI,Z.InstancedInterleavedBuffer=p5,Z.InstancedMesh=JT,Z.Int16BufferAttribute=QN,Z.Int32BufferAttribute=jN,Z.Int8BufferAttribute=HN,Z.IntType=Re,Z.InterleavedBuffer=a0,Z.InterleavedBufferAttribute=Dh,Z.Interpolant=nm,Z.InterpolateDiscrete=vr,Z.InterpolateLinear=jo,Z.InterpolateSmooth=xr,Z.InvertStencilOp=Zk,Z.KeepStencilOp=TA,Z.KeyframeTrack=Zo,Z.LOD=GT,Z.LatheBufferGeometry=Z5,Z.LatheGeometry=Td,Z.Layers=GA,Z.LessDepth=De,Z.LessEqualDepth=$e,Z.LessEqualStencilFunc=nN,Z.LessStencilFunc=eN,Z.Light=pl,Z.LightProbe=S0,Z.Line=dl,Z.Line3=v5,Z.LineBasicMaterial=br,Z.LineCurve=_0,Z.LineCurve3=uI,Z.LineDashedMaterial=PI,Z.LineLoop=nI,Z.LineSegments=Sa,Z.LinearEncoding=$c,Z.LinearFilter=Et,Z.LinearInterpolant=Uw,Z.LinearMipMapLinearFilter=Ln,Z.LinearMipMapNearestFilter=nn,Z.LinearMipmapLinearFilter=Wt,Z.LinearMipmapNearestFilter=hn,Z.LinearSRGBColorSpace=tl,Z.LinearToneMapping=it,Z.Loader=to,Z.LoaderUtils=Qw,Z.LoadingManager=Gw,Z.LoopOnce=Yi,Z.LoopPingPong=Ri,Z.LoopRepeat=wi,Z.LuminanceAlphaFormat=wh,Z.LuminanceFormat=ac,Z.MOUSE=e,Z.Material=cr,Z.MaterialLoader=M0,Z.MathUtils=TN,Z.Matrix3=kr,Z.Matrix4=$n,Z.MaxEquation=D,Z.Mesh=Js,Z.MeshBasicMaterial=ol,Z.MeshDepthMaterial=pw,Z.MeshDistanceMaterial=mw,Z.MeshLambertMaterial=II,Z.MeshMatcapMaterial=RI,Z.MeshNormalMaterial=TI,Z.MeshPhongMaterial=SI,Z.MeshPhysicalMaterial=EI,Z.MeshStandardMaterial=Ow,Z.MeshToonMaterial=MI,Z.MinEquation=F,Z.MirroredRepeatWrapping=yt,Z.MixOperation=mn,Z.MultiplyBlending=I,Z.MultiplyOperation=Xt,Z.NearestFilter=mt,Z.NearestMipMapLinearFilter=ke,Z.NearestMipMapNearestFilter=Mn,Z.NearestMipmapLinearFilter=be,Z.NearestMipmapNearestFilter=Ht,Z.NeverDepth=Ie,Z.NeverStencilFunc=$k,Z.NoBlending=v,Z.NoColorSpace=Qk,Z.NoToneMapping=vn,Z.NormalAnimationBlendMode=MA,Z.NormalBlending=b,Z.NotEqualDepth=gn,Z.NotEqualStencilFunc=sN,Z.NumberKeyframeTrack=im,Z.Object3D=bi,Z.ObjectLoader=GH,Z.ObjectSpaceNormalMap=N1,Z.OctahedronBufferGeometry=$5,Z.OctahedronGeometry=Rd,Z.OneFactor=W,Z.OneMinusDstAlphaFactor=ae,Z.OneMinusDstColorFactor=xe,Z.OneMinusSrcAlphaFactor=Y,Z.OneMinusSrcColorFactor=ee,Z.OrthographicCamera=t0,Z.PCFShadowMap=h,Z.PCFSoftShadowMap=u,Z.PMREMGenerator=hw,Z.Path=zp,Z.PerspectiveCamera=Ks,Z.Plane=ul,Z.PlaneBufferGeometry=eV,Z.PlaneGeometry=Ad,Z.PlaneHelper=B5,Z.PointLight=HI,Z.PointLightHelper=b5,Z.Points=sI,Z.PointsMaterial=xw,Z.PolarGridHelper=M5,Z.PolyhedronBufferGeometry=tV,Z.PolyhedronGeometry=mc,Z.PositionalAudio=KH,Z.PropertyBinding=mi,Z.PropertyMixer=sR,Z.QuadraticBezierCurve=Tw,Z.QuadraticBezierCurve3=Iw,Z.Quaternion=Nr,Z.QuaternionKeyframeTrack=Bd,Z.QuaternionLinearInterpolant=OI,Z.REVISION=a,Z.RGBADepthPacking=k1,Z.RGBAFormat=or,Z.RGBAIntegerFormat=Ne,Z.RGBA_ASTC_10x10_Format=pi,Z.RGBA_ASTC_10x5_Format=Si,Z.RGBA_ASTC_10x6_Format=Zn,Z.RGBA_ASTC_10x8_Format=Wi,Z.RGBA_ASTC_12x10_Format=In,Z.RGBA_ASTC_12x12_Format=Di,Z.RGBA_ASTC_4x4_Format=wt,Z.RGBA_ASTC_5x4_Format=Zt,Z.RGBA_ASTC_5x5_Format=bt,Z.RGBA_ASTC_6x5_Format=xn,Z.RGBA_ASTC_6x6_Format=pn,Z.RGBA_ASTC_8x5_Format=$t,Z.RGBA_ASTC_8x6_Format=un,Z.RGBA_ASTC_8x8_Format=Fn,Z.RGBA_BPTC_Format=zs,Z.RGBA_ETC2_EAC_Format=ut,Z.RGBA_PVRTC_2BPPV1_Format=Ke,Z.RGBA_PVRTC_4BPPV1_Format=Oe,Z.RGBA_S3TC_DXT1_Format=j,Z.RGBA_S3TC_DXT3_Format=ie,Z.RGBA_S3TC_DXT5_Format=pe,Z.RGBFormat=Ys,Z.RGB_ETC1_Format=lt,Z.RGB_ETC2_Format=Tt,Z.RGB_PVRTC_2BPPV1_Format=We,Z.RGB_PVRTC_4BPPV1_Format=Se,Z.RGB_S3TC_DXT1_Format=nt,Z.RGFormat=Ge,Z.RGIntegerFormat=ze,Z.RawShaderMaterial=CI,Z.Ray=Ip,Z.Raycaster=g5,Z.RectAreaLight=QI,Z.RedFormat=ed,Z.RedIntegerFormat=he,Z.ReinhardToneMapping=tt,Z.RepeatWrapping=ce,Z.ReplaceStencilOp=qk,Z.ReverseSubtractEquation=B,Z.RingBufferGeometry=nV,Z.RingGeometry=Jp,Z.SRGBColorSpace=Ca,Z.Scene=OT,Z.ShaderChunk=oi,Z.ShaderLib=Jo,Z.ShaderMaterial=Ea,Z.ShadowMaterial=bI,Z.Shape=Fh,Z.ShapeBufferGeometry=iV,Z.ShapeGeometry=Kp,Z.ShapePath=O5,Z.ShapeUtils=Ma,Z.ShortType=Bt,Z.Skeleton=d0,Z.SkeletonHelper=w5,Z.SkinnedMesh=jT,Z.Source=Sh,Z.Sphere=Ph,Z.SphereBufferGeometry=sV,Z.SphereGeometry=Pd,Z.Spherical=A5,Z.SphericalHarmonics3=jI,Z.SplineCurve=Rw,Z.SpotLight=zI,Z.SpotLightHelper=x5,Z.Sprite=UT,Z.SpriteMaterial=Aw,Z.SrcAlphaFactor=Q,Z.SrcAlphaSaturateFactor=Ae,Z.SrcColorFactor=J,Z.StaticCopyUsage=uN,Z.StaticDrawUsage=bp,Z.StaticReadUsage=cN,Z.StereoCamera=qH,Z.StreamCopyUsage=fN,Z.StreamDrawUsage=aN,Z.StreamReadUsage=hN,Z.StringKeyframeTrack=Uh,Z.SubtractEquation=T,Z.SubtractiveBlending=S,Z.TOUCH=t,Z.TangentSpaceNormalMap=el,Z.TetrahedronBufferGeometry=rV,Z.TetrahedronGeometry=Zp,Z.Texture=Rs,Z.TextureLoader=kH,Z.TorusBufferGeometry=oV,Z.TorusGeometry=$p,Z.TorusKnotBufferGeometry=aV,Z.TorusKnotGeometry=em,Z.Triangle=wo,Z.TriangleFanDrawMode=Wk,Z.TriangleStripDrawMode=Vk,Z.TrianglesDrawMode=Hk,Z.TubeBufferGeometry=cV,Z.TubeGeometry=tm,Z.UVMapping=Cn,Z.Uint16BufferAttribute=$x,Z.Uint32BufferAttribute=ew,Z.Uint8BufferAttribute=VN,Z.Uint8ClampedBufferAttribute=WN,Z.Uniform=Yw,Z.UniformsGroup=f5,Z.UniformsLib=Qt,Z.UniformsUtils=tT,Z.UnsignedByteType=Dn,Z.UnsignedInt248Type=xi,Z.UnsignedIntType=Mt,Z.UnsignedShort4444Type=Vi,Z.UnsignedShort5551Type=Kr,Z.UnsignedShortType=Ut,Z.VSMShadowMap=f,Z.Vector2=gt,Z.Vector3=de,Z.Vector4=Pi,Z.VectorKeyframeTrack=sm,Z.VideoTexture=K4,Z.WebGL1Renderer=DT,Z.WebGL3DRenderTarget=BN,Z.WebGLArrayRenderTarget=PN,Z.WebGLCubeRenderTarget=iT,Z.WebGLMultipleRenderTargets=LN,Z.WebGLMultisampleRenderTarget=G5,Z.WebGLRenderTarget=xo,Z.WebGLRenderer=LT,Z.WebGLUtils=RT,Z.WireframeGeometry=vI,Z.WrapAroundEnding=wp,Z.ZeroCurvatureEnding=_o,Z.ZeroFactor=U,Z.ZeroSlopeEnding=bh,Z.ZeroStencilOp=jk,Z._SRGBAFormat=IA,Z.sRGBEncoding=es,Z}(function(a,e){(function(){var t=this,n=typeof yE<"u",i=t.THREE||n&&Eie();if(!i)throw new Error("MeshLine requires three.js");class r extends i.BufferGeometry{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new i.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(f){this.setGeometry(f,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(f){this.setPoints(f,this.widthCallback)}}})}}r.prototype.setMatrixWorld=function(u){this.matrixWorld=u},r.prototype.setGeometry=function(u,f){this._geometry=u,this.setPoints(u.getAttribute("position").array,f)},r.prototype.setPoints=function(u,f){if(!(u instanceof Float32Array)&&!(u instanceof Array)){console.error("ERROR: The BufferArray of points is not instancied correctly.");return}if(this._points=u,this.widthCallback=f,this.positions=[],this.counters=[],u.length&&u[0]instanceof i.Vector3)for(var g=0;g<u.length;g++){var m=u[g],A=g/u.length;this.positions.push(m.x,m.y,m.z),this.positions.push(m.x,m.y,m.z),this.counters.push(A),this.counters.push(A)}else for(var g=0;g<u.length;g+=3){var A=g/u.length;this.positions.push(u[g],u[g+1],u[g+2]),this.positions.push(u[g],u[g+1],u[g+2]),this.counters.push(A),this.counters.push(A)}this.process()};function o(u,f){var g=new i.Matrix4,m=new i.Ray,A=new i.Sphere,v=new i.Vector3,b=this.geometry;if(b.boundingSphere||b.computeBoundingSphere(),A.copy(b.boundingSphere),A.applyMatrix4(this.matrixWorld),u.ray.intersectSphere(A,v)!==!1){g.copy(this.matrixWorld).invert(),m.copy(u.ray).applyMatrix4(g);var C=new i.Vector3,S=new i.Vector3,I=new i.Vector3,M=this instanceof i.LineSegments?2:1,R=b.index,T=b.attributes;if(R!==null)for(var B=R.array,F=T.position.array,D=T.width.array,U=0,W=B.length-1;U<W;U+=M){var J=B[U],ee=B[U+1];C.fromArray(F,J*3),S.fromArray(F,ee*3);var Q=D[Math.floor(U/3)]!==void 0?D[Math.floor(U/3)]:1,Y=u.params.Line.threshold+this.material.lineWidth*Q/2,se=Y*Y,ae=m.distanceSqToSegment(C,S,v,I);if(!(ae>se)){v.applyMatrix4(this.matrixWorld);var ve=u.ray.origin.distanceTo(v);ve<u.near||ve>u.far||(f.push({distance:ve,point:I.clone().applyMatrix4(this.matrixWorld),index:U,face:null,faceIndex:null,object:this}),U=W)}}}}r.prototype.raycast=o,r.prototype.compareV3=function(u,f){var g=u*6,m=f*6;return this.positions[g]===this.positions[m]&&this.positions[g+1]===this.positions[m+1]&&this.positions[g+2]===this.positions[m+2]},r.prototype.copyV3=function(u){var f=u*6;return[this.positions[f],this.positions[f+1],this.positions[f+2]]},r.prototype.process=function(){var u=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];var f,g;this.compareV3(0,u-1)?g=this.copyV3(u-2):g=this.copyV3(0),this.previous.push(g[0],g[1],g[2]),this.previous.push(g[0],g[1],g[2]);for(var m=0;m<u;m++){if(this.side.push(1),this.side.push(-1),this.widthCallback?f=this.widthCallback(m/(u-1)):f=1,this.width.push(f),this.width.push(f),this.uvs.push(m/(u-1),0),this.uvs.push(m/(u-1),1),m<u-1){g=this.copyV3(m),this.previous.push(g[0],g[1],g[2]),this.previous.push(g[0],g[1],g[2]);var A=m*2;this.indices_array.push(A,A+1,A+2),this.indices_array.push(A+2,A+1,A+3)}m>0&&(g=this.copyV3(m),this.next.push(g[0],g[1],g[2]),this.next.push(g[0],g[1],g[2]))}this.compareV3(u-1,0)?g=this.copyV3(1):g=this.copyV3(u-1),this.next.push(g[0],g[1],g[2]),this.next.push(g[0],g[1],g[2]),!this._attributes||this._attributes.position.count!==this.positions.length?this._attributes={position:new i.BufferAttribute(new Float32Array(this.positions),3),previous:new i.BufferAttribute(new Float32Array(this.previous),3),next:new i.BufferAttribute(new Float32Array(this.next),3),side:new i.BufferAttribute(new Float32Array(this.side),1),width:new i.BufferAttribute(new Float32Array(this.width),1),uv:new i.BufferAttribute(new Float32Array(this.uvs),2),index:new i.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new i.BufferAttribute(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()};function l(u,f,g,m,A){var v;if(u=u.subarray||u.slice?u:u.buffer,g=g.subarray||g.slice?g:g.buffer,u=f?u.subarray?u.subarray(f,A&&f+A):u.slice(f,A&&f+A):u,g.set)g.set(u,m);else for(v=0;v<u.length;v++)g[v+m]=u[v];return g}r.prototype.advance=function(u){var f=this._attributes.position.array,g=this._attributes.previous.array,m=this._attributes.next.array,A=f.length;l(f,0,g,0,A),l(f,6,f,0,A-6),f[A-6]=u.x,f[A-5]=u.y,f[A-4]=u.z,f[A-3]=u.x,f[A-2]=u.y,f[A-1]=u.z,l(f,6,m,0,A-6),m[A-6]=u.x,m[A-5]=u.y,m[A-4]=u.z,m[A-3]=u.x,m[A-2]=u.y,m[A-1]=u.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},i.ShaderChunk.meshline_vert=["",i.ShaderChunk.logdepthbuf_pars_vertex,i.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","	 vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.fog_vertex,"}"].join(`
`),i.ShaderChunk.meshline_frag=["",i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",i.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",i.ShaderChunk.fog_fragment,"}"].join(`
`);class h extends i.ShaderMaterial{constructor(f){super({uniforms:Object.assign({},i.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new i.Color(16777215)},opacity:{value:1},resolution:{value:new i.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new i.Vector2(1,1)}}),vertexShader:i.ShaderChunk.meshline_vert,fragmentShader:i.ShaderChunk.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(g){this.uniforms.lineWidth.value=g}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(g){this.uniforms.map.value=g}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(g){this.uniforms.useMap.value=g}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(g){this.uniforms.alphaMap.value=g}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(g){this.uniforms.useAlphaMap.value=g}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(g){this.uniforms.color.value=g}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(g){this.uniforms.opacity.value=g}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(g){this.uniforms.resolution.value.copy(g)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(g){this.uniforms.sizeAttenuation.value=g}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(g){this.uniforms.dashArray.value=g,this.useDash=g!==0?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(g){this.uniforms.dashOffset.value=g}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(g){this.uniforms.dashRatio.value=g}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(g){this.uniforms.useDash.value=g}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(g){this.uniforms.visibility.value=g}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(g){this.uniforms.alphaTest.value=g}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(g){this.uniforms.repeat.value.copy(g)}}}),this.setValues(f)}}h.prototype.copy=function(u){return i.ShaderMaterial.prototype.copy.call(this,u),this.lineWidth=u.lineWidth,this.map=u.map,this.useMap=u.useMap,this.alphaMap=u.alphaMap,this.useAlphaMap=u.useAlphaMap,this.color.copy(u.color),this.opacity=u.opacity,this.resolution.copy(u.resolution),this.sizeAttenuation=u.sizeAttenuation,this.dashArray.copy(u.dashArray),this.dashOffset.copy(u.dashOffset),this.dashRatio.copy(u.dashRatio),this.useDash=u.useDash,this.visibility=u.visibility,this.alphaTest=u.alphaTest,this.repeat.copy(u.repeat),this},a.exports&&(e=a.exports={MeshLine:r,MeshLineMaterial:h,MeshLineRaycast:o}),e.MeshLine=r,e.MeshLineMaterial=h,e.MeshLineRaycast=o}).call(Om)})(Mg,Mg.exports);const D1=class{constructor(e,t){x(this,"id",0);x(this,"points",[]);x(this,"line",new Mg.exports.MeshLine);x(this,"material");x(this,"mesh");x(this,"defaultLineMaterial",new Mg.exports.MeshLineMaterial({color:10066329,lineWidth:.01}));if(t&&(this.material=t.material),this.material||(this.material=this.defaultLineMaterial),t){const n=t.options;n&&Object.assign(this.material,n)}this.mesh=new _t(this.line,this.material),e.add(this.mesh)}appendPoint(e){var i;let t=D1.wp;t.set(e.x,e.y,e.z);const n=(i=this.mesh)==null?void 0:i.parent;return n&&(t=n.worldToLocal(t),e.x=t.x,e.y=t.y,e.z=t.z),this.points.push(e.x,e.y,e.z),this.line.setPoints(this.points),e}};let Km=D1;x(Km,"wp",new q);class HE extends pt{constructor(){super(...arguments);x(this,"finished",[]);x(this,"inFlight",[]);x(this,"buffer",{});x(this,"freeBuffer",new Array)}startLine(t,n){const i=Math.random()*Number.MAX_SAFE_INTEGER;return this.internalStartLine(t,i,!0,n)}updateLine(t,n){const i=this.inFlight[t.id];if(!i)return;n.point&&(n.point=i.appendPoint(n.point));const r=this.buffer[t.id];r&&(n.point&&r.push(n.point.x,n.point.y,n.point.z),r.length>5&&(this.sendLineUpdate(i,!1,void 0,r),r.length=0))}endLine(t,n=!0){const i=this.inFlight[t.id];if(!i)return;this.finished.push(i),delete this.inFlight[t.id],n&&this.sendLineUpdate(i,!0,0);const r=this.buffer[t.id];if(r){delete this.buffer[t.id];const o=r;o.length=0,this.freeBuffer.push(o)}return i}getLine(t){return this.inFlight[t.id]}awake(){this.context.connection.beginListen("line-start",t=>{this.onEnsureLine(t.id,t.parentGuid)}),this.context.connection.beginListen("line-update",t=>{let n=this.onEnsureLine(t.guid,t.parentGuid);n&&t.points&&(t.startIndex<=0?n.points=t.points:t.startIndex>=n.points.length&&n.points.push(...t.points),n.line.setPoints(n.points),n.material.lineWidth=t.width,n.material.color.fromArray(t.color),t.finished===!0&&this.endLine({id:n.id},!1))})}onEnsureLine(t,n){if(this.inFlight[t])return this.inFlight[t];let i=Ee.findByGuid(n,this.context.scene);if(!!i)return this.internalStartLine(i,t,!1),this.inFlight[t]}internalStartLine(t,n,i=!0,r){const o=new Km(t!=null?t:this.context.scene,r);o.id=n,this.inFlight[n]=o,i&&this.sendLineStart(o);let l;return this.freeBuffer.length<=0?l=new Array:l=this.freeBuffer.pop(),this.buffer[n]=l,{id:n}}sendLineStart(t){const n=t.mesh.parent;this.context.connection.send("line-start",{id:t.id,parentGuid:n?n.guid:void 0})}sendLineUpdate(t,n,i,r){if(t){const o={parentGuid:t.mesh.parent.guid,guid:t.id,points:r?[...r]:t.points,width:t.material.lineWidth,color:t.material.color.toArray(),startIndex:i!==void 0?i:t.points.length,finished:n};this.context.connection.send("line-update",o)}}}class EL{constructor(){x(this,"isDrawing");x(this,"lastHit");x(this,"currentHandle");x(this,"maxDistance");x(this,"prevDistance");x(this,"lastParent");this.isDrawing=!1,this.lastHit=new q,this.currentHandle=null,this.maxDistance=0,this.prevDistance=0,this.lastParent=null}}const av=class extends pt{constructor(){super(...arguments);x(this,"lines");x(this,"colliders");x(this,"alignToSurface",!0);x(this,"addToPaintedObject",!0);x(this,"orbit");x(this,"_states",{});x(this,"_raycastOptions",new nc)}start(){var n;this.lines||(this.lines=Ee.getComponent(this.gameObject,HE),this.lines||(this.lines=Ee.addNewComponent(this.gameObject,HE))),this.orbit=(n=Ee.findObjectOfType(dh,this.context))!=null?n:void 0,this._states.mouse=new EL;const t={};Zi.addEventListener(la.SelectStart,(i,r)=>{t[i.controller.uuid]=!0}),Zi.addEventListener(la.Update,(i,r)=>{if(t[i.controller.uuid]===!0){const o=i.getRay();this.updateLine(i.controller.uuid,o,!0,!1,!1)}}),Zi.addEventListener(la.SelectEnd,(i,r)=>{t[i.controller.uuid]=!1;const o=i.getRay();this.updateLine(i.controller.uuid,o,!0,!0,!1)})}update(){this.orbit&&this._states.mouse&&this.orbit&&(this.orbit.enabled=!this._states.mouse.isDrawing);const t=this.context.input.getPointerPressedCount()>1,n=this.context.input.getPointerPositionRC(0);av._raycaster.setFromCamera(n,this.context.mainCamera);const i=av._raycaster.ray;this.updateLine("mouse",i,this.context.input.getPointerPressed(0),this.context.input.getPointerUp(0),t||this.context.input.isKeyPressed(Xl.ALT))}updateLine(t,n,i,r,o=!1){var h;let l=this._states[t];if(l||(this._states[t]=new EL,l=this._states[t]),r)l.isDrawing=!1,l.currentHandle&&(this.lines.endLine(l.currentHandle),l.currentHandle=null);else if(i){if(o)return l;const u=this.getHit(n);let f=null,g=l.prevDistance;if(u)l.currentHandle||(l.maxDistance=u.distance),f=u.point,f.add(u.face.normal.multiplyScalar(.01)),l.prevDistance=u.distance;else if(l.maxDistance>0){if(l.maxDistance,!l.currentHandle&&l.lastHit){const m=ni(this.context.mainCamera);l.lastHit.distanceTo(m)}f=n.origin.add(n.direction.multiplyScalar(l.maxDistance)),l.prevDistance=l.maxDistance}if(f){if(!l.currentHandle){let m=(h=l.lastParent)!=null?h:this.gameObject;this.addToPaintedObject&&u&&(m=u.object),l.lastParent=m,l.currentHandle=this.lines.startLine(m,{material:this.createRandomMaterial()})}if(this.alignToSurface&&(l.prevDistance>l.maxDistance||Math.abs(g-l.prevDistance)>.2)){const m=l.maxDistance;f=n.origin.add(n.direction.multiplyScalar(m)),l.prevDistance=m}if(l.lastHit&&l.lastHit.distanceTo(f)<l.prevDistance*.01)return l;this.lines.updateLine(l.currentHandle,{point:f}),l.lastHit.copy(f)}l.isDrawing=l.currentHandle!==null}return l}getHit(t){(!this.colliders||this.colliders.length===0)&&(this.colliders=[this.gameObject]),this._raycastOptions.targets=this.colliders,this._raycastOptions.ray=t;const n=this.context.physics.raycast(this._raycastOptions);if(n.length>0){for(const i of n)if(!!Ee.isActiveInHierarchy(i.object))return i}return null}createRandomMaterial(){let t;return this.context.connection.connectionId?t=ah.colorFromHashCode(ah.hashCode(this.context.connection.connectionId)):t=new ye("hsl("+(Math.random()*100).toFixed(0)+", 80%, 30%)"),new Mg.exports.MeshLineMaterial({color:t,lineWidth:Ci.lerp(.005,.01,Math.random())})}};let p_=av;x(p_,"_raycaster",new ju);var Sie=Object.defineProperty,Mie=Object.getOwnPropertyDescriptor,yk=(a,e,t,n)=>{for(var i=n>1?void 0:n?Mie(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Sie(e,t,i),i};class _k extends pt{constructor(){super(...arguments);x(this,"asset");x(this,"joinedRoomFunction")}awake(){this.watchTabVisible(),this.joinedRoomFunction=this.onUserJoined.bind(this)}onEnable(){this.context.connection.beginListen(Ds.JoinedRoom,this.joinedRoomFunction)}onDisable(){this.context.connection.stopListening(Ds.JoinedRoom,this.joinedRoomFunction)}async onUserJoined(t){var i;const n=await((i=this.asset)==null?void 0:i.instantiateSynced({parent:this.gameObject},!0));if(n){let r=Ee.getComponent(n,Zm);r&&(r.owner=this.context.connection.connectionId)}}watchTabVisible(){window.addEventListener("visibilitychange",t=>{if(document.visibilityState==="visible")for(let n=Zm.all.length-1;n>=0;n--){const i=Zm.all[n];(!i.owner||!this.context.connection.userIsInRoom(i.owner))&&i.doDestroy()}})}}yk([we(Ho)],_k.prototype,"asset",2);var Wy;const ia=(Wy=class extends pt{constructor(){super(...arguments);x(this,"owner")}static get all(){return ia._all}static get local(){return ia._local}static isLocalPlayer(e){var t,n,i,r;return e instanceof Ft?(n=(t=Ee.getComponentInParent(e,ia))==null?void 0:t.isLocalPlayer)!=null?n:!1:e instanceof Do&&(r=(i=Ee.getComponentInParent(e.gameObject,ia))==null?void 0:i.isLocalPlayer)!=null?r:!1}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}awake(){this.isLocalPlayer&&ia.local.push(this),ia.all.push(this),this.context.connection.beginListen(Ds.UserLeftRoom,e=>{if(e.userId===this.owner){this.doDestroy();return}})}start(){if(!this.owner||!this.context.connection.userIsInRoom(this.owner)){this.doDestroy();return}}doDestroy(){eM(this.gameObject,this.context.connection)}onDestroy(){if(ia.all.splice(ia.all.indexOf(this),1),this.isLocalPlayer){const e=ia._local.indexOf(this);e>=0&&ia._local.splice(e,1)}}},x(Wy,"_all",[]),x(Wy,"_local",[]),Wy);let Zm=ia;yk([m3(),we()],Zm.prototype,"owner",2);Be.add("AlignmentConstraint",jv);Be.add("Animation",Yl);Be.add("AnimationCurve",hM);Be.add("Animator",ph);Be.add("AnimatorController",Hf);Be.add("AudioListener",yg);Be.add("AudioSource",Br);Be.add("AvatarModel",mM);Be.add("AvatarLoader",gM);Be.add("AxesHelper",tA);Be.add("BasicIKConstraint",rF);Be.add("BoxHelperComponent",Uc);Be.add("Camera",qs);Be.add("Collider",uh);Be.add("SphereCollider",Ov);Be.add("BoxCollider",Fv);Be.add("InstantiateOptions",Go);Be.add("DeleteBox",yM);Be.add("Deletable",aF);Be.add("DeviceFlag",_M);Be.add("DragControls",Gc);Be.add("DropListener",Xv);Be.add("Duplicatable",sp);Be.add("CallInfo",xg);Be.add("EventListEvent",bM);Be.add("EventList",ya);Be.add("EventTrigger",pF);Be.add("FlyControls",mF);Be.add("BoxGizmo",sA);Be.add("GltfExportBox",xF);Be.add("GltfExport",Gl);Be.add("GridHelper",rA);Be.add("GroundProjectedEnv",oA);Be.add("Interactable",nA);Be.add("UsageMarker",iA);Be.add("Light",Qo);Be.add("LODModel",rp);Be.add("LODGroup",Jv);Be.add("LookAtConstraint",IM);Be.add("NavMesh",wF);Be.add("NavMeshAgent",bF);Be.add("NestedGltf",RM);Be.add("Networking",Hu);Be.add("OffsetConstraint",op);Be.add("OrbitControls",dh);Be.add("ParticleSystemRenderer",PM);Be.add("ParticleSystem",MF);Be.add("MainModule",CF);Be.add("EmissionModule",EF);Be.add("ShapeModule",SF);Be.add("PlayerColor",ah);Be.add("FieldWithDefault",AF);Be.add("Renderer",Xs);Be.add("MeshRenderer",SM);Be.add("SkinnedMeshRenderer",_F);Be.add("RendererLightmap",V_);Be.add("Rigidbody",yr);Be.add("ScreenCapture",Zv);Be.add("ShadowCatcher",$v);Be.add("RemoteSkybox",ex);Be.add("SmoothFollow",tx);Be.add("SpatialTriggerReceiver",Wc);Be.add("SpatialTrigger",nx);Be.add("SpectatorCamera",y3);Be.add("SpringJoint",_3);Be.add("Sprite",QM);Be.add("SpriteRenderer",fA);Be.add("SyncedCamera",jM);Be.add("SyncedRoom",Yu);Be.add("SyncedTransform",oh);Be.add("TestRunner",v3);Be.add("TestSimulateUserData",x3);Be.add("TransformGizmo",qM);Be.add("VideoPlayer",Dr);Be.add("Voip",yh);Be.add("VolumeParameter",E3);Be.add("VolumeComponent",mp);Be.add("ToneMapping",sx);Be.add("ColorAdjustments",rx);Be.add("VolumeProfile",ox);Be.add("Volume",XM);Be.add("WebARSessionRoot",ip);Be.add("WebXR",_i);Be.add("WebAR",If);Be.add("AvatarMarker",nr);Be.add("WebXRAvatar",zc);Be.add("TeleportTarget",vM);Be.add("WebXRController",Zi);Be.add("AttachedObject",fa);Be.add("XRGrabModel",YM);Be.add("XRGrabRendering",S3);Be.add("XRRig",xM);Be.add("VRUserState",Ha);Be.add("WebXRSync",H_);Be.add("XRState",Ja);Be.add("XRFlag",mr);Be.add("AvatarBlink_Simple",gp);Be.add("AvatarEyeLook_Rotation",mA);Be.add("Avatar_POI",Qr);Be.add("Avatar_Brain_LookAt",z_);Be.add("Avatar_MouthShapes",cx);Be.add("Avatar_MustacheShake",I3);Be.add("__Ignore",Ak);Be.add("LogStats",R3);Be.add("RGBAColor",fo);Be.add("PlayableDirector",Bf);Be.add("SignalAsset",KM);Be.add("SignalReceiverEvent",ZM);Be.add("SignalReceiver",lx);Be.add("AnimationTrackHandler",$M);Be.add("AudioTrackHandler",e1);Be.add("SignalTrackHandler",$_);Be.add("ControlTrackHandler",Pf);Be.add("BaseUIComponent",Zc);Be.add("UIRootComponent",xx);Be.add("Button",xh);Be.add("Canvas",_a);Be.add("CanvasGroup",AA);Be.add("EventSystem",pa);Be.add("Graphic",Ju);Be.add("MaskableGraphic",bx);Be.add("Image",Cx);Be.add("RawImage",v1);Be.add("InputField",_p);Be.add("Keyboard",uk);Be.add("LayoutGroup",yA);Be.add("VerticalLayoutGroup",dk);Be.add("HorizontalLayoutGroup",fk);Be.add("GridLayoutGroup",pk);Be.add("PointerEventData",xf);Be.add("Raycaster",w1);Be.add("ObjectRaycaster",Sg);Be.add("GraphicRaycaster",mk);Be.add("Size",ok);Be.add("Rect",y1);Be.add("RectTransform",vh);Be.add("SpatialHtml",gk);Be.add("Text",Jr);Be.add("PresentationMode",Cie);Be.add("LinesDrawer",p_);Be.add("LineInstanceHandler",Km);Be.add("LinesManager",HE);Be.add("PlayerSync",_k);Be.add("PlayerState",Zm);const vk=uo;function Tie(a,e){const n=H9(a,e);return n!==void 0?n:null}async function xk(a,e,t,n=null,i){if(!t)return;let r=n;typeof r=="number"&&(r=new Aa(n));const o=new qD(t.scene);o.gltfId=e,o.context=a,o.gltf=t,o.nodeToObject=i==null?void 0:i.nodeToObjectMap;const l=[];if(t.scenes)for(const h of t.scenes)await WE(o,h,l);if(t.children)for(const h of t.children)await WE(o,h,l);a.new_scripts_pre_setup_callbacks.push(()=>{for(const h of l)Iie(h,o);if(r){VE(t,r);for(const h of t.scenes)VE(h,r)}})}function VE(a,e){if(e!==null&&!!a){if(a.guid=e.generateUUID(),a&&a.userData&&a.userData.components)for(const t of a.userData.components)t!==null&&(t.guid=e.generateUUID());if(a.children)for(const t of a.children)VE(t,e)}}const Pm=[];async function WE(a,e,t,n){if(!e)return;const i=e.userData;if(i){const r=i.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const l=Be.get(o.name);if(l!=null){const h=new l;h.sourceId=a.gltfId,Pv(h,o),DD(h,e,!1),t.push({instance:h,compData:o,obj:e})}else vk&&console.debug("unknown component: "+o.name),Pm.includes(o.name)||Pm.push(o.name)}catch(l){console.error(o.name+" - "+l.message,l)}if(Pm.length>0){const o=Pm.join(", ");console.warn("unknown components: "+o),Pm.length=0}}if(e.children)for(const r of e.children)await WE(a,r,t)}function Iie(a,e){const{instance:t,compData:n,obj:i}=a;e.object=i,e.target=t,pE(t,n,e),vk&&console.debug("add "+n.name,n,t)}new ks;const _A=new Uint8Array(4);_A[0]=255;_A[1]=255;_A[2]=255;_A[3]=255;const Rie=new ja(_A,1,1,ds);function Pie(a,e=1){const t="alpha"in a,n=e*e,i=new Uint8Array(4*n),r=Math.floor(a.r*255),o=Math.floor(a.g*255),l=Math.floor(a.b*255);for(let u=0;u<n;u++){const f=u*4;i[f+0]=r,i[f+1]=o,i[f+2]=l,t?i[f+3]=Math.floor(a.alpha*255):i[f+3]=255}const h=new ja(i,e,e);return h.needsUpdate=!0,h}function Bie(a,e,t,n=1,i=3){const o=n*i,l=[a,e,t],h=l.length,u=new Uint8Array(4*h*o),f=new ye;for(let m=0;m<i;m++){const A=Math.floor(m/i*h),v=Ci.clamp(A+1,0,h-1),b=l[A],C=l[v],S=m/i*h%1;f.lerpColors(b,C,S);const I=Math.floor(f.r*255),M=Math.floor(f.g*255),R=Math.floor(f.b*255);for(let T=0;T<n;T++){const B=(m*n+T)*4;u[B+0]=I,u[B+1]=M,u[B+2]=R,u[B+3]=255}}const g=new ja(u,n,i);return g.needsUpdate=!0,g}function nv(a,e){const t=a.elements;e||(e=[]),e.length=0;for(let n=0;n<16;n+=4){const i=t[n],r=t[n+1],o=t[n+2],l=t[n+3],h=new Bn(i,r,o,l);e.push(h)}return e}const CC=[],SL=[];function wk(a,e){if(CC.length===0)for(let t=0;t<27;t++)CC.push(0);e||(e=CC);for(let t=0;t<27;t++)SL[t]=e[t];e=SL,a.unity_SHAr={value:new Bn(e[9],e[3],e[6],e[0])},a.unity_SHBr={value:new Bn(e[12],e[15],e[18],e[21])},a.unity_SHAg={value:new Bn(e[10],e[4],e[7],e[1])},a.unity_SHBg={value:new Bn(e[13],e[16],e[19],e[22])},a.unity_SHAb={value:new Bn(e[11],e[5],e[8],e[2])},a.unity_SHBb={value:new Bn(e[14],e[17],e[20],e[23])},a.unity_SHC={value:new Bn(e[24],e[25],e[26],1)}}class Lie{constructor(e,t,n){x(this,"vertexShader");x(this,"fragmentShader");x(this,"technique");this.vertexShader=e,this.fragmentShader=t,this.technique=n}}async function Die(a,e){if(!a)return console.error("Can not find technique: no shader data"),null;const t=a.programs[e],n=t.vertexShader,i=t.fragmentShader;if(n!==void 0&&i!==void 0){const r=a.shaders[n],o=a.shaders[i];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await ML(r),!o.code&&o.uri&&await ML(o),!r.code||!o.code)return null;const l=a.techniques[e];return new Lie(r.code,o.code,l)}}return console.error("Shader technique not found",e),null}async function ML(a){const e=a.uri;if(!!e)if(e.endsWith(".glsl")){const n=await new ks().loadAsync(e);a.code=n.toString()}else a.code=Oie(a.uri)}function Oie(a){return decodeURIComponent(Array.prototype.map.call(atob(a),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}var bk=(a=>(a[a.INT=5124]="INT",a[a.FLOAT=5126]="FLOAT",a[a.FLOAT_VEC2=35664]="FLOAT_VEC2",a[a.FLOAT_VEC3=35665]="FLOAT_VEC3",a[a.FLOAT_VEC4=35666]="FLOAT_VEC4",a[a.INT_VEC2=35667]="INT_VEC2",a[a.INT_VEC3=35668]="INT_VEC3",a[a.INT_VEC4=35669]="INT_VEC4",a[a.BOOL=35670]="BOOL",a[a.BOOL_VEC2=35671]="BOOL_VEC2",a[a.BOOL_VEC3=35672]="BOOL_VEC3",a[a.BOOL_VEC4=35673]="BOOL_VEC4",a[a.FLOAT_MAT2=35674]="FLOAT_MAT2",a[a.FLOAT_MAT3=35675]="FLOAT_MAT3",a[a.FLOAT_MAT4=35676]="FLOAT_MAT4",a[a.SAMPLER_2D=35678]="SAMPLER_2D",a[a.SAMPLER_3D=35680]="SAMPLER_3D",a[a.SAMPLER_CUBE=35681]="SAMPLER_CUBE",a[a.UNKNOWN=0]="UNKNOWN",a))(bk||{});const Dc=Ct("debugshaders"),af="NEEDLE_techniques_webgl";class Fie{constructor(){x(this,"objectToWorldMatrix",new fn);x(this,"worldToObjectMatrix",new fn);x(this,"objectToWorld",new Array);x(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),nv(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),nv(this.worldToObjectMatrix,this.worldToObject)}}const Ji=class extends BS{constructor(t,...n){super(...n);x(this,"identifier");x(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));x(this,"_sphericalHarmonicsName","unity_SpecCube0");x(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");x(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");x(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");x(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");x(this,"_rendererData",new Fie);this.identifier=t,Dc&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName]&&this.waitForLighting(),(this.depthTextureUniform||this.opaqueTextureUniform)&&ui.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const t=super.clone();return Ck(t),t}dispose(){super.dispose();const t=ui.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&ui.Current.pre_render_callbacks.splice(t,1)}async waitForLighting(){const t=ui.Current;if(!t){console.error("Missing context");return}const n=await t.rendererData.getSceneLightingData(this.identifier);if(!n||!n.array){console.warn("Missing lighting data for custom shader, getSceneLightingData did not return anything");return}Dc&&console.log(n);const i=n.array,r=n.texture;this.uniforms.unity_SpecCube0={value:r},wk(this.uniforms,i);const o=Math.sqrt(Math.PI*.5);this.uniforms.unity_SpecCube0_HDR={value:new Bn(o,o,o,o)},Dc&&console.log("Set environment lighting",this.uniforms)}get depthTextureUniform(){if(!!this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(!!this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&ui.Current.setRequireColor(!0),this.depthTextureUniform&&ui.Current.setRequireDepth(!0)}onBeforeRender(t,n,i,r,o,l){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(i,o)}onUpdateUniforms(t,n){const i=ui.Current;t&&(Ji.viewProjection&&this.uniforms[this._viewProjectionName]&&(Ji.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),nv(Ji.viewProjection,Ji._viewProjectionValues)),Ji.viewMatrix&&this.uniforms[this._viewMatrixName]&&(Ji.viewMatrix.copy(t.matrixWorldInverse),nv(Ji.viewMatrix,Ji._viewMatrixValues)),this.uniforms[Ji._worldSpaceCameraPosName]&&Ji._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=i.rendererData.timeVec4);const r=i==null?void 0:i.mainLight;if(r){const h=r.getWorldPosition(Ji._mainLightPosition);this.uniforms._MainLightPosition={value:h.normalize()},Ji._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:Ji._mainLightColor};const u=r.intensity;Ji._lightData.z=u,this.uniforms.unity_LightData={value:Ji._lightData}}if(t&&(Ji.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=Ji._viewProjectionValues),Ji.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=Ji._viewMatrixValues),this.uniforms[Ji._worldSpaceCameraPosName]&&(this.uniforms[Ji._worldSpaceCameraPosName]={value:Ji._worldSpaceCameraPos}),i.mainCameraComponent)){if(this.uniforms._ProjectionParams){const h=this.uniforms._ProjectionParams.value;h.x=1,h.y=i.mainCameraComponent.nearClipPlane,h.z=i.mainCameraComponent.farClipPlane,h.w=1/h.z,this.uniforms._ProjectionParams.value=h}if(this.uniforms._ZBufferParams){const h=this.uniforms._ZBufferParams.value,u=i.mainCameraComponent;h.x=1-u.farClipPlane/u.nearClipPlane,h.y=u.farClipPlane/u.nearClipPlane,h.z=h.x/u.farClipPlane,h.w=h.y/u.farClipPlane,this.uniforms._ZBufferParams.value=h}if(this.uniforms._ScreenParams){const h=this.uniforms._ScreenParams.value;h.x=i.domWidth,h.y=i.domHeight,h.z=1+1/h.x,h.w=1+1/h.y,this.uniforms._ScreenParams.value=h}}const o=this.depthTextureUniform;o&&(o.value=i.depthTexture);const l=this.opaqueTextureUniform;if(l&&(l.value=i.opaqueColorTexture),n){const h=this._rendererData;h.updateFrom(n),this.uniforms[this._worldToObjectName].value=h.worldToObject,this.uniforms[this._objToWorldName].value=h.objectToWorld}this.uniformsNeedUpdate=!0}};let Bo=Ji;x(Bo,"viewProjection",new fn),x(Bo,"_viewProjectionValues",[]),x(Bo,"viewMatrix",new fn),x(Bo,"_viewMatrixValues",[]),x(Bo,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),x(Bo,"_worldSpaceCameraPos",new q),x(Bo,"_mainLightColor",new Bn),x(Bo,"_mainLightPosition",new q),x(Bo,"_lightData",new Bn);class kie{constructor(e,t){x(this,"parser");x(this,"identifier");this.parser=e,this.identifier=t}get name(){return af}loadMaterial(e){const t=this.parser.json.materials[e];if(!t)return Dc&&console.log(e,this.parser.json.materials),null;if(!t.extensions||!t.extensions[af])return Dc&&console.log("material "+e+" does not use NEEDLE_techniques_webgl"),null;const n=t.extensions[af].technique;if(n<0)return null;const i=this.parser.json.extensions[af];if(!i)return null;Dc&&console.log(i);const r=i.techniques[n];return r?new Promise(async(o,l)=>{var C,S,I;const h=await Die(i,r.program),u=h==null?void 0:h.fragmentShader,f=h==null?void 0:h.vertexShader;if(!u||!f)return l();Dc&&console.log("loadMaterial",t,h);const g={},m=r.uniforms;for(const M in m){const R=M;switch(R){case"_TimeParameters":const T=new Bn;g[R]={value:T};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":g[R]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":g[R]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":g[R]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":g[R]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":g[R]={value:null};break}}let A=!1;if(t.extensions&&t.extensions[af]){const M=t.extensions[af];if(M.technique===n){Dc&&console.log(t.name,"Material Properties",M);for(const R in M.values){const T=M.values[R];if(typeof T=="string"){if(T.startsWith("/textures/")){const B=T.substring(10),F=Number.parseInt(B);if(F>=0){const D=await this.parser.getDependency("texture",F);D&&(D.encoding=Ar,D.needsUpdate=!0),g[R]={value:D};continue}}switch(R){case"alphaMode":T==="BLEND"&&(A=!0);continue}}if(Array.isArray(T)&&T.length===4){g[R]={value:new Bn(T[0],T[1],T[2],T[3])};continue}g[R]={value:T}}}}const v=new Bo(this.identifier,{name:(C=t.name)!=null?C:"",uniforms:g,vertexShader:f,fragmentShader:u,lights:!1});switch((S=g._Cull)==null?void 0:S.value){case 0:v.side=ir;break;case 1:v.side=Wr;break;case 2:v.side=zo;break;default:v.side=zo;break}v.transparent=A,A&&(v.depthWrite=!1),wk(g),v.onUpdateUniforms();for(const M in m){const R=M,T=m[M].type;if(((I=g[R])==null?void 0:I.value)===void 0)switch(T){case bk.SAMPLER_2D:g[R]={value:Rie},console.warn("Missing/unassigned texture, fallback to white: "+R);break;default:console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+R,m[M]);break}}Dc&&console.log(v.uuid,g),Ck(v),o(v)}):null}}function Ck(a){if(a.uniforms)for(const e in a.uniforms)Object.getOwnPropertyDescriptor(a,e)||Object.defineProperty(a,e,{get:()=>a.uniforms[e].value,set:t=>{a.uniforms[e].value=t,a.needsUpdate=!0}})}const EC=Ct("debugexr");class Nie{constructor(e){this.parser=e,this.name="EXT_texture_exr",EC&&console.log(e)}loadTexture(e){const t=this.name,n=this.parser,r=n.json.textures[e];if(EC&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[t])return null;const o=r.extensions[t];let l=new d3(n.options.manager);return EC&&console.log("EXT_texture_exr.loadTexture",o,l),n.loadTextureImage(e,o.source,l)}}const TL="NEEDLE_gameobject_data";class Uie{constructor(e){x(this,"parser");this.parser=e}get name(){return TL}afterRoot(e){const t=[];for(let n=0;n<this.parser.json.nodes.length;n++){const i=this.parser.json.nodes[n];if(i&&i.extensions){const r=i.extensions[TL];if(r){const o=this.findAndApplyExtensionData(n,r);t.push(o)}}}return Promise.all(t).then(()=>{})}async findAndApplyExtensionData(e,t){const n=await this.parser.getDependency("node",e);n&&this.applyExtensionData(n,t)}applyExtensionData(e,t){e.userData.layer=t.layers,e.userData.tag=t.tag,e.userData.hideFlags=t.hideFlags,e.userData.static=t.static,e.visible=t.activeSelf,e.guid=t.guid}}const IL="NEEDLE_lightmaps",zie=Ct("debuglightmapsextension");var jl=(a=>(a[a.Lightmap=0]="Lightmap",a[a.Skybox=1]="Skybox",a[a.Reflection=2]="Reflection",a))(jl||{});class Gie{constructor(e,t,n){x(this,"parser");x(this,"registry");x(this,"source");this.parser=e,this.registry=t,this.source=n}get name(){return IL}afterRoot(e){const t=this.parser.json.extensions;if(t){const n=t[IL];if(n){const i=n.textures;return i.length?(zie&&console.log(n),new Promise(async(r,o)=>{const l=[];for(const h of i)if(h.pointer){const u=nM(this.parser,h.pointer).then(f=>{const g=f;g!=null&&g.isTexture&&(this.registry?(h.type!==0&&(g.encoding=Gn),(g.type==Ms||g.type==Fs)&&(g.flipY=!0),this.registry.registerTexture(this.source,h.type,g,h.index)):console.log(jl[h.type],h.pointer,g))});l.push(u)}await Promise.all(l),r()})):null}}return null}}class Hie{static fromCubeTexture(e){let t=0;const n=new q,i=new q,r=new ye,o=[0,0,0,0,0,0,0,0,0],l=new vf,h=l.coefficients;for(let f=0;f<6;f++){const g=e.image[f],m=g.width,A=g.height,v=document.createElement("canvas");v.width=m,v.height=A;const b=v.getContext("2d");b.drawImage(g,0,0,m,A);const C=b.getImageData(0,0,m,A),S=C.data,I=C.width,M=2/I;for(let R=0,T=S.length;R<T;R+=4){r.setRGB(S[R]/255,S[R+1]/255,S[R+2]/255),RL(r,e.encoding);const B=R/4,F=-1+(B%I+.5)*M,D=1-(Math.floor(B/I)+.5)*M;switch(f){case 0:n.set(-1,D,-F);break;case 1:n.set(1,D,F);break;case 2:n.set(-F,1,-D);break;case 3:n.set(-F,-1,D);break;case 4:n.set(-F,D,1);break;case 5:n.set(F,D,-1);break}const U=n.lengthSq(),W=4/(Math.sqrt(U)*U);t+=W,i.copy(n).normalize(),vf.getBasisAt(i,o);for(let J=0;J<9;J++)h[J].x+=o[J]*r.r*W,h[J].y+=o[J]*r.g*W,h[J].z+=o[J]*r.b*W}}const u=4*Math.PI/t;for(let f=0;f<9;f++)h[f].x*=u,h[f].y*=u,h[f].z*=u;return new zf(l)}static fromCubeRenderTarget(e,t){let n=0;const i=new q,r=new q,o=new ye,l=[0,0,0,0,0,0,0,0,0],h=new vf,u=h.coefficients;for(let g=0;g<6;g++){const m=t.width,A=new Uint8Array(m*m*4);e.readRenderTargetPixels(t,0,0,m,m,A,g);const v=2/m;for(let b=0,C=A.length;b<C;b+=4){o.setRGB(A[b]/255,A[b+1]/255,A[b+2]/255),RL(o,t.texture.encoding);const S=b/4,I=-1+(S%m+.5)*v,M=1-(Math.floor(S/m)+.5)*v;switch(g){case 0:i.set(1,M,-I);break;case 1:i.set(-1,M,I);break;case 2:i.set(I,1,-M);break;case 3:i.set(I,-1,M);break;case 4:i.set(I,M,1);break;case 5:i.set(-I,M,-1);break}const R=i.lengthSq(),T=4/(Math.sqrt(R)*R);n+=T,r.copy(i).normalize(),vf.getBasisAt(r,l);for(let B=0;B<9;B++)u[B].x+=l[B]*o.r*T,u[B].y+=l[B]*o.g*T,u[B].z+=l[B]*o.b*T}}const f=4*Math.PI/n;for(let g=0;g<9;g++)u[g].x*=f,u[g].y*=f,u[g].z*=f;return new zf(h)}}function RL(a,e){switch(e){case Gn:a.convertSRGBToLinear();break;case Ar:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.");break}return a}const QE=Ct("debugenvlight");var $m=(a=>(a[a.Skybox=0]="Skybox",a[a.Trilight=1]="Trilight",a[a.Flat=3]="Flat",a[a.Custom=4]="Custom",a))($m||{}),jE=(a=>(a[a.Skybox=0]="Skybox",a[a.Custom=1]="Custom",a))(jE||{});class Vie{constructor(e){x(this,"context");x(this,"sceneLightSettings");x(this,"_timevec4",new Bn);x(this,"_waitPromise");x(this,"_lighting",{});this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){return this.sceneLightSettings?this.sceneLightSettings.ambientIntensity:1}registerSceneLightSettings(e){this.sceneLightSettings=e}registerReflection(e,t){const n=new Wie(this.context,t,1);this._lighting[e]=n}getReflection(e){return this._lighting[e]}enableReflection(e){var t,n,i;switch(QE&&console.log(this.sceneLightSettings?$m[this.sceneLightSettings.ambientMode]:"Unknown ambient mode"),(t=this.sceneLightSettings)==null?void 0:t.ambientMode){case 0:case 4:const r=this.getReflection(e);if(r&&r.Source){const o=this.context.scene,l=r.Source;l.encoding=Gn,l.mapping=Qa,o.environment=l;return}break}if(((n=this.sceneLightSettings)==null?void 0:n.environmentReflectionSource)===1)switch((i=this.sceneLightSettings)==null?void 0:i.ambientMode){case 1:if(this.sceneLightSettings.ambientTrilight){const r=this.sceneLightSettings.ambientTrilight,o=Bie(r[0],r[1],r[2],64,64);o.encoding=Gn,o.mapping=Qa,this.context.scene.environment=o}else console.error("Missing ambient trilight",this.sceneLightSettings.sourceId);return;case 3:if(this.sceneLightSettings.ambientLight){const r=Pie(this.sceneLightSettings.ambientLight,64);r.encoding=Gn,r.mapping=Qa,this.context.scene.environment=r}else console.error("Missing ambientlight",this.sceneLightSettings.sourceId);return;default:return}}disableReflection(){const e=this.context.scene;e.environment=null}async getSceneLightingData(e){return QE&&console.log("GET SCENE LIGHT DATA"),this._waitPromise?this._waitPromise:(this._waitPromise=new Promise((t,n)=>{let i=setInterval(async()=>{var o,l;const r=this.getReflection(e);r&&(clearInterval(i),t(r.getSphericalHarmonicsArray((l=(o=this.sceneLightSettings)==null?void 0:o.ambientIntensity)!=null?l:1)))},10)}),this._waitPromise)}}class Wie{constructor(e,t,n=1){x(this,"_context");x(this,"_source");x(this,"_sphericalHarmonics",null);x(this,"_sphericalHarmonicsArray");x(this,"_ambientScale",1);x(this,"_lightProbe");this._context=e,this._source=t,this._ambientScale=n,t.mapping=Qa,t.encoding=Gn}get Source(){return this._source}get Array(){return this._sphericalHarmonicsArray}getSphericalHarmonicsArray(e=1){var t;if(((t=this._sphericalHarmonicsArray)==null?void 0:t.length)&&this._source)return{array:this._sphericalHarmonicsArray,texture:this._source,lightProbe:this._lightProbe};try{const n=this._source;let i=null;if(n){QE&&console.log("GENERATING LIGHT PROBE",n);const r=Math.min(n.image.width,512);i=new fS(r).fromEquirectangularTexture(this._context.renderer,n),this._source=i.texture}if(this._sphericalHarmonicsArray=[],i){const r=Hie.fromCubeRenderTarget(this._context.renderer,i);this._lightProbe=r;const o=this._ambientScale*(e*e*Math.PI*.5)-1;this._sphericalHarmonics=r.sh,this._sphericalHarmonicsArray=this._sphericalHarmonics.toArray();const l=e/(Math.PI*.5);for(let h=0;h<this._sphericalHarmonicsArray.length;h++)this._sphericalHarmonicsArray[h]*=l;if(r.sh.scale(o),this._source)return{array:this._sphericalHarmonicsArray,texture:this._source,lightProbe:r}}}catch(n){console.error(n)}return null}}const PL="NEEDLE_lighting_settings",ff=Ct("debugenvlight");class Qie{constructor(e,t,n){x(this,"parser");x(this,"sourceId");x(this,"context");this.parser=e,this.sourceId=t,this.context=n}get name(){return PL}afterRoot(e){const t=this.parser.json.extensions;if(t){const n=t[PL];if(n){ff&&console.log(n);const i=Ee.addNewComponent(e.scene,jie,!1);i.sourceId=this.sourceId,i.ambientIntensity=n.ambientIntensity,i.ambientLight=new ye().fromArray(n.ambientLight),Array.isArray(n.ambientTrilight)&&(i.ambientTrilight=n.ambientTrilight.map(r=>new ye().fromArray(r))),i.ambientMode=n.ambientMode,i.environmentReflectionSource=n.environmentReflectionSource,this.context&&this.context.rendererData.registerSceneLightSettings(i)}}return null}}class jie extends pt{constructor(){super(...arguments);x(this,"ambientMode",$m.Skybox);x(this,"ambientLight");x(this,"ambientTrilight");x(this,"ambientIntensity",1);x(this,"environmentReflectionSource",jE.Skybox);x(this,"_hasReflection",!1);x(this,"_ambientLightObj");x(this,"_lightProbeObj")}awake(){if(this.sourceId){const t=this.environmentReflectionSource===jE.Skybox?jl.Skybox:jl.Reflection,n=this.context.lightmaps.tryGet(this.sourceId,t,0);this._hasReflection=n!=null,n&&this.context.rendererData.registerReflection(this.sourceId,n)}ff&&window.addEventListener("keydown",t=>{switch(t.key){case"l":this.enabled=!this.enabled;break}})}onEnable(){var n,i,r;const t=((n=this.context.mainCameraComponent)==null?void 0:n.sourceId)===this.sourceId;if(ff&&console.log("Enable scene lighting",this.sourceId,t,this,(i=this.context.mainCameraComponent)==null?void 0:i.sourceId),t||ff&&console.warn("This is no active?!",(r=this.context.mainCameraComponent)==null?void 0:r.sourceId),this.ambientMode==$m.Flat)this.ambientLight&&!this._ambientLightObj&&(this._ambientLightObj=new zS(this.ambientLight,Math.PI*this.ambientIntensity)),this._ambientLightObj&&this.gameObject.add(this._ambientLightObj),this._lightProbeObj&&this._lightProbeObj.removeFromParent();else if(this.ambientMode===$m.Trilight){if(this.ambientTrilight){const o=this.ambientTrilight[0],l=this.ambientTrilight[this.ambientTrilight.length-1],h=new NS(l,o,this.ambientIntensity);this.gameObject.add(h)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._lightProbeObj?this.enabled&&this.destroyed&&this._lightProbeObj&&this.scene.add(this._lightProbeObj):this.sourceId&&this.context.rendererData.getSceneLightingData(this.sourceId).then(o=>{ff&&console.log(o),o&&(this._lightProbeObj=o.lightProbe,this.enabled&&!this.destroyed&&this._lightProbeObj&&this.scene.add(this._lightProbeObj))});this.sourceId&&this.context.rendererData.enableReflection(this.sourceId)}onDisable(){ff&&console.log("disable",this.sourceId,this),this._lightProbeObj&&this._lightProbeObj.removeFromParent(),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this.sourceId&&this.context.rendererData.disableReflection()}}function Ek(a){const e=new vF;return a.register(t=>(e.parser=t,e)),e}class qie{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}function Sk(a,e,t){a.register(i=>new Uie(i)),a.register(i=>new z9(i)),a.register(i=>new Gie(i,e.lightmaps,t)),a.register(i=>new Qie(i,t,e)),a.register(i=>new kie(i,t)),a.register(i=>new qm(i,t)),a.register(i=>new Eu(i,t,e)),a.register(i=>new Nie(i));const n=a.setAnimationPointerResolver;typeof n=="function"&&n.bind(a)(new qie)}const Xie=Ct("printGltf");var Mk=(a=>(a[a.BeforeLoad=0]="BeforeLoad",a[a.AfterLoaded=1]="AfterLoaded",a[a.FinishedSetup=10]="FinishedSetup",a))(Mk||{});class Fu{constructor(e,t,n,i){x(this,"context");x(this,"loader");x(this,"path");x(this,"gltf");this.context=e,this.path=t,this.loader=n,this.gltf=i}}const Zl={};function Yie(a,e){Zl[a]=Zl[a]||[],Zl[a].push(e)}function Jie(a,e){if(Zl[a]){const t=Zl[a].indexOf(e);t>=0&&Zl[a].splice(t,1)}}function Lf(a,e){if(Zl[a])for(const t of Zl[a])t(e)}async function Tk(a,e,t,n,i){Xie&&console.log(t),await a.assets.registerGltf(t),await xk(a,e,t,n,i)}function Sx(a,e,t,n){typeof t!="string"&&console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t);const i=new np;Sk(i,a,t);const o=Ek(i);return new Promise((l,h)=>{try{qv(i,a),Lf(0,new Fu(a,t,i)),i.parse(e,t,async u=>{Lf(1,new Fu(a,t,i,u)),await Tk(a,t,u,n,o),Lf(10,new Fu(a,t,i,u)),l(u)},u=>{console.error("failed loading "+t,u),l(void 0)})}catch(u){console.error(u),h(u)}})}function vA(a,e,t,n=!1,i){const r=new np;Sk(r,a,e);const l=Ek(r);return new Promise((h,u)=>{try{qv(r,a),Lf(0,new Fu(a,e,r)),r.load(e,async f=>{Lf(1,new Fu(a,e,r,f)),await Tk(a,e,f,t,l),Lf(10,new Fu(a,e,r,f)),h(f)},f=>{i==null||i.call(r,f)},f=>{console.error("failed loading "+e,f),h(void 0)})}catch(f){console.error(f),u(f)}})}function Kie(a,e,t,n=!1){e&&e.animations&&e.animations.length>0&&t.push(()=>{Ik(e,n)})}function Ik(a,e=!1){var n;if(!a||!a.animations||!a.scene||!e&&!Ee.getComponentInChildren(a.scene,Yl))return;for(let i=0;i<a.animations.length;i++){const r=a.animations[i];if(!(!r.tracks||r.tracks.length<=0))for(const o in r.tracks){const l=r.tracks[o],h=(n=l.__objectName)!=null?n:l.name.substring(0,l.name.indexOf(".")),u=a.scene.getObjectByName(h);if(!u)continue;let f=t(u);if(!f)if(e)f=Ee.addNewComponent(a.scene,Yl);else{console.warn("Failed finding animator for",l.name,h);continue}const g=f.animations=f.animations||[];r.name_animator=f.name,g.indexOf(r)<0&&g.push(r)}}function t(i){var o;if(!i)return;const r=(o=i.userData)==null?void 0:o.components;if(r&&r.length>0)for(let l=0;l<r.length;l++){const h=r[l];if(h instanceof ph||h instanceof Yl)return i}return t(i.parent)}}function Rk(a,e,t=!0){if(e.userData&&e.userData.name===a)return e;if(e.children&&e.children.length>0)for(let n=0;n<e.children.length;n++){const i=e.children[n],r=Rk(a,i,t);if(r)return r}}function Zie(a,e,t=!0){return Gf(a,e,t)}function $ie(a,e=null){const t=e!=null?e:ui.Current.scripts;for(const n in t){const i=t[n];if(i&&i.guid===a)return i}return null}const ese=Object.freeze(Object.defineProperty({__proto__:null,GltfLoadEventType:Mk,GltfLoadEvent:Fu,addGltfLoadEventListener:Yie,removeGltfLoadEventListener:Jie,parseSync:Sx,loadSync:vA,findAnimationsLate:Kie,findAnimations:Ik,tryFindObjectByName:Rk,tryFindObject:Zie,tryFindScript:$ie},Symbol.toStringTag,{value:"Module"}));function b1(a,e,t){var r;let n=Ee.getComponentInChildren(a,Gc);if(n||(n=Ee.addNewComponent(a,Gc,!1),n.guid=e.generateUUID()),n&&!Ee.getComponent(n.gameObject,oh)){const o=Ee.addNewComponent(n.gameObject,oh,!1);o.guid=e.generateUUID()}if(n&&!Ee.getComponentInParent(n.gameObject,Sg)){const o=Ee.addNewComponent(n.gameObject,Sg,!1);o.guid=e.generateUUID()}if(t&&((r=t.animations)==null?void 0:r.length)>0){const o=t.animations[0],l=Ee.addNewComponent(a,Yl,!1);l.animations=[o]}let i=!1;a.traverse(o=>{!o||o.isSkinnedMesh===!0&&(i||console.log("Disabling frustum culling for skinned meshes",t),i=!0,o.frustumCulled=!1)})}class tse{constructor(e,t,n,i,r,o,l,h){x(this,"guid");x(this,"file_name");x(this,"file_hash");x(this,"file_size");x(this,"position");x(this,"seed");x(this,"sender");x(this,"serverUrl");x(this,"parentGuid");x(this,"boundsSize");this.seed=t,this.guid=n,this.file_name=i,this.file_hash=r,this.file_size=o,this.position=l,this.sender=e,this.serverUrl=h}}async function nse(a,e,t){const n=a.name;return n.endsWith(".gltf")||n.endsWith(".glb")?new Promise((i,r)=>{const o=new FileReader;o.readAsDataURL(a),o.onloadend=async l=>{const h=o.result,u=tM(),f=new Aa(u),g=await vA(e,h,f,!0);if(g&&g.scene){const m=g.scene;if(!m.guid){const A=new Aa(u);m.guid=A.generateUUID()}t&&rse(e.connection,a,u,m,t),b1(m,f,g),i(g)}}}):(console.warn("Unsupported file type: "+n),console.log(a),null)}async function ise(a,e){return new Promise(async(t,n)=>{const i=tM(),r=new Aa(i),o=await vA(e,a.toString(),r,!0);if(o&&o.scene){const l=o.scene;b1(l,r,o),t(o)}else console.warn("Unsupported file type: "+a.toString())})}function sse(a){a.connection.beginListen("file-spawned",async e=>{if(e.sender!==a.connection.connectionId){console.log("received file event",e),ose(e,a);let t=null;try{t=await sF(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{ase(e)}if(t){const n=new Aa(e.seed),i=await Sx(a,t,null,n);if(i&&i.scene){const r=i.scene;if(b1(r,n,i),e.parentGuid){const o=Ee.findByGuid(e.parentGuid,a.scene);"add"in o&&o.add(r)}r.parent||a.scene.add(r),e.position!==null&&r.position.copy(e.position)}}else console.error("download didnt return file")}})}async function rse(a,e,t,n,i){var l;if(!a.connectionId){console.error("Can not upload file - no connection id");return}if(!n.guid){console.error("Can not upload file - no guid",n,n.guid);return}const r=await yZ(e,i);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",e.name);return}if(!r.hash){console.error("Can not send upload event - no hash",e.name);return}const o=new tse(a.connectionId,t,n.guid,r.filename,r.hash,e.size,n.position,(l=r.url)!=null?l:i);n.parent&&(o.parentGuid=n.parent.guid),a.send("file-spawned",o)}const qE={};function ose(a,e){const t=new zi,n=new _t(t,new Hi({color:65280})),i=new QS(n,5592405);if(qE[a.guid]=i,e.scene.add(i),a.parentGuid){const r=Ee.findByGuid(a.parentGuid,e.scene);r&&r.add(i)}a.position&&i.position.copy(a.position)}function ase(a,e){const t=a.guid,n=qE[t];n&&(delete qE[t],n.removeFromParent())}Ct("debugassets");class cse{constructor(){x(this,"texturesLoader",new Xg);x(this,"textures",{});x(this,"texturesLoading",{});x(this,"_materials",new Map);x(this,"_meshes",new Map);x(this,"_textures",new Map);window.addEventListener("unhandledrejection",e=>{var n;if(e.defaultPrevented)return;const t=(n=e==null?void 0:e.reason)==null?void 0:n.path;if(t){const i=t[0];i&&i.tagName==="IMG"&&(console.warn(`Could not load image:
`+i.src),e.preventDefault())}})}async loadTexture(e){if(this.textures[e])return this.textures[e];if(this.texturesLoading[e])return await this.texturesLoading[e];const t=this.texturesLoader.loadAsync(e);this.texturesLoading[e]=t;const n=await t;return delete this.texturesLoading[e],this.textures[e]=n,n}getTexture(e){return this._textures.get(e)||null}findTexture(e){for(const t of this._textures.values())if(t.name===e)return t;return null}findMesh(e){for(const t of this._meshes.values())if(t.name===e)return t;return null}findMaterial(e){for(const t of this._materials.values())if(t.name===e)return t;return null}async registerGltf(e){}registerAsset(e){}}var eg=function(){var a=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(f){f.preventDefault(),n(++a%e.children.length)},!1);function t(f){return e.appendChild(f.dom),f}function n(f){for(var g=0;g<e.children.length;g++)e.children[g].style.display=g===f?"block":"none";a=f}var i=(performance||Date).now(),r=i,o=0,l=t(new eg.Panel("FPS","#0ff","#002")),h=t(new eg.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new eg.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){o++;var f=(performance||Date).now();if(h.update(f-i,200),f>=r+1e3&&(l.update(o*1e3/(f-r),100),r=f,o=0,u)){var g=performance.memory;u.update(g.usedJSHeapSize/1048576,g.jsHeapSizeLimit/1048576)}return f},update:function(){i=this.end()},domElement:e,setMode:n}};eg.Panel=function(a,e,t){var n=1/0,i=0,r=Math.round,o=r(window.devicePixelRatio||1),l=80*o,h=48*o,u=3*o,f=2*o,g=3*o,m=15*o,A=74*o,v=30*o,b=document.createElement("canvas");b.width=l,b.height=h,b.style.cssText="width:80px;height:48px";var C=b.getContext("2d");return C.font="bold "+9*o+"px Helvetica,Arial,sans-serif",C.textBaseline="top",C.fillStyle=t,C.fillRect(0,0,l,h),C.fillStyle=e,C.fillText(a,u,f),C.fillRect(g,m,A,v),C.fillStyle=t,C.globalAlpha=.9,C.fillRect(g,m,A,v),{dom:b,update:function(S,I){n=Math.min(n,S),i=Math.max(i,S),C.fillStyle=t,C.globalAlpha=1,C.fillRect(0,0,l,m),C.fillStyle=e,C.fillText(r(S)+" "+a+" ("+r(n)+"-"+r(i)+")",u,f),C.drawImage(b,g+o,m,A-o,v,g,m,A-o,v),C.fillRect(g+A-o,m,o,v),C.fillStyle=t,C.globalAlpha=.9,C.fillRect(g+A-o,m,o,r((1-S/I)*v))}}};const BL=!!Ct("debuglightmaps");class lse{constructor(e){x(this,"_context");x(this,"_lightmaps",new Map);this._context=e}registerTexture(e,t,n,i){var l;BL&&console.log("Registering lightmap",e,jl[t],n),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const r=this._lightmaps.get(e),o=(l=r==null?void 0:r.get(t))!=null?l:[];o.length<i&&(o.length=i+1),o[i]=n,r==null||r.set(t,o)}tryGetLightmap(e,t=0){return this.tryGet(e,jl.Lightmap,t)}tryGetSkybox(e){return this.tryGet(e,jl.Skybox,0)}tryGetReflection(e){return this.tryGet(e,jl.Reflection,0)}tryGet(e,t,n){var r,o;if(!e)return BL&&console.warn("Missing source id"),null;const i=(o=(r=this._lightmaps.get(e))==null?void 0:r.get(t))!=null?o:null;return!(i!=null&&i.length)||i.length<=n?null:i[n]}}qn.lights_fragment_maps=qn.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vUv2 );",`

    vec2 lUv = vUv2.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);qn.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;qn.lights_fragment_begin=qn.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);Vt.lightmap.lightmapScaleOffset={value:new Bn(1,1,0,0)};const hse=Ct("debugSetup"),use=Ct("stats"),m_={};class dse{constructor(e){x(this,"name");x(this,"alias");x(this,"domElement");x(this,"renderer");this.domElement=e!=null?e:document.body}}var qr=(a=>(a[a.EarlyUpdate=0]="EarlyUpdate",a[a.Update=1]="Update",a[a.LateUpdate=2]="LateUpdate",a[a.OnBeforeRender=3]="OnBeforeRender",a[a.OnAfterRender=4]="OnAfterRender",a[a.PhysicsStep=10]="PhysicsStep",a))(qr||{}),Tg=(a=>(a.ImmersiveVR="immersive-vr",a.ImmersiveAR="immersive-ar",a))(Tg||{});const ao=class{constructor(e){x(this,"name");x(this,"alias");x(this,"isManagedExternally",!1);x(this,"domElement");x(this,"_resolutionScaleFactor",1);x(this,"xrSessionMode");x(this,"scene");x(this,"renderer");x(this,"composer",null);x(this,"scripts",[]);x(this,"scripts_earlyUpdate",[]);x(this,"scripts_update",[]);x(this,"scripts_lateUpdate",[]);x(this,"scripts_onBeforeRender",[]);x(this,"scripts_onAfterRender",[]);x(this,"scripts_WithCorroutines",[]);x(this,"coroutines",{});x(this,"mainCameraComponent");x(this,"post_setup_callbacks",[]);x(this,"pre_update_callbacks",[]);x(this,"pre_render_callbacks",[]);x(this,"post_render_callbacks",[]);x(this,"new_scripts",[]);x(this,"new_script_start",[]);x(this,"new_scripts_pre_setup_callbacks",[]);x(this,"new_scripts_post_setup_callbacks",[]);x(this,"application");x(this,"time");x(this,"input");x(this,"physics");x(this,"connection");x(this,"assets");x(this,"mainLight",null);x(this,"rendererData");x(this,"addressables");x(this,"lightmaps");x(this,"players");x(this,"_sizeChanged",!1);x(this,"_isCreated",!1);x(this,"_stats",use?eg():null);x(this,"_cameraStack",[]);x(this,"_onBeforeRenderListeners",{});x(this,"_requireDepthTexture",!1);x(this,"_requireColorTexture",!1);x(this,"_renderTarget");x(this,"_isRendering",!1);if(this.name=(e==null?void 0:e.name)||"",this.alias=e==null?void 0:e.alias,this.domElement=(e==null?void 0:e.domElement)||document.body,e!=null&&e.renderer)this.renderer=e.renderer,this.isManagedExternally=!0;else{const n=Ct("postfx");this.renderer=new Dg({antialias:!0}),this.renderer.toneMappingExposure=1,this.renderer.toneMapping=ma,this.renderer.setClearColor(new ye("lightgrey"),0),this.renderer.antialias=!0,this.renderer.alpha=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=KE,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputEncoding=Gn,this.renderer.physicallyCorrectLights=!0,this.composer=n?new uK(this.renderer):null}this.scene=new Bu,this.application=new tZ(this),this.time=new GJ,this.input=new j9(this),this.physics=new zJ(this),this.connection=new eK(this),this.assets=new cse,this.rendererData=new Vie(this),this.addressables=new l$(this),this.lightmaps=new lse(this),this.players=new r$(this),window.addEventListener("resize",()=>this._sizeChanged=!0),new ResizeObserver(n=>this._sizeChanged=!0).observe(this.domElement)}static get Current(){return this._current}static set Current(e){this._current=e}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(e){if(e!==this._resolutionScaleFactor&&typeof e=="number"){if(e<=0){console.error("Invalid resolution scale factor",e);return}this._resolutionScaleFactor=e,this.updateSize()}}get domWidth(){return this.domElement.clientWidth}get domHeight(){return this.domElement.clientHeight}get domX(){return this.domElement.offsetLeft}get domY(){return this.domElement.offsetTop}get isInXR(){var e;return((e=this.renderer.xr)==null?void 0:e.isPresenting)||!1}get xrSession(){var e;return(e=this.renderer.xr)==null?void 0:e.getSession()}get arOverlayElement(){const e=this.domElement;return typeof e.getAROverlayContainer=="function"?e.getAROverlayContainer():this.domElement}get mainCamera(){if(this.mainCameraComponent){const e=this.mainCameraComponent;return e.cam||e.buildCamera(),e.cam}return null}updateSize(){if(!this.isManagedExternally&&!this.renderer.xr.isPresenting){this._sizeChanged=!1;const e=this.resolutionScaleFactor,t=this.domWidth*e,n=this.domHeight*e,i=this.mainCamera;this.updateAspect(i),this.renderer.setSize(t,n),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&(this.composer.setSize(t,n),this.composer.setPixelRatio(window.devicePixelRatio))}}updateAspect(e){if(!e)return;const t=this.domWidth,n=this.domHeight,i=e.aspect;e.aspect=t/n,i!==e.aspect&&e.updateProjectionMatrix()}onCreate(e,t){return this._isCreated?(console.warn("Context already created"),null):(this._isCreated=!0,this.internalOnCreate(e,t))}onDestroy(){var e,t;!this._isCreated||(this._isCreated=!1,Ee.destroy(this.scene,!0),(e=this.renderer)==null||e.setAnimationLoop(null),this.isManagedExternally||(t=this.renderer)==null||t.dispose())}registerCoroutineUpdate(e,t,n){return this.coroutines[n]||(this.coroutines[n]=[]),this.coroutines[n].push({comp:e,main:t}),t}unregisterCoroutineUpdate(e,t){if(!this.coroutines[t])return;const n=this.coroutines[t].findIndex(i=>i.main===e);n>=0&&this.coroutines[t].splice(n,1)}stopAllCoroutinesFrom(e){for(const t in this.coroutines){const n=this.coroutines[t];for(let i=n.length-1;i>=0;i--)n[i].comp===e&&n.splice(i,1)}}setCurrentCamera(e){var i;if(!e)return;if(e.cam||e.buildCamera(),!e.cam){console.warn("Camera component is missing camera",e);return}const t=this._cameraStack.indexOf(e);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(e),this.mainCameraComponent=e;const n=e.cam;n.isPerspectiveCamera&&this.updateAspect(n),(i=this.mainCameraComponent)==null||i.applyClearFlagsIfIsActiveCamera()}removeCamera(e){if(!e)return;const t=this._cameraStack.indexOf(e);if(t>=0&&this._cameraStack.splice(t,1),this.mainCameraComponent===e&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const n=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(n)}}addBeforeRenderListener(e,t){if(!this._onBeforeRenderListeners[e.uuid]){this._onBeforeRenderListeners[e.uuid]=[];const n=(i,r,o,l,h,u)=>{const f=this._onBeforeRenderListeners[e.uuid];if(!!f)for(let g=0;g<f.length;g++){const m=f[g];m(i,r,o,l,h,u)}};e.onBeforeRender=n}this._onBeforeRenderListeners[e.uuid].push(t)}removeBeforeRenderListener(e,t){if(this._onBeforeRenderListeners[e.uuid]){const n=this._onBeforeRenderListeners[e.uuid],i=n.indexOf(t);i>=0&&n.splice(i,1)}}get isRendering(){return this._isRendering}setRequireDepth(e){this._requireDepthTexture=e}setRequireColor(e){this._requireColorTexture=e}get depthTexture(){var e;return((e=this._renderTarget)==null?void 0:e.depthTexture)||null}get opaqueColorTexture(){var e;return((e=this._renderTarget)==null?void 0:e.texture)||null}async internalOnCreate(e,t){var r;let n=!0;try{ao.Current=this,e&&await e(this,t)}catch(o){console.error(o),n=!1}if(!n)return;this.isManagedExternally||this.domElement.prepend(this.renderer.domElement),R9(this),T9(this),sse(this),ao._current=this;for(let o=0;o<this.new_scripts.length;o++){const l=this.new_scripts[o];if(l.gameObject!==void 0&&l.gameObject!==null){l.gameObject.userData===void 0&&(l.gameObject.userData={}),l.gameObject.userData.components===void 0&&(l.gameObject.userData.components=[]);const h=l.gameObject.userData.components;h.includes(l)||h.push(l)}}if(this.post_setup_callbacks)for(let o=0;o<this.post_setup_callbacks.length;o++)ao._current=this,await this.post_setup_callbacks[o](this);if(!this.mainCamera){ao._current=this;const o=Ee.findObjectsOfType(qs,this),l=(r=o.find(h=>h.tag=="MainCamera"))!=null?r:o.find(h=>!0);if(l)l.tag!=="MainCamera"&&console.warn('No mainCamera configured. Some components rely on a mainCamera object being present. When exporting your scene, make sure to set the mainCamera tag on your camera. Using "'+l.name+'" as mainCamera now.'),this.setCurrentCamera(l);else{console.error("No camera found");const h=aK(this.scene);this.setCurrentCamera(h)}}ao._current=this,pg(this);const i=this.mainCameraComponent;if(i&&i.applyClearFlagsIfIsActiveCamera(),!this.isManagedExternally&&this.composer&&this.mainCamera){const o=new dK(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(o),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(1),this.domElement.appendChild(this._stats.dom)),this.renderer.setAnimationLoop(this.render.bind(this)),hse&&hE(this.scene,!0)}render(e,t){var n,i;for((n=this._stats)==null||n.begin(),ao._current=this,this.time.update(),pg(this),YX(),RD(this);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];!o.activeAndEnabled||o.earlyUpdate!==void 0&&(ao._current=this,o.earlyUpdate())}this.executeCoroutines(0);for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];!o.activeAndEnabled||o.update!==void 0&&(ao._current=this,o.update())}this.executeCoroutines(1);for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];!o.activeAndEnabled||o.lateUpdate!==void 0&&(ao._current=this,o.lateUpdate())}this.mainLight=null,this.executeCoroutines(2);try{const o=this.time.deltaTime/2;for(let l=0;l<2;l++)this.physics.step(o),this.executeCoroutines(10)}catch(r){console.error(r)}this.physics.postStep();for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];!o.activeAndEnabled||o.onBeforeRender!==void 0&&(ao._current=this,o.onBeforeRender(t))}if(this.executeCoroutines(3),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r]();this._isRendering=!0,this.renderRequiredTextures(),this.isManagedExternally||(this.composer?this.composer.render():this.mainCamera&&this.renderer.render(this.scene,this.mainCamera)),this._isRendering=!1;for(let r=0;r<this.scripts_onAfterRender.length;r++){const o=this.scripts_onAfterRender[r];!o.activeAndEnabled||o.onAfterRender!==void 0&&(ao._current=this,o.onAfterRender())}if(this.executeCoroutines(4),this.post_render_callbacks)for(const r in this.post_render_callbacks)this.post_render_callbacks[r]();this.connection.sendBufferedMessagesNow(),(i=this._stats)==null||i.end()}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Xr(this.domWidth,this.domHeight),this._requireDepthTexture){const n=new AS(this.domWidth,this.domHeight);this._renderTarget.depthTexture=n}this._requireColorTexture&&(this._renderTarget.texture=new Ii,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=$i,this._renderTarget.texture.magFilter=$i,this._renderTarget.texture.format=ds)}const e=this._renderTarget;e.texture&&(e.texture.encoding=this.renderer.outputEncoding);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(e),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(e){if(this.coroutines[e]){const n=this.coroutines[e];for(let i=0;i<n.length;i++){const r=n[i];if(!r.comp||r.comp.destroyed||!r.main||r.comp.enabled===!1){n.splice(i,1),--i;continue}const l=r.chained;if(l&&l.length>0){const g=l[l.length-1].next();if(g.done&&l.pop(),t(g)&&(r.chained||(r.chained=[]),r.chained.push(g.value)),!g.done)continue}const h=r.main.next();if(h.done===!0){n.splice(i,1),--i;continue}const u=h.value;if(t(u)){if(u.next().done)continue;r.chained||(r.chained=[]),r.chained.push(u)}}}function t(n){return!!(n&&n.next&&n.return)}}};let ui=ao;x(ui,"_current");const fse=Object.freeze(Object.defineProperty({__proto__:null,build_scene_functions:m_,ContextArgs:dse,FrameEvent:qr,XRSessionMode:Tg,Context:ui},Symbol.toStringTag,{value:"Module"})),Su="ar",pse="quit-ar";class mse{constructor(){x(this,"arContainer",null);x(this,"closeARCallback");x(this,"currentSession",null);x(this,"registeredCloseEventElements",[]);x(this,"_createdAROnlyElements",[]);x(this,"_reparentedObjects",[]);this.closeARCallback=this.onRequestedEndAR.bind(this)}get ARContainer(){return this.arContainer}requestEndAR(){this.onRequestedEndAR()}onBegin(e,t,n){this.currentSession=n,this.arContainer=t,e.domElement.querySelectorAll(`.${Su}`).forEach(o=>{var l;!o||o!==this.arContainer&&(this._reparentedObjects.push({el:o,previousParent:o.parentElement}),(l=this.arContainer)==null||l.appendChild(o))});const r=t.getElementsByClassName(pse);if(!r||r.length<=0)console.warn("Missing quit AR elements"),this.createFallbackCloseARButton(this.arContainer);else for(let o=0;o<r.length;o++){const l=r[o];!l||(l.addEventListener("click",this.closeARCallback),this.registeredCloseEventElements.push(l))}}onEnd(e){var t;for(const n of this._createdAROnlyElements)n.remove&&n.remove();for(const n of this._reparentedObjects){const i=n.el;(t=n.previousParent)==null||t.appendChild(i)}this._reparentedObjects.length=0}findOrCreateARContainer(e){if(e.classList.contains(Su))return e;if(e.children){for(const n of e.children)if(!(!n||!n.classList)&&n.classList.contains(Su))return n}const t=document.createElement("div");return t.classList.add(Su),e.appendChild(t)}onRequestedEndAR(){if(!!this.currentSession){this.currentSession.end(),this.currentSession=null;for(const e of this.registeredCloseEventElements)e.removeEventListener("click",this.closeARCallback);this.registeredCloseEventElements.length=0}}createFallbackCloseARButton(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","38px"),t.setAttribute("height","38px"),t.style.position="absolute",t.style.right="20px",t.style.top="40px",t.style.zIndex="9999",t.style.pointerEvents="auto",t.addEventListener("click",this.closeARCallback),e.appendChild(t),this._createdAROnlyElements.push(t);var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),n.setAttribute("stroke","#eee"),n.setAttribute("stroke-width","2px"),t.appendChild(n),this._createdAROnlyElements.push(n)}}const gse=Ct("debugdebug"),Ase=Ct("noerrors"),SC=new Map;function yse(){if(!Ase&&PO()){gse&&console.log(window.location.hostname);const a=console.error;console.error=(...e)=>{a.apply(console,e),LL(2,e)},window.addEventListener("error",e=>{!e||LL(2,e.error,e.filename,e.lineno)})}}function LL(a,e,t,n){var r;const i=ui.Current;if(a===2){const o=(r=i==null?void 0:i.domElement)!=null?r:document.querySelector("needle-engine");if(!o)return;Array.isArray(e)&&(e=e.join(" ")),vse(o,e)}}function _se(a){if(SC.has(a))return SC.get(a);{const e=document.createElement("div");return e.classList.add(Su),e.classList.add("desktop"),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.margin="5px",e.style.width="calc(100% - 10px)",e.style.zIndex="1000",e.style.pointerEvents="none",e.style.display="flex",e.style.alignItems="end",e.style.flexDirection="column",e.style.color="white",e.style.overflow="auto",a.appendChild(e),SC.set(a,e),e}}function vse(a,e,t){const n=_se(a);if(n.childElementCount>=5)return;const i=document.createElement("div");n.appendChild(i),i.style.display="flex",i.style.alignItems="start",i.style.flexDirection="row",i.style.padding=".2em",i.style.backgroundColor="rgba(0,0,0,1)",i.style.marginBottom="2px",i.style.borderRadius="8px",i.style.color="#ff5555",i.style.fontWeight="bold",i.title="Open developer console to debug",i.style.pointerEvents="all",i.style.userSelect="text";const r=document.createElement("div"),o=document.createElement("div");i.appendChild(r),i.appendChild(o),e.length>200&&(e=e.substring(0,200)+"..."),r.innerText=e,o.innerText=t||"",setTimeout(()=>{n.removeChild(i)},1e4)}yse();const XE={...fse,...ese,RGBAColor:fo},xse=Ct("debugloadingbar");function Pk(a){return a.index/a.count+a.progress.loaded/a.progress.total/a.count}class wse{constructor(e,t){x(this,"loadingProgress",0);x(this,"container");x(this,"_progress",0);x(this,"_allowCustomLoadingElement",!1);x(this,"_loadingElement");x(this,"_loadingTextContainer",null);x(this,"_loadingBar",null);x(this,"_messageContainer",null);x(this,"_loadingElementOptions");x(this,"_progressLoop");this.container=e,this._loadingElementOptions=t}onLoadingBegin(e){if(!this._loadingElement){for(let t=0;t<this.container.children.length;t++){const n=this.container.children[t];if(n.classList.contains("loading")){if(!this._allowCustomLoadingElement){this.container.removeChild(n);continue}this._loadingElement=this.createLoadingElement();return}}this._loadingElement=this.createLoadingElement()}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="",this.container.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(e!=null?e:"")}onLoadingUpdate(e,t){var i;(i=this._loadingElement)!=null&&i.parentElement||this.onLoadingBegin(t);let n=0;typeof e=="number"?n=e:("index"in e&&(n=Pk(e)),!t&&"name"in e&&this.setMessage(e.name)),this.loadingProgress=n,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(e){this.loadingProgress=1,this.setMessage(e!=null?e:"")}setMessage(e){this._messageContainer&&(this._messageContainer.innerText=e)}smoothProgressLoop(){if(this._progressLoop)return;let e=1/12;xse&&(e=.001);const t=1-.05;this._progressLoop=setInterval(()=>{if(this.loadingProgress>=1&&this._progress>=t){this._loadingElement&&(this._loadingElement.style.display="none",this._loadingElement.remove()),clearInterval(this._progressLoop),this._progressLoop=null;return}this._progress=Ci.lerp(this._progress,this.loadingProgress,e*this.loadingProgress),this.updateDisplay()},e)}updateDisplay(){const e=this._progress,t=(e*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=e*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(e){var l,h,u;this._loadingElement=e||document.createElement("div");const t=(h=(l=this._loadingElementOptions)==null?void 0:l.className)!=null?h:"loading";if(this._loadingElement.classList.add(t),(u=this._loadingElementOptions)!=null&&u.additionalClasses)for(const f of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(f);e||(this._loadingElement.style.color="white",this._loadingElement.style.display="flex");const n=document.createElement("div"),i=20;n.style.display="flex",n.style.width=i+"%",n.style.height="2px",n.style.background="rgba(255,255,255,.1)",this._loadingElement.appendChild(n),this._loadingBar=document.createElement("div"),n.appendChild(this._loadingBar);const r=function(f){return Ci.lerp(i*.5,100-i*.5,f)+"%"};this._loadingBar.style.background=`linear-gradient(90deg, #02022B ${r(0)}, #0BA398 ${r(.4)}, #99CC33 ${r(.5)}, #D7DB0A ${r(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".9em",this._loadingElement.appendChild(this._loadingTextContainer);const o=document.createElement("div");return this._messageContainer=o,o.style.display="flex",o.style.fontSize=".8em",o.style.paddingTop=".5em",o.style.color="rgba(255,255,255,.5)",this._loadingElement.appendChild(o),this._loadingElement}}const ou=Ct("debugwebcomponent");class bse{constructor(e,t){x(this,"id");x(this,"context");x(this,"previouslyAdded");x(this,"previousSource");x(this,"networkEvent");this.id=e,this.context=t,this.networkEvent="needle-engine-source-changed",this.id&&(this.networkEvent+="-"+this.id),this.context.connection.beginListen(this.networkEvent,n=>{this.onSourceChanged(n,!0)})}async onSourceChanged(e,t=!1,n=!1){this.previouslyAdded&&(t&&e===this.previousSource||Ee.destroySynced(this.previouslyAdded)),this.previouslyAdded=null,t||this.context.connection.send(this.networkEvent,e),this.previousSource=e,ui.Current=this.context;const i=await vA(this.context,e,this.getHashFromString(e));n||pg(this.context);const r=i==null?void 0:i.scene;r&&(this.previouslyAdded=r,this.context.scene.add(r))}getHashFromString(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}}const Cse="needle-engine",Ese="vr",Sse="desktop",Mse=[Su,Ese,Sse];class Tse extends HTMLElement{constructor(){super();x(this,"gameObject",Ee);x(this,"GameObject",Ee);x(this,"_context",null);x(this,"_overlay_ar");x(this,"_loadingProgress01",0);x(this,"_watcher");x(this,"_loadingView");this._overlay_ar=new mse}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}getContext(){return new Promise((t,n)=>{if(this._context&&this.loadingFinished)t(this._context);else{const i=()=>{this.removeEventListener("loadfinished",i),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",i)}})}get Context(){return this._context}async connectedCallback(){var l,h,u,f,g;this.onSetupDesktop();var t=new MutationObserver(this.onElementsChanged.bind(this));t.observe(this,{childList:!0});const n=()=>{const m=this.getAttribute("src");return(m==null?void 0:m.endsWith(".glb"))||(m==null?void 0:m.endsWith(".gltf"))?m:null};let i="loadScene";const r=n();r&&(i=r);const o=this.getAttribute("alias");if(this._context=new ui({name:i,domElement:this,alias:o}),this._watcher=new bse((h=(l=this.getAttribute("id"))!=null?l:o)!=null?h:"",this._context),i&&i.length>0){if(!r)for(;Object.keys(m_).length<=0;){if(!this.isConnected)return;await WX(10)}let m=(u=m_[i])!=null?u:window[i],A=null;if((!m||r)&&(r&&(i=r),m=async v=>{const b=n();b&&this._watcher&&(A=b,await this._watcher.onSourceChanged(b,!0,!0))}),m){this.classList.add("loading"),console.log("Needle Engine: Begin loading",o!=null?o:"");const v=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:o},cancelable:!0}));!this._loadingView&&v&&(this._loadingView=new wse(this)),v&&((f=this._loadingView)==null||f.onLoadingBegin("begin load"));const b=(S,I)=>{var M;this._loadingProgress01=Pk(S),v&&((M=this._loadingView)==null||M.onLoadingUpdate(S,I)),this.dispatchEvent(new CustomEvent("progress",{detail:{context:this._context,name:S.name,progress:S.progress,index:S.index,count:S.count,totalProgress01:this._loadingProgress01}}))};this.onBeforeBeginLoading(),await this._context.onCreate(m,{progress:b});const C=n();C&&C!==A&&await this._watcher.onSourceChanged(C,!0,!0),this._loadingProgress01=1,v&&((g=this._loadingView)==null||g.onLoadingFinished("create scene")),this.classList.remove("loading"),this.classList.add("loading-finished"),console.log("Needle Engine: finished loading",o!=null?o:""),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:o!=null?o:i}})),this.onSetupDesktop()}else console.error('Could not find scene function named "'+i+'", it must be either in global scope or added to build_scene_functions',m_)}else console.error("Missing src attribute - please provide a function name",this)}disconnectedCallback(){this._context&&this._context.onDestroy()}static get observedAttributes(){return["src","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath"]}attributeChangedCallback(t,n,i){var r;switch(t){case"src":(r=this._watcher)==null||r.onSourceChanged(i);break;case"loadstart":case"progress":case"loadfinished":typeof i=="string"&&i.length>0&&(ou&&console.log(t+" attribute changed",i),this.registerEventFromAttribute(t,i));break;case"dracoDecoderPath":ou&&console.log("dracoDecoderPath",i),BB(i);break;case"dracoDecoderType":i==="wasm"||i==="js"?(ou&&console.log("dracoDecoderType",i),LB(i)):console.error("Invalid dracoDecoderType",i,"expected js or wasm");break;case"ktx2DecoderPath":ou&&console.log("ktx2DecoderPath",i),DB(i);break}}registerEventFromAttribute(t,n){if(typeof n=="string"&&n.length>0){const i=(0,eval)(n);typeof i=="function"&&this.addEventListener(t,r=>i==null?void 0:i.call(globalThis,this._context,r))}}getAROverlayContainer(){return this._overlay_ar.findOrCreateARContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const n=this.children[t];if(n.classList.contains("vr"))return n}return null}onEnterAR(t,n){var i;this.onSetupAR(),this._overlay_ar.onBegin(this._context,n,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onExitAR(t){var n;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(n=this._overlay_ar)==null?void 0:n.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onElementsChanged(){}onSetupAR(){this.classList.add("ar-session-active"),this.classList.remove("desktop-session-active"),this.foreachHtmlElement(t=>this.setupElementsForMode(t,Su))}onSetupVR(){this.classList.remove("ar-session-active"),this.classList.remove("desktop-session-active"),this.foreachHtmlElement(t=>this.setupElementsForMode(t,"vr"))}onSetupDesktop(){this.classList.remove("ar-session-active"),this.classList.add("desktop-session-active"),this.foreachHtmlElement(t=>this.setupElementsForMode(t,"desktop"))}setupElementsForMode(t,n,i=null){var o;if(t===((o=this._context)==null?void 0:o.renderer.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.style.position="absolute",t.classList.contains(n))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const l of Mse)t.classList.contains(l)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let n=0;n<this.children.length;n++){const i=this.children[n];i.style&&t(i)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(ou&&console.log("using custom draco decoder path",t),BB(t));const n=this.getAttribute("dracoDecoderType");n&&(ou&&console.log("using custom draco decoder type",n),LB(n));const i=this.getAttribute("ktx2DecoderPath");i&&(ou&&console.log("using custom ktx2 decoder path",i),DB(i))}}window.customElements.define(Cse,Tse);const C1={Context:ui};globalThis.Needle=C1;function Bk(a){for(const e in a)C1[e]=a[e]}Bk(D9);Bk(bie);for(const a of Object.getOwnPropertyNames(Ee))switch(a){case"prototype":case"constructor":case"length":case"name":continue;default:C1[a]=Ee[a];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=UX;var Ise=Object.defineProperty,Rse=Object.getOwnPropertyDescriptor,xA=(a,e,t,n)=>{for(var i=n>1?void 0:n?Rse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Ise(e,t,i),i},g_=(a=>(a[a.Realtime=0]="Realtime",a[a.FixedTime=1]="FixedTime",a[a.FastForward=2]="FastForward",a))(g_||{}),PC;const pf=(PC=class extends pt{constructor(){super(...arguments);x(this,"hourHand",null);x(this,"minuteHand",null);x(this,"secondHand",null);x(this,"secondHandGraphics",null);x(this,"secondHandBlurred",null);x(this,"speed",1);x(this,"lastUpdate",-1e3);x(this,"baseUtc");x(this,"now_utc",0)}static saveClockMode(){window.localStorage.setItem("clockMode",this.clockMode.toString())}fullDate(e){return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())}awake(){const e=window.localStorage.getItem("clockMode");e&&(pf.clockMode=parseInt(e));const t=new Date;this.baseUtc=this.fullDate(t)}onEnable(){this.setTimeBasedOnClockMode(0),this.baseUtc=this.now_utc}setTimeBasedOnClockMode(e){const t=new Date;pf.clockMode===1?(t.setHours(10,10,36,0),this.now_utc=this.fullDate(t)):pf.clockMode===2?this.now_utc+=e*1e3*1e3:this.now_utc=this.fullDate(t)}update(){if(this.context.time.time-this.lastUpdate<.01)return;this.lastUpdate=this.context.time.time;let e=this.context.time.deltaTime;this.setTimeBasedOnClockMode(e),this.secondHandGraphics&&Ee.setActive(this.secondHandGraphics,pf.clockMode!==2),this.secondHandBlurred&&Ee.setActive(this.secondHandBlurred,pf.clockMode===2),this.baseUtc=Ci.lerp(this.baseUtc,this.now_utc,e*10);let t=new Date(this.baseUtc);const n=t.getSeconds();if(this.secondHand&&(this.secondHand.rotation.z=n/60*Math.PI*2),this.minuteHand){let i=t.getMinutes()+t.getSeconds()/60;this.minuteHand.rotation.z=i/60*Math.PI*2}if(this.hourHand){const i=t.getHours()+t.getMinutes()/60;this.hourHand.rotation.z=i/12*Math.PI*2}}},x(PC,"clockMode"),PC);let Fo=pf;xA([we(Ft)],Fo.prototype,"hourHand",2);xA([we(Ft)],Fo.prototype,"minuteHand",2);xA([we(Ft)],Fo.prototype,"secondHand",2);xA([we(Ft)],Fo.prototype,"secondHandGraphics",2);xA([we(Ft)],Fo.prototype,"secondHandBlurred",2);const Ef=class extends pt{constructor(){super(...arguments);x(this,"id");x(this,"fieldOfView",60);x(this,"targetDistance",.5)}static tryGetView(t){return this.views.find(n=>n.id===t)||null}onEnable(){var t;Ef.views.push(this),(t=Ef.viewRegisteredCallback)==null||t.call(this,this)}onDisable(){const t=Ef.views.indexOf(this);t>=0&&Ef.views.splice(t,1)}};let Mu=Ef;x(Mu,"views",[]),x(Mu,"viewRegisteredCallback");const Gy=Ct("debugforma");class Pse extends pt{constructor(){super(...arguments);x(this,"orbit",null);x(this,"lastSelectedViewPointId");x(this,"moveCameraTo",(t,n=!1)=>{this.orbit.setCameraTarget(t,n)})}start(){var t;console.log("api mono behavior started"),this.context.moveCameraTo=this.moveCameraTo,this.orbit=Ee.findObjectOfType(dh),this.startCoroutine(this.saveCameraView(),qr.OnAfterRender),this.lastSelectedViewPointId="front",(t=this.setViewPoint)==null||t.call(this,this.lastSelectedViewPointId,!0),this.context.domElement.addEventListener("product-selected",async()=>{var n;(n=this.setViewPoint)==null||n.call(this,this.lastSelectedViewPointId,!0)}),this.context.time.time,Mu.viewRegisteredCallback=n=>{var i;n.id===this.lastSelectedViewPointId&&((i=this.setViewPoint)==null||i.call(this,n.id,!0))}}*initProduct(){this.saveCameraView(),this.context.addProduct("https://storage.googleapis.com/formacloud-storage-cdn-stg/Tank_Must_L%20Product.glb")}*saveCameraView(){var t;for(;;)if(yield,this.context.time.frameCount%90===0&&this.orbit){const n=this.orbit.controllerObject;(t=this.orbit.controls)==null||t.target}}setRealtime(){Gy&&console.log("REALTIME"),Fo.clockMode=g_.Realtime,Fo.saveClockMode()}setFixedTime(){Gy&&console.log("FIXED TIME"),Fo.clockMode=g_.FixedTime,Fo.saveClockMode()}setFastForward(){Gy&&console.log("FAST FORWARD"),Fo.clockMode=g_.FastForward,Fo.saveClockMode()}setViewPoint(t,n=!1){this.lastSelectedViewPointId=t;const i=Mu.tryGetView(t);if(i&&this.orbit){Gy&&console.log("SET CAMERA VIEW",t,i.fieldOfView);const r=ni(i.gameObject);this.orbit.useSlerp=!0,this.orbit.setCameraTarget(r,n);const o=r.clone().addScaledVector(i.forward,-i.targetDistance);this.orbit.setTarget(o,n),n&&this.orbit.controllerObject,this.context.mainCameraComponent&&(this.context.mainCameraComponent.fieldOfView=i.fieldOfView)}}}const _u=class extends pt{constructor(){super(...arguments);x(this,"renderer");x(this,"listener");x(this,"lastHistoryUpdate",new Date);x(this,"data",{engraving:`UNITY
\u2716
CARTIER`})}parseHashAndSetText(){const t=Ct("engraving");typeof t=="string"&&(this.data.engraving=t,this.regenText(),_u.input&&(_u.input.value=t))}start(){this.preLoadFont();const t=document.getElementById("engraving");if(t){if(!_u.input){const i=document.createElement("textarea");i.classList.add("dropdown-list"),i.rows=3,i.cols=11,t.appendChild(i),_u.input=i}const n=_u.input;n.value=this.data.engraving,n.addEventListener("input",i=>{if(i.target){const r=this.convertToEngravingText(n.value);n.value=r,this.data.engraving=r,this.regenTextAndSetHistory()}}),window.addEventListener("message",i=>{if(window===i.source)return;const{method:r,args:o}=i.data;if(r==="engrave"){const l=this.convertToEngravingText(o[0]);n.value=l,this.data.engraving=l,this.regenTextAndSetHistory()}})}this.parseHashAndSetText(),this.listener=this.refreshHash.bind(this)}refreshHash(t){t.preventDefault(),this.parseHashAndSetText()}onEnable(){window.addEventListener("hashchange",this.listener),this.renderer=Ee.getComponent(this.gameObject,Xs),this.regenText()}onDisable(){window.removeEventListener("hashchange",this.listener)}regenTextAndSetHistory(){this.regenText()}regenText(){if(!this.renderer)return;const t=this.renderer.material;t&&(t.map=this.getTextureForText(null,this.data.engraving),t.needsUpdate=!0)}preLoadFont(){const t=this,n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href="https://fonts.googleapis.com/css2?family=Battambang&display=swap",document.getElementsByTagName("head")[0].appendChild(n),n.onload=function(){t.cssHasLoaded=!0};const i=document.createElement("p");i.textContent="font sampler",i.style.font="110pt 'Battambang', sans-serif",i.style.position="fixed",i.style.top="-1000px",document.getElementsByTagName("body")[0].appendChild(i)}getTextureForText(t,n){let i=n.toUpperCase().split(/\r?\n/);const r=document.createElement("canvas");r.width=1024,r.height=512;const o=r.getContext("2d");t&&o.drawImage(t,0,0,1024,512),o.font="80pt 'Battambang', sans-serif",o.textAlign="center",o.textBaseline="middle";var l=0;for(let f=0;f<i.length;f++)i[f]&&l++;const h=(3-l)*135/2;for(let f=0;f<i.length;f++){const m=135*f+135+h;o.fillStyle="#555",o.fillText(i[f],512,m)}const u=new Ii(r);return u.needsUpdate=!0,u.flipY=!1,u.wrapS=Os,u.wrapT=Os,u}convertToEngravingText(t){const n=t.split(`
`);for(let i=0;i<n.length;i++)n[i]=n[i].substring(0,11);return n.join(`
`)}};let A_=_u;x(A_,"input",null);Be.add("CartierViewer",Pse);Be.add("Clock",Fo);Be.add("Engraving",A_);var Bse=Object.defineProperty,Lse=Object.getOwnPropertyDescriptor,Zu=(a,e,t,n)=>{for(var i=n>1?void 0:n?Lse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Bse(e,t,i),i};class $u extends pt{constructor(){super(...arguments);x(this,"id")}}Zu([we()],$u.prototype,"id",2);class Dse extends pt{}class Lk extends $u{constructor(){super(...arguments);x(this,"result")}getResult(){return this.result}}Zu([we(vs)],Lk.prototype,"result",2);class Dk extends $u{constructor(){super(...arguments);x(this,"result")}getResult(){return this.result}}Zu([we()],Dk.prototype,"result",2);class Mx{constructor(){x(this,"renderer");x(this,"index")}}Zu([we(Xs)],Mx.prototype,"renderer",2);Zu([we()],Mx.prototype,"index",2);class Ok extends $u{constructor(){super(...arguments);x(this,"result")}getResult(){return this.result}}Zu([we(Mx)],Ok.prototype,"result",2);class Fk extends $u{constructor(){super(...arguments);x(this,"result")}getResult(){return this.result}}Zu([we(Ft)],Fk.prototype,"result",2);var Ose=Object.defineProperty,Fse=Object.getOwnPropertyDescriptor,Tx=(a,e,t,n)=>{for(var i=n>1?void 0:n?Fse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Ose(e,t,i),i};class Ix{constructor(){x(this,"id");x(this,"query");x(this,"_fetched",0);x(this,"_maxFetches",20)}fetch(e){if(this.query||this._fetched>=this._maxFetches)return;this._fetched+=1;const t=this._fetched>=this._maxFetches,n=this.find(e);n?this.query=n:t&&console.warn("Failed resolving",this)}find(e){const t=Ee.findObjectsOfType($u,e);for(const n of t)if(n.id===this.id)return n}}Tx([we()],Ix.prototype,"id",2);Tx([we($u)],Ix.prototype,"query",2);class wA extends pt{constructor(){super(...arguments);x(this,"targetDeferredQuery");x(this,"valueDeferredQuery")}get targetQuery(){var t;return(t=this.targetDeferredQuery)==null?void 0:t.query}get valueQuery(){var t;return(t=this.valueDeferredQuery)==null?void 0:t.query}invert(t){}resolveTarget(){var t;return(t=this.targetQuery)==null?void 0:t.getResult()}resolveValue(){var t;return(t=this.valueQuery)==null?void 0:t.getResult()}}Tx([we(Ix)],wA.prototype,"targetDeferredQuery",2);Tx([we(Ix)],wA.prototype,"valueDeferredQuery",2);class kse extends wA{apply(e,t){var r,o;(r=this.valueDeferredQuery)==null||r.fetch(),(o=this.targetDeferredQuery)==null||o.fetch();const n=this.resolveTarget(),i=this.resolveValue();if(n&&i){for(const l of n)if(l){if(t&&t!=null&&t.isActiveInVariant(l))continue;const h=e?!i:i;Ee.setActive(l,h)}}}invert(e){this.apply(!0,e)}}class Nse extends wA{start(){}apply(){var n,i,r,o;(n=this.valueDeferredQuery)==null||n.fetch(),(i=this.targetDeferredQuery)==null||i.fetch();const e=this.resolveValue(),t=this.resolveTarget();if(Array.isArray(t))for(const l of t){if(!((r=l.renderer)!=null&&r.sharedMaterials)){console.error("Invalid slot",l);continue}l.renderer.sharedMaterials[l.index]=e}else console.warn("Could not resolve target for material assignment",(o=this.targetDeferredQuery)==null?void 0:o.id)}}var Use=Object.defineProperty,zse=Object.getOwnPropertyDescriptor,Rx=(a,e,t,n)=>{for(var i=n>1?void 0:n?zse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Use(e,t,i),i};class vp extends pt{constructor(){super(...arguments);x(this,"code")}}Rx([we()],vp.prototype,"code",2);class rc extends pt{constructor(){super(...arguments);x(this,"features");x(this,"defaultFeature");x(this,"selectedFeature")}selectFeature(t){this.deselectFeature(),this.selectedFeature=t}deselectFeature(){this.selectedFeature=void 0}}Rx([we(vp)],rc.prototype,"features",2);Rx([we(vp)],rc.prototype,"defaultFeature",2);Rx([we(vp)],rc.prototype,"selectedFeature",2);class kk extends rc{}var Gse=Object.defineProperty,Hse=Object.getOwnPropertyDescriptor,Nk=(a,e,t,n)=>{for(var i=n>1?void 0:n?Hse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Gse(e,t,i),i};class xp extends vp{constructor(){super(...arguments);x(this,"featureSet")}}Nk([we(rc)],xp.prototype,"featureSet",2);class iv extends xp{constructor(){super(...arguments);x(this,"features")}}Nk([we(xp)],iv.prototype,"features",2);var Vse=Object.defineProperty,Wse=Object.getOwnPropertyDescriptor,Px=(a,e,t,n)=>{for(var i=n>1?void 0:n?Wse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Vse(e,t,i),i};class Bx{constructor(){x(this,"keys");x(this,"values")}}Px([we(rc)],Bx.prototype,"keys",2);Px([we(xp)],Bx.prototype,"values",2);class E1 extends pt{constructor(){super(...arguments);x(this,"appliedFeatures");x(this,"featureSelections")}}Px([we(Bx)],E1.prototype,"appliedFeatures",2);Px([we(Bx)],E1.prototype,"featureSelections",2);var Qse=Object.defineProperty,jse=Object.getOwnPropertyDescriptor,S1=(a,e,t,n)=>{for(var i=n>1?void 0:n?jse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Qse(e,t,i),i};class bA extends pt{constructor(){super(...arguments);x(this,"featureSets",[])}start(){const t=Ee.findObjectOfType(Df);t&&(t.table=this)}}S1([we(rc)],bA.prototype,"featureSets",2);class M1 extends xp{constructor(){super(...arguments);x(this,"assignments")}isActiveInVariant(t){var n,i;if(!this.assignments)return!1;for(const r of this.assignments)if((i=(n=r.targetQuery)==null?void 0:n.getResult())!=null&&i.includes(t))return!0;return!1}}S1([we(wA)],M1.prototype,"assignments",2);class Uk extends rc{constructor(){super(...arguments);x(this,"variantTable")}}S1([we(bA)],Uk.prototype,"variantTable",2);const qse=Ct("debugforma"),O1=class extends pt{constructor(){super(...arguments);x(this,"table")}awake(){qse&&console.log(this),this.table=Ee.findObjectOfType(bA)}nextFeature(){var r,o,l;if(!((r=this.table)!=null&&r.featureSets))return;const t=O1.index++%this.table.featureSets.length,n=this.table.featureSets[t],i=n.features[Math.floor(Math.random()*n.features.length)];if(!i.name.startsWith("Pack"))return this.nextFeature();console.log(t,"SELECT",(l=(o=i==null?void 0:i.gameObject)==null?void 0:o.parent)==null?void 0:l.name,i==null?void 0:i.name,n),this.switchFeature(n,i)}switchFeature(t,n,i){const r=t instanceof kk,o=n instanceof iv;if(r||o){const l=n;if(t==null||t.selectFeature(n),l!=null&&l.features)for(const h of l.features){if(!h)continue;let u=h.featureSet;h instanceof iv&&(u=void 0),this.switchFeature(u,h,i)}}else if(n instanceof M1){const l=n,h=t;t==null||t.selectFeature(l);for(const u of h.features){if(!u)continue;u===n?this.applyVariantAssignments(l):this.invertVariantAssignments(u,l)}}}applyVariantAssignments(t){if(t.assignments)for(const n of t.assignments)n.apply()}invertVariantAssignments(t,n){if(t.assignments)for(const i of t.assignments)i.invert(n)}};let Df=O1;x(Df,"index",0);var Xse=Object.defineProperty,Yse=Object.getOwnPropertyDescriptor,oc=(a,e,t,n)=>{for(var i=n>1?void 0:n?Yse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Xse(e,t,i),i};class CA{constructor(){x(this,"description");x(this,"name");x(this,"thumbnail");x(this,"visibilityStatus")}}oc([we()],CA.prototype,"description",2);oc([we()],CA.prototype,"name",2);oc([we()],CA.prototype,"visibilityStatus",2);class T1{constructor(){x(this,"target");x(this,"content")}}oc([we(xp)],T1.prototype,"target",2);oc([we(CA)],T1.prototype,"content",2);class I1{constructor(){x(this,"target");x(this,"content")}}oc([we(rc)],I1.prototype,"target",2);oc([we(CA)],I1.prototype,"content",2);var Qy;const YE=(Qy=class extends pt{constructor(){super(...arguments);x(this,"variantTable");x(this,"featureSetDisplayInfos",[]);x(this,"featureDisplayInfos",[]);x(this,"switcher");x(this,"uiContainer");x(this,"uiParent");x(this,"selectFunctionsByFeatureId",new Map);x(this,"onIframeMessage",e=>{if(window===e.source)return;const{method:t,args:n}=e.data;if(t==="setVariant"){const i=n[0],r=this.selectFunctionsByFeatureId.get(i);r&&r()}})}awake(){YE.formaUiToggle||(YE.formaUiToggle=new Jse(this.context)),this.switcher=Ee.findObjectOfType(Df);const e=document.createElement("div");e.classList.add("selection-container"),this.uiContainer=e}saveSelectedFeature(e){}start(){for(const e of this.featureSetDisplayInfos)if(e.content.visibilityStatus===0){const t=e.content.name,n=[],i=e.target;for(const o of i.features){const l=this.findDisplayInfo(o);if(l){const h=()=>{this.saveSelectedFeature(o.code),this.switcher.switchFeature(e.target,o)};n.push({label:l.name,select:h}),o.code&&this.selectFunctionsByFeatureId.set(o.code,h)}else console.warn("Couldnt find: ",o)}const r=this.createDropdownWithItems(t,n);this.uiContainer.appendChild(r)}}onFinishedLoading(){}onEnable(){window.addEventListener("message",this.onIframeMessage,!1)}onDisable(){var e;(e=this.uiContainer)==null||e.remove(),window.removeEventListener("message",this.onIframeMessage,!1)}findDisplayInfo(e){for(const t of this.featureDisplayInfos)if(t.target===e)return t.content;return null}createDropdownWithItems(e,t){const n="div",i="button",r=document.createElement("div");r.classList.add("dropdown"),r.classList.add("variants");const o=document.createElement("h3");o.classList.add("dropdown-label"),o.innerText=e,r.appendChild(o);const l=document.createElement(n);l.classList.add("dropdown-list"),r.appendChild(l);for(const h of t){const u=document.createElement(i);u.classList.add("dropdown-item"),u.innerText=h.label,l.appendChild(u),i.startsWith("button")&&u.addEventListener("click",()=>h.select.call(l))}return r}},x(Qy,"formaUiToggle"),x(Qy,"engraving"),Qy);let EA=YE;oc([we(bA)],EA.prototype,"variantTable",2);oc([we(I1)],EA.prototype,"featureSetDisplayInfos",2);oc([we(T1)],EA.prototype,"featureDisplayInfos",2);class Jse{constructor(e){x(this,"context");x(this,"root");this.context=e,this.root=document.getElementById("forma-ui"),this.addEventListeners(),this.allowUi&&console.log(">> Press F2 to toggle forma debug UI"),Ct("showforma")&&this.setVisible(!0)}get allowUi(){return Ct("debugforma")}get isVisible(){var e;return((e=this.root)==null?void 0:e.style.display)==="initial"}setVisible(e){!this.root||(this.root.style.display=e?"initial":"none")}addEventListeners(){window.addEventListener("keydown",e=>{this.allowUi&&e.key==="F2"&&(console.log(this.isVisible),this.setVisible(!this.isVisible))})}}var Kse=Object.defineProperty,Zse=Object.getOwnPropertyDescriptor,SA=(a,e,t,n)=>{for(var i=n>1?void 0:n?Zse(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Kse(e,t,i),i};const aa=Ct("debugforma")||Ct("debugformaselection");class R1{constructor(){x(this,"product")}}SA([we(Ho)],R1.prototype,"product",2);class zk extends pt{constructor(){super(...arguments);x(this,"productPrefabs");x(this,"productInstances",[]);x(this,"activeProductIndex",-1);x(this,"loadingProductIndex",-1);x(this,"activeProduct",null)}async awake(){this.context.addProduct=t=>{this.addProduct(t),this.selectProduct(t)},aa&&console.log(this),window.addEventListener("keydown",t=>{const n=Number.parseInt(t.key);n>0&&this.selectProduct(n-1)}),this.productPrefabs.length>0&&await this.selectProduct(0);for(let t=0;t<this.productPrefabs.length;t++)await this.loadProduct(t);window.addEventListener("message",t=>{if(window===t.source)return;const{method:n,args:i}=t.data;n==="switchProduct"&&this.selectProduct(i[0])},!1)}addProduct(t){for(let r=0;r<this.productPrefabs.length;r++)if(this.productPrefabs[r].product.uri===t)return;if(!this.sourceId){console.error("internal error, no source id");return}const n=Ho.getOrCreate(t,t,this.context),i=new R1;i.product=n,this.productPrefabs.push(i),aa&&console.log("Add product",t,i,this.productPrefabs)}removeProduct(t){}async selectProduct(t){if(typeof t=="string"){const n=t,i=this.productPrefabs.findIndex(r=>r.product.uri.endsWith(n));if(i===-1)return console.warn("Could not find product with uri: "+t,"please add the product first"),!1;t=i}if(aa&&console.log(t),!(t===this.activeProductIndex||t===this.loadingProductIndex)){if(this.activeProduct&&Ee.remove(this.activeProduct),t>=this.productInstances.length||!this.productInstances[t]){if(t>=this.productPrefabs.length){aa&&console.warn("Invalid index",t,this);return}await this.loadProduct(t)}if(aa&&console.log("SELECT PRODUCT",t),this.activeProductIndex=t,this.activeProduct=this.productInstances[t],this.activeProduct){const n=this.gameObject;Ee.add(this.activeProduct,n),this.context.domElement.dispatchEvent(new CustomEvent("product-selected",{detail:this.activeProduct})),Ee.getComponentInChildren(n,EA)}else aa&&console.error("No product",t,this.activeProduct)}}async loadProduct(t){var r;if(this.productInstances[t]||this.loadingProductIndex===t)return;this.loadingProductIndex=t;const n=this.productPrefabs[t];aa&&console.log("Begin loading: "+n.product.uri,t);const i=await n.product.loadAssetAsync();if(this.productInstances[t]=i,this.loadingProductIndex=-1,i){const o=Ee.getComponentInChildren(i,Lx);aa&&console.log("Finished loading: "+((r=n.product)==null?void 0:r.uri)),o&&(o.sourceId=n.product.uri,this.onLoadedProduct(o,t))}}onLoadedProduct(t,n){const i=t.definition.defaultThumbnail;(o=>{if(!o)return;o.classList.add("product");const l=document.querySelector("#forma-products");l&&(l.children.length>n?l.insertBefore(o,l.children[n]):l==null||l.appendChild(o),o.addEventListener("click",()=>{this.selectProduct(n)}))})(f9(i,!1))}}SA([we(R1)],zk.prototype,"productPrefabs",2);class Gk{constructor(){x(this,"defaultThumbnail")}}SA([we(Ii)],Gk.prototype,"defaultThumbnail",2);class Lx extends pt{constructor(){super(...arguments);x(this,"modelSetPrefab");x(this,"definition");x(this,"awaken",!1)}async start(){if(aa&&console.log(this),this.modelSetPrefab){this.modelSetPrefab._uri=Kg(this.sourceId,this.modelSetPrefab.uri),aa&&console.log("Load modelset",this.modelSetPrefab.uri,"own source id",this.sourceId);const t=await this.modelSetPrefab.loadAssetAsync();this.gameObject.add(t)}else console.error("missing modelsetprefab",this.modelSetPrefab);this.awaken=!0,window.parent.postMessage(["productLoaded"],"*")}onEnable(){this.awaken&&window.parent.postMessage(["productLoaded"],"*")}}SA([we(Ho)],Lx.prototype,"modelSetPrefab",2);SA([we(Gk)],Lx.prototype,"definition",2);class $se extends pt{awake(){aa&&console.log(this)}}class ere extends pt{}class tre extends pt{constructor(){super(...arguments);x(this,"webXR");x(this,"arButton")}awake(){this.webXR=Ee.findObjectOfType(_i),this.webXR&&(this.webXR.createARButton=!0)}start(){this.webXR&&(this.arButton=this.webXR.ARButton,this.arButton&&(_i.IsARSupported?this.arButton.addEventListener("click",()=>{console.log("CLICK")}):(console.log("Hide AR button - platform has no AR support"),setTimeout(()=>{this.setARButtonVisibility(!1)},100))))}setARButtonVisibility(t){!this.arButton||(this.arButton.style.display=t?"block":"none")}}Be.add("GameObjectVisibilityAssignment",kse);Be.add("MaterialAssignment",Nse);Be.add("CameraView",Mu);Be.add("Configuration",E1);Be.add("Pack",iv);Be.add("FeatureBase",vp);Be.add("FeatureSet",rc);Be.add("PackSet",kk);Be.add("ConfiguratorSettings",zk);Be.add("Product",Lx);Be.add("ModelSet",$se);Be.add("ProductRuntimeUIData",EA);Be.add("QueryResults",Dse);Be.add("StaticMaterialQueryNode",Lk);Be.add("StaticBoolQueryNode",Dk);Be.add("MaterialSlot",Mx);Be.add("StaticListMaterialSlotQueryNode",Ok);Be.add("StaticListGameObjectQueryNode",Fk);Be.add("Rules",ere);Be.add("Switcher",Df);Be.add("VariantTable",bA);Be.add("Variant",M1);Be.add("VariantSet",Uk);Be.add("FormaWebXR",tre);const nre=async function(a,e){const t=a.scene;a.new_scripts;const n=await XE.loadSync(a,"assets/glTFSceneRoot.glb",null,!1,r=>{var o;return(o=e==null?void 0:e.progress)==null?void 0:o.call(e,{name:"glTFSceneRoot.glb",progress:r,index:0,count:2})});n&&t.add(n.scene);const i=await XE.loadSync(a,"assets/configurator.glb",null,!1,r=>{var o;return(o=e==null?void 0:e.progress)==null?void 0:o.call(e,{name:"configurator.glb",progress:r,index:1,count:2})});i&&t.add(i.scene),a.scripts};XE.build_scene_functions.loadScene=nre;console.log("Made with \u2665 by \u{1F335} needle - https://needle.tools \u2014 Version 2.34.0-pre");
